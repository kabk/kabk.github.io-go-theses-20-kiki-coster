(window.webpackJsonp=window.webpackJsonp||[]).push([["constructor/bundle~screenshoter/bundle~viewer/bundle"],{"+/R+":function(t,e,i){"use strict";var s=i("2EI4");i.n(s).a},"+EJ4":function(t,e,i){},"+Xeu":function(t,e,i){"use strict";var s=i("cx/9");i.n(s).a},"+teE":function(module,exports){module.exports={"template-constructor-control-text_typography":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Typography" data-alt-pos="left" data-alt-offset="9"></div>\n\t<div class="panel">\n\n\t\t<div class="font-size-wrapper">\n\t\t\t<div class="multiple-layer">&bull;&bull;&bull;</div>\n\t\t\t<input class="font-size" title="Font Size" spellcheck="false" data-class="font-size" type="text" value=""/>\n\t\t</div>\n\n\t\t<div class="line-height-wrapper">\n\t\t\t<div class="multiple-layer">&bull;&bull;&bull;</div>\n\t\t\t<input class="line-height" title="Line Height" spellcheck="false" data-class="line-height" type="text" value=""/>\n\t\t</div>\n\n\t\t<div class="gauge">\n\t\t\t<div class="font-size-gauge"></div>\n\t\t\t<div class="line-height-gauge"></div>\n\t\t</div>\n\n\t\t<div class="pictograms">\n\t\t\t<div class="linked active" title="Unbind Font Size and Line Height"></div>\n\t\t</div>\n\n\t\t<div class="letter-spacing-wrapper">\n\t\t\t<div class="block-layer"></div>\n\t\t\t<div class="multiple-layer"><span>&bull;&bull;&bull;</span></div>\n\t\t\t<input class="letter-spacing"  title="Tracking" spellcheck="false" type="text" value=""/>\n\t\t</div>\n\n\t\t<div class="font-style-popup">\n\t\t\t<div class="popup-caption"></div>\n\t\t\t<div class="arrow-icon"></div>\n\t\t</div>\n\n\t\t<div class="font-family-popup">\n\t\t\t<div class="popup-caption"></div>\n\t\t\t<div class="arrow-icon"></div>\n\t\t</div>\n\n\t\t<div class="font-style">\n\t\t\t<div class="font-style-wrapper">\n\t\t\t</div>\n\t\t</div>\n\t</div>\n';return __p}}},"+uCx":function(module,exports){module.exports={"template-constructor-control-text_bius":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon" data-alt="Font Style" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t\t<div class="all-caps" title="All Caps"></div>\n\t\t<div class="bold" title="Bold"></div>\n\t\t<div class="italic" title="Italic"></div>\n\t\t<div class="underline" title="Underline"></div>\n\t\t<div class="strike" title="Strike"></div>\n\t</div>\n';return __p}}},"/0Qt":function(t,e,i){"use strict";var s=i("etQA");i.n(s).a},"/Utn":function(t,e,i){},"0DSZ":function(t,e,i){"use strict";var s=i("xi34"),o=i("rFsW"),n={props:{onPanelScroll:{type:Function,default:function(){}},onScrollRecalc:{type:Function,default:function(){}},scrollGapStart:{type:Number,default:16},scrollGapEnd:{type:Number,default:16},systemScroll:{type:Boolean,default:!1},savedScrollPosition:{type:Number,default:void 0}},mounted:function(){this.resizableScroll=Object(s.a)(this.$refs.scrollWrapper).RMScroll({$container:Object(s.a)(this.$refs.contentWrapper),$content:Object(s.a)(this.$refs.content),$handle:Object(s.a)(this.$refs.scroll),wheelScrollSpeed:.4,gap_start:this.scrollGapStart,gap_end:this.scrollGapEnd,systemScroll:this.systemScroll,onScroll:this.onPanelScroll,savedScrollPosition:this.savedScrollPosition}).data("scroll"),this.__scrollRecalc_debounced=o.a.debounce(o.a.bind((function(){this.resizableScroll.recalc(),this.onScrollRecalc("control-resize")}),this),300)},methods:{recalcScroll:function(){this.__scrollRecalc_debounced()}},beforeUpdate:function(){0===this.savedScrollPosition&&this.resizableScroll.clearScroll()}},a=i("KHd+"),r=Object(a.a)(n,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{ref:"scrollWrapper",staticClass:"resizable-scroll-wrapper"},[e("div",{ref:"contentWrapper",staticClass:"resizable-content-wrapper"},[e("div",{ref:"content",staticClass:"resizable-content"},[this._t("default")],2)]),this._v(" "),e("div",{ref:"scroll",staticClass:"resizable-scroll"})])}),[],!1,null,null,null);e.a=r.exports},"0KJJ":function(t,e,i){},"0SXY":function(module,exports){module.exports={"template-constructor-control-gmaps_edit":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Edit map" data-alt-pos="left" data-alt-offset="9"></div>\n';return __p}}},"0zSa":function(t,e,i){"use strict";var s=i("xi34"),o=i("q1z7"),n=i.n(o),a=i("rFsW"),r=n.a.View.extend({pictures:[],domPictures:[],preloadPictures:[],currentSlide:null,nextSlide:null,selectedSlide:null,defaultDelay:4,defaultCrossfade:.5,isAnimationRunning:!1,cursor:0,rendered:!1,lastSlideshowAnimationStart:null,initialize:function(t){this.initSlideshowData(t.data),this.$container=t.container,this.$preloadContainer=t.preloadContainer},initSlideshowData:function(t){this.pictures=t&&t.pictures?a.a.sortBy(t.pictures,"num"):[],this.delay=t&&"number"==typeof t.delay?t.delay:this.defaultDelay,this.crossfade=t&&"number"==typeof t.crossfade?t.crossfade:this.defaultCrossfade,this.name=t&&t.name?t.name:"slideshow"+(new Date).getTime(),this.domPictures=[],this.preloadPictures=[],this.currentSlide=null,this.nextSlide=null,this.selectedSlide=null,this.isAnimationRunning=!1,this.cursor=0},render:function(t){RM.screenshot?this.pictures.length?this.addPicture(this.pictures[0]):this.trigger("loaded"):this.loadPictures(),this.isAnimationRunning||t||this.startAnimationLoop(),this.rendered=!0},rerender:function(t){this.stopAnimationLoop(),this.initSlideshowData(t),this.removePictures(),this.render(!0)},runAnimation:function(){this.isAnimationRunning||(this.rendered?this.startAnimationLoop():this.render())},setDelay:function(t){t<this.crossfade?console.error("delay mast be longer than crossfade"):this.delay=t},setCrossfade:function(t){t>this.delay?console.error("delay mast be longer than crossfade"):(this.crossfade=t,this.updateCrossfade())},updateCrossfade:function(){this.domPictures.forEach(function(t){t.css({"transition-duration":this.crossfade+"s"})}.bind(this))},updatePicture:function(t){var e=a.a.findIndex(this.pictures,(function(e){return e.uuid===t.uuid}));this.pictures[e]=t,this.domPictures[e].css({"background-image":'url("'+t.poorUrl+'")'}),this.loadFullSizePicture(t)},updatePicturePosition:function(t){this.destroy(),this.initSlideshowData({pictures:t,delay:this.delay,crossfade:this.crossfade}),this.render()},addPicture:function(t){var e=this.domPictures.length===this.cursor+1,i=0===this.domPictures.length?2:e?1:0,o=0===this.domPictures.length?"block":e?"block":"none";this.pictures.push(t),this.domPictures.push(Object(s.a)("<div>").addClass("slideshow-image fade-in").css({"z-index":i,display:o,"background-image":'url("'+t.poorUrl+'")',"transition-property":"opacity","transition-duration":this.crossfade+"s","transition-timing-function":"linear"}).appendTo(this.$container)),this.loadFullSizePicture(t)},selectSlide:function(t){if(t){var e=this.pictures.findIndex((function(e){return e.uuid===t}));if(-1!==e){if(this.currentSlide&&this.selectedSlide!==this.domPictures[e]&&(this.isAnimationRunning&&this.stopAnimationLoop(),this.currentSlide!==this.domPictures[e])){var i=this.cursor;this.nextSlide&&this.nextSlide.css({"z-index":0,display:"none"}),this.domPictures[e].css({"z-index":1,display:"block"}),this.currentSlide=this.domPictures[e],this.cursor=e,this.selectedSlide=this.domPictures[e],this.domPictures.length>1?this.domPictures[e+1]?this.nextSlide=this.domPictures[e+1]:this.nextSlide=this.domPictures[0]:this.nextSlide=null,this.domPictures[i].css({"transition-duration":"0.3s"}),this.domPictures[i].removeClass("fade-in").addClass("fade-out"),setTimeout(function(){this.domPictures[i].css({"z-index":0,"transition-duration":"0s",display:"none"}).removeClass("fade-out").addClass("fade-in").css({"transition-duration":this.crossfade+"s"}),this.currentSlide.css({"z-index":2}),this.nextSlide&&this.nextSlide.css({"z-index":1,display:"block"})}.bind(this),310)}}else console.warn("Did't find slide for uuid:",t)}},removePictures:function(){this.domPictures=[],this.preloadPictures=[],this.$container.empty(),this.$preloadContainer.empty()},removePicture:function(t){if(t){var e=this.pictures.findIndex((function(e){return e.uuid===t}));if(this.domPictures[e]===this.currentSlide&&1!==this.domPictures.length&&this.selectedSlide!==this.domPictures[e]){var i=1e3*this.crossfade+1e3*this.delay+50;i=this.lastSlideshowAnimationStart?Math.abs(i-((new Date).getTime()-this.lastSlideshowAnimationStart.getTime())):i,setTimeout(function(){this.cursor&&(this.cursor-=1);var e=this.pictures.findIndex((function(e){return e.uuid===t}));this.domPictures[e].remove(),this.domPictures.splice(e,1),this.pictures.splice(e,1)}.bind(this),i)}else{if(this.domPictures[e]===this.nextSlide&&1!==this.domPictures.length&&(this.domPictures[e+1]?(this.domPictures[e+1].css({"z-index":1,display:"block"}),this.nextSlide=this.domPictures[e+1]):(this.domPictures[0].css({"z-index":1,display:"block"}),this.nextSlide=this.domPictures[0])),this.selectedSlide===this.domPictures[e]&&this.nextSlide){var s=this.domPictures.findIndex(function(t){return t===this.nextSlide}.bind(this));this.currentSlide=this.domPictures[s],this.cursor=s,this.selectedSlide=null,this.currentSlide.css({"z-index":2}),this.domPictures.length>2?this.domPictures[this.cursor+1]?this.nextSlide=this.domPictures[this.cursor+1]:this.nextSlide=this.domPictures[0]:this.nextSlide=null,this.nextSlide&&this.nextSlide.css({"z-index":1,display:"block"}),setTimeout(function(){this.startAnimationLoop()}.bind(this),0)}this.domPictures[e].remove(),this.domPictures.splice(e,1),this.pictures.splice(e,1)}}},loadPictures:function(){this.pictures.forEach(function(t,e){this.domPictures[e]=Object(s.a)("<div>").addClass("slideshow-image fade-in").css({"z-index":0===e?2:1===e?1:0,display:0===e||1===e?"block":"none","background-image":'url("'+t.poorUrl+'")',"transition-property":"opacity","transition-duration":this.crossfade+"s","transition-timing-function":"linear"}).appendTo(this.$container)}.bind(this)),this.loadFullSizePictures()},loadFullSizePictures:function(){function t(t,e,i){this.domPictures[e].css({"background-image":'url("'+t+'")'}),this.preloadPictures[e].remove(),0===e&&this.trigger("loaded")}function e(t,e){console.error("on loadFullSizeSLideshowPictures Error",e),0===t&&this.trigger("loaded"),RM.screenshot||this.preloadPictures[t].remove()}this.preloadPictures=[],this.pictures.forEach(function(i,o){this.preloadPictures[o]=Object(s.a)("<img>").addClass("preload-slideshow-image").appendTo(this.$preloadContainer).attr("src",i.url).on("load",t.bind(this,i.url,o)).on("error",e.bind(this,o))}.bind(this))},loadFullSizePicture:function(t){var e=Object(s.a)("<img>").addClass("preload-slideshow-image").appendTo(this.$preloadContainer).attr("src",t.url).on("load",function(i){var s=a.a.findIndex(this.pictures,(function(e){return t.uuid===e.uuid}));this.domPictures[s].css({"background-image":'url("'+t.url+'")'}),e.remove(),this.trigger("loaded")}.bind(this)).on("error",function(t){console.error("on preloadSlideshowPicture Error",t),e.remove(),this.trigger("loaded"),RM.screenshot||e.remove()}.bind(this))},initCursor:function(){this.cursor=0,this.currentSlide=this.domPictures[this.cursor],this.domPictures[this.cursor+1]&&(this.nextSlide=this.domPictures[this.cursor+1])},startAnimationLoop:function(){this.isAnimationRunning=!0,this.selectedSlide=null,this.currentSlide||this.initCursor(),this.slideshowLouncher=setTimeout(function t(){this.fadeAnimation(),this.slideshowLouncher=setTimeout(t.bind(this),1e3*this.delay)}.bind(this),1e3*this.delay)},fadeAnimation:function(){var t;this.lastSlideshowAnimationStart=new Date,this.domPictures.length<2||(this.currentSlide&&this.nextSlide||this.initCursor(),this.cursor+1<this.domPictures.length?(this.currentSlide.removeClass("fade-in").addClass("fade-out"),t=this.cursor,setTimeout(function(){this.domPictures[t]&&this.domPictures[t].css({"z-index":0,"transition-duration":"0s",display:"none"}).removeClass("fade-out").addClass("fade-in").css({"transition-duration":this.crossfade+"s"}),this.domPictures[t+1].css({"z-index":2}),this.domPictures[t+2]?this.domPictures[t+2].css({"z-index":1,display:"block"}):this.domPictures[0].css({"z-index":1,display:"block"})}.bind(this),1e3*this.crossfade),this.cursor+=1,this.currentSlide=this.domPictures[this.cursor],this.domPictures[this.cursor+1]?this.nextSlide=this.domPictures[this.cursor+1]:this.nextSlide=this.domPictures[0]):(this.currentSlide.removeClass("fade-in").addClass("fade-out"),t=this.cursor,setTimeout(function(){this.domPictures[t]&&this.domPictures[t].css({"z-index":0,"transition-duration":"0s",display:"none"}).removeClass("fade-out").addClass("fade-in").css({"transition-duration":this.crossfade+"s"}),this.domPictures[0].css({"z-index":2}),this.domPictures[1].css({"z-index":1,display:"block"})}.bind(this),1e3*this.crossfade),this.cursor=0,this.currentSlide=this.domPictures[this.cursor],this.nextSlide=this.domPictures[this.cursor+1]))},stopAnimationLoop:function(t){this.isAnimationRunning=!1,clearTimeout(this.slideshowLouncher),t&&"function"==typeof t&&t()},destroy:function(){this.rendered=!1,this.stopAnimationLoop(this.removePictures.bind(this))}});e.a=r},1:function(t,e){},"1ljF":function(module,exports){module.exports={"template-constructor-workspace-inside-block-widget-selector":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n    <div class="widget-selector">\n\n        <div class="widget" data-block-type="picture">\n\t    \t<div class="icon"></div>\n\t        <div class="caption">Image</div>\n        </div>\n\n\n\t    <div class="widget" data-block-type="text">\n\t\t    <div class="icon"></div>\n\t\t    <div class="caption">Text</div>\n\t    </div>\n\n    </div>\n\n';return __p}}},"2EI4":function(t,e,i){},"2d4q":function(module,exports){module.exports={"template-constructor-control-shape_1x1":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Equilateral" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t</div>\n';return __p}}},"2fBX":function(t,e,i){},"2r+I":function(t,e,i){"use strict";var s=i("Hp7M");i.n(s).a},"38JW":function(t,e,i){"use strict";var s=i("xi34"),o=i("q1z7"),n=i.n(o),a=i("rFsW"),r=i("secl"),l=i.n(r),c=i("Zuws"),h=i.n(c),d=i("OTSC"),p=i("gobI"),u=i("roQd"),g=i("HwMs"),m=i("DqjY"),f=i("WoDZ"),v=i("v92f"),b=i("rVpV"),_=i("G3+Z"),w=i("gdoY"),y=i("QNiq"),k=i("Kf/z");function C(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function x(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?C(i,!0).forEach((function(e){S(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):C(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function S(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var P=x({},l.a,{},h.a),$=n.a.View.extend({template:P["template-viewer-page"],initialize:function(t){return a.a.bindAll(this),this.mag=t.mag,this.router=t.router,this.$container=t.$container,this.viewerType=t.viewerType,this.totalPages=t.totalPages,this.isStickyVerticalViewer=t.isStickyVerticalViewer,this.widgetsData=t.pageData.wids,a.a.defaults(t.pageData,{title:"",width:this.mag.getViewportSetting("width"),height:this.mag.getViewportSetting("min_height")}),a.a.extend(this,a.a.omit(t.pageData,["wids","widgets"])),this.contentPosition={left:0,top:0},this},render:function(){return this.setElement(this.template({isStickyVerticalViewer:this.isStickyVerticalViewer})),this.$el.appendTo(this.$container),RM.screenshot||Modernizr.csspositionsticky||Object(s.a)(".polyfill-sticky").Stickyfill(),this.zIndex=this.totalPages-this.num+2,"vertical"==this.viewerType&&this.$el.css("z-index",this.zIndex),this.$content=this.$(".page-content-container"),this.$scrollWrapper=this.$(".content-scroll-wrapper"),this.$scrollWrapper.one("scroll",this.fixSafariScroll),this.$fixedBgContainer=this.$(".page-fixed-bg-container"),this.$fixedPositionContainer=this.$(".fixed-position-container"),this.$fixedPositionContainerTop=this.$(".fixed-position-container-top"),this.$contentBounds=this.$(".content-bounds"),this.pageViewport=this.getPageViewport(),"horizontal"==this.viewerType&&this.$scrollWrapper.bind("scroll",this.onScroll),this.createLQBackground(),RM.screenshot==this._id&&(this.$el.css({overflow:"hidden",height:this.height,width:1024,position:"relative"}),"true"===d.b.queryUrlGetParam("pdf")&&(this.$fixedPositionContainer.css({height:"100%"}),this.$fixedPositionContainerTop.css({height:"100%"})),this.onResize(),this.on("pageLoaded",(function(){this.mag.router.sendReadyEvent({page:this})}),this)),this},show:function(){return this.shown||(this.$el.removeClass("hidden"),this.shown=!0,"horizontal"==this.viewerType&&this.onResize(),this.widgets&&this.lastViewportUsedForWidgetsCreation==this.pageViewport||this.createWidgetsForCurrentViewport()),this},start:function(t){if(!this.started||t&&t.forceStart)return this.started=!0,this.trigger("started"),t=t||{},a.a.each(this.widgets,(function(e){(!t||!t.widgetTypes||a.a.indexOf(t.widgetTypes,e.type)>=0)&&e.start()})),this.focusPage(),this.$scrollWrapper.addClass("accelerated-scroll"),this.animations&&this.animations.start(),this.mag.aboveGlobalAnimations&&this.mag.aboveGlobalAnimations.start(),this},stop:function(t){if(this.started)return t=t||{},this.started=!1,this.trigger("stopped"),this.$scrollWrapper.removeClass("accelerated-scroll"),a.a.each(this.widgets,(function(e){(!t||!t.widgetTypes||a.a.indexOf(t.widgetTypes,e.type)>=0)&&e.stop()})),this.animations&&this.animations.stop(),this.mag.aboveGlobalAnimations&&this.mag.aboveGlobalAnimations.stop(),this},getUrl:function(){return window.location.protocol+"//"+window.location.hostname+"/p"+this.num_id+"/"},setPosition:function(t,e){this.lastPosition==t&&this.lastNeighbour==e||(this.$el.removeClass("center-page prev-page next-page neighbour").addClass(t+"-page "+(e?"neighbour":"")),this.lastPosition=t,this.lastNeighbour=e)},scrollOnVerticalMode:function(t){this.hasScrollOnVerticalMode=!0;var e,i,s=this.pageHeight-this.pageBgHeight;t<0?(e=-t,i=0):s>=t?(e=0,i=-t):(e=s-t,i=-s),this.visibleWidgetsCoords=this.visibleWidgetsCoords||{},this.visibleWidgetsCoords.scrollTop=-i,this.animations&&this.animations.onScroll({forceApply:!this.isStickyVerticalViewer}),this.isStickyVerticalViewer||(this.$el.css("top",0),d.b.applyTransform(this.$el,e?"translateY("+e+"px) translateZ(0)":""),this.hasFixedWidgets?this.$contentBounds.css("top",i):d.b.applyTransform(this.$contentBounds,i?"translateY("+i+"px)":""))},resetScrollOnVerticalMode:function(t){this.hasScrollOnVerticalMode&&(this.hasScrollOnVerticalMode=!1,this.visibleWidgetsCoords=this.visibleWidgetsCoords||{},this.visibleWidgetsCoords.scrollTop=0,this.animations&&this.animations.onScroll({forceApply:!this.isStickyVerticalViewer}),this.isStickyVerticalViewer||(this.$el.css("top",""),d.b.applyTransform(this.$el,""),this.hasFixedWidgets?this.$contentBounds.css("top",0):d.b.applyTransform(this.$contentBounds,"")))},hide:function(){return this.shown&&(this.$el.addClass("hidden"),this.shown=!1),this},destroyAllWidgets:function(t){this.loaded=!1,this.videoBGStarted=!1,a.a.each(this.widgets,function(e,i){var s=this.widgetsData.some((function(t){var i=t._id===e._id&&Boolean(t.animation&&t.animation.type&&"none"!=t.animation.type&&!a.a.isEmpty(t.animation.steps)),s=t._id===e._id&&(t.viewport_default&&t.viewport_default.hidden||t.viewport_tablet_portrait&&t.viewport_tablet_portrait.hidden||t.viewport_phone_portrait&&t.viewport_phone_portrait.hidden||t.hidden);return i||s}));t&&t.includes(e.type)&&!s||(e.destroy(),e.off(),delete this.widgets[i])}.bind(this)),this.animations&&this.animations.destroy(),delete this.animations,clearTimeout(this.fireReadyTimeout)},destroy:function(){return this.retargetScroll&&this.retargetScroll.restore&&this.retargetScroll.restore(),this.resetWaitForAnimationEnd(),this.destroyLQBackground({animate:!1}),this.destroyAllWidgets(),this.remove()},onFormFocus:function(t){!Modernizr.safari&&y.a.isDesktop||(t=a.a.isUndefined(t)?this.$scrollWrapper&&this.$scrollWrapper.scrollTop():t,this.$fixedBgContainer.css({top:t}))},onFormBlur:function(){!Modernizr.safari&&y.a.isDesktop||this.$fixedBgContainer.css({top:0})},onScrollWithFormInFocus:function(t){!Modernizr.safari&&y.a.isDesktop||(t=a.a.isUndefined(t)?this.$scrollWrapper&&this.$scrollWrapper.scrollTop():t,this.$fixedBgContainer.css({top:t}))},isSwipeInProgress:function(){return this.$el.hasClass("swiping")},getPageZIndex:function(){return this.zIndex||1},getImmediatePack:function(){return a.a.filter(this.widgets,(function(t){return t.canRenderImmediately()&&!t.rendered}))},getWidgetsPacks:function(){if(!this.widgets)return[];var t,e,i,s=this.visibleWidgetsCoords,o=(s.top+(s.scrollTop||0))/s.scale,n=1/((s.bottom+(s.scrollTop||0))/s.scale-o),a=[],r=[];if(!this.BGWidget||this.BGWidget.rendered||this.BGWidget.loaded||r.push(this.BGWidget),this.fixedWidgets&&this.fixedWidgets.length)for(t=0;t<this.fixedWidgets.length;t++)(i=this.fixedWidgets[t]).rendered||i.loaded||i.canRenderImmediately()||r.push(i);var l,c,h=[],d=99999,p=-99999,u=!1;for(t=0;t<this.widgets.length;t++)(e=this.widgets[t]).rendered||e.loaded||"background"==e.type||e.fixed_position||(l=(c=$.getScreenIndex(e,o,n,!0)).index,d=Math.min(c.start,d),p=Math.max(c.end,p),e.screenIndex=l,l!==1/0&&(h[l]=h[l]||[],h[l].push(e)),u=!0);if(u){for(h[0]&&a.push(h[0]),h[1]&&a.push(h[1]),h[-1]&&a.push(h[-1]),t=2;t<=p;t++)h[t]&&a.push(h[t]);for(t=-2;t>=d;t--)h[t]&&a.push(h[t])}return r.length&&(a.length?a[0]=r.concat(a[0]):a=[r]),a},loadWidgetsPack:function(t,e){var i,s=0,o=0,n=0,a=!1;for(i=0;i<t.length;i++){var r=t[i];r.rendered||r.loaded||r.destroyed||(r.canRenderImmediately()||(s++,r.on("loaded destroyed",l,r)),n++,r.render())}function l(){o++,a&&s==o&&e()}a=!0,n||e(),s==o&&e()},loadForScreenshotMode:function(){a.a.each(this.widgets,(function(t){t.render().start()}))},createWidgetsForCurrentViewport:function(){this.destroyAllWidgets(["video"]),this.BGWidget=null,this.fixedWidgets=[];var t=this.pageViewport,e=[],i=[],s=99999,o=this,n=this;a.a.each(this.widgetsData,function(e){var o=n.getWidgetViewportData(e,t),a=!this.mag.isPreview&&u.a.hasExpired(o);!w.a[o.type]||o.hidden||a||(!o.fixed_position&&o.z&&"background"!=o.type&&(s=Math.min(s,o.z)),i.push(o))}.bind(this)),99999==s&&(s=0),a.a.each(i,function(t){var i=p.a.isAllowed()&&p.a.isTransform();t.fixed_position&&(t.z<s||y.a.isDesktop&&!this.mag.isStickyVerticalViewer&&!i)?t.$fixedContainer=n.$fixedPositionContainer:t.$fixedContainer=n.$fixedPositionContainerTop;var a=null;this.widgets&&this.widgets.length&&(a=this.widgets.find((function(e){return!!e&&e._id===t._id})));var r=a||new w.a[t.type](t,o);"video"===r.type&&(r.updateWidgetData(t,o),r.applyBoxStyle(),r.updateVideoFrameSize(t.w,t.h)),"background"==r.type&&(n.BGWidget=r,n.hasVideoBG=r.hasVideoBG()),r.isValid()&&(r.fixed_position&&n.fixedWidgets.push(r),e.push(r))}.bind(this)),this.animations=new g.a({page:this,widgets:e}),this.widgets=a.a.sortBy(e,"y"),this.signalOnLoading(),this._onFontsLoad=[],this._widgetsWithFontsToLoad=[],this._fontLoaderCalled=0,this._widgetsWithFontsCount=a.a.reduce(this.widgets,(function(t,e){return t+(e.hasFontsToLoad()?1:0)}),0),this._widgetsWithLoadAnimation=a.a.reduce(this.widgets,(function(t,e){return t+(e.hasLoadAnimation()?1:0)}),0),this.hasFixedWidgets=!!this.fixedWidgets.length;var r=p.a.isAllowed()&&p.a.isTransform();this.$el.removeClass("page-with-fixeds-desktop page-with-fixeds-sticky-or-mobile").toggleClass("page-with-fixeds-desktop",this.hasFixedWidgets&&y.a.isDesktop).toggleClass("page-with-fixeds-sticky-or-mobile",!(!this.hasFixedWidgets||!this.isStickyVerticalViewer&&y.a.isDesktop&&!r)),this.hasFixedWidgets&&!this.retargetScroll&&"horizontal"==this.viewerType&&y.a.isDesktop&&(this.retargetScroll=_.a&&Object(_.a)(this.$fixedPositionContainerTop.get(0),this.$scrollWrapper.get(0)),_.a&&Object(_.a)(this.$fixedPositionContainer.get(0),this.$scrollWrapper.get(0))),this.lastViewportUsedForWidgetsCreation=t},getWidgetViewportData:function(t,e){var i=a.a.clone(t),s={},o={},n=["text_w","text_h","em_w","anchor_link_pos","font-size","font-style","font-weight","font-family","color","color-opacity","letter-spacing","hover-color","hover-color-opacity","current-font-size","current-font-style","current-font-weight","current-font-family","current-color","current-color-opacity","current-letter-spacing","background-color","background-color-opacity","hover-background-color","hover-background-color-opacity","current-background-color","current-background-color-opacity","border-radius","border-width","border-color","border-color-opacity","hover-border-width","hover-border-color","hover-border-color-opacity","current-border-radius","current-border-width","current-border-color","current-border-color-opacity"];return"default"!=e&&t["viewport_"+e]&&(a.a.each(v.b.viewport_fields[t.type]||v.b.viewport_fields_common,(function(i){if(("shape"!=t.type||"borders"!=i&&"weight"!=i&&"bg_color"!=i)&&("background"!=t.type||"picture"!=i)){if(s[i]=void 0,b.a.isGlobalKey(i)){var o=b.a.getGlobalPrefixedKey(i);s[o]=void 0}s[i]="button"===t.type&&!a.a.has(t["viewport_"+e],i)&&n.includes(i)?t[i]:void 0}})),a.a.extend(i,s,a.a.omit(t["viewport_"+e],["_id","modelType"]))),t.is_global&&(o.props=t.is_above?["hidden"]:null,b.a.fillUniqueValues(i,this._id,o)),i},getWidgetById:function(t){return a.a.findWhere(this.widgets,{_id:t})},getWidgetDataById:function(t){return a.a.findWhere(this.widgetsData,{_id:t})},signalOnLoading:function(){var t=this.widgets.length,e=this,i={};function s(){t--,clearTimeout(i[this._id]),"background"==this.type&&e.destroyLQBackground({animate:!0}),this.hasLoadAnimation()&&(e._widgetsWithLoadAnimation--,e._widgetsWithLoadAnimation||(e.loadAnimationsReady=!0,e.trigger("loadAnimationsReady"))),t||(e.fireReadyTimeout=setTimeout(o,200)),e.trigger("loaded"+this._id)}function o(){e.loaded=!0,e.trigger("pageLoaded")}a.a.each(this.widgets,(function(t){RM.screenshot&&(i[t._id]=setTimeout((function(){t.widgetIsLoaded()}),2e4)),t.on("loaded",s,t)}),this),this.BGWidget&&this.hasVideoBG&&this.BGWidget.on("videoBGStarted",(function(){e.videoBGStarted=!0,a.a.delay((function(){e.trigger("videoBGStarted")}),1300)}),this.BGWidget),0==t&&(this.fireReadyTimeout=setTimeout(o,200))},getFontsVariations:function(t,e){var i=m.a.getUsedFontsFromWidgetsModels({includeCustom:!0,customList:a.a.filter(this.mag.edit_params.fonts,{provider:"custom"}),models:t,excludeUnusedDefault:e,activeViewports:[this.getPageViewport()]}),s=[];return a.a.each(i,(function(t){for(var e=0;e<t.used_variations.length;e++)s.push({fontFamily:t.css_name,fontWeight:100*(t.used_variations[e].substr(1,1)-0),fontStyle:"n"==t.used_variations[e].substr(0,1)?"normal":"italic"})})),s},addFontsToLoad:function(t,e){if(this._widgetsWithFontsToLoad.push(t),this._onFontsLoad.push(e),this._fontLoaderCalled++,this._fontLoaderCalled==this._widgetsWithFontsCount){var i=this.getFontsVariations(this._widgetsWithFontsToLoad);if(a.a.isEmpty(i))return void this.onAllFontsLoad();this._fontsToLoadLeft=i.length,a.a.each(i,a.a.bind((function(t){m.a.exactWaitForFontLoad(t.fontFamily,t.fontWeight,t.fontStyle,this.onOneFontLoad)}),this))}},onOneFontLoad:function(t,e,i,s){this._fontsToLoadLeft--,0==this._fontsToLoadLeft&&a.a.delay(this.onAllFontsLoad,500)},onAllFontsLoad:function(){a.a.each(this._onFontsLoad,(function(t){t&&t()}))},updateViewport:function(){var t=this.getPageViewport();t!=this.pageViewport&&(this.pageViewport=t,this.createLQBackground(),this.shown&&(this.createWidgetsForCurrentViewport(),this.started&&(this.started=!1,this.start())))},waitForAnimationEnd:function(t){this.resetWaitHook=d.b.waitForTransitionEnd(this.$el,this.mag.getPageTransitionTime()+1e3,"transform",t)},resetWaitForAnimationEnd:function(){this.resetWaitHook&&this.resetWaitHook()},backToTop:function(){this.scrollTo(0)},scrollTo:function(t){this.$scrollWrapper.finish(),this.$scrollWrapper&&this.$scrollWrapper.animate({scrollTop:t},500)},focusPage:function(){y.a.isDesktop&&"vertical"!=this.viewerType&&0==this.$el[0].getBoundingClientRect().left&&(this.$content.focus(),this.mag.$el.scrollTop(0))},markAsLast:function(){this.lastPage=!0,this.$el.addClass("last")},isLastPage:function(){return!!this.lastPage},isBottomArrowVisible:function(){return!this.wasScrolled&&this.scrollable},scrollPageALittle:function(){this.$scrollWrapper.animate({scrollTop:Object(s.a)(window).height()/2},500)},getPageViewport:function(){var t=this.mag.viewport,e=this;if("default"==t||RM.screenshot)return"default";if(this["viewport_"+t]&&this["viewport_"+t].enabled)return t;var i=a.a.findWhere(v.b.viewports,{name:t}).width,s=a.a.reduce(v.b.viewports,(function(t,s,o){return("default"==s.name||e["viewport_"+s.name]&&e["viewport_"+s.name].enabled)&&Math.abs(s.width-i)<=Math.abs(v.b.viewports[t].width-i)?o:t}),0);return v.b.viewports[s].name},onResize:function(t){if(t=t||{},this.shown||"horizontal"!=this.viewerType){var e=this.mag.getContainerSizeCached(),i=this.mag.getViewportSetting("width",this.pageViewport),s=this.mag.getScale(this.pageViewport),o=this["viewport_"+this.pageViewport]&&this["viewport_"+this.pageViewport].height||this.height,n={width:i,height:o,scaledWidth:Math.round(i*s),scaledHeight:Math.round(o*s),scale:s},a=Math.min(n.scaledWidth,e.width),r=n.scaledHeight,l=Math.max((e.height-r)/2,0),c=Math.max((e.width-a)/2,0),h={width:n.width,height:n.height,top:l,left:c};return s>=1&&p.a.isAllowed()&&p.a.isZoom()&&(h.zoom=s,h.left=0),this.$content.removeAttr("style"),this.$content.css(h),this.contentPosition={left:c,top:l},1===p.a.normalize(s,"transform")?(d.b.applyTransform(this.$content,""),n.scale=1):p.a.isZoom()&&s>1&&Object(k.a)("viewer.fixOnScrollSpeed1")?this.$content.css(x({zoom:n.scale},Modernizr.isdesktop?{}:{"-webkit-text-size-adjust":"auto","-moz-text-size-adjust":"auto","-ms-text-size-adjust":"auto","text-size-adjust":"auto"})):d.b.applyTransform(this.$content,"scale("+n.scale+")"),this.contentHeight=n.height,this.pageHeight=Math.max(e.height,n.scaledHeight),this.pageBgHeight=e.height,this.pageWidth=n.width,"vertical"==this.viewerType&&this.isStickyVerticalViewer&&this.$el.css({height:this.pageHeight,top:t.absolutePosition}),this.scale=s,this.$contentBounds.css({width:e.width,height:this.pageHeight}),null!=this.prevScale&&this.prevScale!=this.scale&&(this.animations&&this.animations.updateTimelines(),p.a.isOn(this.scale)&&this.animations&&(this.animations.resetStarted(),this.animations.start.__debounced())),this.animations&&this.animations.onResize(),this.trigger("resize",{containerSize:e,contentPosition:this.contentPosition}),this.scrollable=r-this.mag.SCROLLABLE_TRESHOLD>e.height,this.mag.recalcBottomArrowState(this),this.visibleWidgetsCoords=this.visibleWidgetsCoords||{},this.visibleWidgetsCoords.top=-l,this.visibleWidgetsCoords.bottom=-l+e.height,this.visibleWidgetsCoords.scale=s,this.resizeLQBackground(),this.prevScale=this.scale,this.pageHeight}},onScroll:function(){this.wasScrolled=!0,this.mag.recalcBottomArrowState(this),this.visibleWidgetsCoords=this.visibleWidgetsCoords||{},this.visibleWidgetsCoords.scrollTop=this.$scrollWrapper.scrollTop(),this.mag.onCurrentPageScroll(this,this.visibleWidgetsCoords.scrollTop),this.animations&&this.animations.onScroll()},isCurrent:function(){return this.num===this.mag.currentPage.num},createLQBackground:function(){if(!RM.screenshot){var t=this.getWidgetViewportData(a.a.findWhere(this.widgetsData,{type:"background"}),this.pageViewport);if(this.LQBG){if("picture"==t.selectedType&&"picture"==this.LQBG.selectedType&&t.picture&&this.LQBG.picture&&t.picture.poorUrl==this.LQBG.picture.poorUrl||"video"==t.selectedType&&"video"==this.LQBG.selectedType&&t.video&&this.LQBG.video&&t.video.thumbnail_url==this.LQBG.video.thumbnail_url)return void this.resizeLQBackground();this.destroyLQBackground({animate:!1})}if(this.$fixedBgContainer.css("background-color","#"+t.color),t.picture&&"picture"==t.selectedType&&t.picture.poorUrl||t.video&&"video"==t.selectedType&&t.video.thumbnail_url){this.LQBG=a.a.extend({},t);var e=P["template-viewer-widget-background"];if(this.LQBG.$el=Object(s.a)(e({data:t})),this.LQBG.$el.addClass("low-quality").appendTo(this.$fixedBgContainer),"picture"==this.LQBG.selectedType)Object(s.a)("<img/>").on("load",a.a.bind((function(){this.LQBG&&this.LQBG.$el.find(".picture-background").css({"background-image":"url("+this.LQBG.picture.poorUrl+")"})}),this)).attr("src",this.LQBG.picture.poorUrl);if("video"==this.LQBG.selectedType){var i=this.LQBG.video.thumbnail_url.replace("http://","https://"),o=Object(s.a)("<img/>").addClass("poster").css("opacity",0).appendTo(this.LQBG.$el.find(".video-background .video-container"));o.on("load",a.a.bind((function(){o.css({width:"",height:""}).css("opacity",1);var t=o[0].width,e=o[0].height;this.LQBG&&!this.LQBG.video.aspect_poster&&(this.LQBG.video.aspect_poster=t/e),this.resizeLQBackground()}),this)).attr("src",i)}}}},resizeLQBackground:function(){RM.screenshot||this.LQBG&&"video"==this.LQBG.selectedType&&f.a.setVideoPosition({mag:this.mag,$container:this.LQBG.$el.find(".video-background .video-container"),$media:this.LQBG.$el.find(".video-background .video-container .poster"),provider:this.LQBG.video.provider_name,aspect_poster:this.LQBG.video.aspect_poster,aspect_real:this.LQBG.video.aspect_real,controls_remove:!0})},destroyLQBackground:function(t){if(!RM.screenshot&&this.LQBG){(t=t||{}).animate=t.animate&&"picture"==this.LQBG.selectedType&&this.started;var e=this.LQBG.$el;this.LQBG=null,t.animate?(e.css("opacity",0),setTimeout((function(){e.remove()}),400)):e.remove()}},fixSafariScroll:function(t){Modernizr.safari&&y.a.isDesktop&&(0!==this.$scrollWrapper.scrollTop()&&this.$scrollWrapper.scrollTop(0))}},{getScreenIndex:function(t,e,i,s){var o,n=Math.floor((t.y-e)*i),a=Math.ceil((t.y+t.h-e)*i)-1;return s&&t.canRenderImmediately()?o=1/0:t.hasLoadAnimation()?o=0:n<=0&&a>=0?o=0:n>0?o=n:a<0&&(o=a),{start:n,end:a,index:o}}});e.a=$},"3XvJ":function(module,exports){module.exports={"template-viewer-widget-button":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n    <input class="text"\n           value="'+(null==(__t=data.text)?"":_.escape(__t))+'"\n           type="text"\n           disabled\n           readonly\n           autocapitalize="off"\n           autocorrect="off"\n           autocomplete="off"\n           spellcheck="false"\n           role="button"\n           name="'+(null==(__t=data.text)?"":_.escape(__t))+'"/>\n\n';return __p}}},"3dGj":function(t,e,i){"use strict";var s=i("rH4x");i.n(s).a},"4BoS":function(t,e,i){},"4m+J":function(module,exports){module.exports={"template-viewer-widget":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="rmwidget" data-id="'+(null==(__t=id)?"":_.escape(__t))+'"></div>\n';return __p}}},"4nGE":function(t,e,i){},"5DNN":function(module,exports){module.exports={"template-constructor-block-text":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="margins-wrapper">\n\t\t<div class="margins-wrapper-inner">\n\t\t</div>\n\t</div>\n\n\t<div class="columns-wrapper">\n\t\t<div class="columns-wrapper-inner">\n\t\t</div>\n\t</div>\n\n\t<textarea id="textarea_'+(null==(__t=_id)?"":__t)+'" style="display: none; width:'+(null==(__t=w)?"":__t)+"px;height:"+(null==(__t=h)?"":__t)+'px">'+(null==(__t=text)?"":_.escape(__t))+'</textarea>\n\t<div class="text-preview" style="-webkit-nbsp-mode:normal; -webkit-line-break:after-white-space;">'+(null==(__t=text)?"":__t)+'</div>\n\t<div class="text-mask"></div>\n\n';return __p},"template-constructor-block-text-margins":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="margin-handle hidden inactive">\n\t\t<div class="margin-handle-label-wrapper">\n\t\t\t<div class="margin-handle-label">\n\t\t\t\t<input class="margin-input" type="text"  spellcheck="false" value="0" data-mouseSpeed="2" />\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n';return __p},"template-constructor-block-text-bg":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="bg"></div>\n';return __p}}},"5EAR":function(t,e,i){"use strict";var s=i("n1zk");i.n(s).a},"5IDT":function(t,e,i){},"5jX/":function(module,exports){module.exports={"template-constructor-control-picture_fwpos":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Crop" data-alt-pos="left" data-alt-offset="9"></div>\n';return __p}}},"60Nw":function(t,e,i){"use strict";var s=i("xi34"),o=i("q1z7"),n=i.n(o),a=i("rFsW"),r=i("OTSC"),l=i("3eHG"),c=i("WoDZ"),h=i("H3/6"),d=i("8CCW"),p=i.n(d);function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var g={},m={findPlugin:function(t){var e=h.a.matchCode(t.code,t);return a.a.find(g,(function(t,i){return i.toLowerCase()===e}))}},f=n.a.View.extend({embed_type:null,containerSelector:null,resizable:!0,proportional:!1,forceFrameSize:!1,initialize:function(t){this.block=t.block,this.widget=t.widget,a.a.bindAll(this),this.isInViewer=RM.viewerRouter||RM.constructorRouter&&RM.constructorRouter.preview},parse:function(t,e){return e(t)},sanitize:function(t){return Object(s.a)(t)},draw:function(t){t()}});function v(t,e){if(t){var i=["allow-top-navigation","allow-top-navigation-by-user-activation","allow-modals","allow-popups","allow-popups-to-escape-sandbox"],s=e&&Array.isArray(e)?e.filter((function(t){return!a.a.contains(i,t.toLowerCase())})):["allow-scripts","allow-forms","allow-same-origin"];t.attr("sandbox",s.join(" "))}}m.instagramEmbedCallbacks=[],m.initInstagram=function(t){if(window.instgrm&&window.instgrm.Embeds&&a.a.isFunction(window.instgrm.Embeds.process))return instgrm.Embeds.process(),t();m.instagramEmbedCallbacks.push(t),m.instagramInitXhr&&m.instagramInitXhr.abort(),Object(s.a)('body > script[src^="//platform.instagram.com"]').remove(),m.instagramInitXhr=s.a.ajax({url:r.b.selectProtocol("//platform.instagram.com/en_US/embeds.js"),dataType:"script",cache:!0,success:function(){a.a.each(m.instagramEmbedCallbacks,(function(t){a.a.isFunction(t)&&t()}))}})},g.Instagram=f.extend({embed_type:"instagram",containerSelector:"iframe",resizable:!0,initialize:function(t){f.prototype.initialize.apply(this,arguments),this.block&&a.a.extend(this.block.frame,{minwidth:164,minheight:264})},parse:function(t,e){return e(t.replace(/<script.*script>/i,""))},draw:function(t,e,i){var s,o,n,a,r,l=0,c=!1;e.html(t),m.initInstagram(function(){r=setInterval(function(){if(l++,s=e.children(this.containerSelector),(o=s.height())||l>20){if(o||l>50)return o&&"constructor"===RM.common.mode&&(n=s.width(),a=s.height()),clearInterval(r),void i(n,a);if(c)return;c=!0,i()}}.bind(this),100)}.bind(this))},customResizeHandler:function(t,e,i){return t}}),m.pinterestEmbedCallbacks=[],m.initPinterest=function(t){var e,i=0;if(a.a.isFunction(window.parsePinBtns))return t();m.pinterestEmbedCallbacks.push(t),Object(s.a)('body > script[src^="assets.pinterest.com/js/pinit.js"]').remove(),Object(s.a)("body").prepend(Object(s.a)('<script defer src="//assets.pinterest.com/js/pinit.js" data-pin-build="parsePinBtns"><\/script>')),e=setInterval((function(){i++,(a.a.isFunction(window.parsePinBtns)||i>20)&&(clearInterval(e),t())}),100)},g.Pinterest=f.extend({embed_type:"pinterest",containerSelector:"a",resizable:!1,forceFrameSize:!0,containerSelectors:{buttonPin:"span",buttonFollow:"span",embedPin:"span",embedUser:"span",embedBoard:"span"},parse:function(t,e){var i=t.match(/data-pin-do=\"(\S+)\"/);return a.a.isArray(i)&&i[1]&&(this.pinterestType=i[1],this.containerSelector=this.containerSelectors[this.pinterestType]||this.containerSelector),e&&e(t.replace(/<script.*script>/i,""))},draw:function(t,e,i){m.initPinterest(function(){var s,o,n,a,r,l,c=0,h=!1;e.html(t),this.pinterestType||this.parse(t[0].outerHTML),this.pinterestType&&e.addClass(this.pinterestType),window.parsePinBtns(e.get(0)),r=setInterval(function(){if(c++,s=e.children(this.containerSelector).filter((function(){return/PIN_\d+/.test(this.className)})),(o=s.height())||c>20){if(o||c>50)return o&&"constructor"===RM.common.mode&&(n=s.outerWidth(!0),a=s.outerHeight(!0),"buttonFollow"==this.pinterestType&&(l=s.children("i")).length&&(n+=(l.outerWidth()||1)-1)),clearInterval(r),void i(n,a);if(h)return;h=!0,i()}}.bind(this),100)}.bind(this))}}),g.FacebookVideo=f.extend({embed_type:"fbvideo",containerSelector:"iframe",resizable:!0,proportional:!0,forceFrameSize:!0,initialize:function(t){f.prototype.initialize.apply(this,arguments),this.block&&a.a.extend(this.block.frame,{minwidth:220,minheight:124})},parse:function(t,e){return e(t.replace(/<script.*script>/gi,"").replace(/<div\s+id=(\'|\")fb-root(\'|\")><\/div>/gi,""))},draw:function(t,e,i){var s,o,n;e.html(t),l.a.initFacebookAPI(function(){window.FB.XFBML.parse(e.get(0),function(){s=e.find(this.containerSelector),o=s.width(),n=s.height(),i(o,n)}.bind(this))}.bind(this))}}),m.readymagEmbedCallbacks=[],m.initReadymag=function(t){if(RM.common.isReadymagEmbedInited&&a.a.isFunction(window.RM_EMBED_parse))return t();m.readymagEmbedCallbacks.push(t),window.RM_EMBED_initAsync=function(){RM.common.isReadymagEmbedInited=!0,a.a.each(m.readymagEmbedCallbacks,(function(t,e){a.a.isFunction(t)&&t()})),m.readymagEmbedCallbacks=[]},m.readymagInitXhr||(Object(s.a)('body > script[src~="RM_EMBED_"]').remove(),m.readymagInitXhr=s.a.ajax({url:r.a.EMBED_SCRIPT_MAIN,dataType:"script"}))},g.Readymag=f.extend({embed_type:"readymag",containerSelector:"iframe",resizable:!0,initialize:function(t){f.prototype.initialize.apply(this,arguments),this.block&&this.block.frame&&a.a.extend(this.block.frame,{minwidth:288,minheight:236,maxwidth:512,maxheight:383})},parse:function(t,e){return e(t.replace(/<script.*script>/i,""))},draw:function(t,e,i){e.html(t),m.initReadymag(function(){window.RM_EMBED_parse(function(){var t=e.find(this.containerSelector),s=t.width(),o=t.height();i(s+2,o)}.bind(this))}.bind(this))}}),g.IFrame=f.extend({embed_type:"simple-iframe",containerSelector:"iframe",resizable:!0,parse:function(t,e){var i;return(i=t.match(/[\s\S]*?(\<iframe[\s\S]*?\>)[\s\S]*?(\<\/iframe\>)[\s\S]*?/i))&&i[1]&&i[2]?e(i[1]+i[2]):e(null)},sanitize:function(t){var e=Object(s.a)(t);if("object"!==u(e)||!e.length)return e;var i,o=Object(s.a)("<iframe></iframe>"),n=e.get(0).attributes,r=["allowtransparency","height","name","sandbox","scrolling","seamless","src","width","allow"];return Object(a.a)(n).each((function(t){if("object"===u(t)&&t.specified&&a.a.contains(r,t.name.toLowerCase())){var e=t.name.toLowerCase(),s=t.value;"src"==e&&"https:"==window.location.protocol&&(s=s.replace(/^http(s?):\/\//i,"//")),"sandbox"===e&&(i=s.split(" ")),o.attr(e,s)}})),this.isInViewer||v(o,i),o},draw:function(t,e,i){var s=t[0].src;if(s&&s.trim())if(RM.screenshot&&c.a.getVideoProvider(s))this.setPosterInsteadOfVideo(s,e,i);else{e.html(t);var o,n,a,r,l,h=0,d=!1;l=setInterval(function(){if(h++,o=e.children(this.containerSelector),(n=o.height())||h>20){if(n||h>50)return n&&"constructor"===RM.common.mode&&(a=o.width(),r=o.height()),clearInterval(l),void i(a,r);if(d)return;d=!0,i()}}.bind(this),100)}else i()},setPosterInsteadOfVideo:function(t,e,i){var o=c.a.getVideoProvider(t),n=Object(s.a)("<img/>");c.a.getEmbedData(t,(function(t){c.a.getHighResVideoThumbnail({provider:o,thumbnail_url:t.thumbnail_url}).then(a.a.bind((function(t){!function(t){n[0].src=t,e.css({"background-color":"#000"}),n.css({position:"absolute",top:0,bottom:0,margin:"auto",width:"100%",height:"auto"}),e.append(n)}(t)}),this))}),(function(){"function"==typeof i&&i()}))}}),g.CodeInjection=f.extend({embed_type:"code-injection",containerSelector:"rm-code-injection",resizable:!0,HEAD_PASSTHROUGH_SELECTOR:"",parse:function(t,e){return e(t)},sanitize:function(t){return s.a.parseHTML(t,document,!0)},draw:function(t,e,i){var o=Object(s.a)(document).find("head"),n="<head>",a='<body style="padding:0; margin: 0; width: 100%; height: 100%; min-width: initial; min-height: auto;">',r=o.find(this.HEAD_PASSTHROUGH_SELECTOR),l=Object(s.a)('<iframe seamless style="width: 100%; height: 100%;"></iframe>'),c=Object(s.a)("<div></div>");if(!this.isInViewer||this.block&&this.block.model.get("use_iframe")||this.widget&&this.widget.use_iframe){this.isInViewer||v(l),r.each((function(){n+=this.outerHTML})),n+='<script src="https://unpkg.com/jquery@2.2.3/dist/jquery.min.js"><\/script>',n+="</head>",c.html(t),a+=c[0].innerHTML+"</body>";var h='<!DOCTYPE html><html style="width: 100%; height: 100%; min-width: initial; min-height: auto;">'+n+a+"</html>";return e.html(l),l[0].contentWindow.document.open(),l[0].contentWindow.document.write(h),l[0].contentWindow.document.close(),i(l.width(),l.height())}t=Object(s.a)(t),c.html(t),c.find("script").each((function(){var t;this.src&&this.text&&((t=document.createElement("script")).text=this.text,this.text="",Object(s.a)(t).insertAfter(Object(s.a)(this)))})),p()(e,c[0].innerHTML,{done:function(){return i(null,null)}}),e.css({"font-family":"initial","font-weight":"initial"})},loadNodeWithScripts:function(t,e,i){var o,n=Object(s.a)('<div id="fake"></div>'),r=[];n.html(e),(o=n.find("script")).each((function(){this.src&&this.text?(r.push({src:this.src}),r.push({text:this.text})):r.push({src:this.src,text:this.text})}));var l=a.a.find(r,(function(t){return!!t.src}));if(!r.length||!l||r<2)t.html(n[0].innerHTML);else{o.remove();var c=0;t.html(n[0].innerHTML),function e(){var s,o,n,a=r[c];if(!a)return i();c++;s=document.createElement("script");a.src&&(s.src=a.src);a.text&&(s.text=a.text);if(!a.src)return t[0].appendChild(s),e();a.src&&(s.onload=function(){clearInterval(o),e()},n=0,o=setInterval((function(){++n>10&&(s.onload=null,e())}),1e3),t[0].appendChild(s))}()}}}),g.Ecommerce=g.CodeInjection.extend({embed_type:"ecommerce"}),e.a=m},"6ouf":function(t,e,i){"use strict";var s=i("0KJJ");i.n(s).a},"6z1P":function(t,e,i){"use strict";var s=i("skB9");i.n(s).a},"7E8S":function(module,exports){module.exports={"template-constructor-control-text_autosize":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon text_autosize-icon" data-alt="Auto-size" data-alt-pos="left" data-alt-offset="2"></div>\n';return __p}}},"7TSX":function(module,exports){module.exports={"template-constructor-control-hotspot_add":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="icon noarrow"\n\t     data-alt="Add Pin"\n\t     data-alt-pos="left"\n\t     data-alt-offset="9"></div>\n\n';return __p}}},"896M":function(t,e,i){"use strict";var s=i("TxgR");i.n(s).a},"9Tqx":function(t,e,i){},AnuO:function(t,e,i){"use strict";i("xi34");var s=i("q1z7"),o=i.n(s),n=i("rFsW"),a=i("ZhWy"),r=i.n(a),l=i("OTSC");function c(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function h(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var d=o.a.View.extend({TEMPLATES:{404:"template-common-404","mag-suspended":"template-common-mag-suspended","user-suspended":"template-common-user-suspended","domain-error":"template-common-domain-errors"},initialize:function(t){n.a.bindAll(this),n.a.extend(this,t),this.router=this.router||RM.homepageRouter||RM.collectorRouter||RM.constructorRouter,this.template=r.a[this.TEMPLATES[this.type]],this.setElement(this.$container)},render:function(){return this.$el.html(this.template(function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?c(i,!0).forEach((function(e){h(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):c(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},this.templateData,{Constants:l.a}))),this.postRenderTasks(),this},postRenderTasks:function(){switch(this.type){case"domain-error":n.a.delay(n.a.bind((function(){this.$(".domain-errors").addClass("show-elements")}),this),1e3)}}});e.a=d},BrCd:function(module,exports){module.exports={"template-viewer-cart-sidebar":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n  <div id="cart-sidebar" class="cart-sidebar">\n    <div class="close-button" data-alt="Close cart" data-alt-pos="bottom" data-alt-offset="9">\n      <div class="line-1"></div>\n      <div class="line-3"></div>\n    </div>\n\n    <div class="cart-sidebar-wrapper">\n      <div class="cart-sidebar-tabs">\n\n        <div class="cart-sidebar-tab tab-items active">\n          <div class="sidebar-header">\n            <div class="sidebar-title">\n              Cart\n            </div>\n            <div class="sidebar-btn go-forward" data-tab="tab-inputs">\n              Check out\n              <img class="btn-icon-right svg" src="https://cdn.readymag.com/6bfa1e36/dist/img/viewer/cart-sidebar/sidebar-right-arrow.svg" />\n            </div>\n          </div>\n\n          <div class="sidebar-body">\n            <div class="cart-items-list"></div>\n          </div>\n\n          <div class="empty-cart">\n            <div class="empty-cart-title">Cart is empty</div>\n          </div>\n        </div>\n\n        <div class="cart-sidebar-tab tab-inputs">\n          <div class="sidebar-header">\n            <div class="sidebar-btn go-back" data-tab="tab-items">\n                <img class="btn-icon-center svg" src="https://cdn.readymag.com/6bfa1e36/dist/img/viewer/cart-sidebar/sidebar-left-arrow.svg" />\n            </div>\n            <div class="sidebar-btn go-forward" data-tab="tab-order">\n              Summary\n              <img class="btn-icon-right svg" src="https://cdn.readymag.com/6bfa1e36/dist/img/viewer/cart-sidebar/sidebar-right-arrow.svg" />\n            </div>\n          </div>\n          <div class="sidebar-body">\n            <div class="order-details-form shipping-form">\n              <div class="form-title">Shipping address</div>\n              <div class="form-row">\n                <div class="form-error country-error hidden"></div>\n                <div class="countries-select"></div>\n              </div>\n              <div class="form-row">\n                <div class="form-error name-error hidden"></div>\n                <input type="text" class="form-input name-input" name="name" placeholder="Customer name" />\n              </div>\n              <div class="form-row">\n                <div class="form-error line1-error hidden"></div>\n                <input type="text" class="form-input line1-input" name="line1" placeholder="Address" />\n              </div>\n              <div class="form-row">\n                <input type="text" class="form-input line2-input" name="line2" placeholder="Apt, unit, building, floor" />\n              </div>\n              <div class="form-row">\n                <div class="form-error city-error hidden"></div>\n                <input type="text" class="form-input city-input" name="city" placeholder="City" />\n              </div>\n              <div class="form-row">\n                <input type="text" class="form-input state-input" name="state" placeholder="State/Region" />\n              </div>\n              <div class="form-row">\n                <input type="text" class="form-input postal_code-input" name="postal_code" placeholder="Zip/Postal code" />\n              </div>\n              <div class="form-row">\n                <div class="form-error phone-error hidden"></div>\n                <input type="text" class="form-input phone-input" name="phone" placeholder="Phone" />\n              </div>\n            </div>\n            <div class="order-details-form">\n              <div class="form-title">Email</div>\n              <div class="form-row">\n                <div class="form-error email-error hidden"></div>\n                <input type="text" class="form-input email-input" name="email" placeholder="address@sample.com" />\n              </div>\n            </div>\n            <div class="order-details-form">\n              <div class="form-title">Note</div>\n              <div class="form-row">\n                <textarea class="form-input note-input" rows="4" name="note" placeholder="Add shipping details"></textarea>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="cart-sidebar-tab tab-order">\n          <div class="sidebar-header">\n            <div class="sidebar-btn go-back" data-tab="tab-inputs">\n                <img class="btn-icon-center svg" src="https://cdn.readymag.com/6bfa1e36/dist/img/viewer/cart-sidebar/sidebar-left-arrow.svg" />\n            </div>\n            <div class="sidebar-btn go-forward cart-pay-btn hidden" data-tab="tab-checkout">\n              Pay\n              <img class="btn-icon-right svg" src="https://cdn.readymag.com/6bfa1e36/dist/img/viewer/cart-sidebar/sidebar-right-arrow.svg" />\n            </div>\n            <div class="preloader">\n              <div class="svg-wrap">\n              <svg width="14px" height="26px" viewBox="0 0 14 26" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n                  <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">\n                      <g transform="translate(-1094.000000, -34.000000)" fill-rule="nonzero" stroke="#FFFFFF" stroke-width="2">\n                          <g transform="translate(1070.000000, 22.000000)">\n                              <path d="M25,37 C31.627417,37 37,31.627417 37,25 C37,18.372583 31.627417,13 25,13" id="Path"></path>\n                          </g>\n                      </g>\n                  </g>\n              </svg>\n              </div>\n            </div>\n          </div>\n\n          <div class="sidebar-body">\n            <div class="order-details">\n              <div class="order-items-block order-row">\n                <div class="order-title-row summary-title">Order summary</div>\n                <div class="order-items-list order-info-block"></div>\n              </div>\n              <div class="order-id-container order-row">\n                  <div class="order-title-row">Order ID</div>\n                  <div class="order-id order-info-block"></div>\n              </div>\n              <div class="shipping-details">\n                <div class="shipping-address order-row">\n                  <div class="order-title-row">Shipping address</div>\n                  <div class="order-shipping-address order-info-block"></div>\n                </div>\n                <div class="shipping-method order-row">\n                    <div class="order-title-row">Shipping method</div>\n                    <div class="order-shipping-method order-info-block"></div>\n                </div>\n              </div>\n              <div class="shipping-tax-size order-row">\n                <div class="order-title-row">Order tax</div>\n                <div class="order-tax order-info-block"></div>\n              </div>\n              <div class="shipping-email order-row hidden">\n                    <div class="order-title-row">Email</div>\n                    <div class="order-shipping-email order-info-block"></div>\n              </div>\n              <div class="shipping-phone order-row hidden">\n                    <div class="order-title-row">Phone</div>\n                    <div class="order-shipping-phone order-info-block"></div>\n              </div>\n              <div class="shipping-total-price order-row">\n                <div class="order-title-row">Grand total</div>\n                <div class="order-total-price order-info-block"></div>\n              </div>\n            </div>\n          </div>\n          <div class="order-error hidden">\n            <div class="order-error-container">\n              <div class="order-error-title">\n                Error\n              </div>\n              <div class="order-error-message">\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="cart-sidebar-tab tab-checkout">\n          <div class="sidebar-header">\n            <div class="sidebar-btn go-back" data-tab="tab-order">\n                <img class="btn-icon-center svg" src="https://cdn.readymag.com/6bfa1e36/dist/img/viewer/cart-sidebar/sidebar-left-arrow.svg" />\n            </div>\n            <div class="preloader">\n              <div class="svg-wrap">\n              <svg width="14px" height="26px" viewBox="0 0 14 26" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n                  <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">\n                      <g transform="translate(-1094.000000, -34.000000)" fill-rule="nonzero" stroke="#FFFFFF" stroke-width="2">\n                          <g transform="translate(1070.000000, 22.000000)">\n                              <path d="M25,37 C31.627417,37 37,31.627417 37,25 C37,18.372583 31.627417,13 25,13" id="Path"></path>\n                          </g>\n                      </g>\n                  </g>\n              </svg>\n              </div>\n            </div>\n          </div>\n\n          <div class="sidebar-body">\n            <div class="payment-title">Pay with card</div>\n            <form action="/charge" method="post" id="payment-form">\n              <div class="form-row">\n                <div class="form-error card-number-error hidden"></div>\n                <div id="card-number-element" class="payment-input">\n                </div>\n              </div>\n              <div class="form-row">\n                <div class="form-error card-expiry-error hidden"></div>\n                <div id="card-expiry-element" class="payment-input">\n                </div>\n              </div>\n              <div class="form-row">\n                <div class="form-error card-name-error hidden"></div>\n                <input type="text" class="payment-input card-name-input hidden" name="name" placeholder="Name on card" />\n              </div>\n              <div class="form-row">\n                <div class="form-error card-cvc-error hidden"></div>\n                <div id="card-cvc-element" class="payment-input">\n                </div>\n              </div>\n\n              \x3c!-- Used to display Element errors. --\x3e\n              <div id="card-number-errors" role="alert"></div>\n              <div id="card-expiry-errors" role="alert"></div>\n              <div id="card-name-errors" role="alert"></div>\n              <div id="card-cvc-errors" role="alert"></div>\n\n              <div id="payment-failed-msg">\n                <div class="failed-msg-content">\n                  <div class="error-icon">\n                    <svg width="4px" height="27px" viewBox="0 0 4 27" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n                      <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n                          <g transform="translate(-1010.000000, -261.000000)" fill="#FFFFFF" fill-rule="nonzero">\n                              <g transform="translate(1010.000000, 261.000000)">\n                                  <g>\n                                      <path d="M2,0 C3.05322259,-1.93473851e-16 3.90702819,0.853805605 3.90702819,1.90702819 C3.90702819,1.93727706 3.90630849,1.96752165 3.9048697,1.99773628 L3.04535404,20.0475651 C3.01996411,20.5807536 2.58027854,21 2.0464859,21 L1.9535141,21 C1.41972146,21 0.980035886,20.5807536 0.954645959,20.0475651 L0.0951302988,1.99773628 C0.045033609,0.945705789 0.857261433,0.0522551831 1.90929192,0.00215849327 C1.93950655,0.000719701408 1.96975113,5.55662667e-18 2,0 Z"></path>\n                                      <circle cx="2" cy="25" r="2"></circle>\n                                  </g>\n                              </g>\n                          </g>\n                      </g>\n                    </svg>\n                  </div>\n                  <div class="error-message"></div>\n                </div>\n              </div>\n\n              <button class="sidebar-btn cart-payment-btn">Pay</button>\n            </form>\n            <div id="payment-request-button"></div>\n            <div class="cart-cancel-btn">Cancel order</div>\n          </div>\n          <div id="payment-success-msg">\n            <div class="success-msg-content">\n              <div class="title">Payment completed</div>\n              <div class="description">Check your email for details</div>\n            </div>\n          </div>\n        </div>\n\n        <div class="sidebar-footer-mobile">\n          <img class="power-by-stripe svg" src="https://cdn.readymag.com/6bfa1e36/dist/img/viewer/cart-sidebar/powered_by_stripe.svg" />\n        </div>\n\n      </div>\n      <div class="sidebar-footer">\n        <img class="power-by-stripe svg" src="https://cdn.readymag.com/6bfa1e36/dist/img/viewer/cart-sidebar/powered_by_stripe.svg" />\n      </div>\n    </div>\n  </div>\n';return __p}}},CLR5:function(t,e,i){"use strict";var s=i("xi34"),o=i("OTSC"),n={model:{event:"change"},computed:{percent:function(){return Math.round(100*this.value)},gradientLeft:function(){return o.b.getRGBA(this.gradientColor,1)},gradientRight:function(){return o.b.getRGBA(this.gradientColor,0)}},watch:{value:function(t){t!=Object(s.a)(this.$el).data("opacity")&&Object(s.a)(this.$el).data("rmopacitydragChange")({opacity:t})}},props:{value:{type:Number,default:1},width:{type:Number,default:120},handleWidth:{type:Number,default:30},gradientColor:{type:String,default:"none"},gap:{type:Number,default:0}},mounted:function(){Object(s.a)(this.$el).rmOpacityDrag({opacity:this.value,onchange:this.onOpacityChange,onenddrag:this.onOpacityEndDrag,width:this.width,handleWidth:this.handleWidth,gap:this.gap}).data("rmopacitydrag-change")},methods:{opacityMouseEnter:function(){this.$emit("opacity-active",!0)},opacityMouseLeave:function(){this.$emit("opacity-active",!1)},onOpacityEndDrag:function(){this.$emit("opacity-active",!1)},onOpacityChange:function(t){Object(s.a)(this.$refs.handle).hasClass("opacity-dragging")&&this.$emit("opacity-active",!0),Math.abs(this.value-t)>.001&&this.$emit("change",t)}}},a=(i("2r+I"),i("KHd+")),r=Object(a.a)(n,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"rm-opacity-slider",style:{background:"linear-gradient(to right, "+this.gradientLeft+", "+this.gradientRight+")"},on:{mouseenter:this.opacityMouseEnter,mouseleave:this.opacityMouseLeave}},[e("div",{ref:"handle",staticClass:"opacity-handle"},[this._t("default")],2)])}),[],!1,null,null,null);e.a=r.exports},CXd4:function(module,exports){module.exports={"template-viewer-navigation":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="navigation">\n\t\t<div class="navigation-arrow left offscreen"><div class="icon sprite"></div></div>\n\t\t<div class="navigation-arrow right offscreen"><div class="icon sprite"></div></div>\n\t\t<div class="navigation-arrow bottom offscreen"><div class="icon sprite"></div></div>\n\t</div>\n\n';return __p}}},D12m:function(t,e,i){"use strict";var s=i("xi34"),o=i("rFsW"),n=function(){};n.prototype={text_viewport_attributes:["style","class","data-size-leading-linked","data-size-leading-ratio","data-anchor-link-pos"],switchTextToViewport:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0;if("default"===e)return t;var i=Object(s.a)("<div>").html(t),n=this.text_viewport_attributes,a=this;i.find("*").each((function(){var t=Object(s.a)(this);o.a.each(n,(function(i){var s=a.getViewportAttributeName(i,e),o=a.getViewportAttributeName(i,"default"),n=t.attr(s),r=t.attr(i);t.removeAttr(o),r&&t.attr(o,r),n&&("empty"===n?t.removeAttr(i):t.attr(i,n))}))}));var r=i.html();return i.empty().remove(),r},getViewportAttributeName:function(t,e){var i=t+"-"+e;return/^data/.test(i)||(i="data-"+i),i}},e.a=n},DA8H:function(module,exports){module.exports={"template-constructor-control-text_columns":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Columns" data-alt-pos="left" data-alt-offset="9"></div>\n\t<div class="panel">\n\t\t<div class="substract"></div>\n\t\t<div class="add"></div>\n\t\t<div class="number">1</div>\n\n\t\t<div class="separator"></div>\n\n\t\t<div class="bg-color" title="Background Color">\n\t\t\t<div class="color"></div>\n\t\t\t<div class="arrow-icon"></div>\n\t\t</div>\n\n\t\t<div class="gutter">\n\t\t\t<div class="grid"></div>\n\t\t\t<input class="gap" type="text" spellcheck="false" value="" title="Column Gap"/>\n\t\t</div>\n\n\t\t<div class="colorbox_container"></div>\n\t</div>\n';return __p}}},DJvK:function(t,e,i){},DiDd:function(module,exports){module.exports={"template-common-add-to-cart-wrap":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="add-to-cart-wrap">\n\t\t<div class="add-to-cart-attributes"></div>\n\t\t<div class="button-wrap">\n\t\t\t<div class="add-to-cart-button">\n\t\t\t\t<div class="add-to-cart-error-block"></div>\n\t\t\t\t<div class="button-icon"></div>\n\t\t\t\t<input type="text" class="button-text" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" readonly="readonly"/>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="sizes-calculating-block"></div>\n\t</div>\n';return __p}}},DqjY:function(t,e,i){"use strict";var s=i("xi34"),o=i("rFsW"),n=i("OTSC"),a=i("v92f"),r=i("wAEK"),l=i.n(r),c=100,h=1e4,d={STYLE_PREFIXES:{paragraph:{viewer:[".used-fonts-test p",".rmwidget.text div p"],editor:["p"],constructor:[".used-fonts-test p",".block.block-text .text-preview p",".controls .control.text_styles .panel .resizable-scroll-wrapper .resizable-content-wrapper .resizable-content .paragraph-style .style-caption"]},"header-h1":{viewer:[".used-fonts-test h1",".rmwidget.text div h1"],editor:["h1"],constructor:[".used-fonts-test h1",".block.block-text .text-preview h1",".controls .control.text_styles .panel .resizable-scroll-wrapper .resizable-content-wrapper .resizable-content .paragraph-style .style-caption"]},"header-h2":{viewer:[".used-fonts-test h2",".rmwidget.text div h2"],editor:["h2"],constructor:[".used-fonts-test h2",".block.block-text .text-preview h2",".controls .control.text_styles .panel .resizable-scroll-wrapper .resizable-content-wrapper .resizable-content .paragraph-style .style-caption"]},"header-h3":{viewer:[".used-fonts-test h3",".rmwidget.text div h3"],editor:["h3"],constructor:[".used-fonts-test h3",".block.block-text .text-preview h3",".controls .control.text_styles .panel .resizable-scroll-wrapper .resizable-content-wrapper .resizable-content .paragraph-style .style-caption"]},"header-h4":{viewer:[".used-fonts-test h4",".rmwidget.text div h4"],editor:["h4"],constructor:[".used-fonts-test h4",".block.block-text .text-preview h4",".controls .control.text_styles .panel .resizable-scroll-wrapper .resizable-content-wrapper .resizable-content .paragraph-style .style-caption"]},link:{viewer:[".rmwidget.text div a"],editor:["a"],constructor:[".block.block-text .text-preview a",".controls .control.text_link .panel .resizable-scroll-wrapper .resizable-content-wrapper .resizable-content .link-style .style-caption"]}},generateStylesStr:function(t){var e,i,s,o="",a=t.style,r=t.indentation?"\t":"",l=";"+(t.lineBreaks?"\n":""),c=t.attrPrefix||"";return"paragraph"==t.tp&&(o+=r+"font-family: "+h("font-family")+l,o+=r+"font-style: "+h("font-style")+l,o+=r+"font-weight: "+h("font-weight")+l,o+=r+"font-size: "+d(h("font-size"))+l,o+=r+"letter-spacing: "+d(h("letter-spacing"))+l,o+=r+"line-height: "+d(h("line-height"))+l,o+=r+"text-align: "+h("text-align")+l,o+=r+"text-decoration: "+h("text-decoration")+l,o+=r+"text-transform: "+h("text-transform")+l,o+=r+"color: "+n.b.getRGBA(h("color"),h("opacity")/100)+l,o+=r+"padding-top: "+d(h("padding-top"))+l,o+=r+"padding-right: "+d(h("padding-right"))+l,o+=r+"padding-bottom: "+d(h("padding-bottom"))+l,o+=r+"padding-left: "+d(h("padding-left"))+l),"link"==t.tp&&(o+=r+"text-decoration: none"+l,o+=r+"color: "+n.b.getRGBA(h("color"),h("opacity")/100)+l,"none"!=h("u-style")?(e=n.b.getRGBA(h("u-color"),h("u-opacity")/100),i=parseInt(h("u-size"),10),s=parseInt(h("u-offset"),10)+i,o+=r+"padding-bottom: "+d(Math.max(s,0))+l,"solid"==h("u-style")&&(o+=r+"background: linear-gradient(to right, "+e+" 0%, "+e+" 100%)"+l,o+=r+"background-size: 1px "+d(i)+l),"dotted"==h("u-style")&&(o+=r+"background: linear-gradient(to right, "+e+" 0%, "+e+" 50%, transparent 50%,transparent 100%)"+l,o+=r+"background-size: "+d(2*i)+" "+d(i)+l),"dashed"==h("u-style")&&(o+=r+"background: linear-gradient(to right, "+e+" 0%, "+e+" 66.6666%, transparent 66.6666%,transparent 100%)"+l,o+=r+"background-size: "+d(3*i)+" "+d(i)+l),o+=s<0?r+"background-position: 0 "+(100+s)+"%"+l:r+"background-position: 0 100%"+l,o+=r+"background-repeat: repeat-x"+l):o+=r+"background: none"+l),o;function h(t){var e=a[c+t];return"inherit"==e&&c&&(e=a[t]),e}function d(t){return t+(/px/i.test(t)?"":"px")}},generateCSS:function(t,e,i,a,r){if(a){var l=this.STYLE_PREFIXES[t][e],c=(r=r||{},this),h="";o.a.each(a,(function(i){if("paragraph"==t&&(i.tag&&"p"!==i.tag&&n.a.AVAILABLE_TEXT_TAGS.includes(i.tag)&&(l=[].concat(c.STYLE_PREFIXES["header-"+i.tag][e],c.STYLE_PREFIXES[t][e]).filter((function(t,e,i){return i.indexOf(t)===e}))),h+=o.a.map(l,(function(t){return t+"."+i._name})).join(",\n")+" {\n",h+=c.generateStylesStr({tp:t,style:i,indentation:!0,lineBreaks:!0}),h+="}\n\n"),"link"==t){if(r.forcePseudoState&&r.forcePseudoClass==i._name)h+=o.a.map(l,(function(t){return t+"."+i._name})).join(",\n")+" {\n",h+=c.generateStylesStr({tp:t,style:i,attrPrefix:r.forcePseudoState+"-",indentation:!0,lineBreaks:!0}),h+="}\n\n";else h+=o.a.map(l,(function(t){return t+"."+i._name})).join(",\n")+" {\n",h+=c.generateStylesStr({tp:t,style:i,indentation:!0,lineBreaks:!0}),h+="}\n\n",o.a.find(o.a.keys(i),(function(t){return/^current/.test(t)}))&&(h+=o.a.map(l,(function(t){return t+".current."+i._name})).join(",\n")+" {\n",h+=c.generateStylesStr({tp:t,style:i,attrPrefix:"current-",indentation:!0,lineBreaks:!0}),h+="}\n\n"),h+=o.a.map(l,(function(t){return t+".hovered."+i._name})).join(",\n")+" {\n",h+=c.generateStylesStr({tp:t,style:i,attrPrefix:"hover-",indentation:!0,lineBreaks:!0}),h+="}\n\n";h+=o.a.map(l,(function(t){return t+"."+i._name+" *"})).join(",\n")+" {\n",h+="\tcolor: inherit !important;\n",h+="\ttext-decoration: none !important;\n",h+="}\n\n"}})),i=i||document;var d="text_styles_"+t+"_"+e;Object(s.a)("#"+d,i).remove();var p=i.createElement("style");p.type="text/css",p.id=d,p.className="text_styles",p.appendChild(i.createTextNode(h)),i.getElementsByTagName("head")[0].appendChild(p)}},appendFontsCssToDocument:function(t,e){window.TypekitPreview&&window.TypekitPreview.setup&&window.TypekitPreview.setup({auth_id:n.a.TYPEKIT_ID,auth_token:n.a.TYPEKIT_TOKEN,default_subset:"all"});var i,a=Object(s.a)("link.fonts, style.fonts"),r=[],l=[],c={};a.each((function(){var t=Object(s.a)(this),e=t.attr("data-provider"),i=t.attr("data-fonts-and-variations").split("||");o.a.each(i,(function(t){r.push(e+"|"+t)}))})),o.a.each(t.fonts,(function(t){o.a.each(t.used_variations||t.variations,(function(e){l.push(t.provider+"|"+t.css_name+"|"+e)}))})),i=o.a.difference(l,r);var h={};o.a.each(i,(function(t){var e=t.split("|"),i=e[0],s=e[1],o=e[2],n=i+"|"+s;h[n]=h[n]||[],h[n].push(o)}));var d=[];o.a.each(h,(function(t,e){var i=e.split("|"),s=i[0],o=i[1],n=t;d.push({provider:s,css_name:o,variations:n})})),o.a.each(d,(function(e){var i,n=e.provider,a=e.css_name+"|"+e.variations.join("||"+e.css_name+"|");if(c[n]||(c[n]=[]),"google"==n){var r=s.a.map(e.variations,(function(t){return 100*(t.substr(1,1)-0)+("n"==t.substr(0,1)?"":"italic")}));i={fontAndVariations:a,data:e.css_name.split(" ").join("+")+":"+r.join(",")}}if("webtype"==n&&(i={fontAndVariations:a,data:e.css_name+":"+e.variations.join(",")}),"typetoday"==n&&(i={fontAndVariations:a,data:e.css_name+":"+e.variations.join(",")}),"custom"==n){var l=o.a.findWhere(t.fonts,{provider:"custom",css_name:e.css_name});l&&l.css_url&&(i={fontAndVariations:a,data:{css_name:e.css_name,css_url:l.css_url,signed_css_url:l.signed_css_url}})}"typekit"==n&&(i={fontAndVariations:a,data:{id:e.css_name,variations:e.variations}}),i&&c[n].push(i)}));var p=RM.screenshot&&"true"==n.b.queryUrlGetParam("pdf");p&&this.loadTypekitSubstitutionFonts(c.typekit);var u=o.a.has(c,"custom");function g(t){var e=Object(s.a)("<link>").attr("type","text/css").attr("rel","stylesheet").attr("href",t);Object(s.a)("head").append(e)}o.a.each(c,(function(i,a){var r,l,c,h,d,u,m="custom"==a?1:"google"==a?22:i.length,f=Math.ceil(i.length/m),v=0,b=function(){if(l=r*m,c=Math.min((r+1)*m,i.length),h=i.slice(l,c),d=o.a.pluck(h,"data"),u=o.a.pluck(h,"fontAndVariations"),Object(s.a)("link, style").addClass("existing"),"google"==a&&(w=(n.a.IS_FILE_PROTOCOL?"http://":"//")+"fonts.googleapis.com/css?family=",_=d.join("%7C"),"&subset=latin,vietnamese,khmer,cyrillic-ext,greek-ext,greek,devanagari,latin-ext,cyrillic",g(w+_+"&subset=latin,vietnamese,khmer,cyrillic-ext,greek-ext,greek,devanagari,latin-ext,cyrillic")),"typekit"==a){if("edit"==t.version&&!p)try{window.TypekitPreview&&window.TypekitPreview.load(d)}catch(t){}"published"==t.version&&t.typekit_url&&("undefined"!=typeof Typekit&&(Typekit=void 0),Object(s.a)("style.typekit-kit").remove(),s.a.getScript(t.typekit_url,(function(t,e,i){try{Typekit.load({active:function(){var t=Object(s.a)("style").filter((function(t,e){return/typekit/i.test(e.innerHTML)}));t.addClass("typekit-kit"),b(t)}})}catch(t){}})))}var f;function b(t){t.addClass("fonts").attr("data-id",n.b.generateUUID()).attr("data-provider",a).attr("data-fonts-and-variations",u.join("||"))}"webtype"==a&&(w=RM.common.isDownloadedSource?n.a.readymag_host:"",Object(s.a)('link.fonts[data-provider="webtype"]').length||(y=window.ServerData&&window.ServerData.fonts&&window.ServerData.fonts.webtype,g(w+y))),"typetoday"!=a||p||(w=RM.common.isDownloadedSource?n.a.readymag_host:"",Object(s.a)('link.fonts[data-provider="typetoday"]').length||(y=window.ServerData&&window.ServerData.fonts&&window.ServerData.fonts.typetoday,g(w+y))),"custom"==a&&(k=d[0].signed_css_url||d[0].css_url,/^\/api\/fonts\//i.test(k)?(f=Object(s.a)("<style>").attr("type","text/css"),Object(s.a)("head").append(f),s.a.get(k,(function(t){f.text(t),++v>=i.length&&o.a.isFunction(e)&&e()}))):g(k)),b(Object(s.a)("link:not(.existing), style:not(.existing)")),Object(s.a)("link, style").removeClass("existing")};for(r=0;r<f;r++){var _,w,y,k;b()}})),!u&&o.a.isFunction(e)&&e()},loadTypekitSubstitutionFonts:function(t){t&&t.length&&o.a.each(t,(function(t){var e,i=t.data.id,n=(t.data.variations,{"sans-serif":"news-gothic",decorative:"news-gothic",handmade:"news-gothic",blackletter:"news-gothic",script:"news-gothic","slab-serif":"news-gothic",serif:"georgia-pro",monospaced:"nitti"}),a="template-export-pdf-typekit-substitution-"+(n[(e=(e=(e=o.a.findWhere(d.fontsShortList.typekit,{id:i}))&&e.browse_info)&&e.classification)&&e.length&&e[0]||"sans-serif"]||n["sans-serif"]),r=(0,l.a[a])({id:i});Object(s.a)("head").append(r)}))},appendFontsCssToIFrame:function(t){var e=Object(s.a)("link.fonts, style.fonts"),i=Object(s.a)("link.fonts, style.fonts",t),o={},n=Object(s.a)("head",t);i.each((function(){o[Object(s.a)(this).attr("data-id")]=!0})),e.each((function(){var t=Object(s.a)(this),e=this.href;if(!o[t.attr("data-id")]){var i=t.clone();e&&Modernizr.safari&&i.attr("href",e+"&edit_mode=true"),i.appendTo(n)}}))},isFastFontLoadCheckAvailable:function(){return Boolean(document.fonts&&window.Promise)},fastWaitForFontLoad:function(t,e,i){var s;if(document.fonts){var o=i+" "+e+" 12px "+t,n=document.fonts.load(o).then(function(){return document.fonts.check(o)?o:this.fontLoadedTimeoutCheck(o)}.bind(this)),a=new window.Promise((function(t,e){setTimeout(e.bind(null,o),3500)}));s=window.Promise.race([n,a])}else s=window.Promise.reject();return s},exactWaitForFontLoad:function(t,e,i,o){var n=i+" "+e+" 12px "+t+", Arial",a=i+" "+e+" 12px Arial",r=20,l=20,d=Object(s.a)('<canvas width="'+r+'" height="'+l+'"></canvas>'),p=d[0],u=p.getContext("2d"),g="",m="",f=+new Date;d.appendTo("body").css({position:"absolute",left:0,top:"-999px"}),function s(){var v=+new Date-f>h,b=function(){var t=n;u.clearRect(0,0,r,l),g||(g=p.toDataURL("image/png"),t=a);u.font=t,u.fillStyle="000",u.fillText("a1-&q",0,20);var e=p.toDataURL("image/png");m||(m=e);return e!=g&&e!=m}();if(b||v)return u=void 0,d.remove(),void o(b,t,e,i);setTimeout(s,c)}()},fontLoadedTimeoutCheck:function(t){var e=Date.now();return new window.Promise((function(i,s){!function i(s,o){var n=Date.now()-e;document.fonts.check(t)?s(t):n<3500?setTimeout(i.bind(null,s,o),c):o(t)}(i,s)}))},getHotspotTextModels:function(t){var e=[];return t.widgets_collection&&t.widgets_collection.length&&(e=t.widgets_collection.filter((function(e){return"text"==e.get("type")&&t.get("wids").indexOf(e.get("_id"))>-1}))),t._nestedWidgetsJSON&&t._nestedWidgetsJSON.length?e=o.a.filter(t._nestedWidgetsJSON,(function(t){return"text"==t.type})):t.wids&&t.wids.length&&(e=o.a.filter(t.wids,(function(t){return"text"==t.type}))),e},getUsedFontsFromWidgetsModels:function(t){var e={},i={},s={},r={},l={},c={},h=t.models;function p(t,e){return"function"==typeof t.get?t.get(e):t[e]}for(var u=0;u<h.length;u++){var g=h[u];if("slideshow"==p(g,"type")&&p(g,"text_style")){var m=p(g,"text_style");m["font-family"]&&m["font-weight"]&&m["font-style"]&&(i[m["font-family"]+"|"+m["font-style"]+"|"+m["font-weight"]]=1)}if("button"==p(g,"type")){p(g,"font-family")&&p(g,"font-weight")&&p(g,"font-style")&&(s[p(g,"font-family")+"|"+p(g,"font-style")+"|"+p(g,"font-weight")]=1);for(var f=0;f<a.b.viewports.length;f++){var v=g["viewport_"+a.b.viewports[f].name];v&&(s[v["font-family"]+"|"+v["font-style"]+"|"+v["font-weight"]]=1)}}if(p(g,"type")===n.a.ecommerceCartBlockName&&p(g,"font-family")&&p(g,"font-weight")&&p(g,"font-style")&&(l[p(g,"font-family")+"|"+p(g,"font-style")+"|"+p(g,"font-weight")]=1),p(g,"type")===n.a.addToCartBlockName&&(p(g,"font-family")&&p(g,"font-weight")&&p(g,"font-style")&&(c[p(g,"font-family")+"|"+p(g,"font-style")+"|"+p(g,"font-weight")]=1),p(g,"attrs-font-family")&&p(g,"attrs-font-weight")&&p(g,"attrs-font-style")&&(c[p(g,"attrs-font-family")+"|"+p(g,"attrs-font-style")+"|"+p(g,"attrs-font-weight")]=1)),"form"==p(g,"type")){var b=p(g,"style-"+p(g,"style")+"-fields"),_=o.a.clone(p(g,"style-"+p(g,"style")+"-button-default"));o.a.isEmpty(_)||(_["font-family"]="inherit"==_["font-family"]?b["font-family"]:_["font-family"],_["font-style"]="inherit"==_["font-style"]?b["font-style"]:_["font-style"],_["font-weight"]="inherit"==_["font-weight"]?b["font-weight"]:_["font-weight"]),r[b["font-family"]+"|"+b["font-style"]+"|"+b["font-weight"]]=1,_&&(r[_["font-family"]+"|"+_["font-style"]+"|"+_["font-weight"]]=1);for(var w=0;w<a.b.viewports.length;w++){var y=g["viewport_"+a.b.viewports[w].name];y&&(b=y["style-"+y.style+"-fields"],_=o.a.clone(y["style-"+y.style+"-button-default"]),o.a.isEmpty(_)||(_["font-family"]="inherit"==_["font-family"]?b["font-family"]:_["font-family"],_["font-style"]="inherit"==_["font-style"]?b["font-style"]:_["font-style"],_["font-weight"]="inherit"==_["font-weight"]?b["font-weight"]:_["font-weight"]),b&&(r[b["font-family"]+"|"+b["font-style"]+"|"+b["font-weight"]]=1),_&&(r[_["font-family"]+"|"+_["font-style"]+"|"+_["font-weight"]]=1))}}"text"==p(g,"type")&&p(g,"text")&&o.a.extend(e,this.scanTextForFontsAndVariationsRaw(p(g,"text"),p(g,"version"),t.excludeUnusedDefault,t.activeViewports)),"hotspot"==p(g,"type")&&o.a.each(this.getHotspotTextModels(g),o.a.bind((function(i){var s=p(i,"text");s&&o.a.extend(e,this.scanTextForFontsAndVariationsRaw(s,p(i,"version"),t.excludeUnusedDefault))}),this))}var k=o.a.extend({},e,i,s,r,l,c),C={};o.a.each(k,(function(t,e){var i=e.split("|"),s=i[0],o=i[1].toLowerCase(),n=i[2].toLowerCase();C[s]=C[s]||[],C[s].push(("italic"===o?"i":"n")+Math.floor(n/100))}));var x,S=[],P=this;return o.a.each(C,(function(e,i){(x=o.a.findWhere(d.fontsShortList.webtype,{name:i}))?S.push({provider:"webtype",css_name:x.name,name:x.name,variations:x.variations,used_variations:P.calcBrowserUsedVariation(e,x.variations)}):(x=o.a.findWhere(d.fontsShortList.typetoday,{name:i}))?S.push({provider:"typetoday",css_name:x.name,name:x.name,variations:x.variations,used_variations:P.calcBrowserUsedVariation(e,x.variations)}):(x=o.a.findWhere(d.fontsShortList.google,{family:i}))?S.push({provider:"google",css_name:x.family,name:x.family,variations:x.variations,used_variations:P.calcBrowserUsedVariation(e,x.variations)}):(x=o.a.findWhere(d.fontsShortList.typekit,{id:i}))?S.push({provider:"typekit",css_name:x.id,name:x.name,variations:x.variations,used_variations:P.calcBrowserUsedVariation(e,x.variations)}):t.includeCustom&&(x=o.a.findWhere(t.customList,{css_name:i}))&&S.push({provider:"custom",css_name:x.css_name,css_url:x.css_url,name:x.name,variations:x.variations,used_variations:P.calcBrowserUsedVariation(e,x.variations)})})),S},getUsedParagraphStylesFromWidgetsModels:function(t){var e,i,s="";for(e=0;e<t.length;e++)"text"==l(i=t[e],"type")&&l(i,"text")&&(s+=l(i,"text")),"hotspot"==l(i,"type")&&o.a.each(this.getHotspotTextModels(i),o.a.bind((function(t){s+=l(t,"text")||""}),this));var n=[],a=RM.constructorRouter.workspace.mag.edit_params.get("paragraph_styles");if(s)for(e=0;e<a.length;e++){var r=a[e];s.indexOf(r._name)>=0&&n.push(r)}function l(t,e){return"function"==typeof t.get?t.get(e):t[e]}return n},getUsedLinkStylesFromWidgetsModels:function(t){var e,i,s="";for(e=0;e<t.length;e++)"text"==l(i=t[e],"type")&&l(i,"text")&&(s+=l(i,"text")),"hotspot"==l(i,"type")&&o.a.each(this.getHotspotTextModels(i),o.a.bind((function(t){s+=l(t,"text")||""}),this));var n=[],a=RM.constructorRouter.workspace.mag.edit_params.get("link_styles");if(s)for(e=0;e<a.length;e++){var r=a[e];s.indexOf(r._name)>=0&&n.push(r)}function l(t,e){return"function"==typeof t.get?t.get(e):t[e]}return n},scanTextForFontsAndVariationsRaw:function(t,e,i,n){var r,l,c,h,d,p,u,g,m,f,v={},b={},_=[],w=document.defaultView.getComputedStyle;for(r=0;r<a.b.viewports.length;r++)if(t.split("-"+a.b.viewports[r].name).length>1){if(n&&-1===n.indexOf(a.b.viewports[r].name))continue;_.push(a.b.viewports[r].name)}(c=Object(s.a)(".used-fonts-test")).length||(c=Object(s.a)("<div>").addClass("used-fonts-test").css({position:"absolute",display:"none !important",left:-9999,width:999}).appendTo("body")),c.removeClass("v1 v2").addClass("v"+(e||1)),(l=c[0]).innerHTML=t,p=(d=l.querySelectorAll("span,p,a")).length;var y,k=(h=w(l,null)).fontFamily+"|"+h.fontStyle+"|"+h.fontWeight;v[k]=1;for(var C=!1,x=function(t){return-1!==o.a.findIndex(t.childNodes,(function(t){return t.nodeType===Node.TEXT_NODE&&t.textContent.replace(/\r?\n/g,"").length}))},S=o.a.filter(d,x),P=0;P<S.length;P++)y=(h=w(S[P],null)).fontFamily+"|"+h.fontStyle+"|"+h.fontWeight,C=C||y===k,v[h.fontFamily+"|"+h.fontStyle+"|"+h.fontWeight]=1;var $=x(l);for(!i||C||$||delete v[k],r=0;r<_.length;r++)if("default"!=(m=_[r])){for(P=0;P<p;P++)(u=(f=d[P]).getAttribute("data-style-"+m))&&("empty"==u?f.removeAttribute("style"):f.setAttribute("style",u)),(g=f.getAttribute("data-class-"+m))&&("empty"==g?f.removeAttribute("class"):f.setAttribute("class",g)),(f.getAttribute("style")||f.getAttribute("class"))&&(v[(h=w(f,null)).fontFamily+"|"+h.fontStyle+"|"+h.fontWeight]=1);r<_.length-1&&(l.innerHTML=t,p=(d=l.querySelectorAll("span,p,a")).length)}return o.a.each(v,(function(t,e){var i=e.split("|"),s=i[0],o=i[1].toLowerCase(),n=i[2].toLowerCase();s=(s=s.split(",")[0]).replace(/'|"/g,""),n=(n=(n=n.replace(/normal/g,"400")).replace(/regular/g,"400")).replace(/bold/g,"700"),b[s+"|"+o+"|"+n]=1})),b},calcBrowserUsedVariation:function(t,e){for(var i={},s=0;s<t.length;s++){for(var n,a,r,l=t[s],c=l.substr(1,1),h=l.substr(0,1),d=99999,p="",u=0;u<e.length;u++)n=e[u].substr(1,1)-0,a=e[u].substr(0,1),c<4&&(r=10*Math.abs(n-c)+(a==h?0:1e3)+(n<=c?0:100)),c>5&&(r=10*Math.abs(n-c)+(a==h?0:1e3)+(n>=c?0:100)),4==c&&(r=5==n?0+(a==h?0:1e3)+0:10*Math.abs(n-c)+(a==h?0:1e3)+(n<=c?0:100)),5==c&&(r=10*Math.abs(n-c)+(a==h?0:1e3)+(n<=c?0:100)),c==n&&h==a&&(r=0),r<d&&(d=r,p=e[u]);i[p]=1}return o.a.keys(i)},getVeryShortList:function(t){var e={google:[],typekit:[],webtype:[],typetoday:[]};return o.a.each(t,(function(t){var i,s=t.provider;switch(s){case"google":i={provider:s,family:t.name,variations:t.variations};break;case"typekit":i={provider:s,id:t.css_name,name:t.name,variations:t.variations};break;case"webtype":case"typetoday":i={provider:s,name:t.name,variations:t.variations}}e[s]&&e[s].push(i)})),e},getCustomVariationNameByFVD:function(t,e){return(d.fontCustomVariationNames[t]||{})[e]},setShortList:function(t){d.fontsShortList=t,d.fontCustomVariationNames={},o.a.each(d.fontsShortList,(function(t,e){o.a.each(t,(function(t){if(t.custom_variation_names){var i;switch(e){case"google":i=t.family;break;case"typekit":case"webtype":case"typetoday":i=t.name}d.fontCustomVariationNames[i]=t.custom_variation_names}}))}))}};window.fontsShortListCallback=function(t){d.setShortList(t)},e.a=d},E913:function(t,e,i){},EYyZ:function(module,exports){module.exports={"template-constructor-control-picture_1x1":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow"data-alt="Actual size" data-alt-pos="left" data-alt-offset="43"></div>\n\t<div class="icon1x2 noarrow"data-alt="Half size" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t</div>\n\n';return __p}}},EvVy:function(t,e,i){"use strict";var s=i("4BoS");i.n(s).a},"F+PN":function(t,e,i){"use strict";var s=i("j/3K");i.n(s).a},Fts9:function(t,e,i){"use strict";var s=i("xi34"),o=i("q1z7"),n=i.n(o),a=i("rFsW"),r=i("u1Rx"),l=i.n(r),c=i("Fi5S"),h=i("Vxjr"),d=n.a.View.extend({name:"Colorbox",settings_vertical:{width:168,height:240,bottom_panel_height:72,hue_width:0,hue_width_opened:0,hue_height:24,color:"6CD632",opacity:1,swatches_max:60,swatches_min:10,favourites_max:6,favourites_per_line:3,swatches_per_line:5,fav_switch_speed:300,show_opacity:!1},settings_big:{width:208,height:240,bottom_panel_height:40,hue_width:9,hue_width_opened:20,color:"6CD632",opacity:1,swatches_max:60,swatches_min:10,favourites_max:6,favourites_per_line:3,swatches_per_line:5,fav_switch_speed:300,show_opacity:!1},settings_small:{width:152,height:240,bottom_panel_height:96,hue_width:9,hue_width_opened:16,color:"6CD632",opacity:1,swatches_max:60,swatches_min:15,favourites_max:6,favourites_per_line:3,swatches_per_line:5,fav_switch_speed:300,show_opacity:!0},initialize:function(t){this.model=RM.constructorRouter.mag.edit_params,this.colorDragData={},this.scrollDragData={},this.scrollData={height:0,percent:0,container_h:0,inner_h:0},this.settings={},this.RGB=[],this.HSB=[],this.section="color",a.a.bindAll(this),this["settings_"+t.type]?a.a.extend(this.settings,this["settings_"+t.type]):a.a.extend(this.settings,this.settings_big),a.a.extend(this.settings,t),"string"==typeof this.settings.color&&6==this.settings.color.length||(console.log("Error, wrong color set to colorbox: ",this.settings.color),this.settings.color=this.settings_big.color),this.RGB=this.hex2rgb(this.settings.color),this.HSB=this.rgb2hsb(this.RGB),this.settings.map_width=this.settings.width-("vertical"!=t.type?this.settings.hue_width:0),this.settings.map_height=this.settings.height-this.settings.bottom_panel_height,this.settings.hue_height=this.settings.hue_height||this.settings.height,this.settings.placeholdes_height=this.settings.map_height-22,"small"==this.settings.type&&(this.settings.placeholdes_height=166),this.template=l.a["template-constructor-helpers-colorbox"],this.create()},create:function(){this.favourites=this.model&&a.a.clone(this.model.get("fav_colors")),this.swatches=this.model&&a.a.clone(this.model.get("swatches")),this.render(),this.model&&this.model.attributes.colorbox_state&&this.section!==this.model.attributes.colorbox_state&&this.switchBetweenSwatchesAndColorsBridge(),!this.model||this.favourites.length||this.swatches.length||"swatches"!==this.section||this.switchBetweenSwatchesAndColorsBridge()},render:function(){if(Object(h.a)("colorbox"),this.setElement(Object(s.a)(this.template(this.settings)).appendTo(this.settings.$parent).addClass("rmcolorbox-type-"+this.settings.type)),this.$rmcolorbox_swatches_placeholdes=this.$(".rmcolorbox-swatches-placeholdes"),this.$rmcolorbox_swatches_placeholdes_wrapper=this.$(".rmcolorbox-swatches-placeholdes-wrapper"),this.$rmcolorbox_swatches_colors=this.$(".rmcolorbox-swatches-colors"),this.$rmcolorbox_swatches=this.$(".rmcolorbox-swatches"),this.$swatches_button=this.$(".rmcolorbox-swatches-button"),this.$add_to_swatches_button=this.$(".rmcolorbox-add-to-swatches-button"),this.$remove_from_swatches_button=this.$(".rmcolorbox-remove-from-swatches-button"),this.model||(this.$rmcolorbox_swatches.remove(),this.$swatches_button.remove(),this.$add_to_swatches_button.remove()),this.$scroll_handle=this.$(".rmcolorbox-swatches-scroll-handle"),this.$map_block=this.$(".rmcolorbox-map"),this.$map_handle=this.$map_block.find(".rmcolorbox-map-handle"),this.map_ctx=this.$map_block.find("canvas")[0].getContext("2d"),this.$rmcolorbox_color=this.$(".rmcolorbox-color"),this.$animation_box=this.$(".rmcolorbox-animation-box"),this.$animation_canvas=this.$animation_box.find("canvas"),this.animation_ctx=this.$animation_canvas[0].getContext("2d"),this.$hue_block=this.$(".rmcolorbox-hue"),this.hue_ctx1=this.$hue_block.find(".rmcolorbox-hue-canvas1")[0].getContext("2d"),"vertical"!=this.settings.type?(this.hue_ctx2=this.$hue_block.find(".rmcolorbox-hue-canvas2")[0].getContext("2d"),this.map_under_arrow_ctx=this.$(".rmcolorbox-map-under-arrow canvas")[0].getContext("2d")):this.$hueLine=this.$(".hue-line"),this.$opacity_block=this.$(".rmcolorbox-opacity"),this.$opacity_handle=this.$(".rmcolorbox-opacity-handle"),this.$input_rgb=this.$(".rmcolorbox-rgb-block-input"),this.$input_r=this.$(".rmcolorbox-r-block-input"),this.$input_g=this.$(".rmcolorbox-g-block-input"),this.$input_b=this.$(".rmcolorbox-b-block-input"),this.$input_r_g_b=this.$input_r.add(this.$input_g).add(this.$input_b),this.$hue_block.RMDrag({start:this.startHueDrag,move:this.startHueDrag,end:this.stopHueDrag,silent:!0,preventDefault:!0}),this.$map_block.RMDrag({start:this.startMapDrag,move:this.startMapDrag,silent:!0,preventDefault:!0}),this.$opacity_block.RMDrag({start:this.startOpacityDrag,move:this.startOpacityDrag,end:this.stopOpacityDrag,silent:!0,preventDefault:!0}),this.$scroll_handle.RMDrag({start:this.startScrollDrag,move:this.moveScrollDrag,end:this.stopScrollDrag,silent:!0,preventDefault:!0}),this.$rmcolorbox_swatches_placeholdes_wrapper.mousewheel(this.onScrollMouseWheel),this.$input_rgb.on("paste",this.rgbPaste).on("keyup keydown",this.rgbKeyPressed).on("blur",this.rgbBlur).on("focus",this.rgbFocus),this.$input_r_g_b.on("keyup keydown",this.r_g_bKeyPressed).on("blur",this.r_g_bBlur).on("focus",this.r_g_bFocus),this.$swatches_button.on("click",this.switchBetweenSwatchesAndColors),this.$add_to_swatches_button.on("click",this.addToSwatches),this.$remove_from_swatches_button.on("click",this.deleteColor),this.changeColor(void 0,void 0,void 0,!0),this.favourites&&this.swatches&&this.createFSPlaceholdes(!0),"small"===this.settings.type&&this.setOpacity(this.settings.opacity),this.favourites)for(var t=0;t<this.favourites.length;t++)this.favourites[t]&&this.addFavouritesColor(t,!0);if(this.swatches)for(t=0;t<this.swatches.length;t++)this.swatches[t]&&this.addSwatchesColor(t,!0);this.model&&this.model.on("change:swatches",this.onModelSwatchesChange),this.model&&this.model.on("change:fav_colors",this.onModelFavouritesChange),c.a.on("panel:showed",this.setCurrentSelectedColor)},onModelSwatchesChange:function(t,e){if(this.thisModelChangeInitiator)this.thisModelChangeInitiator=!1;else{this.thisModelChangeInitiator=!1,this.swatches=a.a.clone(e),this.createFSPlaceholdes(!0),this.$rmcolorbox_swatches_colors.find(".rmcolorbox-swatches-color-small").remove();for(var i=0;i<this.swatches.length;i++)this.swatches[i]&&this.addSwatchesColor(i,!0);this.$remove_from_swatches_button.removeClass("active")}},onModelFavouritesChange:function(t,e){if(this.thisModelChangeInitiator)this.thisModelChangeInitiator=!1;else{this.thisModelChangeInitiator=!1,this.favourites=a.a.clone(e),this.$rmcolorbox_swatches_colors.find(".rmcolorbox-swatches-color-big").remove();for(var i=0;i<this.favourites.length;i++)this.favourites[i]&&this.addFavouritesColor(i,!0);this.$remove_from_swatches_button.removeClass("active")}},toggleOpacity:function(t){this.$el.toggleClass("without-opacity",!t)},onSwatchesChange:function(){this.thisModelChangeInitiator=!0,this.model.save({swatches:a.a.clone(this.swatches)})},onFavouritesChange:function(){this.thisModelChangeInitiator=!0,this.model.save({fav_colors:a.a.clone(this.favourites)})},changeColor:function(t,e,i,s){s&&!t&&(t=this.HSB),s&&!e&&(e=this.RGB),"hue"==i||"sb"==i?e=this.hsb2rgb(t):t=this.rgb2hsb(e),(t[0]!=this.HSB[0]||s)&&(this.fillHue(t[0]),this.fillMap(t[0])),(t[1]!=this.HSB[1]||t[2]!=this.HSB[2]||s)&&this.$map_handle.css({left:Math.round(this.settings.map_width*t[1]/100)+"px",top:Math.round(this.settings.map_height*(100-t[2])/100)+"px"}),(e[0]!=this.RGB[0]||e[1]!=this.RGB[1]||e[2]!=this.RGB[2]||s)&&("input-rgb"!=i&&(this.$input_rgb.val(this.rgb2hex(e)),this.setInputSize(this.$input_rgb)),"vertical"!=this.settings.type&&("input-r"!=i&&(this.$input_r.val(e[0]),this.setInputSize(this.$input_r)),"input-g"!=i&&(this.$input_g.val(e[1]),this.setInputSize(this.$input_g)),"input-b"!=i&&(this.$input_b.val(e[2]),this.setInputSize(this.$input_b)))),e[0]==this.RGB[0]&&e[1]==this.RGB[1]&&e[2]==this.RGB[2]||"swatches"==i||this.unSelectColor();var o=!1;e[0]==this.RGB[0]&&e[1]==this.RGB[1]&&e[2]==this.RGB[2]&&"swatches"!=i||s||(o=!0),this.$opacity_block.css("background-color","#"+this.rgb2hex(e)),this.HSB=t,this.RGB=e,o&&this.trigger("colorchange",e[0],e[1],e[2],this.settings.opacity)},setColor:function(t){(t=this.hex2rgb(t))[0]==this.RGB[0]&&t[1]==this.RGB[1]&&t[2]==this.RGB[2]||this.changeColor(void 0,t,void 0,!0)},fillHue:function(t){if("vertical"==this.settings.type){for(var e=this.hue_ctx1.getImageData(0,0,this.settings.width,this.settings.hue_height),i=0,s=0;s<this.settings.width;s++){for(var o=360*(1-s/this.settings.width),n=this.hsb2rgb([o,100,100]),a=0;a<this.settings.hue_height;a++)e.data[i+a*this.settings.width*4]=n[0],e.data[i+1+a*this.settings.width*4]=n[1],e.data[i+2+a*this.settings.width*4]=n[2],e.data[i+3+a*this.settings.width*4]=255;i+=4}this.hue_ctx1.putImageData(e,0,0)}else{for(e=this.hue_ctx1.getImageData(0,0,this.settings.hue_width_opened-3,this.settings.hue_height),i=0,a=0;a<this.settings.hue_height;a++)for(o=360*(1-a/this.settings.hue_height),n=this.hsb2rgb([o,100,100]),s=0;s<this.settings.hue_width_opened-3;s++)e.data[i++]=n[0],e.data[i++]=n[1],e.data[i++]=n[2],e.data[i++]=255;this.hue_ctx1.putImageData(e,0,0),e=this.hue_ctx2.getImageData(0,0,3,this.settings.hue_height),i=0;for(a=0;a<this.settings.hue_height;a++)for(o=360*(1-a/this.settings.hue_height),n=this.hsb2rgb([o,100,100]),s=0;s<3;s++)e.data[i++]=n[0],e.data[i++]=n[1],e.data[i++]=n[2],e.data[i++]=255;for(var r=Math.round(this.settings.hue_height*(360-t)/360)-1,l=[1,1,2,1,2,3,2,1,1],c=[2,1,1,0,0,0,-1,-1,-2],h=0;h<l.length;h++)e.data[3*(r-c[h])*4+4*(3-l[h])+3]=0;this.hue_ctx2.putImageData(e,0,0)}},fillMap:function(t){for(var e=this.map_ctx.getImageData(0,0,this.settings.map_width,this.settings.map_height),i=0,s=this.hsb2rgb([t,100,100]),o=0;o<this.settings.map_height;o++)for(var n=1-o/(this.settings.map_height-1),a=[255*n,255*n,255*n],r=[s[0]*n,s[1]*n,s[2]*n],l=0;l<this.settings.map_width;l++)n=l/(this.settings.map_width-1),e.data[i++]=a[0]+(r[0]-a[0])*n,e.data[i++]=a[1]+(r[1]-a[1])*n,e.data[i++]=a[2]+(r[2]-a[2])*n,e.data[i++]=255;this.map_ctx.putImageData(e,0,0),this.fillMapUnderArrow(t),"vertical"==this.settings.type&&this.moveHueLine(t)},fillMapUnderArrow:function(t){if("vertical"!=this.settings.type){for(var e=this.map_under_arrow_ctx.getImageData(0,0,this.settings.hue_width,this.settings.map_height),i=0,s=0;s<this.settings.map_height;s++)for(var o=1-s/(this.settings.map_height-1),n=0;n<this.settings.hue_width;n++)e.data[i++]=255*o,e.data[i++]=255*o,e.data[i++]=255*o,e.data[i++]=255;this.map_under_arrow_ctx.putImageData(e,0,0)}},addToSwatches:function(t){t&&(t.stopPropagation(),t.preventDefault());for(var e=-1,i=-1,s=0;s<this.swatches.length;s++)this.swatches[s]?e=s:-1==i&&(i=s);if(e+1<this.settings.swatches_max)this.swatches[e+1]=this.rgb2hex(this.RGB),this.onSwatchesChange(),this.addSwatchesColor(e+1);else{if(!(i>=0))return;this.swatches[i]=this.rgb2hex(this.RGB),this.onSwatchesChange(),this.addSwatchesColor(i)}var o=this.$map_handle.position().left+this.$map_block.position().left,n=this.$map_handle.position().top+this.$map_block.position().top,a=this.$swatches_button.position().left+this.$swatches_button.width()/2,r=this.$swatches_button.position().top+this.$swatches_button.height()/2;this.$animation_box.removeClass("hidden");var l=Math.round(Math.sqrt(Math.pow(o-a,2)+Math.pow(n-r,2))),c=(a-o)/l,h=(r-n)/l,d="#"+this.rgb2hex(this.RGB),p=this.$animation_canvas.clone(),u=p[0].getContext("2d"),g=this;this.animation_ctx.clearRect(0,0,this.$animation_canvas[0].width,this.$animation_canvas[0].height),function t(e){if(e>l+25)return g.$animation_box.addClass("hidden"),void p.remove();u.clearRect(0,0,g.$animation_canvas[0].width,g.$animation_canvas[0].height),u.globalAlpha=.8,u.drawImage(g.$animation_canvas[0],0,0),g.animation_ctx.clearRect(0,0,g.$animation_canvas[0].width,g.$animation_canvas[0].height),g.animation_ctx.globalAlpha=1,g.animation_ctx.drawImage(p[0],0,0);e<=l&&function(t,e,i){g.animation_ctx.beginPath(),g.animation_ctx.arc(t,e,5.5,0,2*Math.PI,!0),g.animation_ctx.closePath(),g.animation_ctx.lineWidth=1.2,g.animation_ctx.strokeStyle="#fff",g.animation_ctx.fillStyle=i,g.animation_ctx.fill()}(o+c*e,n+h*e,d);setTimeout((function(){t(e+6)}),10)}(0)},switchBetweenSwatchesAndColors:function(t){t&&(t.stopPropagation(),t.preventDefault()),this.switchBetweenSwatchesAndColorsBridge(this.settings.fav_switch_speed),this.model&&this.model.attributes.colorbox_state!==this.section&&this.model.save({colorbox_state:this.section}),"swatches"==this.section&&this.setCurrentSelectedColor()},switchBetweenSwatchesAndColorsBridge:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.$swatches_button.toggleClass("active"),this.$rmcolorbox_color.fadeToggle(t),this.$rmcolorbox_swatches.fadeToggle(t),this.$add_to_swatches_button.fadeToggle(t),this.$remove_from_swatches_button.fadeToggle(t),this.$(".rmcolorbox-color-input-blocker").fadeToggle(t),this.$swatches_button.hasClass("active")?this.$swatches_button.attr("title","Hide Swatches"):this.$swatches_button.attr("title","Swatches"),this.section="color"==this.section?"swatches":"color"},rgbPaste:function(t){if((t=t&&t.originalEvent)&&t.clipboardData&&t.clipboardData.getData&&/text\/plain/.test(t.clipboardData.types)){var e=t.clipboardData.getData("text/plain");e.indexOf("#")+1&&(t.preventDefault(),document.execCommand("insertText",!1,e.substr(1)))}},rgbKeyPressed:function(t){this.setInputSize(Object(s.a)(t.currentTarget));var e=Object(s.a)(t.currentTarget).val();for(e=e.replace(/[^0-9a-fA-F]/g,"");e.length<6;)e="0"+e;var i=this.hex2rgb(e);this.changeColor(void 0,i,"input-rgb"),t&&"keydown"==t.type&&13==t.keyCode&&Object(s.a)(t.currentTarget).blur()},rgbFocus:function(){this.$(".rmcolorbox-rgb-block").addClass("editing")},rgbBlur:function(t){this.$(".rmcolorbox-rgb-block").removeClass("editing"),Object(s.a)(t.currentTarget).val(this.rgb2hex(this.RGB)),this.setInputSize(Object(s.a)(t.currentTarget))},r_g_bKeyPressed:function(t){this.setInputSize(Object(s.a)(t.currentTarget));var e=Object(s.a)(t.currentTarget).data("param"),i=Object(s.a)(t.currentTarget).val();if(i=i.replace(/[^0-9]/g,""),i=parseInt(i,10),i=Math.max(Math.min(i,255),0),isNaN(i)&&(i=0),"r"==e)var o=[i,this.RGB[1],this.RGB[2]];if("g"==e)o=[this.RGB[0],i,this.RGB[2]];if("b"==e)o=[this.RGB[0],this.RGB[1],i];if(this.changeColor(void 0,o,"input-"+e),t&&"keydown"==t.type&&(13==t.keyCode&&"r"==e&&(this.$input_r.blur(),this.$input_g.focus()),13==t.keyCode&&"g"==e&&(this.$input_g.blur(),this.$input_b.focus()),13==t.keyCode&&"b"==e&&this.$input_b.blur(),38==t.keyCode||40==t.keyCode)){t.preventDefault();var n=t.shiftKey?10:1;i+=38==t.keyCode?n:-n,i=Math.max(Math.min(i,255),0),Object(s.a)(t.currentTarget).val(i),t.keyCode=0,this.r_g_bKeyPressed(t)}},r_g_bFocus:function(){this.$(".rmcolorbox-r-g-b-block").addClass("editing")},r_g_bBlur:function(t){this.$(".rmcolorbox-r-g-b-block").removeClass("editing");var e=Object(s.a)(t.currentTarget).data("param");"r"==e&&Object(s.a)(t.currentTarget).val(this.RGB[0]),"g"==e&&Object(s.a)(t.currentTarget).val(this.RGB[1]),"b"==e&&Object(s.a)(t.currentTarget).val(this.RGB[2]),this.setInputSize(Object(s.a)(t.currentTarget))},setInputSize:function(t){var e=Object(s.a)('<div style="position:absolute; top:-999px; left:-999px; width:900px; height:200px" class="rmcolorbox"></div>').appendTo("body"),i=Object(s.a)('<div style="position:absolute; width:auto"></div>').appendTo(e);i[0].className=t[0].className,i.text(t.val()+"0"),t.width(i.width()),e.remove()},startHueDrag:function(t){if("color"==this.section||"vertical"==this.settings.type)if("vertical"==this.settings.type){var e=t.pageX-this.$hue_block.offset().left;e=Math.min(Math.max(e,0),this.settings.width-1),e=360-Math.round(360*e/(this.settings.width-1)),this.changeColor([e,this.HSB[1],this.HSB[2]],void 0,"hue"),this.$hue_block.addClass("dragging")}else e=t.pageY-this.$hue_block.offset().top,e=Math.min(Math.max(e,0),this.settings.hue_height-1),e=360-Math.round(360*e/(this.settings.hue_height-1)),this.changeColor([e,this.HSB[1],this.HSB[2]],void 0,"hue"),this.$hue_block.addClass("dragging")},stopHueDrag:function(t){this.$hue_block.removeClass("dragging")},moveHueLine:function(t){if("color"==this.section||"vertical"==this.settings.type){var e=t/360*this.settings.width;e=Math.max(Math.min(this.settings.width-2,e),-1),this.$hueLine.css({right:e})}},startMapDrag:function(t){var e=t.pageX-this.$map_block.offset().left;e=Math.min(Math.max(e,0),this.settings.map_width-1),e=Math.round(100*e/(this.settings.map_width-1));var i=t.pageY-this.$map_block.offset().top;i=Math.min(Math.max(i,0),this.settings.map_height-1),i=100-Math.round(100*i/(this.settings.map_height-1)),this.changeColor([this.HSB[0],e,i],void 0,"sb")},startOpacityDrag:function(t){var e=t.pageX-this.$opacity_block.offset().left,i=this.$opacity_block.width(),s=this.$opacity_handle.width()/2,o=s,n=i-s;(e=Math.min(Math.max(e,0),i-1))>n&&(e=n),e<o&&(e=o);var a=((e-o)/(n-o)).toFixed(2);this.$opacity_handle.css({left:e}),this.$opacity_handle.find(".rmcolorbox-opacity-val").text(Math.round(100*a)+"%").addClass("dragging"),Math.abs(this.settings.opacity-a)>.001&&this.trigger("opacitychange",this.RGB[0],this.RGB[1],this.RGB[2],a-0),this.settings.opacity=a-0},stopOpacityDrag:function(t){this.$opacity_handle.find(".rmcolorbox-opacity-val").removeClass("dragging")},setOpacity:function(t,e){var i=this.$opacity_block.width(),s=this.$opacity_handle.width()/2,o=(i-s-s)*t+s,n=this.$opacity_handle.find(".rmcolorbox-opacity-val");if(e){n.addClass("dragging");var a=this.$opacity_handle.position().left,r=this.settings.opacity;a!=o&&this.$opacity_handle.stop().animate({left:o},{duration:1200,step:function(e,i){var s=r+(e-a)/(o-a)*(t-r);n.text(Math.round(100*s)+"%")},complete:function(){n.removeClass("dragging")}})}else this.$opacity_handle.css({left:o}),n.text(Math.round(100*t)+"%");this.settings.opacity=t},getFavouritesCoords:function(t){if("small"==this.settings.type){var e=32,i=18;return[e+t%this.settings.favourites_per_line*44,i+40*Math.floor(t/this.settings.favourites_per_line)]}return"big"==this.settings.type?(i=25,[(e=46)+t%this.settings.favourites_per_line*58,i+52*Math.floor(t/this.settings.favourites_per_line)]):"vertical"==this.settings.type?(i=20,[(e=36)+t%this.settings.favourites_per_line*48,i+48*Math.floor(t/this.settings.favourites_per_line)]):void 0},getSwatchesCoords:function(t){if("small"==this.settings.type){var e=25,i=95;return[Math.floor(e+t%this.settings.swatches_per_line*25),i+27*Math.floor(t/this.settings.swatches_per_line)]}return"big"==this.settings.type?(e=38,i=126,[Math.floor(e+t%this.settings.swatches_per_line*33),i+35*Math.floor(t/this.settings.swatches_per_line)]):"vertical"==this.settings.type?(i=104,[(e=28)+t%this.settings.swatches_per_line*28,i+28*Math.floor(t/this.settings.swatches_per_line)]):void 0},addFavouritesColor:function(t,e){var i=this.favourites[t],o=this.getFavouritesCoords(t),n=Object(s.a)('<div data-tp="big" data-ind="'+t+'" class="rmcolorbox-swatches-color-big" style="background:#'+i+";left:"+o[0]+"px;top:"+o[1]+'px"></div>');return this.$rmcolorbox_swatches_colors.append(n),n.RMDrag({start:this.startColorDrag,move:this.moveColorDrag,end:this.endColorDrag,silent:!0,preventDefault:!0,threshold:3}),e||this.createFSPlaceholdes(),n},addSwatchesColor:function(t,e){var i=this.swatches[t],o=this.getSwatchesCoords(t),n=Object(s.a)('<div data-tp="small" data-ind="'+t+'" class="rmcolorbox-swatches-color-small" style="background:#'+i+";left:"+o[0]+"px;top:"+o[1]+'px"></div>');return this.$rmcolorbox_swatches_colors.append(n),n.RMDrag({start:this.startColorDrag,move:this.moveColorDrag,end:this.endColorDrag,silent:!0,preventDefault:!0,threshold:3}),e||this.createFSPlaceholdes(),n},startColorDrag:function(t){var e=Object(s.a)(t.currentTarget);e.removeClass("rmcolorbox-swatches-color-moving"),e.css("z-index",9999),this.colorDragData={$target:e,mx:t.pageX,my:t.pageY,cx:e.position().left,cy:e.position().top,left:e.width()/2+3,top:e.height()/2+3,right:this.$rmcolorbox_swatches_colors.width()-e.width()/2-3,bottom:this.$rmcolorbox_swatches_colors.height()-e.height()/2-4,container_top:this.$rmcolorbox_swatches_placeholdes_wrapper.offset().top,container_height:this.$rmcolorbox_swatches_placeholdes_wrapper.height(),orig_inner_top:this.$rmcolorbox_swatches_colors.position().top,cur_inner_top:this.$rmcolorbox_swatches_colors.position().top,wasMovement:!1,fillExEy:function(t,e){this.ex=this.cx+t-this.mx,this.ey=this.cy+e-this.my+(this.orig_inner_top-this.cur_inner_top),this.ex=Math.min(Math.max(this.ex,this.left),this.right),this.ey=Math.min(Math.max(this.ey,this.top),this.bottom)}}},moveColorDrag:function(t){this.colorDragData.wasMovement=!0,this.colorDragData.fillExEy(t.pageX,t.pageY),this.colorDragData.$target.css({left:this.colorDragData.ex+"px",top:this.colorDragData.ey+"px"}),this.checkAutoScroll(t.pageY)},checkAutoScroll:function(t){var e=t-this.colorDragData.container_top,i=this.colorDragData.container_top+this.colorDragData.container_height-t;e<20&&this.scrollBy(-2),i<20&&this.scrollBy(2),this.colorDragData.cur_inner_top=this.$rmcolorbox_swatches_colors.position().top},unSelectColor:function(){this.$rmcolorbox_swatches_colors.find(".rmcolorbox-swatches-color-big").removeClass("selected"),this.$rmcolorbox_swatches_colors.find(".rmcolorbox-swatches-color-small").removeClass("selected"),this.$remove_from_swatches_button.removeClass("active")},selectColor:function(t){if(this.$remove_from_swatches_button.addClass("active"),t.addClass("selected"),"small"==t.attr("data-tp"))var e=this.hex2rgb(this.swatches[t.attr("data-ind")]);"big"==t.attr("data-tp")&&(e=this.hex2rgb(this.favourites[t.attr("data-ind")])),this.changeColor(void 0,e,"swatches")},deleteColor:function(t){if(Object(s.a)(t.currentTarget).hasClass("active")){var e=this.$rmcolorbox_swatches_colors.find(".rmcolorbox-swatches-color-big.selected, .rmcolorbox-swatches-color-small.selected");if(1==e.length){e.addClass("rmcolorbox-swatches-color-removing");var i=this;setTimeout((function(){"small"==e.attr("data-tp")&&(i.swatches[e.attr("data-ind")]=void 0,i.onSwatchesChange()),"big"==e.attr("data-tp")&&(i.favourites[e.attr("data-ind")]=void 0,i.onFavouritesChange()),e.remove(),i.createFSPlaceholdes()}),300)}this.unSelectColor()}},endColorDrag:function(t){if(this.colorDragData.$target.css("z-index","auto"),!this.colorDragData.wasMovement){var e=this.colorDragData.$target.hasClass("selected");return this.unSelectColor(),void(e||this.selectColor(this.colorDragData.$target))}this.colorDragData.$target.addClass("rmcolorbox-swatches-color-moving"),this.colorDragData.fillExEy(t.pageX,t.pageY),this.colorDragData.$target.css({left:this.colorDragData.ex+"px",top:this.colorDragData.ey+"px"});for(var i=0;i<this.settings.favourites_max;i++){var s=this.getFavouritesCoords(i);if(Math.round(Math.sqrt(Math.pow(s[0]-this.colorDragData.ex,2)+Math.pow(s[1]-this.colorDragData.ey,2)))<=20)break}for(var o=0;o<this.settings.swatches_max;o++){s=this.getSwatchesCoords(o);if(Math.round(Math.sqrt(Math.pow(s[0]-this.colorDragData.ex,2)+Math.pow(s[1]-this.colorDragData.ey,2)))<=13)break}var n=this.colorDragData.$target.attr("data-tp"),a=this.colorDragData.$target.attr("data-ind"),r=n,l=a;i<this.settings.favourites_max&&(r="big",l=i),o<this.settings.swatches_max&&(r="small",l=o);var c=this.$rmcolorbox_swatches_placeholdes_wrapper.offset().top,h=this.$rmcolorbox_swatches_placeholdes_wrapper.offset().top+this.$rmcolorbox_swatches_placeholdes_wrapper.height();(t.pageY<c||t.pageY>=h)&&(r=n,l=a),this.moveColorToInd(this.colorDragData.$target[0],n,a,r,l)},moveColorToInd:function(t,e,i,o,n){if(e!=o||i!=n){if("big"==e)var a=this.$(".rmcolorbox-swatches-color-big[data-ind="+i+"]").removeClass("rmcolorbox-swatches-color-big"),r=this.getFavouritesCoords(i),l=this.favourites;else a=this.$(".rmcolorbox-swatches-color-small[data-ind="+i+"]").removeClass("rmcolorbox-swatches-color-small"),r=this.getSwatchesCoords(i),l=this.swatches;if("big"==o)var c=this.$(".rmcolorbox-swatches-color-big[data-ind="+n+"]").removeClass("rmcolorbox-swatches-color-big"),h=this.getFavouritesCoords(n),d=this.favourites;else c=this.$(".rmcolorbox-swatches-color-small[data-ind="+n+"]").removeClass("rmcolorbox-swatches-color-small"),h=this.getSwatchesCoords(n),d=this.swatches;a.css({left:h[0]+"px",top:h[1]+"px"}).addClass("rmcolorbox-swatches-color-"+o).addClass("rmcolorbox-swatches-color-moving").attr("data-tp",o).attr("data-ind",n),c.css({left:r[0]+"px",top:r[1]+"px"}).addClass("rmcolorbox-swatches-color-"+e).addClass("rmcolorbox-swatches-color-moving").attr("data-tp",e).attr("data-ind",i);var p=d[n];d[n]=l[i],l[i]=p,l!=this.favourites&&d!=this.favourites||this.onFavouritesChange(),l!=this.swatches&&d!=this.swatches||this.onSwatchesChange(),this.createFSPlaceholdes()}else{if("big"==e)var u=this.getFavouritesCoords(i);if("small"==e)u=this.getSwatchesCoords(i);Object(s.a)(t).css({left:u[0]+"px",top:u[1]+"px"})}},createFSPlaceholdes:function(t){this.$rmcolorbox_swatches_placeholdes.empty();for(var e=0;e<this.settings.favourites_max;e++){var i=this.getFavouritesCoords(e);this.$rmcolorbox_swatches_placeholdes.append('<div class="rmcolorbox-swatches-placeholder-big" style="left:'+i[0]+"px;top:"+i[1]+'px"></div>')}var s=0;for(e=0;e<this.swatches.length;e++)this.swatches[e]&&(s=e);s+=this.settings.swatches_per_line,s=Math.max(Math.min(s,this.settings.swatches_max-1),this.settings.swatches_min-1),s=Math.floor(s/this.settings.swatches_per_line)*this.settings.swatches_per_line+this.settings.swatches_per_line;var o=0;for(e=0;e<s;e++)(i=this.getSwatchesCoords(e))[1]>o&&(o=i[1]),this.$rmcolorbox_swatches_placeholdes.append('<div class="rmcolorbox-swatches-placeholder-small" style="left:'+i[0]+"px;top:"+i[1]+'px"></div>');var n=this.$rmcolorbox_swatches_colors.height(),a=o+("vertical"!=this.settings.type?17:14);this.$rmcolorbox_swatches_placeholdes.height(a),this.$rmcolorbox_swatches_colors.height(a),a!=n&&this.recalcScrollhandle(t)},recalcScrollhandle:function(t){this.scrollData.container_h=this.$rmcolorbox_swatches_placeholdes_wrapper.height(),this.scrollData.inner_h=this.$rmcolorbox_swatches_colors.height(),this.$scroll_handle.toggleClass("hidden",this.scrollData.inner_h<=this.scrollData.container_h),this.scrollData.height=this.scrollData.container_h/2*(this.scrollData.container_h/this.scrollData.inner_h),this.scrollData.height=Math.max(this.scrollData.height,20)+2,this.scrollTo(t?0:1,!0)},scrollTo:function(t,e,i){i=i||300,t=Math.max(Math.min(t,1),0),this.scrollData.percent=t;var s=t*(this.scrollData.container_h-this.scrollData.height),o=-t*(this.scrollData.inner_h-this.scrollData.container_h);e?(this.$scroll_handle.stop().animate({top:s+"px",height:this.scrollData.height-2+"px"},i,"linear"),this.$rmcolorbox_swatches_colors.stop().animate({top:o+"px"},i,"linear"),this.$rmcolorbox_swatches_placeholdes.stop().animate({top:o+"px"},i,"linear")):(this.$scroll_handle.css({top:s+"px",height:this.scrollData.height-2+"px"}),this.$rmcolorbox_swatches_colors.css("top",o+"px"),this.$rmcolorbox_swatches_placeholdes.css("top",o+"px"))},scrollBy:function(t,e,i){if(!(this.scrollData.inner_h<=this.scrollData.container_h)){var s=1/(this.scrollData.inner_h-this.scrollData.container_h);this.scrollTo(this.scrollData.percent+s*t,e,i)}},onScrollMouseWheel:function(t,e){return t.preventDefault(),this.scrollBy(-e/4,!0,250),!1},startScrollDrag:function(t){var e=Object(s.a)(t.currentTarget);e.addClass("dragging"),this.scrollDragData={$target:e,my:t.pageY,cy:e.position().top,top:0,bottom:this.scrollData.container_h-this.scrollData.height-2,fillEy:function(t){this.ey=this.cy+t-this.my,this.ey=Math.min(Math.max(this.ey,this.top),this.bottom),this.percent=(this.ey-this.top)/(this.bottom-this.top)}}},moveScrollDrag:function(t){this.scrollDragData.fillEy(t.pageY),this.scrollTo(this.scrollDragData.percent,!1)},stopScrollDrag:function(t){this.scrollDragData.$target.removeClass("dragging")},destroy:function(){this.model&&this.model.off("change:swatches",this.onModelSwatchesChange),this.model&&this.model.off("change:fav_colors",this.onModelFavouritesChange),c.a.off("panel:showed",this.setCurrentSelectedColor),this.$el.remove()},areColorsClose:function(t,e){var i=this.rgb2hsb(t),s=this.rgb2hsb(e);return Math.abs(i[0]-s[0])<=5&&Math.abs(i[1]-s[1])<=33&&Math.abs(i[2]-s[2])<=5&&Math.abs(t[3]-e[3])<=.06},hex2rgb:function(t){return[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)]},rgb2hex:function(t){var e=t[0].toString(16),i=t[1].toString(16),s=t[2].toString(16);return(1==e.length?"0"+e:e)+(1==i.length?"0"+i:i)+(1==s.length?"0"+s:s)},hsb2rgb:function(t){var e,i,s,o,n,a,r,l,c=[t[0],t[1],t[2]];return c[0]%=360,0==c[2]?[0,0,0]:(c[1]/=100,c[2]/=100,c[0]/=60,o=Math.floor(c[0]),n=c[0]-o,a=c[2]*(1-c[1]),r=c[2]*(1-c[1]*n),l=c[2]*(1-c[1]*(1-n)),0==o?(e=c[2],i=l,s=a):1==o?(e=r,i=c[2],s=a):2==o?(e=a,i=c[2],s=l):3==o?(e=a,i=r,s=c[2]):4==o?(e=l,i=a,s=c[2]):5==o&&(e=c[2],i=a,s=r),[e=Math.floor(255*e),i=Math.floor(255*i),s=Math.floor(255*s)])},rgb2hsb:function(t){var e,i,s,o,n=[t[0],t[1],t[2]];return n[0]/=255,n[1]/=255,n[2]/=255,(e=Math.min(n[0],n[1],n[2]))==(o=Math.max(n[0],n[1],n[2]))?[180,0,100*o]:(i=n[0]==e?n[1]-n[2]:n[1]==e?n[2]-n[0]:n[0]-n[1],s=n[0]==e?3:n[1]==e?5:1,[Math.floor(60*(s-i/(o-e)))%360,Math.floor((o-e)/o*100),o=Math.floor(100*o)])},setCurrentSelectedColor:function(){var t=this.rgb2hex(this.RGB),e=this.favourites.indexOf(t),i=this.swatches.indexOf(t),s=null;e>-1&&(s=this.$rmcolorbox_swatches_colors.find(".rmcolorbox-swatches-color-big[data-ind='".concat(e,"']"))),i>-1&&(s=this.$rmcolorbox_swatches_colors.find(".rmcolorbox-swatches-color-small[data-ind='".concat(i,"']"))),s&&(this.$rmcolorbox_swatches_colors.find(".rmcolorbox-swatches-color-big").removeClass("selected"),this.$rmcolorbox_swatches_colors.find(".rmcolorbox-swatches-color-small").removeClass("selected"),s.addClass("selected"))}});e.a=d},"G3+Z":function(t,e,i){"use strict";
/*! @source http://purl.eligrey.com/github/RetargetMouseScroll/blob/master/
 *          RetargetMouseScroll.js
 */var s=["DOMMouseScroll","mousewheel"];e.a=function(t,e,i,o){t||(t=document),e||(e=window),"boolean"!=typeof i&&(i=!0);var n,a,r,l=function(t){!function(t,e,i,s){i&&(t.preventDefault?t.preventDefault():event.returnValue=!1);var o=t.detail||-t.wheelDelta/40;o*=19,"number"!=typeof s||isNaN(s)||(o*=s),e.scrollBy?e.scrollBy(0,o):e.scrollTop+=o}(t=t||window.event,e,i,o)};return(n=t.addEventListener)?(n.call(t,s[0],l,!1),n.call(t,s[1],l,!1)):(n=t.attachEvent)&&n.call(t,"on"+s[1],l),(a=t.removeEventListener)?r=function(){a.call(t,s[0],l,!1),a.call(t,s[1],l,!1)}:(a=t.detachEvent)&&(r=function(){a.call(t,"on"+s[1],l)}),{restore:r}}},G50q:function(module,exports){module.exports={"template-constructor-control-common_pack":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Group" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t</div>\n';return __p}}},Gc47:function(t,e,i){"use strict";var s=i("/Utn");i.n(s).a},GvkG:function(t,e,i){},Gw2y:function(module,exports){module.exports={"template-viewer-final-page":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="final-page offscreen hidden '+(null==(__t=isStickyVerticalViewer?"":"has-vertical-scroll")?"":__t)+'">\n\t\t<div class="final-page-wrapper tp-'+(null==(__t=tp)?"":_.escape(__t))+'">\n\t\t\t<div class="final-page-container">\n\n\t\t\t\t<div class="dop-container-text">\n\t\t\t\t\t<div class="main-container">\n\t\t\t\t\t\t<a class="made-with" href="'+(null==(__t=Constants.readymag_host)?"":__t)+'">Made with <div class="logo"></div></a>\n\t\t\t\t\t\t<p class="bottom-text">Design from scratch and publish online, immediately.</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="dop-container-join">\n\t\t\t\t\t\t<div class="join ljr-panel ">\n\t\t\t\t\t\t\t<div class="header"><span>Join</span> or <a href="/login/" class="link">Log in</a></div>\n\t\t\t\t\t\t\t<input autocapitalize="on"  autocorrect="off" required="required" class="fullname-input input-template for-validate"  maxlength="24" type="text"     spellcheck="false" value="" placeholder="Name" />\n\t\t\t\t\t\t\t<input autocapitalize="off" autocorrect="off" required="required" class="email-input input-template for-validate"     type="email"    spellcheck="false" value="" placeholder="Email" />\n\t\t\t\t\t\t\t<input autocapitalize="off" autocorrect="off" required="required" class="password-input input-template for-validate"  type="password" spellcheck="false" value="" placeholder="Password" />\n\n\t\t\t\t\t\t\t<div class="checkbox-container">\n\t\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t\t<input type="checkbox" class="terms-checkbox for-validate" required="required">\n\t\t\t\t\t\t\t\t\t<span class="checkmark"></span>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<p>I accept Readymag\n\t\t\t\t\t\t\t\t\t<a href="https://readymag.com/readymag/terms-and-privacy/" target="_blank">Terms & Privacy Policy</a>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t\t<div class="checkbox-container second">\n\t\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t\t<input type="checkbox" class="subscribe-checkbox">\n\t\t\t\t\t\t\t\t\t<span class="checkmark"></span>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<p>Keep me updated on new features</p>\n\t\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t\t<div class="go">Join</div>\n\n\t\t\t\t\t\t\t<div class="social-caption">Sign up with</div>\n\t\t\t\t\t\t\t<div class="social-auth" data-provider=\'facebook\'>\n\t\t\t\t\t\t\t\t<span class="icon"></span>\n\t\t\t\t\t\t\t\t<span class="buttonText">Facebook</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="social-auth" data-provider=\'google\'>\n\t\t\t\t\t\t\t\t<span class="icon"></span>\n\t\t\t\t\t\t\t\t<span class="buttonText">Google</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="error"></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="login ljr-panel hidden">\n            <div class="header"><a href="/join/" class="link">Join</a> or <span>Log in</span></div>\n\t\t\t\t\t\t<form method="post" action="/api/redirect" id="login_form">\n\t\t\t\t\t\t\t<input name="username" autocapitalize="off" autocorrect="off" required="required" class="email-input input-template"  autocomplete="on" type="email" spellcheck="false" value="" placeholder="Email"/>\n\t\t\t\t\t\t\t<input name="password" autocapitalize="off" autocorrect="off" required="required" class="password-input input-template" autocomplete="on"  type="password" spellcheck="false" value=""  placeholder="Password" />\n\t\t\t\t\t\t\t<input name="url" type="hidden" value="" />\n\t\t\t\t\t\t\t<div class="go">Log in</div>\n\t\t\t\t\t\t</form>\n            <div class="social-caption">Log in with</div>\n            <div class="social-auth" data-provider=\'facebook\'>\n              <span class="icon"></span>\n              <span class="buttonText">Facebook</span>\n            </div>\n            <div class="social-auth" data-provider=\'google\'>\n              <span class="icon"></span>\n              <span class="buttonText">Google</span>\n            </div>\n\t\t\t\t\t\t<a href="/recover/" class="link forgot">Forgot password?</a>\n\t\t\t\t\t\t<div class="error">Invalid email or password</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="recover ljr-panel hidden">\n\t\t\t\t\t\t<div class="header"><span>Reset password</span></div>\n\t\t\t\t\t\t<div class="wrapper">\n\t\t\t\t\t\t\t<input name="username" autocapitalize="off" autocorrect="off" required="required" class="email-input input-template"  autocomplete="on" type="email" spellcheck="false" value="" placeholder="Whats your email?"/>\n\t\t\t\t\t\t\t<div class="go">Submit</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="send-message">We sent a message to <span class="recover-email">emailaddress@gmail.com</span><br/>so you can set a new password.</div>\n\t\t\t\t\t\t<div class="go-back">Go back</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n';return __p}}},"H3/6":function(t,e,i){"use strict";var s=i("rFsW"),o={defaultType:"codeinjection",matchers:{instagram:[/^\s*<blockquote\s+class=.instagram-media.*<\/blockquote>\s*<script.*src=.*instagram.+>.*<\/script>\s*$/gi],pinterest:[/^\s*<a.*data-pin-do=.*<\/a>([\s\S]*<script.*src=.*pinterest.+>.*<\/script>)?\s*$/i],facebookvideo:[/^\s*<div\s+id=.fb-root.*<\/div>[\s\S]*<script>.*src.*facebook.*sdk.*<\/script>[\s\S]*<div\s+class=.fb-video.*<\/div>\s*$/i],readymag:[/^\s*<a\s+class=.rm-mag-embed.*<\/a>[\s\S]*<script.+id=.readymag-embed-init.+><\/script>\s*$/i],ecommerce:[/^\s*<form\s+action=.*method=.*POST.+>[\s\S]*<script.*src=.*stripe.+>.*<\/script>[\s\S]*<\/form>\s*$/gim,/^\s*(<!--.*-->)?[\s\S]*<script.*src=.*stripe.+>[\s\S]*<\/script>[\s\S]*(<!--.*-->)?[\s\S]*<button .*>.*<\/button>[\s\S]*<div .*>.*<\/div>[\s\S]*<script>.*stripe.*<\/script>\s*$/gim,/^\s*<div\s+id=.+>[\s\S]*<\/div>[\s\S]*<script[\s\S]*scriptUrl[\s\S]*shopifycdn[\s\S]*>*<\/script>.*$/gim,/^\s*<script\s+src=.*gumroad.+><\/script>[\s\S]*<div\s+class=.gumroad-product-embed.+>[\s\S]*<\/div>\s*$/gim,/^\s*<script\s+src=.*gumroad.+><\/script>[\s\S]*<a\s+class=.gumroad-button.+>[\s\S]*<\/a>\s*$/gim,/^\s*<div\s+class=.*ecwid.+><\/div>[\s\S]*<script.+ecwid.+>.*<\/script>[\s\S]*<script.*>.*xProduct.*<\/script>\s*$/gim],iframe:function(t){var e=(t=t||"").replace(/<!--[\s\S]*-->/gi,"");return/^\s*<iframe[\s\S]*>[\s\S]*<\/iframe>\s*$/i.test(e)}},matchCode:function(t,e){for(var i in t=(t||"").trim(),this.matchers){var o=this.matchers[i];if(s.a.isFunction(o))return o(t,e)?i:this.defaultType;for(var n in o){if(n=o[n],s.a.isFunction(n)){if(n(t,e))return i}else if(new RegExp(n.source,n.flags).test(t.replace(/\n/g,"")))return i}}return this.defaultType}};e.a=o},HIJs:function(module,exports){module.exports={"template-constructor-control-common_unpack":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Ungroup" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t</div>\n';return __p}}},HOx4:function(t,e,i){"use strict";var s=i("+EJ4");i.n(s).a},HlXo:function(module,exports){module.exports={"template-constructor-block-audio":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="player-wrapper"></div>\n\t<div class="overlay"></div>\n';return __p}}},Hp7M:function(t,e,i){},HuYI:function(module,exports){module.exports={"template-common-form-button":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="button">\n\t\t<div class="caption"></div>\n\t\t<svg class="error" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 34 26"><path d="M17 19.8c-1.4 0-2.6 1.1-2.6 2.6s1.1 2.6 2.6 2.6c1.4 0 2.6-1.1 2.6-2.6S18.4 19.8 17 19.8zM19 0.4h-4L15 17.4h4L19 0.4z"/></svg>\n\t\t<svg class="show-if-empty-submitted-text" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 34 26"><path d="M31.4 3C30.6 2.3 29.4 2.3 28.6 3l0 0L13.1 18.6l-7.8-7.8 0 0c-0.8-0.7-2-0.7-2.7 0 -0.8 0.8-0.8 2 0 2.7l0 0L13.1 24.1l0.4-0.4h0L31.4 5.8l0 0C32.1 5 32.1 3.8 31.4 3z"/></svg>\n\t</div>\n';return __p}}},HwMs:function(t,e,i){"use strict";var s=i("xi34"),o=i("q1z7"),n=i.n(o),a=i("rFsW"),r=i("OTSC"),l=i("roQd"),c=i("gobI"),h=i("m41J"),d=i("QNiq"),p=i("Kf/z");function u(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function g(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function m(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var f=n.a.View.extend({initialize:function(t){a.a.bindAll(this),a.a.extend(this,t);var e={};a.a.each(this.widgets,a.a.bind((function(t){if(t.hasAnimation()){var i=t.fixed_position||t.is_full_width||t.is_full_height||t.sticked?r.b.generateUUID():t.getAnimations()[0].UUID||r.b.generateUUID();e[i]=e[i]||[],e[i].push(t)}}),this)),this.animations=[];var i=!d.a.isDesktop||!Modernizr.safari||a.a.all(e,(function(t){return l.a.canBeAccelerated((a.a.isArray(t)?t:[t])[0].animation)}));a.a.each(e,function(t){this.addAnimation(t,{allowAccelerate:i})}.bind(this)),this.start.__debounced=a.a.debounce(this.start,300)},addAnimation:function(t,e){var i=this;e=e||{},t=a.a.isArray(t)?t:[t];var s=0;t[0].getAnimations().filter((function(t){return!l.a.isEmpty(t)})).map((function(o){var n=o.type;if(d.a.isDesktop||"hover"!==n||t[0].getAnimationTriggers(o.UUID).length){var a=t[0].animationObjects,r=a&&a.length?a[a.length-1].$el:void 0,l=new v[n]({page:i.page,widgets:t,rawAnimation:o,$container:r,allowAccelerate:e.allowAccelerate,isNested:s>0,$topmostContainer:0===s?r:a&&a.length?a[0].$el:r});i.animations.push(l),s++}}))},removeAnimation:function(t){this.animations=a.a.without(this.animations,t),t&&t.destroy()},start:function(){a.a.each(this.animations,(function(t){t.start()}))},stop:function(){a.a.each(this.animations,(function(t){t.stop()}))},resetStarted:function(){a.a.each(this.animations,(function(t){t.started=!1}))},onScroll:function(t){t=t||{},(this.page.mag.currentPage===this.page||t.forceApply)&&a.a.each(this.animations,(function(e){e.onScroll&&e.onScroll(t)}))},onResize:function(t){a.a.each(this.animations,(function(e){e.onResize(t)}))},updateTimelines:function(){a.a.each(this.animations,(function(t){t.createAnimationTimeline()}))},hasScaleUp:function(){return Boolean(a.a.find(this.animations,(function(t){return l.a.isScaleUp(t.animation)})))},destroy:function(){a.a.each(this.animations,(function(t){t.destroy()})),delete this.animations}}),v={},b=n.a.View.extend({className:"animation-container",initialize:function(t){a.a.bindAll(this),a.a.extend(this,t),a.a.each(this.widgets,a.a.bind((function(t){t.animationObj=this,t.animationObjects=[].concat(m(t.animationObjects||[]),[this])}),this)),this.isFixed=this.widgets[0].fixed_position,this.isFullwidth=this.widgets[0].is_full_width,this.isFullheight=this.widgets[0].is_full_height,this.isSticked=this.widgets[0].sticked,this.isAbove=this.widgets[0].is_above,this.playOnce=!this.page.mag.isPreview&&this.playOnce,this.$container=this.$container||(this.isFixed||this.isAbove?this.widgets[0].$fixedContainer:this.page.$content);var e=d.a.isDesktop||!Object(p.a)("viewer.no3dOnMobile");!this.isFixed&&!this.isAbove&&Modernizr.safari&&d.a.isDesktop&&this.page.mag.isStickyVerticalViewer&&l.a.isScaleUp(this.rawAnimation)&&(this.$wrapper=Object(s.a)('<div class="animation-wrapper '.concat(e?"force3d":"",'"/>')).appendTo(this.$container)),this.$el.appendTo(this.$wrapper?this.$wrapper:this.$container),this.createAnimationTimeline(t),this.onResize({updateAll:!0})},createAnimationTimeline:function(t){t=t||{},this.timeline&&this.timeline.destroy(),this.animation=l.a.getNormalizedAnimation(this.rawAnimation,this.isFixed,this.isFullwidth,this.isFullheight,this.page.scale),this.timeline=l.a.createAnimationTimeline({el:this.$el,steps:this.animation.steps,type:this.animation.type,force3d:t.allowAccelerate&&l.a.canBeAccelerated(this.animation)&&(d.a.isDesktop||!Object(p.a)("viewer.no3dOnMobile")),loop:l.a.normalizeLoopValue(this.animation.loop),animationTrigger:this.animation.trigger,selfTriggered:Boolean(a.a.intersection(this.animation.trigger,this.widgets.map((function(t){return t._id}))).length),screenshotMode:!!RM.screenshot})},start:function(){this.timeline&&this.paused&&(this.paused=!1,this.timeline.resume())},stop:function(){this.timeline&&this.timeline.active&&(this.isAbove||(this.paused=!0,this.timeline.pause()))},getAnimationContainer:function(){return this.$el},modifyWidgetPosition:function(t){return this.isFixed?(t.dimensions.left="50%",t.dimensions.top="50%",t.dimensions.right="",t.dimensions.bottom="",t.dimensions["margin-left"]=-t.dimensions.width/2,t.dimensions["margin-top"]=-t.dimensions.height/2):(t.dimensions.left-=this.bbox_css.left+(this.isNested?parseInt(this.$topmostContainer[0].style.left):0),t.dimensions.top-=this.bbox_css.top+(this.isNested?parseInt(this.$topmostContainer[0].style.top):0)),t},onResize:function(t){if((t=t||{}).updateAll||this.isFixed&&this.prevPageScale!==this.page.scale||this.isFullwidth||this.isFullheight||this.isSticked){var e,i={t:Number.POSITIVE_INFINITY,l:Number.POSITIVE_INFINITY,b:Number.NEGATIVE_INFINITY,r:Number.NEGATIVE_INFINITY,z:0};this.isFixed||this.isFullwidth||this.isFullheight||this.isSticked?this.bbox_css=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?u(i,!0).forEach((function(e){g(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):u(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},this.widgets[0].calcBoxStyle({calcBBox:!0}).dimensions,{},this.isNested?{left:0,top:0,"margin-left":0,"margin-top":0}:{}):(a.a.each(this.widgets,(function(t){e=t.calcBoxStyle({calcBBox:!0}).dimensions,i.t=Math.min(i.t,e.top),i.l=Math.min(i.l,e.left),i.b=Math.max(i.b,e.top+e.height),i.r=Math.max(i.r,e.left+e.width),i.z=Math.max(i.z,e["z-index"])}),this),this.bbox_css={left:this.isNested?0:i.l,top:this.isNested?0:i.t,width:i.r-i.l,height:i.b-i.t,"z-index":i.z}),this.$el.css(this.bbox_css)}this.innerContentTop=this.page.contentPosition.top/this.page.scale,this.innerContainerHeight=this.page.mag.getContainerSizeCached().height/this.page.scale,this.prevPageScale=this.page.scale},withTriggerOrElement:function(t){var e=this,i=a.a.compact(this.animation.trigger);i.length?i.forEach((function(i){e.page.mag.getWidgetById(i,e.page).then((function(i){i.rendered?t(i.$el):e.listenToOnce(i,"rendered",(function(){return t(i.$el)}))})).catch((function(){return t(e.$el)}))})):t(this.$el)},destroy:function(){this.stop(),this.timeline&&this.timeline.destroy(),this.remove()}});v.scroll=b.extend({onScroll:function(t){if(t=t||{},this.timeline&&(this.page.mag.currentPage===this.page&&!this.isAbove||t.forceApply)){var e=this.isAbove?t.scroll:Math.max(0,this.page.visibleWidgetsCoords.scrollTop||0);if(this.isFixed)this.timeline.seek(e);else{var i=this.animation.steps[0].start_point||"bottom",s=this.bbox_css.top+this.innerContentTop,o=s-this.innerContainerHeight,n={top:1,center:.5,bottom:0}[i]*(s-o)+o+this.animation.steps[0].start_offset||0,a={top:Math.min(0,this.bbox_css.top),center:Math.min(.5*this.innerContainerHeight,this.bbox_css.top),bottom:Math.min(this.innerContainerHeight,this.bbox_css.top)}[i];n<=0?this.timeline.seek(e/this.page.scale,a,this.bbox_css.top,this.page.scale):this.timeline.seek(Math.max(0,e-n*this.page.scale)/this.page.scale,a,this.bbox_css.top,this.page.scale)}}},onResize:function(){b.prototype.onResize.apply(this,arguments),this.onScroll()}}),v.load=b.extend({visibleHeightPortion:.2,initialize:function(){b.prototype.initialize.apply(this,arguments);var t=this.animation.steps;this.startWhenInView=t&&t.length&&t[0].startWhenInView,this.checkBounds.__throttled=a.a.throttle(this.checkBounds,100)},start:function(){b.prototype.start.apply(this,arguments),this.isReady().then(function(){this.timeline.play(),this.started=!0}.bind(this)).catch((function(t){t&&console.log(t&&t.stack)}))},checkBounds:function(){this.scrolledToBounds||window.requestAnimationFrame(function(){this.isInBounds()&&(this.scrolledToBounds=!0,this.trigger("scrolledToBounds"))}.bind(this))},onScroll:function(){this.checkBounds.__throttled()},isReady:function(){var t,e=this;if(RM.screenshot||this.started||r.b.PageVisibilityManager.isPageHidden())t=window.Promise.reject();else{var i=this.widgets[0],s=[],o=window.Promise.all(this.widgets.map((function(t){return t.loaded?window.Promise.resolve():new window.Promise((function(i){return e.listenToOnce(t,"loaded",i)}))})));if(this.isAbove){var n=this.page.mag.aboveAnimationsReady?window.Promise.resolve():new window.Promise(function(t){this.listenToOnce(this.page.mag,"aboveAnimationsReady",t)}.bind(this)),a=i.rendered?window.Promise.resolve():new window.Promise(function(t){this.listenToOnce(i,"rendered",t)}.bind(this)),l=i.wasHidden?new window.Promise(function(t){this.listenToOnce(i,"shown",t)}.bind(this)):window.Promise.resolve();s=this.startWhenInView?[a,l,o]:[n,a,l,o]}else{var c=this.page.started?window.Promise.resolve():new window.Promise(function(t){this.listenToOnce(this.page,"started",t)}.bind(this)),d=this.page.loadAnimationsReady?window.Promise.resolve():new window.Promise(function(t){this.listenToOnce(this.page,"loadAnimationsReady",t)}.bind(this)),p=this.page.isCurrent()?window.Promise.resolve():new window.Promise(function(t){this.listenToOnce(this.page,"changedTo",t)}.bind(this)),u=this.startWhenInView?o.then((function(){if(window.IntersectionObserver){var t=e.widgets.map((function(t){return t.$el[0]})),i=h.a.getBoundingBoxOfElements(t,e.getBBScaleFactor());return new window.Promise((function(s){var o=new window.IntersectionObserver((function(e){return e.forEach((function(e){e.isIntersecting&&(t.forEach((function(t){return o.unobserve(t)})),s())}))}),{rootMargin:"-".concat(i.height*e.visibleHeightPortion,"px 0px")});t.forEach((function(t){return o.observe(t)}))}))}return e.isInBounds()?window.Promise.resolve():new window.Promise((function(t){e.listenToOnce(e,"scrolledToBounds",t)}))})):window.Promise.resolve();s=this.startWhenInView?[c,p,u]:[d,c]}t=window.Promise.all(s)}return t},getBBScaleFactor:function(){return c.a.isOn(this.page.scale)&&c.a.isZoom()||this.page.scale>1&&c.a.isZoom()&&Object(p.a)("viewer.fixOnScrollSpeed1")?this.page.scale:1},isInBounds:function(){var t=h.a.getBoundingBoxOfElements(this.widgets.map((function(t){return t.$el[0]})),this.getBBScaleFactor()),e=Object(s.a)(window).height(),i=this.visibleHeightPortion*t.height;return t.height&&t.bottom>=i&&t.bottom<=e||t.height&&t.top<=e-i&&t.top>0}}),v.click=b.extend({initialize:function(){b.prototype.initialize.apply(this,arguments);var t=function(t){t.on("click",this.onClick),t.css("cursor","pointer")}.bind(this);this.waitingForEnd=!1,this.lastTimeClick=0,this.withTriggerOrElement(t)},onClick:function(){if(this.timeline&&!(+new Date-this.lastTimeClick<300)){this.lastTimeClick=+new Date;var t=this.timeline;t.active?(this.waitingForEnd?t.off("full-cycle-end",this.onCycleEnd):t.on("full-cycle-end",this.onCycleEnd),this.waitingForEnd=!this.waitingForEnd):(this.waitingForEnd=!1,t.reversed?t.reverse():t.play(),this.setHasPlayed(),a.a.each(this.widgets,(function(e){"video"===e.type&&e.player&&(t.reversed?e.player.pause():e.player.play())})))}},onCycleEnd:function(){var t=this.timeline;t.off("full-cycle-end",this.onCycleEnd),this.waitingForEnd=!1,t.loop?t.stop():(t.reversed?t.reverse():t.play(),this.setHasPlayed())},setHasPlayed:function(){var t=l.a.getPermanentAnimationId(this.widgets[0],this.animation.UUID);this.animation.playOnce&&!l.a.hasPlayed(t)&&l.a.persistHasPlayed(t)},destroy:function(){var t=function(t){t.css("cursor","")};this.withTriggerOrElement(t),b.prototype.destroy.apply(this,arguments)}}),v.hover=b.extend({initialize:function(){if(b.prototype.initialize.apply(this,arguments),d.a.isDesktop){var t=function(t){t.on("mouseenter",this.onMouseEnter),t.on("mouseleave",this.onMouseLeave)}.bind(this);a.a.each(this.widgets,a.a.bind((function(t){-1!==["text","shape","picture","button"].indexOf(t.type)&&(t.hasHoverAnimation=!0)}),this)),this.withTriggerOrElement(t)}},onMouseEnter:function(){if(this.timeline){var t=this.timeline;t.active?!t.loop&&t.reversed?t.on("full-cycle-end",this.onCycleEnd):t.off("full-cycle-end",this.onCycleEnd):!t.reversed&&t.play()}},onMouseLeave:function(){if(this.timeline){var t=this.timeline;t.active?!t.loop&&t.reversed?t.off("full-cycle-end",this.onCycleEnd):t.on("full-cycle-end",this.onCycleEnd):!t.loop&&t.reversed&&t.reverse()}},onCycleEnd:function(){var t=this.timeline;t.off("full-cycle-end",this.onCycleEnd),t.loop?t.stop():t.reversed?t.reverse():t.play()}}),e.a=f},HxOx:function(module,exports){module.exports={"template-constructor-control-text_link":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Link" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\n\t\t<div class="panel-caption">Link</div>\n\n\t\t<div class="picture-preview-error">\n\t\t\t<div class="message-text">Oops, you cant add a link to this image since Lightbox is enabled</div>\n    </div>\n\n\t\t<div class="common-wrapper">\n\n\t\t\t<div class="edit-wrapper default-state">\n\n\t\t\t\t<div class="edit-item" data-field="_caption">\n\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="state-switcher-wrapper">\n\t\t\t\t\t<div class="caption-default state-switcher">Link</div>\n\t\t\t\t\t<div class="caption-hover state-switcher">Hover</div>\n\t\t\t\t\t<div class="caption-current state-switcher">Current</div>\n\t\t\t\t</div>\n\n\n\t\t\t\t<div class="params-wrapper clearfix">\n\t\t\t\t\t<div class="params-block params-default">\n\n\t\t\t\t\t\t<div class="edit-item color-click-area" data-field="color"  data-field-dop="opacity">\n\t\t\t\t\t\t\t<div class="caption">Text Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item underline-style-click-area separator" data-field="u-style">\n\t\t\t\t\t\t\t<div class="caption">Underline</div>\n\t\t\t\t\t\t\t<div class="underline-style"></div>\n\t\t\t\t\t\t\t<div class="popup-arrow"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item color-click-area separator" data-field="u-color"  data-field-dop="u-opacity">\n\t\t\t\t\t\t\t<div class="caption">Underline Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="u-size">\n\t\t\t\t\t\t\t<div class="caption">Underline Width</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="u-offset">\n\t\t\t\t\t\t\t<div class="caption">Padding</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\n\n\n\t\t\t\t\t<div class="params-block params-hover">\n\n\t\t\t\t\t\t<div class="edit-item color-click-area" data-field="hover-color"  data-field-dop="hover-opacity">\n\t\t\t\t\t\t\t<div class="caption">Text Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item underline-style-click-area separator" data-field="hover-u-style">\n\t\t\t\t\t\t\t<div class="caption">Underline</div>\n\t\t\t\t\t\t\t<div class="underline-style"></div>\n\t\t\t\t\t\t\t<div class="popup-arrow"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item color-click-area separator" data-field="hover-u-color"  data-field-dop="hover-u-opacity">\n\t\t\t\t\t\t\t<div class="caption">Underline Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="hover-u-size">\n\t\t\t\t\t\t\t<div class="caption">Underline Width</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="hover-u-offset">\n\t\t\t\t\t\t\t<div class="caption">Padding</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="params-block params-current">\n\n\t\t\t\t\t\t<div class="edit-item color-click-area" data-field="current-color"  data-field-dop="current-opacity">\n\t\t\t\t\t\t\t<div class="caption">Text Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item underline-style-click-area separator" data-field="current-u-style">\n\t\t\t\t\t\t\t<div class="caption">Underline</div>\n\t\t\t\t\t\t\t<div class="underline-style"></div>\n\t\t\t\t\t\t\t<div class="popup-arrow"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item color-click-area separator" data-field="current-u-color"  data-field-dop="current-u-opacity">\n\t\t\t\t\t\t\t<div class="caption">Underline Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="current-u-size">\n\t\t\t\t\t\t\t<div class="caption">Underline Width</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="current-u-offset">\n\t\t\t\t\t\t\t<div class="caption">Padding</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\n\t\t\t\t</div>\n\t\t\t</div>\n\n\n\t\t\t<div class="transform-wrapper">\n\n\t\t\t\t<div class="search-wrapper">\n\t\t\t\t\t<input type="text" spellcheck="false"  required="required" value=""/>\n\t\t\t\t\t<div class="placeholder" data-initial="URL, page no., email" data-url="URL" data-page="Page Number (e.g. 8)" data-email="Email" data-phone="e.g. +71234567890" data-anchor="point a place" data-back="Scroll to Top" data-goback="Go Back" data-mailchimp="Mailchimp Popup" data-multiple="Multiple" data-no-page="Page doesn\'t exist"></div>\n\t\t\t\t\t<div class="action-icon hidden"></div>\n\t\t\t\t\t<div class="target-icon"></div>\n\t\t\t\t\t<div class="placeholder-selector hidden">\n\t\t\t\t\t\t<div class="placeholder-popup">\n\t\t\t\t\t\t\t<div class="placeholder-item" data-type="url">Website URL</div>\n\t\t\t\t\t\t\t<div class="placeholder-item" data-type="page">Jump to Page</div>\n\t\t\t\t\t\t\t<div class="placeholder-item" data-type="email">Email</div>\n\t\t\t\t\t\t\t<div class="placeholder-item" data-type="phone">Phone Number</div>\n\t\t\t\t\t\t\t<div class="placeholder-item" data-type="anchor">Anchor</div>\n\t\t\t\t\t\t\t<div class="placeholder-item" data-type="back">Scroll to Top</div>\n\t\t\t\t\t\t\t<div class="placeholder-item" data-type="goback">Go back</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="placeholder-arrow"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="resizable-scroll-wrapper">\n\t\t\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t\t\t<div class="resizable-content">\n\t\t\t\t\t\t\t<div class="styles-wrapper"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="resizable-scroll"></div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="target-wrapper">\n\t\t\t\t\t<div class="caption">Open in new tab</div>\n\t\t\t\t\t<div class="toggle">\n\t\t\t\t\t\t<input type="checkbox">\n\t\t\t\t\t\t<div class="bg"></div>\n\t\t\t\t\t\t<div class="handle"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\n\n\n\t\t<div class="add-block">\n\t\t\t<div class="add" title="Create New Link Style"></div>\n\t\t\t<div class="save">Save</div>\n\t\t\t<div class="cancel" title="Cancel Changes"></div>\n\t\t</div>\n\n\n\t\t<div class="colorbox_container"></div>\n\n\t\t<div class="underline_style_container">\n\t\t\t<div class="underline-style-popup">\n\t\t\t\t<div class="underline-style-item" data-type="none">None</div>\n\t\t\t\t<div class="underline-style-item" data-type="solid"></div>\n\t\t\t\t<div class="underline-style-item" data-type="dotted"></div>\n\t\t\t\t<div class="underline-style-item" data-type="dashed"></div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="style-menu transition-enable">\n\t\t\t<div class="edit-button">Edit Style</div>\n\t\t\t<div class="separator s-1"></div>\n\t\t\t<div class="duplicate-button">Duplicate</div>\n\t\t\t<div class="separator s-2"></div>\n\t\t\t<div class="delete-button">Delete</div>\n\n\t        <div class="corner-wrapper">\n\t            <div class="corner"></div>\n\t        </div>\n\t\t</div>\n\t</div>\n';return __p},"template-constructor-control-text_link-style":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="link-style" data-id="'+(null==(__t=_name)?"":_.escape(__t))+'">\n\t\t<div class="style-caption '+(null==(__t=_name)?"":_.escape(__t))+'">'+(null==(__t=_caption)?"":_.escape(__t))+'</div>\n\t\t<div class="menu-button"></div>\n\t</div>\n';return __p}}},ICos:function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"a",(function(){return o}));var s=function(t){var e=function(t){var e=Number(t).toString(16);return e.length<2?"0".concat(e):e},i=e(t.r),s=e(t.g),o=e(t.b),n=e(parseInt((100*t.a).toFixed(0)));return"".concat(i).concat(s).concat(o).concat(n)},o=function(t){var e=t;"#"===t[0]&&(e=e.slice(1));var i=parseInt(e.substring(0,2),16),s=parseInt(e.substring(2,4),16),o=parseInt(e.substring(4,6),16),n=parseInt(e.substring(6,8),16)/100;return{r:i,g:s,b:o,a:void 0===n?1:n>1?1:n<0?0:n}}},Ib1Q:function(t,e,i){"use strict";var s=i("rwzP");i.n(s).a},IrH7:function(t,e,i){"use strict";var s=i("vOnD");function o(){var t=function(t,e){e||(e=t.slice(0));return Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}(["."," { "," }"]);return o=function(){return t},t}var n,a=function(t,e,i){var n,a,r,l=Object(s.b)(o(),t,i);return r={label:e,style:l},(a=t)in(n={})?Object.defineProperty(n,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[a]=r,n};function r(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function l(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return c})),function(t){t.AlignLeft="align-left",t.AlignCenter="align-center",t.AlignRight="align-right",t.AlignJustify="align-justify"}(n||(n={}));var c=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?r(i,!0).forEach((function(e){l(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):r(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},a(n.AlignLeft,"Left","text-align: left;"),{},a(n.AlignCenter,"Center","text-align: center;"),{},a(n.AlignRight,"Right","text-align: right;"),{},a(n.AlignJustify,"Justify","text-align: justify;"))},IzrY:function(t,e,i){},KVGF:function(module,exports){module.exports={"template-viewer-mag-password":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="magpassword-container">\n\t\t<div class="img-preloader"></div>\n\t\t<div class="back invisible" '+(null==(__t=pass_bg?'style="background-image:url('+pass_bg+')"':"")?"":__t)+'></div>\n\t\t<div class="center-table">\n\t\t\t<div class="center-cell">\n\t\t\t\t<div class="center-content invisible">\n\t\t\t\t\t\x3c!--__magterm--\x3e\n\t\t\t\t\t<div class="password-wrapper">\n\t\t\t\t\t\t<div class="input-wrapper">\n\t\t\t\t\t\t\t<input type="password" class="password-input" placeholder="Enter password" id="magpassword-input" required>\n\t\t\t\t\t\t\t<div class="access disabled">Go to project</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t',user.get("permissions")&&user.get("permissions").white_label||(__p+='\n\t\t\t<div class="author invisible">\n\t\t\t\t<div class="userpic">\n\t\t\t\t\t<a href="'+(null==(__t=user.getLink())?"":_.escape(__t))+'"><img src="'+(null==(__t=user.getUserpic(128))?"":_.escape(__t))+'" alt=""></a>\n\t\t\t\t\t<a href="'+(null==(__t=user.getLink())?"":_.escape(__t))+'"><div class="username">'+(null==(__t=user.get("name"))?"":_.escape(__t))+'</div></a>\n\t\t\t\t</div>\n\t\t\t\t<div class="caption">Published by</div>\n\t\t\t</div>\n\t\t\t<div class="powered invisible">\n\t\t\t\t<div class="caption-powered">Made with</div>\n\t\t\t\t<a href="'+(null==(__t=Constants.readymag_host)?"":__t)+'"><div class="logo-powered"></div></a>\n\t\t\t</div>\n\t\t'),__p+="\n\t</div>\n";return __p}}},"Kx3/":function(module,exports){module.exports={"template-constructor-control-common_layer":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon"data-alt="Arrange" data-alt-pos="left" data-alt-offset="9"></div>\n\n\n\t<div class="panel">\n\t\t<div class="backward-all" title="Send to Back"></div>\n\t\t<div class="backward" title="Send Backward"></div>\n\t\t<div class="forward" title="Bring Forward"></div>\n\t\t<div class="forward-all" title="Send to Front"></div>\n\t</div>\n';return __p}}},L3tv:function(module,exports){module.exports={"template-constructor-control-common_position":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Position" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\n\t\t<div class="param-caption solid-separator">\n\t\t\t<span>Fix position</span>\n\t\t\t<a href="https://help.readymag.com/hc/en-us/articles/360020527132-Fixed-and-positioned-widgets" target="_blank" class="question-icon">\n\t\t\t\t<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t<g fill="none" fill-rule="evenodd">\n\t\t\t\t\t\t<circle cx="12" cy="12" r="12"/>\n\t\t\t\t\t\t<path d="M8 9.259C8.06 7.371 9.294 6 11.542 6 13.615 6 15 7.259 15 9.02c0 1.219-.575 2.072-1.604 2.717-.992.614-1.272 1.02-1.272 1.809V14H10.37l-.008-.542c-.068-1.195.37-1.912 1.415-2.558.939-.597 1.256-1.02 1.256-1.808 0-.83-.635-1.427-1.589-1.427-.976 0-1.604.622-1.665 1.594H8zM11.5 18c-.904 0-1.5-.592-1.5-1.495 0-.913.596-1.505 1.5-1.505.922 0 1.5.592 1.5 1.505 0 .903-.578 1.495-1.5 1.495z"/>\n\t\t\t\t\t</g>\n\t\t\t\t</svg>\n\t\t\t</a>\n\t\t</div>\n\t\t<div class="param-caption">Browser window</div>\n\n\t\t<ul class="dotted-separator">\n\t\t\t<li class="nw"></li>\n\t\t\t<li class="n"></li>\n\t\t\t<li class="ne"></li>\n\t\t\t<li class="w"></li>\n\t\t\t<li class="c"></li>\n\t\t\t<li class="e"></li>\n\t\t\t<li class="sw"></li>\n\t\t\t<li class="s"></li>\n\t\t\t<li class="se"></li>\n\t\t</ul>\n\n\t\t<div class="position-wrapper solid-separator">\n\t\t\t<div class="param-caption">Page</div>\n\t\t\t<div class="togglers-wrapper">\n\t\t\t\t<div class="sticked-top" data-side="top"></div>\n\t\t\t\t<div class="sticked-left" data-side="left"></div>\n\t\t\t\t<div class="full-width"></div>\n\t\t\t\t<div class="full-height"></div>\n\n\t\t\t\t<div class="sticked-right" data-side="right"></div>\n\t\t\t\t<div class="sticked-bottom" data-side="bottom"></div>\n\t\t\t</div>\n\n\t\t\t<div class="margin-wrapper">\n\t\t\t\t<input class="full-height margin-input" type="text" spellcheck="false" value="" data-min="0" data-max="256" data-mouseDir="v" data-mouseSpeed="8" data-shiftStep="15"/>\n\t\t\t\t<input class="full-width margin-input" type="text" spellcheck="false" value="" data-min="0" data-max="256" data-mouseDir="v" data-mouseSpeed="8" data-shiftStep="15"/>\n\t\t\t</div>\n\t\t</div>\n\n\n\t\t<div class="global-options">\n\t\t\t<div class="option global dotted-separator">\n\t\t\t\t<div class="option-title">\n\t\t\t\t\t<div class="title-wrapper">\n\t\t\t\t\t\t<span class="title-caption">On all pages</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="switcher global rmswitcher"></div>\n\t\t\t</div>\n\t\t\t<div class="option above">\n\t\t\t\t<div class="option-title">\n\t\t\t\t\t<div class="title-wrapper">\n\t\t\t\t\t\t<span class="title-caption">Above pages</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="switcher above rmswitcher"></div>\n\t\t\t</div>\n\t\t</div>\n\n\t</div>\n';return __p}}},LDvm:function(t,e,i){"use strict";function s(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function o(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?s(i,!0).forEach((function(e){n(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):s(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function a(t,e,i,s,o,n,a){try{var r=t[n](a),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(s,o)}var r=function(){var t,e=(t=regeneratorRuntime.mark((function t(e,i){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e,o({headers:{"Content-Type":"application/json"}},i)).then((function(t){return t.json()}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})),function(){var e=this,i=arguments;return new Promise((function(s,o){var n=t.apply(e,i);function r(t){a(n,s,o,r,l,"next",t)}function l(t){a(n,s,o,r,l,"throw",t)}r(void 0)}))});return function(t,i){return e.apply(this,arguments)}}(),l=function(t){return r(t)},c=function(t,e){return r(t,{method:"put",body:JSON.stringify(e)})};function h(t,e){if(null==t)return{};var i,s,o=function(t,e){if(null==t)return{};var i,s,o={},n=Object.keys(t);for(s=0;s<n.length;s++)i=n[s],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(s=0;s<n.length;s++)i=n[s],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}var d=function(t){return l("/api/swatches/project/".concat(t))},p=function(t){var e=t.projectNumId,i=h(t,["projectNumId"]);return c("/api/swatches/project/".concat(e),i)},u=function(t){var e=t.projectNumId,i=h(t,["projectNumId"]);return c("/api/swatches/project/".concat(e,"/move"),i)},g=function(t){return l("/api/swatches/global/".concat(t))},m=function(t){var e=t.userId,i=h(t,["userId"]);return c("/api/swatches/global/".concat(e),i)},f=function(t){var e=t.userId,i=h(t,["userId"]);return c("/api/swatches/global/".concat(e,"/move"),i)},v=function(t){return l("/api/mag/".concat(t,"/trash"))};i.d(e,"b",(function(){return d})),i.d(e,"g",(function(){return p})),i.d(e,"e",(function(){return u})),i.d(e,"a",(function(){return g})),i.d(e,"f",(function(){return m})),i.d(e,"d",(function(){return f})),i.d(e,"c",(function(){return v}))},LEh1:function(t,e,i){},LSan:function(t,e,i){"use strict";var s=i("9Tqx");i.n(s).a},LaNJ:function(module,exports){module.exports={"template-picture-preview-box":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n  <div>\n    <div class="picture-preview-box">\n      <div class="picture-preview-box-overlay" style="background-color: '+(null==(__t=overlayColor)?"":__t)+';"></div>\n      <img class="picture-preview-box-image" srcset="'+(null==(__t=previewSrc)?"":__t)+'" style="'+(null==(__t=Object.keys(originalStyle).map((function(t){return t+":"+originalStyle[t]})).join("; "))?"":__t)+'" />\n    </div>\n  </div>\n';return __p}}},M9xF:function(module,exports){module.exports={"template-constructor-block-button":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n    <input class="text"\n           value="'+(null==(__t=data.text)?"":_.escape(__t))+'"\n           type="text"\n           autocapitalize="off"\n           autocorrect="off"\n           autocomplete="off"\n           spellcheck="false"/>\n\n';return __p}}},MAfP:function(module,exports){module.exports={"template-block-frame":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="frameborder">\n\t\t<div class="dot lt" data-ind="0"></div>\n\t\t<div class="dot t" data-ind="1"></div>\n\t\t<div class="dot rt" data-ind="2"></div>\n\t\t<div class="dot r" data-ind="3"></div>\n\t\t<div class="dot rb" data-ind="4"></div>\n\t\t<div class="dot b" data-ind="5"></div>\n\t\t<div class="dot lb" data-ind="6"></div>\n\t\t<div class="dot l" data-ind="7"></div>\n\t\t<div class="triangle lt" data-ind="0">\n\t\t\t<svg width="19px" height="16.23px" xmlns\t="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="m 10.472022,15.361 c -0.5555223,0.949963 -1.3861334,0.954046 -1.9440437,0 L 0.56229989,1.7394072 C 0.00677768,0.78944449 0.48120359,0 1.5877001,0 H 17.4123 c 1.103146,0 1.58331,0.78536087 1.0254,1.7394072 z" id="Triangle" fill="#00DFB4"></path>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="triangle t" data-ind="1">\n\t\t\t<svg width="19px" height="16.23px" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="m 10.472022,15.361 c -0.5555223,0.949963 -1.3861334,0.954046 -1.9440437,0 L 0.56229989,1.7394072 C 0.00677768,0.78944449 0.48120359,0 1.5877001,0 H 17.4123 c 1.103146,0 1.58331,0.78536087 1.0254,1.7394072 z" id="Triangle" fill="#00DFB4"></path>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="triangle rt" data-ind="2">\n\t\t\t<svg width="19px" height="16.23px" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="m 10.472022,15.361 c -0.5555223,0.949963 -1.3861334,0.954046 -1.9440437,0 L 0.56229989,1.7394072 C 0.00677768,0.78944449 0.48120359,0 1.5877001,0 H 17.4123 c 1.103146,0 1.58331,0.78536087 1.0254,1.7394072 z" id="Triangle" fill="#00DFB4"></path>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="triangle r" data-ind="3">\n\t\t\t<svg width="19px" height="16.23px" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="m 10.472022,15.361 c -0.5555223,0.949963 -1.3861334,0.954046 -1.9440437,0 L 0.56229989,1.7394072 C 0.00677768,0.78944449 0.48120359,0 1.5877001,0 H 17.4123 c 1.103146,0 1.58331,0.78536087 1.0254,1.7394072 z" id="Triangle" fill="#00DFB4"></path>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="triangle rb" data-ind="4">\n\t\t\t<svg width="19px" height="16.23px" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="m 10.472022,15.361 c -0.5555223,0.949963 -1.3861334,0.954046 -1.9440437,0 L 0.56229989,1.7394072 C 0.00677768,0.78944449 0.48120359,0 1.5877001,0 H 17.4123 c 1.103146,0 1.58331,0.78536087 1.0254,1.7394072 z" id="Triangle" fill="#00DFB4"></path>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="triangle b" data-ind="5">\n\t\t\t<svg width="19px" height="16.23px" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="m 10.472022,15.361 c -0.5555223,0.949963 -1.3861334,0.954046 -1.9440437,0 L 0.56229989,1.7394072 C 0.00677768,0.78944449 0.48120359,0 1.5877001,0 H 17.4123 c 1.103146,0 1.58331,0.78536087 1.0254,1.7394072 z" id="Triangle" fill="#00DFB4"></path>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="triangle lb" data-ind="6">\n\t\t\t<svg width="19px" height="16.23px" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="m 10.472022,15.361 c -0.5555223,0.949963 -1.3861334,0.954046 -1.9440437,0 L 0.56229989,1.7394072 C 0.00677768,0.78944449 0.48120359,0 1.5877001,0 H 17.4123 c 1.103146,0 1.58331,0.78536087 1.0254,1.7394072 z" id="Triangle" fill="#00DFB4"></path>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="triangle l" data-ind="7">\n\t\t\t<svg width="19px" height="16.23px" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="m 10.472022,15.361 c -0.5555223,0.949963 -1.3861334,0.954046 -1.9440437,0 L 0.56229989,1.7394072 C 0.00677768,0.78944449 0.48120359,0 1.5877001,0 H 17.4123 c 1.103146,0 1.58331,0.78536087 1.0254,1.7394072 z" id="Triangle" fill="#00DFB4"></path>\n\t\t\t</svg>\n\t\t</div>\n\t</div>\n';return __p}}},MErq:function(t,e,i){"use strict";i.r(e);var s=i("rFsW"),o=i("XHB6"),n=i("gP9L"),a=i("RLXn"),r=i("uGDn"),l={components:{ColorPicker:o.a,FontFamilySelector:n.a,FontStyleSelector:a.a,RmSwitcher:r.a},watch:{isHidden:function(t){this.overlay.style.display=t?"none":"block"}},mounted:function(){var t=this;this.overlay=document.createElement("div"),this.overlay.classList.add("panel-overlay"),document.body.append(this.overlay),this.onOverlayClick&&this.overlay.addEventListener("click",this.onOverlayClick),this.$watch("model",(function(e){t.$emit("change",e)}),{deep:!0})},methods:{closeOthersPopups:function(t){t&&s.a.each(this.$children,(function(e){e!==t&&(e.visibleBox=!1)}))},changePropHandler:function(t,e){this.model[t]=e},changeShadow:function(t){this.model["bar-shadow"]=t}}},c=(i("eVPB"),i("KHd+")),h=Object(c.a)(l,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.isHidden?t._e():i("div",{staticClass:"panel setting-panel"},[i("div",{staticClass:"panel-header"},[t._v("Cart bar settings")]),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Bar color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.model["bar-background-color"],alpha:t.model["bar-background-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("bar-background-color",e)},"update:alpha":function(e){return t.changePropHandler("bar-background-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Shadow")]),t._v(" "),i("rm-switcher",{attrs:{value:t.model["bar-shadow"],callback:t.changeShadow,"color-off":"#B8B8B8","color-on":"#0080FF",height:24,width:40}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("font-family-selector",{attrs:{family:t.model["bar-font-family"]},on:{showPopup:t.closeOthersPopups,change:function(e){return t.changePropHandler("bar-font-family",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("font-style-selector",{style:{"font-family":t.model["bar-font-family"]},attrs:{"font-style":[t.model["bar-font-style"]],"font-weight":[t.model["bar-font-weight"]],"font-family":[t.model["bar-font-family"]]},on:{showPopup:t.closeOthersPopups,"update:fontStyle":function(e){return t.changePropHandler("bar-font-style",e)},"update:fontWeight":function(e){return t.changePropHandler("bar-font-weight",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Text color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.model["bar-color"],alpha:t.model["bar-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("bar-color",e)},"update:alpha":function(e){return t.changePropHandler("bar-color-opacity",e)}}})],1)])}),[],!1,null,null,null);e.default=h.exports},MseB:function(module,exports){module.exports={"template-constructor-helpers-typekit-popup":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="typekit-popup">\n\t\t<div class="full-house">Full House</div>\n\t\t<div class="error-message">Sadly, but you cannot store more than 5 of Typekits fonts in your font selector. Please remove one and try again.</div>\n\n\t\t<div class="corner-wrapper">\n\t\t\t<div class="corner"></div>\n\t\t</div>\n\t</div>\n\n';return __p}}},"MyX/":function(t,e,i){"use strict";var s=i("5IDT");i.n(s).a},NEuE:function(module,exports){module.exports={"template-constructor-control-picture_crop":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon preloader" data-alt="Crop" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t\t<div class="scale">\n\t\t\t<div class="handler">\n\t\t\t\t<div class="helper"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="equilateral button"></div>\n\t\t<div class="fill button">Fill</div>\n\t\t<div class="fit  button">Fit</div>\n\t\t<div class="x1 button">x1</div>\n\t</div>\n';return __p}}},OdK0:function(t,e,i){"use strict";var s=i("DJvK");i.n(s).a},P6JF:function(module,exports){module.exports={"template-constructor-control-text_align":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon" data-alt="Align" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t\t<div class="left" title="Left Align"></div>\n\t\t<div class="center" title="Center"></div>\n\t\t<div class="right" title="Right Align"></div>\n\t\t<div class="justify" title="Justify"></div>\n\t</div>\n';return __p}}},"QP/g":function(module,exports){module.exports={"template-constructor-control-cart_add_product_widget":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Add product widget" data-alt-pos="left" data-alt-offset="9">\n\t\t<img class="add-icon svg" src="https://cdn.readymag.com/6bfa1e36/dist/img/constructor/controls/cart_connections/add_product_widget.svg" />\n\t</div>\n';return __p}}},QRzc:function(module,exports){module.exports={"template-viewer-mag-menu":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="mag-menu '+(null==(__t=hasProjectInfo?"":"no-project-info")?"":__t)+'">\n\t\t<div class="menu-wrapper">\n\n\t\t\t',hasProjectInfo&&(__p+='\n\t\t\t\t<div class="menu-info">\n\n\t\t\t\t\t<a class="link '+(null==(__t=common.isDownloadedSource?"inactive-link":"")?"":__t)+'" href="'+(null==(__t=mag.model.user.getLink())?"":_.escape(__t))+'">\n\t\t\t\t\t\t<div class="userpic" style="background-image:url(\''+(null==(__t=mag.model.user.getUserpic(64))?"":__t)+'\')"></div>\n\t\t\t\t\t\t<div class="username">'+(null==(__t=mag.user.name)?"":_.escape(__t))+'</div>\n\t\t\t\t\t</a>\n\t\t\t\t\t<div class="published-by" data_caption="published by" data_date="'+(null==(__t=publishDate)?"":__t)+'"></div>\n\t\t\t\t\t<div class="mag-title">'+(null==(__t=mag.title)?"":_.escape(__t))+"</div>\n\t\t\t\t</div>\n\t\t\t"),__p+='\n\n\t\t\t<div class="scroll-wrapper">\n\n\t\t\t\t',common.isDomainViewer||Modernizr.android||(__p+='\n\t\t\t\t\t<a class="logo-wrapper" href="/">\n\t\t\t\t\t\t<div class="made-with"> Made with</div>\n\t\t\t\t\t\t<div class="logo sprite"></div>\n\t\t\t\t\t</a>\n\t\t\t\t'),__p+='\n\n\t\t\t\t<div class="pages-wrapper has-'+(null==(__t=viewerType)?"":__t)+'-scroll">\n\t\t\t\t\t<div class="pages">\n\n\t\t\t\t\t\t',_.each(pages,(function(t,e){var i="horizontal"==viewerType?"left":"top",s=e*("horizontal"==viewerType?width:height);__p+='\n\t\t\t\t\t\t\t<div class="page" data-id="'+(null==(__t=t._id)?"":__t)+'" data-num="'+(null==(__t=t.num)?"":__t)+'" data-src="'+(null==(__t=mag.model.getPageScreenshot(width,{_id:t._id}))?"":__t)+'" style="width:'+(null==(__t=width)?"":__t)+"px;height:"+(null==(__t=height)?"":__t)+"px;"+(null==(__t=i)?"":__t)+":"+(null==(__t=s)?"":__t)+'px">\n\t\t\t\t\t\t\t\t<img class="screenshot" src="'+(null==(__t=stub)?"":__t)+'" />\n\t\t\t\t\t\t\t\t<div class="num '+(null==(__t=t.num>99?"over99":"")?"":__t)+'">'+(null==(__t=t.num)?"":__t)+"</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"})),__p+="\n\n\t\t\t\t\t\t",!common.isDomainViewer&&Modernizr.android&&(__p+='\n\t\t\t\t\t\t\t<a class="logo-wrapper" href="/">\n\t\t\t\t\t\t\t\t<div class="made-with"> Made with</div>\n\t\t\t\t\t\t\t\t<div class="logo sprite"></div>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t'),__p+='\n\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="scroll"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n';return __p}}},R31J:function(module,exports){module.exports={"template-pack":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="pack" id="pack_'+(null==(__t=id)?"":__t)+'">\n\t\t<div class="content"></div>\n\t\t'+(null==(__t=templates["template-block-frame"]())?"":__t)+"\n\t</div>\n";return __p}}},RLXn:function(t,e,i){"use strict";var s=i("rFsW"),o={i1:{caption:"Thin Italic",style:{fontWeight:100,fontStyle:"italic"}},i3:{caption:"Light Italic",style:{fontWeight:300,fontStyle:"italic"}},i4:{caption:"Italic",style:{fontWeight:400,fontStyle:"italic"}},i5:{caption:"Medium Italic",style:{fontWeight:500,fontStyle:"italic"}},i7:{caption:"Bold Italic",style:{fontWeight:700,fontStyle:"italic"}},i9:{caption:"Black Italic",style:{fontWeight:900,fontStyle:"italic"}},n1:{caption:"Thin",style:{fontWeight:100,fontStyle:"normal"}},n3:{caption:"Light",style:{fontWeight:300,fontStyle:"normal"}},n4:{caption:"Regular",style:{fontWeight:400,fontStyle:"normal"}},n5:{caption:"Medium",style:{fontWeight:500,fontStyle:"normal"}},n7:{caption:"Bold",style:{fontWeight:700,fontStyle:"normal"}},n9:{caption:"Black",style:{fontWeight:900,fontStyle:"normal"}}},n={model:{event:"change"},props:{fontStyle:{type:Array,default:function(){return[""]}},fontFamily:{type:Array,default:function(){return[""]}},fontWeight:{type:Array,default:function(){return[0]}}},data:function(){return{visibleBox:!1,boxStyles:{},styleVariants:{}}},computed:{exStyle:function(){return{"font-style":this.getParamForMultipleStyles(this.fontStyle),"font-weight":this.getParamForMultipleStyles(this.fontWeight)}},fromTop:function(){return s.a.keys(this.styleVariants).length>5},disabled:function(){return 0===s.a.keys(this.styleVariants).length},caption:function(){var t=this,e="";return this.keys.forEach((function(i,s){o[i]&&(e+=o[i].caption,s+1<t.keys.length&&(e+=", "))})),e},keys:function(){for(var t=[],e=0;e<this.fontStyle.length;e++){var i=("italic"===this.fontStyle[e]?"i":"n")+(""+this.fontWeight[e])[0];this.styleVariants[i]||1!==this.fontFamily.length||(i=this.styleVariants.n4?"n4":s.a.keys(this.styleVariants)[0],this.$emit("update:fontStyle","i"===i[0]?"italic":"normal"),this.$emit("update:fontWeight",100*parseInt(i[1],10))),t.push(i)}return t}},watch:{disabled:{handler:function(t){t&&this.visibleBox&&(this.visibleBox=!1)},immediate:!0},fontFamily:{handler:function(t){var e=this,i=t.map((function(t){return RM.constructorRouter.fonts.findFontByCSSName(t)})),o=[],n={i:"italic",n:"normal"};i.forEach((function(t){var i={};t.variations.forEach((function(t){i[t]={caption:e.generateName(t),style:{fontWeight:100*parseInt(t[1],10),fontStyle:n[t[0]]}}})),o.push(i)})),1===o.length?this.styleVariants=s.a.clone(o[0]):o.length>1&&function(){for(var t=s.a.clone(o[0]),i=function(e){var i=o[e];Object.keys(t).forEach((function(e){i[e]||delete t[e]}))},n=1;n<o.length;n++)i(n);e.styleVariants=t}()},immediate:!0}},methods:{generateName:function(t){var e="i"===t[0],i={1:"Thin",2:"ExtraLight",3:"Light",4:"Regular",5:"Medium",6:"SemiBold",7:"Bold",8:"ExtraBold",9:"Black"}[t[1]];return e&&"Regular"===i?"Italic":i+(e?" Italic":"")},getParamForMultipleStyles:function(t){return 1===t.length?t[0]:s.a.every(t,(function(e){return e===t[0]}))?t[0]:"inherit"},selectFont:function(t){this.$emit("update:fontStyle",t.style.fontStyle),this.$emit("update:fontWeight",t.style.fontWeight)},toggleVisible:function(){this.disabled||(this.visibleBox||this.$emit("showPopup",this),this.visibleBox=!this.visibleBox)}}},a=(i("3dGj"),i("KHd+")),r=Object(a.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"font-style-container"},[i("span",{staticClass:"example",class:{disabled:t.disabled},style:t.exStyle,on:{click:t.toggleVisible}},[t._v(t._s(t.caption))]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.disabled,expression:"!disabled"}],staticClass:"expand-arrow",on:{click:t.toggleVisible}}),t._v(" "),i("div",{staticClass:"box_container",class:{visible:t.visibleBox,"from-top":t.fromTop},style:t.boxStyles},t._l(t.styleVariants,(function(e,s){return i("div",{key:s,staticClass:"font-elem",class:t.keys.includes(s)?"curr":"",style:e.style,on:{click:function(i){return t.selectFont(e,s)}}},[t._v("\n      "+t._s(e.caption)+"\n      "),i("div",{staticClass:"point"})])})),0)])}),[],!1,null,null,null);e.a=r.exports},RedZ:function(module,exports){module.exports={"template-constructor-control-picture_preview":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Lightbox" data-alt-pos="left" data-alt-offset="9">\n    <div class="left-icon">\n      <img class="svg" src="https://cdn.readymag.com/6bfa1e36/dist/img/constructor/controls/picture_preview/icon.svg" />\n    </div>\n    <div class="right-icon">\n      <div class="arrow"></div>\n    </div>\n  </div>\n\n\t<div class="panel">\n    <div class="panel-caption">Lightbox</div>\n\n\t\t<div class="animation-error">\n\t\t\t<div class="message-text">Oops, you cant enable Lightbox, as this image already has an On-Click animation</div>\n    </div>\n\n    <div class="link-error">\n\t\t\t<div class="message-text">Oops, you cant enable Lightbox to this image since link added</div>\n    </div>\n\n    <div class="fullscreen-controls">\n      <div class="icon-panel icon-overlay noarrow" data-alt-pos="left" data-alt-offset="9">\n        <div class="colorbox_container"></div>\n      </div>\n      <div class="icon-panel icon-preview-toggle noarrow" data-alt-pos="left" data-alt-offset="43">\n        <img class="svg" src="https://cdn.readymag.com/6bfa1e36/dist/img/constructor/controls/picture_preview/icon.svg" />\n      </div>\n    </div>\n\t</div>\n\n';return __p}}},Rh5U:function(module,exports){module.exports={"template-viewer-mag":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="mag">\n\t\t<div class="mag-pages-container">\n\t\t\t<div class="container disable-transitions">\n\n\t\t\t\t<div class="blackout"></div>\n\t\t\t</div>\n\t\t\t<div class="above-pages-container"></div>\n\t\t</div>\n\n\t\t',hasStandaloneBottomArrow&&(__p+='\n\t\t\t<div class="navigation-arrow bottom offscreen"><div class="icon sprite"></div></div>\n\t\t'),__p+="\n\n\n\t\t",isPreview&&(__p+='\n\t\t\t<div class="mag-pages-viewport-device"></div>\n\t\t'),__p+="\n\t</div>\n\n";return __p}}},Rn2B:function(module,exports){module.exports={"template-constructor-control-hotspot-pin-settings":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="icon noarrow" data-alt="Pin Settings" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\n\t\t<div class="search-block">\n\n\t\t\t<input class="search" type="text" placeholder="Search">\n\n\n\t\t\t<div class="loupe">\n\t\t\t\t<div class="rmpreloader hidden"><div class="arc"></div></div>\n\t\t\t</div>\n\n\t\t</div>\n\n\n\t\t<div class="common-wrapper">\n\n\n\t\t\t<div class="resizable-scroll-wrapper">\n\t\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t\t<div class="resizable-content">\n\n\t\t\t\t\t\t<div class="rectangle-icon item">\n\t\t\t\t\t\t\t<div class="line"></div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="circle-icon item">\n\t\t\t\t\t\t\t<div class="circle"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="resizable-scroll"></div>\n\t\t\t</div>\n\n\n\t\t\t<div class="params-wrapper clearfix">\n\n\t\t\t\t<div class="edit-item color-click-area" data-field="bg_color" data-field-dop="bg_opacity">\n\t\t\t\t\t<div class="caption">Color</div>\n\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t</div>\n\n\n\t\t\t\t<div class="edit-item combined separator" data-field="borders">\n\t\t\t\t\t<div class="caption">Border</div>\n\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\n\t\t\t\t\t<div class="edit-item border-color color-click-area" data-field="color" data-field-dop="opacity">\n\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="edit-item separator" data-field="tip_show_on">\n\t\t\t\t\t<div class="caption">Show on</div>\n\t\t\t\t\t<div class="switcher" data-active="click">\n\t\t\t\t\t\t<div class="switcher-item" data-value="click">Click</div>\n\t\t\t\t\t\t<div class="switcher-item" data-value="hover">Hover</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\n\t\t</div>\n\n\n\t\t<div class="resize-handle-top"></div>\n\t\t<div class="resize-handle-bottom"></div>\n\n\t\t<div class="colorbox_container"></div>\n\n\t</div>\n';return __p},"template-constructor-control-hotspot-pin-settings-icon-item":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon-item item">\n\t\t<div class="noun-icon" style="background-image: url('+(null==(__t=icon.preview_url_42)?"":__t)+');" '+(null==(__t=icon.id?'data-id="'+icon.id+'"':'data-rm_id="'+icon.rm_id+'"')?"":__t)+' data-url="'+(null==(__t=icon.icon_url)?"":__t)+'">\n\t</div>\n';return __p}}},TAzU:function(t,e,i){},TBxE:function(t,e,i){"use strict";var s=i("xi34"),o=i("Kw5r"),n=i("rFsW"),a=i("q1z7"),r=i.n(a),l=i("OTSC"),c=i("q7tt"),h=new RegExp("^image/("+l.a.UPLOAD_IMAGE_FORMATS+")$","i"),d=new RegExp("([a-z-_0-9/:.]*.("+l.a.UPLOAD_IMAGE_FORMATS+")(\\W.*)?$)","i"),p=r.a.View.extend({DEFAULT_ERROR_MSG:"Something went wrong!",constructor:function(t){return t instanceof c.a?this.block=t:t instanceof o.a&&(this.block=t.raw_block||t.block,this.panel=t),this.initialize.apply(this,arguments),this},initialize:function(t,e){n.a.bindAll(this);var i=this.block;(e=e||{}).fileTypes&&(this.fileTypes=new RegExp("^image/("+e.fileTypes+")$","i"),this.fileTypesErrorMessage=e.fileTypesErrorMessage,delete e.fileTypes,delete e.fileTypesErrorMessage),e=n.a.defaults(e,n.a.extend({dataType:"json",singleFileUploads:!0,sequentialUploads:!0,formData:{id:i.model.id,mid:i.workspace.mag.get("num_id"),name:i.name,uploadType:"picture",unique:e.unique},dropZone:Object(s.a)(),pasteZone:null,replaceFileInput:!1},this.panel?{dropZone:Object(s.a)(this.panel.$el),fileInput:Object(s.a)(e.uploadInputRefName?this.panel.$refs[e.uploadInputRefName]:this.panel.$refs.uploadInput)}:{})),this.options=e,this.debug&&console.log(e),this.$uploader=Object(s.a)(e.fileInput).fileupload(e),this.bindHandlers(),this.uploadingData=[]},bindHandlers:function(){var t=this;this.preventDefaultOnDrop(),this.$uploader.bind("fileuploadadd",(function(e,i){if(t.debug&&console.log("add",i),t.uploadData=i,!i||!i.files||!i.files[0]||i.files[0].skipped)return!1;var s=i.files&&i.files[0].size,o=i.files&&i.files[0].type;s>l.a.UPLOAD_IMAGE_SIZE_LIMIT?(i.allowUpload=!1,alert(i.files[0].uploadError=l.a.MSG_UPLOAD_IMAGE_SIZE_ERROR)):(t.fileTypes||h).test(o)?i.allowUpload=!0:(i.allowUpload=!1,alert(i.files[0].uploadError=t.fileTypesErrorMessage||l.a.MSG_UPLOAD_IMAGE_SUPPORTED_ERROR)),t.trigger("add",e,i),t.uploadingData.push(i),i.submit()})).bind("fileuploaddrop",(function(e,i){t.debug&&console.log("drop",i),t.trigger("drop",e);var o=(e.originalEvent.dataTransfer||e.delegatedEvent.dataTransfer).getData("text/html");if(o){var n=Object(s.a)(o).filter("img").attr("src");if(n)return d.test(n)?void t.trigger("uploadFromUrl",n):(alert(i.uploadError=l.a.MSG_UPLOAD_IMAGE_SUPPORTED_ERROR),i.allowUpload=!1,t.clearFileInputField(),!1)}})).bind("fileuploadsubmit",(function(e,i){if(t.debug&&console.log("submit",i),!i.allowUpload){var s=i.uploadError||i.files&&i.files[0]&&i.files[0].uploadError;return s&&(delete i.uploadError,i.files&&delete i.files[0].uploadError,t.trigger("fail",e,i,s),t.clearFileInputField()),!1}i.allowUpload=!1})).bind("fileuploadsend",(function(e,i){if(t.debug&&console.log("send",i),i.files[0].skipped)return!1;t.trigger("send",e,i)})).bind("fileuploadstart",(function(e,i){t.debug&&console.log("start",i),t.uploading=!0,t.trigger("start",e,i)})).bind("fileuploaddone",(function(e,i){t.debug&&console.log("done",i),t.uploadingData.shift(),t.uploading=!1,t.clearFileInputField(),i.files[0].skipped||t.trigger("done",e,i)})).bind("fileuploaddragover",(function(e){t.trigger("dragover",e)})).bind("fileuploaddragleave",(function(e){t.trigger("dragleave",e)})).bind("fileuploadfail",(function(e,i){t.debug&&console.log("fail",i),t.uploadingData.shift(),t.uploading=!1,t.clearFileInputField();var s=t.DEFAULT_ERROR_MSG;500==(i&&i.jqXHR&&i.jqXHR.status)&&n.a.delay((function(){alert(s=l.a.MSG_UPLOAD_IMAGE_SUPPORTED_ERROR)}),300),i.files&&!i.files[0].skipped&&"abort"!=i.errorThrown&&t.trigger("fail",e,i,s)}))},setOptions:function(t){this.options=n.a.extend(this.options,t),this.$uploader.fileupload(this.options)},setFormData:function(t,e,i){if(!t||!e||!i)return console.error("missing required parameters");this.$uploader.fileupload({formData:{id:t,name:e,uploadType:i}})},clearFileInputField:function(){this.$uploader.wrap("<form>").closest("form").get(0).reset(),this.$uploader.unwrap()},switchOff:function(){this.options.dropZone.off("drop dragover",this.prevent),this.$uploader.fileupload("disable")},switchOn:function(){this.preventDefaultOnDrop(),this.$uploader.fileupload("enable")},preventDefaultOnDrop:function(){this.options.dropZone.on("drop dragover",this.prevent)},prevent:function(t){t.preventDefault()},abort:function(){this.uploadingData[0]&&this.uploadingData[0].abort(),n.a.each(this.uploadingData,(function(t){t.files[0].skipped=!0}))},destroy:function(){this.abort(),this.switchOff(),this.off(),this.$uploader.fileupload("destroy")}});p.MimeTypeRegExp=h,p.UrlImageTypeRegExp=d,e.a=p},TGSb:function(module,exports){module.exports={"template-constructor-control-common_lock":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Lock" data-alt-pos="left" data-alt-offset="9"></div>\n';return __p}}},Tiua:function(t,e,i){},Tjx0:function(t,e,i){"use strict";var s=i("4nGE");i.n(s).a},Tu3F:function(module,exports){module.exports={"template-viewer-toolbar":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='\n\n\t<div class="toolbar for-viewer">\n\n\t\t';var offscreenClass=isPreview||common.embedMode?"":"offscreen-initially";__p+="\n\n\t\t",hasPageCounter&&!pageCounterInsideMenu&&(__p+='\n\t\t\t<div class="page-counter-wrapper '+(null==(__t=offscreenClass)?"":__t)+'">\n\t\t\t\t<div class="page-counter"><span class="cur"></span> of <span class="total">'+(null==(__t=totalPages)?"":__t)+"</span></div>\n\t\t\t</div>\n\t\t"),__p+="\n\n\t\t",hasShare&&(__p+='\n\t\t\t<div class="share-button sprite '+(null==(__t=offscreenClass)?"":__t)+'" data-alt="Share" data-alt-pos="bottom" data-alt-offset="9"></div>\n\t\t'),__p+="\n\n\t\t",hasMenu&&(__p+='\n\t\t\t<div class="menu-button '+(null==(__t=offscreenClass)?"":__t)+'" data-alt="Menu (M)" data-alt-pos="bottom" data-alt-offset="9">\n\t\t\t\t',hasPageCounter&&pageCounterInsideMenu&&(__p+='\n\t\t\t\t\t<div class="page-counter"><span class="cur"></span> of <span class="total">'+(null==(__t=totalPages)?"":__t)+"</span></div>\n\t\t\t\t"),__p+='\n\t\t\t\t<div class="line-1"></div>\n\t\t\t\t<div class="line-2"></div>\n\t\t\t\t<div class="line-3"></div>\n\t\t\t\t<div class="page-preloader sprite"></div>\n\t\t\t</div>\n\t\t'),__p+="\n\n\t\t",common.embedMode&&(__p+='\n\t\t\t<div class="embed-close-button '+(null==(__t=offscreenClass)?"":__t)+'">Close</div>\n\t\t'),__p+="\n\n\t</div>\n\n"}return __p}}},TxgR:function(t,e,i){},U72E:function(module,exports){module.exports={"template-constructor-workspace-inside-block":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="workspace-inside-block">\n\t\t<div class="blocks-wrapper"></div>\n\t</div>\n\n';return __p}}},UGoK:function(t,e,i){"use strict";var s,o,n=i("bLmx"),a=i("ICos");function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.LetterSpacing="LETTER_SPACING",t.Color="COLOR"}(o||(o={}));var l=(r(s={},o.LetterSpacing,{name:"letterSpacing",value:function(t){return"".concat(t,"px")}}),r(s,o.Color,{name:"color",value:function(t){var e=Object(a.a)(t),i=e.r,s=e.g,o=e.b,n=e.a;return"rgba(".concat(i,", ").concat(s,", ").concat(o,", ").concat(n,")")}}),s);function c(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function h(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i.d(e,"b",(function(){return d})),i.d(e,"c",(function(){return p})),i.d(e,"a",(function(){return o}));var d=function(t){var e=t.key,i=t.value,s=t.editorState,o=s.getCurrentInlineStyle().toJS().reduce((function(t,i){return i.startsWith(e)?Object(n.f)(t,i):t}),s);return Object(n.f)(o,"".concat(e,"_").concat(i))},p=function(t){return Object.keys(l).reduce((function(e,i){var s=t.filter((function(t){return!!t&&t.startsWith(i)})).first();if(s){var o=s.replace("".concat(i,"_"),"");return function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?c(i,!0).forEach((function(e){h(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):c(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},e,h({},l[i].name,l[i].value(o)))}return e}),{})}},UeZx:function(module,exports){module.exports={"template-constructor-block":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="block '+(null==(__t=block.hidden?"invisible":"")?"":__t)+'" data-id="'+(null==(__t=block._id)?"":__t)+'">\n\t\t<div class="content"></div>\n\t\t'+(null==(__t=templates["template-block-frame"]())?"":__t)+"\n\t</div>\n";return __p}}},UyQn:function(t,e,i){"use strict";var s=i("bXDN");i.n(s).a},VZqm:function(t,e,i){"use strict";var s=i("xi34"),o=i("rFsW"),n={model:{event:"change"},props:{value:"",variants:{type:Array,default:function(){return[]}}},methods:{spinType:function(t){var e=this,i=0;o.a.each(this.variants,(function(t,s){t.value===e.value&&(i=s)})),i=(i+=t)<0?i+this.variants.length:i%this.variants.length,Object(s.a)(this.$el).toggleClass("negative",t<0),this.$emit("change",this.variants[i].value)}}},a=(i("mX/r"),i("KHd+")),r=Object(a.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"spinner"},[i("transition",{attrs:{name:"fade"}},[t._l(t.variants,(function(e,s){return[e.value==t.value?i("div",{staticClass:"spin-title"},[t._v(t._s(e.title))]):t._e()]}))],2),t._v(" "),i("div",{staticClass:"spin left",on:{click:function(e){return e.stopPropagation(),t.spinType(-1)}}}),t._v(" "),i("div",{staticClass:"spin right",on:{click:function(e){return e.stopPropagation(),t.spinType(1)}}})],1)}),[],!1,null,null,null);e.a=r.exports},Vc8N:function(module,exports){module.exports={"template-constructor-block-twitter-type_tweet":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<a href="https://twitter.com/share" class="twitter-share-button" data-url="'+(null==(__t=url)?"":_.escape(__t))+'" data-lang="en" data-size="'+(null==(__t=large_button?"large":"medium")?"":__t)+'" data-text="'+(null==(__t="undefined"!=typeof text?text:"")?"":_.escape(__t))+'">Tweet</a>\n\t<div class="overlay"></div>\n';return __p},"template-constructor-block-twitter-type_follow":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<a href="https://twitter.com/'+(null==(__t=username||"Readymag")?"":_.escape(__t))+'" class="twitter-follow-button" data-show-count="false" data-show-screen-name="'+(null==(__t=show_name?"true":"false")?"":__t)+'" data-lang="en" data-size="'+(null==(__t=large_button?"large":"medium")?"":__t)+'">Follow @'+(null==(__t=username)?"":_.escape(__t))+'</a>\n\t<div class="overlay"></div>\n';return __p},"template-constructor-block-twitter-type_hashtag":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<a href="https://twitter.com/intent/tweet?button_hashtag='+(null==(__t=hash)?"":_.escape(__t))+'" class="twitter-hashtag-button" data-size="'+(null==(__t=large_button?"large":"medium")?"":__t)+'">Tweet #'+(null==(__t=hash)?"":_.escape(__t))+'</a>\n\t<div class="overlay"></div>\n';return __p},"template-constructor-block-twitter-type_timeline":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n\t"+(null==(__t=code)?"":__t)+'\n\t<div class="overlay"></div>\n';return __p},"template-constructor-block-twitter-type_embed":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n\t"+(null==(__t=code)?"":__t)+'\n\t<div class="overlay"></div>\n';return __p}}},WEBt:function(module,exports){module.exports={"template-viewer-branding":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="rm-branding offscreen-initially">\n\t<a class="rm-branding-button" href="https://readymag.com" target="_blank"></a>\n\t</div>\n';return __p}}},Wxmq:function(module,exports){module.exports={"template-viewer-share":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n\n\t",hasOverlay&&(__p+='\n\t\t<div class="share-popup-overlay hidden"></div>\n\t'),__p+='\n\n\t<div class="share-popup hidden">\n\t\t<div class="content-wrapper">\n\n\t\t\t<div class="share-wrapper">\n\t\t\t\t<div class="caption">Share</div>\n\n\t\t\t\t<div class="type-selector">\n\t\t\t\t\t\x3c!--__magterm--\x3e\n\t\t\t\t\t<div class="type-full">Project</div>\n\t\t\t\t\t<div class="type-page">Current Page</div>\n\t\t\t\t\t<div class="arrow sprite"></div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="buttons-wrapper">\n\t\t\t\t\t<div class="share-facebook button" data-tp="facebook"><div class="icon sprite"></div>Share</div>\n\t\t\t\t\t<div class="share-twitter button" data-tp="twitter"><div class="icon sprite"></div>Tweet</div>\n\t\t\t\t\t<div class="share-gplus button" data-tp="gplus"><div class="icon sprite"></div>Google+</div>\n\t\t\t\t\t<div class="share-pinterest button" data-tp="pinterest"><div class="icon sprite"></div>Pin</div>\n\t\t\t\t\t<div class="share-linkedin button" data-tp="linkedin"><div class="icon sprite"></div>Linkedin</div>\n\t\t\t\t\t<div class="share-mail button" data-tp="email"><div class="icon sprite"></div>Email</div>\n\t\t\t\t</div>\n\n\t\t\t\t',common.isDownloadedSource||(__p+='\n\t\t\t\t\t<div class="open-embed"><div class="icon sprite"></div>Embed</div>\n\t\t\t\t\t<div class="close">Close</div>\n\t\t\t\t\t<div class="send-report" data-tp="report"><div class="icon sprite"></div>Report</div>\n\t\t\t\t'),__p+="\n\t\t\t</div>\n\n\t\t\t",common.isDownloadedSource||(__p+='\n\t\t\t\t<div class="embed-wrapper">\n\t\t\t\t\t<div class="caption">Embed</div>\n\n\t\t\t\t\t<div class="size-selector" data-selected="responsive">\n\t\t\t\t\t\t<div class="size responsive" data-size="responsive">Responsive</div>\n\t\t\t\t\t\t<div class="size big" data-size="big">512383</div>\n\t\t\t\t\t\t<div class="size small" data-size="small">288236</div>\n\t\t\t\t\t\t<div class="arrow sprite"></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="code-block">\n\t\t\t\t\t\t<div class="thumb">\n\t\t\t\t\t\t\t<img class="thumb-pic" src="" alt=""/>\n\t\t\t\t\t\t\t<div class="thumb-toolbar">\n\t\t\t\t\t\t\t\t<div class="icon arrows"></div>\n\t\t\t\t\t\t\t\t<div class="icon open"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<textarea class="embed-code"></textarea>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="back">Back</div>\n\t\t\t\t</div>\n\t\t\t'),__p+='\n\t\t</div>\n\n\t\t<div class="corner-wrapper">\n\t\t\t<div class="corner"></div>\n\t\t</div>\n\t</div>\n\n';return __p}}},XHB6:function(t,e,i){"use strict";var s=i("xi34"),o=i("OTSC"),n=i("Fts9"),a={model:{event:"change"},props:{color:String,alpha:Number,disabled:{type:Boolean,default:!1},disabledIcon:String,customIcon:String,showAlpha:{type:Boolean,default:!0},showArrowIcon:{type:Boolean,default:!1},hOffset:{type:Number,default:0},opacityMultiplier:{type:Number,default:1},vOffset:{type:Number,default:0},verticalAlign:{type:String,default:"auto"},alwaysVisible:{tyoe:Boolean,default:!1},colorboxType:{type:String,default:"small"}},data:function(){return{mutableColor:this.color,mutableAlpha:this.showAlpha?this.alpha*this.opacityMultiplier:1,visibleBox:!1,colorBoxStyles:{}}},computed:{bg:function(){return this.disabled&&!this.mutableColor?"#b8b8b8":o.b.getRGBA(this.mutableColor,this.showAlpha?this.opacity100based:1)},opacity100based:function(){return this.mutableAlpha/100},opacityResult:function(){return this.mutableAlpha/this.opacityMultiplier}},watch:{color:function(t){return this.mutableColor=t,!!this.colorbox&&(this.mutableColor?void this.colorbox.setColor(this.mutableColor):(this.visibleBox&&this.hide(),!1))},alpha:function(t){this.mutableAlpha=t}},mounted:function(){var t=8;this.alwaysVisible?(this.colorBoxStyles.width="168px",this.colorBoxStyles.overflow="hidden",this.colorBoxStyles["border-radius"]="6px 6px 0 0",this.onColorClick()):(Object(s.a)(this.$el).hasClass("round")&&(t=7),this.$el.getBoundingClientRect().top>window.innerHeight/2||"top"===this.verticalAlign?this.colorBoxStyles["margin-top"]=-(240+t+this.vOffset)+"px":this.colorBoxStyles["margin-top"]=Object(s.a)(this.$refs.button).height()+t+this.vOffset+"px",this.colorBoxStyles["margin-left"]=-(this.hOffset+152-Object(s.a)(this.$refs.button).width())+"px")},methods:{onColorClick:function(){this.disabled||(this.colorbox||(this.colorbox=new n.a({$parent:this.$el.querySelector(".colorbox_container"),type:this.colorboxType,show_opacity:this.showAlpha}),this.colorbox.on("colorchange",this.colorOpacityChanged),this.colorbox.on("opacitychange",this.colorOpacityChanged)),this.colorbox.setColor(this.mutableColor),this.colorbox.setOpacity(this.opacity100based),this.$emit(this.visibleBox?"hidePopup":"showPopup",this),this.visibleBox=!this.visibleBox)},colorOpacityChanged:function(t,e,i,s){this.mutableColor=this.colorbox.rgb2hex([t,e,i]),this.mutableAlpha=100*s,this.$emit("update:all",{color:this.mutableColor,alpha:this.opacityResult}),this.$emit("update:color",this.mutableColor),this.$emit("update:alpha",this.opacityResult)},hide:function(){this.visibleBox=!1,this.$emit("hidePopup")}}},r=(i("6z1P"),i("KHd+")),l=Object(r.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"button",class:{"color-picker-container":!0,"color-picker-disabled":t.disabled}},[t.showAlpha?i("div",{staticClass:"opacity-grid"}):t._e(),t._v(" "),t.alwaysVisible?t._e():i("div",{staticClass:"color-preview",style:{backgroundColor:t.bg},on:{click:function(e){return e.stopPropagation(),t.onColorClick(e)}}},[t.disabled&&t.disabledIcon?i("img",{staticClass:"disabled-icon",attrs:{src:t.disabledIcon}}):t._e(),t._v(" "),!t.disabled&&t.customIcon?i("img",{staticClass:"custom-icon",attrs:{src:t.customIcon}}):t._e()]),t._v(" "),t.showArrowIcon?i("div",{staticClass:"arrow-icon",on:{click:function(e){return e.stopPropagation(),t.onColorClick(e)}}}):t._e(),t._v(" "),i("div",{staticClass:"colorbox_container",class:{visible:t.visibleBox},style:t.colorBoxStyles,on:{click:function(t){t.stopPropagation()}}})])}),[],!1,null,null,null);e.a=l.exports},"Y+fa":function(t,e,i){"use strict";var s=i("TAzU");i.n(s).a},YD2b:function(t,e,i){},YNoo:function(module,exports){module.exports={"template-viewer-widget-text":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="\n\t";var cc=1==column_count?"auto":column_count;__p+='\n\t<div style=" -webkit-nbsp-mode:normal; -webkit-line-break:after-white-space; white-space:'+(null==(__t=isNotChrome?"normal":"pre-wrap")?"":__t)+"; column-count:"+(null==(__t=cc)?"":__t)+";-webkit-column-count:"+(null==(__t=cc)?"":__t)+" !important;-moz-column-count:"+(null==(__t=cc)?"":__t)+";column-gap:"+(null==(__t=column_gap)?"":__t)+"px;-webkit-column-gap:"+(null==(__t=column_gap)?"":__t)+"px !important;-moz-column-gap:"+(null==(__t=column_gap)?"":__t)+"px;background:"+(null==(__t=bg)?"":_.escape(__t))+'">'+(null==(__t=text)?"":__t)+"</div>\n"}return __p}}},YOpb:function(t,e,i){"use strict";i.r(e);var s=i("rFsW"),o=i("mT3t").a.extend({id:"_params",isNew:function(){return!1},mag:{},name:"MagEditParams",initialize:function(t,e){s.a.bindAll(this),o.prototype.mag=e,this.url=function(){return"/api/mag/"+this.mag.get("num_id")+"/edit_params"},this.set(t)},getChangedAttributes:function(){return this.changedAttributes()},toggle:function(t){this.save(t,!this.get(t))}});e.default=o},ZhWy:function(module,exports){module.exports={"template-common-404":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <div id="page404">\n        <table>\n            <tr>\n                <td>\n                    <div class="caption">Page Not Found.</div>\n                    <div class="message">Sorry, theres nothing here.<br/>Visit our <a class="front-page-link" href="/">front page</a>.</div>\n                </td>\n            </tr>\n        </table>\n    </div>\n';return __p},"template-common-mag-suspended":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="magsuspended-container">\n\t\t<div class="img-preloader"></div>\n\t\t<div class="center-table">\n\t\t\t<div class="center-cell">\n\t\t\t\t<div class="center-content">\n\t\t\t\t\t<div class="caption">Suspended</div>\n\t\t\t\t\t\x3c!--__magterm--\x3e\n\t\t\t\t\t<div class="text">Sorry, this project has been suspended due to violation of Readymags <a class="link guides-link nowrap" href="https://readymag.com/readymag/terms-and-privacy/">content guidelines</a>.</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<a class="link contact" href="mailto:'+(null==(__t=Constants.SUPPORT_MAIL)?"":__t)+'">Contact us</a>\n\t</div>\n';return __p},"template-common-user-suspended":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="usersuspended-container">\n\t\t<div class="img-preloader"></div>\n\t\t<div class="center-table">\n\t\t\t<div class="center-cell">\n\t\t\t\t<div class="center-content">\n\t\t\t\t\t<div class="caption">Suspended</div>\n\t\t\t\t\t\x3c!--__magterm--\x3e\n\t\t\t\t\t<div class="text">Sorry, this account has been suspended due to violation of Readymags <a class="link guides-link nowrap" href="https://readymag.com/readymag/terms-and-privacy/">content guidelines</a>.</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<a class="link contact" href="mailto:'+(null==(__t=Constants.SUPPORT_MAIL)?"":__t)+'">Contact us</a>\n\t</div>\n';return __p},"template-common-domain-errors":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="domain-errors">\n\t\t<div class="message">\n\t\t\t',(state.magNotFound||state.domainNotFound)&&(__p+='\n\t\t\t<div class="message-caption">Website is almost here</div>\n\t\t\t\x3c!--__magterm--\x3e\n\t\t\t<div class="message-text">To complete the setup, please hit <br class="br-phone"/>the Map Now <br class="br-desktop"/>button in your <br class="br-phone"/>projectss settings.</div>\n\t\t\t<a class="help-phone" href="http://help.readymag.com/hc/en-us/articles/360020588592-Domain">Need Help?</a>\n\t\t\t'),__p+="\n\t\t\t",state.magNotPublished&&(__p+='\n\t\t\t<div class="message-caption">Website is Offline</div>\n\t\t\t\x3c!--__magterm--\x3e\n\t\t\t<div class="message-text">This project has been unpublished.</div>\n\t\t\t'),__p+="\n\t\t\t",state.subscriptionExpired&&(__p+='\n\t\t\t<div class="message-caption">Website is Offline</div>\n\t\t\t<div class="message-text"><a href="'+(null==(__t=Constants.readymag_auth_host)?"":__t)+'/settings/">Log in</a> to manage your subscription.</div>\n\t\t\t'),__p+='\n\t\t</div>\n\n\t\t<a class="logo" href="'+(null==(__t=Constants.readymag_host)?"":__t)+'"></a>\n\n\t\t',(state.magNotFound||state.domainNotFound)&&(__p+='\n\t\t<a class="help" href="http://help.readymag.com/hc/en-us/articles/360020588592-Domain">Need Help?</a>\n\t\t'),__p+="\n\t</div>\n\n";return __p}}},Zuws:function(module,exports){module.exports={"template-viewer-widget-background":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="rmwidget widget-background" style="background-color: #'+(null==(__t=data.color)?"":__t)+'">\n\n        ',"picture"==data.selectedType&&(__p+='\n            <div class="picture-background" style="opacity: '+(null==(__t=data.opacity||1)?"":__t)+';"></div>\n        '),__p+="\n\n        ","video"==data.selectedType&&(__p+='\n            <div class="video-background" style="opacity: '+(null==(__t=data.videoopacity||1)?"":__t)+';">\n                <div class="video-container"></div>\n                <div class="overlay"></div>\n            </div>\n\t\t'),__p+="\n\n\t\t","slideshow"==data.selectedType&&(__p+='\n\t\t\t<div class="slideshow-background">\n\t\t\t\t<div class="slideshow-container"></div>\n\t\t\t\t<div class="slideshow-preload"></div>\n\t\t\t</div>\n\t\t'),__p+="\n\t</div>\n";return __p}}},"a/+O":function(module,exports){module.exports={"template-constructor-helpers-upload-button":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="rm-upload-button">\n\t\t<div class="icon"></div>\n\t</div>\n\n';return __p}}},a3mI:function(module,exports){module.exports={"template-constructor-control-button_icon":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="icon noarrow" data-alt="Icon" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\n\t\t<div class="search-block">\n\n\t\t\t<input class="search" type="text" placeholder="Search">\n\n\n\t\t\t<div class="loupe">\n\t\t\t\t<div class="rmpreloader hidden"><div class="arc"></div></div>\n\t\t\t</div>\n\n\t\t</div>\n\n\n\t\t<div class="common-wrapper">\n\n\n\t\t\t<div class="resizable-scroll-wrapper">\n\t\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t\t<div class="resizable-content">\n\n\t\t\t\t\t\t<div class="disable-icon item">\n\t\t\t\t\t\t\t<div class="line"></div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t\x3c!--<div class="last-icon item">--\x3e\n\t\t\t\t\t\t\t\x3c!--<div class="noun-icon"></div>--\x3e\n\t\t\t\t\t\t\x3c!--</div>--\x3e\n\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="resizable-scroll"></div>\n\t\t\t</div>\n\n\n\t\t\t<div class="params-wrapper clearfix">\n\n\t\t\t\t<div class="edit-item" data-field="icon_h">\n\t\t\t\t\t<div class="caption">Size</div>\n\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t</div>\n\n\n\t\t\t\t<div class="edit-item" data-field="icon_pos">\n\t\t\t\t\t<div class="caption">Pos.</div>\n\t\t\t\t\t<div class="positions">\n\t\t\t\t\t\t<div class="right position" data-position="right">\n\t\t\t\t\t\t\t<div class="fill"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="left position" data-position="left">\n\t\t\t\t\t\t\t<div class="fill"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t</div>\n\n\n\t\t<div class="resize-handle-top"></div>\n\t\t<div class="resize-handle-bottom"></div>\n\n\t</div>\n';return __p},"template-constructor-control-button_icon-item":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon-item item">\n\t\t<div class="noun-icon" style="background-image: url('+(null==(__t=icon.preview_url_42)?"":__t)+');" '+(null==(__t=icon.id?'data-id="'+icon.id+'"':'data-rm_id="'+icon.rm_id+'"')?"":__t)+' data-url="'+(null==(__t=icon.icon_url)?"":__t)+'">\n\t</div>\n';return __p}}},amZL:function(t,e,i){"use strict";var s=i("xi34"),o=i("q1z7"),n=i.n(o),a=i("rFsW"),r=i("OTSC"),l=i("DqjY"),c=i("ee0N"),h=i.n(c),d=i("MseB"),p=i.n(d),u=n.a.View.extend({initialize:function(t){a.a.bindAll(this),a.a.extend(this,t),this.destroy.__debounced=a.a.debounce(this.destroy,0),this.$parent.hasClass("typekit-popup-shown")||(this.template=p.a["template-constructor-helpers-typekit-popup"],this.render(),a.a.defer(this.show))},TOP_POPUP_TRESHOLD:170,render:function(){var t,e;this.setElement(Object(s.a)(this.template({}))),this.$parent.addClass("typekit-popup-shown"),this.$parent.on("mouseleave",this.setPopupTimeout),this.$parent.on("mouseenter",this.resetPopupTimeout),this.$parent.on("click",this.destroy.__debounced),t=Math.round(this.$parent.offset().left+this.$parent.width()/2),e=Math.round(this.$parent.offset().top),this.$el.toggleClass("popup-below",e-this.TOP_POPUP_TRESHOLD<0),Object(s.a)("body").append(this.$el),this.$el.css({left:t,top:e})},show:function(t){this.$el.addClass("shown")},setPopupTimeout:function(){this.$parent.hasClass("typekit-popup-shown")&&(this.popupTimer=setTimeout(this.destroy.__debounced,500))},resetPopupTimeout:function(){clearTimeout(this.popupTimer)},destroy:function(){this.$parent.removeClass("typekit-popup-shown"),this.$parent.off("mouseleave",this.setPopupTimeout),this.$parent.off("mouseenter",this.resetPopupTimeout),this.$parent.off("click",this.destroy.__debounced),clearTimeout(this.popupTimer),this.$el.removeClass("shown"),setTimeout(a.a.bind((function(){this.$el.off().remove()}),this),300)}}),g=i("Vxjr"),m=n.a.View.extend({events:{"click .view-wrapper .grid-view, .view-wrapper .list-view":"switchView","click .size-wrapper .top-letter, .size-wrapper .bottom-letter":"onSizeLetterClick","click .right-panel .providers-switcher li":"switchProvider","click .right-panel .provider-filter .language-wrapper":"toggleLanguage","click .scroll-wrapper.main .results .font-item .list-add-remove-font":"addRemoveFont","mouseenter .scroll-wrapper.main .results .font-item ":"checkAddRemoveState","click .right-panel .font-info .bottom-info .info-add-remove-font":"addRemoveFont","mousedown .scroll-wrapper.main .results .font-item":"onFontItemMouseDown","mousemove .scroll-wrapper.main .results .font-item":"onFontItemMouseMove","mouseup .scroll-wrapper.main .results .font-item":"onFontItemMouseUp","click .scroll-wrapper.main .results .font-item":"openInfo","click .search-icon":"toggleSearch","click .back-icon":"closeInfo","input .search-wrapper .search-string":"onSearchStringChange","keypress .search-wrapper .search-string":"onSearchStringKey","keyup .search-wrapper .search-string":"onSearchStringKey","keydown .search-wrapper .search-string":"onSearchStringKey","click .search-wrapper .clear":"onClearSearchString",click:"closeLanguage","click .filter div":"onFilterItemClick","mouseenter .filter div":"onFilterMouseEnter","mouseleave .filter div":"onFilterMouseLeave"},PAGINATION:4,DATA_URL:window.fontsConfig.fontslist,IMGS_URL:window.fontsConfig.fontsimgs,LANGUAGE_MAP:{cyrillic:"cyrillic",devanagari:"devanagari",greek:"greek",khmer:"khmer",latin:"latin",vietnamese:"vietnamese",ca:"latin",cs:"latin",de:"latin",en:"latin",es:"latin",fr:"latin",it:"latin",nl:"latin",pl:"latin",pt:"latin",ru:"cyrillic",sv:"latin"},LANGUAGE_NAMES:{cyrillic:"Cyrillic",devanagari:"Devanagari",greek:"Greek",khmer:"Khmer",latin:"Latin",vietnamese:"Vietnamese",ca:"Catalan",cs:"Czech",de:"German",en:"English",es:"Spanish",fr:"French",it:"Italian",nl:"Dutch",pl:"Polish",pt:"Portuguese",ru:"Russian",sv:"Swedish",mt:"Maltese",sl:"Slovenian"},FVD_NAMES:{n1:"Thin",n2:"ExtraLight",n3:"Light",n4:"Regular",n5:"Medium",n6:"SemiBold",n7:"Bold",n8:"ExtraBold",n9:"Black",i1:"Thin Italic",i2:"ExtraLight Italic",i3:"Light Italic",i4:"Italic",i5:"Medium Italic",i6:"SemiBold Italic",i7:"Bold Italic",i8:"ExtraBold Italic",i9:"Black Italic"},CHARSETS_PRIORITY_FILTER_ON:["cyrillic","greek","vietnamese","devanagari","khmer","latin"],CHARSETS_PRIORITY_FILTER_OFF:["latin","cyrillic","greek","vietnamese","devanagari","khmer"],FVD_PRIORITY_REGULAR:["n4","i4","n3","i3","n5","i5","n2","i2","n6","i6","n1","i1","n7","i7","n8","i8","n9","i9"],FVD_PRIORITY_LIGHT:["n1","i1","n2","i2","n3","i3","n4","i4","n5","i5","n6","i6","n7","i7","n8","i8","n9","i9"],FVD_PRIORITY_HEAVY:["n9","i9","n8","i8","n7","i7","n6","i6","n5","i5","n4","i4","n3","i3","n2","i2","n1","i1"],initialize:function(t){a.a.bindAll(this),this.template=h.a["template-constructor-helpers-font-explorer"],this.itemTemplate=h.a["template-constructor-helpers-font-explorer-item"],this.noFoundTemplate=h.a["template-constructor-helpers-font-explorer-no-found"],this.applyFilter.__debounced=a.a.debounce(this.applyFilter,150),this.loadVisibleFontPreviews.__debounced=a.a.debounce(this.loadVisibleFontPreviews,300)},render:function(){this.setElement(Object(s.a)(this.template({})).insertAfter("#constructor")),this.$mainList=this.$(".scroll-wrapper.main .results-wrapper .results"),this.$infoList=this.$(".scroll-wrapper.info .results-wrapper .results"),this.mainScroll=Object(s.a)(this.$mainList.closest(".scroll-wrapper")).RMScroll({$container:this.$mainList.closest(".results-wrapper"),$content:this.$mainList,$handle:this.$mainList.closest(".scroll-wrapper").find(".scroll"),onScroll:this.onFontsScroll,gap_start:8,gap_end:8}).data("scroll"),this.infoScroll=Object(s.a)(this.$infoList.closest(".scroll-wrapper")).RMScroll({$container:this.$infoList.closest(".results-wrapper"),$content:this.$infoList,$handle:this.$infoList.closest(".scroll-wrapper").find(".scroll"),gap_start:8,gap_end:8}).data("scroll");var t=Object(s.a)(this.$(".size-wrapper .slider"));if(this.sizeSlider=t.slider({min:1,max:7,value:4,orientation:"vertical",start:function(){Object(s.a)("body").addClass("ns-resize-cursor"),t.addClass("dragging")},stop:function(){Object(s.a)("body").removeClass("ns-resize-cursor"),t.removeClass("dragging")},change:this.sizeChanged,slide:this.sizeChanged}),RM.constructorRouter&&RM.constructorRouter.previewMode){var e=Math.round(Math.abs(window.innerHeight-this.$el.height())/2);this.$el.css({position:"fixed","margin-top":0,top:e+"px"})}this.loadFontsData(),Object(g.a)("fontexplorer"),this.rendered=!0},loadFontsData:function(){var t=this,e=new Date,i=e.getDate()+"-"+(e.getMonth()+1)+"-"+e.getFullYear();s.a.ajax({type:"GET",url:this.DATA_URL+"?timestamp="+i+"&callback=?",jsonpCallback:"fontsListCallback",contentType:"application/json",cache:!0,dataType:"jsonp",success:function(e){t.$(".overlay").remove(),e.typetoday.forEach((function(t){t.deprecated_variations&&t.deprecated_variations.length&&(t.variations=a.a.difference(t.variations,t.deprecated_variations))})),t.fontsData=e,t.applyFilter()},error:function(t){console.log(arguments)}})},buildFilter:function(){var t=this.$(".right-panel .providers-switcher li.active").attr("data-name"),e=this.$('.right-panel .provider-filter[data-name="'+t+'"]'),i={},o="";return this.$(".search-icon").hasClass("active")?o=s.a.trim(this.$(".search-wrapper .search-string").val()):e.find(".filter div.active").each((function(){var t=Object(s.a)(this),e=t.parent().attr("data-name"),o=t.attr("data-name");i[e]||(i[e]=[]),i[e].push(o)})),{provider:t,filter:i,search:o}},applyFilter:function(){if(this.fontsData){var t,e,i,s,o=this.buildFilter(),n=o.provider,l=o.filter,c=o.search,h=this.fontsData[n];if(this.$(".search-wrapper .search-string").attr("placeholder","Search "+h.length+" fonts"),JSON.stringify(this.filter)!=JSON.stringify(o)){h=a.a.filter(h,(function(o){for(t in o=o.browse_info?o.browse_info:o,s=!0,l)if(i=l[t],e=a.a.isArray(o[t])?o[t]:[o[t]],!(s=s&&a.a.intersection(i,e).length))return;return s}));var d=a.a.compact(r.b.escapeRegExp(c).split(" ")),p=new RegExp(d.join(".*?"),"i");h=a.a.filter(h,(function(t){var e=t.name||t.family;return p.test(e)})),this.filteredFonts=h,this.filter=o,this.$mainList.empty(),this.mainScroll.recalc()}}},showFilteredFontsPortion:function(){if(this.filteredFonts){var t=this,e=Modernizr.retina?"@2x":"",i=this.$mainList.find(".font-item").length,s=this.filteredFonts.length,o=i,n=Math.min(s-i,this.PAGINATION),l=this.filter.provider,c=this.filter.filter,h=("google"==l?[]:c.weight)||[],d=("google"==l?c.subsets:c.language)||[];if(0!=s){if(0!=n){for(var p=o;p<o+n;p++){var u=this.filteredFonts[p],g=l+"_"+m(u.id||u.family||u.name)+"_"+f("google"==l?u.subsets:u.browse_info?u.browse_info.language:["en"],d)+"_"+v(u.variations,h);this.$mainList.append(this.itemTemplate({img1:g,img2:e+".png?t="+u.lastModified,text:u.name||u.family,name:u.name||u.family,id:u.id||u.name||u.family,styles:u.variations.length,provider:l,Utils:r.b}))}this.mainScroll.recalc()}}else this.$mainList.append(this.noFoundTemplate({}))}function m(t){return t.toLowerCase().split(" ").join("-")}function f(e,i){var s=function(e){for(var i={},s=0;s<e.length;s++)t.LANGUAGE_MAP[e[s]]&&(i[t.LANGUAGE_MAP[e[s]]]=!0);return Object.keys(i)}(e=(e=i.length?a.a.intersection(e,i):e).length?e:["latin"]),o=i.length?t.CHARSETS_PRIORITY_FILTER_ON:t.CHARSETS_PRIORITY_FILTER_OFF;return a.a.intersection(o,s)[0]}function v(e,i){var s,o=(i=i.length?i:["regular"])[0];return"light"==o&&(s=t.FVD_PRIORITY_LIGHT),"regular"==o&&(s=t.FVD_PRIORITY_REGULAR),"heavy"==o&&(s=t.FVD_PRIORITY_HEAVY),a.a.intersection(s,e)[0]}},loadVisibleFontPreviews:function(){var t=this.IMGS_URL+this.$mainList.attr("data-view")+"_",e=this.$mainList.parent().scrollTop(),i=this.$mainList.parent().height();this.$mainList.find(".font-item").each((function(){var o=Object(s.a)(this),n=t+o.attr("data-img1")+o.attr("data-img2");if(!o.attr("data-loaded")){var a=o.height(),r=o.position().top;r+a>e&&r<i+e&&(o.css("background-image",'url("'+n+'")'),o.attr("data-loaded",!0))}}))},onFontsScroll:function(t){t.content_size-t.container_size-t.scroll_pos<100&&this.showFilteredFontsPortion(),this.loadVisibleFontPreviews.__debounced()},switchView:function(t){var e=Object(s.a)(t.target);if(!e.hasClass("active")){e.addClass("active").siblings().removeClass("active");var i,o=this.$mainList.parent().scrollTop(),n=0;this.$mainList.find(".font-item").each((function(){if(i=Object(s.a)(this),(n=i.position().top-o)>=0)return!1})),this.$mainList.attr("data-view",e.attr("data-name")),this.$mainList.find(".font-item").removeAttr("data-loaded").css("background-image",""),this.mainScroll.recalc(),this.$mainList.parent().scrollTop(i.position().top-n)}},switchProvider:function(t){var e=Object(s.a)(t.target);e.hasClass("active")||(e.addClass("active").siblings().removeClass("active"),this.$(".provider-filter").addClass("invisible"),this.$('.provider-filter[data-name="'+e.attr("data-name")+'"]').removeClass("invisible"),this.applyFilter())},onFilterItemClick:function(t){var e=Object(s.a)(t.target),i=e.closest(".filter"),o=!!(i.attr("data-multiple")-0);e.attr("data-name")&&(e.toggleClass("active"),o||e.siblings("div").removeClass("active"),i.hasClass("language")&&this.updateLangs(i),this.applyFilter())},sizeChanged:function(t,e){this.$mainList.attr("data-size",e.value),this.mainScroll.recalc(),this.$infoList.attr("data-size",e.value),this.infoScroll.recalc()},onSearchStringKey:function(t){if(t.stopPropagation(),t.keyCode==s.a.keycodes.esc&&t.preventDefault(),"keyup"==t.type){if(t.keyCode==s.a.keycodes.esc)return void(""!=this.$(".search-wrapper .search-string").val()?this.clearSearchString():this.toggleSearch());t.keyCode==s.a.keycodes.enter&&(t.preventDefault(),this.applyFilter())}},onSearchStringChange:function(){var t=this.$(".search-wrapper .search-string").val();this.$(".search-wrapper .clear").toggleClass("invisible",""==t),this.applyFilter.__debounced()},clearSearchString:function(){this.$(".search-wrapper .search-string").blur().val("").focus(),this.onSearchStringChange()},onClearSearchString:function(){this.clearSearchString(),this.toggleSearch()},toggleSearch:function(){clearTimeout(this.searchFocusTimeout),this.$(".search-icon").toggleClass("active"),this.$(".search-wrapper").toggleClass("shift-down"),this.$(".scroll-wrapper.main").toggleClass("shift-down"),this.$(".search-icon").hasClass("active")?this.searchFocusTimeout=setTimeout(a.a.bind((function(){this.$(".search-wrapper .search-string").focus()}),this),700):r.b.getFocusBack(),this.applyFilter(),setTimeout(function(){this.mainScroll.recalc()}.bind(this),300)},addRemoveFont:function(t){t.stopPropagation();var e=Object(s.a)(t.target).closest(".font-item, .info-add-remove-font"),i=e.hasClass("removable")?"remove":"add",o=e.attr("data-font-provider"),n=e.attr("data-font-id"),r=e.attr("data-font-name"),l={};"typekit"==o&&(l={id:n}),"webtype"==o&&(l={name:n}),"google"==o&&(l={family:n}),"typetoday"==o&&(l={name:n});var c=a.a.findWhere(this.fontsData[o],l);"remove"==i?RM.constructorRouter.fonts.removeFonts([n]):RM.constructorRouter.fonts.addFonts([{provider:o,css_name:n,name:r,variations:c.variations,temporary:!0}],"font-explorer").error&&new u({$parent:e.hasClass("font-item")?e.find(".list-add-remove-font"):e});this.checkAddRemoveState(e),RM.analytics&&RM.analytics.sendEvent("Font Explorer Add/Remove from Library",i)},checkAddRemoveState:function(t){var e=Object(s.a)(t.target||t),i=RM.constructorRouter.fonts.getUsedFontsCache()[e.attr("data-font-id")],o=i&&!i.hidden;e.toggleClass("removable",!!o),e.hasClass("info-add-remove-font")&&e.text(o?"Remove from Font Selector":"Add to Font Selector")},closeInfo:function(){this.$(".font-explorer-wrapper").removeClass("info-mode")},onFontItemMouseDown:function(){this.fontItemMouseDown=!0},onFontItemMouseMove:function(){this.fontItemMouseDown&&(this.preventFontItemClick=!0)},onFontItemMouseUp:function(){this.fontItemMouseDown=!1},openInfo:function(t){if(this.preventFontItemClick)this.preventFontItemClick=!1;else{var e=Object(s.a)(t.target).closest(".font-item");this.$(".font-explorer-wrapper").addClass("info-mode"),this.$infoList.empty();var i=this,o=e.attr("data-font-provider"),n=e.attr("data-font-id"),c=e.attr("data-font-name"),h={};"typekit"==o&&(h={id:n}),"webtype"==o&&(h={name:n}),"google"==o&&(h={family:n}),"typetoday"==o&&(h={name:n});var d,p,u,g=a.a.findWhere(this.fontsData[o],h),m="google"==o?"Google Fonts":g.foundry,f="google"==o?"http://www.google.com/fonts/specimen/"+c.split(" ").join("+"):g.web_link,v=g.description,b=g.variations,_=e.attr("data-img1"),w=e.attr("data-img2"),y=Object(s.a)('<a target="_blank" href="'+g.web_link+'">More...</a>');p=g.subsets||g.browse_info&&g.browse_info.language||[],p=a.a.map(p,(function(t){return r.b.capitalize(i.LANGUAGE_NAMES[t]||t)}));for(var k=Object(s.a)(".font-info .language-wrapper .language"),C=Object(s.a)(".font-info .language-clamp"),x=p.length;x>0&&(d=p.slice(0,x).join(", "),!(x==p.length&&(C.empty().text(d),C.height()<=k.height())))&&(C.empty().text(d+", ").append(y),!(C.height()<=k.height()));x--);u=g.browse_info&&g.browse_info.recommended_for||[],u=(u=a.a.map(u,(function(t){return r.b.capitalize(i.LANGUAGE_NAMES[t]||t)}))).join(" & ");for(x=0;x<b.length;x++){var S=Object(s.a)(this.itemTemplate({img1:"",img2:"",text:l.a.getCustomVariationNameByFVD(g.name,b[x])||this.FVD_NAMES[b[x]],name:"",id:"",styles:"",provider:"",Utils:r.b})),P=this.IMGS_URL+"list_"+_.substr(0,_.length-2)+b[x]+w;S.css("background-image",'url("'+P+'")'),this.$infoList.append(S),S.attr("data-loaded",!0)}this.infoScroll.recalc();var $=this.$(".right-panel .font-info"),O=Object(s.a)(".bottom-info .info-add-remove-font",$);Object(s.a)(".name",$).text(c),Object(s.a)(".foundry",$).toggleClass("hidden",!m),Object(s.a)(".foundry a",$).text(m).attr("href",f),Object(s.a)(".description-wrapper",$).toggleClass("hidden",!v),Object(s.a)(".description-wrapper .description",$).text(v),Object(s.a)(".description-wrapper .more",$).attr("href",f),Object(s.a)(".language-wrapper",$).toggleClass("hidden",!d),Object(s.a)(".recommended-wrapper",$).toggleClass("hidden",!u),Object(s.a)(".recommended-wrapper .recommended",$).text(u),Object(s.a)(".promo",$).toggleClass("hidden","typetoday"!==o),Object(s.a)(".promo a",$).attr("href",g.web_link);var T=Object(s.a)(".description-wrapper .description",$);Object(s.a)(".description-wrapper",$).toggleClass("huge",T.height()==parseInt(T.css("max-height"),10)),O.attr("data-font-provider",o).attr("data-font-id",n).attr("data-font-name",c),this.checkAddRemoveState(O)}},toggleLanguage:function(t){var e=Object(s.a)(t.currentTarget);Object(s.a)(t.target).closest(".filter.language").length||e.toggleClass("active")},closeLanguage:function(t){Object(s.a)(t.target).closest(".language-wrapper").length||this.$(".language-wrapper").removeClass("active")},updateLangs:function(t){var e=t.find("div.active"),i=[];e.each((function(){i.push(Object(s.a)(this).text())})),t.closest(".language-wrapper").find(".caption").text(i.length?i.join(", "):"Language Support")},onFilterMouseEnter:function(t){var e=Object(s.a)(t.target);if(e.attr("data-alt")){var i=e.parent().prevAll(".filter-caption").first();i.text(e.attr("data-alt")),clearTimeout(i.data("clear-timer"))}},onFilterMouseLeave:function(t){var e=Object(s.a)(t.target);if(e.attr("data-alt")){var i=e.parent().prevAll(".filter-caption").first();i.data("clear-timer",setTimeout((function(){i.text(i.attr("data-initial"))}),100))}},onSizeLetterClick:function(t){var e=Object(s.a)(t.target),i=this.sizeSlider.slider("value"),o=e.hasClass("top-letter")?1:-1;this.sizeSlider.slider("value",i+o)},onBodyKey:function(t){this.$(".search-input").is(":focus")||(t.keyCode!=s.a.keycodes.esc&&t.keyCode!=s.a.keycodes.backspace||(t.preventDefault(),t.stopPropagation()),"keyup"==t.type&&(t.keyCode==s.a.keycodes.esc&&(this.$(".font-explorer-wrapper").hasClass("info-mode")?this.closeInfo():this.hide()),t.keyCode==s.a.keycodes.backspace&&(this.$(".font-explorer-wrapper").hasClass("info-mode")?this.closeInfo():this.hide()),t.keyCode==s.a.keycodes.f&&this.toggleSearch()))},onMouseWheel:function(t){t&&t.stopPropagation(),t&&t.preventDefault()},disableMouseWheel:function(){Object(s.a)(document).bind("mousewheel",this.onMouseWheel)},enableMouseWheel:function(){Object(s.a)(document).unbind("mousewheel",this.onMouseWheel)},show:function(){if(!this.rendered)return this.render(),void a.a.defer(this.show);this.disableMouseWheel(),this.$block_layer=RM.constructorRouter.showBlockLayer(this.hide),this.$el.removeClass("show-out").addClass("show-in").css("display","block"),setTimeout(a.a.bind((function(){this.$el.removeClass("show-in")}),this),20),setTimeout(a.a.bind((function(){this.$el.css("width","+=1")}),this),300),setTimeout(a.a.bind((function(){this.$el.css("width","-=1")}),this),300),Object(s.a)("body").on("keypress keyup keydown",this.onBodyKey),this.shown=!0},hide:function(t){t&&t.stopPropagation(),this.enableMouseWheel(),RM.constructorRouter.hideBlockLayer(this.$block_layer),Object(s.a)("body").off("keypress keyup keydown",this.onBodyKey),this.$el.addClass("show-out"),setTimeout(a.a.bind((function(){this.$el.css("display","none")}),this),200),r.b.getFocusBack(),this.$(".language-wrapper").removeClass("active"),RM.constructorRouter.fonts.clearTempFonts(),this.shown=!1},toggle:function(){this.shown?this.hide():this.show(),this.trigger("toggle")}}),f=i("o3C3"),v=i.n(f),b=i("YqYG");RM.views.fontExplorer=new m;var _=n.a.View.extend({name:"FontSelector",initialize:function(t){this.model=RM.constructorRouter.fonts,this.settings={},this.old_fonts=[],a.a.bindAll(this),a.a.extend(this.settings,t),this.mag=RM.constructorRouter.mag.toJSON(),this.settings.canUploadFonts=RM.constructorRouter.isOwner?(RM.constructorRouter.me.get("permissions")||{}).can_use_custom_fonts:this.mag.user.permissions.can_use_custom_fonts,this.settings.canEditCustomFonts=this.mag.doesUserHaveAccess,this.template=v.a["template-constructor-helpers-font-selector"],this.item_template=v.a["template-constructor-helpers-font-selector-item"],this.create()},create:function(){this.render(),this.switchToCategory(this.model.get("fonts_tab")||"custom"),this.model.on("change:fonts",this.onFontsChange)},render:function(){var t=this.settings.css&&this.settings.css.left||0,e=this.settings.css&&this.settings.css.top||0;this.setElement(Object(s.a)(this.template({})).css({display:"none",left:t,top:e})),this.settings.$parent.append(this.$el),this.$addFontPopup=this.$(".add-font-popup"),this.$el.on("click",".tabs-switcher .caption-system",a.a.bind((function(){this.switchToCategory("system"),RM.analytics&&RM.analytics.sendEvent("Font Selector Switch to Category","system")}),this)),this.$el.on("click",".tabs-switcher .caption-custom",a.a.bind((function(){this.switchToCategory("custom"),RM.analytics&&RM.analytics.sendEvent("Font Selector Switch to Category","custom")}),this)),this.$el.on("click",this.onGlobalClickHandler),this.$el.on("mouseenter",".category-element .caption",this.checkTitleShowForLongFontName),this.$el.on("click",".category-element .edit-custom-font",this.onEditCustomFontClick),this.$el.on("click",".add-font-button",this.onAddFontButtonClick),this.onFontsChange(),this.scroll={system:this.createScroll("system"),custom:this.createScroll("custom")},this.settings.canEditCustomFonts||this.$(".add-font-button[data-type=upload]").remove()},onFontsChange:function(){var t=this.old_fonts,e=this.model.get("fonts"),i=a.a.map(t,(function(t){return t.provider+"|"+t.css_name})),o=a.a.map(e,(function(t){return t.provider+"|"+t.css_name})),n=this;clearTimeout(this.reinitTimeout);var r=a.a.difference(o,i),l=a.a.difference(i,o),c=a.a.intersection(i,o);a.a.each(r,(function(t){var e=t.split("|"),i=e[0],o=e[1],a=n.$(".categories .scroll-wrapper."+("system"==i?"system":"custom")+" .category"),r=n.model.findFontByCSSName(o),l=n.model.getProviderData(i),c=Object(s.a)(n.item_template({provider_data:l,font:r,canUploadFonts:n.settings.canUploadFonts,canEditCustomFonts:n.settings.canEditCustomFonts})).addClass("collapsed");if(setTimeout((function(){c.removeClass("collapsed")}),15),0==a.find(".category-element").length)c.appendTo(a);else{var h=!1;a.find(".category-element").each((function(){var t=Object(s.a)(this);if(t.find(".caption").text().toLowerCase()>r.name.toLowerCase())return c.insertBefore(t),h=!0,!1})),h||c.appendTo(a)}})),a.a.each(l,(function(t){var e=t.split("|"),i=e[0],s=e[1],o=n.$(".categories .scroll-wrapper."+("system"==i?"system":"custom")+" .category"),a=(n.model.findFontByCSSName(s),n.model.getProviderData(i),o.find('.category-element[data-provider="'+i+'"][data-css_name="'+s+'"]'));a.addClass("collapsed"),setTimeout((function(){a.remove()}),300)})),a.a.each(c,(function(t){var e=t.split("|"),i=e[0],s=e[1],o=n.$(".categories .scroll-wrapper."+("system"==i?"system":"custom")+" .category"),a=n.model.findFontByCSSName(s),r=o.find('.category-element[data-provider="'+i+'"][data-css_name="'+s+'"]');r.toggleClass("hidden",!!a.hidden).find(".caption").text(a.name),a.hidden&&r.removeClass("active")})),this.old_fonts=a.a.cloneWithObjects(e),this.reinitTimeout=setTimeout(this.reinitScrolls,250)},checkTitleShowForLongFontName:function(t){var e=t.currentTarget,i=Object(s.a)(e);e.offsetWidth<e.scrollWidth&&!i.attr("title")&&i.attr("title",i.text())},onEditCustomFontClick:function(t){var e=Object(s.a)(t.currentTarget).closest(".category-element").attr("data-css_name"),i=this.model.get("fonts"),o=a.a.findWhere(i,{css_name:e});this.showFontUploadPanel(o),RM.analytics&&RM.analytics.sendEvent("Font Selector Edit Custom Font")},scrollFontsToActive:function(t,e){var i=this.$(".categories .scroll-wrapper."+t),s=this.$(".categories .scroll-wrapper."+t+" .category-wrapper"),o=s.find(".category-element.active").eq(0),n=!0;if(1==o.length){i.is(":visible")||(i.css("display","block"),n=!1);var a=o.position().top,r=o.height(),l=s.height(),c=Math.floor(a-(l-r)/2);n?s.stop().animate({scrollTop:c},e):(s.stop().scrollTop(c),i.css("display","none"))}},reinitScrolls:function(){a.a.each(this.scroll,(function(t){t.recalc()}))},createScroll:function(t){var e=Object(s.a)(this.$(".categories .scroll-wrapper."+t));return e.RMScroll({$container:e.find(".category-wrapper"),$content:e.find(".category-wrapper .category"),$handle:e.find(".scroll"),gap_start:8,gap_end:8}).data("scroll")},onGlobalClickHandler:function(t){var e=Object(s.a)(t.target),i=e.closest(".category-element"),o=i.attr("data-css_name");if(e.hasClass("action")&&e.parent().hasClass("category-element")){var n,a;!RM.constructorRouter.isOwner&&this.settings.canEditCustomFonts&&(n=this.mag.user._id,a=this.mag.num_id),this.model.changeFontHidden(o,!i.hasClass("hidden"),n,a).error&&new u({$parent:e});var r=i.hasClass("hidden")?"delete":"restore";RM.analytics&&RM.analytics.sendEvent("Font Selector Edit List",r)}if(e.hasClass("caption")&&e.parent().hasClass("category-element")){if(i.hasClass("disabled"))return void(i.hasClass("personal")&&this.showUpgradeAlert({type:"type-upload-fonts"},"use custom font"));this.setActiveFont([o]),this.trigger("selectfont",o)}this.isAddFontPopupVisible&&!e.closest(".add-font").length&&this.toggleAddFontPopup()},setActiveFont:function(t,e){this.$(".categories .category-element").removeClass("active"),a.a.each(t,a.a.bind((function(t){this.$('.categories .category-element[data-css_name="'+t+'"]').addClass("active")}),this)),void 0!==e&&(this.scrollFontsToActive("system",e),this.scrollFontsToActive("custom",e))},show:function(t){this._initialTab=this.model.get("fonts_tab"),this._initialFonts=this.model.get("fonts"),Object(g.a)("fontselector"),this.$el.fadeIn(150),this.setActiveFont(t,0),this.reinitScrolls(),RM.analytics&&RM.analytics.sendEvent("Font Selector Show")},hide:function(t){this.$el.fadeOut(150),(this._initialTab||this._initialFonts)&&(a.a.isEqual(this.model.get("fonts_tab"),this._initialTab)&&a.a.isEqual(this.model.get("fonts"),this._initialFonts)||this.model.save({},{silent:!0}))},switchToCategory:function(t){"system"!=t&&"custom"!=t&&(t="custom"),this.model.set({fonts_tab:t},{silent:!0}),this.$(".tabs-switcher .caption-"+t).addClass("active").siblings().removeClass("active"),"system"==t?this.$(".add-font").stop().fadeOut():this.$(".add-font").stop().fadeIn();var e=this.$(".categories > div:visible").eq(0),i=this.$(".categories .scroll-wrapper."+t);if(!e.is(i)){if(0==e.length)i.css("display","block");else{var s=e.index()<i.index()?1:-1;i.css({display:"block",opacity:0,"margin-left":8*s}).animate({opacity:1,"margin-left":0},300),e.animate({opacity:0,"margin-left":-8*s},300,(function(){this.setAnimation=!1,e.css("display","none")}))}this.reinitScrolls()}},toggleAddFontPopup:function(){this.$addFontPopup.toggleClass("invisible",!!this.isAddFontPopupVisible),this.isAddFontPopupVisible=!this.isAddFontPopupVisible},onAddFontButtonClick:function(t){switch(Object(s.a)(t.currentTarget).attr("data-type")){case"library":this.toggleFontExplorer();break;case"upload":this.canUploadFonts()&&this.showFontUploadPanel()}},canUploadFonts:function(){return this.settings.canUploadFonts||this.showUpgradeAlert({type:"type-upload-fonts"},"upload font"),this.settings.canUploadFonts},showUpgradeAlert:function(t,e){a.a.extend(t,{is_contributor:!RM.constructorRouter.isOwner,owner_email:RM.constructorRouter.mag.get("user").email}),this.alertDuplicate=this.alertDuplicate||new b.a({$parent:Object(s.a)("body > .popups"),router:RM.constructorRouter,opts:t,alert_source:e}),this.alertDuplicate.render()},toggleFontExplorer:function(){RM.views.fontExplorer.toggle()},showFontUploadPanel:function(t){var e=this.$(".upload-font");this.fontUploader=new w({el:e,allFonts:this.model,fontParams:t,mag:this.mag}),this.fontUploader.show(),this.listenTo(this.fontUploader,"hide-font",function(t){var e=t.css_name;this.$(".category-element[data-css_name="+e+"]").find(".action").click()}.bind(this)),this.listenTo(this.fontUploader,"update-font",function(t){var e=t.css_name;this.trigger("selectfont",e)}.bind(this)),this.listenToOnce(this.fontUploader,"hide",function(){this.stopListening(this.fontUploader),this.fontUploader=null,this.isFontUploaderVisible=!1}.bind(this)),this.isFontUploaderVisible=!0},handleEscape:function(){return this.isFontUploaderVisible&&this.fontUploader.handleEscape()||!this.isFontUploaderVisible},destroy:function(){this.fontuploader&&this.fontuploader.remove(),this.fontuploader=null,this.model.off("change:fonts",this.onFontsChange),this.hide(),this.$el.remove()}}),w=n.a.View.extend({className:"upload-font",template:v.a["template-constructor-helpers-font-selector-upload"],templateWeights:v.a["template-constructor-helpers-font-selector-upload-weights"],events:{"keydown .font-name-input":"onFontNameKeydown","input .font-name-input":"onFontNameInput","click .uf-section.actions .done:not(.disabled)":"hide","click .button.add-weight:not(.disabled)":"onAddWeightClick","click .weight-item:not(.disabled)":"onWeightItemClick","click .button.select":"onSelectButtonClick","click .uf-panel.weights .delete-weight":"onDeleteWeightClick"},WEIGTS:{n1:"Thin",n2:"ExtraLight",n3:"Light",n4:"Regular",n5:"Medium",n6:"SemiBold",n7:"Bold",n8:"ExtraBold",n9:"Black",i1:"Thin Italic",i2:"ExtraLight Italic",i3:"Light Italic",i4:"Italic",i5:"Medium Italic",i6:"SemiBold Italic",i7:"Bold Italic",i8:"ExtraBold Italic",i9:"Black Italic"},SAVE_URL:"/api/customfonts",initialize:function(t){a.a.bindAll(this),a.a.extend(this,t);var e=n.a.Model.extend({urlRoot:this.SAVE_URL,idAttribute:"_id",defaults:{is_personal:!0}});t.fontParams=t.fontParams||{};var i=a.a.omit(t.fontParams,"variations"),s=a.a.map(t.fontParams.variations||[],(function(t){return{type:t}}));this.isNew=a.a.isEmpty(i),this.model=new e(i||{}),this.weights=new n.a.Collection(s),this.weights.comparator=function(t){var e=t.get("type");return e.slice(1)+e[0].replace("n","1").replace("i","2")},this.weights.sort()},render:function(t){this.$el.html(Object(s.a)(this.template(this.model.toJSON()))),this.$buttonAddWeight=this.$(".button.add-weight"),this.$buttonSelect=this.$(".button.select"),this.$buttonUpload=this.$(".button.upload"),this.$buttonDone=this.$(".uf-section.actions .done"),this.$fileUploader=Object(s.a)("#font-file-upload"),this.listenTo(this.weights,"add remove",this.renderVariations),this.listenTo(this.weights,"change",this.updateVariation),this.bindMainFileupload();var e=Object(s.a)(this.$(".uf-panel.weights .scroll-wrapper"));this.weightScroll=e.RMScroll({$container:e.find(".results-wrapper"),$content:e.find(".results"),$handle:e.find(".scroll"),gap_start:8,gap_end:88}).data("scroll"),this.renderVariations()},renderVariations:function(){this.$(".uf-panel.weights .list").html(this.templateWeights({weights:this.weights.toJSON(),names:this.WEIGTS,isUploadInProgress:a.a.findWhere(this.weights,{isUploading:!0}),_:a.a})),this.updateWeightSelector(),this.bindWeightFileuploads(),this.weightScroll.recalc()},updateVariation:function(t){var e=t.get("type"),i=this.$(".uf-panel.weights .weight[data-type="+e+"]");i.find(".name").text(this.WEIGTS[e]),i.find(".reupload-weight").toggleClass("animate",!!t.get("isUploading")),this.$(".delete-weight").toggleClass("disabled",!!t.get("isUploading")),this.$(".uf-panel.weights .list").toggleClass("uploading",!!t.get("isUploading")),this.$buttonAddWeight.toggleClass("disabled",!!t.get("isUploading"))},updateWeightSelector:function(){a.a.each(a.a.keys(this.WEIGTS),function(t){var e=!!this.weights.findWhere({type:t});this.$(".weight-item[data-var="+t+"]").toggleClass("disabled",e)}.bind(this))},bindMainFileupload:function(){Object(s.a)(this.$fileUploader).fileupload({dataType:"json",fileInput:this.$fileUploader,paramName:"upload",dropZone:this.$el,singleFileUploads:!0,acceptFileTypes:/(\.|\/)(woff)$/i,pasteZone:null,add:this.onUploadAdd,start:this.onUploadStart,done:this.onUploadDone,fail:this.onUploadFail,always:this.onUploadComplete}).bind("fileuploaddragover",function(t){if("uploader"!==this.currentPanel)return!1;clearTimeout(this.dragoverTimeout),this.dragoverTimeout=setTimeout(function(){this.$el.removeClass("file-dragover")}.bind(this),300),this.$el.hasClass("file-dragover")||this.$el.addClass("file-dragover")}.bind(this)).bind("fileuploaddrop",function(t,e){if("uploader"!==this.currentPanel)return!1}.bind(this))},bindWeightFileuploads:function(){this.reUploadXHR&&this.reUploadXHR.abort(),Object(s.a)(this.$(".uf-panel.weights .font-file-re-upload")).fileupload({dataType:"json",fileInput:this.$buttons,paramName:"upload",singleFileUploads:!0,acceptFileTypes:/(\.|\/)(woff)$/i,pasteZone:null,add:this.onReuploadEvent,start:this.onReuploadEvent,done:this.onReuploadEvent,fail:this.onReuploadEvent,always:this.onReuploadEvent})},onReuploadEvent:function(t,e){var i=Object(s.a)(t.target).closest(".weight").attr("data-type"),o=this.weights.findWhere({type:i});if(o)switch(t.type){case"fileuploadadd":if(!this.checkFile(e))return;this.reUploadXHR=e.submit();break;case"fileuploadstart":o.set("isUploading",!0);break;case"fileuploaddone":o.set("woff",e.result.woffUrl),this.saveFont();break;case"fileuploadalways":o.set("isUploading",!1)}},onUploadAdd:function(t,e){this.checkFile(e)&&(this.uploadXHR=e.submit())},checkFile:function(t){return/\.woff$/i.test((t.files||[{}])[0].name)},onUploadStart:function(t,e){var i=new n.a.Model({type:this.selectedVar});this.weights.add(i),i.set("isUploading",!0),this.switchToPanel("weights"),this.$buttonAddWeight.addClass("disabled"),RM.analytics&&RM.analytics.sendEvent("Font Selector Custom Font Panel Upload Weight")},onUploadDone:function(t,e){this.weights.findWhere({type:this.selectedVar}).set("woff",e.result.woffUrl),this.saveFont()},onUploadFail:function(t,e){var i=this.weights.findWhere({type:this.selectedVar});this.weights.remove(i)},onUploadComplete:function(t,e){var i=this.weights.findWhere({type:this.selectedVar});i&&i.set("isUploading",!1),this.$buttonAddWeight.removeClass("disabled")},show:function(){Object(g.a)("fontuploader"),this.render(),this.switchToPanel("weights"),this.onFontNameInput(),a.a.defer(function(){this.$el.removeClass("invisible"),a.a.delay(function(){this.isNew&&this.$(".font-name-input").focus(),this.weightScroll.recalc()}.bind(this),200)}.bind(this)),RM.analytics&&RM.analytics.sendEvent("Font Selector Show Custom Font Panel")},hide:function(t){this.uploadXHR&&this.uploadXHR.abort(),this.reUploadXHR&&this.reUploadXHR.abort(),this.$el.addClass("invisible"),this.undelegateEvents(),a.a.delay(function(){this.$el.empty(),this.trigger("hide")}.bind(this),200)},onFontNameKeydown:function(t){var e=this.$(".font-name-input").val().trim();t.keyCode==s.a.keycodes.enter&&e&&e!==this.model.get("name")&&this.saveFont()},onFontNameInput:function(){var t=this.$(".font-name-input").val().trim();this.$(".uf-section.weight-list").toggleClass("invisible",!t),this.$buttonDone.toggleClass("disabled",!t)},switchToPanel:function(t){this.currentPanel=t,this.$(".uf-panel."+t).removeClass("invisible").siblings(".uf-panel").addClass("invisible")},hidePanel:function(t){this.$(".uf-panel"+t).removeClass("invisible").siblings(".uf-panel").addClass("invisible")},onAddWeightClick:function(){this.switchToPanel("selector")},onWeightItemClick:function(t){var e=Object(s.a)(t.currentTarget);this.selectedVar=e.attr("data-var"),this.$buttonSelect.text(this.WEIGTS[this.selectedVar]),this.switchToPanel("uploader"),RM.analytics&&RM.analytics.sendEvent("Font Selector Custom Font Panel Select Weight",this.WEIGTS[this.selectedVar])},onSelectButtonClick:function(t){this.switchToPanel("selector")},onDeleteWeightClick:function(t){var e=Object(s.a)(t.currentTarget).closest(".weight"),i=e.attr("data-type"),o=this.weights.findWhere({type:i});if(!e.hasClass("uploading"))return!this.isNew&&this.weights.length<2?(this.model.get("hidden")||this.trigger("hide-font",{css_name:this.model.get("css_name")}),void this.hide()):void a.a.defer(function(){this.weights.remove(o),this.saveFont()}.bind(this));this.uploadXHR&&this.uploadXHR.abort()},handleEscape:function(){return"weights"!==this.currentPanel?this.switchToPanel("weights"):this.hide(),!1},saveFont:function(){var t=this.$(".font-name-input"),e=t.val().trim()||this.model.get("name"),i=this.weights.map((function(t){return a.a.pick(t.toJSON(),"type","woff")}));if(e&&i.length){var s={name:e,variations:i,is_personal:!0};!RM.constructorRouter.isOwner&&this.mag.doesUserHaveAccess&&(s.mag_user=this.mag.user._id,s.mag_num_id=this.mag.num_id),this.model.save(s,{url:this.SAVE_URL,success:function(e){this.isNew=!1;var i=a.a.pluck(e.get("variations"),"type");this.weights.reset(e.get("variations")),t.val(e.get("name"));var s=this.model.get("css_name");this.allFonts.addFonts([{provider:"custom",css_name:s,css_url:this.model.get("css_url"),signed_css_url:this.model.get("signed_css_url"),name:this.model.get("name"),variations:i,is_personal:!0,_id:this.model.get("_id")}],"font-upload"),this.trigger("update-font",{css_name:s})}.bind(this)})}},destroy:function(){}});e.a=_},avvt:function(t,e,i){"use strict";var s=i("xi34"),o=i("q1z7"),n=i.n(o),a=i("rFsW"),r=i("Rh5U"),l=i.n(r),c=i("0sUV"),h=i("OTSC"),d=i("DqjY"),p=i("3eHG"),u=i("phNm"),g=i("BrCd"),m=i.n(g),f=function(t,e){return new Intl.NumberFormat(window.navigator.language||"en-US",{style:"currency",currency:e}).format(t)};function v(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var b={props:{value:{},options:{type:Function,default:function(){return[]}},inputClass:{type:String,default:"form-input"},isDesktop:{type:Boolean,default:!1},callback:{type:Function,default:function(){}}},data:function(){return{isOpened:!1,selectOptions:this.options()}},computed:{caption:function(){var t=this,e=this.selectOptions.find((function(e){return e.value===t.value}));return e?e.caption:void 0},inputClassObj:function(){var t;return v(t={},this.inputClass,this.inputClass),v(t,"selected","default"!==this.value),t}},methods:{onClick:function(){this.isDesktop&&(this.isOpened=!this.isOpened)},onChange:function(t){this.$emit("change",t.target.value),this.callback(t.target.value)},onItemClick:function(t){this.isOpened=!this.isOpened,this.$emit("change",t.value),this.callback(t.value)}}},_=(i("qfna"),i("KHd+")),w=Object(_.a)(b,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"rm-native-select-container",attrs:{role:"combobox","aria-expanded":t.isOpened}},[i("input",{staticClass:"rm-native-fake-select",class:t.inputClassObj,attrs:{type:"text",readonly:"readonly",tabindex:"-1"},domProps:{value:t.caption},on:{click:t.onClick}}),t._v(" "),i("div",{staticClass:"expand-arrow"},[i("svg",{attrs:{width:"10px",height:"7px",viewBox:"0 0 10 7",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[i("g",{attrs:{transform:"translate(-1110.000000, -138.000000)",fill:"#FFFFFF"}},[i("g",{attrs:{transform:"translate(904.000000, 101.000000)"}},[i("path",{attrs:{id:"arrow-copy",d:"M208.385799,39.7407434 L212.849209,35.914964 C213.268534,35.5555419 213.899834,35.6041034 214.259257,36.0234293 C214.414608,36.2046724 214.5,36.4355094 214.5,36.6742206 L214.5,44.3257794 C214.5,44.8780641 214.052285,45.3257794 213.5,45.3257794 C213.261289,45.3257794 213.030452,45.2403872 212.849209,45.085036 L208.385799,41.2592566 C207.966474,40.8998345 207.917912,40.2685345 208.277334,39.8492086 C208.310659,39.8103298 208.346921,39.7740681 208.385799,39.7407434 Z",transform:"translate(211.000000, 40.500000) scale(-1, -1) rotate(-270.000000) translate(-211.000000, -40.500000) "}})])])])])]),t._v(" "),t.isDesktop?t._e():i("select",{staticClass:"rm-native-select",on:{change:function(e){return t.onChange(e)}}},t._l(t.selectOptions,(function(e){return i("option",{key:e.value,staticClass:"rm-native-select-item",domProps:{value:e.value}},[t._v(t._s(e.caption))])})),0),t._v(" "),t.isDesktop?i("div",{staticClass:"rm-native-select-popup",class:{opened:t.isOpened},attrs:{role:"listbox"}},t._l(t.selectOptions,(function(e){return i("div",{key:e.value,staticClass:"rm-native-select-popup-item",class:{current:e.value===t.value},on:{click:function(i){return t.onItemClick(e)}}},[t._v("\n      "+t._s(e.caption)+"\n    ")])})),0):t._e()])}),[],!1,null,"d29d1bc2",null).exports,y=[{value:"AF",caption:"Afghanistan"},{value:"AX",caption:"Aland Islands"},{value:"AL",caption:"Albania"},{value:"DZ",caption:"Algeria"},{value:"AS",caption:"American Samoa"},{value:"AD",caption:"Andorra"},{value:"AO",caption:"Angola"},{value:"AI",caption:"Anguilla"},{value:"AQ",caption:"Antarctica"},{value:"AG",caption:"Antigua and Barbuda"},{value:"AR",caption:"Argentina"},{value:"AM",caption:"Armenia"},{value:"AW",caption:"Aruba"},{value:"AU",caption:"Australia"},{value:"AT",caption:"Austria"},{value:"AZ",caption:"Azerbaijan"},{value:"BS",caption:"Bahamas"},{value:"BH",caption:"Bahrain"},{value:"BD",caption:"Bangladesh"},{value:"BB",caption:"Barbados"},{value:"BY",caption:"Belarus"},{value:"BE",caption:"Belgium"},{value:"BZ",caption:"Belize"},{value:"BJ",caption:"Benin"},{value:"BM",caption:"Bermuda"},{value:"BT",caption:"Bhutan"},{value:"BO",caption:"Bolivia, Plurinational State of"},{value:"BQ",caption:"Bonaire, Sint Eustatius and Saba"},{value:"BA",caption:"Bosnia and Herzegovina"},{value:"BW",caption:"Botswana"},{value:"BV",caption:"Bouvet Island"},{value:"BR",caption:"Brazil"},{value:"IO",caption:"British Indian Ocean Territory"},{value:"BN",caption:"Brunei Darussalam"},{value:"BG",caption:"Bulgaria"},{value:"BF",caption:"Burkina Faso"},{value:"BI",caption:"Burundi"},{value:"KH",caption:"Cambodia"},{value:"CM",caption:"Cameroon"},{value:"CA",caption:"Canada"},{value:"CV",caption:"Cape Verde"},{value:"KY",caption:"Cayman Islands"},{value:"CF",caption:"Central African Republic"},{value:"TD",caption:"Chad"},{value:"CL",caption:"Chile"},{value:"CN",caption:"China"},{value:"CX",caption:"Christmas Island"},{value:"CC",caption:"Cocos (Keeling) Islands"},{value:"CO",caption:"Colombia"},{value:"KM",caption:"Comoros"},{value:"CG",caption:"Congo"},{value:"CD",caption:"Congo, the Democratic Republic of the"},{value:"CK",caption:"Cook Islands"},{value:"CR",caption:"Costa Rica"},{value:"CI",caption:"Cte d'Ivoire"},{value:"HR",caption:"Croatia"},{value:"CU",caption:"Cuba"},{value:"CW",caption:"Curaao"},{value:"CY",caption:"Cyprus"},{value:"CZ",caption:"Czech Republic"},{value:"DK",caption:"Denmark"},{value:"DJ",caption:"Djibouti"},{value:"DM",caption:"Dominica"},{value:"DO",caption:"Dominican Republic"},{value:"EC",caption:"Ecuador"},{value:"EG",caption:"Egypt"},{value:"SV",caption:"El Salvador"},{value:"GQ",caption:"Equatorial Guinea"},{value:"ER",caption:"Eritrea"},{value:"EE",caption:"Estonia"},{value:"ET",caption:"Ethiopia"},{value:"FK",caption:"Falkland Islands (Malvinas)"},{value:"FO",caption:"Faroe Islands"},{value:"FJ",caption:"Fiji"},{value:"FI",caption:"Finland"},{value:"FR",caption:"France"},{value:"GF",caption:"French Guiana"},{value:"PF",caption:"French Polynesia"},{value:"TF",caption:"French Southern Territories"},{value:"GA",caption:"Gabon"},{value:"GM",caption:"Gambia"},{value:"GE",caption:"Georgia"},{value:"DE",caption:"Germany"},{value:"GH",caption:"Ghana"},{value:"GI",caption:"Gibraltar"},{value:"GR",caption:"Greece"},{value:"GL",caption:"Greenland"},{value:"GD",caption:"Grenada"},{value:"GP",caption:"Guadeloupe"},{value:"GU",caption:"Guam"},{value:"GT",caption:"Guatemala"},{value:"GG",caption:"Guernsey"},{value:"GN",caption:"Guinea"},{value:"GW",caption:"Guinea-Bissau"},{value:"GY",caption:"Guyana"},{value:"HT",caption:"Haiti"},{value:"HM",caption:"Heard Island and McDonald Islands"},{value:"VA",caption:"Holy See (Vatican City State)"},{value:"HN",caption:"Honduras"},{value:"HK",caption:"Hong Kong"},{value:"HU",caption:"Hungary"},{value:"IS",caption:"Iceland"},{value:"IN",caption:"India"},{value:"ID",caption:"Indonesia"},{value:"IR",caption:"Iran, Islamic Republic of"},{value:"IQ",caption:"Iraq"},{value:"IE",caption:"Ireland"},{value:"IM",caption:"Isle of Man"},{value:"IL",caption:"Israel"},{value:"IT",caption:"Italy"},{value:"JM",caption:"Jamaica"},{value:"JP",caption:"Japan"},{value:"JE",caption:"Jersey"},{value:"JO",caption:"Jordan"},{value:"KZ",caption:"Kazakhstan"},{value:"KE",caption:"Kenya"},{value:"KI",caption:"Kiribati"},{value:"KP",caption:"Korea, Democratic People's Republic of"},{value:"KR",caption:"Korea, Republic of"},{value:"KW",caption:"Kuwait"},{value:"KG",caption:"Kyrgyzstan"},{value:"LA",caption:"Lao People's Democratic Republic"},{value:"LV",caption:"Latvia"},{value:"LB",caption:"Lebanon"},{value:"LS",caption:"Lesotho"},{value:"LR",caption:"Liberia"},{value:"LY",caption:"Libya"},{value:"LI",caption:"Liechtenstein"},{value:"LT",caption:"Lithuania"},{value:"LU",caption:"Luxembourg"},{value:"MO",caption:"Macao"},{value:"MK",caption:"Macedonia, the Former Yugoslav Republic of"},{value:"MG",caption:"Madagascar"},{value:"MW",caption:"Malawi"},{value:"MY",caption:"Malaysia"},{value:"MV",caption:"Maldives"},{value:"ML",caption:"Mali"},{value:"MT",caption:"Malta"},{value:"MH",caption:"Marshall Islands"},{value:"MQ",caption:"Martinique"},{value:"MR",caption:"Mauritania"},{value:"MU",caption:"Mauritius"},{value:"YT",caption:"Mayotte"},{value:"MX",caption:"Mexico"},{value:"FM",caption:"Micronesia, Federated States of"},{value:"MD",caption:"Moldova, Republic of"},{value:"MC",caption:"Monaco"},{value:"MN",caption:"Mongolia"},{value:"ME",caption:"Montenegro"},{value:"MS",caption:"Montserrat"},{value:"MA",caption:"Morocco"},{value:"MZ",caption:"Mozambique"},{value:"MM",caption:"Myanmar"},{value:"NA",caption:"Namibia"},{value:"NR",caption:"Nauru"},{value:"NP",caption:"Nepal"},{value:"NL",caption:"Netherlands"},{value:"NC",caption:"New Caledonia"},{value:"NZ",caption:"New Zealand"},{value:"NI",caption:"Nicaragua"},{value:"NE",caption:"Niger"},{value:"NG",caption:"Nigeria"},{value:"NU",caption:"Niue"},{value:"NF",caption:"Norfolk Island"},{value:"MP",caption:"Northern Mariana Islands"},{value:"NO",caption:"Norway"},{value:"OM",caption:"Oman"},{value:"PK",caption:"Pakistan"},{value:"PW",caption:"Palau"},{value:"PS",caption:"Palestine, State of"},{value:"PA",caption:"Panama"},{value:"PG",caption:"Papua New Guinea"},{value:"PY",caption:"Paraguay"},{value:"PE",caption:"Peru"},{value:"PH",caption:"Philippines"},{value:"PN",caption:"Pitcairn"},{value:"PL",caption:"Poland"},{value:"PT",caption:"Portugal"},{value:"PR",caption:"Puerto Rico"},{value:"QA",caption:"Qatar"},{value:"RE",caption:"Runion"},{value:"RO",caption:"Romania"},{value:"RU",caption:"Russian Federation"},{value:"RW",caption:"Rwanda"},{value:"BL",caption:"Saint Barthlemy"},{value:"SH",caption:"Saint Helena, Ascension and Tristan da Cunha"},{value:"KN",caption:"Saint Kitts and Nevis"},{value:"LC",caption:"Saint Lucia"},{value:"MF",caption:"Saint Martin (French part)"},{value:"PM",caption:"Saint Pierre and Miquelon"},{value:"VC",caption:"Saint Vincent and the Grenadines"},{value:"WS",caption:"Samoa"},{value:"SM",caption:"San Marino"},{value:"ST",caption:"Sao Tome and Principe"},{value:"SA",caption:"Saudi Arabia"},{value:"SN",caption:"Senegal"},{value:"RS",caption:"Serbia"},{value:"SC",caption:"Seychelles"},{value:"SL",caption:"Sierra Leone"},{value:"SG",caption:"Singapore"},{value:"SX",caption:"Sint Maarten (Dutch part)"},{value:"SK",caption:"Slovakia"},{value:"SI",caption:"Slovenia"},{value:"SB",caption:"Solomon Islands"},{value:"SO",caption:"Somalia"},{value:"ZA",caption:"South Africa"},{value:"GS",caption:"South Georgia and the South Sandwich Islands"},{value:"SS",caption:"South Sudan"},{value:"ES",caption:"Spain"},{value:"LK",caption:"Sri Lanka"},{value:"SD",caption:"Sudan"},{value:"SR",caption:"Suriname"},{value:"SJ",caption:"Svalbard and Jan Mayen"},{value:"SZ",caption:"Swaziland"},{value:"SE",caption:"Sweden"},{value:"CH",caption:"Switzerland"},{value:"SY",caption:"Syrian Arab Republic"},{value:"TW",caption:"Taiwan, Province of China"},{value:"TJ",caption:"Tajikistan"},{value:"TZ",caption:"Tanzania, United Republic of"},{value:"TH",caption:"Thailand"},{value:"TL",caption:"Timor-Leste"},{value:"TG",caption:"Togo"},{value:"TK",caption:"Tokelau"},{value:"TO",caption:"Tonga"},{value:"TT",caption:"Trinidad and Tobago"},{value:"TN",caption:"Tunisia"},{value:"TR",caption:"Turkey"},{value:"TM",caption:"Turkmenistan"},{value:"TC",caption:"Turks and Caicos Islands"},{value:"TV",caption:"Tuvalu"},{value:"UG",caption:"Uganda"},{value:"UA",caption:"Ukraine"},{value:"AE",caption:"United Arab Emirates"},{value:"GB",caption:"United Kingdom"},{value:"US",caption:"United States"},{value:"UM",caption:"United States Minor Outlying Islands"},{value:"UY",caption:"Uruguay"},{value:"UZ",caption:"Uzbekistan"},{value:"VU",caption:"Vanuatu"},{value:"VE",caption:"Venezuela, Bolivarian Republic of"},{value:"VN",caption:"Viet Nam"},{value:"VG",caption:"Virgin Islands, British"},{value:"VI",caption:"Virgin Islands, U.S."},{value:"WF",caption:"Wallis and Futuna"},{value:"EH",caption:"Western Sahara"},{value:"YE",caption:"Yemen"},{value:"ZM",caption:"Zambia"},{value:"ZW",caption:"Zimbabwe"}],k=i("3ED2"),C=i.n(k),x=i("+IKJ"),S=i("Kw5r"),P=i("Vxjr");function $(t,e,i,s,o,n,a){try{var r=t[n](a),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(s,o)}function O(t){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function T(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function M(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?T(i,!0).forEach((function(e){j(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):T(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function j(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var I=h.a.stripe_live?h.a.STRIPE_LIVE_PUBLIC_KEY:h.a.STRIPE_TEST_PUBLIC_KEY,E=Backbone.View.extend({template:m.a["template-viewer-cart-sidebar"],cardStyle:{base:{letterSpacing:"0.3px",color:"#0080FF",fontSize:"16px",fontFamily:"-apple-system, system-ui, BlinkMacSystemFont, 'Segoe UI', Ubuntu, 'Fira Sans', Roboto, 'Avenir Next', 'Helvetica Neue', Helvetica, Arial, sans-serif","::placeholder":{color:"#CFD7DF"},fontSmoothing:"antialiased"},invalid:{color:"#e5424d",":focus":{color:"#303238"}}},getRenderStatus:function(){return this.rendered},initialize:function(t){return a.a.bindAll(this),this.mag=t,this.environment=this.mag.router.environment,this.rendered=!1,this.haveSkus=!1,this.checkoutCompete=!1,this.isHiddenSettings=!0,this.activeTab="tab-items",this.orderLoading=!1,this.paymentLoading=!1,this.hoveredItem=null,this.shippingForm={name:{value:null,error:null,validationRules:[{title:"required"}]},phone:{value:null,error:null,validationRules:[{title:"phoneNumber"}]},line1:{value:null,error:null,validationRules:[{title:"required"}]},line2:{value:null,error:null,validationRules:[]},city:{value:null,error:null,validationRules:[{title:"required"}]},state:{value:null,error:null,validationRules:[]},country:{value:"default",error:null,validationRules:[{title:"required",func:function(t,e){return"default"===e?"field is required":null}}]},postal_code:{value:null,error:null,validationRules:[]},email:{value:null,error:null,validationRules:[{title:"required"},{title:"email"}]},note:{value:null,error:null,validationRules:[]}},this.cardHolderNameValue=null,this.clearShippingFormField_debounced=a.a.debounce(this.clearShippingFormField,200),this.render(),this},render:function(){var t=this;if(!RM.screenshot){var e=RM.viewerRouter?RM.viewerRouter.getUserPermissions():RM.constructorRouter.me.get("permissions");if(e&&e.can_use_e_commerce&&!this.mag.eCommerceManager.isConstructor()&&this.mag.eCommerceManager.haveEcommerceCartWidget&&this.mag.eCommerceManager.isMagConnectedToStripe()&&!this.rendered){this.rendered=!0,document.querySelectorAll("#cart-sidebar").length&&document.querySelectorAll("#cart-sidebar").forEach((function(t){return t.parentNode.removeChild(t)})),this.setElement(this.template({})),this.$el.appendTo(Object(s.a)("body")),this.$toolbar=Object(s.a)(".toolbar.for-viewer"),this.$tabs=this.$el.find(".cart-sidebar-tabs"),this.$items=this.$el.find(".cart-items-list"),this.$closeButton=this.$el.find(".close-button"),this.$footer=this.$el.find(".sidebar-footer"),this.$navButtons=this.$el.find(".sidebar-btn"),this.$itemsTab=this.$tabs.find(".tab-items"),this.$shippingTab=this.$tabs.find(".tab-inputs"),this.$orderTab=this.$tabs.find(".tab-order"),this.$paymentTab=this.$tabs.find(".tab-checkout"),this.$goToPayment=this.$orderTab.find(".cart-pay-btn"),this.$orderDetails=this.$orderTab.find(".order-details"),this.$orderItems=this.$orderTab.find(".order-items-list"),this.$orderError=this.$orderTab.find(".order-error"),this.$orderShippingAddress=this.$orderTab.find(".order-shipping-address"),this.$orderShippingMethod=this.$orderTab.find(".order-shipping-method"),this.$orderShippingEmail=this.$orderTab.find(".order-shipping-email"),this.$orderTax=this.$orderTab.find(".order-tax"),this.$orderTotalPrice=this.$orderTab.find(".order-total-price"),this.$paymentSuccess=this.$tabs.find("#payment-success-msg"),this.$paymentFailed=this.$tabs.find("#payment-failed-msg"),this.cartWidgetData=this.mag.eCommerceManager.getCartWidgetData(),this.environment===h.a.environment.preview&&(this.cartWidgetData&&this.cartWidgetData._id&&this.setupSettingsPanel(),RM.views.toolbar.on("previewClose",(function(){t.hideSidebar()})));var i=this.$el.find(".svg");return C()(i),this.$el.find("[data-alt]:not(.rmalttext)").RMAltText(),this.generateSidebarCSS(this.cartWidgetData),this.renderCartItems(),this.renderShippingForm(),this.initNavigation(),this.bindDomEvents(),this.mag.eCommerceManager.events.on("ecommerce:cartsidebar:visibility:changed",this.toggleSidebar),this.mag.eCommerceManager.events.on("ecommerce:cartdata:changed",this.renderCartItems),this}}},bindDomEvents:function(){this.$closeButton.on("click",this.closeSideBar.bind(this)),this.$tabs.find(".cart-cancel-btn").on("click",this.cancelOrder.bind(this)),Object(s.a)(document).on("mouseover",".cart-sidebar .sidebar-body .cart-item-block",this.cartItemBlockHover),Object(s.a)(document).on("mouseleave",".cart-sidebar .sidebar-body .cart-item-block",this.cartItemBlockLeave)},unbindDomEvents:function(){this.$closeButton.off("click",this.closeSideBar),this.$tabs.find(".cart-cancel-btn").off("click",this.cancelOrder),Object(s.a)(document).off("mouseover",".cart-sidebar .sidebar-body .cart-item-block",this.cartItemBlockHover),Object(s.a)(document).off("mouseleave",".cart-sidebar .sidebar-body .cart-item-block",this.cartItemBlockLeave)},hideSidebar:function(){this.$el.removeClass("show"),Object(s.a)("body").removeClass("cart-sidebar-shown"),Object(s.a)("html").removeClass("cart-disable-scroll"),!this.isHiddenSettings&&this.settingsPanel&&(this.isHiddenSettings=!0,this.settingsPanel.isHidden=this.isHiddenSettings)},toggleSidebar:function(t){t?(this.hideSidebar(),this.checkoutCompete&&(this.mag.eCommerceManager.clearCart(),this.goToInitialTab(),this.hideSuccessPaymentMessage(),this.$paymentFailed.empty()),this.clearOrderError()):(this.$el.addClass("show"),Object(s.a)("body").addClass("cart-sidebar-shown"),Object(s.a)("html").addClass("cart-disable-scroll"))},generateSidebarCSS:function(t){var e="cart_sidebar_styles_".concat(t._id),i=h.b.getRGBA(t["bar-color"],t["bar-color-opacity"]/100),o=h.b.getRGBA(t["bar-background-color"],t["bar-background-color-opacity"]/100),n=h.b.getRGBA(t["bar-color"],.45*t["bar-color-opacity"]/100),a=this.getAdditionalColor(o);this.cardStyle=M({},this.cardStyle,{base:M({},this.cardStyle.base,{color:i,fontWeight:t["bar-font-weight"],"::placeholder":{color:n}}),invalid:M({},this.cardStyle.invalid,{color:n,fontWeight:t["bar-font-weight"],":focus":{color:i},"::placeholder":{color:n}})});var r="    .cart-sidebar {\n\n      color: ".concat(i,";\n      background-color: ").concat(o,";\n      box-shadow: ").concat(t["bar-shadow"]?"0 0 4px rgba(124, 124, 125, 0.5)":"none",";\n      font-family: ").concat(t["bar-font-family"],";\n      font-weight: ").concat(t["bar-font-weight"],";\n      font-style: ").concat(t["bar-font-style"],";\n    }\n\n    .cart-sidebar textarea {\n\n      font-family: ").concat(t["bar-font-family"],";\n      font-weight: ").concat(t["bar-font-weight"],";\n      font-style: ").concat(t["bar-font-style"],";\n    }\n\n    .cart-sidebar input {\n\n      font-family: ").concat(t["bar-font-family"],";\n      font-weight: ").concat(t["bar-font-weight"],";\n      font-style: ").concat(t["bar-font-style"],";\n    }\n\n    .cart-sidebar button {\n\n      font-family: ").concat(t["bar-font-family"],";\n      font-weight: ").concat(t["bar-font-weight"],";\n      font-style: ").concat(t["bar-font-style"],";\n    }\n\n    .cart-sidebar select {\n\n      font-family: ").concat(t["bar-font-family"],";\n      font-weight: ").concat(t["bar-font-weight"],";\n      font-style: ").concat(t["bar-font-style"],";\n    }\n\n    .cart-sidebar .sidebar-btn {\n\n      color: ").concat(i,";\n      border-color: ").concat(n,";\n    }\n\n    .cart-sidebar .preloader svg path {\n\n      stroke: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-btn path {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .expand-arrow svg path {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .cart-cancel-btn {\n\n      color: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block.hover {\n\n      background-color: ").concat(a,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-attributes {\n\n      color: ").concat(n,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-price {\n\n      color: ").concat(n,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-items-quantity {\n\n      color: ").concat(n,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-remove-btn-icon path {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-decrease-btn-icon rect {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-increase-btn-icon path {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form, .cart-sidebar .sidebar-body .order-details-form .form-input {\n\n      color: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form .form-input::placeholder {\n\n      color: ").concat(n,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form .rm-native-fake-select {\n\n      color: ").concat(n,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form .rm-native-fake-select.selected {\n\n      color: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form svg path {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form .form-title {\n\n      color: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .form-error {\n\n      background-color: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form .rm-native-select-popup {\n\n      background-color: ").concat(a,";\n    }\n\n    .cart-sidebar .tab-order .order-details .order-title-row {\n\n      color: ").concat(n,";\n    }\n\n    .cart-sidebar .tab-order .order-details .rm-native-fake-select {\n\n      color: ").concat(i,";\n    }\n\n    .cart-sidebar .tab-checkout .payment-input {\n\n      color: ").concat(i,";\n    }\n\n    .cart-sidebar .tab-checkout .payment-input::placeholder {\n\n      color: ").concat(n,";\n    }\n\n    .cart-sidebar .tab-checkout #payment-failed-msg .error-icon {\n\n      border-color: ").concat(n,";\n    }\n\n    .cart-sidebar .tab-checkout #payment-failed-msg .error-icon svg g {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-footer .power-by-stripe path {\n\n      fill: ").concat(n,";\n    }\n\n    .cart-sidebar .sidebar-footer-mobile .power-by-stripe path {\n\n      fill: ").concat(n,";\n    }\n\n    .cart-sidebar .sidebar-footer .settings-button path {\n\n      stroke: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-footer .settings-button:hover path {\n\n      stroke: ").concat(n,";\n    }\n\n    .isphone .cart-sidebar .sidebar-body .cart-item-block {\n\n      background-color: ").concat(a,";\n    }");Object(s.a)("#".concat(e)).remove();var l=document.createElement("style");l.type="text/css",l.id=e,l.className="cart-sidebar-styles",l.appendChild(document.createTextNode(r)),document.querySelector("head").appendChild(l)},getAdditionalColor:function(t){return Object(x.c)(t)<.05&&Object(x.b)("#fff",t)-Object(x.b)("#000",t)>=8?Object(x.d)(.1,t):Object(x.a)(.1,t)},renderCartItems:function(){var t=this,e=this.mag.eCommerceManager.getCartData();if(e&&e.skus){var i=Object.keys(e.skus);this.$items.empty(),this.haveSkus=!!i.length,this.haveSkus?(this.$itemsTab.find(".sidebar-header").css("display","flex"),this.$itemsTab.find(".empty-cart").css("display","none")):(this.$itemsTab.find(".sidebar-header").css("display","none"),this.$itemsTab.find(".empty-cart").css("display","flex")),i.forEach((function(i){var o=e.skus[i];if(o.active){var n,a=t.hoveredItem===i,r=Object(s.a)("<div/>",{class:"cart-item-block ".concat(a?"hover":"")});r.data("sku-id",i),(o.image||o.productObject.images&&o.productObject.images.length)&&(n=Object(s.a)("<div/>",{class:"cart-item-image",css:{"background-position":"center center","background-size":"cover","background-repeat":"no-repeat","background-image":"url(".concat(o.image?o.image:o.productObject.images[0],")")}}),r.append(n));var l=Object(s.a)("<div/>",{class:n?"cart-item-title":"cart-item-title without-image"}).text(o.productObject.name),c=o.cart_count,d=(o.price/100).toFixed(2),p=f(d,o.currency),u=f((d*c).toFixed(2),o.currency),g=Object(s.a)("<div/>",{class:"cart-item-price"}).html(c>1?"Price: ".concat(p,"  ").concat(c," = ").concat(u):"Price: ".concat(p)),m=Object(s.a)("<div/>",{class:"cart-item-attributes"}),v=o.attributes;for(var b in v){var _=Object(s.a)("<div/>",{class:"cart-item-attribute"}).html("".concat(h.b.capitalize(b),": ").concat(v[b]));m.append(_)}var w=Object(s.a)("<div/>",{class:"cart-items-quantity"}).html("Quantity: ".concat(c)),y=Object(s.a)("<div/>",{class:"cart-item-remove-btn",title:"remove"}).attr("data-sku-id",i),k=Object(s.a)("<img/>",{class:"svg cart-item-remove-btn-icon",src:Object(P.b)("./viewer/cart-sidebar/cart-item-delete.svg")});y.append(k);var C=Object(s.a)("<div/>",{class:"cart-item-edit-group"}),x=Object(s.a)("<div/>",{class:"cart-item-increase-btn"}).attr("data-sku-id",i),S=Object(s.a)("<img/>",{class:"svg cart-item-increase-btn-icon",src:Object(P.b)("./viewer/cart-sidebar/cart-item-increase.svg")});if(x.append(S),C.append(x),t.mag.eCommerceManager.checkItemQuantity(i)&&(x.addClass("active"),x.on("click",t.onIncreaseItem)),c>1){var $=Object(s.a)("<div/>",{class:"cart-item-decrease-btn decrease-btn-".concat(i)}).attr("data-sku-id",i),O=Object(s.a)("<img/>",{class:"svg cart-item-decrease-btn-icon",src:Object(P.b)("./viewer/cart-sidebar/cart-item-decrease.svg")});$.append(O),C.append($),$.on("click",t.onDecreaseItem)}else{var T=t.$items.find("decrease-btn-".concat(i));T.off("click",t.onDecreaseItem),T.remove()}r.append(l).append(m).append(g).append(w).append(y).append(C),t.$items.append(r),y.on("click",t.onRemoveItem)}}));var o=this.$items.find(".svg");C()(o)}},renderShippingForm:function(){var t=this,e=a.a.clone(y);e.unshift({value:"default",caption:"Country"});var i=this.mag.eCommerceManager.getCartData(),o=i.shippingForm;o&&"object"===O(o)&&(this.shippingForm=o);var n=S.a.extend(w);this.countrySelect=new n({el:this.$tabs.find(".countries-select").get(0),propsData:{options:function(){return e},value:this.shippingForm.country.value,isDesktop:!1,callback:this.onCountryChange}}),i.shippableProducts?this.$shippingTab.find(".shipping-form").removeClass("hidden"):this.$shippingTab.find(".shipping-form").addClass("hidden"),this.$tabs.find(".order-details-form .form-input").each((function(e,i){var o=i.getAttribute("name");t.shippingForm[o]&&(i.value=t.shippingForm[o].value),Object(s.a)(i).on("input",t.onShippingFormChange)}))},updateShippingForm:function(){var t=this.mag.eCommerceManager.getShippingForm();t&&"object"===O(t)&&(this.shippingForm=t),this.mag.eCommerceManager.hasShippableProducts()?this.$shippingTab.find(".shipping-form").removeClass("hidden"):this.$shippingTab.find(".shipping-form").addClass("hidden")},onCountryChange:function(t){this.shippingForm.country.value=t,this.countrySelect.value=t,this.clearShippingFormField_debounced("country")},onShippingFormChange:function(t){var e=t.target.getAttribute("name");void 0!==this.shippingForm[e]&&"object"===O(this.shippingForm[e])&&(this.shippingForm[e].value=t.target.value,this.clearShippingFormField_debounced(e))},renderShippingFormErrors:function(){var t=this;Object.keys(this.shippingForm).forEach((function(e){t.shippingForm[e].error&&t.$shippingTab.find(".form-error.".concat(e,"-error")).removeClass("hidden")}))},clearShippingFormErrors:function(){var t=this;Object.keys(this.shippingForm).forEach((function(e){t.$tabs.find(".form-error.".concat(e,"-error")).addClass("hidden")}))},clearShippingFormField:function(t){if(void 0!==this.shippingForm[t]&&this.shippingForm[t].error){var e=this.validateShippingFormField(t);e&&e.success&&(this.$tabs.find(".form-error.".concat(t,"-error")).addClass("hidden"),this.shippingForm[t].error=null)}},validateShippingFormField:function(t){var e=this,i=[];if(void 0!==this.shippingForm[t])return this.shippingForm[t].validationRules.length?(this.shippingForm[t].validationRules.forEach((function(s){if("function"==typeof s.func){var o=s.func(t,e.shippingForm[t].value);o&&i.push(o)}else{var n=e["".concat(s.title,"Validation")](t,e.shippingForm[t].value);n&&i.push(n)}})),i.length?{success:!1,error:!0,errorMessages:i}:{success:!0}):{success:!0}},requiredValidation:function(t,e){return e?null:"field is required"},emailValidation:function(t,e){return e?h.b.isValidEmail(e)?null:"it's not email":null},phoneNumberValidation:function(t,e){return e?h.b.isValidPhoneNumber(e)?null:"it's not  phone number":null},validateShippingForm:function(){var t=!1;if(this.mag.eCommerceManager.hasShippableProducts())for(var e in this.shippingForm){var i=this.validateShippingFormField(e);i&&(i.success?this.shippingForm[e].error=null:(this.shippingForm[e].error=i.errorMessages,t=!0))}else{var s=this.validateShippingFormField("email");s&&(s.success?this.shippingForm.email.error=null:(this.shippingForm.email.error=s.errorMessages,t=!0))}return!t},initNavigation:function(){this.$tabs.find("[data-tab^='tab-']").each(function(t,e){Object(s.a)(e).on("click",function(){if(this.haveSkus){if("tab-inputs"===e.dataset.tab&&(this.updateShippingForm(),RM.analytics&&RM.analytics.sendEvent("Checkout 1st step completed")),"tab-order"===e.dataset.tab){if(!this.validateShippingForm())return void this.renderShippingFormErrors();this.clearShippingFormErrors(),RM.analytics&&RM.analytics.sendEvent("Checkout 2nd step completed");var t,i,s=this.mag.eCommerceManager.getShippingForm();s&&(t=a.a.mapObject(s,(function(t){return{value:t.value}})),i=a.a.mapObject(this.shippingForm,(function(t){return{value:t.value}}))),(!s||s&&!a.a.isEqual(t,i))&&this.mag.eCommerceManager.setShippingForm(this.shippingForm),this.renderOrderTab()}"tab-checkout"===e.dataset.tab&&(RM.analytics&&RM.analytics.sendEvent("Checkout 3rd step completed"),this.renderCheckoutForm()),this.goToTabByClassname("."+e.dataset.tab)}}.bind(this))}.bind(this))},goToTabByClassname:function(t){this.$tabs.find(".cart-sidebar-tab").each((function(t,e){Object(s.a)(e).removeClass("active")})),this.$tabs.find(t).addClass("active"),this.activeTab=t.slice(1)},goToInitialTab:function(){this.goToTabByClassname(".tab-items")},closeSideBar:function(){this.mag.eCommerceManager.changeCartSidebarVisibility()},toogleSettings:function(){this.isHiddenSettings=!this.isHiddenSettings,this.settingsPanel&&(this.settingsPanel.isHidden=this.isHiddenSettings)},onRemoveItem:function(t){t.currentTarget.dataset.skuId&&this.mag.eCommerceManager.removeFromCart(t.currentTarget.dataset.skuId)},onIncreaseItem:function(t){t.currentTarget.dataset.skuId&&this.mag.eCommerceManager.increaseCartItem(t.currentTarget.dataset.skuId)},onDecreaseItem:function(t){t.currentTarget.dataset.skuId&&this.mag.eCommerceManager.decreaseCartItem(t.currentTarget.dataset.skuId)},renderOrderTab:function(){var t=this;this.clearOrderError();var e=this.mag.eCommerceManager.getCartData(),i=e.order;if(i&&i.created<Math.floor(Date.parse(e.changed)/1e3))return this.showOrderLoader(),void this.mag.eCommerceManager.cancelOrder().then((function(e){e.data&&"canceled"===e.data.status&&(t.mag.eCommerceManager.deleteOrder(),t.createOrder())})).catch((function(e){t.hideOrderLoader(),t.renderOrderError(e&&e.message?e.message:""),t.mag.eCommerceManager.deleteOrder()}));i?this.renderOrderDetails():this.createOrder()},createOrder:function(){this.showOrderLoader(),this.mag.eCommerceManager.updateCartData().then(function(){var t=this,e=this.generateOrderRequestData();e&&e instanceof Error?this.renderOrderError(e.message):e&&e.currency&&s.a.ajax({type:"POST",url:"/api/projects/"+this.mag.num_id+"/ecommerce/stripe/orders/",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){t.hideOrderLoader(),e&&e.data&&(t.mag.eCommerceManager.setOrder(e.data),t.renderOrderDetails())},error:function(e){var i=JSON.parse(e.responseText);t.hideOrderLoader(),t.renderOrderError(i.message)}})}.bind(this)).catch(function(t){this.hideOrderLoader(),t&&t.message&&this.renderOrderError(t.message)}.bind(this))},showOrderLoader:function(){this.orderLoading||(this.orderLoading=!0,this.$goToPayment.hasClass("hidden")||this.$goToPayment.addClass("hidden"),this.$orderTab.find(".preloader").addClass("show"),this.$orderDetails.addClass("hidden"))},hideOrderLoader:function(){this.orderLoading&&(this.orderLoading=!1,this.$goToPayment.hasClass("hidden")&&this.$goToPayment.removeClass("hidden"),this.$orderTab.find(".preloader").removeClass("show"),this.$orderDetails.removeClass("hidden"))},renderOrderDetails:function(){var t,e,i=this.mag.eCommerceManager.getOrder();if(this.$orderItems.empty(),this.$orderShippingAddress.empty(),this.$orderShippingMethod.empty(),this.$orderShippingEmail.empty(),this.$orderTax.empty(),this.$orderTotalPrice.empty(),i.items.forEach(function(i){if("tax"===i.type)t=i;else if("shipping"===i.type)e=i;else{var o=Object(s.a)("<div/>",{class:"order-item"}).html(i.quantity+"  "+i.description),n=Object(s.a)("<div/>",{class:"order-item-price"}).text(f((i.amount/100).toFixed(2),i.currency));o.append(n),this.$orderItems.append(o)}}.bind(this)),i.shipping){var o=function(t){return t?" ".concat(t):""},n=i.shipping.address,a="".concat(n.line1).concat(o(n.line2)," ").concat(n.city,",").concat(o(n.state)).concat(o(n.postal_code)," ").concat(n.country);this.$orderShippingAddress.text(a),this.$tabs.find(".shipping-details").removeClass("hidden")}else this.$tabs.find(".shipping-details").addClass("hidden");if(i.shipping_methods.length>1){var r=this.shippingMethodsOptions(i.shipping_methods),l=S.a.extend(w);this.shippingMethodSelect?(this.shippingMethodSelect.options=function(){return r},this.shippingMethodSelect.value=e.parent):this.shippingMethodSelect=new l({el:this.$orderShippingMethod.get(0),propsData:{options:function(){return r},value:e.parent,isDesktop:!1,callback:this.onShippingMethodChange}})}else this.$orderShippingMethod.text(e.description+" "+f((e.amount/100).toFixed(2),e.currency));this.$orderDetails.find(".order-id").text(String(i.id).slice(0,20)+"..."),i.email?(this.$orderShippingEmail.text(i.email),this.$orderDetails.find(".shipping-email").removeClass("hidden")):this.$orderDetails.find(".shipping-email").addClass("hidden"),i.phone?(this.$orderDetails.find(".order-shipping-phone").text(i.phone),this.$orderDetails.find(".shipping-phone").removeClass("hidden")):this.$orderDetails.find(".shipping-phone").addClass("hidden"),t&&this.$orderTax.text(t.description+" "+f((t.amount/100).toFixed(2),t.currency)),this.$orderTotalPrice.text(f((i.amount/100).toFixed(2),i.currency)),this.$goToPayment.removeClass("hidden")},shippingMethodsOptions:function(t){return t.map((function(t){return{value:t.id,caption:t.description+" "+f((t.amount/100).toFixed(2),t.currency)}}))},onShippingMethodChange:function(t){var e=this;this.shippingMethodSelect.value=t,this.showOrderLoader(),this.mag.eCommerceManager.changeShippingMethod(t).then((function(t){e.hideOrderLoader(),t.data&&(e.mag.eCommerceManager.setOrder(t.data),e.renderOrderDetails())})).catch((function(){e.hideOrderLoader()}))},renderOrderError:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$orderError.find(".order-error-message").text(t),this.$orderError.removeClass("hidden"),this.$orderDetails.addClass("hidden"),this.$goToPayment.addClass("hidden")},clearOrderError:function(){this.$orderError.addClass("hidden"),this.$orderDetails.removeClass("hidden"),this.$goToPayment.removeClass("hidden")},transformShippingFormToOrderRequest:function(){var t=this.checkShippableInCart(),e={currency:"usd",email:this.shippingForm.email.value,items:[]};return this.shippingForm.note.value&&(e.metadata={note:this.shippingForm.note.value}),t?(e.shipping={name:this.shippingForm.name.value,phone:this.shippingForm.phone.value,address:{line1:this.shippingForm.line1.value,line2:this.shippingForm.line2.value,city:this.shippingForm.city.value,state:this.shippingForm.state.value,country:this.shippingForm.country.value,postal_code:this.shippingForm.postal_code.value}},e):e},generateOrderRequestData:function(){var t=this.mag.eCommerceManager.getCartData();if(!t||!t.skus)return new Error("Empty cart");var e=[],i=this.transformShippingFormToOrderRequest();for(var s in t.skus)t.skus[s].active&&(i.items.push({type:t.skus[s].object,parent:s,currency:t.skus[s].currency,quantity:t.skus[s].cart_count}),-1===e.indexOf(t.skus[s].currency)&&e.push(t.skus[s].currency));return e.length>1?new Error("mixed currencies"):(i.currency=e.pop(),i)},cancelOrder:function(){var t=this;this.showPaymentLoader(),this.mag.eCommerceManager.cancelOrder().then((function(e){t.hidePaymentLoader(),e.data&&"canceled"===e.data.status&&(t.mag.eCommerceManager.deleteOrder(),t.goToTabByClassname(".tab-items"))})).catch((function(){t.hidePaymentLoader()}))},renderCheckoutFormPaymentIntent:function(){var t=this,e=this.mag.eCommerceManager.getOrder();if(e){var i=this.mag.eCommerceManager.getStripeConnectedUserId(),s=Stripe(I,{stripeAccount:i}),o=s.elements();this.card=o.create("card",{style:this.cardStyle,hidePostalCode:!0}),this.card.mount("#card-element"),this.card.addEventListener("change",(function(t){var e=document.getElementById("card-errors");t.error?e.textContent=t.error.message:e.textContent=""})),this.form=document.getElementById("payment-form"),this.form.addEventListener("submit",function(){var i,o=(i=regeneratorRuntime.mark((function i(o){var n,a,r,l,c,h;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o.preventDefault(),i.next=3,s.createPaymentMethod("card",t.card);case 3:return n=i.sent,a=n.paymentMethod,i.next=7,fetch("/api/projects/"+t.mag.num_id+"/ecommerce/stripe/orders/"+e.id+"/paymentIntent/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payment_method_id:a.id,email:e.email})});case 7:return r=i.sent,i.next=10,r.json();case 10:if(!(!(l=i.sent).data||l.data&&l.data.error)){i.next=13;break}return i.abrupt("return");case 13:return i.next=15,s.handleCardPayment(l.data.client_secret,t.card);case 15:c=i.sent,h=c.paymentIntent,c.error,h&&"succeeded"===h.status?(t.showSuccessPaymentMessage(),t.checkoutCompete=!0):t.$paymentFailed.text("Invalid PaymentIntent status");case 19:case"end":return i.stop()}}),i)})),function(){var t=this,e=arguments;return new Promise((function(s,o){var n=i.apply(t,e);function a(t){$(n,s,o,a,r,"next",t)}function r(t){$(n,s,o,a,r,"throw",t)}a(void 0)}))});return function(t){return o.apply(this,arguments)}}())}else this.$paymentFailed.text("Order not found")},renderCheckoutForm:function(){var t=this,e=this.mag.eCommerceManager.getStripeConnectedUserId();this.stripe||(this.stripe=Stripe(I,{stripeAccount:e}));var i=this.stripe.elements();this.cardNumber||(this.cardNumber=i.create("cardNumber",{style:this.cardStyle,placeholder:"Card number"}),this.cardNumber.mount("#card-number-element"),this.cardNumber.addEventListener("change",(function(e){var i=t.$paymentTab.find(".card-number-error");e.error?i.removeClass("hidden"):i.addClass("hidden")})),this.cardNumber.addEventListener("ready",(function(e){t.renderCartHolderInput()}))),this.cardExpiry||(this.cardExpiry=i.create("cardExpiry",{style:this.cardStyle,placeholder:"M/Y"}),this.cardExpiry.mount("#card-expiry-element"),this.cardExpiry.addEventListener("change",(function(e){var i=t.$paymentTab.find(".card-expiry-error");e.error?i.removeClass("hidden"):i.addClass("hidden")}))),this.cardCvc||(this.cardCvc=i.create("cardCvc",{style:this.cardStyle,placeholder:"Security code"}),this.cardCvc.mount("#card-cvc-element"),this.cardCvc.addEventListener("change",(function(e){var i=t.$paymentTab.find(".card-cvc-error");e.error?i.removeClass("hidden"):i.addClass("hidden")}))),this.form||(this.form=document.getElementById("payment-form"),this.form.addEventListener("submit",this.onPaymentFormSubmit.bind(this)))},renderCartHolderInput:function(){this.cardHolderName||(this.cardHolderName=this.$paymentTab.find(".card-name-input"),this.cardHolderName.removeClass("hidden"),this.cardHolderName.on("input",this.onCardHolderNameChange))},onCardHolderNameChange:function(t){this.cardHolderNameValue=t.target.value,this.cardHolderNameValue?this.$paymentTab.find(".card-name-error").hasClass("hidden")||this.$paymentTab.find(".card-name-error").addClass("hidden"):this.$paymentTab.find(".card-name-error").hasClass("hidden")&&this.$paymentTab.find(".card-name-error").removeClass("hidden")},onPaymentFormSubmit:function(t){var e=this;t.preventDefault(),this.cardHolderNameValue?(this.$paymentTab.find(".card-name-error").addClass("hidden"),this.stripe.createToken(this.cardNumber,{name:this.cardHolderNameValue}).then((function(t){t.error||e.stripeTokenHandler(t.token)}))):this.$paymentTab.find(".card-name-error").removeClass("hidden")},stripeTokenHandler:function(t,e){var i=this.mag.eCommerceManager.getOrder();if(i){var o=i.email;o?(this.hideErrorPaymentMessage(),this.showPaymentLoader(),s.a.ajax({type:"POST",url:"/api/projects/"+this.mag.num_id+"/ecommerce/stripe/orders/"+i.id+"/pay/",data:JSON.stringify({stripe_token:t.id,email:o}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){this.hidePaymentLoader(),t&&t.data&&("paid"===t.data.status&&(RM.analytics&&RM.analytics.sendEvent("Checkout success"),this.showSuccessPaymentMessage(),"function"==typeof e&&e({status:"success"})),this.checkoutCompete=!0)}.bind(this),error:function(){this.hidePaymentLoader(),this.showErrorPaymentMessage("Payment Failed"),"function"==typeof e&&e({status:"fail"}),this.checkoutCompete=!0}.bind(this)})):this.showErrorPaymentMessage("Email is required")}else this.showErrorPaymentMessage("Order not found")},showPaymentLoader:function(){this.paymentLoading||(this.paymentLoading=!0,this.$paymentTab.find(".preloader").addClass("show"),this.$paymentTab.find(".cart-payment-btn").css("display","none"),this.$paymentTab.find(".cart-cancel-btn").css("display","none"))},hidePaymentLoader:function(){this.paymentLoading&&(this.paymentLoading=!1,this.$paymentTab.find(".preloader").removeClass("show"),this.$paymentTab.find(".cart-payment-btn").css("display","block"),this.$paymentTab.find(".cart-cancel-btn").css("display","block"))},showErrorPaymentMessage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$paymentFailed.find(".error-message").text(t),this.$paymentFailed.addClass("show")},hideErrorPaymentMessage:function(){this.$paymentFailed.find(".error-message").empty(),this.$paymentFailed.removeClass("show")},showSuccessPaymentMessage:function(){this.$paymentTab.find(".sidebar-header").css("display","none"),this.$paymentTab.find(".sidebar-body").css("display","none"),this.$paymentSuccess.addClass("show")},hideSuccessPaymentMessage:function(){this.$paymentTab.find(".sidebar-header").css("display","block"),this.$paymentTab.find(".sidebar-body").css("display","block"),this.$paymentSuccess.removeClass("show")},getSettingsData:function(){return{isHidden:this.isHiddenSettings,model:this.cartWidgetModel?a.a.clone(this.cartWidgetModel.attributes):{},onOverlayClick:this.onSettingsOverlayClick.bind(this)}},setupSettingsPanel:function(){var t=i("tf3M").default,e=i("YOpb").default,o=i("nnuN").default;this.cartWidgetModel=new t(this.cartWidgetData),this.saveModelChanges_debounced=a.a.debounce(this.saveModelChanges.bind(this),80),RM.constructorRouter&&RM.constructorRouter.mag&&!RM.constructorRouter.mag.get("_id")&&(RM.constructorRouter.isOwner=a.a.isEmpty(RM.constructorRouter.previewMag.get("shared")),RM.constructorRouter.previewMag.edit_params=new e(RM.constructorRouter.previewMag.get("edit_params"),RM.constructorRouter.previewMag),RM.constructorRouter.previewMag.unset("edit_params"),RM.constructorRouter.previewMag.filterUnusedFonts(),RM.constructorRouter.fonts=new o(RM.constructorRouter.previewMag.edit_params)),this.$settingButton=Object(s.a)("<div>",{class:"settings-button-wrap",attr:{"data-alt":"Settings","data-alt-pos":"top","data-alt-offset":"9"}}),this.$settingButton.append(Object(s.a)("<img>",{class:"settings-button svg",src:Object(P.b)("./constructor/controls/cart_settings/cart-sidebar-settings.svg")})),this.$footer.append(this.$settingButton),this.$settingButton.on("click",this.toogleSettings);var n=i("MErq").default,r=S.a.extend(n);this.settingsPanel=new r({el:Object(s.a)('<div id="settings-panel">').appendTo(document.body).get(0),data:this.getSettingsData()}),this.settingsPanel.$on("change",this.onModelChange)},onSettingsOverlayClick:function(){this.toogleSettings()},onModelChange:function(t){this.saveModelChanges_debounced(t)},saveModelChanges:function(t){this.cartWidgetData=t,this.generateSidebarCSS(t),this.cartWidgetModel&&this.cartWidgetModel.save(t,{toHistory:!1,skipHistory:!0})},checkShippableInCart:function(){var t=this.mag.eCommerceManager.getCartData();for(var e in t.skus)if(t.skus[e].productObject.shippable)return!0;return!1},destroy:function(){var t=this;if(this.rendered)return this.checkoutCompete&&(this.mag.eCommerceManager.clearCart(),this.goToInitialTab(),this.hideSuccessPaymentMessage(),this.$paymentFailed.empty()),this.mag.eCommerceManager.events.off("ecommerce:cartsidebar:visibility:changed"),this.mag.eCommerceManager.events.off("ecommerce:cartdata:changed"),this.form&&this.form.removeEventListener("submit",this.onPaymentFormSubmit),this.cardHolderName&&this.cardHolderName.off("input",this.onCardHolderNameChange),this.$tabs.find("[data-tab^='tab-']").each((function(t,e){Object(s.a)(e).off("click")})),this.$items.find(".cart-item-remove-btn").each((function(t,e){Object(s.a)(e).off("click")})),this.$tabs.find(".order-details-form .form-input").each((function(e,i){Object(s.a)(i).off("input",t.onShippingFormChange)})),this.unbindDomEvents(),this.settingsPanel&&(this.settingsPanel.$off("change",this.onModelChange),this.settingsPanel.$destroy()),this.$settingButton&&this.$settingButton.off("click",this.toogleSettings),this.remove()},cartItemBlockHover:function(t){var e=Object(s.a)(t.currentTarget);e&&e.length&&(e.addClass("hover").siblings().removeClass("hover"),this.hoveredItem=e.data("sku-id"))},cartItemBlockLeave:function(t){var e=Object(s.a)(t.currentTarget);e&&e.length&&(e.removeClass("hover"),e.data("sku-id")===this.hoveredItem&&(this.hoveredItem=null))}}),A=i("+9Qk"),R=i("rVpV"),D=i("roQd"),z=i("gobI"),L=i("38JW"),B=i("v92f"),F=i("gdoY"),H=i("HwMs"),N=i("CXd4"),V=i.n(N),U=i("QNiq"),W=n.a.View.extend({ARROWS_SHOW_DELAY:1e3,BOTTOM_SHOW_DELAY:1e3,BOTTOM_HIDE_DELAY:0,template:V.a["template-viewer-navigation"],events:{"click .navigation-arrow.left":"goPrevPage","click .navigation-arrow.right":"goNextPage","click .navigation-arrow.bottom":"scrollCurrentPage"},initialize:function(t){return a.a.bindAll(this),a.a.extend(this,t),this.updateScaleState.__debounced=a.a.debounce(this.updateScaleState,100),this},render:function(){return this.setElement(this.template({})),this.$el.appendTo(this.$container),this.$prev=this.$(".navigation-arrow.left"),this.$next=this.$(".navigation-arrow.right"),this.$bottom=this.$(".navigation-arrow.bottom"),a.a.delay(a.a.bind((function(){this.$prev.removeClass("offscreen"),this.$next.removeClass("offscreen")}),this),this.ARROWS_SHOW_DELAY),this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"finalPageShown",this.onFinalPageShow),this.listenTo(this.mag,"finalPageHidden",this.onFinalPageHide),this.listenTo(this.mag,"keypress-"+s.a.keycodes.left,this.goPrevPage),this.listenTo(this.mag,"keypress-"+s.a.keycodes.right,this.goNextPage),U.a.isDesktop&&Object(s.a)(window).bind("mousewheel",this.onMouseWheel),U.a.isDesktop||(Object(s.a)(window).bind("gesturechange",this.updateScaleState.__debounced),this.updateScaleState(),(this.mag.getPagesCount()>1||this.hasFinalPage)&&this.setSwipeAction()),this},destroy:function(){return U.a.isDesktop&&Object(s.a)(window).unbind("mousewheel",this.onMouseWheel),U.a.isDesktop||(Object(s.a)(window).unbind("gesturechange",this.updateScaleState.__debounced),this.pagesSwipe&&this.pagesSwipe.destroy()),this.remove()},onMouseWheel:function(t,e,i,s){this.preventTrackpadSwipeTill&&+new Date<this.preventTrackpadSwipeTill||Math.abs(i)>40&&Math.abs(i)>Math.abs(s)&&(i>0&&this.goPrevPage(),i<0&&this.goNextPage(),this.preventTrackpadSwipeTill=+new Date+1e3)},setSwipeAction:function(){this.pagesSwipe=this.mag.$mag_container.RMSwipe({$scrollElements:this.mag.$mag_container,getMaxTransitionSpeed:a.a.bind((function(){return this.mag.getPageTransitionTime()}),this),customMoveCheck:a.a.bind((function(t,e){if(this.hasFinalPage&&this.mag.isLastPage()){if(this.finalPageShown&&!t.hasClass("final-page"))return!1;if(!this.finalPageShown){if(!t.hasClass("final-page")&&e<0)return!1;if(t.hasClass("final-page")&&e>0)return!1}}return!(t.hasClass("prev-page")&&e<0)&&!(t.hasClass("next-page")&&e>0)}),this),beforeAutoAnimation:a.a.bind((function(t,e){return this.mag.isLastPage()&&this.hasFinalPage&&("left"===t&&!this.finalPageShown||"right"===t&&this.finalPageShown)?{autoAnimate:!0,immediateCallback:!0}:(this.mag.showPageCounter(t),{autoAnimate:!0,immediateCallback:!1})}),this),onSwipeStart:a.a.bind((function(){!this.finalPageShown&&this.mag.showPageCounter()}),this),getCurrentConstraints:a.a.bind((function(t){var e={},i=this.mag.$mag_container.width(),s=t.closest(".page, .final-page");return s.length||(s=this.mag.currentPage.$el),this.mag.isLastPage()&&this.hasFinalPage&&this.finalPageShown?e.$moveItems=s:e.$moveItems=s.add(s.prev()).add(s.next()),e.$referenceItem=e.$moveItems.filter(":not(.center-page)").first(),!this.mag.isLastPage()||this.hasFinalPage&&!this.finalPageShown?e.left={max:i}:e.left={max:0,noTrigger:!0},this.mag.isFirstPage()&&!this.finalPageShown?e.right={max:0,noTrigger:!0}:e.right={max:i},e}),this),callback:a.a.bind((function(t){"right"===t&&this.mag.goPrevPage({animation:!1,bySwipe:!0}),"left"===t&&this.mag.goNextPage({animation:!1,bySwipe:!0})}),this)}).data("swipe")},onFinalPageShow:function(){this.finalPageShown=!0,this.$next.addClass("hidden"),this.$bottom.addClass("final-page-offscreen"),this.$prev.toggleClass("hidden",!U.a.isDesktop)},onFinalPageHide:function(){this.finalPageShown=!1,this.$next.removeClass("hidden"),this.$bottom.removeClass("final-page-offscreen"),this.$prev.toggleClass("hidden",this.mag.isFirstPage())},onPageChange:function(t,e){this.$next.toggleClass("hidden",!(!this.mag.isLastPage()||this.mag.finalPage)||!(!this.mag.finalPage||!this.mag.finalPage.shown)),this.recalcBottomArrowState(t),this.$prev.toggleClass("hidden",this.mag.isFirstPage()),this.mag.updateArrowsColor(t)},recalcBottomArrowState:function(t){clearTimeout(this.bottomArrowTimeout);var e=t.isBottomArrowVisible();"horizontal"===this.viewerType&&this.mag.viewOpts.scalableviewer&&(e=!1),this.isPreview&&"default"!==this.mag.viewport&&(e=!1),this.bottomArrowTimeout=setTimeout(a.a.bind((function(){this.$bottom.toggleClass("offscreen",!e)}),this),e?this.BOTTOM_SHOW_DELAY:this.BOTTOM_HIDE_DELAY)},goPrevPage:function(t){this.mag.goPrevPage({animation:!0})},goNextPage:function(t){this.mag.goNextPage({animation:!0})},scrollCurrentPage:function(t){this.mag.scrollCurrentPageALittle()},updateScaleState:function(){Modernizr.android||this.$prev.add(this.$next).add(this.$bottom).toggleClass("scaled-offscreen",h.b.isPageNativelyScaled())}}),G=i("Tu3F"),q=i.n(G),X=i("Wxmq"),K=i.n(X),Y=n.a.View.extend({template:K.a["template-viewer-share"],events:{"click .buttons-wrapper .button":"share","click .send-report":"share","click .open-embed":"openEmbed","click .close":"hide","click .embed-wrapper .back":"closeEmbed","click .embed-wrapper .embed-code":"selectEmbedCode","keyup .embed-wrapper .embed-code":"onKeyUp","click .type-selector":"onTypeSelectorClick","click .size-selector":"onSizeSelectorClick",click:"onClick"},initialize:function(t){return a.a.bindAll(this),a.a.extend(this,t),this},render:function(){return this.setElement(this.template({hasOverlay:U.a.isPhone,common:RM.common})),this.$el.appendTo(this.$container),this.selectFullMode(),U.a.isPhone&&(this.shareSwipe=this.$el.RMSwipe({minTransitionSpeed:200,maxTransitionSpeed:400,rubberBand:!1,beforeAutoAnimation:a.a.bind((function(t,e){return{autoAnimate:!0,immediateCallback:!0}}),this),getCurrentConstraints:a.a.bind((function(t){var e={},i=this.$el.filter(".share-popup");return e.$referenceItem=i,e.$moveItems=i,e.up={max:0,noTrigger:!0},e.down={max:i.height()},e}),this),callback:a.a.bind((function(t){this.hide()}),this)}).data("swipe")),this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"finalPageShown",this.onFinalPageShow),this.listenTo(this.mag,"keypress-"+s.a.keycodes.esc,this.hide),Object(s.a)("body").on("click",this.hideOnBodyClick),this},show:function(){return this.shown||(clearTimeout(this.hideTimeout),this.$el.removeClass("hidden"),this.$el.height(),this.$el.addClass("show-popup"),this.$container.addClass("no-hover"),this.shown=!0,this.updateEmbed()),this},toggle:function(){return this.shown?this.hide():this.show()},hide:function(){return this.shown&&(this.$el.removeClass("show-popup"),this.$container.removeClass("no-hover"),this.hideTimeout=setTimeout(a.a.bind((function(){this.closeEmbed(),this.$el.addClass("hidden")}),this),400),this.shown=!1),this},destroy:function(){return clearTimeout(this.hideTimeout),Object(s.a)("body").off("click",this.hideOnBodyClick),this.shareSwipe&&this.shareSwipe.destroy(),this.remove()},hideOnBodyClick:function(t){U.a.isPhone||Object(s.a)(t.target).closest(this.$container).length||this.hide()},onPageChange:function(t,e){this.hide()},onFinalPageShow:function(){this.hide()},onClick:function(t){U.a.isPhone&&Object(s.a)(t.currentTarget).hasClass("share-popup-overlay")&&this.hide()},onKeyUp:function(t){t.stopPropagation()},openEmbed:function(t){this.router.analytics&&this.router.analytics.sendEvent("Embed","contents ("+this.shareMode+")"),this.selectEmbedCode(),this.$el.addClass("show-embed")},updateEmbed:function(){var t,e=this.mag.currentPage||this.mag.pages[0],i=this.$(".size-selector").attr("data-selected");this.$(".embed-wrapper .embed-code").val(Y.getEmbedCode({shareMode:this.shareMode,cur_page_num_id:e.num_id,mag_num_id:this.mag.num_id,size:{responsive:"responsive",big:512,small:288}[i]})),t=this.mag.model.getPageScreenshot(256,{_id:"page"===this.shareMode?e._id:this.mag.coverPid}),this.currentEmbedSrc!==t&&(this.$(".thumb-pic").attr("src",t),this.currentEmbedSrc=t)},closeEmbed:function(){this.$el.removeClass("show-embed")},share:function(t){A.a.share({host:(RM.common.embedDomainName||window.location.protocol+"//"+window.location.hostname)+"/",tp:Object(s.a)(t.currentTarget).attr("data-tp"),source:"share panel",page:this.mag.currentPage||this.mag.pages[0],mag:a.a.extend(this.mag.model.toJSON(),{user:this.mag.user}),forProject:"full"===this.shareMode,customDomain:!(!RM.common.isDomainViewer&&!RM.common.embedDomainName),customDomainProfile:!(!RM.common.customDomainProfile&&"User"!==RM.common.embedDomainType),analytics:this.router.analytics})},onTypeSelectorClick:function(t){if(U.a.isPhone){var e=Object(s.a)(t.target);e.closest(".type-full").length&&this.selectFullMode(),e.closest(".type-page").length&&this.selectPageMode()}else{"page"===(this.$(".type-selector").attr("data-tp")||"page")?this.selectFullMode():this.selectPageMode()}},onSizeSelectorClick:function(t){var e,i,o=Object(s.a)(t.currentTarget),n=o.attr("data-selected");i=(i=(e=a.a.map(o.find(".size"),(function(t){return Object(s.a)(t).attr("data-size")}))).indexOf(n)+1)>=e.length?0:i,o.attr("data-selected",e[i]),this.updateEmbed()},selectPageMode:function(){this.$(".type-selector").attr("data-tp","page"),this.shareMode="page",this.updateEmbed()},selectFullMode:function(){this.$(".type-selector").attr("data-tp","full"),this.shareMode="full",this.updateEmbed()},selectEmbedCode:function(){U.a.isDesktop&&this.$(".embed-wrapper .embed-code").get(0).setSelectionRange(0,9999)}},{getEmbedCode:function(t){var e,i,s,o,n='<script async src="'+h.a.EMBED_SCRIPT_INIT+'" id="readymag-embed-init"><\/script>';return e=RM.common.embedDomainName||window.location.protocol+"//"+window.location.hostname,o=' data-uri="'+(i="full"===t.shareMode?t.mag_num_id:"p"+t.cur_page_num_id)+'" ',o+=' data-width="'+t.size+'" ',(RM.common.isDomainViewer||RM.common.embedDomainName)&&(o+=' data-domain="'+e+'" ',RM.common.customDomainProfile||"User"===RM.common.embedDomainType||(i="full"===t.shareMode?"":"p"+t.cur_page_num_id)),h.a.IS_LIVE||(o+=' data-origin="'+h.a.readymag_embed_host+'" '),'<a class="rm-mag-embed" href="'+(s=e+"/"+i)+'"'+o+' target="_blank">'+s+"</a>\n"+n}}),Z=Y,J=i("QRzc"),Q=i.n(J),tt=n.a.View.extend({template:Q.a["template-viewer-mag-menu"],events:{"click .page":"onPageClick"},initialize:function(t){return a.a.bindAll(this),a.a.extend(this,t),this.IMG_STUB=Object(P.b)("./spacer.gif"),U.a.isPhone?"horizontal"===this.viewerType?(this.PAGE_WIDTH=140,this.PAGE_HEIGHT=92):(this.PAGE_WIDTH=240,this.PAGE_HEIGHT=158):(this.PAGE_WIDTH=280,this.PAGE_HEIGHT=184),this.loadVisibleScreenshots.__debounced=a.a.debounce(this.loadVisibleScreenshots,500),this.unloadInvisibleScreenshots.__debounced=a.a.debounce(this.unloadInvisibleScreenshots,3e3),this},render:function(){this.setElement(this.template({mag:this.mag,pages:this.pages,width:this.PAGE_WIDTH,height:this.PAGE_HEIGHT,stub:this.IMG_STUB,viewerType:this.viewerType,publishDate:this.publishDate,hasProjectInfo:this.hasProjectInfo,common:RM.common})),this.$el.appendTo(this.$container),this.$pagesWrapper=this.$(".pages-wrapper");var t=this.$(".page"),e=this.$(".logo-wrapper");if("horizontal"==this.viewerType?(this.LOGO_SIZE=e.width()||0,this.$(".pages").css("width",t.length*this.PAGE_WIDTH+this.LOGO_SIZE),this.$pagesWrapper.scrollLeft(99999)):(this.LOGO_SIZE=e.height()||0,this.$(".pages").css("height",t.length*this.PAGE_HEIGHT+this.LOGO_SIZE),this.$pagesWrapper.scrollTop(99999)),U.a.isDesktop&&(this.scroll=this.$(".scroll-wrapper").RMScroll({$container:this.$pagesWrapper,$content:this.$(".pages"),$handle:this.$(".scroll"),wheelScrollSpeed:1.3,gap_start:8,gap_end:8+this.LOGO_SIZE,maxHandleSize:136,dragScroll:!0,tp:this.viewerType}).data("scroll")),this.$pagesWrapper.bind("scroll",this.onScroll),this.cacheSize(),this.cacheScroll(),this.cachePagesPos(),this.loadedScreenshots={},"horizontal"==this.viewerType&&U.a.isPhone||Object(s.a)(".menu-info .mag-title").dotdotdot({height:U.a.isPhone?48:68,wrap:"letter",callback:a.a.bind((function(t,e){t&&this.$(".menu-info .mag-title").attr("title",this.mag.title)}),this)}),!U.a.isDesktop){var i="horizontal"==this.viewerType?this.$el.height():this.$el.width(),o=this.$el.add(this.$toolbar);"horizontal"==this.viewerType&&this.mag.navigation&&(o=o.add(this.mag.navigation.$bottom)),this.menuSwipe=o.RMSwipe({$scrollElements:this.$pagesWrapper,minTransitionSpeed:200,maxTransitionSpeed:400,rubberBand:!1,getCurrentConstraints:a.a.bind((function(){var t={};return t.$referenceItem=this.$el,t="horizontal"==this.viewerType?this.shown?{up:{max:0,noTrigger:!0},down:{max:i}}:{up:{max:i},down:{max:0,noTrigger:!0}}:this.shown?{left:{max:0,noTrigger:!0},right:{max:i}}:{left:{max:i},right:{max:0,noTrigger:!0}}}),this),callback:a.a.bind((function(t){this.shown?this.hide():this.show()}),this)}).data("swipe")}return this.isPreview&&this.listenTo(RM.constructorRouter,"renewScreenshot",this.renewScreenshot),this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"finalPageShown",this.onFinalPageShow),this.listenTo(this.mag,"finalPageHidden",this.onFinalPageHide),this.listenTo(this.mag,"keypress-"+s.a.keycodes.m,this.toggle),this.listenTo(this.mag,"keypress-"+s.a.keycodes.esc,this.hide),Object(s.a)(window).on("resize",this.onResize),this.$el.bind("mousewheel",this.onMouseWheel),this},show:function(){return this.finalPageShown?this:(this.shown||(this.shown=!0,this.mag.$el.addClass("viewer-mag-menu-shown"),this.mag.$el.toggleClass("viewer-mag-menu-no-project-info",!this.hasProjectInfo),this.loadOtherScreenshots(),this.mag.trigger("menuShown")),this)},toggle:function(){return this.shown?this.hide():this.show()},hide:function(){return this.shown&&(this.mag.$el.removeClass("viewer-mag-menu-shown viewer-mag-menu-no-project-info"),this.clearLoadOtherTimeout(),this.mag.focusCurrentPage(),this.shown=!1,this.mag.trigger("menuHidden")),this},destroy:function(){return Object(s.a)(window).off("resize",this.onResize),this.$el.unbind("mousewheel",this.onMouseWheel),this.menuSwipe&&this.menuSwipe.destroy(),this.$pagesWrapper.unbind("scroll",this.onScroll),this.remove()},onMouseWheel:function(t){t.preventDefault()},onResize:function(){this.cacheSize(),this.scroll&&this.scroll.recalc(),this.mag.currentPage&&this.shiftToPage(this.mag.currentPage.num,!1)},onScroll:function(){this.cacheScroll()},cacheSize:function(){this.cachedData=this.cachedData||{},this.cachedData.scrollSize="horizontal"==this.viewerType?this.$pagesWrapper.width():this.$pagesWrapper.height()},cacheScroll:function(){this.cachedData=this.cachedData||{},this.cachedData.scrollPos="horizontal"==this.viewerType?this.$pagesWrapper.scrollLeft():this.$pagesWrapper.scrollTop()},cachePagesPos:function(){this.cachedData=this.cachedData||{},this.cachedData.pagesPos={};var t=this.cachedData.pagesPos,e=this.viewerType,i=this.PAGE_WIDTH,s=this.PAGE_HEIGHT;a.a.each(this.pages,(function(o,n){t[o.num]=n*("horizontal"==e?i:s)}))},onPageChange:function(t,e){this.shown||(this.loadVisibleScreenshots.__debounced(),!U.a.isDesktop&&this.unloadInvisibleScreenshots.__debounced()),this.shiftToPage(t.num,this.shown),a.a.isEmpty(this.loadedScreenshots)&&this.loadVisibleScreenshots()},onFinalPageShow:function(){this.hide(),this.finalPageShown=!0},onFinalPageHide:function(){this.finalPageShown=!1},shiftToPage:function(t,e){var i,s=this.$('.page[data-num="'+t+'"]'),o=this.cachedData.scrollSize,n=this.cachedData.scrollPos,a="horizontal"==this.viewerType?this.PAGE_WIDTH:this.PAGE_HEIGHT,r=this.cachedData.pagesPos[t],l=n+a/2,c=n+o-a/2;if(this.$(".page.active").removeClass("active"),s.addClass("active"),r<l)i=r-l;else{if(!(r+a>c))return;i=r+a-c}var h={};h["horizontal"==this.viewerType?"scrollLeft":"scrollTop"]=n+i,this.$pagesWrapper.stop().animate(h,e?300:0)},onPageClick:function(t){if(!this.scroll||!this.scroll.wasContentDrag){var e=Object(s.a)(t.currentTarget).data("num");this.mag.currentPage&&e==this.mag.currentPage.num||this.mag.showPage(e,{animation:!1})}},renewScreenshot:function(t){var e=this.$(".page").filter((function(){return Object(s.a)(this).data("id")==t})),i=RM.constructorRouter.mag.pages.find((function(e){return e.id==t})),o=i&&i.getScreenshot(this.PAGE_WIDTH);e.attr("data-src")?e.attr("data-src",o):e.find(".screenshot").prop("src",o)},getVisibleScreenshotRange:function(){var t=this.cachedData.scrollSize,e=this.cachedData.scrollPos,i="horizontal"==this.viewerType?this.PAGE_WIDTH:this.PAGE_HEIGHT;return{min:Math.max(0,Math.floor(e/i)),max:Math.min(this.mag.getPagesCount()-1,Math.floor((e+t)/i))}},loadVisibleScreenshots:function(){if(this.mag.pages&&this.mag.pages.length){var t=this.getVisibleScreenshotRange(),e=this;this.$(".page").each((function(i){var o,n=(o=Object(s.a)(this)).attr("data-src");i>=t.min&&i<=t.max&&n&&!e.loadedScreenshots[i]&&((o=Object(s.a)(this)).find(".screenshot").prop("src",n),o.removeAttr("data-src"),e.loadedScreenshots[i]=!0)}))}},unloadInvisibleScreenshots:function(){if(!this.shown){var t=this.getVisibleScreenshotRange(),e=this;this.$(".page").each((function(i){var o,n=(o=Object(s.a)(this)).attr("data-src");(i<t.min||i>t.max)&&!n&&e.loadedScreenshots[i]&&((o=Object(s.a)(this)).attr("data-src",o.find(".screenshot").prop("src")),o.find(".screenshot").prop("src",e.IMG_STUB),delete e.loadedScreenshots[i])}))}},loadOtherScreenshots:function(){this.clearLoadOtherTimeout(),this.loadOtherSafeTimeout=500,this.loadNextScreenshot()},loadNextScreenshot:function(){var t,e,i,s=this.getVisibleScreenshotRange(),o=Math.floor((s.min+s.max)/2),n=this.loadedScreenshots,a=this.mag.getPagesCount()-1;for(t=o;t<=a&&n[t];t++);for(e=o;e>=0&&n[e];e--);if(!(e<0&&t>a)){n[i=t>a?e:e<0?t:t-o>o-e?e:t]=!0;var r=this.$(".page").eq(i),l=r.find(".screenshot"),c=this;l.one("load error",(function(t){clearTimeout(c.$curLoadingTimeout),c.loadNextScreenshot()})),this.$curLoadingTimeout=setTimeout((function(){l.off(),c.loadOtherSafeTimeout*=1.1,c.loadNextScreenshot()}),this.loadOtherSafeTimeout),l.prop("src",r.attr("data-src")),r.removeAttr("data-src"),this.$curLoadingScreenshot=l}},clearLoadOtherTimeout:function(){this.$curLoadingScreenshot&&this.$curLoadingScreenshot.off(),clearTimeout(this.$curLoadingTimeout)}}),et=n.a.View.extend({PAGE_COUNTER_TIMEOUT:2800,PAGE_COUNTER_TIMEOUT_INITIAL:4e3,template:q.a["template-viewer-toolbar"],events:{"click .menu-button":"toggleMenu","click .share-button":"toggleShare","click .embed-close-button":"onEmbedCloseClick"},initialize:function(t){return a.a.bindAll(this),a.a.extend(this,t),this},render:function(){if(this.setElement(this.template({mag:this.mag,isPreview:this.isPreview,hasMenu:this.hasMenu,hasShare:this.hasShare,hasPageCounter:this.hasPageCounter,pageCounterInsideMenu:this.hasMenu&&U.a.isPhone,totalPages:this.mag.getPagesCount(),common:RM.common})),this.$el.appendTo(this.$container),this.$menuButton=this.$el.find(".menu-button"),this.$shareButton=this.$el.find(".share-button"),this.$pageCounter=this.$el.find(".page-counter"),this.$pageCounterWrapper=this.$pageCounter.parent(),this.hasShare&&(this.share=new Z({mag:this.mag,router:this.router,$container:U.a.isPhone?this.$container:this.$shareButton}).render(),this.hasMenu||this.$shareButton.addClass("without-menu-button")),this.hasMenu&&(this.magMenu=new tt({mag:this.mag,pages:this.pages,router:this.router,isPreview:this.isPreview,hasProjectInfo:this.hasProjectInfo,publishDate:this.publishDate,$container:this.$container,$toolbar:this.$el,viewerType:this.viewerType}).render()),this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"finalPageShown",this.onFinalPageShow),this.listenTo(this.mag,"finalPageHidden",this.onFinalPageHide),this.listenTo(this.mag,"menuShown",this.onMenuShow),this.listenTo(this.mag,"menuHidden",this.onMenuHide),this.listenTo(this.mag,"presentationModeOn",this.onPresentationModeOn),this.listenTo(this.mag,"presentationModeOff",this.onPresentationModeOff),!this.isPreview){var t=this.$(".offscreen-initially:visible"),e=150*t.length+800;t.each((function(t,i){setTimeout((function(){Object(s.a)(i).removeClass("offscreen-initially")}),e),e-=150}))}return this.$("div[data-alt]:not(.rmalttext), a[data-alt]:not(.rmalttext)").RMAltText(),this},destroy:function(){return this.share&&this.share.destroy(),this.magMenu&&this.magMenu.destroy(),this.remove()},isMenuOpened:function(){return!!this.menuShown},closeMenu:function(){this.magMenu&&this.magMenu.hide()},onPageChange:function(t,e){this.showPageCounter(t,e),this.$menuButton.removeClass("waiting-video-bg-start preloading"),this.prevPage&&this.stopListening(this.prevPage),t&&(t.loaded||(this.$menuButton.addClass("preloading"),this.listenTo(t,"pageLoaded",this.onPageLoaded)),t.hasVideoBG&&!t.videoBGStarted&&(this.$menuButton.addClass("waiting-video-bg-start"),this.listenTo(t,"videoBGStarted",this.onVideoBGStarted)),this.prevPage=t)},onPageLoaded:function(){this.$menuButton.removeClass("preloading")},onVideoBGStarted:function(){this.$menuButton.removeClass("waiting-video-bg-start")},onFinalPageShow:function(){this.magMenu&&this.magMenu.hide(),this.finalPageShown=!0,this.updateVisibilityState()},onFinalPageHide:function(){this.finalPageShown=!1,this.updateVisibilityState()},onPresentationModeOn:function(){this.isPresentationMode=!0,this.updateVisibilityState()},onPresentationModeOff:function(){this.isPresentationMode=!1,this.updateVisibilityState()},updateVisibilityState:function(){this.finalPageShown||this.isPresentationMode?this.$el.stop().fadeOut(200):this.$el.stop().fadeIn(200)},onMenuShow:function(){this.menuShown=!0,this.hidePageCounter()},onMenuHide:function(){this.menuShown=!1},getPageCounterSize:function(t){if(!this.cachedPageCounterData){this.$pageCounter.find(".cur").text("0");var e=this.$pageCounter.outerWidth();this.$pageCounter.find(".cur").text("00");var i=this.$pageCounter.outerWidth()-e,s=e-i;this.cachedPageCounterData={baseSize:s,digitSize:i},this.$pageCounter.find(".cur").text(t)}var o=this.cachedPageCounterData;return o.baseSize+(t+"").length*o.digitSize},updatePageCounterSize:function(t){this.$pageCounter.length&&this.$pageCounterWrapper.length&&(!this.menuShown&&this.pageCounterShown?this.$pageCounterWrapper.css("width",this.getPageCounterSize(t)):this.$pageCounterWrapper.css("width",""))},showPageCounter:function(t,e){this.hasPageCounter&&(this.$pageCounter.find(".cur").text(t.num),e.showPageCounter&&(clearTimeout(this.pageCounterTimeout),this.$el.addClass("show-page-counter"),this.pageCounterShown=!0,Modernizr.android?setTimeout(a.a.bind((function(){this.updatePageCounterSize(t.num)}),this),17):this.updatePageCounterSize(t.num),this.pageCounterTimeout=setTimeout(this.hidePageCounter,e.initial?this.PAGE_COUNTER_TIMEOUT_INITIAL:this.PAGE_COUNTER_TIMEOUT)))},hidePageCounter:function(){this.hasPageCounter&&(clearTimeout(this.pageCounterTimeout),this.$el.removeClass("show-page-counter"),this.pageCounterShown=!1,this.updatePageCounterSize())},toggleMenu:function(t){this.magMenu&&this.magMenu.toggle()},toggleShare:function(t){Object(s.a)(t.target).is(this.$shareButton)&&this.share&&this.share.toggle()},postMessageToParent:function(t,e){var i={type:t,data:e},s=window.parent;s&&s.postMessage(JSON.stringify(i),"*")},onEmbedCloseClick:function(t){this.postMessageToParent("close-fullscreen")}}),it=i("WEBt"),st=i.n(it),ot=n.a.View.extend({template:st.a["template-viewer-branding"],initialize:function(t){return a.a.bindAll(this),a.a.extend(this,t),this},render:function(){return this.setElement(this.template()),this.$el.appendTo(this.$container),this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"finalPageShown",this.hide),this.listenTo(this.mag,"finalPageHidden",this.show),a.a.delay(function(){this.$el.removeClass("offscreen-initially")}.bind(this),800),this},onPageChange:function(t,e){},hide:function(){this.$el.stop().fadeOut(200)},show:function(){this.$el.stop().fadeIn(200)}}),nt=i("Gw2y"),at=i.n(nt),rt=i("BVsp"),lt=n.a.View.extend({template:at.a["template-viewer-final-page"],events:{"click .recover .go":"onClickRecoverSubmit","click .join.ljr-panel .go":"onJoinButtonClick"},initialize:function(t){return a.a.bindAll(this),a.a.extend(this,t),this},render:function(){var t="empty";return"join"!==this.finalPageType||this.me||(t="join"),"join"===this.finalPageType&&(t="join"),this.setElement(this.template({mag:this.mag,disableSocials:this.isPrivate,recentMags:this.recentMags,tp:t,magLink:this.mag.getUrl(),isStickyVerticalViewer:this.isStickyVerticalViewer,tweetText:A.a.getFinalShare(null,a.a.extend(this.mag.model.toJSON(),{user:this.mag.user}),{forProject:!0,customDomain:RM.common.isDomainViewer}).tweet,specialRecentView:"recent"===t&&1===this.recentMags.length&&!U.a.isPhone,Constants:h.a})),Modernizr.safari&&this.unFocusInput(),this.$el.appendTo(this.$container),"join"===t&&new rt.a({useNavigate:!1,$node:this.$(".dop-container-join"),router:this.router}).render(),"horizontal"===this.viewerType?(this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"keypress-"+s.a.keycodes.esc,this.hide)):this.show(),this.setRecoverPanelTop(),this},onJoinButtonClick:function(){!this.$(".join.ljr-panel input").hasClass("err")&&this.$(".join.ljr-panel .go").hasClass("active")},onClickRecoverSubmit:function(){var t=this.$(".recover.ljr-panel .email-input").val();Object(s.a)(".recover.ljr-panel .send-message .recover-email").text(t)},unFocusInput:function(){this.$(".join.ljr-panel .email-input").one("focus",(function(){Object(s.a)(this).blur()}))},setRecoverPanelTop:function(){var t=window.matchMedia("(max-width: 768px)").matches,e=(this.getHeight()-Object(s.a)(".join.ljr-panel").outerHeight())/2+"px";Object(s.a)(".recover.ljr-panel").css({top:t?"0":e})},show:function(){return this.shown||(this.$el.removeClass("offscreen hidden"),this.shown=!0,"horizontal"===this.viewerType&&this.mag.trigger("finalPageShown")),this},hide:function(){return this.shown&&(this.$el.addClass("offscreen"),this.shown=!1,this.mag.trigger("finalPageHidden")),this},destroy:function(){return this.remove()},setSizeAndPosForStickyVersion:function(t){var e=window.matchMedia("(max-width: 768px)").matches;t=t||{},this.$(".recover.ljr-panel").hasClass("hidden")?(this.$(".dop-container-text").removeClass("hidden"),this.$el.css({height:e?this.$(".final-page-container").height():"100vh",top:t.absolutePosition})):(this.$(".dop-container-text").addClass("hidden"),this.$el.css({height:"100vh",top:t.absolutePosition}))},scrollOnVerticalMode:function(t){this.hasScrollOnVerticalMode=!0,this.$el.css("top",0),h.b.applyTransform(this.$(".final-page-wrapper"),"translateY("+-t+"px)")},resetScrollOnVerticalMode:function(){this.hasScrollOnVerticalMode&&(this.hasScrollOnVerticalMode=!1,this.$el.css("top",""),h.b.applyTransform(this.$(".final-page-wrapper"),""))},getHeight:function(){return this.$(".final-page-wrapper").height()},onPageChange:function(){this.$el.toggleClass("hidden",!this.mag.isLastPage()),this.hide()},onKeyUp:function(t){t.stopPropagation()}}),ct=i("ubkq"),ht=i.n(ct),dt=i("i7aS"),pt=i("Kf/z");function ut(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function gt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ut(i,!0).forEach((function(e){mt(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ut(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function mt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var ft=n.a.View.extend({TYPEKIT_PREVIEW_API_LINK:"//use.typekit.net/previewkits/pk-v1.js",PRELOAD_COUNT_HORIZONTAL:{backward:1,forward:U.a.isDesktop?5:U.a.isPhone?3:2},PRELOAD_COUNT_VERTICAL:{backward:U.a.isDesktop?2e3:(U.a.isPhone,1e3),forward:U.a.isDesktop?3e3:(U.a.isPhone,2e3)},SCROLLABLE_TRESHOLD:100,SCROLL_SNAP:0,template:l.a["template-viewer-mag"],initialize:function(t,e){a.a.bindAll(this),t||(t={}),a.a.defaults(t,{pages:[]}),this.hasWidgetsWithVerticalOnscrollAnimation=!1;var i=Object(a.a)(t.pages).chain().reduce((function(t,e){return t.concat(e.wids)}),[]).each(function(t){t.animation&&"scroll"===t.animation.type&&t.animation.steps&&a.a.any(t.animation.steps,function(t){return t.dy}.bind(this))&&(this.hasWidgetsWithVerticalOnscrollAnimation=!0)}.bind(this)).filter({is_global:!0}).value();this.staticGlobalWidgetsData=Object(a.a)(i).filter((function(t){return!t.is_above})),this.aboveGlobalWidgetsData=Object(a.a)(i).filter((function(t){return t.is_above}));var o=a.a.pluck(this.aboveGlobalWidgetsData,"_id");if(Object(pt.a)("viewer.subpages")){var n=this.getPagesWithUris(t.pages);t.pages=n}return Object(a.a)(t.pages).each(function(t){t.wids=t.wids.concat(a.a.reject(this.staticGlobalWidgetsData,(function(e){return e.pid===t._id}))),t.wids=a.a.unique(t.wids,(function(t){return t._id||Math.random()})),t.wids=Object(a.a)(t.wids).filter((function(t){return!a.a.contains(o,t._id)}))}.bind(this)),a.a.extend(this,t),this.model=new c.a(t,{parse:!0}),this.router=e,this.eCommerceManager=new u.b(this.router,this,this.router.environment),this.cartSidebar=new E(this),this.isPreview=e.isPreview,this.$container=e.$mags_container,U.a.isDesktop&&Object(s.a)("<div>").bind("mousewheel",(function(){})),this.setViewerOptions(this.getMagViewport()),this.continueLoading.__debounced=a.a.debounce(this.continueLoading,200),this.loadPages.__debounced=a.a.debounce(this.loadPages,700),this.onResize.__debounced=a.a.debounce(this.onResize,300),this.redrawAboveGlobalWidgets.__debounced=a.a.debounce(this.redrawAboveGlobalWidgets,500,!0),this.widgetPackCount=0,this.getAboveGlobalBoxMemoized=a.a.memoize(this.getAboveGlobalBox,(function(t,e,i){return t+" "+(e&&e.num)+" "+(e&&e.pageViewport)+" "+(i&&i.width)+" "+(i&&i.height)})),this},getPagesWithUris:function(t){var e=[],i={};Object(a.a)(t).chain().sortBy("num").forEach((function(t){var s=gt({},t,{children:[]});t.parentPage?i[t.parentPage].children.push(s):e.push(s);i[s._id]=s}));return Object(a.a)(e).chain().map((function(t,e){return function t(e,s,o){var n=s?"".concat(s,"/").concat(e.uri||o.toString()):"".concat(e.uri||o.toString());return[gt({},e,{uri:n}),e.children.map((function(e,s){return t(i[e._id],n,s+1)}))]}(t,"",e+1)})).flatten().unique((function(t){return t._id})).sortBy("num").value()},setViewerOptions:function(t){var e={arrows:!0,menubutton:!0,projectinfo:!0,sharebutton:!0,pagecounter:!0,viewertype:"vertical",slidein:!1,scalewidth:3600,endpage:!0,endpagetype:"join",lqip:!1};e=a.a.extend(e,this.model.get("opts")),dt.a.flagLQIP()||(e.lqip=!1),e.viewertype=RM.screenshot?"horizontal":e.viewertype,(!U.a.isDesktop||this.isPreview&&"default"!==t)&&(e.slidein=!1),"vertical"===e.viewertype&&(U.a.isDesktop?this.isStickyVerticalViewer=!e.slidein&&!this.isPreview&&!this.hasWidgetsWithVerticalOnscrollAnimation:(this.isStickyVerticalViewer=Modernizr.csspositionsticky,this.isStickyVerticalViewer||(e.viewertype="horizontal",this.pages.length>1&&(e.arrows=!0)))),e.sharebutton=e.sharebutton&&!this.isPreview&&!!this.published&&!this.is_private,e.pagecounter=e.pagecounter&&!this.isPreview&&this.pages.length>1,e.endpage=e.endpage&&!this.isPreview&&!!this.published,this.model.user&&this.model.user.get&&"540dc7a3a5c9259a383b910b"==this.model.user.get("_id")&&(e=a.a.extend(e,{arrows:!0,menubutton:this.isPreview,sharebutton:!1,pagecounter:!1,endpage:!1})),RM.common.isDomainViewer&&(e.endpage=!1),this.viewOpts=e,this.PRELOAD_COUNT="horizontal"==this.viewOpts.viewertype?this.PRELOAD_COUNT_HORIZONTAL:this.PRELOAD_COUNT_VERTICAL},setViewerClasses:function(){this.$el.removeClass("viewer-type-horizontal viewer-type-vertical").addClass("viewer-type-"+this.viewOpts.viewertype).removeClass("pages-pos-normal pages-pos-overlap").addClass("pages-pos-"+(this.viewOpts.slidein?"overlap":"normal")),"vertical"==this.viewOpts.viewertype&&(Object(s.a)("html").addClass("overflow-on-vertical-view"),this.isStickyVerticalViewer&&(this.$el.addClass("viewer-type-vertical-sticky"),Object(s.a)("body").addClass("overflow-on-vertical-view")))},unsetViewerClasses:function(){this.$el.removeClass("viewer-type-horizontal viewer-type-vertical").removeClass("pages-pos-normal pages-pos-overlap"),"vertical"==this.viewOpts.viewertype&&(Object(s.a)("html").removeClass("overflow-on-vertical-view"),this.$magScrollSizer.css("height",""),this.isStickyVerticalViewer&&(this.$el.removeClass("viewer-type-vertical-sticky"),Object(s.a)("body").removeClass("overflow-on-vertical-view")))},render:function(){if(!this.active){this.title=this.title||"Project",this.magOpenTime=new Date,this.setElement(this.template({hasStandaloneBottomArrow:!this.isPreview&&"vertical"==this.viewOpts.viewertype&&this.viewOpts.arrows,isPreview:!!this.isPreview})),this.$el.appendTo(this.$container),this.setViewerClasses(),Object(s.a)("body").on("click","a.external-link",this.toExternalLink).on("click",".maglink.back-to-top",this.backToTopCurrentPage).on("click",".maglink",this.maglink).on("click",".goback-link",this.onGobackLinkClick).on("click",".mailchimp-link",this.onMailchimpLinkClick).on("click",".anchor-link",this.onAnchorLinkClick).on("click",".share-link",this.onShareLinkClick),this.$mag_container=this.$(".mag-pages-container"),this.$mag_container.on("scroll",this.fixFocusScroll),this.$mag_viewport_device=this.$(".mag-pages-viewport-device"),this.$pages_container=this.$(".mag-pages-container .container"),this.$pages_blackout=this.$pages_container.find(".blackout"),this.$aboveWidgetsContainer=this.$(".above-pages-container"),"vertical"==this.viewOpts.viewertype&&(this.$magScrollContainer=Object(s.a)(window),this.$magScrollSizer=Object(s.a)("body"),this.isStickyVerticalViewer&&(this.$magScrollSizer=Object(s.a)("body").add(this.$el)),this.$magScrollHandler=Object(s.a)(window),this.$magScrollAnimate=Object(s.a)("body, html")),"vertical"==this.viewOpts.viewertype&&(this.$bottomArrow=this.$(".navigation-arrow.bottom"),this.$bottomArrow.one("click",this.scrollMagALittle)),this.active=!0;var t=this.pages;this.pages=null,this.viewport=null,this.switchToViewport(this.getMagViewport()),this.onResize(),U.a.isDesktop||setTimeout(this.onResize,1500),this.pages=Object(a.a)(t).chain().sortBy((function(t){return t.num})).map(a.a.bind((function(e){var i="";try{i=new L.a({mag:this,router:this.router,totalPages:t.length,pageData:e,viewerType:this.viewOpts.viewertype,isStickyVerticalViewer:this.isStickyVerticalViewer,$container:this.$pages_container}).render()}catch(t){console.log("Error page rendering.",t)}return i}),this)).filter((function(t){return!!t})).value();var e=this.getPage(this.getPagesCount());e&&e.markAsLast(),"horizontal"==this.viewOpts.viewertype&&this.setPagesTransitions(),RM.screenshot||("horizontal"==this.viewOpts.viewertype&&this.viewOpts.arrows&&(this.navigation=new W({mag:this,router:this.router,$container:this.$el,isPreview:this.isPreview,hasFinalPage:this.viewOpts.endpage,viewerType:this.viewOpts.viewertype}).render()),this.viewOpts.endpage&&(this.finalPage=new lt({me:this.router.me,mag:this,router:this.router,$container:this.$pages_container,isPreview:this.isPreview,isPrivate:this.is_private,viewerType:this.viewOpts.viewertype,finalPageType:this.viewOpts.endpagetype,isStickyVerticalViewer:this.isStickyVerticalViewer,recentMags:this.model.recentMags||Object(a.a)([])}).render()),this.toolbar=new et({mag:this,pages:this.pages,router:this.router,$container:this.$el,isPreview:this.isPreview,hasMenu:this.viewOpts.menubutton,hasProjectInfo:this.viewOpts.projectinfo,hasShare:this.viewOpts.sharebutton&&!h.a.IS_FILE_PROTOCOL,hasPageCounter:this.viewOpts.pagecounter,viewerType:this.viewOpts.viewertype,publishDate:this.published?ht()(new Date(this.published),"mmm dd, yyyy"):"unpublished"}).render(),!this.must_show_branding||RM.common.embedMode&&!U.a.isDesktop||(this.branding=new ot({mag:this,$container:this.$el}).render())),"vertical"==this.viewOpts.viewertype&&(this.onResize(),U.a.isDesktop&&this.getPage(1)&&this.getPage(1).$content.focus(),Object(s.a)("body").on("keydown",this.onVerticalViewKeyDown)),U.a.isDesktop?(Object(s.a)(window).on("mousedown",this.onMouseDown),Object(s.a)(window).on("mouseup",this.onMouseUp),Object(s.a)(window).on("mousewheel",this.onMouseWheel)):(Object(s.a)(window).on("touchstart",this.onDragStart),Object(s.a)(window).on("touchmove",this.onDragMove),Object(s.a)(window).on("touchend touchcancel",this.onDragEnd),Object(s.a)(window).on("pageshow",this.onResize)),h.b.PageVisibilityManager.addEventListener(this.onPageVisibilityChange),this.listenTo(this,"finalPageShown",this.onFinalPageShow),this.listenTo(this,"finalPageHidden",this.onFinalPageHide),this.listenTo(n.a,"form:focus",this.onFormFocus),this.listenTo(n.a,"form:blur",this.onFormBlur),Object(s.a)(window).on("resize",this.onResize),U.a.isDesktop||Object(s.a)(window).on("orientationchange",this.onResize),Object(s.a)(window).on("gesturestart gestureend",this.onGestureChange),"vertical"==this.viewOpts.viewertype&&this.$magScrollHandler.on("scroll",this.onMagScroll),Object(s.a)("body").on("keyup",this.onKeyup),d.a.generateCSS("paragraph","viewer",document,this.edit_params&&this.edit_params.paragraph_styles),d.a.generateCSS("link","viewer",document,this.edit_params&&this.edit_params.link_styles),RM.screenshot&&"true"==h.b.queryUrlGetParam("pdf")||this.isPreview||d.a.setShortList(d.a.getVeryShortList(this.edit_params&&this.edit_params.fonts));var i=!this.isPreview&&this.model.get("is_published")?"published":"edit",o=this;return"edit"!=i||window.TypekitPreview?r():s.a.getScript(this.TYPEKIT_PREVIEW_API_LINK,(function(t,e,i){r()})),this}function r(){d.a.appendFontsCssToDocument({version:i,fonts:o.edit_params&&o.edit_params.fonts,typekit_url:o.typekit_url})}},destroy:function(){var t=this;return a.a.each(this.pages,(function(t){t.destroy()})),this.pages=null,Object(s.a)("body").off("click","a.external-link",this.toExternalLink).off("click",".maglink.back-to-top",this.backToTopCurrentPage).off("click",".maglink",this.maglink).off("click",".goback-link",this.onGobackLinkClick).off("click",".mailchimp-link",this.onMailchimpLinkClick).off("click",".anchor-link",this.onAnchorLinkClick).off("keydown",this.onVerticalViewKeyDown).off("click",".share-link",this.onShareLinkClick),this.toolbar&&this.toolbar.destroy(),this.navigation&&this.navigation.destroy(),this.finalPage&&this.finalPage.destroy(),this.cartSidebar&&setTimeout((function(){t.cartSidebar.destroy()}),320),U.a.isDesktop?(Object(s.a)(window).off("mousedown",this.onMouseDown),Object(s.a)(window).off("mouseup",this.onMouseUp),Object(s.a)(window).off("mousewheel",this.onMouseWheel)):(Object(s.a)(window).off("touchstart",this.onDragStart),Object(s.a)(window).off("touchmove",this.onDragMove),Object(s.a)(window).off("touchend touchcancel",this.onDragEnd),Object(s.a)(window).off("pageshow")),this.unsetViewerClasses(),h.b.PageVisibilityManager.removeEventListener(this.onPageVisibilityChange),Object(s.a)(window).off("resize",this.onResize),Object(s.a)(window).off("orientationchange",this.onResize),Object(s.a)(window).off("gesturestart gestureend",this.onGestureChange),"vertical"==this.viewOpts.viewertype&&this.$magScrollHandler.off("scroll",this.onMagScroll),Object(s.a)("body").off("keyup",this.onKeyup),this.active=!1,this.trigger("destroyed"),this.remove()},getUrl:function(){return RM.common.isDomainViewer?window.location.protocol+"//"+window.location.hostname+"/"+(RM.common.customDomainProfile?this.num_id+"/":""):window.location.protocol+"//"+window.location.hostname+"/"+this.num_id+"/"},getPage:function(t,e){return parseInt(t,10)==t&&(t=parseInt(t,10)),a.a.isNumber(t)?this.pages[t-1]:Object(a.a)(this.pages).find((function(e){return e.uri==t}))},getPagesCount:function(){return this.pages.length},isFirstPage:function(){return this.currentPage&&!this.getPage(this.currentPage.num-1)},isLastPage:function(){return this.currentPage&&!this.getPage(this.currentPage.num+1)},getPageNum:function(t){var e=a.a.find(this.pages,(function(e){return e._id==t}));return e&&e.num},getPageUri:function(t){var e=a.a.find(this.pages,(function(e){return e._id==t}));if(!e)return null;var i=e.uri?e.uri+"/":1==e.num?"":e.num+"/";return this.router.getMagUri(this)+i},getPageTransitionTime:function(){var t=Math.min(this.viewOpts.scalewidth,this.getContainerSizeCached().width),e=this.getContainerSizeCached().height;return U.a.isDesktop?550:U.a.isTablet?t>e?550:470:t>e?520:370},onPageVisibilityChange:function(){var t;this.currentPage&&(h.b.PageVisibilityManager.isPageHidden()?(this.currentPage.stop({widgetTypes:["video","background","iframe"]}),(t=this.getPage(this.currentPage.num+1))&&t.started&&(t.stop({widgetTypes:["video","background","iframe"]}),this.restartNextPage=!0)):(this.currentPage.start({widgetTypes:["audio","video","background","iframe"],forceStart:!0}),(t=this.getPage(this.currentPage.num+1))&&this.restartNextPage&&(t.start({widgetTypes:["audio","video","background","iframe"],forceStart:!0}),delete this.restartNextPage)))},updateArrowsColor:function(t){if(t){var e=t.arrows_color||"white";this.$el.removeClass("navigation-white-arrows").removeClass("navigation-black-arrows").addClass("navigation-"+e+"-arrows")}},onFinalPageShow:function(){this.currentPage&&this.currentPage.stop({widgetTypes:["audio","video","background","iframe"]}),"horizontal"==this.viewOpts.viewertype&&(this.$pages_container.removeClass("disable-transitions"),this.$pages_container.addClass("fade-last-page-on-final-page"))},onFinalPageHide:function(){this.currentPage&&this.currentPage.start({widgetTypes:["audio","video","background","iframe"]}),"horizontal"==this.viewOpts.viewertype&&this.$pages_container.removeClass("fade-last-page-on-final-page")},onFormFocus:function(){if(Modernizr.safari&&!U.a.isDesktop&&"vertical"===this.viewOpts.viewertype){var t=this.getScroll();a.a.each(this.pages,(function(e){e.trigger("form:focus",t)})),this.$magScrollContainer&&this.$magScrollContainer.on("scroll",this.onScrollWithFormInFocus)}},onFormBlur:function(){(Modernizr.safari||!U.a.isDesktop)&&"vertical"===this.viewOpts.viewertype&&(a.a.each(this.pages,(function(t){t.trigger("form:blur")})),this.$magScrollContainer&&this.$magScrollContainer.off("scroll",this.onScrollWithFormInFocus))},onScrollWithFormInFocus:function(){if((Modernizr.safari||!U.a.isDesktop)&&"vertical"===this.viewOpts.viewertype){var t=this.getScroll();a.a.each(this.pages,(function(e){e.trigger("page:scrollWithFormInFocus",t)}))}},onDragStart:function(t){clearTimeout(this.touchInProgressTimeout),this.pauseLoading("touch");var e=t.originalEvent.targetTouches[0];this.globalTouchObject={$target:Object(s.a)(t.target).closest(".has-horizontal-scroll, .has-vertical-scroll"),x:e.screenX,y:e.screenY,startTime:+new Date}},onDragMove:function(t){var e=this.globalTouchObject;if(!(t.originalEvent.touches.length>1)&&e){if("horizontal"==this.viewOpts.viewertype)this.currentPage&&this.currentPage.hasFixedWidgets&&Object(s.a)(t.target).closest(this.$mag_container).length&&!e.$target.length&&(e.$target=this.currentPage.$scrollWrapper);else e.$target.length||(e.$target=this.$magScrollContainer);if(e.$target.length){if(!h.b.isPageNativelyScaled()){var i=t.originalEvent.targetTouches[0],o=(i.screenX,e.x,i.screenY-e.y);if(Math.abs(o)>5&&e.$target.hasClass("has-vertical-scroll")){var n=e.$target[0].scrollHeight,a=e.$target.outerHeight();o>0&&e.$target.scrollTop()<=0&&t.preventDefault(),o<0&&e.$target.scrollTop()>=n-a&&t.preventDefault()}e.$target.hasClass("has-horizontal-scroll")}}else t.preventDefault()}},onDragEnd:function(t){this.checkDoubleTap(t),this.touchInProgressTimeout=setTimeout(a.a.bind((function(){this.continueLoading("touch")}),this),400);var e=this.globalTouchObject;if(e){var i=t.originalEvent.changedTouches[0],o=i.screenX-e.x,n=i.screenY-e.y;this.toolbar&&this.toolbar.isMenuOpened()&&Math.abs(o)<3&&Math.abs(n)<3&&+new Date-e.startTime<500&&!h.b.isPageNativelyScaled()&&Object(s.a)(t.target).closest(this.$mag_container).length&&this.toolbar.closeMenu()}delete this.globalTouchObject},checkDoubleTap:function(t){if(!(t.originalEvent.touches.length>0)){var e=+new Date,i=e-(this.lastTouchEndTime||e+1);if(this.lastTouchEndTime=e,i<500&&i>0&&h.b.isPageNativelyScaled()){var o=Object(s.a)('meta[name="viewport"]');if(o.length){var n=o.attr("content"),r=n.replace(/maximum\-scale\=[0-9\.]*/,"maximum-scale=1.0");if(o.attr("content",r),Modernizr.android){var l=Object(s.a)("<div>").appendTo("body");a.a.delay((function(){l.remove()}),500),setTimeout(a.a.bind((function(){o.attr("content",n);var t=Object(s.a)("<div>").appendTo("body");a.a.delay((function(){t.remove()}),500)}),this),1e3)}else o.attr("content",n);this.lastTouchEndTime=0,a.a.delay((function(){Object(s.a)(window).trigger("gesturechange")}),300),a.a.delay((function(){Object(s.a)(window).trigger("gesturechange")}),1e3)}}}},onMouseDown:function(t){this.globalMouseObject={x:t.screenX,y:t.screenY,startTime:+new Date}},onMouseUp:function(t){var e=this.globalMouseObject;if(e){var i=t.screenX-e.x,o=t.screenY-e.y;this.toolbar&&this.toolbar.isMenuOpened()&&Math.abs(i)<3&&Math.abs(o)<3&&+new Date-e.startTime<500&&Object(s.a)(t.target).closest(this.$mag_container).length&&this.toolbar.closeMenu()}delete this.globalMouseObject},onMouseWheel:function(t){t.originalEvent.deltaX<0&&Math.abs(t.originalEvent.deltaY)<2&&t.cancelable&&t.preventDefault()},onKeyup:function(t){if("input"!=t.target.tagName.toLowerCase()&&("textarea"!=t.target.tagName.toLowerCase()||"copyhack"==t.target.className)&&a.a.isEmpty(RM.common.disableShortcuts)&&!this.isInPresentationMode){var e=a.a.chain(B.b.viewports).filter((function(t){return"tablet_portrait"!=t.name||(this.currentPage["viewport_"+t.name]||{}).enabled}),this).map((function(t,e){var i=a.a.clone(t);return i.shortcut=""+(e+1),i})).findWhere({shortcut:String.fromCharCode(t.keyCode)}).value();e&&this.isPreview&&(this.switchToViewport(e.name),this.aboveGlobalWidgetsRendered||"horizontal"!==this.viewOpts.viewertype||this.renderAboveGlobalWidgets(this.currentPage),this.setViewerOptions(e.name),this.setViewerClasses(),this.onResize(),this.loadPages());a.a.find(s.a.keycodes,(function(e,i){var o=s.a.keycodes[i]===t.keyCode;return o&&i,o}))&&this.trigger("keypress-"+t.keyCode,t)}},onKeydown:function(t){if("input"!=t.target.tagName.toLowerCase()&&("textarea"!=t.target.tagName.toLowerCase()||"copyhack"==t.target.className)&&a.a.isEmpty(RM.common.disableShortcuts)&&this.isInPresentationMode&&!(t.altKey||t.ctrlKey||t.metaKey))switch(t.which){case 8:case 33:case 80:case 37:case 72:case 38:case 75:t.preventDefault(),this.goPrevPage({animation:!0});break;case 13:case 34:case 78:case 39:case 76:case 40:case 74:t.preventDefault(),this.goNextPage({animation:!0});break;case 36:t.preventDefault(),this.goFirstPage();break;case 35:t.preventDefault(),this.goLastPage();break;case 9:case 32:t.preventDefault(),t.shiftKey?this.goPrevPage({animation:!0}):this.goNextPage({animation:!0});break;case 77:t.preventDefault(),this.trigger("keypress-"+t.keyCode,t)}},onVerticalViewKeyDown:function(t){var e;if(!this.isInPresentationMode&&"vertical"===this.viewOpts.viewertype&&(t.which===s.a.keycodes.down||t.which===s.a.keycodes.up)){if(t.preventDefault(),this.arrowKeyLastScrollAt&&new Date-this.arrowKeyLastScrollAt<400)return;var i=t.which===s.a.keycodes.down;this.arrowKeyLastScrollAt=+new Date;var o,n,r=window.innerHeight,l=this.getScroll(),c=this.getScrollPosition(),h=Math.round(r/4),d=function(t){return t&&t<=h},p=a.a.bind((function(){var t=this.magPagesPos[this.currentPage.num];return Math.abs(l-t.y)}),this),u=this.currentPage.pageHeight,g=0===c&&!this.isFirstPage();if(i)d(o=u-c-r)?n=u-c:n=(e=o)>h&&e<r?o:r,g&&this.viewOpts.slidein&&(n+=p());else{if(g){var m=this.magPagesPos[this.currentPage.num-1];c=m?m.h:0}n=d(o=c-r)||c<r?-c:-r,g&&this.viewOpts.slidein&&(n-=this.SCROLL_SNAP-p())}this.setScrollPosition({delta:n,animate:!0})}},togglePresentationMode:function(t){!!this.isInPresentationMode!=t&&U.a.isDesktop&&(this.isPreview||(t?(Object(s.a)("body").on("keydown",this.onKeydown),this.trigger("presentationModeOn")):(Object(s.a)("body").off("keydown",this.onKeydown),this.trigger("presentationModeOff")),this.isInPresentationMode=t))},recalcBottomArrowState:function(t){this.currentPage&&t===this.currentPage&&this.navigation&&this.navigation.recalcBottomArrowState(t)},setScrollPosition:function(t){var e;this.currentPage&&("vertical"==this.viewOpts.viewertype?(e=void 0!==t.offset?this.magPagesPos[this.currentPage.num].y+t.offset:this.getScroll()+t.delta,t.animate?this.$magScrollAnimate.animate({scrollTop:e},500):this.setScroll(e)):(e=void 0!==t.offset?t.offset:this.currentPage.$scrollWrapper.scrollTop()+t.delta,t.animate?this.currentPage.$scrollWrapper.animate({scrollTop:e},500):this.currentPage.$scrollWrapper.scrollTop(e)))},getScrollPosition:function(){if(!this.currentPage)return 0;return"vertical"==this.viewOpts.viewertype?Math.max(this.getScroll()-this.magPagesPos[this.currentPage.num].y,0):this.currentPage.$scrollWrapper.scrollTop()},getScroll:function(){return this.$magScrollContainer&&this.$magScrollContainer.scrollTop()},setScroll:function(t){this.$magScrollContainer&&this.$magScrollContainer.scrollTop(t)},onMagScroll:function(){if(!(document.fullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.msFullscreenElement)){a.a.isFunction(this._resetUrlStringTimeoutFunc)&&this._resetUrlStringTimeoutFunc(),this.pauseWidgetsLoadingOnScroll();var t=this.findPageOnCurrentMagScroll({pageStartsOnBottom:this.isStickyVerticalViewer&&!U.a.isDesktop}),e=this.getScrollParams(t);if(this.lastPageScroll=e.pageScroll,this.lastPageScrollPercent=e.pageScrollPercent,this.showPage(t.page.num,e),this.finalPage&&!this.isStickyVerticalViewer&&(null!=t.finalPageScroll?this.finalPage.scrollOnVerticalMode(t.finalPageScroll):this.finalPage.resetScrollOnVerticalMode()),this.aboveGlobalAnimations&&this.aboveGlobalAnimations.onScroll({forceApply:!0,scroll:this.getScroll()}),this.finalPage&&this.isStickyVerticalViewer){var i=this.getScroll(),s=this.magPagesPos[this.pages.length],o=s.y+s.h-this.getContainerSizeCached().height;this.trigger(i>o?"finalPageShown":"finalPageHidden")}if(this.$bottomArrow&&+this.magOpenTime+2e3<+new Date){this.$bottomArrow.addClass("offscreen");var n=this.$bottomArrow;delete this.$bottomArrow,setTimeout((function(){n.remove()}),400)}}},scrollMagALittle:function(){this.$magScrollAnimate.animate({scrollTop:this.getScroll()+this.getContainerSizeCached().height},500)},findPageOnCurrentMagScroll:function(t){t=t||{};var e,i,s,o,n=this.getScroll(),a=this.getContainerSizeCached(),r=(n=Math.min(Math.max(n,0),this.magHeight-a.height),this.pages.length),l=n+(t.pageStartsOnBottom?a.height-50-16-16:0);for(e=0;e<r;e++){i=this.pages[e],s=this.magPagesPos[i.num];var c,h=o?o.y+o.h:s.y;if(l>=h&&l<s.y+s.h||e==r-1)return e==r-1&&(c=Math.max(n-s.y-s.h-s.dh,0)),{page:i,scroll:n,pos:s,finalPageScroll:c,finalPageShown:this.finalPage&&!(l>=h&&l<s.y+s.h)};o=s}},getScrollParams:function(t){var e=Math.max(t.scroll-t.pos.y,0),i={initiator:"scroll",pageScroll:e,pageScrollPercent:e/t.page.pageHeight};if(this.viewOpts.slidein?(i.nextPageScroll=0,i.slideInNextPageScroll=t.pos.h-i.pageScroll):i.nextPageScroll=i.pageScroll-t.pos.h,i.nextPageVisible=t.pos.h-i.pageScroll<this.getContainerSizeCached().height,this.viewOpts.slidein){var s=(t.pos.h-i.pageScroll)/this.getContainerSizeCached().height;i.nextPageBlackout=Math.min(Math.max(s,0),1)}return i},onCurrentPageScroll:function(t,e){this.pauseWidgetsLoadingOnScroll(),this.aboveGlobalAnimations&&this.aboveGlobalAnimations.onScroll({forceApply:!this.isStickyVerticalViewer,scroll:e}),this.lastPageScroll=e,this.lastPageScrollPercent=this.lastPageScroll/t.pageHeight,this.loadPages.__debounced()},scrollCurrentPageALittle:function(){this.currentPage&&this.currentPage.scrollPageALittle()},focusCurrentPage:function(){this.currentPage&&this.currentPage.focusPage()},backToTopCurrentPage:function(){if("vertical"==this.viewOpts.viewertype){var t=this.findPageOnCurrentMagScroll();this.$magScrollAnimate.animate({scrollTop:t.pos.y},500)}else this.currentPage&&this.currentPage.backToTop();RM.analytics&&RM.analytics.sendEvent("Scroll Top Link")},scrollPageToPos:function(t,e){var i,s,o=this.getPage(t),n=this.getContainerSizeCached();e=e||0,e*=o.scale,e+=o.contentPosition.top,"vertical"==this.viewOpts.viewertype?(i=this.magPagesPos[o.num],s=Math.max(0,i.y+e),s=Math.min(s,i.y+i.h-n.height),this.$magScrollAnimate.animate({scrollTop:s},500)):(this.currentPage!=o&&this.showPage(o.uri||o.num),s=Math.max(0,e),o.scrollTo(s))},pauseWidgetsLoadingOnScroll:function(){},toExternalLink:function(t){var e=Object(s.a)(t.target).closest("a").attr("href");RM.analytics&&RM.analytics.sendEvent("External Link",e)},maglink:function(t){if(2!=t.which&&!t.metaKey&&!t.ctrlKey){var e=Object(s.a)(t.currentTarget).data("link")||Object(s.a)(t.currentTarget).attr("href");if(!e)return!1;if(t.preventDefault(),Object(s.a)(t.currentTarget).hasClass("back-to-top"))return this.backToTopCurrentPage();this.router.navigate(e,{trigger:!0})}},onGobackLinkClick:function(t){this.router.goBack()},onMailchimpLinkClick:function(t){var e,i=Object(s.a)(t.currentTarget);if(!i.hasClass("disabled")){i.flashClass("disabled",3e3);try{e=JSON.parse(i.attr("data-mailchimp"))}catch(t){e=null}e&&p.a.initMailchimpAPI((function(t){h.b.deleteCookie("MCEvilPopupClosed"),t.start(e)}))}},onAnchorLinkClick:function(t){var e=Object(s.a)(t.currentTarget),i=parseInt(e.attr("data-anchor-link-pos"),10)||0,o=e.attr("data-page-uri");i&&o&&(this.scrollPageToPos(o,i),RM.analytics&&RM.analytics.sendEvent("Anchor Link",i))},onShareLinkClick:function(t){A.a.share({host:(RM.common.embedDomainName||window.location.protocol+"//"+window.location.hostname)+"/",tp:Object(s.a)(t.currentTarget).attr("data-share-provider"),source:"mag links",page:this.currentPage||this.pages[0],mag:a.a.extend(this.model.toJSON(),{user:this.user}),forProject:"mag"==Object(s.a)(t.currentTarget).attr("data-share-type"),customDomain:!(!RM.common.isDomainViewer&&!RM.common.embedDomainName),customDomainProfile:!(!RM.common.customDomainProfile&&"User"!=RM.common.embedDomainType),analytics:this.router.analytics})},showPageCounter:function(t){if(this.toolbar){var e=1;this.currentPage&&(e=this.currentPage.num+(t?"left"==t?1:-1:0),e=Math.max(Math.min(e,this.getPagesCount()),1)),this.toolbar.showPageCounter(this.getPage(e),{showPageCounter:!0})}},showPage:function(t,e){e=e||{},this.active||this.render();var i=this.getPage(t),s=this.currentPage,o=i&&this.getPage(i.num+1),n=this;i&&!this.aboveGlobalWidgetsRendered&&this.renderAboveGlobalWidgets(i),this.isStickyVerticalViewer?this.redrawAboveGlobalWidgets():e.nextPageVisible||"horizontal"===this.viewOpts.viewertype?this.redrawAboveGlobalWidgets(i,o,e.slideInNextPageScroll||e.nextPageScroll,e.animation):i?this.redrawAboveGlobalWidgets(i):s&&this.redrawAboveGlobalWidgets.__debounced(),"vertical"==this.viewOpts.viewertype&&(e.animation=!1,i&&i.scrollOnVerticalMode(e.pageScroll||0),i&&o&&null!=e.nextPageScroll&&(o.scrollOnVerticalMode(e.nextPageScroll),U.a.isDesktop&&(e.nextPageVisible?o.start():o.stop())),i&&null!=e.nextPageBlackout&&this.$pages_blackout.css({display:o?"block":"none",opacity:e.nextPageBlackout,"z-index":i.getPageZIndex()}));var a=!this.currentPage;if(!a&&(t==this.currentPage.num||t==this.currentPage.uri))return!1;if(!i)return 1!=t&&this.router.onError(),!1;if(s)if("horizontal"==this.viewOpts.viewertype||this.isStickyVerticalViewer)s.stop();else{o==s&&e.nextPageVisible||s.stop();var r=s&&this.getPage(s.num+1);r&&!(r==i||r==o&&e.nextPageVisible)&&r.stop()}else e.animation=!1;this.pauseLoading("page-change-animation"),this.currentPage=i,s&&s.resetWaitForAnimationEnd(),clearInterval(this.showPageCompleteInterval),this.$pages_container.toggleClass("disable-transitions",!e.animation),e.animation&&(this.viewOpts.slidein&&s&&s.num>i.num?s.waitForAnimationEnd(p):i.waitForAnimationEnd(p)),this.direction=!s||s.num<i.num?"forward":"backward";var l=i.num-this.getPreloadPageCount(i.num-1,"forward"===this.direction?"backward":"forward"),c=i.num+this.getPreloadPageCount(i.num-1,this.direction);"horizontal"!=this.opts.viewertype||this.opts.arrows||(l=c=i.num);for(var h=0;h<this.pages.length;h++){var d=this.pages[h];d.num<i.num?d.setPosition("prev",d.num+1==i.num):d.num>i.num?d.setPosition("next",d.num-1==i.num):d.setPosition("center",d.num==i.num),d.num>=l&&d.num<=c&&d.show(),"vertical"==this.viewOpts.viewertype&&(d.num<i.num||d.num>i.num+1)&&d.resetScrollOnVerticalMode()}function p(){function t(){for(var t=0;t<n.pages.length;t++){var e=n.pages[t];(e.num<l||e.num>c)&&e.hide()}!n.lastFinalPageState&&i.start(),n.loadPages()}e.animation||a||window.requestAnimationFrame((function(){n.$pages_container.removeClass("disable-transitions")})),n.continueLoading("page-change-animation"),"vertical"==n.viewOpts.viewertype&&"scroll"!=e.initiator&&n.setScroll(n.magPagesPos[i.num].y),n.isPreview&&n.$el.scrollTop(0),clearInterval(n.showPageCompleteInterval),n.loadingPaused?n.showPageCompleteInterval=setInterval((function(){n.loadingPaused||(clearInterval(n.showPageCompleteInterval),t())}),17):t()}!e.animation&&p(),this.scheduleSetUrlString({replace:!a,skipInternalHistory:e.skipInternalHistory}),this.router.setTitle(),this.trigger("pageChanged",i,{showPageCounter:e.animation||e.bySwipe||a||"scroll"==e.initiator,initial:a}),i.trigger("changedTo"),"vertical"==this.viewOpts.viewertype&&this.updateArrowsColor(i)},scheduleSetUrlString:function(){if(!Modernizr.chrome)return this.router.setUrlString.apply(this.router,arguments),this.router.trackPage(),void(this._resetUrlStringTimeoutFunc=!1);var t=arguments;this._resetUrlStringTimeoutFunc=function(){clearTimeout(this._urlStrigScheduleTimeout),this._urlStrigScheduleTimeout=setTimeout(function(){this._resetUrlStringTimeoutFunc=null,this.router.setUrlString.apply(this.router,t),this.router.trackPage()}.bind(this),100)}.bind(this),this._resetUrlStringTimeoutFunc()},goNextPage:function(t){var e=this.finalPage&&this.finalPage.shown;this.isLastPage()?e||(this.finalPage&&this.finalPage.show(),this.finalPage&&this.redrawAboveGlobalWidgets(this.finalPage)):this.currentPage&&this.router.go(this.currentPage.num+1,t)},goPrevPage:function(t){var e=this.finalPage&&this.finalPage.shown;if(this.isLastPage()&&e)return this.finalPage&&this.finalPage.hide(),void(this.finalPage&&this.redrawAboveGlobalWidgets(this.currentPage));this.isFirstPage()||this.currentPage&&this.router.go(this.currentPage.num-1,t)},goFirstPage:function(){this.router.go(1)},goLastPage:function(){this.router.go(this.getPagesCount())},pauseLoading:function(t){this.pauseReasons=this.pauseReasons||{},this.pauseReasons[t]=!0,this.loadingPaused=!0},continueLoading:function(t){this.pauseReasons=this.pauseReasons||{},this.pauseReasons[t]=!1,this.loadingPaused=!a.a.every(a.a.values(this.pauseReasons),(function(t){return!t}))},loadPages:function(){if(this.pages&&this.pages.length){var t=this.getPagesLoadOrder();if(t&&t.length){var e,i,s=[],o=[];for(e=0;e<t.length;e++){var n=(i=this.pages[t[e]]).getWidgetsPacks();n.length&&s.push(n),o=o.concat(i.getImmediatePack())}if(s.length){var a=[];for(e=0;e<s.length;e++){0==e&&l(e,0),l(e+1,0);for(var r=1;r<s[e].length;r++)l(e,r)}a.unshift(o),this.widgetsPacksLoadQueue=a,this.stopPagesLoad(),this.loadNextWidgetsPack()}}}function l(t,e){t<0||t>=s.length||e<0||e>=s[t].length||a.push(s[t][e])}},stopPagesLoad:function(){clearTimeout(this.loadNextWidgetsTimer)},loadNextWidgetsPack:function(){if(this.widgetsPacksLoadQueue.length)if(this.loadingPaused)this.loadNextWidgetsTimer=setTimeout(this.loadNextWidgetsPack,50);else{var t=this.widgetsPacksLoadQueue.shift();if(t.length){var e=a.a.uniq(a.a.map(t,"page")),i=e[0];if(1!==e.length||i.shown&&!i.loaded){this.widgetPackCount;i.loadWidgetsPack(t,a.a.bind((function(){this.widgetPackCount++,this.loadNextWidgetsTimer=setTimeout(this.loadNextWidgetsPack,17)}),this))}else this.loadNextWidgetsTimer=setTimeout(this.loadNextWidgetsPack,17)}else this.loadNextWidgetsTimer=setTimeout(this.loadNextWidgetsPack,17)}else n.a.trigger("widgetsQueue:empty",this.num_id)},getPreloadPageCount:function(t,e){if("horizontal"==this.viewOpts.viewertype)return this.PRELOAD_COUNT[e];for(var i=1,s=0,o="forward"==e?1:-1;s<this.PRELOAD_COUNT[e]&&i*o+t<this.pages.length&&i*o+t>=0;)s+=this.pages[i*o+t].height,i++;return i},getPagesLoadOrder:function(){var t=this.currentPage;if(t){var e,i=t.num-1,s=this.pages.length,o=[],n=this,a=t.num-this.getPreloadPageCount(i,"forward"==this.direction?"backward":"forward"),r=t.num+this.getPreloadPageCount(i,this.direction);if(l(i),"backward"==this.direction){for(l(i-1),l(i+1),e=i-2;e>=a;e--)l(e);for(e=i+2;e<=r;e++)l(e)}else{for(l(i+1),l(i-1),e=i+2;e<=r;e++)l(e);for(e=i-2;e>=a;e--)l(e)}return o}function l(t){t<0||t>=s||!n.pages[t].shown||n.pages[t].loaded||o.push(t)}},onGestureChange:function(){this.onResize.__debounced()},checkFullscreen:function(){this.fullscreenCheckCounter=5,clearInterval(this.fullscreenCheckTimer),this.fullscreenCheckTimer=setInterval(a.a.bind((function(){var t=window.fullScreen||window.innerWidth==screen.width&&window.innerHeight>=screen.height-1;this.togglePresentationMode(t),this.fullscreenCheckCounter--,this.fullscreenCheckCounter||clearInterval(this.fullscreenCheckTimer)}),this),500)},onResize:function(t){if(this.checkFullscreen(),!U.a.isDesktop&&"horizontal"==this.viewOpts.viewertype||"vertical"==this.viewOpts.viewertype&&!this.isStickyVerticalViewer){var e="horizontal"==this.viewOpts.viewertype?Object(s.a)("html, body").add(this.$el):this.$el,i=h.b.isPageNativelyScaled(),o=window.innerHeight;337==o&&414==Object(s.a)(window).height()&&o++,e.height(i?"100%":o),!i&&e.scrollTop(0)}var n=this.getContainerSize(),r=this.isPortrait()?"portrait":"landscape",l=!1;if(!U.a.isDesktop&&this.prevOrientation&&this.prevOrientation!=r&&(this.switchToViewport(this.getMagViewport()),this.setPagesTransitions(),this.stopPagesLoad(),l=!0,setTimeout(this.onResize,300),setTimeout(this.onResize,1500)),this.prevOrientation=r,this.isPreview&&"default"!=this.viewport){var c=Math.round((this.$el.width()-n.width)/2),d=Math.round((this.$el.height()-n.height)/2);this.$mag_container.add(this.$mag_viewport_device).css({top:Math.max(d,0),left:Math.max(c,0),width:n.width,height:n.height})}else this.$mag_container.add(this.$mag_viewport_device).css({top:"",left:"",width:"",height:""});this.$mag_viewport_device.attr("data-viewport",this.viewport),this.setNewPagesWidths(n.width,n.height),this.magHeight=0,this.magPagesPos=[];var p=this.pages&&this.pages.length;if(a.a.each(this.pages,a.a.bind((function(t,e){var i=t.onResize({absolutePosition:this.magHeight}),s=0;(e<p-1||this.finalPage)&&this.viewOpts.slidein&&(s=this.SCROLL_SNAP),this.magPagesPos[t.num]={y:this.magHeight,h:i,dh:s},this.magHeight+=i+s}),this)),this.finalPage&&(this.isStickyVerticalViewer&&this.finalPage.setSizeAndPosForStickyVersion({absolutePosition:this.magHeight}),this.magHeight+=this.finalPage.getHeight()),"vertical"===this.viewOpts.viewertype&&this.magHeight){var u=this.$magScrollSizer.width(),g=0;if(this.isPreview&&"default"!==this.viewport&&(g=Math.max(this.$el.height()-this.getViewportSetting("min_height"),0)),this.$magScrollSizer.css("height",this.magHeight+g),u!=this.$magScrollSizer.width()&&U.a.isDesktop&&this.onResize(),this.currentPage)if(this.isStickyVerticalViewer){if(l){var m=this.getScrollPosForNewSize();setTimeout(a.a.bind((function(){this.setScroll(m)}),this),0)}}else this.setScroll(this.getScrollPosForNewSize()),this.onMagScroll();this.$bottomArrow&&this.$bottomArrow.toggleClass("offscreen",this.getScroll()+n.height+this.SCROLLABLE_TRESHOLD>this.magHeight)}if("horizontal"==this.viewOpts.viewertype&&this.currentPage&&l){m=this.getScrollPosForNewSize();setTimeout(a.a.bind((function(){this.currentPage.$scrollWrapper.scrollTop(m)}),this),0),this.aboveGlobalWidgetsRendered||setTimeout(a.a.bind((function(){this.aboveGlobalWidgetsRendered||this.renderAboveGlobalWidgets(this.currentPage)}),this),40)}this.currentPage&&this.loadPages.__debounced()},getScrollPosForNewSize:function(){return this.currentPage?"vertical"==this.viewOpts.viewertype?this.magPagesPos[this.currentPage.num].y+(this.lastPageScrollPercent||0)*this.currentPage.pageHeight:(this.lastPageScrollPercent||0)*this.currentPage.pageHeight:0},setNewPagesWidths:function(t,e){var i=this.$el.find("#page-position-style"),o=U.a.isDesktop?"":" translateZ(0)",n="        .mag .mag-pages-container .container {\n          left: 0px;\n          width: "+t+"px;\n        }\n        .mag .mag-pages-container .container .page {\n          left: 0px;\n          width: "+t+"px;\n        }\n        .mag .mag-pages-container .container .final-page {\n          left: 0px;\n          width: "+t+"px;\n        }\n",a="";if("horizontal"==this.viewOpts.viewertype)a="          .mag .mag-pages-container .container .final-page.offscreen {\n            -webkit-transform: translateX("+t+"px) "+o+";\n            transform: translateX("+t+"px) "+o+";\n          }\n          .mag .mag-pages-container .container .page.prev-page {\n            -webkit-transform: translateX("+(this.viewOpts.slidein?0:-t)+"px) "+o+";\n            transform: translateX("+(this.viewOpts.slidein?0:-t)+"px) "+o+";\n          }\n          .mag .mag-pages-container .container .page.center-page {\n            -webkit-transform: translateX(0) "+o+";\n            transform: translateX(0) "+o+";\n          }\n          .mag .mag-pages-container .container .page.next-page {\n            -webkit-transform: translateX("+t+"px) "+o+";\n            transform: translateX("+t+"px) "+o+";\n          }";else if(this.isStickyVerticalViewer){var r=this.getContainerSizeCached().height;a="            .mag .mag-pages-container .container .page .page-fixed-bg-container,            .mag .mag-pages-container .container .page .fixed-position-container,            .mag .mag-pages-container .container .page .fixed-position-container-top {              height: "+r+"px;            }\n            .mag .mag-pages-container .container .page .fixed-position-container,            .mag .mag-pages-container .container .page .fixed-position-container-top,            .mag .mag-pages-container .container .page:not(.hide-sticky) .content-scroll-wrapper {              margin-top: "+-r+"px;            }\n"}else a="            .mag .mag-pages-container .container .final-page {\n              top: "+(e+1)+"px;            }\n            .mag .mag-pages-container .container .page.prev-page {\n              top: "+(-e-1)+"px;            }\n            .mag .mag-pages-container .container .page.next-page {\n              top: "+(e+1)+"px;            }\n";i.length||(i=Object(s.a)('<style id="page-position-style" type="text/css">')).appendTo(this.$el),"horizontal"==this.viewOpts.viewertype?(this.$pages_container.addClass("disable-transitions-on-resize"),i.text(n+a),this.$pages_container.height(),this.$pages_container.removeClass("disable-transitions-on-resize")):i.text(n+a)},setPagesTransitions:function(){var t=this.$el.find("#page-transition-style"),e=this.getPageTransitionTime(),i="cubic-bezier(0.40, 0.24, 0.40, 1)",o="        .mag .mag-pages-container .container .page {\n          -webkit-transition:\tall "+e+"ms "+i+";          transition: all "+e+"ms "+i+";        }\n        .mag .mag-pages-container .container .page.center-page {\n          -webkit-transition:\tall "+(e-5)+"ms "+i+";          transition: all "+(e-5)+"ms "+i+";        }\n        .mag .mag-pages-container .container .final-page {\n          -webkit-transition:\tall "+e+"ms "+i+";          transition: all "+e+"ms "+i+";        }\n        ";t.length||(t=Object(s.a)('<style id="page-transition-style" type="text/css">')).appendTo(this.$el),t.text(o)},switchToViewport:function(t){if(this.viewport!=t){var e=this.viewport;this.containerSize=null,this.viewport=t,this.trigger("change:viewport",{viewport:this.viewport,oldViewport:e}),this.aboveGlobalWidgetsRendered=!1,this.aboveGlobalWidgets&&this.aboveGlobalWidgets.forEach((function(t){t.destroy(),t.off()})),this.aboveGlobalAnimations&&this.aboveGlobalAnimations.destroy(),this.aboveGlobalWidgets=[],a.a.each(this.pages,(function(t){t.updateViewport()}))}},getContainerSize:function(){var t,e,i=this;return this.isPreview&&"default"!=this.viewport?(t=this.getViewportSetting("width"),e=Math.min(this.getViewportSetting("min_height"),this.$el.height())):(t=RM.screenshot?Object(s.a)(window).width():this.$el.width(),e=RM.screenshot?window.innerHeight:this.isStickyVerticalViewer&&Modernizr.safari&&!U.a.isDesktop?i.isPortrait()?Math.max(window.innerHeight,screen.height-20-20+1):Math.min(screen.width,screen.height):this.isStickyVerticalViewer?window.innerHeight:this.$el.height()),this.containerSize={width:t,height:e},this.containerSize},getContainerSizeCached:function(){return this.containerSize||this.getContainerSize()},isPortrait:function(){return window.screen?window.screen.orientation&&window.screen.orientation.type?!!window.screen.orientation.type.match(/portrait/i):0===window.orientation||90!==window.orientation&&-90!==window.orientation&&window.innerWidth<window.innerHeight:window.innerWidth<window.innerHeight},getMagViewport:function(){var t=this.isPortrait();if(this.isPreview)return this.constructorViewport||"default";var e=B.a.Default,i=window.innerWidth;if(Modernizr.retina||!U.a.isDesktop||Modernizr.ismobile){if(screen&&screen.width&&(i=t?Math.min(screen.width,screen.height):Math.max(screen.width,screen.height)),t)return i<600?B.a.PhonePortrait:i>=600&&i<=1024?B.a.TabletPortrait:B.a.Default;if(i>980)return B.a.Default}if(Modernizr.isipad)return t?B.a.TabletPortrait:B.a.Default;if(!U.a.isDesktop){var s=i,o=a.a.reduce(B.b.viewports,(function(t,e,i){return Math.abs(e.width-s)<=Math.abs(B.b.viewports[t].width-s)?i:t}),0);e=B.b.viewports[o].name}return e},getViewportSetting:function(t,e){return e=e||this.viewport,(a.a.findWhere(B.b.viewports,{name:e})||{})[t]},log:function(){for(var t="",e=0;e<arguments.length;e++)t+=arguments[e]+" ";var i=Object(s.a)("#log");i.length||(i=Object(s.a)('<div id="log">').css({position:"fixed",background:"rgba(0, 0, 0, 0.7)",color:"#fff",width:200,height:300,left:10,top:10,"z-index":999999,overflow:"auto"}).appendTo("body"));var o=i.html(),n=o.split("<br>");i.html(n.slice(-17).join("<br/>")+"<br/>"+t),i.scrollTop(999999)},fixFocusScroll:function(){this.$mag_container.scrollTop(0),this.$mag_container.scrollLeft(0)},matchSameDomainLink:function(t){var e=t.match(new RegExp("//"+h.b.escapeSpecial(window.location.hostname)+"/(.*)")),i=e&&e[1];if(i){var s=this.getPage(i);if(s)return s._id}return t},getScale:function(t){if(RM.screenshot)return 1;var e=Math.min(this.viewOpts.scalewidth,this.getContainerSizeCached().width),i=e/this.getViewportSetting("width",t);return e<this.getContainerSizeCached().width&&this.viewOpts.scalableviewer&&!Modernizr.firefox&&this.$el.find(".page-content-container").addClass("scale-centring"),z.a.normalize(i)},getWidgetById:function(t,e){var i,s,o=e&&e.getWidgetDataById(t)?e:a.a.find(this.pages,(function(e){return e.getWidgetDataById&&e.getWidgetDataById(t)}));return o?(s=o.getWidgetById(t))?i=window.Promise.resolve(s):o.loaded||(i=new window.Promise(function(e,i){this.listenToOnce(o,"loaded"+t,(function(){var s=o.getWidgetById(t);s?e(s):i()}))}.bind(this))):a.a.find(this.aboveGlobalWidgetsData,{_id:t})&&((s=a.a.find(this.aboveGlobalWidgets,{_id:t}))?i=window.Promise.resolve(s):this.aboveGlobalWidgetsRendered||(i=new window.Promise(function(e,i){this.listenToOnce(this,"aboveGlobalWidgetsRendered",(function(){var s=a.a.find(this.aboveGlobalWidgets,{_id:t});s?e(s):i()}))}.bind(this)))),i||window.Promise.reject()},renderAboveGlobalWidgets:function(t){var e=[],i=t.pageViewport;a.a.each(this.aboveGlobalWidgetsData,function(s){var o,n=a.a.find(this.aboveGlobalWidgets,{_id:s._id});if(n&&(n.destroy(),n.off()),s){var r=t.getWidgetViewportData(s,i),l=!this.isPreview&&D.a.hasExpired(r);F.a[r.type]&&!l&&((o=new F.a[r.type](r,t)).$fixedContainer=this.$aboveWidgetsContainer,o.isValid()&&e.push(o))}}.bind(this)),this.aboveGlobalAnimations=this.initializeAboveGlobalAnimation(e,t),a.a.each(e,(function(t){t.render(),t.hidden?R.a.hide(t,!0):R.a.show(t,!0)})),this.aboveGlobalWidgets=a.a.sortBy(e,"y"),this.aboveGlobalWidgetsRendered=!0,this.trigger("aboveGlobalWidgetsRendered")},initializeAboveGlobalAnimation:function(t,e){t=a.a.isArray(t)?t:[t],e.scale=this.getScale(e.pageViewport);var i=new H.a({page:e,widgets:t}),s=[];return a.a.each(t,(function(t){var e=new window.Promise((function(e){t.loaded?e(t):t.on("loaded",e.bind(null,t))}));s.push(e)})),window.Promise.all(s).then(function(){this.aboveAnimationsReady=!0,this.trigger("aboveAnimationsReady")}.bind(this)),this.listenTo(e,"resize",(function(t){a.a.isUndefined(t.prevScale)||t.prevScale===t.scale||i.updateTimelines(),i.onResize({updateAll:!0})})),i},updateAboveGlobalViewport:function(t,e){var i=a.a.find(this.aboveGlobalWidgetsData,{_id:t._id}),s=e.getWidgetViewportData(i,e.pageViewport);if(t.animationObj&&this.aboveGlobalAnimations.removeAnimation(t.animationObj),t.destroy(),t.initialize(s,e),t.hasAnimation()){var o=this.aboveGlobalAnimations.addAnimation(t);o&&o.start()}t.render(),R.a.hide(t,!0)},getAboveGlobalBox:function(t,e,i){var s=a.a.find(this.aboveGlobalWidgetsData,{_id:t}),o=e.getWidgetViewportData(s,e.pageViewport);return h.b.getFixedPositionBox(o.fixed_position,a.a.pick(o,["x","y","w","h"]),e.scale,i)},redrawAboveGlobalWidgets:function(t,e,i,s){if(!t){var o=a.a.isUndefined(this.getScroll())?void 0:this.findPageOnCurrentMagScroll(),n=o&&o.page.num,r=o&&this.getScrollParams(o);t=n&&this.getPage(n),e=t&&this.getPage(t.num+1),i=r&&(r.slideInNextPageScroll||r.nextPageScroll),s=r&&r.animation}i=a.a.isUndefined(i)?void 0:Math.abs(i);var l={width:Math.min(this.viewOpts.scalewidth,this.getContainerSizeCached().width),height:this.getContainerSizeCached().height},c=function(t,e){return!t.page||e&&t.page.pageViewport!==e.pageViewport};if(a.a.isUndefined(i)){var d=this.getPageTransitionTime();a.a.each(this.aboveGlobalWidgets,function(e){var i=t._id&&!R.a.isHidden(e,t._id,this.isPreview),o=t._id&&c(e,t);t._id&&e.updatePage(t),o&&this.updateAboveGlobalViewport(e,t),i?s?e.wasHidden&&h.b.waitForTransitionEnd(t.$el,d,"transform",R.a.show.bind(null,e)):e.wasHidden&&R.a.show(e):!e.wasHidden&&R.a.hide(e)}.bind(this))}else{var p=Math.abs(i);a.a.each(this.aboveGlobalWidgets,function(i){var s=!R.a.isHidden(i,t._id,this.isPreview),n=e&&!R.a.isHidden(i,e._id,this.isPreview),a=s&&n&&t.pageViewport===e.pageViewport,r=this.getAboveGlobalBoxMemoized(i._id,t,l),h=this.getAboveGlobalBoxMemoized(i._id,e||t,l),d=!U.a.isDesktop&&o&&o.finalPageScroll&&o.finalPageScroll>0,u=s&&p>r.top+r.height&&!d,g=e&&n&&h.top>p,m=!e&&s&&(!t.mag.viewOpts.endpage||!!o&&void 0===o.finalPageScroll);if(u||g||a||m){var f=u?t:g?e:i.page,v=c(i,f);i.updatePage(f),v?(i.rendered=!1,R.a.hide(i).then(function(){this.updateAboveGlobalViewport(i,f),R.a.show(i)}.bind(this))):i.wasHidden&&R.a.show(i)}else!i.wasHidden&&R.a.hide(i)}.bind(this))}}});e.a=ft},bLmx:function(t,e,i){"use strict";i.d(e,"c",(function(){return r})),i.d(e,"b",(function(){return l})),i.d(e,"e",(function(){return c})),i.d(e,"f",(function(){return h})),i.d(e,"d",(function(){return d})),i.d(e,"a",(function(){return p}));var s=i("v83y");function o(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var a=function(t){return s.EditorState.forceSelection(t,t.getSelection())},r=function(t){return t.getCurrentInlineStyle()},l=function(t){return t.getCurrentContent().getBlockForKey(t.getSelection().getStartKey()).getType()},c=function(t,e){return s.RichUtils.toggleBlockType(a(t),e)},h=function(t,e){return s.RichUtils.toggleInlineStyle(a(t),e)},d=function(t){return{blocks:(t.blocks||[]).map((function(e){var i=(t.styles||[]).find((function(t){return t.key===e.key}));return function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(i,!0).forEach((function(e){n(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):o(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},e,{type:i?i.type:"unstyled",inlineStyleRanges:i?i.inlineStyles:[]})})),entityMap:{}}},p=function(t){return{blocks:t.blocks.map((function(t){return{key:t.key,text:t.text,entityRanges:t.entityRanges,data:t.data,depth:t.depth}})),styles:t.blocks.map((function(t){return{key:t.key,type:t.type,inlineStyles:t.inlineStyleRanges}}))}}},bXDN:function(t,e,i){},btdP:function(module,exports){module.exports={"template-constructor-control-picture-color":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Color" data-alt-pos="left" data-alt-offset="9"><div class="opacity-grid"></div><div class="color-circle"></div></div>\n\n\t<div class="panel">\n\t</div>\n\n';return __p}}},cBBe:function(t,e,i){"use strict";var s=i("xi34"),o=i("q1z7"),n=i.n(o),a=i("rFsW"),r=i("gHxz"),l=i.n(r),c=i("OTSC"),h=n.a.View.extend({TIP_GAP:15,initialize:function(t){t&&(a.a.bindAll(this),this.block=t.block,this.model=t.model,this.$container=t.$container,this.environment=t.environment,this.mag=t.mag,this.template=l.a["template-common-hotspot-widget"],this.render())},render:function(){this.setElement(Object(s.a)(this.template({data:this.model}))),"viewer"===this.environment&&(this.apply_tip_container_size({width:this.model.tip_w,height:this.model.tip_h}),this.apply_tip_position(this.model)),this.$el.appendTo(this.$container)},apply_tip_container_size:function(t){t&&0===t.height&&(t.height=120),t&&this.$(".tip").css(t)},apply_tip_bg_color:function(t){this.$(".blocks-wrapper").css("background-color",c.b.getRGBA(t["tip_background-color"],t["tip_background-color-opacity"]/100))},apply_tip_border_radius:function(t){this.$(".blocks-wrapper").add(this.$(".tip")).css("border-radius",t["tip_border-radius"]+"px")},apply_tip_box_shadow:function(t){this.$(".tip").toggleClass("box-shadow",!!t["tip_box-shadow"])},apply_tip_position:function(t){var e,i=this.$(".tip"),s=t.tip_pos,o=t.tip_w,n=t.tip_h||120,a=t.w,r=t.h,l="",c="",h=this.TIP_GAP;return"top"===s?(l=-(h+n),c=a/2-o/2):"right"===s?(l=r/2-n/2,c=a+h):"bottom"===s?(l=r+h,c=a/2-o/2):"left"===s&&(l=r/2-n/2,c=-(h+o)),e={top:l,left:c},i.css(e),e},destroy:function(){this.remove()}});e.a=h},cre3:function(t,e,i){"use strict";var s=i("GvkG");i.n(s).a},csmR:function(module,exports){module.exports={"template-common-audio-player-standard":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<iframe class="common-audio-player standard" width="100%" height="100%" scrolling="no" frameborder="no" src="'+(null==(__t=src)?"":_.escape(__t))+'"></iframe>\n';return __p},"template-common-audio-player-minimal":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="common-audio-player minimal loading">\n\n\t\t<div class="sc-artwork-list">\n\t\t\t<div class="sc-loaded-artwork"></div>\n\t\t\t<div class="sc-artworks-overlay"></div>\n\t\t</div>\n\n\t\t<div class="sc-info">\n\t\t\t<h3></h3>\n\t\t\t<h4></h4>\n\t\t</div>\n\n\t\t<div class="sc-scrubber no-rmswipe">\n\t\t\t<div class="sc-hover-indicator"></div>\n\t\t\t<div class="sc-time-span">\n\t\t\t\t<div class="sc-buffer"></div>\n\t\t\t\t<div class="sc-played"></div>\n\t\t\t\t<div class="sc-button-wrapper">\n\t\t\t\t\t<div class="sc-button">\n\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="12" height="12"><path d="M0 0 L12 6 L0 12  Z " style="fill:#1d1a1b; stroke:none; stroke-width:0"></path></svg>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="sc-time-indicators">\n\t\t\t\t<span class="sc-left"></span>\n\t\t\t</div>\n\t\t</div>\n\n\t</div>\n';return __p},"template-common-audio-player-engine-html5":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="common-audio-player-engine">\n\t\t<audio preload="auto"></audio>\n\t</div>\n';return __p},"template-common-audio-player-engine-flash":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="common-audio-player-engine">\n\t\t<object height="100%" width="100%" id="'+(null==(__t=id)?"":_.escape(__t))+'">\n\t\t\t<embed allowscriptaccess="always" height="100%" width="100%" src="'+(null==(__t=swf)?"":__t)+'" type="application/x-shockwave-flash" name="'+(null==(__t=id)?"":_.escape(__t))+'" />\n\t    </object>\n\t</div>\n';return __p},"template-common-audio-player-engine-flash-ie":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="common-audio-player-engine">\n\t\t<object height="100%" width="100%" id="'+(null==(__t=id)?"":_.escape(__t))+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" data="'+(null==(__t=swf)?"":_.escape(__t))+'">\n\t\t\t<param name="movie" value="'+(null==(__t=swf)?"":_.escape(__t))+'" />\n\t\t\t<param name="allowscriptaccess" value="always" />\n\t\t</object>\n\t</div>\n';return __p}}},"cx/9":function(t,e,i){},dptL:function(t,e,i){"use strict";i.r(e);var s=i("xi34"),o=i("q1z7"),n=i.n(o),a=i("rFsW"),r=i("q7tt"),l=i("R31J"),c=i.n(l),h=i("MAfP"),d=i.n(h),p=i("q5gH"),u=i("m41J"),g=p.a.extend({baseDimension:"width",initialize:function(t){p.a.prototype.initialize.apply(this,arguments),this.setSizeConstraints()},setSizeConstraints:function(){var t=this.getLimits();this.minwidth=Math.max(15,t.minwidth||0),this.minheight=Math.max(15,t.minheight||0),this.maxwidth=Math.min(1/0,t.maxwidth||1/0),this.maxheight=Math.min(1/0,t.maxheight||1/0)},getLimits:function(){var t=this.block.getModelBox(),e=this.block.isFullWidth()?"height":this.baseDimension,i=a.a.reduce(this.block.blocks,(function(t,i){var s=i.getModelBox(),o={minwidth:i.frame&&i.frame.minwidth,minheight:i.frame&&i.frame.minheight,maxwidth:i.frame&&i.frame.maxwidth,maxheight:i.frame&&i.frame.maxheight};if(i.proportional&&(o=u.a.getBoxLimits(s,o)),i.frame&&i.frame.applyExtraConstraints){var n=i.frame.applyExtraConstraints({width:o.minwidth,height:o.minheight});o.minwidth=n.width,o.minheight=n.height}var a=s.angle?u.a.calcBoundingBox(s,!1,!0):s,r=(s.angle?a[e]:s[e])/o["min"+e],l=(s.angle?a[e]:s[e])/o["max"+e];return{min:Math.min(r,t.min),max:Math.max(l,t.max)}}),{min:1/0,max:0});return{minwidth:t.width/i.min,minheight:t.height/i.min,maxwidth:t.width/i.max,maxheight:t.height/i.max}},show:function(t){a.a.each(this.block.blocks,(function(t){t.frame.hide()})),p.a.prototype.show.apply(this,arguments)},onResizeStart:function(t,e){p.a.prototype.onResizeStart.apply(this,arguments),a.a.each(this.block.blocks,(function(i){i.frame.onResizeStart(t,e,{isGroupResize:!0})}))},onResizeEnd:function(t,e){p.a.prototype.onResizeEnd.apply(this,arguments),a.a.each(this.block.blocks,(function(i){i.frame.onResizeEnd(t,e,{skipHistory:!0,skipPersist:!0,isGroupResize:!0})}))},doResize:function(t,e,i,s){this.block.line&&this.block.line.update(t,this.block.isVisible(),this.block.model.get("fixed_position"),this.block.model.getViewport());var o=this.block.getModelBox(),n=this.resizeBlock.bind(this,o,t,i,s),r=a.a.map(this.block.blocks,n),l=u.a.getBoundingBoxOfBoxes(r);return this.block.css(a.a.extend({},l,{doNotRedrawPacksFrames:!0}),this.currentResizePoint),l},resizeBlock:function(t,e,i,s,o){var n=o.getModelBox(),r=n.angle,l=r?u.a.calcBoundingBox(n,!1,!0):n,c=u.a.getResizedBoxNested(l,t,e,this.block.isFullWidth()?"height":null);c=o.frame.applyConstraints(c,{direction:i,fromCenter:s,packBox:e,ratio:r?l[this.baseDimension]/l["width"===this.baseDimension?"height":"width"]:o.ratio,baseDimension:this.baseDimension});var h=r?u.a.getResizedBoxByBB(n,l,c):c;return o.css(a.a.extend({},{left:Math.round(h.left),top:Math.round(h.top),width:Math.round(h.width),height:Math.round(h.height)},{doNotRedrawPacksFrames:!0,isGroupResize:!0,groupedIds:"hotspot"===o.model.get("type")?a.a.map(this.block.blocks,"id"):[]})),o.recalcFixedLine(),o.recalcStickedLine(),c}});function m(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function f(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?m(i,!0).forEach((function(e){v(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):m(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function v(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i.d(e,"WidgetPackModel",(function(){return b})),i.d(e,"WidgetPack",(function(){return _}));var b=n.a.Model.extend({defaults:{type:"pack",visible:!1,x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY,r:Number.NEGATIVE_INFINITY,b:Number.NEGATIVE_INFINITY,w:0,h:0,aspect:null,angle:0,fixed_position:null,is_full_width:!1,is_full_height:!1,flip_v:!1,flip_h:!1,sinAngle:0,cosAngle:1,viewport:"default"},getViewport:function(){return this.get("viewport")},reset:function(){this.set(this.defaults)}}),_=r.a.extend({id:null,blocks:null,workspace:null,latestPosSizeAngle:null,frame:null,line:null,proportional:!0,initialize:function(t){a.a.bindAll(this),this.blocks=[],this.latestPosSizeAngle={},this.model=new b,this.workspace=t.workspace},render:function(){var t=c.a["template-pack"]({id:this.id,templates:f({},d.a)});return this.setElement(Object(s.a)(t)),this.bindHandlers(),this.frame=new g({packId:this.id,block:this,blocks:this.blocks}),this.rendered=!0,this.$el},getCss:function(t,e){var i=this.model.attributes;return{left:i.x+(i.fixed_position?t:0),top:i.y+(i.fixed_position?e:0),width:i.w,height:i.h,position:i.fixed_position?"fixed":"absolute","z-index":i.fixed_position?999:void 0}},update:function(){var t=this.getCss(this.workspace.position.left,this.workspace.position.top);this.$el.css(t),this.isVisible()&&!this.frame.isFrameVisible()?this.frame.show():this.isVisible()||this.frame.hide(),this.$el.toggleClass("fixed-frame",this.isFixed()),this.$el.toggleClass("full-width",this.isFullWidth()),this.$el.toggleClass("full-height",this.isFullHeight()),this.recalcFixedLine()},recalcFixedLine:function(t){var e=this.model.get("fixed_position")||this.restoreFixed,i=this.isVisible()||t;e&&i&&!this.isSelection()?this.updateFixedLine(e):this.removeFixedLine()},destroy:function(){this.removeFixedLine(),r.a.prototype.destroy.apply(this,arguments)},bindHandlers:function(){var t=Object(s.a)(this.$el);t.drag("start",this.onDragStart,{not:".no-drag"}),t.drag(this.onDragMove,{delay:100}),t.drag("end",this.onDragEnd),t.on("click",this.onPackClick)},addBlock:function(t){if(this.blocks.push(t),!t.isPackFrameHidden){var e=t.getBoxData({includeBoundingBox:!0,checkFixedPosition:!0}),i=Math.min(this.model.get("x"),e.bb_x),s=Math.min(this.model.get("y"),e.bb_y),o=Math.max(this.model.get("b"),e.bb_y+e.bb_h),n=Math.max(this.model.get("r"),e.bb_x+e.bb_w),r=t.model.get("fixed_position"),l=t.model.get("is_full_width"),c=t.model.get("is_full_height");this.model.set({y:s,x:i,b:o,r:n,w:n-i,h:o-s,visible:a.a.every(this.blocks,"selected"),fixed_position:r||this.model.get("fixed_position"),is_full_width:l||this.model.get("is_full_width"),is_full_height:c||this.model.get("is_full_height"),viewport:t.model.getViewport()}),t.recalcFixedLine(),this.frame&&this.frame.setSizeConstraints()}this.latestPosSizeAngle=this.getModelBox()},reset:function(){this.blocks=[],this.model.reset()},isFixed:function(){return Boolean(this.model.get("fixed_position"))},isSelection:function(){return"selected"===this.id},isVisible:function(){return Boolean(this.model.get("visible"))},export:function(){return a.a.extend({},this.model.attributes,{id:this.id})},onDragStart:function(t,e){this.anyBlockInPackForDragging=a.a.first(this.blocks),r.a.prototype.onDragStart.call(this.anyBlockInPackForDragging,t,e)},onDragMove:function(t,e){this.anyBlockInPackForDragging&&r.a.prototype.onDragMove.call(this.anyBlockInPackForDragging,t,e)},onDragEnd:function(t,e){this.anyBlockInPackForDragging&&r.a.prototype.onDragEnd.call(this.anyBlockInPackForDragging,t,e)},onPackClick:function(t){this._justResized?this._justResized=!1:window.suppressClick&&window.suppressClick>+new Date||this.trigger("click",t)},storeFixedPosition:function(){var t=this.model.get("fixed_position");t&&(this.restoreFixed=t)},restoreFixedPosition:function(){delete this.restoreFixed,a.a.each(this.blocks,(function(t){t.restoreFixedPosition()}))},getBoxData:function(t){var e=r.a.prototype.getBoxData.apply(this,arguments);return e.b=e.y+e.h,e.r=e.x+e.w,e},getHotspotExternalPeerIds:function(){var t=a.a.map(this.blocks,"id");return a.a.reduce(this.blocks,(function(e,i){var s="hotspot"===i.model.get("type")&&a.a.difference(i.getPeerIds(),t);return a.a.each(s,(function(t){-1===e.indexOf(t)&&e.push(t)})),e}),[])},getHotspotPeerData:function(){var t=this.getHotspotExternalPeerIds();return a.a.map(t,function(t){var e=this.workspace.findBlock(t);return a.a.extend({},e.getSaveBoxData(),{_id:t})}.bind(this),{})},saveBox:function(t,e){var i=a.a.pick(this.getBoxData(),["w","h","x","y"]);this.model.set(i);var s=a.a.map(this.blocks,function(t){return a.a.extend({},t.getSaveBoxData(),{_id:t.id})}.bind(this));s=a.a.uniq([].concat(s,this.getHotspotPeerData(),e||[]),(function(t){return t._id})),this._saveXHR&&this._saveXHR.abort(),this.workspace.set_group(s,a.a.extend({isGroupResize:!0},t)),this.workspace.save_group(s,a.a.extend({isGroupResize:!0},t))}})},eS2O:function(t,e,i){"use strict";i.d(e,"a",(function(){return v}));var s=i("q1z7"),o=i.n(s),n=i("q1tI"),a=i.n(n),r=i("xi34"),l=i("q7tt"),c=i("Kf/z"),h=i("8AXF"),d=i("zjto"),p=i("onY4"),u=i("v92f");function g(t,e,i,s,o,n,a){try{var r=t[n](a),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(s,o)}var m,f,v=a.a.createContext({}),b=l.a.extend({name:"TextReact",thumb:"text-react",icon_color:"#fff",controls:["common_lock","common_animation","common_rotation","common_position","common_layer"],edit_controls:["text_color_new","text_align_new"],viewport_fields:u.b.viewport_fields.textReact,restrictions:function(){return Object(c.a)("constructor.textReact")},initialize:function(t,e){this.initBlock(t,e),this.page=e.page,this.propsModel=new o.a.Model({viewport:this.page.getCurrentViewport()}),this.page.on("change:viewport",this.onViewportChange)},render:(m=regeneratorRuntime.mark((function t(){var e,s,o,n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.create(),this.$el.addClass("text-react"),e=i("8AXF"),s=e.renderReact,t.next=5,Promise.resolve().then(i.bind(null,"zjto"));case 5:o=t.sent,n=o.TextEditor,s({component:function(){return a.a.createElement(h.CreateContextProvider,{context:v,model:r.propsModel},a.a.createElement(n,null))},domElement:this.$content[0],model:this.model}),this.reactContainer=this.$content.find("div").first(),this.reactContainer.css({pointerEvents:"none"}),this.rendered=!0,this.triggerReady();case 13:case"end":return t.stop()}}),t,this)})),f=function(){var t=this,e=arguments;return new Promise((function(i,s){var o=m.apply(t,e);function n(t){g(o,i,s,n,a,"next",t)}function a(t){g(o,i,s,n,a,"throw",t)}n(void 0)}))},function(){return f.apply(this,arguments)}),destroy:function(){return this.leaveEditMode(!0),this.page.off("change:viewport",this.onViewportChange),l.a.prototype.destroy.apply(this,arguments)},deselect:function(){l.a.prototype.deselect.apply(this,arguments),this.isEditMode&&this.leaveEditMode()},onDblClick:function(){this.selected&&this.selected&&(this.model.get("pack_id")&&1!==this.workspace.getSelectedBlocks().length?l.a.prototype.onDblClick.apply(this,arguments):this.enterEditMode())},enterEditMode:function(){this.isEditMode=!0,this.reactContainer.css({pointerEvents:"all"}),this.frame&&(this.frame.setEditorState(),this.frame.removeRotationState(),this.frame.resetRotation()),this.workspace&&this.workspace.controls&&this.workspace.controls.setControls(this.edit_controls,this);var t=r.a.event.special.drag;t.toggle.call(Object(r.a)("#main")[0],!1),t.toggle.call(this.$el[0],!1),p.a.setEmptyHandlers(),this.workspace.trigger("w-text-entered-edit-mode")},leaveEditMode:function(){this.isEditMode=!1,this.reactContainer.css({pointerEvents:"none"}),this.workspace.trigger("w-text-before-leave-edit-mode"),this.frame&&(this.frame.removeEditorState(),this.frame.restoreRotation()),this.workspace&&this.workspace.controls&&this.workspace.controls.setControls(this.controls,this);var t=r.a.event.special.drag;t.toggle.call(Object(r.a)("#main")[0],!0),t.toggle.call(this.$el[0],!0),p.a.removeCustomHandlers(),this.workspace.trigger("w-text-leaved-edit-mode")},onWorkspaceBlocksSelect:function(t){if(l.a.prototype.onWorkspaceBlocksSelect.apply(this,arguments),this.rendered){var e=t&&1===t.length&&t[0]===this;this.isEditMode&&!e&&this.leaveEditMode()}},onViewportChange:function(){var t=this.page.getCurrentViewport();this.propsModel.set({viewport:t})}},{defaults:{version:3,blocks:[],styles:[],verticalAlign:d.TextVerticalAlign.top}});e.b=b},eVPB:function(t,e,i){"use strict";var s=i("kv7G");i.n(s).a},ee0N:function(module,exports){module.exports={"template-constructor-helpers-font-explorer":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="\n\t";var initial="typekit";__p+='\n\t<div class="font-explorer">\n\t\t<div class="font-explorer-wrapper">\n\n\t\t\t<div class="left-panel">\n\n\t\t\t\t<div class="search-icon"></div>\n\n\t\t\t\t<div class="view-wrapper">\n\t\t\t\t\t<div class="grid-view active" data-name="grid"></div>\n\t\t\t\t\t<div class="list-view"  data-name="list"></div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="back-icon"></div>\n\n\n\t\t\t\t<div class="size-wrapper">\n\t\t\t\t\t<div class="top-letter">A</div>\n\t\t\t\t\t<div class="slider"></div>\n\t\t\t\t\t<div class="bottom-letter">A</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\n\n\t\t\t<div class="center-panel">\n\n\t\t\t\t<div class="search-wrapper">\n\t\t\t\t\t<div class="border"></div>\n\t\t\t\t\t<input class="search-string" type="text" placeholder=""/>\n\t\t\t\t\t<div class="clear invisible"></div>\n\t\t\t\t</div>\n\n\n\t\t\t\t<div class="scroll-wrapper main">\n\t\t\t\t\t<div class="results-wrapper">\n\t\t\t\t\t\t<div class="results" data-view="grid" data-size="4">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="scroll"></div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="scroll-wrapper info">\n\t\t\t\t\t<div class="results-wrapper">\n\t\t\t\t\t\t<div class="results" data-view="list" data-size="4">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="scroll"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\n\n\t\t\t<div class="right-panel">\n\n\t\t\t\t<div class="providers-switcher">\n\t\t\t\t\t<ul>\n            <li '+(null==(__t="typekit"==initial?'class="active"':"")?"":__t)+' data-name="typekit"></li>\n            <li '+(null==(__t="webtype"==initial?'class="active"':"")?"":__t)+' data-name="webtype"></li>\n\t\t\t\t\t\t<li '+(null==(__t="google"==initial?'class="active"':"")?"":__t)+' data-name="google"></li>\n            <li '+(null==(__t="typetoday"==initial?'class="active"':"")?"":__t)+' data-name="typetoday"></li>\n\n\t\t\t\t\t</ul>\n\t\t\t\t\t<span></span>\n\t\t\t\t</div>\n\n        <div class="provider-filter '+(null==(__t="typekit"==initial?"":"invisible")?"":__t)+'" data-name="typekit">\n\n          <div class="filter-caption" data-initial="Classification">Classification</div>\n\n          <div class="filter classification" data-name="classification" data-multiple="0">\n            <div class="icon-sans-serif" data-name="sans-serif" data-alt="Sans Serif"></div>\n            <div class="icon-serif" data-name="serif" data-alt="Serif"></div>\n            <div class="icon-slab-serif" data-name="slab-serif" data-alt="Slab Serif"></div>\n            <div class="icon-script" data-name="script" data-alt="Script"></div>\n            <div class="icon-blackletter" data-name="blackletter" data-alt="Blackletter"></div>\n            <div class="icon-monospaced" data-name="monospaced" data-alt="Monospaced"></div>\n            <div class="icon-handmade" data-name="handmade" data-alt="Handmade"></div>\n            <div class="icon-decorative" data-name="decorative" data-alt="Decorative"></div>\n          </div>\n\n          <div class="filter-caption" data-initial="For">For</div>\n\n          <div class="filter recommended-for" data-name="recommended_for" data-multiple="1">\n            <div class="icon-paragraphs" data-name="paragraphs">Paragraphs</div>\n            <div class="icon-headings" data-name="headings">Headings</div>\n          </div>\n\n          <div class="filter-caption" data-initial="Properties">Properties</div>\n\n          <div class="filter weight" data-name="weight" data-multiple="1">\n            <div class="icon-light" data-name="light" data-alt="Light"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular"></div>\n            <div class="icon-heavy" data-name="heavy" data-alt="Heavy"></div>\n          </div>\n\n          <div class="filter width" data-name="width" data-multiple="0">\n            <div class="icon-condensed" data-name="condensed" data-alt="Condensed"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular"></div>\n            <div class="icon-extended" data-name="extended" data-alt="Extended"></div>\n          </div>\n\n          <div class="filter x-height" data-name="x_height" data-multiple="0">\n            <div class="icon-low" data-name="low" data-alt="Low x-height"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular x-height"></div>\n            <div class="icon-high" data-name="high" data-alt="High x-height"></div>\n          </div>\n\n          <div class="filter contrast" data-name="contrast" data-multiple="0">\n            <div class="icon-low" data-name="low" data-alt="Low Contrast"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular Contrast"></div>\n            <div class="icon-high" data-name="high" data-alt="High Contrast"></div>\n          </div>\n\n          <div class="filter capitals" data-name="capitals" data-multiple="0">\n            <div class="icon-uppercase-lowercase" data-name="uppercase-lowercase" data-alt="Standard"></div>\n            <div class="icon-all-or-small-caps" data-name="all-or-small-caps" data-alt="Caps Only"></div>\n          </div>\n\n          <div class="filter number-style" data-name="number_style" data-multiple="0">\n            <div class="icon-uppercase" data-name="uppercase" data-alt="Lining Figures"></div>\n            <div class="icon-lowercase" data-name="lowercase" data-alt="Old Style Figures"></div>\n          </div>\n\n\n\n          <div class="language-wrapper">\n            <div class="caption">Language Support</div>\n            <div class="arrow"></div>\n\n            <div class="filter language" data-name="language" data-multiple="1">\n              <div class="top-left left" data-name="ca">Catalan</div>\n              <div data-name="cs">Czech</div>\n              <div class="top-right" data-name="de">German</div>\n\n              <div class="left" data-name="en">English</div>\n              <div data-name="es">Spanish</div>\n              <div data-name="fr">French</div>\n\n              <div class="left" data-name="it">Italian</div>\n              <div data-name="nl">Dutch</div>\n              <div data-name="pl">Polish</div>\n\n              <div class="bottom-left bottom left" data-name="pt">Portugese</div>\n              <div class="with-corner bottom" data-name="ru">Russian</div>\n              <div class="bottom-right bottom" data-name="sv">Swedish</div>\n\n              <span class="context-panel-corner"><span class="corner"></span></span>\n            </div>\n          </div>\n\n          <a class="logo" href="http://typekit.com" target="_blank"></a>\n\n        </div>\n\n\n\n\n\n        <div class="provider-filter '+(null==(__t="webtype"==initial?"":"invisible")?"":__t)+'" data-name="webtype">\n\n          <div class="filter-caption" data-initial="Classification">Classification</div>\n\n          <div class="filter classification" data-name="classification" data-multiple="0">\n            <div class="icon-sans-serif" data-name="sans-serif" data-alt="Sans Serif"></div>\n            <div class="icon-serif" data-name="serif" data-alt="Serif"></div>\n            <div class="icon-monospaced" data-name="monospaced" data-alt="Monospaced"></div>\n          </div>\n\n          <div class="filter-caption" data-initial="For">For</div>\n\n          <div class="filter recommended-for" data-name="recommended_for" data-multiple="1">\n            <div class="icon-paragraphs" data-name="paragraphs">Paragraphs</div>\n            <div class="icon-headings" data-name="headings">Headings</div>\n          </div>\n\n          <div class="filter-caption" data-initial="Properties">Properties</div>\n\n          <div class="filter weight" data-name="weight" data-multiple="1">\n            <div class="icon-light" data-name="light" data-alt="Light"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular"></div>\n            <div class="icon-heavy" data-name="heavy" data-alt="Heavy"></div>\n          </div>\n\n          <div class="filter width" data-name="width" data-multiple="0">\n            <div class="icon-condensed" data-name="condensed" data-alt="Condensed"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular"></div>\n            <div class="icon-extended" data-name="extended" data-alt="Extended"></div>\n          </div>\n\n          <div class="filter x-height" data-name="x_height" data-multiple="0">\n            <div class="icon-low" data-name="low" data-alt="Low x-height"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular x-height"></div>\n            <div class="icon-high" data-name="high" data-alt="High x-height"></div>\n          </div>\n\n          <div class="filter contrast" data-name="contrast" data-multiple="0">\n            <div class="icon-low" data-name="low" data-alt="Low Contrast"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular Contrast"></div>\n            <div class="icon-high" data-name="high" data-alt="High Contrast"></div>\n          </div>\n\n\n          <div class="language-wrapper">\n            <div class="caption">Language Support</div>\n            <div class="arrow"></div>\n\n\n            <div class="filter language" data-name="language" data-multiple="1">\n              <div class="bottom-left top-left left bottom" data-name="latin">Latin</div>\n              <div class="with-corner bottom" data-name="cyrillic">Cyrillic</div>\n              <div class="top-right bottom-right bottom" data-name="greek">Greek</div>\n\n              <span class="context-panel-corner"><span class="corner"></span></span>\n            </div>\n\n          </div>\n\n          <a class="logo" href="http://webtype.com" target="_blank"></a>\n\n        </div>\n\n\n\t\t\t\t<div class="provider-filter '+(null==(__t="google"==initial?"":"invisible")?"":__t)+'" data-name="google">\n\n\t\t\t\t\t<div class="filter-caption" data-initial="Category">Category</div>\n\n\t\t\t\t\t<div class="filter classification" data-name="category" data-multiple="0">\n\t\t\t\t\t\t<div class="icon-sans-serif" data-name="sans-serif" data-alt="Sans Serif"></div>\n\t\t\t\t\t\t<div class="icon-serif" data-name="serif" data-alt="Serif"></div>\n\t\t\t\t\t\t<div class="icon-script" data-name="handwriting" data-alt="Handwriting"></div>\n\t\t\t\t\t\t<div class="icon-monospaced" data-name="monospace" data-alt="Monospaced"></div>\n\t\t\t\t\t\t<div class="icon-decorative" data-name="display" data-alt="Display"></div>\n\t\t\t\t\t</div>\n\n\n\t\t\t\t\t<div class="language-wrapper">\n\t\t\t\t\t\t<div class="caption">Language Support</div>\n\t\t\t\t\t\t<div class="arrow"></div>\n\n\n\t\t\t\t\t\t<div class="filter language" data-name="subsets" data-multiple="1">\n\t\t\t\t\t\t\t<div class="top-left left" data-name="cyrillic">Cyrillic</div>\n\t\t\t\t\t\t\t<div data-name="devanagari">Devanagari</div>\n\t\t\t\t\t\t\t<div class="top-right" data-name="greek">Greek</div>\n\n\t\t\t\t\t\t\t<div class="bottom-left bottom left" data-name="khmer">Khmer</div>\n\t\t\t\t\t\t\t<div class="with-corner bottom" data-name="latin">Latin</div>\n\t\t\t\t\t\t\t<div class="bottom-right bottom" data-name="vietnamese">Vietnamese</div>\n\n\t\t\t\t\t\t\t<span class="context-panel-corner"><span class="corner"></span></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<a class="logo" href="http://google.com/fonts" target="_blank"></a>\n\n\t\t\t\t</div>\n\n\n        <div class="provider-filter '+(null==(__t="typetoday"==initial?"":"invisible")?"":__t)+'" data-name="typetoday">\n\n          <div class="filter-caption" data-initial="Classification">Classification</div>\n\n          <div class="filter classification" data-name="classification" data-multiple="0">\n            <div class="icon-sans-serif" data-name="sans-serif" data-alt="Sans Serif"></div>\n            <div class="icon-serif" data-name="serif" data-alt="Serif"></div>\n          </div>\n\n          <div class="filter-caption" data-initial="For">For</div>\n\n          <div class="filter recommended-for" data-name="recommended_for" data-multiple="1">\n            <div class="icon-paragraphs" data-name="paragraphs">Paragraphs</div>\n            <div class="icon-headings" data-name="headings">Headings</div>\n          </div>\n\n          <div class="filter-caption" data-initial="Properties">Properties</div>\n\n          <div class="filter weight" data-name="weight" data-multiple="1">\n            <div class="icon-light" data-name="light" data-alt="Light"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular"></div>\n            <div class="icon-heavy" data-name="heavy" data-alt="Heavy"></div>\n          </div>\n\n          <div class="filter width" data-name="width" data-multiple="0">\n            <div class="icon-condensed" data-name="condensed" data-alt="Condensed"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular"></div>\n            <div class="icon-extended" data-name="extended" data-alt="Extended"></div>\n          </div>\n\n          <div class="filter x-height" data-name="x_height" data-multiple="0">\n            <div class="icon-low" data-name="low" data-alt="Low x-height"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular x-height"></div>\n            <div class="icon-high" data-name="high" data-alt="High x-height"></div>\n          </div>\n\n          <div class="filter contrast" data-name="contrast" data-multiple="0">\n            <div class="icon-low" data-name="low" data-alt="Low Contrast"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular Contrast"></div>\n            <div class="icon-high" data-name="high" data-alt="High Contrast"></div>\n          </div>\n\n          <div class="filter capitals" data-name="capitals" data-multiple="0">\n            <div class="icon-uppercase-lowercase" data-name="uppercase-lowercase" data-alt="Standard"></div>\n            <div class="icon-all-or-small-caps" data-name="all-or-small-caps" data-alt="Caps Only"></div>\n          </div>\n\n          <div class="filter number-style" data-name="number_style" data-multiple="0">\n            <div class="icon-uppercase" data-name="uppercase" data-alt="Lining Figures"></div>\n            <div class="icon-lowercase" data-name="lowercase" data-alt="Old Style Figures"></div>\n          </div>\n\n\n\n          <div class="language-wrapper">\n            <div class="caption">Language Support</div>\n            <div class="arrow"></div>\n\n            <div class="filter language" data-name="language" data-multiple="1">\n              <div class="top-left left" data-name="ca">Catalan</div>\n              <div data-name="cs">Czech</div>\n              <div class="top-right" data-name="de">German</div>\n\n              <div class="left" data-name="en">English</div>\n              <div data-name="es">Spanish</div>\n              <div data-name="fr">French</div>\n\n              <div class="left" data-name="it">Italian</div>\n              <div data-name="nl">Dutch</div>\n              <div data-name="pl">Polish</div>\n\n              <div class="bottom-left bottom left" data-name="pt">Portugese</div>\n              <div class="with-corner bottom" data-name="ru">Russian</div>\n              <div class="bottom-right bottom" data-name="sv">Swedish</div>\n\n              <span class="context-panel-corner"><span class="corner"></span></span>\n            </div>\n          </div>\n\n          <a class="logo" href="https://type.today" target="_blank"></a>\n\n        </div>\n\n\t\t\t\t<div class="font-info">\n\t\t\t\t\t<div class="top-info">\n\t\t\t\t\t\t<div class="name"></div>\n\t\t\t\t\t\t<div class="foundry">by <a target="_blank" href="http://123"></a></div>\n\t\t\t\t\t\t<div class="description-wrapper huge">\n\t\t\t\t\t\t\t<div class="description"></div>\n\t\t\t\t\t\t\t<a class="more" target="_blank" href="http://123">More...</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="promo">To get more styles of this typeface visit <a href="https://type.today" target="_blank">type.today</a></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="bottom-info">\n\t\t\t\t\t\t<div class="language-wrapper">\n\t\t\t\t\t\t\t<div class="caption">Language Support:</div>\n\t\t\t\t\t\t\t<div class="language">\n\t\t\t\t\t\t\t\t<div class="language-clamp"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="recommended-wrapper">\n\t\t\t\t\t\t\t<div class="caption">Recommended For:</div>\n\t\t\t\t\t\t\t<div class="recommended"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="info-add-remove-font">Add to Font Selector</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\n\n\t\t\t<div class="overlay">\n\t\t\t\t<div class="preloader"></div>\n\t\t\t</div>\n\n\t\t</div>\n\t</div>\n'}return __p},"template-constructor-helpers-font-explorer-item":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="font-item" data-img1="'+(null==(__t=img1)?"":__t)+'" data-img2="'+(null==(__t=img2)?"":__t)+'" data-font-name="'+(null==(__t=name)?"":__t)+'" data-font-id="'+(null==(__t=id)?"":__t)+'" data-font-provider="'+(null==(__t=provider)?"":__t)+'">\n\t\t<div class="caption">'+(null==(__t=text)?"":__t)+'<span class="styles-count">'+(null==(__t=styles)?"":__t)+" "+(null==(__t=Utils.declination("styles","style","styles",styles))?"":__t)+'</span></div>\n\t\t<div class="list-add-remove-font"></div>\n\t</div>\n';return __p},"template-constructor-helpers-font-explorer-no-found":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="no-found">\n\t\t<div class="header">Fk</div>\n\t\t<div class="sub-header">Sorry, no fonts found.</div>\n\t\t<div class="message">Try selecting fewer options.</div>\n\t</div>\n';return __p}}},etQA:function(t,e,i){},fsTk:function(module,exports){module.exports={"template-constructor-control-common_animation":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Animation" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t\t<div class="panel-caption">Animation</div>\n\n\t\t<div class="mixed-types">\n\t\t\t<div class="message-text">Nope, you cant mix fixed, full width, full height, sticky and normal widgets at a time.</div>\n\t\t</div>\n\n\t\t<div class="multiple-fixeds">\n\t\t\t<div class="message-text">Nope, you cant animate multiple fixed widgets at a time.</div>\n\t\t</div>\n\n\t\t<div class="multiple-stickeds">\n\t\t\t<div class="message-text">Nope, you cant animate multiple sticky widgets at a time.</div>\n\t\t</div>\n\n\t\t<div class="multiple-fullwidths">\n\t\t\t<div class="message-text">Nope, you cant animate multiple full width widgets at a time.</div>\n\t\t</div>\n\n\t\t<div class="multiple-fullheights">\n\t\t\t<div class="message-text">Nope, you cant animate multiple full height widgets at a time.</div>\n\t\t</div>\n\n\t\t<div class="non-animatable">\n\t\t\t<div class="message-text">Nope, you cant animate Facebook or Twitter widgets.</div>\n\t\t</div>\n\n\t\t<div class="multiple-animations">\n\t\t\t<div class="message-text">Therere different animations in this selection. Merge them?</div>\n\t\t\t<div class="unite-button">Yes</div>\n\t\t</div>\n\n\n\t\t<div class="top-block js-top-block">\n\t\t\t<div class="js-top-block-content top-block-content">\n\t\t\t\t<div class="type-selector">\n\t\t\t\t\t<div class="type-caption"></div>\n\t\t\t\t\t<div class="type-arrow"></div>\n\t\t\t\t\t<div class="type-popup">\n\t\t\t\t\t\t<div class="type-popup-item" data-value="none">None<div class="point"></div></div>\n\t\t\t\t\t\t<div class="type-popup-item" data-value="load">On Load<div class="point"></div></div>\n\t\t\t\t\t\t<div class="type-popup-item" data-value="scroll">On Scroll<div class="point"></div></div>\n\t\t\t\t\t\t<div class="type-popup-item" data-value="click">On Click<div class="point"></div></div>\n\t\t\t\t\t\t<div class="type-popup-item" data-value="hover">On Hover<div class="point"></div></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="reset-button">Reset</div>\n\t\t\t\t<div class="trigger-buttons-container js-trigger-buttons-container"></div>\n\t\t\t</div>\n\t\t</div>\n\n\n\t\t<div class="step-selector js-step-selector">\n\t\t\t<div class="prev-step js-prev-step"></div>\n\t\t\t<div class="step-caption js-step-caption"></div>\n\t\t\t<div class="next-step js-next-step"></div>\n\n\t\t\t<div class="step-popup js-step-popup">\n\t\t\t\t<div class="step-popup-content js-step-popup-content"></div>\n\t\t\t\t<div class="corner-wrapper">\n\t\t\t\t\t<div class="corner"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="requires-trigger">\n\t\t\t<div class="message-text">A video widget can be&nbsp;animated on&nbsp;click only with&nbsp;another widget as&nbsp;a&nbsp;trigger.</div>\n\t\t</div>\n\n\t\t<div class="cannot-use-with-picture-preview">\n\t\t\t<div class="message-text">Oops, you cant currently add this animation since Lightbox is enabled</div>\n\t\t</div>\n\n\t\t<div class="resizable-scroll-wrapper">\n\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t<div class="resizable-content">\n\n\t\t\t\t\t<div class="effects-presets-wrapper">\n\t\t\t\t\t\t<div class="effects-caption">Choose Effect</div>\n\t\t\t\t\t\t<div class="effects-item" data-value="use_move">Move</div>\n\t\t\t\t\t\t<div class="effects-item" data-value="use_opacity">Opacity</div>\n\t\t\t\t\t\t<div class="effects-item" data-value="use_rotate">Rotate</div>\n\t\t\t\t\t\t<div class="effects-item" data-value="use_scale">Scale</div>\n\n\t\t\t\t\t\t<div class="presets-caption">Presets</div>\n\t\t\t\t\t\t<div class="presets-item" data-value="fade-and-scale">Fade&Scale<div class="preview"></div></div>\n\t\t\t\t\t\t<div class="presets-item" data-value="fade-in">Fade In<div class="preview"></div></div>\n\t\t\t\t\t\t<div class="presets-item" data-value="scale-big">Scale Big<div class="preview"></div></div>\n\t\t\t\t\t\t<div class="presets-item" data-value="move-and-fade">Move&Fade<div class="preview"></div></div>\n\t\t\t\t\t\t<div class="presets-item" data-value="pulse">Pulse<div class="preview"></div></div>\n\t\t\t\t\t\t<div class="presets-item" data-value="rotate">Rotate<div class="preview"></div></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="resizable-scroll"></div>\n\t\t</div>\n\n\n\t\t<div class="resize-handle-top"></div>\n\t\t<div class="resize-handle-bottom"></div>\n\n\n\t\t<div class="bottom-block">\n\t\t\t<div class="add-effect">\n\t\t\t\t<span>Add Effect</span>\n\t\t\t\t<div class="effect-popup">\n\t\t\t\t\t<div class="effect-popup-item" data-value="use_move">Move</div>\n\t\t\t\t\t<div class="effect-popup-item" data-value="use_opacity">Opacity</div>\n\t\t\t\t\t<div class="effect-popup-item" data-value="use_rotate">Rotate</div>\n\t\t\t\t\t<div class="effect-popup-item" data-value="use_scale">Scale</div>\n\t\t\t\t\t<div class="corner-wrapper"><div class="corner"></div></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="loop-types js-loop-types">\n\t\t\t\tLoop\n\t\t\t\t<div class="loop-type loop-type-swing js-loop-swing" data-value="swing" data-alt="Reverse"></div>\n\t\t\t\t<div class="loop-type loop-type-repeat js-loop-repeat" data-value="repeat" data-alt="Cycle"></div>\n\t\t\t</div>\n\n\t\t\t<div class="play-once">\n\t\t\t\t<div class="play-once-title js-play-once">Once per user</div>\n\t\t\t\t<div class="help">\n\t\t\t\t\t<div class="help-popup">\n\t\t\t\t\t\t<div class="help-body-wrapper">\n\t\t\t\t\t\t\t<div class="help-body">\n\t\t\t\t\t\t\t\t<span class="help-text">Plays animation once to&nbsp;each person.<br />Hides animated blocks on&nbsp;consequent refreshes. <br/><a href="http://help.readymag.com/hc/en-us/articles/360021875712-Settings" target="_blank">Learn more</a></span>\n\t\t\t\t\t\t\t\t<div class="help-popup-corner">\n\t\t\t\t\t\t\t\t\t<div class="corner"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="hover-spacer"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="preview">Preview</div>\n\t\t</div>\n\n\t</div>\n';return __p},"template-constructor-control-common_animation-trigger":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="trigger js-trigger-button" data-id="'+(null==(__t=id)?"":__t)+'">\n\t\t',"onOtherPage"===status?__p+='\n\t\t\t<div class="trigger-other-page">\n\t\t\t\t<div class="trigger-name js-trigger-name">\n\t\t\t\t\tTrigger on p. '+(null==(__t=pageNumber)?"":__t)+'\n\t\t\t\t</div>\n\t\t\t\t<div class="trigger-remove-button js-remove-trigger">\n\t\t\t\t\t<div class="trigger-remove-icon"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t':"pending"===status?__p+='\n\t\t\t<div class="trigger-pending">\n\t\t\t\tChoose Trigger\n\t\t\t\t<div class="trigger-remove-button js-cancel-trigger">\n\t\t\t\t\t<div class="trigger-remove-icon"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t':"active"===status?__p+='\n\t\t\t<div class="trigger-active js-trigger-active">\n\t\t\t\t<div class="trigger-name js-trigger-name">\n\t\t\t\t\t'+(null==(__t=name)?"":__t)+'\n\t\t\t\t</div>\n\t\t\t\t<div class="trigger-remove-button js-remove-trigger">\n\t\t\t\t\t<div class="trigger-remove-icon"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t':__p+='\n\t\t\t<div class="trigger-none">\n\t\t\t\t<div class="trigger-none-caption">Add Trigger</div>\n\t\t\t\t<div class="trigger-arrow"></div>\n\t\t\t</div>\n\t\t',__p+="\n\t</div>\n";return __p},"template-constructor-control-common_animation-step":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="step">\n\n\t\t<div class="param-wrapper start-block">\n\t\t\t<div class="caption">Start Point</div>\n\t\t\t<div class="start-value">'+(null==(__t=start_point)?"":__t)+'</div>\n\t\t\t<div class="start-popup">\n\t\t\t\t<div class="start-popup-item" data-value="top">Top<div class="point"></div></div>\n\t\t\t\t<div class="start-popup-item" data-value="center">Center<div class="point"></div></div>\n\t\t\t\t<div class="start-popup-item" data-value="bottom">Bottom<div class="point"></div></div>\n\t\t\t\t<div class="start-popup-caption">Offset</div>\n\n\t\t\t\t<div class="input-wrapper">\n\t\t\t\t\t<input class="numeric-input" spellcheck="false" data-param="start_offset" data-min="-9999" data-max="9999" data-mouseSpeed="1" type="text"/>\n\t\t\t\t\t<div class="units">px</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="start-preview">\n\t\t\t\t\t<div class="start-point"></div>\n\t\t\t\t\t<div class="start-dist"></div>\n\t\t\t\t\t<div class="start-offset"></div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="corner-wrapper"><div class="corner"></div></div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper delay-block">\n\t\t\t<div class="bg"></div>\n\t\t\t<div class="caption">Delay</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<div class="units for-centering">s</div>\n\t\t\t\t<input class="numeric-input" spellcheck="false" data-param="delay" data-min="0" data-max="99" data-useFloat="true" data-shiftStep="1" data-step="0.1" data-mouseSpeed="5" data-labelSelector="<.param-wrapper" type="text"/>\n\t\t\t\t<div class="units">s</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper duration-block">\n\t\t\t<div class="bg"></div>\n\t\t\t<div class="caption">Durat.</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<div class="units for-centering">s</div>\n\t\t\t\t<input class="numeric-input" spellcheck="false" data-param="duration" data-min="0" data-max="99" data-useFloat="true" data-shiftStep="1" data-step="0.1" data-mouseSpeed="5" data-labelSelector="<.param-wrapper" type="text"/>\n\t\t\t\t<div class="units">s</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper delay_px-block">\n\t\t\t<div class="bg"></div>\n\t\t\t<div class="caption">Delay</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<div class="units for-centering">px</div>\n\t\t\t\t<input class="numeric-input" spellcheck="false" data-param="delay_px" data-min="0" data-max="9999" data-mouseSpeed="1" data-labelSelector="<.param-wrapper" type="text"/>\n\t\t\t\t<div class="units">px</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t',0===index&&(__p+='\n\t\t\t<div class="param-wrapper start-condition-block">\n\t\t\t\t<div class="caption">Start when in view</div>\n\t\t\t\t<div class="switcher start-when-in-view-switcher js-start-when-in-view-switcher"></div>\n\t\t\t</div>\n\t\t'),__p+='\n\n\t\t<div class="param-wrapper speed-block">\n\t\t\t<div class="caption">Speed</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<div class="units for-centering">x</div>\n\t\t\t\t<input class="numeric-input" spellcheck="false" data-param="speed"  data-min="0.01" data-floatDigits="2" data-max="999" data-useFloat="true" data-shiftStep="0.1" data-step="0.01" data-mouseSpeed="5" type="text"/>\n\t\t\t\t<div class="units">x</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper move-block">\n\t\t\t<div class="remove-effect" data-value="use_move"></div>\n\t\t\t<div class="caption">Move</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<input class="numeric-input left-align" spellcheck="false" data-param="dx" data-min="-99999" data-max="99999" data-mouseSpeed="5" type="text"/>\n\t\t\t\t<div class="separator move-icon"></div>\n\t\t\t\t<input class="numeric-input right-align" spellcheck="false" data-param="dy" data-min="-99999" data-max="99999" data-mouseSpeed="5" type="text"/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper opacity-block">\n\t\t\t<div class="remove-effect" data-value="use_opacity"></div>\n\t\t\t<div class="caption">Opacity</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<input class="numeric-input left-align" spellcheck="false" data-param="from_opacity" data-min="0" data-max="100"  data-mouseSpeed="5" type="text"/>\n\t\t\t\t<div class="separator from-icon"></div>\n\t\t\t\t<input class="numeric-input right-align" spellcheck="false" data-param="opacity" data-min="0" data-max="100"  data-mouseSpeed="5" type="text"/>\n\t\t\t</div>\n\t\t\t',isSwitcherVisible&&(__p+='\n\t\t\t\t<div class="param-wrapper hide-in-editor-switcher-wrapper">\n\t\t\t\t\t<div class="caption">Hide in Editor</div>\n\t\t\t\t\t<div class="switcher hide-in-editor-switcher js-hide-in-editor-switcher"></div>\n\t\t\t\t</div>\n\t\t\t'),__p+='\n\t\t</div>\n\n\t\t<div class="param-wrapper rotate-block">\n\t\t\t<div class="remove-effect" data-value="use_rotate"></div>\n\t\t\t<div class="caption">Rotate</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<input class="numeric-input left-align" spellcheck="false" data-param="from_rotate" data-min="-9999" data-max="9999"  data-mouseSpeed="5" type="text"/>\n\t\t\t\t<div class="separator from-icon"></div>\n\t\t\t\t<input class="numeric-input right-align" spellcheck="false" data-param="rotate" data-min="-9999" data-max="9999"  data-mouseSpeed="5" type="text"/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper scale-block">\n\t\t\t<div class="remove-effect" data-value="use_scale"></div>\n\t\t\t<div class="caption">Scale</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<input class="numeric-input left-align" spellcheck="false" data-param="from_scale" data-min="0" data-max="9999" data-mouseSpeed="5" type="text"/>\n\t\t\t\t<div class="separator from-icon"></div>\n\t\t\t\t<input class="numeric-input right-align" spellcheck="false" data-param="scale" data-min="0" data-max="9999" data-mouseSpeed="5" type="text"/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper acceleration-block">\n\t\t\t<div class="caption">Acceleration</div>\n\t\t\t<div class="acceleration-value">'+(null==(__t=acceleration)?"":__t)+'</div>\n\t\t\t<div class="acceleration-popup">\n\t\t\t\t<div class="acceleration-popup-preview"><div class="ball"></div></div>\n\t\t\t\t<div class="acceleration-popup-item" data-value="none">None<div class="point"></div></div>\n\t\t\t\t<div class="acceleration-popup-item" data-value="ease-in">Ease In<div class="point"></div></div>\n\t\t\t\t<div class="acceleration-popup-item" data-value="ease-out">Ease Out<div class="point"></div></div>\n\t\t\t\t<div class="acceleration-popup-item" data-value="ease-both">Ease Both<div class="point"></div></div>\n\t\t\t\t<div class="corner-wrapper"><div class="corner"></div></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n';return __p},"template-constructor-control-common_animation-step-popup-item":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="step-popup-item js-step-popup-item '+(null==(__t=isSelected?"selected":"")?"":__t)+'" data-ind="'+(null==(__t=index)?"":__t)+'">'+(null==(__t=text)?"":__t)+"</div>\n";return __p}}},gHxz:function(module,exports){module.exports={"template-common-hotspot-widget":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n    <div class="common-hotspot">\n\n\t    <div class="pin"></div>\n\n    </div>\n\n';return __p},"template-common-hotspot-widget-mobile-wrapper":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n    <div class="hotspot-fullscreen-wrapper invisible">\n        <div class="center-table">\n            <div class="center-cell">\n\n            </div>\n        </div>\n    </div>\n\n';return __p}}},gP9L:function(t,e,i){"use strict";var s=i("xi34"),o=i("amZL"),n={model:{event:"change"},props:{family:{type:[String,Array],default:function(){return[""]}},disabled:{type:Boolean,default:!1},vAlign:{type:String,default:"auto"},hAlign:{type:String,default:"right"},hOffset:{type:Number,default:0}},data:function(){return{visibleBox:!1,boxStyles:{}}},computed:{fontFamily:function(){return"string"==typeof this.family?[this.family]:this.family},exStyle:function(){return this.getFontFamilyStyle()},caption:function(){var t=this,e="";return this.fontFamily.forEach((function(i,s){e+=i,s+1<t.fontFamily.length&&(e+=", ")})),e}},watch:{family:function(t){!t&&this.visibleBox&&(this.visibleBox=!this.visibleBox)}},mounted:function(){if("auto"===this.vAlign){var t=this.$el.getBoundingClientRect(),e="top";t.top>window.innerHeight/2&&(e="bottom"),this.boxStyles[e]=t.height+"px"}this.boxStyles[this.hAlign]=this.hOffset+"px",this.fontselector=new o.a({$parent:Object(s.a)(this.$el.querySelector(".box_container"))}),this.fontselector.on("selectfont",this.fontChanged),this.fontselector.show()},methods:{getFontFamilyStyle:function(){return{"font-family":1===this.fontFamily.length?this.fontFamily[0]:"-apple-system, system-ui, BlinkMacSystemFont, 'Segoe UI', Ubuntu, 'Fira Sans', Roboto, 'Avenir Next', 'Helvetica Neue', Helvetica, Arial, sans-serif"}},fontChanged:function(t){this.$emit("change",t)},toggleVisible:function(){this.disabled||(this.visibleBox||this.$emit("showPopup",this),this.visibleBox=!this.visibleBox)}}},a=(i("HOx4"),i("KHd+")),r=Object(a.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:{"font-family-container":!0,"container-disabled":t.disabled}},[i("span",{staticClass:"example",style:t.exStyle,on:{click:t.toggleVisible}},[t._v(t._s(t.caption))]),t._v(" "),i("div",{staticClass:"expand-arrow",on:{click:t.toggleVisible}}),t._v(" "),i("div",{staticClass:"box_container",class:{visible:t.visibleBox},style:t.boxStyles})])}),[],!1,null,null,null);e.a=r.exports},gdoY:function(t,e,i){"use strict";i("Kf/z");var s=i("xi34"),o=i("q1z7"),n=i.n(o),a=i("rFsW"),r=i("4m+J"),l=i.n(r),c=i("DqjY"),h=i("gobI"),d=i("roQd"),p=i("m41J"),u=i("OTSC"),g=i("tf3M"),m=1,f=n.a.View.extend({template:l.a["template-viewer-widget"],initialize:function(t,e,i){return a.a.bindAll(this),this.model=new g.default(t),this.updateWidgetData(t,e,i),this.destroyed=!1,this.$document=Object(s.a)(document),this._id=this._id||m++,this},render:function(){return this.makeBox("some-widget-class"),this.rendered=!0,this.checkLink(),this},redraw:function(){return this.checkLink(),this},updatePage:function(t){var e=this.page;(!e||t&&e.num!==t.num)&&(this.page=t,this.redraw())},canRenderImmediately:function(){return Boolean(this.DO_NOT_WAIT_FOR_PRELOAD)},widgetIsLoaded:function(){this.loaded||this.destroyed||(this.loaded=!0,this.started&&this.start(),this.trigger("loaded"))},isValid:function(){return!0},hasFontsToLoad:function(){return!1},seamlessFontsShow:function(t,e){this._id;if(c.a.isFastFontLoadCheckAvailable()&&!RM.screenshot&&!this.insideHotspot&&this.hasFontsToLoad()){e();this.makeSureFontsLoaded().then((function(e){window.requestAnimationFrame(t)})).catch((function(e){t()}))}},makeSureFontsLoaded:function(){var t=this.page.getFontsVariations([this],!0),e=[];return a.a.each(t,(function(t){var i=c.a.fastWaitForFontLoad(t.fontFamily,t.fontWeight,t.fontStyle);e.push(i)})),window.Promise.all(e)},hasAnimation:function(){return Boolean(this.getAnimations().find((function(t){return!d.a.isEmpty(t)})))},hasLoadAnimation:function(){return Boolean(this.getAnimations().find((function(t){return"load"===t.type})))},start:function(){return this.started=!0,this},stop:function(){return this.started=!1,this},hide:function(){return this.stop(),this.$el.hide(),this.wasHidden=!0,this.trigger("hidden"),this},show:function(){return this.$el.show(),this.start(),this.wasHidden=!1,this.trigger("shown"),this},destroy:function(){return this.stop(),this.destroyed=!0,this.trigger("destroyed"),delete this.animationObj,this.$el.off(),this.remove()},BringToTopZ:function(){if(this.animationObj){var t=this.animationObj.getAnimationContainer();this.animationObj.resetTimeout&&clearTimeout(this.animationObj.resetTimeout),this.animationObj.savedAnimationContainerZIndex||(this.animationObj.savedAnimationContainerZIndex=t.css("z-index")),t.css("z-index",99999+this.z)}this.$el.css("z-index",99999+this.z)},BackToNormalZ:function(){var t=function(){this.animationObj&&this.animationObj.savedAnimationContainerZIndex&&(this.animationObj.getAnimationContainer().css("z-index",this.animationObj.savedAnimationContainerZIndex||this.z),delete this.animationObj.savedAnimationContainerZIndex);delete this.animationObj.resetTimeout}.bind(this);this.animationObj&&this.animationObj.savedAnimationContainerZIndex&&(this.animationObj.resetTimeout&&clearTimeout(this.animationObj.resetTimeout),this.animationObj.resetTimeout=setTimeout(t,200)),this.$el.css("z-index",this.z)},makeBox:function(t){this.setElement(this.template({id:this._id}));var e=this.fixed_position?this.$fixedContainer:this.$pageContainer;this.animationObj&&(e=this.animationObj.getAnimationContainer()),this.$el.appendTo(e).addClass(t).toggleClass("full-width",!!this.is_full_width).toggleClass("full-height",!!this.is_full_height).toggleClass("inside-hotspot",!!this.insideHotspot),this.applyBoxStyle(),(this.is_full_width||this.is_full_height||this.fixed_position||this.sticked)&&this.listenTo(this.page,"resize",this.onPageResize),this.trigger("rendered")},onPageResize:function(){this.applyBoxStyle()},calcBoxStyle:function(t){t=t||{};var e,i={left:this.x,top:this.y,width:this.w,height:this.h,right:"",bottom:"","margin-left":"","margin-top":"","z-index":this.z||1},o=parseInt(this.full_width_margin,10)||0,n=parseInt(this.full_height_margin,10)||0,r=parseInt(this.sticked_margin,10)||0,l=this.ignoreScale?1:this.page.scale,c=this.page.mag.getContainerSizeCached().width,d=c-Object(s.a)(window).width(),g=this.fixed_position;if(this.angle&&(i.width=Math.round(this.w),i.height=Math.round(this.h),this.angle%90==0&&i.width%2!=i.height%2&&(i.width+=1)),this.is_full_height&&(i.top=-this.page.contentPosition.top+n,g?(i.top=n/l,i.height=Object(s.a)(window).height()/l-2*n,["nw","w","sw"].indexOf(g)>-1&&(g="nw"),["n","c","s"].indexOf(g)>-1&&(g="n"),["ne","e","se"].indexOf(g)>-1&&(g="ne")):i.height=this.page.pageHeight/l-2*n),this.is_full_width&&(i.left=-this.page.contentPosition.left+o,i.width=this.page.mag.getContainerSizeCached().width/l-2*o,e=-((i.width-this.page.$content[0].clientWidth)/2).toFixed(3),h.a.isAllowed()&&this.page.mag.getContainerSizeCached().width>this.mag.viewOpts.scalewidth&&(Modernizr.msie11?(e=-(c-this.page.$content[0].clientWidth)/2-d/2,i.left=e/l):Modernizr.firefox?(i.width=i.width+1,i.left=e-1):i.left=e),g)){if(i.left=o,"horizontal"==this.page.viewerType){var m=this.page.$scrollWrapper,f=m.width()-m[0].clientWidth;i.width-=f/l}["nw","n","ne"].indexOf(g)>-1&&(g="nw"),["w","c","e"].indexOf(g)>-1&&(g="w"),["sw","s","se"].indexOf(g)>-1&&(g="sw")}if(this.sticked){f=0;"horizontal"==this.page.viewerType&&(f=this.page.$scrollWrapper.width()-this.page.$scrollWrapper[0].clientWidth),"left"==this.sticked&&(i.left=-this.page.contentPosition.left/l+r),"right"==this.sticked&&(i.left=this.page.mag.getContainerSizeCached().width/l-r-this.w-this.page.contentPosition.left/l-f/l),"top"==this.sticked&&(i.top=-this.page.contentPosition.top/l+r),"bottom"==this.sticked&&(i.top=this.$pageContainer.height()-r-this.h+this.page.contentPosition.top/l)}if(t.calcBBox){g&&(i.left*=l,i.top*=l,i.width*=l,i.height*=l),i.sinAngle=Math.sin(-(this.angle||0)*Math.PI/180),i.cosAngle=Math.cos(-(this.angle||0)*Math.PI/180);var v=p.a.calcBoundingBox(i,g);return i.width=v.bb_width,i.height=v.bb_height,i.left=v.bb_left,i.top=v.bb_top,g&&a.a.extend(i,u.b.getFixedPositionCSS(g,i,1)),{dimensions:i}}g&&(a.a.extend(i,u.b.getFixedPositionCSS(g,i,h.a.normalize(l,"transform"))),l>=1&&h.a.isAllowed()&&h.a.isZoom()&&(i.zoom=l));var b={rotateX:this.angle&&this.antialiasRotation?"0deg":"",rotateY:this.angle&&this.antialiasRotation?"0deg":"",rotateZ:this.angle?this.angle+"deg":"",scaleX:this.flip_h?-1:1,scaleY:this.flip_v?-1:1};return g&&(b.scaleX*=h.a.normalize(l,"transform"),b.scaleY*=h.a.normalize(l,"transform")),Math.abs(b.scaleX-1)<1e-6&&(b.scaleX=""),Math.abs(b.scaleY-1)<1e-6&&(b.scaleY=""),{dimensions:i,transform:b}},applyBoxStyle:function(){var t=this.calcBoxStyle();this.animationObj&&(t=this.animationObj.modifyWidgetPosition(t)),this.$el.css(t.dimensions);var e=a.a.map(t.transform,(function(t,e){return t?e+"("+t+")":""})).join(" ");u.b.applyTransform(this.$el,s.a.trim(e))},calcDistsToPageVisibleBounds:function(){var t,e=this.page.mag.getContainerSizeCached(),i=h.a.isOn(this.page.scale)&&h.a.isZoom()?h.a.getBox(this.$el[0],this.page.scale):this.$el[0].getBoundingClientRect(),s=this.page.mag.isPreview?this.page.mag.$mag_container[0].getBoundingClientRect():{top:0,left:0},o=(i.top+i.height/2-s.top)/this.page.scale,n=(e.height-(i.top+i.height/2-s.top))/this.page.scale,a=(i.left+i.width/2-s.left)/this.page.scale,r=(e.width-(i.left+i.width/2-s.left))/this.page.scale;if(this.fixed_position){var l=this.page.$el[0].getBoundingClientRect(),c=(i.top+i.height/2-l.top)/this.page.scale,d=(l.height-(i.top+i.height/2-l.top))/this.page.scale;t={left:Math.max(0,a),right:Math.max(0,r),top:Math.max(0,Math.min(o,c)),bottom:Math.max(0,Math.min(n,d))}}else{var p=this.page.contentPosition.left/this.page.scale,u=this.page.contentPosition.top/this.page.scale,g=this.x+this.w/2,m=this.y+this.h/2;c=m+u,d=this.page.contentHeight-m+u;t={left:Math.max(0,g+p),right:Math.max(0,this.page.pageWidth-g+p),top:Math.max(0,Math.min(o,c)),bottom:Math.max(0,Math.min(n,d))}}return t},checkLink:function(){var t={};if(this.clickLink){this.clickLink=this.page.mag.matchSameDomainLink(this.clickLink);var e=/^http(s?)\:\/\//i.test(this.clickLink)||/^mailto\:/i.test(this.clickLink)||/^tel\:/i.test(this.clickLink),i=/^__rm_goback$/i.test(this.clickLink),o=this.mailchimpMatcher.test(this.clickLink),n=this.anchorRegexp.test(this.clickLink),r=this.shareRegexp.test(this.clickLink),l=this.clickLink,c=this.clickTarget||"_blank",h=e?"external-link":i?"goback-link":"maglink";if(o&&(h="mailchimp-link"),n&&(h="anchor-link"),r&&(h="share-link"),!e){var d=l;/^back\sto\stop$/i.test(l)&&(d=this.page._id);var p=this.page.mag.getPageNum(d);l=p&&this.page.mag.getPageUri?"/"+this.page.mag.getPageUri(d):"javascript:void(0)";p?c="":l="",d==this.page._id&&(h+=" back-to-top",this.is_global&&(h+=" current"))}if(i&&(l="javascript:void(0)"),o){l="javascript:void(0)";var u=this.clickLink.match(this.mailchimpMatcher)[1];t["data-mailchimp"]=u}if(n){l="javascript:void(0)",t["data-anchor-link-pos"]=this.anchor_link_pos;var g=a.a.findWhere(this.mag.pages,{_id:this.clickPage})||this.page;t["data-page-uri"]=g.uri||g.num}if(r){l="javascript:void(0)";var m=this.clickLink.match(this.shareRegexp);t["data-share-provider"]=m[1],t["data-share-type"]=m[2]}if(0!=l.indexOf("mailto")&&0!=l.indexOf("tel")&&"maglink"!=h||(c=""),l){a.a.extend(t,{class:h,href:l,target:c});var f=this.$el.parent("a");f.length?f.attr(t):(f=Object(s.a)("<a>").attr(t),this.$el.wrap(f)),!e&&RM.screenshot&&(f=this.$el.parent("a")).removeAttr("href")}}},updateWidgetData:function(t,e,i){a.a.extend(this,t,t.params),this.page=e,this.mag=this.page.mag,this.$pageContainer=i||this.page.$content,this.x=this.x||0,this.y=this.y||0},getAnimations:function(){return d.a.normalizeAnimations(this.animation)},getAnimationTriggers:function(t){var e=this.getAnimations().find((function(e){return e.UUID===t}));return d.a.normalizeAnimationTriggers(e&&e.trigger)}}),v=i("zzMN"),b=f.extend({render:function(){var t=this,e=!1;if(RM.screenshot)window.ServerData.userPermissions&&window.ServerData.userPermissions.can_use_e_commerce&&(e=!0);else{var i=RM.viewerRouter?RM.viewerRouter.getUserPermissions():RM.constructorRouter.me.get("permissions");i&&i.can_use_e_commerce&&(e=!0)}if(e)return this.makeBox("widget-add-to-cart"),this.seamlessFontsShow(function(){this.$el.removeClass("fonts-pending")}.bind(this),function(){this.$el.addClass("fonts-pending")}.bind(this)),this.addToCartWidget=new v.a({data:this,environment:"viewer",$container:this.$el,eCommerceManager:this.mag.eCommerceManager}),RM.screenshot?(this.addToCartWidget.on("loaded",(function(){t.widgetIsLoaded()})),setTimeout((function(){t.widgetIsLoaded()}),1e4)):this.widgetIsLoaded(),this.addToCartWidget.render(),this.rendered=!0,this},destroy:function(){return this.addToCartWidget&&this.addToCartWidget.destroy(),this.addToCartWidget=null,f.prototype.destroy.apply(this,arguments)}}),_=i("hdsW"),w=i("QNiq"),y=f.extend({render:function(){return this.makeBox("audio"),this.player=new _.a(this,this.$el,this.widgetIsLoaded),this.player.show(),this.rendered=!0,this},isValid:function(){return this.parsed_url},start:function(){return this.started=!0,!RM.screenshot&&!this.destroyed&&this.player&&this.autoplay&&this.rendered&&this.loaded&&w.a.isDesktop&&!u.b.PageVisibilityManager.isPageHidden()&&this.player.play(),this},stop:function(){return this.started=!1,!RM.screenshot&&!this.destroyed&&this.player&&this.rendered&&this.loaded&&this.player.pause(),this},destroy:function(){return this.player&&this.player.destroy(),this.player=null,f.prototype.destroy.apply(this,arguments)}}),k=i("WoDZ"),C=i("Zuws"),x=i.n(C),S=i("0zSa"),P=i("PhV8"),$=i("Vxjr"),O=function(t,e){this.playerIsReady=!1,this.queue=[],function(t,e){var i=a.a.bind(t,e);if(window.youTubeApiIsReady)return i();window.ytQueue.push({cb:i,context:e})}((function(){this.yt=new window.YT.Player(t.id,{events:{onReady:a.a.bind((function(){this.destroyed||(this.playerIsReady=!0,a.a.each(this.queue,(function(t){a.a.isFunction(t.cb)&&t.cb()})))}),this)}})}),this),this.start_time=e&&e.start_time};O.prototype={addToQueue:function(t,e){var i=a.a.bind(t,e);if(this.playerIsReady)return i();this.queue.push({cb:i,context:e})},on:function(t,e,i){var s=a.a.bind(e,i||window),o={finish:0,play:1,pause:2};"ready"!==t?this.addToQueue((function(){this.yt.addEventListener("onStateChange",(function(e){o[t]===Number(e.data)&&s()}))}),this):this.addToQueue(s,this)},mute:function(){this.addToQueue((function(){this.yt.mute()}),this)},unMute:function(){this.addToQueue((function(){this.yt.unMute()}),this)},pause:function(){this.addToQueue((function(){this.yt&&this.yt.pauseVideo&&this.yt.pauseVideo()}),this)},play:function(){this.addToQueue((function(){this.yt.playVideo()}),this)},rewind:function(t){this.addToQueue((function(){this.yt.seekTo(t||0)}),this)},loop:function(){this.rewind(this.start_time||.01)},getDuration:function(){return this.duration||(this.duration=this.yt.getDuration()),this.duration},getCurrentTime:function(){return this.yt.getCurrentTime&&this.yt.getCurrentTime()||0},checkLoop:function(){if(this.getDuration()-this.yt.getCurrentTime()<.5)return this.loop(),!0},destroy:function(){window.ytQueue=a.a.reject(window.ytQueue,(function(t){return t.context===this})),delete this.yt,delete this.queue,this.destroyed=!0}};var T=function(t,e){a.a.bindAll(this),this.id=t.id,this.start_time=e&&e.start_time};T.prototype={on:function(t,e){Object(P.a)(this.id).addEvent(t,e)},mute:function(){Object(P.a)(this.id).api("setVolume",0)},unMute:function(){return!1},pause:function(){Object(P.a)(this.id).api("pause")},play:function(){Object(P.a)(this.id).api("play")},rewind:function(t){Object(P.a)(this.id).api("seekTo",t||0)},loop:function(){this.start_time&&this.rewind(this.start_time)},getCurrentTime:function(t){Object(P.a)(this.id).api("getCurrentTime",t)},setColor:function(t){Object(P.a)(this.id).api("setColor",t)},destroy:function(){var t=Object(P.a)(this.id);t&&(t.removeEvent("ready"),t.removeEvent("play"),t.removeEvent("finish"),t.removeEvent("pause"))}};var M={Vimeo:a.a.template('<iframe src="https://player.vimeo.com/video/<%=video_id%>?wmode=opaque&api=1&loop=<%=(loop)?1:0%>&muted=<%=(mute)?1:0%>&player_id=video_<%=id%><%=(!real)?"_c":""%>&title=<%=info?1:0%>&byline=<%=info?1:0%>&portrait=<%=info?1:0%>&color=<%=color%>" id="video_<%=id%><%=(!real)?"_c":""%>" width="<%=w%>" height="<%=h%>" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen allow="autoplay; fullscreen; encrypted-media"></iframe>'),YouTube:a.a.template('<iframe <% if (real) {%>id="yt_<%=video_id%>"<%}%> src="https://www.youtube.com/embed/<%=video_id%>?&wmode=opaque&enablejsapi=1&playlist=&autohide=1&loop=<%=(loop)?1:0%>&showinfo=<%=info?1:0%>&theme=<%=theme%>&controls=<%=controls? 1: 0%><%=html5 ? "&html5=1" : ""%>&rel=0&vq=hd1080&playsinline=<%=(autoplay)?1:0%>" width="<%=w%>" height="<%=h%>" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen allow="autoplay; fullscreen; encrypted-media"></iframe>')},j=f.extend({RESTART_TIMEOUT:5e3,initialize:function(t,e,i){return f.prototype.initialize.apply(this,arguments),this.$container=i,delete this.real,this},render:function(){return this.$container?this.setElement(this.$container):this.makeBox("video"),this.rendered=!0,this.setPosterInsteadOfVideo(),this},isValid:function(){return this.video_id&&this.provider_name},_needAutoStart:function(){return this.autoplay&&!u.b.PageVisibilityManager.isPageHidden()},start:function(){return this.started=!0,this.onPlayFired=!1,RM.screenshot||!this.rendered||this.destroyed?this:(this.playerInitialized||(this.$el.append(this.getEmbed()),this.$iframe=this.$el.find("iframe"),this.$iframe.attr("id","video_"+this.id),this.player=this.createPlayer(this.provider_name,this.$iframe,{start_time:this.start_time,autoplay:this._needAutoStart()}),this.player&&this.player.on("ready",this.onPlayerReady),this.playerInitialized=!0),this.player&&this._needAutoStart()&&this.player.play(),this)},stop:function(){return this.started=!1,clearInterval(this.loopInterval),!RM.screenshot&&!this.destroyed&&this.player&&this.rendered&&("youtube"===this.provider_name.toLowerCase()?(this._needAutoStart()&&this.player.pause(),!this._needAutoStart()&&this.onPlayFired&&this.player.pause()):this.player.pause()),this},destroy:function(){return clearInterval(this.loopInterval),this.player&&this.player.destroy(),this.player=null,f.prototype.destroy.apply(this,arguments)},setPosterInsteadOfVideo:function(){this.custom_thumbnail||this.thumbnail_url?this.custom_thumbnail&&this.custom_thumbnail_url?this.setCustomPosterInsteadOfVideo():this.setEmbeddedPosterInsteadOfVideo():this.widgetIsLoaded()},setEmbeddedPosterInsteadOfVideo:function(){this.$poster&&this.$poster.remove(),this.$poster&&this.$poster.off(),this.$poster=Object(s.a)("<img/>").addClass("poster").css("opacity",0).appendTo(this.$el),this.$poster.on("load",a.a.bind((function(){this.$poster.css({width:"",height:""}).css("opacity",1);var t=this.$poster[0].width,e=this.$poster[0].height;this.aspect_poster||(this.aspect_poster=t/e),k.a.setVideoPosition({mag:this.page.mag,$container:this.$el,$media:this.$poster,provider:this.provider_name,aspect_poster:this.aspect_poster,aspect_real:this.aspect_real,controls_remove:!!this.$container}),setTimeout(this.widgetIsLoaded,100)}),this)).on("error",a.a.bind((function(){this.oldUrl=this.thumbnail_url,this.thumbnail_url=this.thumbnail_url.replace("https://","http://"),this.oldUrl!==this.thumbnail_url?this.setEmbeddedPosterInsteadOfVideo():this.widgetIsLoaded()}),this)).attr("src",this.thumbnail_url)},setCustomPosterInsteadOfVideo:function(){this.$poster&&this.$poster.remove(),this.$poster&&this.$poster.off(),this.$poster=this.getCustomVideoPoster(this),this.$poster.css("cursor","pointer"),this.$poster.on("click",a.a.bind((function(){this.onPosterClicked()}),this)),this.$poster.appendTo(this.$el),setTimeout(this.widgetIsLoaded,100)},getCustomVideoPoster:function(t){var e=Object($.b)("./common/video-player/play.svg"),i=Object(s.a)("<div/>").addClass("poster poster-custom");return i.css({width:t.w,height:t.h}),i.css("background-image","url("+e+"), url("+t.custom_thumbnail_url+")"),i},onPosterClicked:function(){this.player.play(),a.a.delay(a.a.bind((function(){this.$poster&&(this.$poster.off(),this.$poster.remove())}),this),200)},createPlayer:function(t,e,i){return"vimeo"===t.toLowerCase()?new T(e[0],i):"youtube"===t.toLowerCase()?new O(e[0],i):null},getEmbed:function(t){if(t=t||this,a.a.defaults(t,{real:!0,w:640,h:320,theme:"dark",color:"3ab9ff",info:!1,controls:!0,id:a.a.uniqueId("video_"),origin:encodeURIComponent(window.location.protocol+"//"+window.location.hostname)}),Modernizr.safari&&(t.html5=!0),!t.video_id)return null;var e=M[t.provider_name](t);if(!t.real&&t.custom_thumbnail&&t.custom_thumbnail_url){var i=Object(s.a)(e).css("visibility","hidden");return this.getCustomVideoPoster(t).add(i)}return M[t.provider_name](t)},onPlayerReady:function(){!this.destroyed&&this.player&&(this.$container&&(this.mute=!0),this.mute?this.player.mute():this.player.unMute(),this.$container||(this.$iframe&&this.$iframe.addClass("fade-out"),this.custom_thumbnail&&this.custom_thumbnail_url||(a.a.delay(a.a.bind((function(){this.$poster&&this.$poster.css("opacity",0)}),this),125),a.a.delay(a.a.bind((function(){this.$poster&&(this.$poster.off(),this.$poster.remove())}),this),250))),this.player.on("pause",this.onPause),this.player.on("play",this.onPlay),this.start_time&&(this.player.rewind(this.start_time),this.player.pause()),w.a.isDesktop&&"vimeo"===this.provider_name.toLowerCase()&&this.player.on("playProgress",this.onProgress),this.started&&this._needAutoStart()&&this.player.play(),this.player.setColor&&this.player.setColor(this.color))},onPlay:function(){!this.$container&&RM.analytics&&RM.analytics.sendEvent("Video Play",this.title+" / "+this.url),this.$iframe&&!this.$iframe.hasClass("fade-out")&&(this.$iframe.addClass("fade-out"),this.trigger("playStarted")),clearInterval(this.loopInterval),this.loop&&this.player.checkLoop&&(this.loopInterval=setInterval(a.a.bind((function(){this.player.checkLoop()&&(clearInterval(this.loopInterval),Modernizr.safari&&a.a.delay(function(){this.onPlay()}.bind(this),200))}),this),100)),this.onPlayFired=!0},onPause:function(){if("Vimeo"===this.provider_name)this.player.getCurrentTime(a.a.bind((function(t){t=Math.round(t),!this.$container&&RM.analytics&&RM.analytics.sendEvent("Video Pause",this.title+" / "+this.url+" / "+t+" sec.",t)}),this));else if("YouTube"===this.provider_name){var t=Math.round(this.player.getCurrentTime());!this.$container&&RM.analytics&&RM.analytics.sendEvent("Video Pause",this.title+" / "+this.url+" / "+t+" sec.",t)}},onProgress:function(t){this.onPlayFired||this.onPlay(),1===t.percent&&this.loop&&this.player.loop&&this.player.loop(),0===parseFloat(t.seconds)?this.restartTimeout||(this.restartTimeout=setTimeout(a.a.bind((function(){clearInterval(this.loopInterval),this.playerInitialized=!1,this.player&&this.player.destroy(),this.player=null,this.$iframe&&this.$iframe.remove(),!this.destroyed&&this.started&&this.start(),delete this.restartTimeout}),this),this.RESTART_TIMEOUT)):(clearTimeout(this.restartTimeout),delete this.restartTimeout)},updateVideoFrameSize:function(t,e){this.$iframe&&this.$iframe.attr("width",t).attr("height",e),this.$poster&&this.$poster.css({width:t,height:e})}}),I=f.extend({render:function(){return this.rendered=!0,this.page.on("resize",this.onResize,this),this.template=x.a["template-viewer-widget-background"],this.setElement(this.template({data:this})),this.$el.prependTo(this.page.$fixedBgContainer),this.$picture=this.$(".picture-background"),this.$video=this.$(".video-background"),this.$videoContainer=this.$(".video-container"),this.$slideshow=this.$(".slideshow-container"),this.$slideshowPreload=this.$(".slideshow-preload"),this.picture&&"picture"===this.selectedType?this.renderPicture():a.a.isEmpty(this.video)||"video"!==this.selectedType?this.slideshow&&"slideshow"===this.selectedType?this.renderSlideshow():this.widgetIsLoaded():this.renderVideo(),this},start:function(){return this.started=!0,"video"===this.selectedType&&!RM.screenshot&&this.rendered&&this.videoWidget&&!this.destroyed&&(this.videoWidget.start(),this.onResize()),"slideshow"!==this.selectedType||RM.screenshot||!this.rendered||this.destroyed||!this.slideshowWidget||this.slideshowWidget.isAnimationRunning||this.slideshowWidget.startAnimationLoop(),this},stop:function(){return this.started=!1,"video"===this.selectedType&&!RM.screenshot&&this.rendered&&this.videoWidget&&!this.destroyed&&this.videoWidget.stop(),"slideshow"===this.selectedType&&!RM.screenshot&&this.rendered&&!this.destroyed&&this.slideshowWidget&&this.slideshowWidget.isAnimationRunning&&this.slideshowWidget.stopAnimationLoop(),this},destroy:function(){return this.page.off("resize",this.onResize,this),"video"===this.selectedType&&(this.videoWidget&&this.videoWidget.destroy(),this.videoWidget=null),"slideshow"===this.selectedType&&(this.slideshowWidget&&this.slideshowWidget.destroy(),this.slideshowWidget=null),f.prototype.destroy.apply(this,arguments)},hasVideoBG:function(){return!(RM.screenshot||"video"!==this.selectedType||!this.video||!this.video.url)},onResize:function(){!this.destroyed&&this.$videoContainer&&this.video&&k.a.setVideoPosition({mag:this.page.mag,$container:this.$videoContainer,$media:this.$videoContainer.children(),provider:this.video.provider_name,aspect_poster:this.video.aspect_poster||this.videoWidget&&this.videoWidget.aspect_poster,aspect_real:this.video.aspect_real,controls_remove:!0})},renderPicture:function(){if(this.picture){var t=this.picture.finalUrl||this.picture.effectUrl||this.picture.unscaledOptimizedUrl||this.picture.url;Object(s.a)("<img/>").on("load",a.a.bind((function(){this.$picture.css({"background-image":"url("+t+")"}),RM.screenshot?setTimeout(this.widgetIsLoaded,200):this.widgetIsLoaded()}),this)).on("error",this.widgetIsLoaded).attr("src",t)}else this.widgetIsLoaded()},renderSlideshow:function(){this.slideshowWidget=new S.a({data:this.slideshow,container:this.$slideshow,preloadContainer:this.$slideshowPreload,name:this.page.cid}),RM.screenshot?(this.slideshowWidget.render(),this.slideshowWidget.on("loaded",function(){this.widgetIsLoaded()}.bind(this))):(this.slideshowWidget.render(!this.page.isCurrent()),this.widgetIsLoaded())},renderVideo:function(){this.video.id=this.id,this.video.mute=this.mute,this.video.loop=this.loop,this.video.controls=!1,this.videoWidget=new j(this.video,this.page,this.$videoContainer),this.videoWidget.on("loaded",a.a.bind((function(){this.widgetIsLoaded(),this.onResize()}),this)),this.videoWidget.on("playStarted",a.a.bind((function(){this.trigger("videoBGStarted")}),this)),this.videoWidget.render()}}),E=i("lRGI");function A(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function R(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var D=f.extend({DO_NOT_WAIT_FOR_PRELOAD:!0,antialiasRotation:!0,mailchimpMatcher:/__rm_mailchimp_(.+)/i,anchorRegexp:/__rm_anchor/i,shareRegexp:/^share\.(facebook|twitter|pinterest|gplus|linkedin|email)\.(mag|page)$/i,render:function(){var t;return this.preloadIconImage({default:!0}),this.makeBox("widget-button"),this.hasHoverAnimation&&this.$el.addClass("has-onhover-animation"),this.rendered=!0,this.seamlessFontsShow(function(){this.$el.removeClass("fonts-pending")}.bind(this),function(){this.$el.addClass("fonts-pending")}.bind(this)),t={model:this,$container:this.$el,environment:"viewer",mag:this.page&&this.page.mag,block:null},this.buttonWidget=new E.a(t),this.preloadIconImage({hover:!0}),this.$el.on(w.a.isDesktop?"mouseenter":"touchstart",this.onButtonHover),this.$el.on(w.a.isDesktop?"mouseleave":"touchend",this.onButtonHoverOut),this.$el.on("click",this.onButtonClick),this.checkLink(),RM.screenshot?(this.waitForIconImageLoad(),this.waitForUsedFontsLoad()):this.widgetIsLoaded(),this},renderButtonText:function(t){this.buttonWidget.renderButtonText(t)},renderButtonTextWithSizes:function(t,e){this.buttonWidget.renderButtonTextWithSizes(t,function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?A(i,!0).forEach((function(e){R(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):A(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},this,{},e))},hasFontsToLoad:function(){return"text"===this.tp||"text_and_icon"===this.tp},onButtonHover:function(){this.$(".common-button").addClass("hovered")},onButtonHoverOut:function(){this.$(".common-button").removeClass("hovered")},onButtonClick:function(t){if(2!==t.which&&!t.metaKey&&!t.ctrlKey){var e=this.$el.closest("a"),i=s.a.trim(e.attr("href")).match(/\/start-with-template\/(\d+)$/i),o=i&&i[1];o&&RM.viewerRouter&&RM.viewerRouter.createMagFromTemplate&&(t.preventDefault(),RM.viewerRouter.createMagFromTemplate("template-link",o))}},preloadIconImage:function(t){t=t||{};var e=this.tp;if("icon"===e||"text_and_icon"===e){if(t.default)(new Image).src=Modernizr.retina&&this.icon_raster2xUrl||this.icon_rasterUrl;if(t.hover)(new Image).src=Modernizr.retina&&this["hover-icon_raster2xUrl"]||this["hover-icon_rasterUrl"]}},_widgetIsLoaded:function(){this.loaded||this.destroyed||(RM.screenshot?this.iconImageLoaded&&this.fontLoaded&&this.widgetIsLoaded():this.widgetIsLoaded())},waitForIconImageLoad:function(){this.iconImageLoaded=!1,"icon"!==this.tp&&"text_and_icon"!==this.tp||!this.icon_rasterUrl?this.onIconImageLoaded():Object(s.a)("<img>").on("load",this.onIconImageLoaded).on("error",this.onIconImageLoaded).attr("src",Modernizr.retina?this.icon_raster2xUrl||this.icon_rasterUrl||"":this.icon_rasterUrl||"")},onIconImageLoaded:function(){this.iconImageLoaded=!0,this._widgetIsLoaded()},waitForUsedFontsLoad:function(){this.fontLoaded=!1,this.hasFontsToLoad()?this.page.addFontsToLoad(this,this.onFontLoaded):this.onFontLoaded()},onFontLoaded:function(){this.fontLoaded=!0,this._widgetIsLoaded()},destroy:function(){return this.buttonWidget&&this.buttonWidget.destroy(),this.buttonWidget=null,this.$el.off(w.a.isDesktop?"mouseenter":"touchstart",this.onButtonHover),this.$el.off(w.a.isDesktop?"mouseleave":"touchend",this.onButtonHoverOut),this.$el.off("click",this.onButtonClick),f.prototype.destroy.apply(this,arguments)}}),z=i("A0Lk"),L=i.n(z),B=D.extend({initialize:function(){D.prototype.initialize.apply(this,arguments),this.is_above&&this.mag.on("destroyed",this.destroy)},render:function(){var t=this,e=!1;if(RM.screenshot)window.ServerData.userPermissions&&window.ServerData.userPermissions.can_use_e_commerce&&(e=!0);else{var i=RM.viewerRouter?RM.viewerRouter.getUserPermissions():RM.constructorRouter.me.get("permissions");i&&i.can_use_e_commerce&&(e=!0)}if(e){if(D.prototype.render.apply(this,arguments),!RM.screenshot){this.mag.eCommerceManager.events.on("ecommerce:cartdata:changed",this.renderTotalItems);var s=this["font-family"];if(s&&!u.a.systemFontsList.includes(s.toLowerCase())){var o=new L.a(this["font-family"]);o.load().then((function(){t.renderTotalItems(t.mag.eCommerceManager.getCartData())})).catch((function(){t.renderTotalItems(t.mag.eCommerceManager.getCartData())}))}else this.renderTotalItems(this.mag.eCommerceManager.getCartData())}return this}},renderTotalItems:function(t){if(t&&t.skus){var e=0;for(var i in t.skus)t.skus.hasOwnProperty(i)&&(e+=t.skus[i].cart_count);var s=e?"".concat(this.text||""," ").concat(e):this.text||"",o=this.recalcTextInputSize(s);this.renderButtonTextWithSizes(s,o)}},onButtonClick:function(){this.mag.eCommerceManager.changeCartSidebarVisibility()},recalcTextInputSize:function(t){var e,i,o,n,a=this["font-size"],r=this["letter-spacing"],l=this["font-family"],c=this["font-style"],h=this["font-weight"];return this.$textInputSizeAdjuster||(this.$textInputSizeAdjuster=Object(s.a)("<div/>"),this.$textInputSizeAdjuster.css({position:"absolute",left:"-9999px",top:"-9999px","white-space":"pre",width:"auto"}),Object(s.a)(document.getElementById("tmp")).append(this.$textInputSizeAdjuster)),this.$textInputSizeAdjuster.addClass("for-text-size-calc").addClass(u.b.generateUUID()),this.$textInputSizeAdjuster.text(t.trim()),this.$textInputSizeAdjuster.css({"font-family":l,"font-style":c,"font-weight":h,"font-size":a+"px","letter-spacing":r+"px"}),e=this.$textInputSizeAdjuster.width(),i=this.$textInputSizeAdjuster.height(),this.$textInputSizeAdjuster.css("letter-spacing",0).text("M"),o=this.$textInputSizeAdjuster.width(),o=2*Math.ceil(o/2),n=this.$textInputSizeAdjuster.height(),0===t.length&&(e=o,i=n),e=2*Math.ceil(e/2),{text_w:e+=o,text_h:i=2*Math.ceil(i/2)}},destroy:function(){return this.mag.eCommerceManager.events.off("ecommerce:cartdata:changed",this.renderTotalItems),this.$textInputSizeAdjuster&&(this.$textInputSizeAdjuster.remove(),this.$textInputSizeAdjuster=null),D.prototype.destroy.apply(this,arguments)}}),F=i("3eHG"),H=i("wxrA"),N=i.n(H),V=f.extend({DO_NOT_WAIT_FOR_PRELOAD:!0,initialize:function(){return f.prototype.initialize.apply(this,arguments),"type_like_box"===this.current_type&&(this.current_type="type_page",this.type_page=this.type_like_box),this},render:function(){return this.makeBox("widget-facebook"),this.rendered=!0,this.started?this.start():!RM.screenshot&&this.widgetIsLoaded(),this},start:function(){if(this.started=!0,this.destroyed||!this.rendered||this.innerRendered)return this;this.innerRendered=!0;var t,e,i=this;return this.current_type?((e=this[this.current_type]).w=this.w,e.h=this.h,"mag"===e.use_own_url?e.url=this.page.mag.getUrl():"page"!==e.use_own_url&&e.url||(e.url=this.page.getUrl()),t=N.a["template-constructor-block-facebook-"+this.current_type],this.$el.html(t({data:e})).removeClass(["type_like_button","type_page","type_comments"].join(" ")).addClass(this.current_type),"type_comments"===this.current_type?this.$el.css({"overflow-x":"hidden","overflow-y":"auto"}):"type_like_button"!==this.current_type&&this.$el.css({overflow:"hidden"}),F.a.initFacebookAPI((function(){!i.destroyed&&i.innerRendered&&window.FB.XFBML.parse(i.$el.get(0),(function(){a.a.delay((function(){!i.destroyed&&i.innerRendered&&(i.widgetIsLoaded(),"type_like_button"===i.current_type&&(i.iframe_w=i.$("iframe").width(),i.iframe_h=i.$("iframe").height()))}),500)}))})),this):(this.widgetIsLoaded(),this)},stop:function(){return this.started=!1,this}}),U=i("gm8A"),W=f.extend({DO_NOT_WAIT_FOR_PRELOAD:!0,NUMBER_TEST_REGEX:/^[0-9.,`']+$/,events:{"focus :input":"onFocus","blur :input":"onBlur"},render:function(){return this.makeBox("widget-form"),this.rendered=!0,this.seamlessFontsShow(function(){this.$el.removeClass("fonts-pending")}.bind(this),function(){this.$el.addClass("fonts-pending")}.bind(this)),this.formWidget=new U.a({data:this,environment:"viewer",$container:this.$el}),this.formWidget.render(),this.$button=this.$(".button"),this.$button.on("click",this.onButtonClick),this.$(".js-input").on("keydown",this.onInputKeyDown),this.$(".js-input").on("input",this.onInput),this.$("select").on("change",this.onInput),RM.screenshot?this.waitForUsedFontsLoad():this.widgetIsLoaded(),this},hasFontsToLoad:function(){return!0},destroy:function(){return this.formWidget&&this.formWidget.destroy(),this.formWidget=null,this.$(".button").off("click",this.onButtonClick),f.prototype.destroy.apply(this,arguments)},waitForUsedFontsLoad:function(){this.hasFontsToLoad()?this.page.addFontsToLoad(this,this.widgetIsLoaded):this.widgetIsLoaded()},onFocus:function(){Backbone.trigger("form:focus",this._id)},onBlur:function(){Backbone.trigger("form:blur",this._id)},onButtonClick:function(){this.$button.hasClass("submitted")||this.validateForm()&&(this.setButtonState("submitted"),"Text after submit"===this.button_caption_after_submit||!this.button_caption_after_submit||this.submit_mode&&"textAfterSubmit"!==this.submit_mode?this.$button.addClass("empty-submitted-text"):this.$button.find(".caption").text(this.button_caption_after_submit),RM.common.isDownloadedSource?this.submitToIframe((function(t){t&&(this.setButtonState("error"),RM.analytics&&RM.analytics.sendEvent("Form Submit Error",t))})):this.submitForm(function(t){t&&(this.setButtonState("error"),t.responseJSON&&"email_not_confirmed"===t.responseJSON.name&&a.a.delay((function(){alert(t.responseJSON.message)}),100),RM.analytics&&RM.analytics.sendEvent("Form Submit Error",t))}.bind(this)),this.link_after_submit&&this.submit_mode&&"textAfterSubmit"!==this.submit_mode&&this.applyLink())},applyLink:function(){var t;"toUrlAfterSubmit"===this.submit_mode?this.openInNewTab(this.link_after_submit):(t=this.page.mag.getPageUri?"/"+this.page.mag.getPageUri(this.link_after_submit):"javascript:void(0)",this.mag.router.navigate(t,{trigger:!0}))},openInNewTab:function(t){Object.assign(document.createElement("a"),{target:"_blank",rel:"noopener",href:t}).click()},getDataBySort:function(t){return t=parseInt(t,10),a.a.findWhere(this.fields,{sort:t})},validateForm:function(){var t=this.$(".js-input"),e=!0;return a.a.each(t,function(t){var i=Object(s.a)(t),o=i.val().trim(),n=this.getDataBySort(i.attr("data-sort")),a=!0;if(o)switch(n.tp){case"name":case"text":case"dropdown":break;case"email":u.b.isValidEmail(o)||(a=!1);break;case"phone":/^[0123456789 +-]+$/.test(o)||(a=!1);break;case"number":this.NUMBER_TEST_REGEX.test(o)&&!isNaN(parseFloat(o))||(a=!1);break;case"checkbox":n.optional||i.prop("checked")||(a=!1)}else a=n.optional;a||(this.formWidget.applyInputsStyle(i.closest(".input-wrapper"),{invalid:!0}),e=!1)}.bind(this)),e},onInput:function(t){var e=Object(s.a)(t.currentTarget).parent().find(".js-input");this.formWidget.applyInputsStyle(e.closest(".input-wrapper")),this.setButtonState()},onInputKeyDown:function(t){t.keyCode!==s.a.keycodes.enter||Object(s.a)(t.target).is("textarea")||this.onButtonClick(),!Object(s.a)(t.target).is("textarea")||t.keyCode!==s.a.keycodes.up&&t.keyCode!==s.a.keycodes.down||t.stopPropagation()},getFormData:function(){var t={wid:this._id,mag_num_id:this.page.mag.num_id,is_preview:!(!RM.constructorRouter||!RM.constructorRouter.preview),fields:[]};return a.a.each(this.fields,function(e){var i=this.$(".js-input[data-sort="+e.sort+"]"),s=i.val().trim();if("checkbox"===e.tp&&(s=i.prop("checked")?"On":"Off"),"number"===e.tp){var o=parseFloat(s);s=isNaN(o)?s:o}t.fields.push({caption:e.caption,type:e.tp,value:s})}.bind(this)),t},submitForm:function(t){this.xhr&&this.xhr.abort(),this.xhr=s.a.ajax({dataType:"json",contentType:"application/json",url:"/api/connect/forms/submit",data:JSON.stringify(this.getFormData()),method:"POST",success:function(){t()},error:function(e){t({status:e.status,responseJSON:e.responseJSON,responseText:e.responseText})}}),RM.analytics&&RM.analytics.sendEvent("Form Submit Click")},submitToIframe:function(t){var e,i=this.endpoint_url&&this.endpoint_url.custom_url;if(!i)return t("No custom URL specified for submit");Object(s.a)("#form_submit_iframe").length||Object(s.a)('<iframe id="form_submit_iframe" name="form_submit_iframe" style="display:none;"></iframe>').appendTo("body"),(e=this.$el.find("form")).length||(e=this.$el.find(".form-wrapper").wrap('<form method="post" target="form_submit_iframe"></form>').parent().attr("action",i)),e.get(0).submit(),t(null),RM.analytics&&RM.analytics.sendEvent("Form Submit Click")},setButtonState:function(t){t=t||"";this.$button.removeClass(["error","submitted"].join(" ")).addClass(t)}}),G=i("udqo"),q=i("i7aS");function X(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function K(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?X(i,!0).forEach((function(e){Y(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):X(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Y(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var Z=f.extend({antialiasRotation:!0,mailchimpMatcher:/__rm_mailchimp_(.+)/i,anchorRegexp:/__rm_anchor/i,shareRegexp:/^share\.(facebook|twitter|pinterest|gplus|linkedin|email)\.(mag|page)$/i,render:function(){this.makeBox("widget-picture"),this.canShowPreview()&&this.initPreview(),this.hasHoverAnimation&&this.$el.addClass("has-onhover-animation"),this.rendered=!0,this.$lqipImg=null,this.useLqip=q.a.flagLQIP()&&this.mag&&this.mag.opts&&this.mag.opts.lqip;var t=this.getPictureUrl();if(/\.gif/.test(t)&&(this.isGIF=!0),this.$el.html(""),0!==a.a.last(t.split(".")).indexOf("svg")||u.a.IS_FILE_PROTOCOL){var e=!!(this.border_size>0||this.border_radius>0||this.border_radius_max||this.is_full_width||this.is_full_height),i=void 0===this.opacity?1:this.opacity;if(this.insideHotspot&&this.isGIF){var o=this.scale;Object(s.a)("<div/>").appendTo(this.$el).css({position:"absolute","background-image":"url("+t+")","background-position":"50% 50%",width:Math.max(Math.round(this.originalW*o),this.w),height:Math.max(Math.round(this.originalH*o),this.h),top:-Math.round(this.cropY*o),left:-Math.round(this.cropX*o)}).attr("url",t)}else e&&Object(s.a)("<div/>").appendTo(this.$el).addClass("bgpic").css({"background-image":this.useLqip?"":"url(".concat(t,")"),"background-position":(this.fhpos?this.fhpos:50)+"% "+(this.fwpos?this.fwpos:50)+"%","box-shadow":this.border_size>0?"inset 0 0 0 "+this.border_size+"px #"+(this.border_color||"000000"):"none","border-radius":(this.border_radius_max?"9999":this.border_radius||0)+"px",opacity:this.useLqip?0:i}).attr("url",this.useLqip?"":t);if(q.a.useLambdaUrl(this.picture)||q.a.useLambdaUrlOldProjects(this.picture)){var n=this.getPictureOptions(),r=q.a.getSrcset(this.picture,K({},n,{ext:"webp"})),l=q.a.getSrcset(this.picture,K({},n,{dprSet:[2,3]})),c=!!r,h=Object(s.a)("<picture/>");r&&Object(s.a)("<source/>").attr("srcset",r).attr("type","image/webp").appendTo(h),Object(s.a)("<img/>").attr("src",l?q.a.getLambdaUrl(this.picture,K({},n,{dpr:1})):t).attr("srcset",l).attr("alt",this.getAltText()).addClass("viewable").toggleClass("saveable",!!(e||this.insideHotspot&&this.isGIF)).css("opacity",0).load(a.a.bind((function(){var e=this.$el.find(".viewable"),s=e&&e.get(0)&&e.get(0).currentSrc||t,o=this.$el.find(".bgpic");o&&o.css({opacity:i,"background-image":"url(".concat(s,")")}).attr("url",s),e&&e.css("opacity",i),this.$lqipImg&&this.$lqipImg.css("opacity",0),a.a.delay(a.a.bind((function(){this.$el.css({overflow:"","border-radius":""}),this.$lqipImg&&this.$lqipImg.remove(),this.$lqipImg=null,this.widgetIsLoaded()}),this),200)}),this)).on("error",a.a.bind((function(){this.$lqipImg&&this.$lqipImg.remove(),this.$lqipImg=null,this.widgetIsLoaded()}),this)).appendTo(c?h:this.$el),c&&Object(s.a)(h).appendTo(this.$el),this.useLqip&&(this.$el.css("overflow","hidden"),this.border_radius&&this.$el.css("border-radius","".concat(this.border_radius,"px")),this.$lqipImg=Object(s.a)("<div/>").addClass("lqip").css({"background-image":"url(".concat(q.a.getLqipUrl(this.picture,{cropX:this.cropX,cropY:this.cropY,cropW:this.cropW,cropH:this.cropH,originalW:this.originalW,originalH:this.originalH}),")"),"background-position":"50% 50%",opacity:i}).appendTo(this.$el))}else Object(s.a)("<img/>").appendTo(this.$el).toggleClass("saveable",!!(e||this.insideHotspot&&this.isGIF)).css("opacity",void 0===this.opacity?1:this.opacity).addClass("viewable").load(a.a.bind((function(){this.$el.find("img").attr("url",t),this.widgetIsLoaded()}),this)).on("error",this.widgetIsLoaded).attr("src",t).attr("srcset",this.getSrcset()).attr("alt",this.getAltText())}else this.loadVector(t);return this.checkLink(),this},canShowPreview:function(){var t=this.animation&&"click"===this.animation.type&&this.animation.steps&&this.animation.steps.length>0,e=!!this.clickLink;return this.preview_enabled&&!t&&!e},isValid:function(){return!!this.getPictureUrl()},start:function(){return this.started=!0,Modernizr.safari&&this.isGIF&&this.$el.flashClass("fix-safari-gif",100),this},getPictureOptions:function(){var t=d.a.maxScaleAnimation(this.animation);return{width:this.w,height:this.h,cropX:this.cropX,cropY:this.cropY,cropW:this.cropW,cropH:this.cropH,originalW:this.originalW,originalH:this.originalH,scale:h.a.isOn(this.page.scale)?this.page.scale:1,animationScale:t&&t/100}},getPictureUrl:function(){return this.picture?q.a.useLambdaUrl(this.picture)||q.a.useLambdaUrlOldProjects(this.picture)?q.a.getLambdaUrl(this.picture,this.getPictureOptions()):this.picture.finalUrl&&0===a.a.last(this.picture.finalUrl.split(".")).indexOf("svg")?this.picture.finalUrl:(t=h.a.isOn(this.page.scale)?this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl||this.picture.final2xUrl||this.picture.finalUrl:Modernizr.retina&&(window.devicePixelRatio>=3&&(this.picture.final3xUrl||this.picture.unscaledOptimizedUrl)||this.picture.final2xUrl||this.picture.unscaledOptimizedUrl)||this.picture.finalUrl,(this.is_full_width||this.is_full_height)&&(t=this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl||this.picture.final2xUrl||this.picture.finalUrl),t||this.picture.effectUrl||this.picture.editedVectorUrl||this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl||this.picture.url):"";var t},getAltText:function(){return this.picture&&this.alt?a.a.escape(this.alt):void 0},getSrcset:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.picture)return[];if(!this.originalW)return[];if(this.isGIF)return[];if(h.a.isAllowed())return[];if(this.animation)return[];if(RM.screenshot)return[];if(this.picture.finalUrl&&0===a.a.last(this.picture.finalUrl.split(".")).indexOf("svg"))return[];var e=Math.floor(this.w),i=[{url:this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl,size:this.originalW},{url:this.picture.final2xUrl&&(this.picture.unscaledOptimizedUrl||this.picture.final3xUrl),size:3*e},{url:this.picture.final2xUrl,size:2*e},{url:this.picture.finalUrl,size:e}];if(i=i.filter(function(t){return!!t.url&&this.originalW>=t.size}.bind(this)).map((function(t){return"".concat(t.url," ").concat(t.size,"w")})),!t)return i;var s=["".concat(this.picture.finalUrl||this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl," 1x")];return this.picture.final2xUrl&&s.push("".concat(this.picture.final2xUrl," 2x")),this.picture.final2xUrl&&(this.picture.unscaledOptimizedUrl||this.picture.final3xUrl)&&s.push("".concat(this.picture.final2xUrl&&(this.picture.unscaledOptimizedUrl||this.picture.final3xUrl)," 3x")),s.concat(i)},cleanupSVG:function(t){var e=Object(s.a)(Object(s.a)(t).find("svg").get(0).cloneNode(!0)),i=e[0].outerHTML;return a.a.chain(e.find("[id]")).map((function(t){return{id:t.getAttribute("id"),newId:u.b.generateUUID()}})).sortBy((function(t){return-t.id.length})).each((function(t){i=(i=i.split("#"+t.id).join("#"+t.newId)).split('id="'+t.id+'"').join('id="'+t.newId+'"')})),i},loadVector:function(t){this.$el.addClass("svg"),this.svgAjax=s.a.get(t+"?c",a.a.bind((function(e){(e=Object(s.a)(this.cleanupSVG(e))).get(0).removeAttribute("width"),e.get(0).removeAttribute("height"),this.$svg=e;var i=e.get(0).cloneNode(!0);this.$svg.find("title").remove();var o=new Image;Object(s.a)(o).on("load error",a.a.bind((function(){Object(s.a)(o).appendTo(window.document.body).css({width:"100%",height:"100%"});var t=Object(s.a)(i);t.get(0).setAttribute("viewBox","0 0 "+Object(s.a)(o).width()+" "+Object(s.a)(o).height()),t.appendTo(window.document.body);var e=t.get(0).getBBox();this.$svg.get(0).setAttribute("viewBox",e.x+" "+e.y+" "+e.width+" "+e.height),this.$svg.get(0).setAttribute("preserveAspectRatio","xMidYMid meet"),Object(s.a)(o).remove(),t.remove();var n=Object(s.a)('<div class="svg-scale-wrapper"></div>');this.$svg.appendTo(n),n.appendTo(this.$el),this.widgetIsLoaded()}),this)),o.src=t}),this)).fail(this.widgetIsLoaded)},initPreview:function(){this.preview=new G.a({$container:Object(s.a)("body"),$el:this.$el,picture:this.picture,overlayColor:this.preview_overlay_color,originalW:this.originalW,width:this.w}),this.$el.addClass("preview-enabled"),this.$el.on("click",function(){this.preview.render(),this.preview.bindClick()}.bind(this))}}),J=f.extend({DO_NOT_WAIT_FOR_PRELOAD:!0,render:function(){this.makeBox("widget-gmaps"),this.$el.html(Object(s.a)('<div class="map-container"></div>')),this.rendered=!0;var t=this.api_key;return this.mag&&this.mag.opts&&this.mag.opts.gmaps_key&&this.mag.opts.gmaps_key!==this.api_key&&(t=this.mag.opts.gmaps_key),F.a.initGMapsAPI(t,function(){this.destroyed||a.a.defer(function(){this.destroyed||(h.a.isOn()&&this.scale(),this.map=new google.maps.Map(this.$(".map-container").get(0),{zoom:this.map_zoom,center:new google.maps.LatLng(this.center_lat,this.center_lng),mapTypeId:this.map_type_id||google.maps.MapTypeId.ROADMAP,disableDefaultUI:!this.show_controls,streetViewControl:!1,scrollwheel:void 0===this.scrollwheel||!!this.scrollwheel}),this.marker_lat&&this.marker_lng&&"directions"!==this.current_type&&(this.marker=new google.maps.Marker({map:this.map,position:new google.maps.LatLng(this.marker_lat,this.marker_lng)}),google.maps.event.addListener(this.marker,"click",function(){this.infowindow&&this.infowindow.open(this.map,this.marker)}.bind(this)),this.infowindow=new google.maps.InfoWindow({maxWidth:this.w-100}),this.formatted_address?this.infowindow.setContent(this.formatted_address):(new google.maps.Geocoder).geocode({latLng:new google.maps.LatLng(this.marker_lat,this.marker_lng)},function(t,e){e===google.maps.GeocoderStatus.OK&&t[0]&&this.infowindow.setContent(t[0].formatted_address)}.bind(this))),"directions"===this.current_type&&this.direction_start_lat&&this.direction_start_lng&&this.direction_end_lat&&this.direction_end_lng&&this.direction_route_type?(this.directionsService=new google.maps.DirectionsService,this.directionsDisplay=new google.maps.DirectionsRenderer({preserveViewport:!0}),this.directionsService.route({origin:new google.maps.LatLng(this.direction_start_lat,this.direction_start_lng),destination:new google.maps.LatLng(this.direction_end_lat,this.direction_end_lng),travelMode:google.maps.TravelMode[this.direction_route_type.toUpperCase()]},function(t,e){e===google.maps.DirectionsStatus.OK&&(this.directionsDisplay.setDirections(t),this.directionsDisplay.setMap(this.map),google.maps.event.addListener(this.map,"tilesloaded",function(){this.widgetIsLoaded()}.bind(this)))}.bind(this))):google.maps.event.addListener(this.map,"tilesloaded",function(){this.widgetIsLoaded()}.bind(this)),"custom"===this.current_type&&this.custom_json&&this.map.setOptions({styles:JSON.parse(this.custom_json)}))}.bind(this))}.bind(this)),this},scale:function(){var t=this.mag.getScale(this.page.pageViewport),e=this.$(".map-container");if(h.a.isZoom())e.css("zoom",1/t);else if(h.a.isTransform()){var i=100*t,s=(i-100)/2;e.css({transform:"scale("+1/t+") translate(-"+s+"%, -"+s+"%)",width:i+"%",height:i+"%"})}},start:function(){return this.started=!0,this.rendered&&!this.destroyed&&this.map?(google.maps.event.trigger(this.map,"resize"),this.map.setCenter(new google.maps.LatLng(this.center_lat,this.center_lng)),this):this},destroy:function(){return this.map&&google.maps.event.clearListeners(this.map,"tilesloaded"),this.marker&&google.maps.event.clearListeners(this.marker,"click"),f.prototype.destroy.apply(this,arguments)}}),Q=i("gHxz"),tt=i.n(Q),et=i("z79a"),it=i("cBBe"),st=f.extend(et.a.prototype).extend({DO_NOT_WAIT_FOR_PRELOAD:!0,PHONE_TIP_WIDTH:280,MOUSE_LEAVE_TIMEOUT:100,EDGE_GAP:16,events:{"click .pin":"onPinClick",mouseenter:"onMouseenter",mouseleave:"onMouseleave"},render:function(){var t;if(this.makeBox("widget-hotspot"),this.rendered=!0,this.phoneTipWrapperTemplate=tt.a["template-common-hotspot-widget-mobile-wrapper"],this.isPreview=!(!RM.constructorRouter||!RM.constructorRouter.preview),t={model:this,$container:this.$el,environment:"viewer",mag:this.page&&this.page.mag,block:null},this.hotspotWidget=new it.a(t),this.$pin=this.$(".pin").addClass("viewer"),this.started&&this.renderTip(),"icon"===this.pin_type){if(this.$el.addClass("icon"),!this.rasterUrl)return this.widgetIsLoaded(),this;var e=Object(s.a)("<img>");e.on("load",a.a.bind((function(){this.$(".pin").html(e),this.widgetIsLoaded()}),this)).on("error",this.widgetIsLoaded),e.attr("src",Modernizr.retina?this.raster2xUrl||this.rasterUrl||"":this.rasterUrl||"")}else this.renderPinShape(),this.widgetIsLoaded();return this},renderPinShape:function(){var t,e=new Backbone.Model(this);e.id=this._id,t=this.generateShapeSVG("viewer",e,this.w,this.h),this.$pin.html(t)},renderTip:function(){this.isTipRendered||(this.$tip=Object(s.a)('<div class="tip viewer invisible"></div>'),this.$tip.toggleClass("box-shadow",this["tip_box-shadow"]),this.$tip.css({"border-radius":this["tip_border-radius"]}),this.$blocksWrapper=Object(s.a)('<div class="blocks-wrapper"></div>'),this.$blocksWrapper.appendTo(this.$tip),this.$blocksWrapper.css({"background-color":u.b.getRGBA(this["tip_background-color"],this["tip_background-color-opacity"]/100),"border-radius":this["tip_border-radius"]}),this.$(".common-hotspot").append(this.$tip),this.pictureData=a.a.findWhere(this.wids||[],{type:"picture"}),this.textData=a.a.findWhere(this.wids||[],{type:"text"}),this.hasPictureWidget=!(!this.pictureData||this.pictureData.hidden),this.hasTextWidget=!(!this.textData||this.textData.hidden),this.hasPictureWidget&&(this.pictureData.insideHotspot=!0,this.pictureWidget=new At.picture(this.pictureData,this.page,this.$blocksWrapper),this.pictureWidget.isValid()?(this.pictureData.w=Math.min(this.tip_w,this.pictureData.w),this.pictureWidget.render()):(this.tip_h-=this.pictureWidget.h||0,this.textData&&(this.textData.y=0),this.pictureWidget=null,this.hasPictureWidget=!1)),this.hasTextWidget&&(this.textData.insideHotspot=!0,this.textData.hasGlobalParent=this.is_global,this.textWidget=new At.text(this.textData,this.page,this.$blocksWrapper),this.textWidget.w=Math.min(this.tip_w,this.textWidget.w),this.textWidget.render()),this.hasPictureWidget||this.hasTextWidget?(this.$closeButton=Object(s.a)('<div class="hotspot-phone-close"></div>'),this.$tip.append(this.$closeButton),this.isTipRendered=!0):this.$tip.remove())},updatePage:function(t){f.prototype.updatePage.apply(this,arguments),this.textWidget&&this.textWidget.updatePage(t)},start:function(){return this.started=!0,this.rendered&&!this.destroyed&&this.renderTip(),this},stop:function(){return this.started=!1,this.isTipVisible&&this.hideTip(),this},applyTipPosition:function(){var t,e,i,s,o,n,r,l=this.calcDistsToPageVisibleBounds(),c={w:this.w,h:this.h},h={w:this.$tip.width(),h:this.$tip.height()},d=this.hotspotWidget.TIP_GAP,p=this.tip_pos,u=a.a.pick(this,"w","h","tip_w","tip_h","tip_pos"),g=!1,m=!1;function f(t){var e,i,s,o;switch(t){case"top":e=l.top-c.h/2-d-h.h,s=l.bottom+c.h/2+d,o=l.left-h.w/2,i=l.right-h.w/2;break;case"right":e=l.top-h.h/2,s=l.bottom-h.h/2,o=l.left+c.w/2+d,i=l.right-c.w/2-d-h.w;break;case"bottom":e=l.bottom+c.h/2+d,s=l.bottom-c.h/2-d-h.h,o=l.left-h.w/2,i=l.right-h.w/2;break;case"left":e=l.top-h.h/2,s=l.bottom-h.h/2,o=l.left-c.w/2-d-h.w,i=l.right+c.w/2+d}return{top:e,left:o,bottom:s,right:i}}i=this.tip_pos,o=i,n=-1/0,r=!1,a.a.each(["top","right","bottom","left"],(function(t){if(!r){var e=f(t);s=a.a.min(e),t===i&&e[t]>0?(o=t,r=!0):s>n&&e[t]>=0&&(n=s,o=t)}})),p=o,u.tip_pos=p,e=this.hotspotWidget.apply_tip_position(u),t=f(p),a.a.each(t,function(t,i){if(t<0)switch(i){case"top":e.top-=t-this.EDGE_GAP,g=!0;break;case"bottom":g||(e.top+=t-this.EDGE_GAP);break;case"left":e.left-=t-this.EDGE_GAP,m=!0;break;case"right":m||(e.left+=t-this.EDGE_GAP)}}.bind(this)),this.$tip.css(e)},adjustPictureSize:function(){var t,e=this.tip_w/this.PHONE_TIP_WIDTH;this.pictureWidget&&(t=this.isPhone()?{width:this.PHONE_TIP_WIDTH,height:this.pictureData.h/e}:{width:this.pictureData.w,height:this.pictureData.h},this.pictureWidget.$el.css(t))},onPinClick:function(){this.isHoverable()||(this.isTipVisible?this.hideTip():this.isTipRendered&&this.showTip(),RM.analytics&&this.isTipVisible&&RM.analytics.sendEvent("Hotspot Click"))},onMouseenter:function(){this.isHoverable()&&this.isTipRendered&&(clearTimeout(this.mouseLeaveTimeout),this.isTipVisible||this.showTip(),RM.analytics&&RM.analytics.sendEvent("Hotspot Hover"))},onMouseleave:function(){this.isHoverable()&&(clearTimeout(this.mouseLeaveTimeout),this.mouseLeaveTimeout=setTimeout(function(){this.hideTip()}.bind(this),this.MOUSE_LEAVE_TIMEOUT))},showTip:function(){this.isTipRendered&&(this.adjustPictureSize(),this.isPhone()?(this.$phoneTipWrapper=this.$phoneTipWrapper||Object(s.a)(this.phoneTipWrapperTemplate()),this.$phoneTipWrapper.toggleClass("preview",this.isPreview),this.$phoneTipWrapper.detach().appendTo(this.isPreview?".mag-pages-container":"body"),this.$phoneTipWrapper.on("touchstart",this.onTipTouchStart),this.$phoneTipWrapper.on("touchmove",this.onTipTouchMove),this.$tipParent=this.$tip.parent(),this.$tip.detach().appendTo(this.$phoneTipWrapper.find(".center-cell")),a.a.defer(function(){this.$phoneTipWrapper.removeClass("invisible")}.bind(this)),this.$phoneTipWrapper.on("click",function(t){Object(s.a)(t.target).closest(".tip").is(this.$tip)||(this.hideTip(),this.$phoneTipWrapper.off())}.bind(this)),this.$closeButton.on("click",this.onCloseButtonClick)):(this.hotspotWidget.apply_tip_container_size({width:this.tip_w,height:this.tip_h}),this.applyTipPosition(),this.$tip.removeClass("invisible"),this.BringToTopZ(),this.page.mag.router.$mags_container.on("mousedown touchstart",this.onGlobalMouseDown),this.isHoverable()||Object(s.a)("body").on("keydown",this.onBodyKeyDown)),this.listenTo(this.page.mag,"change:viewport",this.onMagViewportBeforeChange),this.isTipVisible=!0)},hideTip:function(){this.isTipVisible&&(this.isTipVisible=!1,clearTimeout(this.mouseLeaveTimeout),this.isPhone()?(this.$phoneTipWrapper.addClass("invisible"),this.$phoneTipWrapper.off("touchstart",this.onTipTouchStart),this.$phoneTipWrapper.off("touchmove",this.onTipTouchMove),a.a.delay(function(){this.$tip.detach().appendTo(this.$tipParent),this.$phoneTipWrapper&&this.$phoneTipWrapper.detach()}.bind(this),200)):(this.$tip.addClass("invisible"),this.BackToNormalZ(),Object(s.a)("body").off("keydown",this.onBodyKeyDown)),this.stopListening(this.page.mag,"change:viewport"))},onTipTouchStart:function(t){this.tipScrollY=t.originalEvent.touches.item(0).clientY},onTipTouchMove:function(t){t.stopPropagation();var e=Object(s.a)(t.currentTarget),i=this.tipScrollY-t.originalEvent.touches.item(0).clientY;(i<0&&e.scrollTop()<=0||i>0&&e.scrollTop()+e.height()>=e[0].scrollHeight)&&t.preventDefault(),this.tipScrollY=t.originalEvent.touches.item(0).clientY},onCloseButtonClick:function(){this.$closeButton.off("click",this.onCloseButtonClick),this.hideTip()},onMagViewportBeforeChange:function(){this.hideTip()},onGlobalMouseDown:function(t){var e=Object(s.a)(t.target),i=e.closest(".pin"),o=e.closest(".tip");i.is(this.$pin)||o.is(this.$tip)||(this.page.mag.router.$mags_container.off("mousedown touchstart",this.onGlobalMouseDown),this.hideTip())},isPhone:function(){return w.a.isPhone||this.isPreview&&"phone_portrait"===this.page.mag.viewport},isHoverable:function(){return"hover"===this.tip_show_on&&w.a.isDesktop&&!this.isPhone()&&"tablet_portrait"!==this.page.mag.viewport},onBodyKeyDown:function(t){t.keyCode===s.a.keycodes.esc&&this.hideTip()},destroy:function(){return this.hotspotWidget&&this.hotspotWidget.destroy(),this.hotspotWidget=null,f.prototype.destroy.apply(this,arguments)}}),ot=i("60Nw"),nt=f.extend({render:function(){this.makeBox("widget-iframe"),this.rendered=!0;var t=this.getPluginClass();return t?(this.plugin=new t({widget:this}),this.$el.addClass(this.plugin.embed_type),this.started?this.drawPlugin():(this.contentCleared=!0,!RM.screenshot&&!this.drawInProgress&&this.widgetIsLoaded()),this):(this.widgetIsLoaded(),this)},drawPlugin:function(){this.$el.empty(),this.contentCleared=!1,this.drawInProgress=!0,this.plugin.parse(this.code,function(t){if(this.$data=this.plugin.sanitize(t),RM.screenshot&&setTimeout(a.a.bind((function(){this.widgetIsLoaded()}),this),5e3),this.plugin.draw(this.$data,this.$el,function(t,e){var i=RM.screenshot?5e3:2e3;this.loadTimeout=setTimeout(function(){this.drawInProgress=!1,this.destroyed||(this.widgetIsLoaded(),this.$data.off&&this.$data.off("load"),this.started||this.clearContent())}.bind(this),i)}.bind(this)),!RM.screenshot){if(!a.a.isFunction(this.$data.one))return;this.$data.one("load",function(){this.drawInProgress=!1,!this.destroyed&&this.started&&(this.widgetIsLoaded(),clearTimeout(this.loadTimeout))}.bind(this))}}.bind(this))},widgetIsLoaded:function(){this.loaded||this.destroyed||(this.loaded=!0,this.trigger("loaded"))},isValid:function(){return this.code&&this.getPluginClass()},start:function(){return this.started=!0,this.destroyed||!this.rendered?this:(this.contentCleared&&this.drawPlugin(),this)},stop:function(){return this.started=!1,this.plugin?(this.widgetIsLoaded(),this.drawInProgress?void 0:(this.clearContent(),this)):this},clearContent:function(){this.clear_content&&(this.$el.empty(),this.contentCleared=!0)},getPluginClass:function(){return ot.a.findPlugin(this)},destroy:function(){return this.clearContent(),this.plugin&&this.plugin.remove(),f.prototype.destroy.apply(this,arguments)}}),at=f.extend(et.a.prototype).extend({mailchimpMatcher:/__rm_mailchimp_(.+)/i,anchorRegexp:/__rm_anchor/i,shareRegexp:/^share\.(facebook|twitter|pinterest|gplus|linkedin|email)\.(mag|page)$/i,render:function(){if(this.makeBox("widget-shape"),this.hasHoverAnimation&&this.$el.addClass("has-onhover-animation"),this.rendered=!0,this.requiresImageLoad()){if(!this.rasterUrl)return this.widgetIsLoaded(),this;this.$el.addClass("icon"),this.antialiasRotation=!0;var t=Object(s.a)("<img>");t.on("load",a.a.bind((function(){this.$el.html(t),this.widgetIsLoaded()}),this)).on("error",this.widgetIsLoaded),t.attr("src",Modernizr.retina||h.a.isOn(this.page.scale)?this.raster2xUrl||this.rasterUrl||"":this.rasterUrl||"")}else this.redrawSVG(),this.widgetIsLoaded();return this.checkLink(),this},start:function(){Modernizr.firefox&&!this.requiresImageLoad()&&this.borders>0&&this.redrawSVG()},redrawSVG:function(){var t=this,e={id:t._id,get:function(e){return t[e]}};if("rectangle"!==this.tp||1!==this.opacity||w.a.isDesktop&&0!==this.borders){var i=this.generateShapeSVG("viewer-"+u.b.generateUUID(),e,this.$el.width(),this.$el.height());this.$el.html(i)}else{var s=u.b.hex2rgb(this.bg_color),o=u.b.hex2rgb(this.color);s&&s.push(this.bg_opacity),this.$el.css({"background-color":s?"rgba("+s.join(",")+")":"transparent","border-color":o?"rgb("+o.join(",")+")":"transparent","border-radius":this.radius||0,"border-style":"solid","border-width":this.borders,"box-sizing":"border-box"}),this.$el.addClass("div-instead-of-svg")}},requiresImageLoad:function(){return"icon"===this.tp},canRenderImmediately:function(){return!this.requiresImageLoad()},onPageResize:function(t){f.prototype.onPageResize.apply(this,arguments),this.requiresImageLoad()||this.redrawSVG()}}),rt=i("tcpm"),lt=f.extend({MIN_TOP_SCROLL_SPACE:5,TIME_OF_STOPPED_SCROLL:55,render:function(){var t=this;(this.makeBox("widget-slideshow"),this.pictures=a.a.filter(this.pictures,(function(t){return!t.error})),this.player=new rt.a(this,this.$el,"viewer",null,this.page&&this.page.mag),void 0!==this.play_method&&"scroll"===this.play_method)&&(Object(s.a)(window).on("scroll",this.onScrollTransition),this.innerContentTop=this.page.contentPosition.top/this.page.scale,this.innerContainerHeight=this.page.mag.getContainerSizeCached().height/this.page.scale,this.isScrolling=!1,this.$image=this.$el.find(".image"),this.lastScrollTop=0,this.isCrossfade="crossfade"===this.transition_type,this.delay=(this.theme_data.scroll_delay>0?this.theme_data.scroll_delay:1)+(this.isCrossfade?this.theme_data.crossfade:0),this.picsID=[],this.player.$images_wrapper.children(".image").each((function(e,i){t.picsID.push(Object(s.a)(i).attr("data-id"))})));return this.player.on("ready",a.a.bind((function(){setTimeout(this.widgetIsLoaded,100)}),this)),!this.theme_data.arrows||"library"!==this.theme_data.arrows_type&&"noun"!==this.theme_data.arrows_type||this.renderNounIcons(),this.rendered=!0,this},onScrollTransition:function(t){var e=this,i=window.pageYOffset||document.documentElement.scrollTop,s=this.y+this.innerContentTop,o=s-this.innerContainerHeight,n=0*(s-o)+o+this.theme_data.start_offset||0,a=this.isCrossfade?10*this.theme_data.crossfade:this.TIME_OF_STOPPED_SCROLL,r=this.picsID.length,l=n>0?(i-n*this.page.scale)/this.page.scale:i/this.page.scale,c=Math.floor(l/this.delay),h=c+1,d=h>=r?h-Math.floor(h/r)*r:h;this.isScrolling&&(this.setFreezeStyles(i),d>=0&&this.player.currentImageID!==this.picsID[d]&&this.changeImage(i,c,this.picsID[d])),n<=0&&i<this.MIN_TOP_SCROLL_SPACE?setTimeout((function(){e.changeImage(i,c,e.picsID[0]),e.isScrolling=!1}),a):(clearTimeout(this.isScrolling),this.isScrolling=setTimeout((function(){e.setFreezeStyles(i)}),a))},changeImage:function(t,e,i){(t>this.lastScrollTop&&t>=e*this.delay||t<this.lastScrollTop&&t>=(e-1)*this.delay)&&this.player.moveToImage(i,!0,"switch-to-image-scroll"),this.lastScrollTop=t<=0?0:t},setFreezeStyles:function(t){var e=this.$el.find(".center-image"),i=this.$el.find(".prev-image"),s=this.getRealOpacity(e.css("opacity")),o=this.getRealOpacity(i.css("opacity"));this.isCrossfade&&(e.css({opacity:s>o?s:1-o}),i.css({opacity:o>s?o:1-s}),e.hasClass("changed-opacity")||i.hasClass("changed-opacity")||i.addClass("changed-opacity"))},getRealOpacity:function(t){return t<.1?10*t:t},renderNounIcons:function(){var t=this.left_arrow_noun&&this.left_arrow_noun.rasterUrl?this.left_arrow_noun:this.theme_data.left_icon_noun,e=this.right_arrow_noun&&this.right_arrow_noun.rasterUrl?this.right_arrow_noun:this.theme_data.right_icon_noun,i=this.theme_data.arrows_position;if(t&&t.rasterUrl){var o=Object(s.a)("<img>");o.on("load",a.a.bind((function(){"bottom"===i?this.$el.find(".prev-picture-arrow-bottom").empty().html(o.clone()):this.$el.find(".prev-picture-arrow-middle").empty().html(o.clone())}),this)).on("error",this.widgetIsLoaded),o.attr("src",Modernizr.retina?t.raster3xUrl||t.raster2xUrl||t.rasterUrl||"":h.a.isOn()?t.raster2xUrl||t.rasterUrl||"":t.rasterUrl||"")}if(e&&e.rasterUrl){var n=Object(s.a)("<img>");n.on("load",a.a.bind((function(){"bottom"===i?this.$el.find(".next-picture-arrow-bottom").empty().html(n.clone()):this.$el.find(".next-picture-arrow-middle").empty().html(n.clone())}),this)).on("error",this.widgetIsLoaded),n.attr("src",Modernizr.retina?e.raster3xUrl||e.raster2xUrl||e.rasterUrl||"":h.a.isOn()?e.raster2xUrl||e.rasterUrl||"":e.rasterUrl||"")}},isValid:function(){return this.pictures&&this.pictures.length},start:function(){return this.started=!0,!RM.screenshot&&!this.destroyed&&this.player&&(this.theme_data.autoplay&&void 0===this.play_method||"autoplay"===this.play_method)&&this.rendered&&this.loaded&&this.player.startAutoplay(),this},stop:function(){return this.started=!1,!RM.screenshot&&!this.destroyed&&this.player&&this.rendered&&this.loaded&&this.player.stopAutoplay(),this},destroy:function(){return this.player&&this.player.off(),this.player&&this.player.destroy(),this.player=null,"scroll"===this.play_method&&Object(s.a)(window).off("scroll",this.onScrollTransition),f.prototype.destroy.apply(this,arguments)}}),ct=i("D12m"),ht=i("YNoo"),dt=i.n(ht),pt=i("RX7I"),ut=f.extend({DO_NOT_WAIT_FOR_PRELOAD:!0,antialiasRotation:!0,mailchimpMatcher:/__rm_mailchimp_(.+)/i,anchorRegexp:/__rm_anchor/i,shareRegexp:/^share\.(facebook|twitter|pinterest|gplus|linkedin|email)\.(mag|page)$/i,render:function(){this.makeBox("text"),this.hasHoverAnimation&&this.$el.addClass("has-onhover-animation"),this.rendered=!0,this.bg_color=null==this.bg_color?"ffffff":this.bg_color,this.bg_opacity=null==this.bg_opacity?0:this.bg_opacity,this.column_count=null==this.column_count?1:this.column_count,this.column_gap=null==this.column_gap?16:this.column_gap;var t=[parseInt(this.bg_color.substring(0,2),16),parseInt(this.bg_color.substring(2,4),16),parseInt(this.bg_color.substring(4,6),16)];this.bg_opacity>.99?this.bg="rgb("+t[0]+","+t[1]+","+t[2]+")":this.bg="rgba("+t[0]+","+t[1]+","+t[2]+", "+this.bg_opacity+")",this.text=this.switchTextToViewport(this.text,this.insideHotspot?"default":this.page.pageViewport);var e=this.mag.model.attributes&&this.mag.model.attributes.edit_params&&this.mag.model.attributes.edit_params.paragraph_styles||[],i=s.a.parseHTML(this.text);i=i.map((function(t){var i=Object(s.a)(t),o=i.attr("class");if(o){var n=e.find((function(t){return t._name.toLowerCase()===o.toLowerCase()}));if(n&&n.tag&&"p"!==n.tag&&u.a.AVAILABLE_TEXT_TAGS.includes(n.tag))return Object(s.a)("<"+n.tag+' class="'+o+'" style="'+(i.attr("style")||"")+'" />').append(i.contents())[0].outerHTML}return t.outerHTML})).filter((function(t){return t})),this.text=i.join(""),this.isNotChrome=!(Modernizr.webkit&&!Modernizr.safari&&!Modernizr.safari5)&&this.text.includes("justify");var o=dt.a["template-viewer-widget-text"],n=Object(s.a)(o(this));this.seamlessFontsShow(function(){this.$el.removeClass("fonts-pending")}.bind(this),function(){this.$el.addClass("fonts-pending")}.bind(this)),this.$el.append(n),this.$el.on(w.a.isDesktop?"mouseenter":"touchstart","a",this.onLinkMouseEnter),this.$el.on(w.a.isDesktop?"mouseleave":"touchend","a",this.onLinkMouseLeave),this.$el.on("click","a",this.onLinkClick),n.addClass("v"+(this.version||1));var r=this;return this.$el.find("a").each((function(){var t=Object(s.a)(this),e=t.attr("data-pid"),i=t.attr("href"),o=decodeURIComponent(i),n=/^back\sto\stop$/i,l=e,c=!1;(n.test(i)||n.test(o))&&(l=r.page._id);var h=i&&r.page.mag.matchSameDomainLink(i);if((h==t.attr("href")||l)&&(h=void 0),l=l||h){var d=r.page.mag.getPageNum(l),p=d&&r.page.mag.getPageUri?"/"+r.page.mag.getPageUri(l):"javascript:void(0)";d?t.attr("href",p).addClass("maglink").attr("target",""):t.removeAttr("href"),l==r.page._id&&(t.addClass("back-to-top"),e&&(r.is_global||r.hasGlobalParent)&&t.addClass("current"))}else if(/^__rm_goback$/i.test(t.attr("href")))t.attr("href","javascript:void(0)").addClass("goback-link");else if(r.mailchimpMatcher.test(t.attr("href"))){var u=t.attr("href").match(r.mailchimpMatcher)[1];t.attr("href","javascript:void(0)").attr("data-mailchimp",u).addClass("mailchimp-link"),F.a.initMailchimpAPI()}else if(r.shareRegexp.test(t.attr("href"))){var g=t.attr("href").match(r.shareRegexp);t.attr("href","javascript:void(0)").attr("data-share-provider",g[1]).attr("data-share-type",g[2]).addClass("share-link")}else if(r.anchorRegexp.test(t.attr("href"))){t.attr("href","javascript:void(0)").addClass("anchor-link");var m=t.attr("data-page-uri"),f=a.a.findWhere(r.mag.pages,{_id:m})||r.page;t.attr("data-page-uri",f.uri||f.num)}else c=!0,t.addClass("external-link");!t.attr("href")||0!=t.attr("href").indexOf("mailto")&&0!=t.attr("href").indexOf("tel")||t.attr("target",""),!c&&RM.screenshot&&t.removeAttr("href")})),RM.screenshot&&!this.insideHotspot?this.waitForUsedFontsLoad():this.widgetIsLoaded(),this.$el.find("span.soundcite").each((function(t,e){RM.screenshot||pt.a.createPlayer(e)})),this},isValid:function(){var t=Object(s.a)("<div>").html(this.text).text();return""!=s.a.trim(t)},hasFontsToLoad:function(){return!0},start:function(){return this.started=!0,Modernizr.chrome&&this.$el.addClass("force-repaint-content"),this},stop:function(){return this.started=!1,this.$el.removeClass("force-repaint-content"),RM.screenshot||this.destroyed||!this.rendered||this.$el&&this.$el.find("span.soundcite").each((function(t,e){pt.a.pausePlayer(e)})),this},destroy:function(){return this.$el&&this.$el.find("span.soundcite").each((function(t,e){pt.a.destroyPlayer(e)})),f.prototype.destroy.apply(this,arguments)},waitForUsedFontsLoad:function(){this.hasFontsToLoad()?this.page.addFontsToLoad(this,this.widgetIsLoaded):this.widgetIsLoaded()},checkLink:function(){if(this.is_global||this.hasGlobalParent){var t=this.$el.find("a[data-pid]");t.removeClass("current back-to-top"),this.page&&t.filter('[data-pid="'+this.page._id+'"]').addClass("current back-to-top").removeClass("hovered")}f.prototype.checkLink.apply(this,arguments)},onLinkMouseEnter:function(t){var e=Object(s.a)(t.currentTarget).attr("data-uuid");this.$el.find("a[data-uuid='"+e+"']").addClass("hovered")},onLinkMouseLeave:function(t){var e=Object(s.a)(t.currentTarget).attr("data-uuid");this.$el.find("a[data-uuid='"+e+"']").removeClass("hovered")},onLinkClick:function(t){if(2!=t.which&&!t.metaKey&&!t.ctrlKey){var e=Object(s.a)(t.currentTarget),i=s.a.trim(e.attr("href")).match(/\/start\-with\-template\/(\d+)$/i),o=i&&i[1];o&&RM.viewerRouter&&RM.viewerRouter.createMagFromTemplate&&(t.preventDefault(),RM.viewerRouter.createMagFromTemplate("template-link",o))}}}).extend(ct.a.prototype),gt=i("+9Qk"),mt=i("Vc8N"),ft=i.n(mt),vt=f.extend({CONTENT_WAIT_TICK:100,CONTENT_WAIT_MAX_TICKS:20,CONTENT_IMG_WAIT:1e3,DO_NOT_WAIT_FOR_PRELOAD:!0,render:function(){var t,e;return this.makeBox("widget-twitter"),this.rendered=!0,this.current_type?("mag"===(e=this[this.current_type]).use_own_url?e.url=this.page.mag.getUrl():"page"!==e.use_own_url&&e.url||(e.url=this.page.getUrl()),RM.screenshot||(e.text=gt.a.getFinalShare(this.page,a.a.extend(this.page.mag.model.toJSON(),{user:this.page.mag.user}),{forProject:"mag"===e.use_own_url,customDomain:RM.common.isDomainViewer}).tweet),t=ft.a["template-constructor-block-twitter-"+this.current_type],this.$el.html(t(e)),"type_timeline"===this.current_type&&this.$el.find("a").attr({width:this.w,height:this.h}),F.a.initTwitterAPI(function(){this.destroyed||(window.twttr&&window.twttr.widgets&&a.a.isFunction(window.twttr.widgets.load)&&window.twttr.widgets.load(),Object(a.a)(["type_timeline","type_embed"]).contains(this.current_type)?this.waitForTwitterContent():this.widgetIsLoaded())}.bind(this)),this):(this.widgetIsLoaded(),this)},waitForTwitterContent:function(){var t,e,i,s=0,o=!1,n={type_timeline:".timeline-Widget",type_embed:"blockquote.tweet"};clearInterval(t),t=setInterval(a.a.bind((function(){s++,this.destroyed?clearInterval(t):(1==(e=this.$el.find("iframe")).length&&(i=n[this.current_type],o=e.contents().find(i).length>0),(o||s>this.CONTENT_WAIT_MAX_TICKS)&&("type_embed"==this.current_type&&e.css({margin:0,"max-width":"100%"}),"type_timeline"==this.current_type&&(console.log("$frame : ",e),e.css({width:"100%",height:"100%!important","max-width":"100%"})),clearInterval(t),setTimeout(a.a.bind((function(){this.widgetIsLoaded()}),this),this.CONTENT_IMG_WAIT)))}),this),this.CONTENT_WAIT_TICK)}}),bt=i("i8i4"),_t=i.n(bt),wt=i("LazK"),yt=i("8AXF"),kt=f.extend({ignoreScale:!0,render:function(){this.makeBox("widget-rm-header"),this.$header=Object(s.a)("<div>").appendTo(this.$el).get(0);var t=new n.a.Model({activeLink:this.activeLink});return Object(yt.renderReact)({component:wt.a,domElement:this.$header,model:t}),this.rendered=!0,this.widgetIsLoaded(),this},destroy:function(){return _t.a.unmountComponentAtNode(this.$header),f.prototype.destroy.apply(this,arguments)}}),Ct=i("1cLU");function xt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function St(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var Pt=f.extend({ignoreScale:!0,render:function(){return this.makeBox("widget-rm-footer"),Object(s.a)(".widget-rm-footer").css({background:"rgb(40, 40, 40)"}),this.propsModel=new Backbone.Model(function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?xt(i,!0).forEach((function(e){St(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):xt(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({isMobileViewport:!1},this.getStyles())),this.$footer=Object(s.a)("<div>").appendTo(this.$el).get(0),Object(yt.renderReact)({component:Ct.a,domElement:this.$footer,model:this.propsModel}),this.rendered=!0,this.widgetIsLoaded(),this},destroy:function(){return _t.a.unmountComponentAtNode(this.$footer),f.prototype.destroy.apply(this,arguments)},getStyles:function(){if(h.a.isAllowed()&&!(Object(s.a)(window).width()<1024)){var t=1/h.a.getRatio(),e=h.a.isZoom(),i=h.a.isTransform();return{zoom:e?"".concat(t):null,transform:i?"scale(".concat(t,")"):null}}},onPageResize:function(){f.prototype.onPageResize.apply(this,arguments),this.propsModel.set(this.getStyles())}}),$t=i("Kw5r"),Ot=i("4rJ8"),Tt=f.extend({ignoreScale:!0,render:function(){this.makeBox("widget-rm-cookies");var t=$t.a.extend(Ot.a);return this.vue=new t({el:Object(s.a)("<div>").appendTo(this.$el).get(0)}),this.rendered=!0,this.widgetIsLoaded(),this},destroy:function(){return this.vue&&this.vue.$destroy(),f.prototype.destroy.apply(this,arguments)}});function Mt(t,e,i,s,o,n,a){try{var r=t[n](a),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(s,o)}var jt,It,Et=f.extend({render:(jt=regeneratorRuntime.mark((function t(){var e,s,o,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.makeBox("widget-text-react"),e=i("8AXF"),s=e.renderReact,t.next=4,Promise.resolve().then(i.bind(null,"zjto"));case 4:return o=t.sent,n=o.TextViewer,s({component:n,domElement:this.$el[0],model:this.model}),this.rendered=!0,this.widgetIsLoaded(),t.abrupt("return",this);case 10:case"end":return t.stop()}}),t,this)})),It=function(){var t=this,e=arguments;return new Promise((function(i,s){var o=jt.apply(t,e);function n(t){Mt(o,i,s,n,a,"next",t)}function a(t){Mt(o,i,s,n,a,"throw",t)}n(void 0)}))},function(){return It.apply(this,arguments)}),destroy:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return f.prototype.destroy.apply(this,e)}}),At=e.a={addtocart:b,audio:y,background:I,button:D,ecommercecart:B,facebook:V,form:W,picture:Z,gmaps:J,hotspot:st,iframe:nt,shape:at,slideshow:lt,text:ut,twitter:vt,video:j,rmheader:kt,rmfooter:Pt,rmcookies:Tt,textreact:Et}},gm8A:function(t,e,i){"use strict";var s=i("xi34"),o=i("q1z7"),n=i.n(o),a=i("rFsW"),r=i("OTSC"),l=i("HuYI"),c=i.n(l),h=i("QNiq"),d=n.a.View.extend({MIN_FIELD_WIDTH:50,MIN_FIELD_HEIGHT:30,LINE_HEIGHT_FACTOR:1.2,INVALID_COLOR:"ff4828",INVALID_BORDER_WIDTH:2,DROPDOWN_TRIANGLE:{SVG:'<svg class="form-dropdown-triangle" width="9" height="6" preserveAspectRatio="none" viewBox="0 0 9 6" xmlns="http://www.w3.org/2000/svg"><path d="M3.763 5.196L.536 1.676A1 1 0 0 1 1.273 0h6.454a1 1 0 0 1 .737 1.676l-3.227 3.52a1 1 0 0 1-1.474 0z" fill-rule="evenodd"/></svg>',OPACITY_MULTIPLIER:.4,W:9,H:6,FONT_SIZE:18},CHECKBOX_TICK:{SVG:'<svg width="19" height="14" preserveAspectRatio="none" viewBox="0 0 19 14" xmlns="http://www.w3.org/2000/svg"><path d="M6.657 10.9L17.263.292a1 1 0 1 1 1.415 1.414L7.364 13.021a.997.997 0 0 1-1.414 0L.293 7.364A1 1 0 1 1 1.707 5.95l4.95 4.95z" fill-rule="evenodd"/></svg>',W:19,H:14,FONT_SIZE:18},initialize:function(t){a.a.bindAll(this),this.data=t.data,this.$container=t.$container,this.environment=t.environment,this.buttonTemplate=c.a["template-common-form-button"]},render:function(t){t=t||{},this.rendered?t.force&&this.$el&&this.$el.empty():(this.setElement(Object(s.a)("<div>")),this.$el.addClass("form-wrapper").appendTo(this.$container),"constructor"!==this.environment&&this.$el.on(h.a.isDesktop?"mouseenter":"touchstart",".button",this.onButtonHover).on(h.a.isDesktop?"mouseleave":"touchend",".button",this.onButtonHoverOut),this.$el.on("change","select",this.onDropdownChange).on("mouseenter",".input-wrapper",this.onInputHover).on("mouseleave",".input-wrapper",this.onInputHoverOut),this.rendered=!0);for(var e,i,o=this.data,n=o.fields,a=Object(s.a)("<div>"),r=0;r<n.length;r++){var l=n[r];e="vertical"===o.layout&&"text"===l.tp,(i=Object(s.a)(e?"<textarea>":"<input>")).addClass("js-input"),i.attr("type","text").attr("autocapitalize","name"==l.tp?"on":"off").attr("autocomplete","off").attr("autocorrect","off").attr("name",l.caption).attr("placeholder",l.caption+(l.optional&&"viewer"!==this.environment?" (optional)":"")).attr("spellcheck",!1).attr("data-sort",l.sort),"email"==l.tp&&i.attr("inputmode","email"),"phone"==l.tp&&i.attr("inputmode","tel"),"number"==l.tp&&i.attr("inputmode","numeric"),"checkbox"===l.tp&&i.attr("type","checkbox"),"dropdown"==l.tp&&(i.attr({tabindex:-1}),i.prop({readonly:!0}),i.addClass("fake-dropdown"));var c=Object(s.a)('<div class="input-wrapper js-input-wrapper"/>');if(c.append(i),c.append('<div class="overlay"></div>'),"viewer"!==this.environment&&e){var d=Object(s.a)('<span class="input-line-control input-line-control-add js-add-line"></span>'),p=Object(s.a)('<span class="input-line-control input-line-control-remove js-remove-line"></span>');c.append(d).append(p)}if(c.appendTo(a),"dropdown"==l.tp&&l.items){var u=Object(s.a)("<select>"),g=Object(s.a)(this.DROPDOWN_TRIANGLE.SVG);u.attr("name",l.caption),Object(s.a)('<option value="" selected></option>').prop("disabled",!l.optional).appendTo(u);for(var m=0;m<l.items.length;m++)Object(s.a)("<option>").attr("value",l.items[m]).text(l.items[m]).appendTo(u);i.parent().append(g).append(u)}if("checkbox"===l.tp){var f=h.a.isDesktop?"":"input-checkbox-wrapper-mobile";i.wrap('<label class="input-checkbox-wrapper '+f+'"></label>'),i.after('\t\t\t\t\t\t<div class="input-checkbox-inner"> \t\t\t\t\t\t\t<span class="label">'+i.attr("placeholder")+'</span> \t\t\t\t\t\t\t<span class="tick">'+this.CHECKBOX_TICK.SVG+"</span> \t\t\t\t\t\t</div>")}}Object(s.a)(this.buttonTemplate()).appendTo(a),this.$el.html(a.html()).addClass("common-form"),this.$button=this.$(".button"),this.$buttonIcons=this.$(".button svg"),this.$inputs=this.$(".input-wrapper"),this.$triangles=this.$(".form-dropdown-triangle"),this.recalcStyles()},onDropdownChange:function(t){Object(s.a)(t.currentTarget).parent().find(".js-input").val(Object(s.a)(t.currentTarget).val())},setButtonHoverState:function(){this.forcePseudoState="hover",this.applyButtonStyle()},unsetButtonHoverState:function(){this.forcePseudoState=!1,this.applyButtonStyle()},recalcStyles:function(t){this.$el.attr("data-layout",this.data.layout).attr("data-style",this.data.style),this.$button.find(".caption").text(this.data["button-caption"]),this.resizeElements(t),this.applyInputsStyle(this.$inputs),this.applyButtonStyle(t)},getMinimalDimensions:function(){var t,e=this.data,i=e.fields,s=e["style-"+e.style+"-fields"],o=e["style-"+e.style+"-button-default"],n=this.getButtonValue.bind(this,o,s),a=o.gutter+i.length*s.gutter,r=s["underline-width"]||0,l=Math.max(Math.ceil(n("font-size")*this.LINE_HEIGHT_FACTOR),this.MIN_FIELD_HEIGHT)+r,c=Math.max(Math.ceil(s["font-size"]*this.LINE_HEIGHT_FACTOR),this.MIN_FIELD_HEIGHT)+r,h=Math.max(l,c);return"vertical"==e.layout&&(t={width:this.MIN_FIELD_WIDTH,height:a+this.getTotalInputsHeight(i,h)+h}),"horizontal"==e.layout&&(t={width:a+(i.length+1)*this.MIN_FIELD_WIDTH,height:h}),t},getTotalInputsHeight:function(t,e){return a.a.reduce(t,function(t,i){return"text"===i.tp?t+this.getExtraTextareaDimensions(i.rows,e).height:t+e}.bind(this),0)},getRowsCount:function(t){return a.a.reduce(t,(function(t,e){return t+("text"===e.tp&&e.rows||1)}),0)},getInputDimensions:function(t){var e,i,s=this.data,o=s.fields,n=o.length+1,a=s["style-"+s.style+"-button-default"],r=s["style-"+s.style+"-fields"],l=a.gutter+o.length*r.gutter,c=t&&null!=t.w?t.w:s.w,h=t&&null!=t.h?t.h:s.h,d="vertical"===s.layout,p=Math.floor(d?h:c),u=p-l;if(d){var g=this.getLineHeight(),m=u-this.getRowsCount(o)*g.input-g.input,f=Math.ceil(m/n);e=g.input+f,i=this.getTotalInputsHeight(o,e)+e+l-p}else i=(e=Math.ceil(u/n))*(o.length+1)+l-p;return{overflow:i,itemSize:e,itemOtherSize:d?c:h,gutter:r.gutter,lastGutter:a.gutter+r.gutter}},getLineHeight:function(){var t=this.data||{},e=this.LINE_HEIGHT_FACTOR,i=this.getButtonValue(t["style-"+t.style+"-button-default"],t["style-"+t.style+"-fields"],"font-size"),s=t["style-"+t.style+"-fields"]["font-size"];return{input:Math.floor(e<10?e*s:e),button:Math.floor(e<10?e*i:e)}},getExtraTextareaDimensions:function(t,e){t=t||1;var i=this.getLineHeight(),s=Math.round(e-i.input),o=this.data&&"underlined"==this.data.style,n=o?s:Math.ceil(s/2),a=o?0:Math.floor(s/2);return{height:t*i.input+n+a,top:n,bottom:a}},resizeElements:function(t){var e=this.data,i="vertical"===e.layout,o=e.fields,n=o.length,a=this.getInputDimensions(t),r=a.overflow,l=e["style-"+e.style+"-fields"],c=(l&&l["underline-width"]||0)+2;this.$inputs.add(this.$button).each(function(t,e){var l={},h=a.itemSize,d=t===n-1,p=t<n,u=o[t],g=Object(s.a)(e),m=t>=n+1-r;if(m&&h--,l[i?"height":"width"]=h+"px",l[i?"width":"height"]=a.itemOtherSize+"px",p&&(l[i?"margin-bottom":"margin-right"]=d?a.lastGutter:a.gutter),l[i?"margin-right":"margin-bottom"]="",i&&u&&"text"===u.tp){var f=u.rows||1,v=g.find(".js-input"),b=g.find(".js-add-line"),_=g.find(".js-remove-line"),w=this.getExtraTextareaDimensions(f,a.itemSize);l.height=w.height+(m?-1:0)+"px",v.css({top:w.top-c,bottom:w.bottom}),v.attr({rows:f}),b.css({top:w.top-c}),_.css({bottom:w.bottom+c}),g.toggleClass("is-multiline",f>1)}g.css(l)}.bind(this))},showInputPlaceholdersAsValues:function(t){this.$inputs.each((function(e,i){var o=Object(s.a)(i).find(".js-input");"checkbox"===o.attr("type")?o.parent().find(".label").addClass("input-checkbox-preview"):o.val(t?o.attr("placeholder"):"")}))},applyInputsStyle:function(t,e){var i=this;e=e||{};var o,n=this.data,r=(n.fields,a.a.clone(n["style-"+n.style+"-fields"]));"underlined"==n.style?(e.invalid&&(r["underline-color"]=this.INVALID_COLOR,r["underline-opacity"]=100,r["underline-width"]=r["underline-width"]||this.INVALID_BORDER_WIDTH),o={"background-color":"transparent","border-radius":0,"box-shadow":"inset 0 "+-r["underline-width"]+"px 0 0 "+this.getRgba(r["underline-color"],r["underline-opacity"])}):(e.invalid&&(r["border-color"]=this.INVALID_COLOR,r["border-opacity"]=100,r["border-width"]=r["border-width"]||this.INVALID_BORDER_WIDTH),o={"background-color":this.getRgba(r.color,r.opacity),"border-radius":r["border-radius"]+"px","box-shadow":"inset 0 0 0 "+r["border-width"]+"px "+this.getRgba(r["border-color"],r["border-opacity"])});var l={"font-family":r["font-family"],"font-style":r["font-style"],"font-weight":r["font-weight"],color:this.getRgba(r["text-color"],r["text-opacity"]),"font-size":r["font-size"],"letter-spacing":r["letter-spacing"],"margin-bottom":r["underline-width"]?r["underline-width"]+"px":0};t.css(o).find(".js-input, select").css(l),t.find(".input-checkbox-inner .label").css(l),t.find(".js-add-line, .js-remove-line").css({"font-size":r["font-size"]}),t.find(".form-dropdown-triangle").each(function(t,e){var i=Object(s.a)(e),o=i.parent(),n=o.find(".js-input"),a=n.position().top,l=o.height()-n.height()-a,c=this.getSvgSizesFromFontSize(r["font-size"],"DROPDOWN_TRIANGLE");i.css({fill:this.getRgba(r["text-color"],r["text-opacity"]*this.DROPDOWN_TRIANGLE.OPACITY_MULTIPLIER),top:a,bottom:l,width:c.w,height:c.h})}.bind(this)),t.find(".input-checkbox-inner svg").each((function(t,e){var o=Object(s.a)(e),n=i.getSvgSizesFromFontSize(r["font-size"],"CHECKBOX_TICK");o.css({fill:i.getRgba(r["text-color"],r["text-opacity"]),width:n.w,height:n.h})}))},applyButtonStyle:function(){var t=this.data,e=(t.fields,t["style-"+t.style+"-fields"]),i=t["style-"+t.style+"-button-default"],s=t["style-"+t.style+"-button-hover"],o=this.getButtonValue.bind(this,i,e),n=this.getHoverValue.bind(this,s,i,e),a=o("letter-spacing");this.$button.css({"line-height":this.$button.height()+"px","background-color":this.getRgba(o("color"),o("opacity")),"border-radius":o("border-radius")+"px","box-shadow":"inset 0 0 0 "+o("border-width")+"px "+this.getRgba(o("border-color"),o("border-opacity")),"font-family":o("font-family"),"font-style":o("font-style"),"font-weight":o("font-weight"),color:this.getRgba(o("text-color"),o("text-opacity")),"font-size":o("font-size"),"letter-spacing":a,"text-align":o("text-align"),"text-indent":a/2||0}),this.$buttonIcons.css({fill:this.getRgba(o("text-color"),o("text-opacity"))}),this.$button.attr("data-default",this.$button.attr("style")),this.$button.css({"background-color":this.getRgba(n("color"),n("opacity")),"box-shadow":"inset 0 0 0 "+n("border-width")+"px "+this.getRgba(n("border-color"),n("border-opacity")),color:this.getRgba(n("text-color"),n("text-opacity"))}),this.$button.attr("data-hover",this.$button.attr("style")),this.forcePseudoState||this.$button.attr("style",this.$button.attr("data-default")),this.$button.outerHeight(),this.$button.toggleClass("with-transition",!!s.transition&&"viewer"==this.environment)},getRgba:function(t,e){var i=r.b.hex2rgb(t);return"rgba("+i[0]+", "+i[1]+","+i[2]+","+e/100+")"},getButtonValue:function(t,e,i){return"inherit"==t[i]?e[i]:t[i]},getHoverValue:function(t,e,i,s){return"inherit"==t[s]?this.getButtonValue(e,i,s):t[s]},onInputHover:function(t){var e=this.data,i=a.a.clone(e["style-"+e.style+"-fields"]);Object(s.a)(t.currentTarget).find(".form-dropdown-triangle").css("fill",this.getRgba(i["text-color"],i["text-opacity"]))},onInputHoverOut:function(t){var e=this.data,i=a.a.clone(e["style-"+e.style+"-fields"]);Object(s.a)(t.currentTarget).find(".form-dropdown-triangle").css("fill",this.getRgba(i["text-color"],i["text-opacity"]*this.DROPDOWN_TRIANGLE.OPACITY_MULTIPLIER))},onButtonHover:function(t){this.$button.hasClass("submitted")||this.$button.attr("style",this.$button.attr("data-hover"))},onButtonHoverOut:function(t){this.$button.attr("style",this.$button.attr("data-default"))},destroy:function(){this.$el.off(h.a.isDesktop?"mouseenter":"touchstart",".button",this.onButtonHover).off(h.a.isDesktop?"mouseleave":"touchend",".button",this.onButtonHoverOut).off("change","select",this.onDropdownChange),this.$el&&this.$el.remove()},getSvgSizesFromFontSize:function(t,e){var i=this[e].H,s=this[e].W,o=this[e].FONT_SIZE;return{h:t*i/o,w:t*s/o}}});e.a=d},gobI:function(t,e,i){"use strict";var s=i("avvt"),o=i("QNiq"),n=(i("v92f"),{getNormalizedBox:function(t){return n.isOn()&&n.isZoom()?n.getBox(t,n.getRatio()):t&&t.getBoundingClientRect()},getBox:function(t,e){e=e||1;var i=t?t.getBoundingClientRect():{};return{top:i.top*e,left:i.left*e,width:i.width*e,height:i.height*e,bottom:i.bottom*e,right:i.right*e}},getRatio:function(t,e){return e=e||this.getDefaultWidth(),(t=t||window.innerWidth)/e},getMaxWidth:function(){var t=this.getMag();return(t.attributes?t.attributes.opts.scalewidth:t.opts.scalewidth)||1/0},getDefaultWidth:function(){return s.a.prototype.getViewportSetting("width","default")},getMag:function(){return RM.viewerRouter&&RM.viewerRouter.mag||RM.constructorRouter&&RM.constructorRouter.preview&&RM.constructorRouter.preview.mag||RM.constructorRouter&&RM.constructorRouter.mag&&RM.constructorRouter.mag.attributes||{}},isScalableViewer:function(){var t=n.getMag().opts||{};return t&&t.scalableviewer},isAllowed:function(){return n.isDesktopDefault()&&n.isScalableViewer()},isOn:function(t){return t=t||n.getRatio(),n.isAllowed()&&t>1},isZoom:function(){return!Modernizr.firefox},isTransform:function(){return Modernizr.firefox},isDesktopDefault:function(){return o.a.isDesktop&&"default"===n.getMag().viewport},normalize:function(t,e){if(Math.abs(t-1)<1e-6)return 1;if(n.isDesktopDefault()){var i=!e||"zoom"===e&&n.isZoom()||"transform"===e&&n.isTransform();return n.isAllowed()&&i?Math.max(1,t):1}return t}});e.a=n},hQZz:function(t,e,i){"use strict";i.r(e);var s=i("rFsW"),o=i("xi34"),n=i("q1z7"),a=i.n(n),r=i("OTSC"),l=i("Fi5S"),c=i("Vxjr"),h=a.a.View.extend({saveOnDeselect:!1,saveOnDestroy:!1,disabled:!1,initialize:function(t){this.initControl(t)},initControl:function(t){s.a.extend(this,t),s.a.bindAll(this),this.blocks&&(this.block=this.blocks[0])},render:function(){if(!this.rendered){if(this.rendered=!0,this.$container.append(this.$el),this.appearanceAnimation&&r.b.vueTransitionsShow(this.$el,"control"),this.$el.css("top",this.y),this.fromY!==this.y&&(this.$el.css({top:this.fromY}),window.requestAnimationFrame(s.a.bind((function(){this.$el.css({top:this.y})}),this))),this.template){var t=this.template({options:this.options});this.$el.append(t),this.$icon=this.$(".icon"),this.$panel=this.$(".panel"),this.$icon.on("click",this.onClick.bind(this))}return this.bindLogic(),Object(o.a)(window).on("keyup",this.onWindowKeyUp.bind(this)),this.setControlsStatusByBlockData(),this.block&&this.block.on("disabledControls:changed",this.onDisabledControlsChanged.bind(this)),this}},moveToNewPos:function(t){this.$el.css("top",t)},bindLogic:function(){},unBindLogic:function(){},onClick:function(){this.isOnClickDisabled()||(this.selected?this.master.deselect():this.$el.hasClass("disabled")||this.master.select(this))},makeModelSnapshot:function(){this._oldAttrs&&this._oldAttrs._id===this.model.attributes._id||(this._oldAttrs=this.model&&s.a.cloneWithObjects(this.model.attributes))},clearModelSnapshot:function(t){this.saveOnDeselect&&t&&this.canSave()&&this.save(),delete this._oldAttrs},select:function(){this.selected||(this.makeModelSnapshot(),Object(c.a)("controls"),this.selected=!0,this.faded=!1,this.$el.removeClass("fade"),this.$el.addClass("checked"),this.showPanel(),this.$icon.addClass("rmalttext-disable"))},showPanel:function(){r.b.vueTransitionsShow(this.$panel,"panel"),l.a.trigger("panel:showed",this)},hidePanel:function(){return r.b.vueTransitionsHide(this.$panel,"panel")},setEnabled:function(){this.$el.removeClass("disabled"),this.disabled=!1},setDisabled:function(){this.$el.addClass("disabled"),this.disabled=!0,this.selected&&this.master.deselect()},onDisabledControlsChanged:function(){this.setControlsStatusByBlockData()},setControlsStatusByBlockData:function(){this.block&&this.block.disabledControls&&(-1!==this.block.disabledControls.indexOf(this.name)?this.setDisabled():this.setEnabled())},isOnClickDisabled:function(){return this.disabled},fade:function(){this.deselect(),this.faded=!0,this.$el.addClass("fade")},removeFade:function(){this.faded=!1,this.$el.removeClass("fade")},deselect:function(){var t=this.selected;this.selected=!1,this.faded=!1,this.$el.removeClass("fade"),this.$panel&&(this.hidePanel().then(function(){this.$el.removeClass("checked")}.bind(this)),this.$icon.removeClass("rmalttext-disable"),this.clearModelSnapshot(t))},canSave:function(){return this.model&&this._oldAttrs&&!s.a.isEqual(this.model.attributes,this._oldAttrs)&&this.block&&(this.model.isGlobal||!this.block.destroyed)},onEscKey:function(){this.selected&&this.master.deselect()},onEnterKey:function(){},onWindowKeyUp:function(t){t.keyCode===o.a.keycodes.esc&&this.onEscKey(),t.keyCode===o.a.keycodes.enter&&this.onEnterKey()},destroy:function(t){this.saveOnDestroy&&this.canSave()&&this.save(),this.unBindLogic(),Object(o.a)(window).off("keyup",this.onWindowKeyUp.bind(this)),this.block&&this.block.off("disabledControls:changed",this.onDisabledControlsChanged),this.$panel&&this.$panel.remove(),t?r.b.vueTransitionsHide(this.$el,"control").then(function(){this.$el.remove()}.bind(this)):this.$el.remove(),this.destroyed=!0},canControlBeClosed:function(){return!!this.selected&&(this.master.deselect(),!0)},getControlParam:function(t){var e=RM.constructorRouter.mag.edit_params.get("controls");if(e)return e[this.name]&&e[this.name][t]},saveControlParam:function(t){var e=RM.constructorRouter.mag.edit_params.get("controls"),i={};i[this.name]=t,e&&s.a.isEqual(e[this.name],t)||(this.paramsSaveXHR=RM.constructorRouter.mag.edit_params.save("controls",s.a.extend({},e,i)))},updatePanelVerticalPosition:function(){if(this.$panel||!this.$panel.length){var t=this.master.getControlsHeight(),e=this.$panel.height(),i=this.master.getControlRelativePosition(this),s=this.$el.height(),o="";e>=t?o=-Math.ceil((e-t)/2)-i:e/2>i?o=-i:e/2>t-i+s/2&&(o=t-i-e),this.$panel.css("top",o)}},save:function(){}}),d=i("Kx3/"),p=i.n(d),u=i("Kf/z"),g=h.extend({name:"common_layer",className:"control common_layer",BASE_ZINDEX:100,initialize:function(t){this.template=p.a["template-constructor-control-common_layer"],this.initControl(t),this.blocks&&Array.isArray(this.blocks)&&(this.block=this.blocks[0],this.model=this.block.model),t.noInit||(this.selectedModels=s.a.pluck(this.blocks,"model"),this.fixBadZIndexes())},normalizeZIndexes:function(){var t=this.allModels,e=this.BASE_ZINDEX,i=!1;return Object(s.a)(t).chain().sortBy((function(t){return t.get("z")})).each((function(t){var s=t.get("z"),o=e++;t.set("z",o,{first:!0}),s!==o&&(i=!0)})).value(),i},fixBadZIndexes:s.a.debounce((function(){if(!Object(u.a)("constructor.zIndex")){this.allModels=Object(s.a)(this.master.workspace.blocks).chain().filter((function(t){return!t.outofbox})).pluck("model").map((function(t){return s.a.isNumber(t.get("z"))||t.set("z",this.BASE_ZINDEX),t}),this).value();var t=this.moveToFixLayers(1,{fixOnlyBad:!0}),e=this.moveToAboveAllLayers(),i=this.normalizeZIndexes();(t||i||e)&&this.save({silent:!0,skipHistory:!0})}}),10),moveToFixLayers:function(t,e){var i=!1,o=s.a.filter(this.allModels,(function(t){return!t.get("fixed_position")&&!t.get("hidden")&&!t.get("is_above")}));if(!s.a.isEmpty(o)){var n=s.a.min(o,(function(t){return t.get("z")})).get("z"),a=s.a.max(o,(function(t){return t.get("z")})).get("z"),r=0;s.a.filter(this.allModels,(function(t){return t.get("fixed_position")}));return s.a.chain(this.allModels).filter((function(e){return e.get("fixed_position")&&(t>0?e.get("z")>n:e.get("z")<a)})).sortBy((function(t){return t.get("z")})).each((function(s){if(!(e&&e.fixOnlyBad&&(s.get("z")<n||s.get("z")>a))){var o=t>0?1e4:-1e4;if(e&&e.fixOnlyBad){var l=(t>0?a:n)+1e-4*++r*(t>0?1:-1);s.set("z",l,{first:!0})}else s.set("z",o+s.get("z"),{first:!0});i=!0}})),i}},moveToAboveAllLayers:function(){var t=[],e=s.a.filter(this.allModels,(function(t){return!t.get("is_above")&&!t.get("hidden")}));s.a.filter(this.allModels,(function(t){return t.get("is_above")&&!t.get("hidden")}));if(!s.a.isEmpty(e)){var i=s.a.max(e,(function(t){return t.get("z")})).get("z");return s.a.chain(this.allModels).filter((function(t){return t.get("is_above")&&t.get("z")<i})).each((function(e){e.set("z",2e4+e.get("z"),{first:!0}),t.push(e)})),s.a.isEmpty(t)||s.a.chain(this.allModels).filter((function(e){return e.get("is_above")&&-1==t.indexOf(e)})).each((function(t){t.set("z",2e4+t.get("z"),{first:!0})})),!s.a.isEmpty(t)}},restrictions:function(t){return t.getSelectableBlocks().length>1},select:function(){h.prototype.select.apply(this,arguments),Object(c.a)("controls-common_layer")},bindLogic:function(){this.$panel.on("click",".forward",this.forward),this.$panel.on("click",".backward",this.backward),this.$panel.on("click",".forward-all",this.forwardAll),this.$panel.on("click",".backward-all",this.backwardAll),RM.constructorRouter.bindGlobalKeyPress([{key:"[",handler:this.backward,optionKeys:Modernizr.mac?"meta":"ctrl"},{key:"]",handler:this.forward,optionKeys:Modernizr.mac?"meta":"ctrl"},{key:"[",handler:this.backwardAll,optionKeys:Modernizr.mac?["alt","meta"]:["alt","ctrl"]},{key:"]",handler:this.forwardAll,optionKeys:Modernizr.mac?["alt","meta"]:["alt","ctrl"]}])},unBindLogic:function(){this.$panel.off("click",".forward",this.forward),this.$panel.off("click",".backward",this.backward),this.$panel.off("click",".forward-all",this.forwardAll),this.$panel.off("click",".backward-all",this.backwardAll),RM.constructorRouter.unbindGlobalKeyPress("[",this.backward),RM.constructorRouter.unbindGlobalKeyPress("]",this.forward),RM.constructorRouter.unbindGlobalKeyPress("[",this.backwardAll),RM.constructorRouter.unbindGlobalKeyPress("]",this.forwardAll)},forward:function(t){RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","bring forward"),Object(u.a)("constructor.zIndex")?(RM.constructorRouter.indexController.moveWidget(this.master.workspace.page,this.selectedModels,1),this.save()):this._move(1)},backward:function(t){RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","bring backward"),Object(u.a)("constructor.zIndex")?(RM.constructorRouter.indexController.moveWidget(this.master.workspace.page,this.selectedModels,-1),this.save()):this._move(-1)},forwardAll:function(t){RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","send to front"),Object(u.a)("constructor.zIndex")?(RM.constructorRouter.indexController.moveWidget(this.master.workspace.page,this.selectedModels,999),this.save()):this._move(999,!0)},backwardAll:function(t){RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","send to back"),Object(u.a)("constructor.zIndex")?(RM.constructorRouter.indexController.moveWidget(this.master.workspace.page,this.selectedModels,-999),this.save()):this._move(-999,!0)},_getBlocks:function(){var t={},e={};return{groupLayers:e,blocks:Object(s.a)(this.master.workspace.blocks).chain().filter((function(t){return"background"!=t.model.get("type")})).sortBy((function(t){return t.model.get("z")})).reduce((function(e,i){var s=i.model.get("pack_id");return s?t[s]?t[s].push(i):(t[s]=[i],e.push(t[s])):e.push(i),e}),[]).reduce((function(t,i){for(var s=t[t.length-1],o=i;s instanceof Array;)s=s[s.length-1];for(;o instanceof Array;)o=o[o.length-1];return!s||!!s.model.get("is_above")==!!o.model.get("is_above")&&!!s.model.get("fixed_position")==!!o.model.get("fixed_position")?(s||(o.model.get("is_above")?e.above_all=t[t.length-1]:o.model.get("fixed_position")?e.regular?e.fixed_top=t[t.length-1]:e.fixed_bottom=t[t.length-1]:e.regular=t[t.length-1]),t[t.length-1].push(i)):(t.push([i]),o.model.get("is_above")?e.above_all=t[t.length-1]:o.model.get("fixed_position")?e.regular?e.fixed_top=t[t.length-1]:e.fixed_bottom=t[t.length-1]:e.regular=t[t.length-1]),t}),[[]]).value(),packs:t}},_getBlockGroup:function(t,e){if(-1!=t.indexOf(e))return t;var i=null;return s.a.each(t,(function(t){t instanceof Array&&(i=i||this._getBlockGroup(t,e))}),this),i},_recalcZindex:function(t){var e=s.a.flatten(t),i=100,o=[];return s.a.each(e,(function(t){t.model.get("z")!=i&&(t.model.set("z",i),o.push({_id:t.model.get("_id"),z:i})),i++})),o},_checkForMovedGroup:function(t,e){if(!t.model.get("pack_id"))return t;var i=this._getBlockGroup(e,t),o=!0;return s.a.each(i,(function(t){o=o&&t.selected})),o?i:t},_move:function(t,e){for(var i=this._getBlocks(),o=i.blocks,n=i.packs,a=[],r=s.a.chain(this.blocks.slice()).sortBy((function(t){return t.model.get("z")})).reduce((function(t,e,i){if(-1!==a.indexOf(e))return t;a.push(e);var o=e.model.get("pack_id");if(o){var r=!0;s.a.each(n[o],(function(t){r=r&&t.selected})),r?(t.push(n[o]),a=a.concat(n[o])):t.push(e)}else t.push(e);return t}),[]).value();r&&r.length;){var l=r[0],c=this._getBlockGroup(o,l),h=s.a.reduce(c,(function(t,e,i){return-1!=r.indexOf(e)&&c[i-1]&&-1!=r.indexOf(c[i-1])?t[t.length-1].push(e):-1!=r.indexOf(e)&&t.push([e]),t}),[[]]),d=s.a.find(h,(function(t){return-1!=t.indexOf(l)})),p=c.indexOf(d[0]);c.splice(p,d.length);var u=p+t;u<0&&(c==i.groupLayers.fixed_top?(i.groupLayers.fixed_bottom||(i.groupLayers.fixed_bottom=[],o.splice(0,0,i.groupLayers.fixed_bottom)),c=i.groupLayers.fixed_bottom,u=e?0:c.length):u=0),u>c.length&&(c==i.groupLayers.fixed_bottom?(i.groupLayers.fixed_top||(i.groupLayers.fixed_top=[],i.groupLayers.above_all?o.splice(o.length-1,0,i.groupLayers.fixed_top):o.push(i.groupLayers.fixed_top)),c=i.groupLayers.fixed_top,u=e?c.length:0):u=c.length),Array.prototype.splice.apply(c,[u,0].concat(d)),r=s.a.difference(r,d)}this.allModels=this._recalcZindex(o),this.save()},save:function(t){var e=(t=t||{}).success;t.success=s.a.bind((function(t){this._saving=!1,e&&e(t),this._saveOptions&&(this.save(this._saveOptions),this._saveOptions=null)}),this),this._saving?this._saveOptions=t:(t.skipInitial=!0,this._saving=!0,Object(u.a)("constructor.zIndex")?this.master.workspace.page.save(null,t):this.master.workspace.save_group(this.allModels,t))}}),m=i("j6/F"),f=i.n(m),v=h.extend({name:"common_align",className:"control common_align",initialize:function(t){this.template=f.a["template-constructor-control-common_align"],this.initControl(t)},select:function(){h.prototype.select.apply(this,arguments),Object(c.a)("controls-common_align")},bindLogic:function(){this.$panel.on("click","div",this.storeFixed),this.$panel.on("click",".left",this.left),this.$panel.on("click",".top",this.top),this.$panel.on("click",".bottom",this.bottom),this.$panel.on("click",".right",this.right),this.$panel.on("click",".center",this.center),this.$panel.on("click",".middle",this.middle),this.$panel.on("click","div",this.restoreFixed)},storeFixed:function(){s.a.invoke(this.blocks,"storeFixedPosition")},restoreFixed:function(){s.a.invoke(this.blocks,"restoreFixedPosition"),this.master.workspace.save_group(s.a.pluck(this.blocks,"model"))},setParam:function(t,e){var i=s.a.map(this.blocks,(function(i){var o={_id:i.model.id};return o[t]=s.a.isFunction(e)?e(i):e,o}));this.master.workspace.set_group(i)},restrictions:function(t){var e=t.getSelectedBlocks().length>1,i=Object(s.a)(t.getSelectedBlocks()).chain().map((function(t){return t.model.get("fixed_position")})).compact().uniq().value().length<=1;return e&&i},getPacksDimensions:function(t){var e={},i=1===s.a.chain(t).map((function(t){return t.model.get("pack_id")})).uniq().value().length;return s.a.each(t,(function(t){var s=t.model.get("pack_id");if(s&&!i){e[s]=e[s]||{t:Number.POSITIVE_INFINITY,l:Number.POSITIVE_INFINITY,b:Number.NEGATIVE_INFINITY,r:Number.NEGATIVE_INFINITY};var o=e[s],n=t.getBoxData({includeBoundingBox:!0});o.t=Math.min(o.t,n.bb_y),o.l=Math.min(o.l,n.bb_x),o.b=Math.max(o.b,n.bb_y+n.bb_h),o.r=Math.max(o.r,n.bb_x+n.bb_w)}})),s.a.each(e,(function(t){t.x=t.l,t.y=t.t,t.w=t.r-t.l,t.h=t.b-t.t,delete t.t,delete t.l,delete t.b,delete t.r})),e},top:function(t){var e=this.getPacksDimensions(this.blocks),i=Math.min.apply(null,s.a.map(this.blocks,(function(t){var i=t.model.get("pack_id")&&e[t.model.get("pack_id")],s=t.getBoxData({includeBoundingBox:!0});return i?i.y:s.bb_y})));this.setParam("y",(function(t){var s=t.model.get("pack_id")&&e[t.model.get("pack_id")],o=t.getBoxData({includeBoundingBox:!0});return s?o.y+(i-s.y):i-(o.bb_y-o.y)}))},left:function(t){var e=this.getPacksDimensions(this.blocks),i=Math.min.apply(null,s.a.map(this.blocks,(function(t){var i=t.model.get("pack_id")&&e[t.model.get("pack_id")],s=t.getBoxData({includeBoundingBox:!0});return i?i.x:s.bb_x})));this.setParam("x",(function(t){var s=t.model.get("pack_id")&&e[t.model.get("pack_id")],o=t.getBoxData({includeBoundingBox:!0});return s?o.x+(i-s.x):i-(o.bb_x-o.x)}))},right:function(t){var e=this.getPacksDimensions(this.blocks),i=Math.max.apply(null,s.a.map(this.blocks,(function(t){var i=t.model.get("pack_id")&&e[t.model.get("pack_id")],s=t.getBoxData({includeBoundingBox:!0});return i?i.x+i.w:s.bb_x+s.bb_w})));this.setParam("x",(function(t){var s=t.model.get("pack_id")&&e[t.model.get("pack_id")],o=t.getBoxData({includeBoundingBox:!0});return s?o.x+(i-s.w-s.x):i-(o.bb_w-(o.bb_w-o.w)/2)}))},bottom:function(t){var e=this.getPacksDimensions(this.blocks),i=Math.max.apply(null,s.a.map(this.blocks,(function(t){var i=t.model.get("pack_id")&&e[t.model.get("pack_id")],s=t.getBoxData({includeBoundingBox:!0});return i?i.y+i.h:s.bb_y+s.bb_h})));this.setParam("y",(function(t){var s=t.model.get("pack_id")&&e[t.model.get("pack_id")],o=t.getBoxData({includeBoundingBox:!0});return s?o.y+(i-s.h-s.y):i-(o.bb_h-(o.bb_h-o.h)/2)}))},middle:function(t){var e=this.getPacksDimensions(this.blocks),i=s.a.map(this.blocks,(function(t){var i=t.model.get("pack_id")&&e[t.model.get("pack_id")],s=t.getBoxData({includeBoundingBox:!0});return i?i.y+i.h/2:s.bb_y+s.bb_h/2})),o=i[Math.floor(i.length/2)];this.setParam("y",(function(t){var i=t.model.get("pack_id")&&e[t.model.get("pack_id")],s=t.getBoxData({includeBoundingBox:!0});return i?s.y+(o-i.h/2-i.y):o-s.h/2}))},center:function(t){var e=this.getPacksDimensions(this.blocks),i=0,o=0,n=s.a.map(this.blocks,(function(t,s){var n=t.model.get("pack_id")&&e[t.model.get("pack_id")],a=t.getBoxData({includeBoundingBox:!0}),r=n?n.w:a.bb_w;return(t.isFullWidth()||r>i)&&(i=r,o=s),n?n.x+n.w/2:a.bb_x+a.bb_w/2}))[o];this.setParam("x",(function(t){var i=t.model.get("pack_id")&&e[t.model.get("pack_id")],s=t.getBoxData({includeBoundingBox:!0});return i?s.x+(n-i.w/2-i.x):n-s.w/2}))}}),b=h.extend({MIN_PANEL_HEIGHT:100,MAX_PANEL_HEIGHT:672,PANEL_MARGIN:20,SCROLL_GAP_START:16,SCROLL_GAP_END:16,render:function(){this.panelSizes={resizable:this.getControlParam("height")||this.MIN_PANEL_HEIGHT},h.prototype.render.apply(this,arguments),this.$el.addClass("control-resizable"),this.resizableScroll=Object(o.a)(this.$el.find(".resizable-scroll-wrapper")).RMScroll({$container:this.$el.find(".resizable-content-wrapper"),$content:this.$el.find(".resizable-content"),$handle:this.$el.find(".resizable-scroll"),wheelScrollSpeed:.4,gap_start:this.SCROLL_GAP_START,gap_end:this.SCROLL_GAP_END,onScroll:this.onPanelScroll}).data("scroll"),this.__scrollRecalc_debounced=s.a.debounce(s.a.bind((function(){this.resizableScroll.recalc(),this.onScrollRecalc("control-resize")}),this),300),Object(o.a)(this.$(".resize-handle-top")).RMDrag({start:this.startHandleDrag,move:this.moveHandleDrag,end:this.endHandleDrag,silent:!0,preventDefault:!0}),Object(o.a)(this.$(".resize-handle-bottom")).RMDrag({start:this.startHandleDrag,move:this.moveHandleDrag,end:this.endHandleDrag,silent:!0,preventDefault:!0}),this.updatePanelHeight()},onResize:function(t){this.updatePanelHeight()},updatePanelHeight:function(t){if(!this.destroyed){if(t=t||this.panelSizes[this.fixedPanelSize?"fixed":"resizable"],!this.fixedPanelSize){var e=2*Math.ceil(this.MIN_PANEL_HEIGHT/2),i=2*Math.ceil(this.MAX_PANEL_HEIGHT/2),s=Object(o.a)(window).height()-2*this.PANEL_MARGIN,n=2*Math.ceil(s/2);t=Math.max(t,e),t=Math.min(t,i),t=Math.min(t,n)}if(this.$panel.height(t),this.panelSizes[this.fixedPanelSize?"fixed":"resizable"]=t,this.fixedPanelSize)this.$panel.css("top",-Math.ceil((t-this.master.ICON_HEIGHT)/2));else{var a=parseInt(this.$el.css("top"));this.$panel.css("top",-Math.ceil(t/2)-a)}this.fixedPanelSize||this.__scrollRecalc_debounced&&this.__scrollRecalc_debounced()}},startHandleDrag:function(t){var e=Object(o.a)(t.currentTarget);this.resizeParams={$handle:e,dir:e.hasClass("resize-handle-top")?-1:1,initial_h:this.panelSizes.resizable},e.addClass("dragging"),this.$panel.addClass("no-transitions")},moveHandleDrag:function(t){var e=this.resizeParams.initial_h+t.deltaY*this.resizeParams.dir*2;this.updatePanelHeight(e),this.resizableScroll&&this.resizableScroll.recalc(),this.onScrollRecalc("control-resize")},endHandleDrag:function(t){this.resizeParams.$handle.removeClass("dragging"),this.$panel.removeClass("no-transitions")},toggleFixedPanelSize:function(t,e){this.fixedPanelSize=t,this.$(".resize-handle-top").toggle(!t),this.$(".resize-handle-bottom").toggle(!t),this.updatePanelHeight(t?e:this.panelSizes.resizable)},onScrollRecalc:function(t){},onPanelScroll:function(){},select:function(){h.prototype.select.apply(this,arguments),this.resizableScroll&&this.resizableScroll.recalc(),this.onScrollRecalc("control-show"),this.resizeScrollBinded||(Object(o.a)(window).on("resize",this.onResize),this.resizeScrollBinded=!0)},deselect:function(){h.prototype.deselect.apply(this,arguments),this.$panel&&(this.panelSizes.resizable!=this.getControlParam("height")&&this.saveControlParam({height:this.panelSizes.resizable}),Object(o.a)(window).off("resize",this.onResize),this.resizeScrollBinded=!1)},destroy:function(){this.panelSizes.resizable!=this.getControlParam("height")&&this.saveControlParam({height:this.panelSizes.resizable}),Object(o.a)(window).off("resize",this.onResize),this.resizeScrollBinded=!1,h.prototype.destroy.apply(this,arguments)}}),_=i("fsTk"),w=i.n(_),y=i("roQd"),k=i("onY4"),C=i("q7tt"),x=i("q5gH"),S=i("wHgl"),P=i.n(S),$=C.a.extend({controls:[],initialize:function(t){s.a.extend(this,t),this.uuid=t.uuid,this.isStandalone=!0,this.proportional=!0,this.resizeFromCenter=!0,this.addButtonTemplate=P.a["template-constructor-helpers-animation_steps_add_button"],this.frameClass=x.a.extend({minwidth:0,minheight:0}),this.initBlock(this.model,this.workspace)},render:function(){this.create(),this.$el.addClass("animation-step"),this.$mainContent=this.$(".content"),this.$addButton=Object(o.a)(this.addButtonTemplate()),this.$addButton.find('.effect-popup-item[data-value="use_rotate"]').toggle(!this.hideRotateEffect),this.$addButton.on("click",".effect-popup-item",this.addStepWithEffectClick),this.$el.append(this.$addButton),this.$mainContent.addClass("main-content")},addStepWithEffectClick:function(t){this.trigger("add-step",Object(o.a)(t.currentTarget).attr("data-value")),t.stopPropagation()},select:function(){C.a.prototype.select.apply(this,arguments),this.updateAddButtonPos()},setContent:function(t){this.$innerContent=t,this.$innerContent.addClass("fantoms"),this.$mainContent.html(this.$innerContent),this.redrawOpacity(),this.redrawScale()},show:function(){this.$el.show()},hide:function(){this.$el.hide()},onClick:function(){this.selected||this.select()},flashTransitions:function(){clearTimeout(this.flashTransitionsTimeout),this.$el.addClass("animation-transitions"),this.flashTransitionsTimeout=setTimeout(s.a.bind((function(){this.$el.removeClass("animation-transitions")}),this),200)},redrawOpacity:function(){this.$innerContent&&this.$innerContent.css({opacity:this.model.get("opacity")/100})},redrawScale:function(){this.$innerContent&&r.b.applyTransform(this.$innerContent,100==this.model.get("scale")?"":"scale("+this.model.get("scale")/100+")")},updateAddButtonPos:function(){if(this.selected&&this.$addButton){var t=RM.constructorRouter.zoom.getZoom(),e=s.a.extend({},this.latestPosSizeAngle,{width:this.latestPosSizeAngle.width*t,height:this.latestPosSizeAngle.height*t}),i=e.height+18,n=e.width/2,a=e.height/2,l=a-i,c=n+e.sinAngle*l;i=a-e.cosAngle*l,this.$addButton.css({left:Math.round(c),top:Math.round(i),zoom:1/RM.constructorRouter.zoom.getZoom()}),r.b.applyTransform(this.$addButton,"");var h=this.$addButton.offset(),d=h.top+15,p=h.left+15,u=0,g=0,m=Object(o.a)(window).height(),f=Object(o.a)(window).width();d<32?u=d-32:d>m-32&&(u=d-(m-32)),p<32?g=p-32:p>f-32&&(g=p-(f-32)),(u||g)&&r.b.applyTransform(this.$addButton,"translate("+Math.round(-g)+"px, "+Math.round(-u)+"px)")}},updateAddButtonPopupPos:function(){if(this.$addButton&&this.selected){var t=this.$addButton.offset(),e=t.top+15,i=t.left+15,s=Object(o.a)(window).height(),n=Object(o.a)(window).width(),a=this.$addButton.find(".effect-popup"),r=a.height(),l=a.width();a.css("margin-top","").find(".corner-wrapper").css("margin-top",""),i>12+l/2&&i<n-l/2?e>12+r+15+15?a.attr("data-pos","top"):a.attr("data-pos","bottom"):(i<n/2?a.attr("data-pos","right"):a.attr("data-pos","left"),e<r/2+12&&a.css("margin-top",r/2+12-e).find(".corner-wrapper").css("margin-top",-(r/2+12-e)),e>s-(r/2+12)&&a.css("margin-top",-(e-s+r/2+12)).find(".corner-wrapper").css("margin-top",e-s+r/2+12))}},css:function(){C.a.prototype.css.apply(this,arguments),this.updateAddButtonPos()},redraw:function(){this.$mainContent&&(this.redrawOpacity(),this.redrawScale(),C.a.prototype.redraw.apply(this,arguments))}}),O=a.a.View.extend({className:"animation-steps-container",StepModel:a.a.Model.extend({save:function(){return this.set.apply(this,arguments),null},sync:function(){return null},getViewport:function(){return self.blocks[0].model.getViewport()},getAnimations:function(){return[]}}),initialize:function(t){s.a.bindAll(this),s.a.extend(this,t),this.someModel=this.blocks[0].model,this.workspace.switchOnAnimationMode(this),this.$el.appendTo(this.workspace.$el.children().first()),this.$workspaceScroll=this.workspace.$el.parent(),Object(o.a)(this.$el).drag("start",(function(t){t.stopPropagation()})),this.$stepsLinesWrapper=Object(o.a)('<div class="steps-lines-wrapper">'),this.$el.append(this.$stepsLinesWrapper),this.$previewAnimator=Object(o.a)('<div class="preview-animator">'),this.$el.append(this.$previewAnimator),this.popupManager.addPopup({$parent:this.$el,name:"add-step-selector",selector:".block .add-button",popupSelector:".block .add-button .effect-popup",cbOpen:function(t){this.currentStep&&this.currentStep.updateAddButtonPopupPos(),s.a.each(this.blocks,(function(e){e.trigger("animation:stepsPopup:open",t)}))}.bind(this),cbClose:function(){s.a.each(this.blocks,(function(t){t.trigger("animation:stepsPopup:closed")}))}.bind(this)}),this.updateContainerDims(),this.updateFantoms(),this.updateSteps(),s.a.each(this.blocks,(function(t){t.toggleAnimationMode(!0)})),this.$previewAnimator.css({visibility:"hidden"}),this.isPreviewMode=!1,Object(o.a)(window).on("resize",this.onResize),this.$workspaceScroll.on("scroll",this.onWorkspaceScroll)},startPreviewMode:function(){this.isPreviewMode||(this.isPreviewMode=!0,this.$previewAnimator.css({visibility:"inherit"}),this.$stepsLinesWrapper.css({visibility:"hidden"}),this.updatePreviewMode({immediate:!0}))},updatePreviewMode:function(t){if(t=t||{},this.isPreviewMode){var e=this;clearTimeout(this.updatePreviewModeTimeout),t.immediate?i():this.updatePreviewModeTimeout=setTimeout(i,500)}function i(){e.previewTimeline&&e.previewTimeline.destroy();var t,i=y.a.getNormalizedAnimation(e.uuid?e.someModel.getAnimations().find((function(t){return t.UUID===e.uuid})):e.someModel.getAnimations()[0],e.isFixed,e.isFullwidth,e.isFullheight,1),s=!0;for(t=0;t<i.steps.length;t++){var o=i.steps[t];if(o.use_scale&&(0==t&&o.from_scale>100||o.scale>100)){s=!1;break}}e.previewTimeline=y.a.createAnimationTimeline({el:e.$previewAnimator,steps:i.steps,type:i.type,force3d:s,loop:y.a.normalizeLoopValue(i.loop),animationTrigger:i.trigger,screenshotMode:!1}),"scroll"!=i.type?e.previewTimeline.play():e.onWorkspaceScroll()}},stopPreviewMode:function(){this.isPreviewMode&&(this.isPreviewMode=!1,this.$previewAnimator.css({visibility:"hidden"}),this.$stepsLinesWrapper.css({visibility:"inherit"}),this.previewTimeline&&this.previewTimeline.destroy())},togglePreviewMode:function(){this.isPreviewMode?this.stopPreviewMode():this.startPreviewMode()},onWorkspaceScroll:function(){var t=this;if(this.currentStep&&this.currentStep.updateAddButtonPos(),this.previewTimeline&&this.isPreviewMode){var e=this.uuid?this.someModel.getAnimations().find((function(e){return e.UUID===t.uuid})):this.someModel.getAnimations()[0];if("scroll"===e.type&&e){var i=Math.max(0,this.$workspaceScroll.scrollTop());if(this.isFixed)this.previewTimeline.seek(i);else{var s=this.baseDimensions.top,o=s-this.$workspaceScroll.height(),n={top:1,center:.5,bottom:0}[e.steps[0].start_point||"bottom"]*(s-o)+o+e.steps[0].start_offset||0;n<=0?this.previewTimeline.seek(i):this.previewTimeline.seek(Math.max(0,i-n))}}}},updateContainerDims:function(){var t;s.a.each(this.blocks,(function(e){var i=e.getBoxData({includeBoundingBox:!0,checkFixedPosition:!0});(t=t||{t:Number.POSITIVE_INFINITY,l:Number.POSITIVE_INFINITY,b:Number.NEGATIVE_INFINITY,r:Number.NEGATIVE_INFINITY}).t=Math.min(t.t,i.bb_y),t.l=Math.min(t.l,i.bb_x),t.b=Math.max(t.b,i.bb_y+i.bb_h),t.r=Math.max(t.r,i.bb_x+i.bb_w)}),this),this.baseDimensions={left:t.l+(this.isFixed?this.workspace.position.left:0),top:t.t+(this.isFixed?this.workspace.position.top:0),width:t.r-t.l,height:t.b-t.t},this.$el.css({width:t.r-t.l,height:t.b-t.t,position:this.isFixed?"fixed":"absolute"}),this.$previewAnimator.css(this.baseDimensions)},createStep:function(t){t=t||{};var e=new $({model:new this.StepModel,workspace:this.workspace,constraintHorzMove:this.isFullwidth,constraintVertMove:this.isFullheight,hideRotateEffect:this.isFullwidth||this.isFullheight,$standaloneContainer:this.$stepsLinesWrapper}),i=this;return e.on("select",(function(){if(i.currentStep=this,i.steps)for(var t=0;t<=i.steps.length;t++){var e=i.$lines&&i.$lines[t]&&i.$lines[t].find("line"),s=t==i.steps.length?i.initialStep:i.steps[t];this!=s?(s.deselect(),e&&e.attr("stroke-dasharray","4,2")):(i.isIndirectSelect||i.trigger("select","initial"==s.model.get("id")?0:s.model.get("id")),e&&e.removeAttr("stroke-dasharray"))}})),e.model.set({id:t.id,is_locked:"initial"==t.id}),e.render(),e.setContent(this.getFantom()),"initial"!=t.id&&e.on("move",s.a.bind((function(t){this.trigger("move",{id:e.model.get("id"),dx:Math.round(t.left-this.baseDimensions.left+(t.width-this.baseDimensions.width)/2),dy:Math.round(t.top-this.baseDimensions.top+(t.height-this.baseDimensions.height)/2)}),this.updateSteps({exceptStep:e})}),this)),e.on("resize",s.a.bind((function(i){"initial"==t.id?this.trigger("scale",{id:0,from_scale:Math.round(100*i.width/this.baseDimensions.width)}):this.trigger("scale",{id:e.model.get("id"),scale:Math.round(100*i.width/this.baseDimensions.width)}),e.model.set({scale:100*i.width/this.baseDimensions.width},{silent:!0}),e.redrawScale(),this.updateSteps({exceptStep:e})}),this)),e.on("add-step",s.a.bind((function(t){this.trigger("add-step",{after_step:e.model.get("id"),use_effect:t}),this.popupManager.closePopup("add-step-selector")}),this)),e},setStepModel:function(t,e){var i=this.baseDimensions,s=i.width*e.scale/100,o=i.height*e.scale/100;t.model.set({x:i.left+i.width/2+e.dx-s/2,y:i.top+i.height/2+e.dy-o/2,w:s,h:o,z:1,angle:e.rotate,opacity:e.opacity,scale:e.scale,aspect:i.width/i.height},{silent:!0}),t.redraw(t.model)},getFantom:function(t){var e=t?t.$el.clone():this.$fantoms.clone();t&&"picture"==t.model.get("type")&&t.model.get("picture")&&t.model.get("picture").unscaledUrl&&e.find(".content div").css("background-image","url("+t.model.get("picture").unscaledUrl+")");var i=[];if(e.find("defs mask, defs clippath").each((function(){i.push(Object(o.a)(this).attr("id"))})),t&&"hotspot"==t.model.get("type")&&e.find(".tip").remove(),e.find(".size-tool").remove(),i.length){for(var s=e[0].outerHTML,n=0;n<i.length;n++){var a=r.b.generateUUID(),l=new RegExp("("+r.b.escapeSpecial(i[n],!1)+")","g");s=s.replace(l,a)}e=Object(o.a)(s)}return e},updateFantoms:function(){this.$fantoms&&this.$fantoms.remove(),this.$fantoms=Object(o.a)("<div>").css({position:"relative",left:0,top:0,width:this.baseDimensions.width,height:this.baseDimensions.height}),s.a.each(this.blocks,s.a.bind((function(t){var e=this.getFantom(t);e.find(".frameborder").remove(),e.removeClass("animation-mode"),this.isFixed?e.css({position:"absolute",left:"50%",top:"50%",bottom:"",right:"","margin-left":-t.model.get("w")/2,"margin-top":-t.model.get("h")/2}):e.css({left:"-="+this.baseDimensions.left,top:"-="+this.baseDimensions.top}),this.$fantoms.append(e)}),this)),this.$previewAnimator.html(this.getFantom())},updateSteps:function(t){var e=this;this.updateLines(),t=t||{};var i=y.a.getNormalizedAnimation(this.uuid?this.someModel.getAnimations().find((function(t){return t.UUID===e.uuid})):this.someModel.getAnimations()[0],this.isFixed,this.isFullwidth,this.isFullheight,1);this.initialStep=this.initialStep||this.createStep({id:"initial"}),0===t.animateStepInd&&this.initialStep.flashTransitions(),t.exceptStep!=this.initialStep&&this.setStepModel(this.initialStep,{dx:0,dy:0,opacity:i.steps[0].from_opacity,rotate:i.steps[0].from_rotate,scale:i.steps[0].from_scale}),this.steps=this.steps||[];for(var s=0;s<i.steps.length;s++)this.steps[s]=this.steps[s]||this.createStep({id:s}),null!=t.animateStepInd&&t.animateStepInd<=s&&this.steps[s].flashTransitions(),t.exceptStep!=this.steps[s]&&this.setStepModel(this.steps[s],i.steps[s]);for(s=i.steps.length;s<this.steps.length;s++)this.steps[s].model.destroy(),this.steps[s].destroy(),this.steps[s].off();this.steps.length=i.steps.length},updateLines:function(){var t=this,e=0,i=0;this.$lines=this.$lines||[];for(var s=y.a.getNormalizedAnimation(this.uuid?this.someModel.getAnimations().find((function(e){return e.UUID===t.uuid})):this.someModel.getAnimations()[0],this.isFixed,this.isFullwidth,this.isFullheight,1),n=0;n<s.steps.length;n++){this.$lines[n]||(this.$lines[n]=Object(o.a)('<svg class="step-line"><line /></svg>'),this.$lines[n].appendTo(this.$stepsLinesWrapper));var a=s.steps[n],r=this.$lines[n].find("line").get(0),l=this.baseDimensions.width/2+e,c=this.baseDimensions.height/2+i,h=this.baseDimensions.width/2+a.dx,d=this.baseDimensions.height/2+a.dy,p=Math.abs(l-h)+8,u=Math.abs(c-d)+8;this.$lines[n].css({width:p,height:u,left:this.baseDimensions.left+Math.min(l,h)-4,top:this.baseDimensions.top+Math.min(c,d)-4}),this.$lines[n].show(),r.setAttributeNS(null,"x1",4),r.setAttributeNS(null,"x2",p-4),l<h&&c<d||l>h&&c>d?(r.setAttributeNS(null,"y1",4),r.setAttributeNS(null,"y2",u-4)):(r.setAttributeNS(null,"y1",u-4),r.setAttributeNS(null,"y2",4)),e=a.dx,i=a.dy}for(n=s.steps.length;n<this.$lines.length;n++)this.$lines[n].hide()},selectStep:function(t){this.isIndirectSelect=!0,this.steps[t].select(),this.isIndirectSelect=!1},moveSelected:function(t,e){var i=s.a.filter(s.a.union(this.steps,this.initialStep),(function(t){return!t.isLocked()&&t.selected}));if(!s.a.isEmpty(i)&&!(this.isFullwidth&&Object(s.a)(["left","right"]).contains(e)||this.isFullheight&&Object(s.a)(["up","down"]).contains(e))){var o=t.shiftKey?10:1,n=RM.constructorRouter.gg.snap;RM.constructorRouter.gg.snap=!1;var a={deltaY:0,deltaX:0};switch(e){case"up":a.deltaY=-o;break;case"right":a.deltaX=o;break;case"down":a.deltaY=o;break;case"left":a.deltaX=-o}$.prototype.moveBlocks(null,i,a),RM.constructorRouter.gg.snap=n,t.stopPropagation(),t.preventDefault()}},removeSelected:function(){var t=s.a.filter(s.a.union(this.steps,this.initialStep),(function(t){return t.selected}));s.a.isEmpty(t)||this.trigger("remove-step",t[0].model.get("id"))},onResize:function(){(this.isFullwidth||this.isFullheight||this.isFixed||this.isSticked)&&(this.updateContainerDims(),this.updateSteps()),this.isFullwidth&&(clearTimeout(this.updateFantomsTimer),this.updateFantomsTimer=setTimeout(s.a.bind((function(){this.updateFantoms(),this.initialStep.setContent(this.getFantom());for(var t=0;t<this.steps.length;t++)this.steps[t].setContent(this.getFantom())}),this),100)),this.onWorkspaceScroll()},destroy:function(){if(this.stopPreviewMode(),s.a.each(this.blocks,(function(t){t.toggleAnimationMode(!1)})),this.$fantoms&&this.$fantoms.remove(),this.initialStep&&(this.initialStep.model.destroy(),this.initialStep.destroy(),this.initialStep.off()),this.steps)for(var t=0;t<this.steps.length;t++)this.steps[t].model.destroy(),this.steps[t].destroy(),this.steps[t].off();this.remove(),this.workspace.switchOffAnimationMode(),Object(o.a)(window).off("resize",this.onResize),this.$workspaceScroll.off("scroll",this.onWorkspaceScroll)}}),T=b.extend({name:"common_animation",className:"control common_animation_single",MIN_PANEL_HEIGHT:472,MAX_PANEL_HEIGHT:640,DISABLED_HEIGHT:88,DISABLED_HEIGHT_RESET:112,MESSAGE_MIXED_HEIGHT:128,MESSAGE_MULTIPLE_HEIGHT:112,MESSAGE_NON_ANIMATABLE_HEIGHT:96,MESSAGE_UNITE_HEIGHT:160,DEFAULT_ANIMATION_STEP:{duration:.5,delay:0,speed:1,delay_px:0,dx:void 0,dy:void 0,opacity:void 0,rotate:void 0,scale:void 0,acceleration:"none",start_point:"bottom",start_offset:0,from_opacity:0,from_rotate:0,from_scale:100,use_move:!1,use_opacity:!1,use_rotate:!1,use_scale:!1},PRESETS:{"fade-and-scale":{loop:!1,selected:0,steps:[{duration:1.2,delay:0,speed:1,delay_px:0,opacity:100,scale:100,acceleration:"ease-out",start_point:"bottom",start_offset:0,from_opacity:0,from_rotate:0,from_scale:80,use_move:!1,use_opacity:!0,use_rotate:!1,use_scale:!0}]},"fade-in":{loop:!1,selected:0,steps:[{duration:1.6,delay:0,speed:1,delay_px:0,opacity:100,scale:100,acceleration:"ease-out",start_point:"bottom",start_offset:0,from_opacity:0,from_rotate:0,from_scale:80,use_move:!1,use_opacity:!0,use_rotate:!1,use_scale:!1}]},"scale-big":{loop:!1,selected:0,steps:[{duration:.8,delay:0,speed:1,delay_px:0,opacity:100,scale:100,acceleration:"ease-out",start_point:"bottom",start_offset:0,from_opacity:0,from_rotate:0,from_scale:256,use_move:!1,use_opacity:!0,use_rotate:!1,use_scale:!0}]},"move-and-fade":{loop:!1,selected:0,steps:[{duration:.8,delay:0,speed:1,delay_px:0,dx:0,dy:-32,opacity:100,acceleration:"ease-both",start_point:"bottom",start_offset:0,from_opacity:0,from_rotate:0,from_scale:100,use_move:!0,use_opacity:!0,use_rotate:!1,use_scale:!1}]},pulse:{loop:"swing",selected:0,steps:[{duration:1.2,delay:0,speed:1,delay_px:0,dx:142,dy:0,scale:90,acceleration:"ease-both",start_point:"bottom",start_offset:0,from_opacity:100,from_rotate:0,from_scale:100,use_move:!1,use_opacity:!1,use_rotate:!1,use_scale:!0}]},rotate:{loop:"repeat",selected:0,steps:[{duration:1.8,delay:0,speed:1,delay_px:0,dx:0,dy:0,rotate:360,acceleration:"none",start_point:"bottom",start_offset:0,from_opacity:100,from_rotate:0,from_scale:100,use_move:!1,use_opacity:!1,use_rotate:!0,use_scale:!1}]}},TRIGGER_COUNT_LIMIT:3,events:{"click .js-trigger-button":"onTriggerButtonClick","click .js-cancel-trigger":"onTriggerCancelClick","click .js-remove-trigger":"onTriggerRemoveClick","mouseenter .js-trigger-name":"onTriggerNameMouseEnter","mouseleave .js-trigger-name":"onTriggerNameMouseLeave","mouseenter .js-remove-trigger":"onTriggerRemoveMouseEnter","mouseleave .js-remove-trigger":"onTriggerRemoveMouseLeave"},initialize:function(t){this.template=w.a["template-constructor-control-common_animation"],this.step_template=w.a["template-constructor-control-common_animation-step"],this.initControl(t),this.isPreviewMode=!1,this.isSwitcherVisible=!1,this.block=this.blocks&&this.blocks[0],this.someModel=this.models&&this.models[0],this.triggerButtonsState={},this.updateControlState()},bindLogic:function(){this.master.workspace.on("paste-animation",this.onAnimationPaste),this.$loop_types=this.$panel.find(".js-loop-types"),this.$loop_repeat=this.$panel.find(".js-loop-repeat"),this.$loop_swing=this.$panel.find(".js-loop-swing"),this.$playOnce=this.$panel.find(".js-play-once"),this.$preview_switcher=this.$panel.find(".bottom-block .preview"),this.$steps_container=this.$panel.find(".resizable-content"),this.$step_selector=this.$panel.find(".js-step-selector"),this.$step_selector.find(".js-prev-step").on("click",this.prevStepClick),this.$step_selector.find(".js-next-step").on("click",this.nextStepClick),this.$steps_container.on("click",".param-wrapper.start-block .start-popup-item",this.startItemClick),this.$steps_container.on("click",".param-wrapper.acceleration-block .acceleration-popup-item",this.accelerationItemClick),this.$steps_container.on("mouseenter mouseleave",".param-wrapper.acceleration-block .acceleration-popup-item",this.accelerationItemMouseEnterLeave),this.$steps_container.on("click",".remove-effect",this.removeEffectClick),this.$steps_container.on("click",".effects-presets-wrapper .effects-item",this.addStepClick),this.$steps_container.on("click",".effects-presets-wrapper .presets-item",this.usePresetClick),this.$steps_container.on("click",".effects-presets-wrapper .presets-item .preview",this.previewPresetClick),this.$panel.on("click",".unite-button",this.uniteClick),this.$loop_repeat.on("click",this.onLoopTypeClick),this.$loop_swing.on("click",this.onLoopTypeClick),this.$playOnce.on("click",this.onPlayOnceClick),this.$preview_switcher.on("click",this.togglePreviewMode),this.$panel.on("click",".top-block .type-selector .type-popup-item",this.typeSelectorItemClick),this.$panel.on("click",".bottom-block .add-effect .effect-popup-item",this.addEffectItemClick),this.$panel.on("click",".top-block .reset-button",this.resetClick),this.popupManager=new j,this.popupManager.addPopup({$parent:this.$panel,name:"type-selector",selector:".top-block .type-selector",popupSelector:".top-block .type-popup"}),this.popupManager.addPopup({$parent:this.$panel,name:"steps",selector:".js-step-selector:not(.one-step)",popupSelector:".js-step-popup"}),this.popupManager.addPopup({$parent:this.$panel,name:"add-effect",selector:".bottom-block .add-effect",popupSelector:".bottom-block .effect-popup",cbOpen:this.updateEffectPopupState}),this.popupManager.addPopup({$parent:this.$panel,name:"start-selector",selector:".resizable-content .param-wrapper.start-block",popupSelector:".resizable-content .param-wrapper.start-block .start-popup"}),this.popupManager.addPopup({$parent:this.$panel,name:"acceleration-selector",selector:".resizable-content .param-wrapper.acceleration-block",popupSelector:".resizable-content .param-wrapper.acceleration-block .acceleration-popup",cbOpen:this.updateAccelerationPopupState}),RM.constructorRouter.bindGlobalKeyPress([{key:"a",handler:this.onClick}]),this.listenTo(this.someModel,"animation:trigger:add",this.onAnimationTriggerAdd),this.listenTo(this.someModel,"animation:trigger:remove",this.onAnimationTriggerRemove),this.$step_selector.find(".js-step-popup").sortable({items:".js-step-popup-item",distance:10,axis:"y",scrollSpeed:10,containment:"parent",tolerance:"pointer",start:this.onStepsSortStart.bind(this),stop:this.onStepsSortEnd.bind(this)}),Object(o.a)("").add(this.$loop_swing).add(this.$loop_repeat).RMAltText({cssClass:"loop-type-tooltip",offset:-4})},unBindLogic:function(){this.master.workspace.off("paste-animation",this.onAnimationPaste),this.$step_selector.find(".js-prev-step").off("click",this.prevStepClick),this.$step_selector.find(".js-next-step").off("click",this.nextStepClick),this.$steps_container.off("click",".param-wrapper.start-block .start-popup-item",this.startItemClick),this.$steps_container.off("click",".param-wrapper.acceleration-block .acceleration-popup-item",this.accelerationItemClick),this.$steps_container.off("mouseenter mouseleave",".param-wrapper.acceleration-block .acceleration-popup-item",this.accelerationItemMouseEnterLeave),this.$steps_container.off("click",".remove-effect",this.removeEffectClick),this.$steps_container.off("click",".effects-presets-wrapper .effects-item",this.addStepClick),this.$steps_container.off("click",".effects-presets-wrapper .presets-item",this.usePresetClick),this.$steps_container.off("click",".effects-presets-wrapper .presets-item .preview",this.previewPresetClick),this.$panel.off("click",".unite-button",this.uniteClick),this.removeTriggerButtons(),this.$loop_repeat.off("click",this.onLoopTypeClick),this.$loop_swing.off("click",this.onLoopTypeClick),this.$playOnce.off("click",this.onPlayOnceClick),this.$preview_switcher.off("click",this.togglePreviewMode),this.$panel.off("click",".top-block .type-selector .type-popup-item",this.typeSelectorItemClick),this.$panel.off("click",".bottom-block .add-effect .effect-popup-item",this.addEffectItemClick),this.$panel.off("click",".top-block .reset-button",this.resetClick),this.popupManager.destroy(),delete this.popupManager,RM.constructorRouter.unbindGlobalKeyPress("a",this.onClick),this.stopListening(this.someModel,"animation:trigger:add"),this.stopListening(this.someModel,"animation:trigger:remove")},onPlayOnceClick:function(){this.setAnimationData({playOnce:!(this.someModel.getAnimations()[0]||{}).playOnce}),this.updatePlayOnce()},updatePlayOnce:function(){this.$playOnce.toggleClass("active",Boolean((this.someModel.getAnimations()[0]||{}).playOnce))},startPreviewMode:function(){this.isPreviewMode||(this.isPreviewMode=!0,this.$preview_switcher.text("Stop").addClass("active"),this.animationSteps&&this.animationSteps.startPreviewMode())},updatePreviewMode:function(){this.isPreviewMode&&this.animationSteps&&this.animationSteps.updatePreviewMode()},stopPreviewMode:function(){this.isPreviewMode&&(this.isPreviewMode=!1,this.$preview_switcher.text("Preview").removeClass("active"),this.animationSteps&&this.animationSteps.stopPreviewMode())},togglePreviewMode:function(){this.isPreviewMode?this.stopPreviewMode():this.startPreviewMode()},onAnimationPaste:function(){this.selected?this.updateAll():this.onClick()},renderStep:function(t,e){var i,n,a=this.block.getAllAnimationTriggers(),r=a&&a.length>0,l=this.block.id,c=a&&1===a.length&&a.includes(l);this.isSwitcherVisible=Object(u.a)("constructor.hidingSwitcher")&&r&&!c&&0===e&&this.doesOpacityHaveDefaultvalues(),i=s.a.extend({index:e,isSwitcherVisible:this.isSwitcherVisible},t),n=Object(o.a)(this.step_template(i)),e>0?this.$steps_container.find(".step").eq(e-1).after(n):this.$steps_container.append(n),n.find("input").each(s.a.bind((function(t,e){var i=Object(o.a)(e).RMNumericInput({onChange:this.onParamInputChange,labelSelector:".units:not(.for-centering)",autoSize:!0}).data("changeValue");Object(o.a)(e).data("cb",i)}),this));var h=n.find(".js-start-when-in-view-switcher");h.length&&h.RMSwitcher({state:i.startWhenInView,height:26,width:44,"color-0":"#0078ff","color-1":"#c9c8c9","text-color-0":"transparent","text-color-1":"transparent"},this.onSwitcherChange.bind(this));var d=n.find(".js-hide-in-editor-switcher");d.length&&d.RMSwitcher({state:i.hideInEditor,height:26,width:44,"color-0":"#0078ff","color-1":"#c9c8c9","text-color-0":"transparent","text-color-1":"transparent"},this.onHidingSwitcherChange.bind(this))},destroyStep:function(t){this.$steps_container.find(".step").eq(t).remove()},destroyAllSteps:function(t){this.$steps_container.find(".step").remove()},updateStepsIndexes:function(){this.$steps_container.find(".step").each((function(t,e){Object(o.a)(e).attr("data-ind",t)}))},prevStepClick:function(t){t.stopPropagation();var e=this.someModel.getAnimations()[0]||{};this.switchStep({updateWorkspaceSelectedStep:!0,cur:(e.selected||0)-1})},nextStepClick:function(t){t.stopPropagation();var e=this.someModel.getAnimations()[0]||{};this.switchStep({updateWorkspaceSelectedStep:!0,cur:(e.selected||0)+1})},onStepPopupItemClick:function(t){var e=Object(o.a)(t.target).closest(".js-step-popup-item"),i=parseInt(e.data("ind"),10);i!==(this.someModel.getAnimations()[0]||{}).selected&&this.switchStep({updateWorkspaceSelectedStep:!0,cur:i})},onAnimationStepsSelect:function(t){this.switchStep({updateWorkspaceSelectedStep:!1,cur:t})},onStepsSortStart:function(){this.$(".js-step-popup").addClass("grabbing")},onStepsSortEnd:function(){this.$(".js-step-popup").removeClass("grabbing"),this.reorderSteps()},reorderSteps:function(){var t=this.someModel.getAnimations()[0],e=t.steps,i=t.selected,n=[];s.a.each(this.$step_selector.find(".js-step-popup-item"),function(t,s){var a=Object(o.a)(t).data("ind");a===i&&this.setAnimationData({selected:s});var r=e[a];n.push(r)}.bind(this)),this.setAnimationData({steps:n}),this.animationSteps&&this.animationSteps.updateSteps(),this.showSelectedStep({updateWorkspaceSelectedStep:!0})},switchStep:function(t){var e=this.someModel.getAnimations()[0].steps.length;t.cur>=e||t.cur<0||(this.setAnimationData({selected:t.cur},{historyMergeID:"selected",skipPreviewUpdate:!0}),this.showSelectedStep({updateWorkspaceSelectedStep:t.updateWorkspaceSelectedStep}),this.__scrollRecalc_debounced(),RM.analytics&&RM.analytics.sendEvent("Animation Switch Steps"))},addStepClick:function(t){var e=Object(o.a)(t.currentTarget).attr("data-value");this.addStep({use_effect:e}),RM.analytics&&RM.analytics.sendEvent("Animation Choose Effect",e.split("_").pop())},addStep:function(t){t=t||{};var e,i=s.a.cloneWithObjects(this.someModel.getAnimations()[0].steps),o=s.a.cloneWithObjects(this.DEFAULT_ANIMATION_STEP),n={};if("initial"!=t.after_step?e=null!=t.after_step?t.after_step+1:i.length:(e=0,n.from_opacity=i[0].from_opacity,n.from_rotate=i[0].from_rotate,n.from_scale=i[0].from_scale,i[0].use_opacity&&(n.use_opacity=!0,n.opacity=i[0].from_opacity),i[0].use_rotate&&(n.use_rotate=!0,n.rotate=i[0].from_rotate),i[0].use_scale&&(n.use_scale=!0,n.scale=i[0].from_scale),s.a.extend(o,n)),i.splice(e,0,o),this.setAnimationData({selected:e,steps:i}),1==i.length)return this.updateAll(),void this.addEffectItem(t.use_effect);this.renderStep(o,e),this.updateStepsIndexes(),this.animationSteps&&this.animationSteps.updateSteps(),this.showSelectedStep({updateWorkspaceSelectedStep:!0}),this.__scrollRecalc_debounced(),this.addEffectItem(t.use_effect),RM.analytics&&RM.analytics.sendEvent("Animation Add Step",e)},usePresetClick:function(t){if(!Object(o.a)(t.target).closest(".preview").length){var e=Object(o.a)(t.currentTarget).attr("data-value");this.setAnimationData(this.PRESETS[e]),this.updateAll(),RM.analytics&&RM.analytics.sendEvent("Animation Use Preset",e)}},previewPresetClick:function(t){},removeStep:function(t){var e=s.a.cloneWithObjects(this.someModel.getAnimations()[0].steps),i={};if((0==t||"initial"==t)&&1==e.length)return this.setAnimationData({selected:void 0,steps:[]}),void this.updateAll();if(0==t&&e.length>1){var o=y.a.getNormalizedAnimation(this.someModel.getAnimations()[0],this.isFixed,this.isFullwidth,this.isFullheight,1);i.from_opacity=e[0].from_opacity,i.from_rotate=e[0].from_rotate,i.from_scale=e[0].from_scale,e[0].use_opacity&&(i.opacity=o.steps[1].opacity,i.use_opacity=!0),e[0].use_rotate&&(i.rotate=o.steps[1].rotate,i.use_rotate=!0),e[0].use_scale&&(i.scale=o.steps[1].scale,i.use_scale=!0),s.a.extend(e[1],i)}"initial"!=t&&(e.splice(t,1),this.setAnimationData({selected:t==e.length?t-1:t,steps:e}),this.destroyStep(t),this.updateStepsIndexes(),this.animationSteps&&this.animationSteps.updateSteps({animateStepInd:t}),this.showSelectedStep({updateWorkspaceSelectedStep:!0}),this.__scrollRecalc_debounced(),RM.analytics&&RM.analytics.sendEvent("Animation Remove Step",t))},resetClick:function(){this.setAnimationData({}),this.updateAll()},uniteClick:function(){var t={enabled:{},disabled:{}},e={enabled:0,disabled:0},i={enabled:null,disabled:null};s.a.each(this.models,s.a.bind((function(s){var o=s.getAnimations()[0]||{},n=o.UUID||"none",a=o.type&&"none"!=o.type?"enabled":"disabled";t[a][n]=(t[a][n]||0)+1,"none"!=n&&t[a][n]>e[a]&&(i[a]=s,e[a]=t[a][n])}),this)),this.setAnimationData(i.enabled?i.enabled.getAnimations()[0]:i.disabled.getAnimations()[0],{skipHistory:!0}),this.updateAll()},onAnimationStepsChange:function(t){var e=t.id,i=s.a.cloneWithObjects(this.someModel.getAnimations()[0].steps),o=!1;delete t.id,i[e]&&(s.a.extend(i[e],t),null==t.dx||i[e].use_move||(i[e].use_move=!0,o=!0),null==t.scale&&null==t.from_scale||i[e].use_scale||(i[e].use_scale=!0,o=!0),this.setAnimationData({steps:i},{historyMergeID:s.a.keys(t).join("-")}),o&&this.updateCurrentStepParams({visibility:!0}),e==this.someModel.getAnimations()[0].selected&&this.updateCurrentStepInputs(s.a.keys(t)))},typeSelectorItemClick:function(t){var e=(this.someModel.getAnimations()[0]||{}).type||"none",i=Object(o.a)(t.currentTarget).attr("data-value"),s="none"===e&&"none"!==i||"none"!==e&&"none"===i;if(this.checkPreviewEnabled(i))return this.setAnimationData({type:i}),this.popupManager.closePopup("type-selector"),this.updateAll(),this.setAnimationData({type:"none"}),this.someModel.trigger("animation:type:change","none",e),void(this.animationSteps&&this.animationSteps.destroy());this.setAnimationData({type:i}),this.popupManager.closePopup("type-selector"),s||this.someModel.get("preview_enabled")?this.updateAll():(this.updateType(),this.updateCurrentStepParams({visibility:!0,start:!0,delay:!0,duration:!0,delay_px:!0}),this.updateCurrentStepInputs()),e!==i&&this.someModel.trigger("animation:type:change",i,e),RM.analytics&&RM.analytics.sendEvent("Animation Type Change",i)},addEffectItemClick:function(t){this.addEffectItem(Object(o.a)(t.currentTarget).attr("data-value")),this.popupManager.closePopup("add-effect")},addEffectItem:function(t){var e=this.someModel.getAnimations()[0],i=e.selected||0,o={};if(!e.steps[i][t]){var n=s.a.cloneWithObjects(e.steps),a=y.a.getNormalizedAnimation(e,this.isFixed,this.isFullwidth,this.isFullheight,1);n[i][t]=!0,"use_move"==t&&null==n[i].dx&&(o.dx=a.steps[i].dx,o.dy=a.steps[i].dy+10),"use_opacity"==t&&null==n[i].opacity&&(o.opacity=Math.round(a.steps[i].opacity)),"use_rotate"==t&&null==n[i].rotate&&(o.rotate=a.steps[i].rotate+45),"use_scale"==t&&null==n[i].scale&&(o.scale=Math.round(.7*a.steps[i].scale)),s.a.extend(n[i],o),this.setAnimationData({steps:n}),this.updateCurrentStepParams({visibility:!0}),this.animationSteps&&this.animationSteps.updateSteps({animateStepInd:i}),this.__scrollRecalc_debounced(),this.updateCurrentStepInputs()}},removeEffectClick:function(t){var e=this.someModel.getAnimations()[0],i=Object(o.a)(t.target).closest(".step").attr("data-ind")-0,n=Object(o.a)(t.currentTarget).attr("data-value"),a=s.a.cloneWithObjects(e.steps);a[i][n]=!1,this.setAnimationData({steps:a}),this.updateCurrentStepParams({visibility:!0}),this.animationSteps&&this.animationSteps.updateSteps({animateStepInd:i}),this.__scrollRecalc_debounced()},onTriggerButtonClick:function(t){var e=Object(o.a)(t.target).closest("[data-id]").data("id"),i=this.getTriggerButtonState(e),n=this.block.id;"none"===i.status?this.updateTriggerButton(e,"pending"):"onOtherPage"===i.status&&i.pageNumber&&(t.stopPropagation(),RM.constructorRouter.once("pageChange",(function(t){setTimeout((function(){var e=s.a.find(t.blocks,(function(t){return t.id==n}));e&&e.onClick()}),0)})),RM.constructorRouter.showWorkspace(i.pageNumber))},onTriggerCancelClick:function(t){var e=Object(o.a)(t.target).closest("[data-id]").data("id");t.stopPropagation(),this.removeTriggerButton(e)},onTriggerRemoveClick:function(t){t.stopPropagation();var e=Object(o.a)(t.target).closest("[data-id]").data("id"),i=this.block.getAllAnimationTriggers();-1!==i.indexOf(e)&&(this.highlightActiveTriggerBlock(e,!1,!0),this.setAnimationData({trigger:s.a.without(i,e)}),this.someModel.trigger("animation:trigger:remove",e)),RM.analytics&&RM.analytics.sendEvent("Animation Trigger Remove")},onTriggerNameMouseEnter:function(t){this.highlightActiveTriggerBlock(Object(o.a)(t.target).closest("[data-id]").data("id"),!0,!1)},onTriggerNameMouseLeave:function(){this.highlightActiveTriggerBlock(Object(o.a)(event.target).closest("[data-id]").data("id"),!1,!1)},onTriggerRemoveMouseEnter:function(t){this.highlightActiveTriggerBlock(Object(o.a)(t.target).closest("[data-id]").data("id"),!0,!0)},onTriggerRemoveMouseLeave:function(t){this.highlightActiveTriggerBlock(Object(o.a)(t.target).closest("[data-id]").data("id"),!1,!0)},onTriggerClick:function(t,e){if(y.a.canBeExternalTrigger(t,this.block)){e.stopPropagation();var i=t.id;this.highlightActiveTriggerBlock(i,!1,!1),this.setAnimationData({trigger:this.removeMissingTriggers(this.block.getAllAnimationTriggers()).concat(i)}),this.someModel.trigger("animation:trigger:add",i),RM.analytics&&RM.analytics.sendEvent("Animation Trigger Click")}},onTriggerMouseEnter:function(t){this.highlightPendingTriggerBlock(Object(o.a)(t.target).closest(".block").data("id"),!0)},onTriggerMouseLeave:function(t){this.highlightPendingTriggerBlock(Object(o.a)(t.target).closest(".block").data("id"),!1)},onLoopTypeClick:function(t){if(!this.$loop_types.hasClass("disabled")){var e=Object(o.a)(t.target);this.setAnimationData({loop:!e.hasClass("checked")&&e.data("value")}),this.updateLoop()}},highlightPendingTriggerBlock:function(t,e){var i=t&&this.master.workspace.findBlock(t);i&&i.highlight(e&&y.a.canBeExternalTrigger(i,this.block),y.a.ACTIVE_TRIGGER_HIGHLIGHT_CLASS)},highlightActiveTriggerBlock:function(t,e,i){var s=t&&this.master.workspace.findBlock(t),o=s&&1===this.blocks.length&&this.block.id===s.id,n=i?y.a.ACTIVE_TRIGGER_REMOVE_CLASS:y.a.ACTIVE_TRIGGER_HIGHLIGHT_CLASS;s&&s.highlight(e,n);var a=this.block.triggerAssets&&this.block.triggerAssets[t];if(a){var r=o?this.block.ownTooltip&&this.block.ownTooltip.getElement():a.tooltip&&a.tooltip.getElement();r&&r.toggleClass(n,Boolean(e))}},updateTriggerButtonHandlers:function(t){var e=s.a.map(t,(function(t){return t.status})),i=-1!==e.indexOf("pending")?"pending":-1!==e.indexOf("active")?"active":"none",o=this.master.workspace.getBlockElements(y.a.EXTERNAL_TRIGGER_BLOCK_EXCLUDE),n=o.not(s.a.map(this.block.getAllAnimationTriggers(),(function(t){return'[data-id="'+t+'"]'})).join(", ")),a=function(){this.master.workspace.on("block:click",this.onTriggerClick),n.on("mouseenter",this.onTriggerMouseEnter),n.on("mouseleave",this.onTriggerMouseLeave)}.bind(this),r=function(){this.master.workspace.off("block:click",this.onTriggerClick),o.off("mouseenter",this.onTriggerMouseEnter),o.off("mouseleave",this.onTriggerMouseLeave)}.bind(this);switch(i){case"pending":this.waitingForTriggerClick=!0,a(),this.block.animationMode&&(this.willRestoreAnimationMode=!0,this.destroyAnimationSteps());break;case"active":case"onOtherPage":case"none":s.a.delay(function(){this.waitingForTriggerClick=!1}.bind(this)),r(),this.willRestoreAnimationMode&&(this.willRestoreAnimationMode=!1,this.initializeAnimationSteps())}},renderTriggerButton:function(t,e,i){var s=t&&this.master.workspace.findBlock(t),o=s&&1===this.blocks.length&&this.block.id===s.id;return w.a["template-constructor-control-common_animation-trigger"]({id:t,status:e,pageNumber:i,name:s?o?"Self":s.model.get("name")||s.getStandardName():"Trigger"})},getTriggerButtonState:function(t){return this.triggerButtonsState&&this.triggerButtonsState[t]||{}},getStepIndex:function(t){return Object(o.a)(t).closest(".step").attr("data-ind")-0},changeStepField:function(t,e){var i=this.someModel.getAnimations()[0],o=s.a.cloneWithObjects(i.steps);s.a.extend(o[t],e),this.setAnimationData({steps:o})},onSwitcherChange:function(t){this.changeStepField(0,{startWhenInView:t})},onHidingSwitcherChange:function(t){this.changeStepField(0,{hideInEditor:t})},startItemClick:function(t){var e=Object(o.a)(t.currentTarget).attr("data-value");this.changeStepField(this.getStepIndex(t.target),{start_point:e}),this.updateCurrentStepParams({start:!0})},accelerationItemClick:function(t){var e=Object(o.a)(t.currentTarget).attr("data-value");this.changeStepField(this.getStepIndex(t.target),{acceleration:e}),this.popupManager.closePopup("acceleration-selector"),this.updateCurrentStepParams({acceleration:!0})},accelerationItemMouseEnterLeave:function(t){var e=Object(o.a)(t.currentTarget).siblings(".acceleration-popup-preview").find(".ball"),i="mouseenter"==t.type?Object(o.a)(t.currentTarget).attr("data-value"):"";if(e.attr("data-acceleration")||""){var s=y.a.ANIMATION_PROPERTIES.animationIterationJS;e.off().one(s,(function(t){0==Math.round(t.originalEvent.elapsedTime/.7)%2?(e.attr("data-acceleration",""),e.outerHeight(),e.attr("data-acceleration",i)):e.off().one(s,(function(t){e.attr("data-acceleration",""),e.outerHeight(),e.attr("data-acceleration",i)}))}))}else e.attr("data-acceleration",i)},onParamInputChange:function(t,e){var i=this.getStepIndex(t),n=s.a.cloneWithObjects(this.someModel.getAnimations()[0].steps),a=Object(o.a)(".move-block .numeric-input.left-align")[0].value,r=Object(o.a)(".move-block .numeric-input.right-align")[0].value,l=t.attr("data-param");if(a>9999||a<-9999||r>9999||r<-9999?Object(o.a)(".move-block .numeric-input").css("font-size","18px"):Object(o.a)(".move-block .numeric-input").css("font-size","22px"),n[i]&&(n[i][l]=e,this.setAnimationData({steps:n},{historyMergeID:l}),s.a.contains(["rotate","scale","opacity","dx","dy","from_rotate","from_scale","from_opacity"],l)&&this.animationSteps&&this.animationSteps.updateSteps(),s.a.contains(["opacity","from_opacity"],l)&&0===i&&this.onOpacityChange(),"start_offset"==l&&this.updateCurrentStepParams({start:!0}),s.a.contains(["delay","duration","delay_px"],l))){var c={};c[l]=!0,this.updateCurrentStepParams(c)}},onOpacityChange:function(){this.doesOpacityHaveDefaultvalues()||this.changeStepField(0,{hideInEditor:!1}),(this.doesOpacityHaveDefaultvalues()&&!this.isSwitcherVisible||!this.doesOpacityHaveDefaultvalues()&&this.isSwitcherVisible)&&(this.updateSteps(),this.updateStepsIndexes(),this.showSelectedStep({updateWorkspaceSelectedStep:!0}))},doesOpacityHaveDefaultvalues:function(){var t=this.someModel.getAnimations()[0],e=t&&t.steps&&t.steps[0]&&t.steps[0].from_opacity,i=t&&t.steps&&t.steps[0]&&t.steps[0].opacity;return 0===e&&100===i},onAnimationTriggerAdd:function(t){this.updateTriggerButton(t,"active")},onAnimationTriggerRemove:function(t){this.removeTriggerButton(t)},initializeAnimationSteps:function(){this.animationSteps=new O({blocks:this.blocks,workspace:this.master.workspace,isFixed:this.isFixed,isFullwidth:this.isFullwidth,isFullheight:this.isFullheight,isSticked:this.isSticked,popupManager:this.popupManager});var t=parseInt(this.animationSteps.$el.css("z-index"),10),e=s.a.max(s.a.map(this.blocks,(function(t){return t.model.attributes.z})));s.a.each(this.block.getTriggerBlocks(),(function(i,s){var o=i.$el.css("z-index"),n=i.model.attributes.z;e<n&&i.$el.css({"z-index":t+s+1}),i.$el.data({"original-element-z-index":o})})),this.updateSteps(),this.updateStepsIndexes(),this.showSelectedStep({updateWorkspaceSelectedStep:!0}),this.animationSteps.on("move scale",this.onAnimationStepsChange),this.animationSteps.on("add-step",this.addStep),this.animationSteps.on("remove-step",this.removeStep),this.animationSteps.on("select",this.onAnimationStepsSelect)},destroyAnimationSteps:function(){this.animationSteps&&this.animationSteps.destroy(),s.a.each(this.block.getTriggerBlocks(),(function(t){var e=t.$el.data("original-element-z-index");t.$el.css({"z-index":e&&"auto"!==e?e:null})}))},updateAll:function(t){if(t=t||{},this.isFullwidth=!!this.someModel.get("is_full_width"),this.isFullheight=!!this.someModel.get("is_full_height"),this.isFixed=!!this.someModel.get("fixed_position"),this.isSticked=!!this.someModel.get("sticked"),this.isMobileViewport="default"!=this.master.workspace.page.getCurrentViewport(),this.$panel.find('.top-block .type-selector .type-popup-item[data-value="hover"]').toggle(!this.isMobileViewport),this.updateControlState(),this.destroyAnimationSteps(),this.updateType(),!this.checkWidgetsCompatibility())return this.updateBlockHeight(),void this.stopPreviewMode();this.updateBlockHeight(),this.popupManager&&this.popupManager.closeAllPopups(),this.initializeAnimationSteps(),this.updateLoop(),this.updatePlayOnce(),this.resetTriggerButtons(),this.__scrollRecalc_debounced&&this.__scrollRecalc_debounced()},updateControlState:function(){this.$el.toggleClass("has-animation",s.a.any(this.models,(function(t){var e=t.getAnimations()[0];return e&&e.type&&"none"!=e.type})))},checkWidgetsCompatibility:function(){var t=0,e=0,i=[],o=0,n=0,a=0,r=0,l={};if(s.a.each(this.models,s.a.bind((function(s){s.get("fixed_position")&&(e++,i.push(s.get("fixed_position"))),s.get("is_full_width")&&o++,s.get("is_full_height")&&n++,s.get("sticked")&&a++,y.a.canHaveAnimation(s)||r++,s.get("fixed_position")||s.get("is_full_width")||s.get("is_full_height")||s.get("sticked")||t++;var c=s.getAnimations()[0]||{};l[c.UUID||"none"]=!0}),this)),this.$panel.removeClass("show-mixed-types show-multiple-fixeds show-multiple-stickeds show-multiple-fullwidths show-multiple-fullheights show-multiple-animations animation-disabled with-reset animation-without-steps show-non-animatable"),this.models.length>1){if(t&&(e||o||n||a)||!t&&(e&&o||e&&n||e&&a||a&&o||a&&n||o&&n))return this.$panel.addClass("show-mixed-types"),this.toggleFixedPanelSize(!0,this.MESSAGE_MIXED_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Mixed Types"),!1;if(e)return this.$panel.addClass("show-multiple-fixeds"),this.toggleFixedPanelSize(!0,this.MESSAGE_MULTIPLE_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Multiple Fixed"),!1;if(a)return this.$panel.addClass("show-multiple-stickeds"),this.toggleFixedPanelSize(!0,this.MESSAGE_MULTIPLE_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Multiple Sticky"),!1;if(o)return this.$panel.addClass("show-multiple-fullwidths"),this.toggleFixedPanelSize(!0,this.MESSAGE_MULTIPLE_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Multiple Full Width"),!1;if(n)return this.$panel.addClass("show-multiple-fullheights"),this.toggleFixedPanelSize(!0,this.MESSAGE_MULTIPLE_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Multiple Full Height"),!1;if(r)return this.$panel.addClass("show-non-animatable"),this.toggleFixedPanelSize(!0,this.MESSAGE_NON_ANIMATABLE_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Cannot Animate Group"),!1;if(s.a.keys(l).length>1)return this.$panel.addClass("show-multiple-animations"),this.toggleFixedPanelSize(!0,this.MESSAGE_UNITE_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Unite Animations Confirm"),!1}var c=this.someModel.getAnimations()[0]||{};return c.type&&"none"!=c.type?s.a.isEmpty(c.steps)?(this.$panel.addClass("animation-without-steps"),this.$panel.find('.effects-presets-wrapper .effects-item[data-value="use_rotate"]').toggle(!(this.isFullwidth||this.isFullheight)),this.$panel.find('.effects-presets-wrapper .presets-item[data-value="rotate"]').toggle(!(this.isFullwidth||this.isFullheight)),this.destroyAllSteps(),this.toggleFixedPanelSize(!1),this.resizableScroll&&this.resizableScroll.changeGaps({gap_start:16}),this.__scrollRecalc_debounced&&this.__scrollRecalc_debounced(),!1):(this.resizableScroll&&this.resizableScroll.changeGaps({gap_start:88}),this.toggleFixedPanelSize(!1),!0):(this.$panel.addClass("animation-disabled"),s.a.isEmpty(c)?this.toggleFixedPanelSize(!0,this.DISABLED_HEIGHT):(this.$panel.addClass("with-reset"),this.toggleFixedPanelSize(!0,this.DISABLED_HEIGHT_RESET)),!1)},updateEffectPopupState:function(t){var e=this.someModel.getAnimations()[0]||{},i=e.selected||0,o=e.steps[i];t.find('.effect-popup-item[data-value="use_rotate"]').toggle(!(this.isFullwidth||this.isFullheight)),s.a.each(["use_move","use_opacity","use_rotate","use_scale"],(function(e){t.find('.effect-popup-item[data-value="'+e+'"]').toggleClass("used",!!o[e])}))},updateAccelerationPopupState:function(t){var e=t.position().top<130;t.toggleClass("shift-popup",e)},updateType:function(){var t=this.someModel.getAnimations()[0]||{},e=t.type||"none",i=this.$panel.find('.top-block .type-selector .type-popup-item[data-value="'+e+'"]');i.addClass("curr").siblings().removeClass("curr"),this.$panel.find(".top-block .type-selector .type-caption").text(i.text()),this.$panel.toggleClass("show-trigger",y.a.isExternalTriggerAllowed(e)&&!s.a.isEmpty(t.steps)),this.$panel.toggleClass("show-loops","scroll"!==e),this.$panel.toggleClass("show-start-condition","load"===e),this.$panel.toggleClass("show-play-once","click"===e),this.toggleRequiresTrigger(),this.checkPreviewEnabled(),window.requestAnimationFrame(this.resizableScroll.recalc.bind(this.resizableScroll)),this.updateBlockHeight()},toggleRequiresTrigger:function(){var t=this.someModel.getAnimations()[0]||{};this.$panel.toggleClass("show-requires-trigger",Boolean("click"===t.type&&!this.block.getAllAnimationTriggers().length&&"video"===this.someModel.get("type"))&&!s.a.isEmpty(t.steps)),this.updateCurrentStepInputs()},checkPreviewEnabled:function(t){var e=t||(this.someModel.getAnimations()[0]||{}).type,i=Boolean(this.someModel.get("preview_enabled")),s=Boolean("click"===e&&i);return this.$panel.toggleClass("show-cannot-use-with-picture-preview",s),this.updateCurrentStepInputs(),s},resetTriggerButtons:function(){this.updateTriggerButtons(s.a.reduce(this.block.getAllAnimationTriggers(),function(t,e){return t[e]=this.verifyTriggerState(e,"active"),t}.bind(this),{}))},removeTriggerButton:function(t){if(t)var e="new"===t?s.a.extend({},this.triggerButtonsState,{new:{status:"none"}}):s.a.omit(this.triggerButtonsState,t);this.updateTriggerButtons(e),this.isSwitcherVisible&&(this.changeStepField(0,{hideInEditor:!1}),this.updateSteps(),this.updateStepsIndexes(),this.showSelectedStep({updateWorkspaceSelectedStep:!0}))},removeTriggerButtons:function(){this.updateTriggerButtons({})},updateTriggerButton:function(t,e){if(t){var i={};i[t]=this.verifyTriggerState(t,e);var o=s.a.extend({},s.a.omit(this.triggerButtonsState,"new"),i);this.updateTriggerButtons(o)}},updateTriggerButtons:function(t){!(t=s.a.omit(t,(function(t,e){return"new"!==e&&t&&"none"===t.status}))).new&&s.a.keys(t).length<this.TRIGGER_COUNT_LIMIT&&(t.new={status:"none"});var e=Object(o.a)(document.createDocumentFragment());s.a.each(t,function(t,i){e.append(this.renderTriggerButton(i,t.status,t.pageNumber))}.bind(this)),this.$panel.find(".js-trigger-buttons-container").empty().append(e),this.updateTriggerButtonHandlers(t),this.triggerButtonsState=t,this.updateBlockHeight(),this.toggleRequiresTrigger(),this.checkPreviewEnabled()},updateBlockHeight:function(){var t=(this.someModel.getAnimations()[0]||{}).type||"none",e=this.$panel.find(".js-top-block"),i=this.$panel.find(".js-top-block-content"),s=this.$panel.find(".js-step-selector"),o=i.outerHeight();e.css({height:"none"===t?"":o}),this.$panel.find(".resizable-scroll-wrapper").css({top:o+(s[0]&&s[0].offsetHeight||0)}),s.css({top:o}),this.__scrollRecalc_debounced()},verifyTriggerState:function(t,e){if(-1!==["pending","none"].indexOf(e))return{status:e};var i=t&&this.master.workspace.findBlock(t),s=t&&!i?this.master.workspace.mag.getWidgetPage(t):null;return i?{status:"active"}:s&&s.id!==this.master.workspace.page.id?{status:"onOtherPage",pageNumber:s.attributes.num}:{status:"none"}},removeMissingTriggers:function(t){return s.a.filter(t,function(t){return t&&this.master.workspace.findBlock(t)||this.master.workspace.mag.getWidgetPage(t)}.bind(this))},updateCurrentStepParams:function(t){var e=this.someModel.getAnimations()[0]||{},i=e.type||"none",n=e.selected||0,a=e.steps;if(!s.a.isEmpty(a)){var r=this.$steps_container.find(".step").eq(n),l=a[n];if(t.visibility&&(Object(o.a)(" .param-wrapper.delay-block, .param-wrapper.duration-block",r).toggleClass("hide-unallowed","scroll"==i),Object(o.a)(".param-wrapper.delay_px-block",r).toggleClass("hide-unallowed","scroll"!=i||0==n&&!this.isFixed),Object(o.a)(".param-wrapper.speed-block",r).toggleClass("hide-unallowed","scroll"!=i),Object(o.a)(".param-wrapper.start-block",r).toggleClass("hide-unallowed","scroll"!=i||n>0||this.isFixed),Object(o.a)(".param-wrapper.move-block",r).toggleClass("hide-dx-input",this.isFullwidth),Object(o.a)(".param-wrapper.move-block",r).toggleClass("hide-dy-input",this.isFullheight),Object(o.a)(".param-wrapper.rotate-block",r).toggleClass("hide-unallowed",this.isFullwidth||this.isFullheight),Object(o.a)(".param-wrapper.opacity-block, .param-wrapper.rotate-block, .param-wrapper.scale-block",r).toggleClass("hide-from-input",n>0),Object(o.a)(".param-wrapper.move-block",r).toggleClass("hide-unused",!l.use_move),Object(o.a)(".param-wrapper.opacity-block",r).toggleClass("hide-unused",!l.use_opacity),Object(o.a)(".param-wrapper.rotate-block",r).toggleClass("hide-unused",!l.use_rotate),Object(o.a)(".param-wrapper.scale-block",r).toggleClass("hide-unused",!l.use_scale)),t.start&&!Object(o.a)(".param-wrapper.start-block",r).hasClass("hide-unallowed")){var c;(c=Object(o.a)('.param-wrapper.start-block .start-popup .start-popup-item[data-value="'+l.start_point+'"]',r)).addClass("curr").siblings(".start-popup-item").removeClass("curr"),Object(o.a)(".param-wrapper.start-block .start-value",r).text(c.text()),Object(o.a)(".param-wrapper.start-block .start-popup",r).toggleClass("has-offset",!!l.start_offset);var h=63*{top:0,center:.5,bottom:1}[l.start_point],d=-63*l.start_offset/Object(o.a)(window).height(),p=Math.max(Math.min(h+d,63),0);Object(o.a)(".param-wrapper.start-block .start-preview .start-point",r).css("top",h),Object(o.a)(".param-wrapper.start-block .start-preview .start-dist",r).css({top:Math.min(h,p),bottom:63-Math.max(h,p)}),Object(o.a)(".param-wrapper.start-block .start-preview .start-offset",r).css("top",p)}if(t.acceleration)(c=Object(o.a)('.param-wrapper.acceleration-block .acceleration-popup .acceleration-popup-item[data-value="'+l.acceleration+'"]',r)).addClass("curr").siblings(".acceleration-popup-item").removeClass("curr"),Object(o.a)(".param-wrapper.acceleration-block .acceleration-value",r).text(c.text());s.a.each(["delay","duration","delay_px"],(function(e){if(t[e]&&!Object(o.a)(".param-wrapper."+e+"-block",r).hasClass("hide-unallowed")){var i;i="delay_px"==e?Math.min(76*l[e]/Object(o.a)(window).height(),76):Math.min(20*l[e],76),Object(o.a)(".param-wrapper."+e+"-block .bg",r).height(i)}}))}},updateCurrentStepInputs:function(t){var e=this.someModel.getAnimations()[0]||{},i=e.selected||0;t=t||["start_offset","delay","duration","delay_px","speed","dx","dy","opacity","rotate","scale"];if(!s.a.isEmpty(e.steps)){var o=this.$steps_container.find(".step").eq(i);s.a.each(t,(function(t){var s;((s=o.find('input[data-param="'+t+'"]').data("cb"))&&s(e.steps[i][t],!0),"opacity"==t||"rotate"==t||"scale"==t)&&(t="from_"+t,(s=o.find('input[data-param="'+t+'"]').data("cb"))&&s(e.steps[i][t],!0))}))}},updateStepsPopup:function(){var t=this.someModel.getAnimations()[0],e=t.steps,i=t.selected||0,n=this.$step_selector.find(".js-step-popup-content"),a=w.a["template-constructor-control-common_animation-step-popup-item"],r=Object(o.a)(document.createDocumentFragment());s.a.each(e,(function(t,e){var s=a({index:e,text:"Step "+(e+1),isSelected:e===i});r.append(s)})),n.empty().append(r),n.off("click.popup-item"),n.on("click.popup-item",".js-step-popup-item",this.onStepPopupItemClick)},updateLoop:function(){this.$loop_types.find("[data-value]").removeClass("checked");var t=y.a.normalizeLoopValue(this.someModel.getAnimations()[0].loop);t&&this.$loop_types.find("[data-value="+t+"]").addClass("checked")},updateSteps:function(){this.destroyAllSteps(),s.a.each(this.someModel.getAnimations()[0].steps,this.renderStep)},showSelectedStep:function(t){t=t||{};var e=this.someModel.getAnimations()[0],i=e.steps.length,s=e.selected||0;this.$step_selector.toggleClass("one-step",1==i),this.$step_selector.find(".js-step-caption").text(1==i?"Step 1":"Step "+(s+1)+"/"+i),this.$step_selector.find(".js-prev-step").toggleClass("disabled",0==s),this.$step_selector.find(".js-next-step").toggleClass("disabled",s==i-1),this.$steps_container.find(".step").hide().eq(s).show(),this.updateCurrentStepParams({visibility:!0,acceleration:!0,start:!0,delay:!0,duration:!0,delay_px:!0}),this.updateCurrentStepInputs(),this.updateStepsPopup(),t.updateWorkspaceSelectedStep&&this.animationSteps.selectStep(s)},setAnimationData:function(t,e){e=e||{};var i=this.someModel.getAnimations()[0];s.a.isEmpty(i)&&(i={loop:!1,selected:0,steps:[]}),s.a.isEmpty(t)||(t=s.a.extend(s.a.cloneWithObjects(i),t)),t=y.a.normalizeAnimations(t);var o=s.a.map(this.models,(function(e){return{_id:e.get("_id"),animation:t}}));e.skipHistory||e.redo||e.undo||!this.undoController||(this.undoController.isEmpty()&&this.undoController.add(s.a.cloneWithObjects(this.someModel.getAnimations()[0])),this.undoController.add.__debounced(t,{historyMergeID:e.historyMergeID})),this.master.workspace.set_group(o),!e.skipPreviewUpdate&&this.isPreviewMode&&this.updatePreviewMode(),this.hasChanges=!0},save:function(){this.hasChanges&&(s.a.isEmpty(this.someModel.getAnimations()[0])||this.setAnimationData({UUID:r.b.generateUUID()},{skipHistory:!0,skipPreviewUpdate:!0}),this.master.workspace.save_group(this.models,{skipHistory:!0}),delete this.hasChanges),b.prototype.save.apply(this,arguments)},onPanelScroll:function(t){},select:function(){b.prototype.select.apply(this,arguments),this.undoController=new M({control:this,pid:this.models[0].get("pid")}),this.updateAll(),this.$panel.hide(),this.$panel.outerHeight(),this.$panel.show()},deselect:function(){this.stopPreviewMode(),this.destroyAnimationSteps(),this.popupManager&&this.popupManager.closeAllPopups&&this.popupManager.closeAllPopups(),this.save(),this.undoController&&this.undoController.destroy(),delete this.undoController,b.prototype.deselect.apply(this,arguments)},onClick:function(){this.selected&&this.popupManager.openedPopup&&this.popupManager.closeAllPopups()||h.prototype.onClick.apply(this,arguments)},onEscKey:function(){this.isPreviewMode?this.stopPreviewMode():this.selected&&this.popupManager.openedPopup&&this.popupManager.closeAllPopups()||h.prototype.onEscKey.apply(this,arguments)},restrictions:function(t){var e=t.getSelectedBlocks();return s.a.find(e,(function(t){return y.a.canHaveAnimation(t)}))},canControlBeClosed:function(){return!(!this.popupManager.openedPopup||!this.popupManager.closeAllPopups())||(!!this.waitingForTriggerClick||h.prototype.canControlBeClosed.apply(this,arguments))},destroy:function(){this.selected&&this.deselect(),this.willRestoreAnimationMode=!1,this.removeTriggerButtons(),b.prototype.destroy.apply(this,arguments)}}),M=a.a.Model.extend({initialize:function(t){s.a.bindAll(this),this.control=t.control,this.pid=t.pid,this.undoIndex=-1,this.undoStack=[],this.add.__debounced=s.a.debounce(this.add,300),this.historyTriggers=k.a.setCustomHandlers({undo:this.undo,redo:this.redo,getLength:this.getLength})},isEmpty:function(){return-1==this.undoIndex},add:function(t,e){e=e||{},-1!=this.undoIndex&&s.a.isEqual(y.a.normalizeAnimations(this.undoStack[this.undoIndex].animation)[0],t)||(s.a.isEmpty(t)&&(t={}),this.undoIndex>=0&&e.historyMergeID&&e.historyMergeID==this.undoStack[this.undoIndex].historyMergeID||this.undoIndex++,this.undoStack[this.undoIndex]={animation:t,historyMergeID:e.historyMergeID},this.undoStack.length=this.undoIndex+1,this.historyTriggers.triggerChange(this.pid))},undo:function(t){this.undoIndex>0&&(this.undoIndex--,this.control.setAnimationData(y.a.normalizeAnimations(this.undoStack[this.undoIndex].animation)[0],{undo:!0}),this.control.updateAll({undo:!0}),this.historyTriggers.triggerChange(this.pid),this.historyTriggers.triggerUndo(this.pid))},redo:function(t){this.undoIndex<this.undoStack.length-1&&(this.undoIndex++,this.control.setAnimationData(y.a.normalizeAnimations(this.undoStack[this.undoIndex].animation)[0],{redo:!0}),this.control.updateAll({redo:!0}),this.historyTriggers.triggerChange(this.pid),this.historyTriggers.triggerRedo(this.pid))},getLength:function(t){return{undo:this.undoIndex,redo:this.undoStack.length-1-this.undoIndex,page:t}},destroy:function(){k.a.removeCustomHandlers()}});function j(t){this.popups={},this.openedPopup="",s.a.bindAll(this),this.closeAllPopups.__debounced=s.a.debounce(this.closeAllPopups,50)}j.prototype.addPopup=function(t){t.onClick=s.a.bind((function(e){e&&Object(o.a)(e.target).closest(t.popupSelector).length>0||this.onClick(t.name,e.currentTarget)}),this),t.$parent.on("click",t.selector,t.onClick),t.$parent.on("click",this.closeAllPopups.__debounced),this.popups[t.name]=t},j.prototype.onClick=function(t,e){this.openedPopup==t?this.closePopup(t):this.openPopup(t,e)},j.prototype.closePopup=function(t){this.openedPopup==t&&this.popups[t]&&(this.openedPopup="",Object(o.a)(this.popups[t].selector,this.popups[t].$parent).removeClass("opened"),this.popups[t].cbClose&&this.popups[t].cbClose())},j.prototype.openPopup=function(t,e){this.openedPopup!=t&&this.popups[t]&&(this.openedPopup&&this.closePopup(this.openedPopup),this.openedPopup=t,Object(o.a)(e).addClass("opened"),this.popups[t].cbOpen&&this.popups[t].cbOpen(Object(o.a)(e)))},j.prototype.closeAllPopups=function(t){return!this.openedPopup||!(t&&Object(o.a)(t.target).closest(this.popups[this.openedPopup].selector).length>0)&&(this.closePopup(this.openedPopup),!0)},j.prototype.destroy=function(){for(var t in this.popups)this.popups[t].$parent.off("click",this.popups[t].selector,this.popups[t].onClick),this.popups[t].$parent.off("click",this.closeAllPopups.__debounced);delete this.popups};var I=T,E=i("j0jp"),A=i.n(E);i("QNiq");function R(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function D(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?R(i,!0).forEach((function(e){z(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):R(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function z(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function L(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var B=b.extend({name:"common_animation",className:"control common_animation",MIN_PANEL_HEIGHT:560,MAX_PANEL_HEIGHT:640,DISABLED_HEIGHT:138,DISABLED_HEIGHT_RESET:138,MESSAGE_MIXED_HEIGHT:128,MESSAGE_MULTIPLE_HEIGHT:112,MESSAGE_NON_ANIMATABLE_HEIGHT:96,MESSAGE_UNITE_HEIGHT:160,DEFAULT_ANIMATION_STEP:{duration:.5,delay:0,speed:1,delay_px:0,dx:void 0,dy:void 0,opacity:void 0,rotate:void 0,scale:void 0,acceleration:"none",start_point:"bottom",start_offset:0,from_opacity:0,from_rotate:0,from_scale:100,use_move:!1,use_opacity:!1,use_rotate:!1,use_scale:!1},PRESETS:{"fade-and-scale":{loop:!1,selected:0,steps:[{duration:1.2,delay:0,speed:1,delay_px:0,opacity:100,scale:100,acceleration:"ease-out",start_point:"bottom",start_offset:0,from_opacity:0,from_rotate:0,from_scale:80,use_move:!1,use_opacity:!0,use_rotate:!1,use_scale:!0}]},"fade-in":{loop:!1,selected:0,steps:[{duration:1.6,delay:0,speed:1,delay_px:0,opacity:100,scale:100,acceleration:"ease-out",start_point:"bottom",start_offset:0,from_opacity:0,from_rotate:0,from_scale:80,use_move:!1,use_opacity:!0,use_rotate:!1,use_scale:!1}]},"scale-big":{loop:!1,selected:0,steps:[{duration:.8,delay:0,speed:1,delay_px:0,opacity:100,scale:100,acceleration:"ease-out",start_point:"bottom",start_offset:0,from_opacity:0,from_rotate:0,from_scale:256,use_move:!1,use_opacity:!0,use_rotate:!1,use_scale:!0}]},"move-and-fade":{loop:!1,selected:0,steps:[{duration:.8,delay:0,speed:1,delay_px:0,dx:0,dy:-32,opacity:100,acceleration:"ease-both",start_point:"bottom",start_offset:0,from_opacity:0,from_rotate:0,from_scale:100,use_move:!0,use_opacity:!0,use_rotate:!1,use_scale:!1}]},pulse:{loop:"swing",selected:0,steps:[{duration:1.2,delay:0,speed:1,delay_px:0,dx:142,dy:0,scale:90,acceleration:"ease-both",start_point:"bottom",start_offset:0,from_opacity:100,from_rotate:0,from_scale:100,use_move:!1,use_opacity:!1,use_rotate:!1,use_scale:!0}]},rotate:{loop:"repeat",selected:0,steps:[{duration:1.8,delay:0,speed:1,delay_px:0,dx:0,dy:0,rotate:360,acceleration:"none",start_point:"bottom",start_offset:0,from_opacity:100,from_rotate:0,from_scale:100,use_move:!1,use_opacity:!1,use_rotate:!0,use_scale:!1}]}},TRIGGER_COUNT_LIMIT:3,events:{"click .js-trigger-button":"onTriggerButtonClick","click .js-cancel-trigger":"onTriggerCancelClick","click .js-remove-trigger":"onTriggerRemoveClick","mouseenter .js-trigger-name":"onTriggerNameMouseEnter","mouseleave .js-trigger-name":"onTriggerNameMouseLeave","mouseenter .js-remove-trigger":"onTriggerRemoveMouseEnter","mouseleave .js-remove-trigger":"onTriggerRemoveMouseLeave"},initialize:function(t){this.template=A.a["template-constructor-control-common_animation"],this.step_template=A.a["template-constructor-control-common_animation-step"],this.topBlockTemplate=A.a["template-constructor-control-common_animation-top-block"],this.typeSelectorTemplate=A.a["template-constructor-control-common_animation-type-popup"],this.initControl(t),this.isPreviewMode=!1,this.isSwitcherVisible=!1,this.block=this.blocks&&this.blocks[0],this.someModel=this.models&&this.models[0],this.triggerButtonsState={},this.currentUuid=void 0,this.updateControlState()},bindLogic:function(){this.master.workspace.on("paste-animation",this.onAnimationPaste),this.$loop_types=this.$panel.find(".js-loop-types"),this.$loop_repeat=this.$panel.find(".js-loop-repeat"),this.$loop_swing=this.$panel.find(".js-loop-swing"),this.$playOnce=this.$panel.find(".js-play-once"),this.$preview_switcher=this.$panel.find(".bottom-block .preview"),this.$steps_container=this.$panel.find(".resizable-content"),this.$step_selector=this.$panel.find(".js-step-selector"),this.$step_selector.find(".js-prev-step").on("click",this.prevStepClick),this.$step_selector.find(".js-next-step").on("click",this.nextStepClick),this.$steps_container.on("click",".param-wrapper.start-block .start-popup-item",this.startItemClick),this.$steps_container.on("click",".param-wrapper.acceleration-block .acceleration-popup-item",this.accelerationItemClick),this.$steps_container.on("mouseenter mouseleave",".param-wrapper.acceleration-block .acceleration-popup-item",this.accelerationItemMouseEnterLeave),this.$steps_container.on("click",".remove-effect",this.removeEffectClick),this.$steps_container.on("click",".effects-presets-wrapper .effects-item",this.addStepClick),this.$steps_container.on("click",".effects-presets-wrapper .presets-item",this.usePresetClick),this.$steps_container.on("click",".effects-presets-wrapper .presets-item .preview",this.previewPresetClick),this.$panel.on("click",".unite-button",this.uniteClick),this.$loop_repeat.on("click",this.onLoopTypeClick),this.$loop_swing.on("click",this.onLoopTypeClick),this.$playOnce.on("click",this.onPlayOnceClick),this.$preview_switcher.on("click",this.togglePreviewMode),this.$panel.on("click",".top-block .type-popup-item",this.typeSelectorItemClick),this.$panel.on("click",".bottom-block .add-effect .effect-popup-item",this.addEffectItemClick),this.$panel.on("click",".top-block .reset-button",this.resetClick),this.$panel.on("click",".js-change-animation",this.onAnimationSelect),this.$panel.on("click",".js-remove-animation",this.onAnimationRemove),this.popupManager=new H,this.popupManager.addPopup({$parent:this.$panel,name:"type-selector",selector:".js-change-type",popupSelector:".js-change-type-popup"}),this.popupManager.addPopup({$parent:this.$panel,name:"add-animation",selector:".js-add-animation",popupSelector:".js-add-animation-popup"}),this.popupManager.addPopup({$parent:this.$panel,name:"steps",selector:".js-step-selector:not(.one-step)",popupSelector:".js-step-popup"}),this.popupManager.addPopup({$parent:this.$panel,name:"add-effect",selector:".bottom-block .add-effect",popupSelector:".bottom-block .effect-popup",cbOpen:this.updateEffectPopupState}),this.popupManager.addPopup({$parent:this.$panel,name:"start-selector",selector:".resizable-content .param-wrapper.start-block",popupSelector:".resizable-content .param-wrapper.start-block .start-popup"}),this.popupManager.addPopup({$parent:this.$panel,name:"acceleration-selector",selector:".resizable-content .param-wrapper.acceleration-block",popupSelector:".resizable-content .param-wrapper.acceleration-block .acceleration-popup",cbOpen:this.updateAccelerationPopupState}),RM.constructorRouter.bindGlobalKeyPress([{key:"a",handler:this.onClick}]),this.listenTo(this.someModel,"animation:trigger:add",this.onAnimationTriggerAdd),this.listenTo(this.someModel,"animation:trigger:remove",this.onAnimationTriggerRemove),this.$step_selector.find(".js-step-popup").sortable({items:".js-step-popup-item",distance:10,axis:"y",scrollSpeed:10,containment:"parent",tolerance:"pointer",start:this.onStepsSortStart.bind(this),stop:this.onStepsSortEnd.bind(this)}),Object(o.a)("").add(this.$loop_swing).add(this.$loop_repeat).RMAltText({cssClass:"loop-type-tooltip",offset:-4})},unBindLogic:function(){this.master.workspace.off("paste-animation",this.onAnimationPaste),this.$step_selector.find(".js-prev-step").off("click",this.prevStepClick),this.$step_selector.find(".js-next-step").off("click",this.nextStepClick),this.$steps_container.off("click",".param-wrapper.start-block .start-popup-item",this.startItemClick),this.$steps_container.off("click",".param-wrapper.acceleration-block .acceleration-popup-item",this.accelerationItemClick),this.$steps_container.off("mouseenter mouseleave",".param-wrapper.acceleration-block .acceleration-popup-item",this.accelerationItemMouseEnterLeave),this.$steps_container.off("click",".remove-effect",this.removeEffectClick),this.$steps_container.off("click",".effects-presets-wrapper .effects-item",this.addStepClick),this.$steps_container.off("click",".effects-presets-wrapper .presets-item",this.usePresetClick),this.$steps_container.off("click",".effects-presets-wrapper .presets-item .preview",this.previewPresetClick),this.$panel.off("click",".unite-button",this.uniteClick),this.removeTriggerButtons(),this.$loop_repeat.off("click",this.onLoopTypeClick),this.$loop_swing.off("click",this.onLoopTypeClick),this.$playOnce.off("click",this.onPlayOnceClick),this.$preview_switcher.off("click",this.togglePreviewMode),this.$panel.off("click",".top-block .type-selector .type-popup-item",this.typeSelectorItemClick),this.$panel.off("click",".bottom-block .add-effect .effect-popup-item",this.addEffectItemClick),this.$panel.off("click",".top-block .reset-button",this.resetClick),this.popupManager.destroy(),delete this.popupManager,RM.constructorRouter.unbindGlobalKeyPress("a",this.onClick),this.stopListening(this.someModel,"animation:trigger:add"),this.stopListening(this.someModel,"animation:trigger:remove")},onPlayOnceClick:function(){var t=this;this.setAnimation({playOnce:!(this.someModel.getAnimations().find((function(e){return e.UUID===t.currentUuid}))||{}).playOnce},this.currentUuid),this.updatePlayOnce()},updatePlayOnce:function(){var t=this;this.$playOnce.toggleClass("active",Boolean(this.someModel.getAnimations().find((function(e){return e.UUID===t.currentUuid})).playOnce))},startPreviewMode:function(){this.isPreviewMode||(this.isPreviewMode=!0,this.$preview_switcher.text("Stop").addClass("active"),this.animationSteps&&this.animationSteps.startPreviewMode())},updatePreviewMode:function(){this.isPreviewMode&&this.animationSteps&&this.animationSteps.updatePreviewMode()},stopPreviewMode:function(){this.isPreviewMode&&(this.isPreviewMode=!1,this.$preview_switcher.text("Preview").removeClass("active"),this.animationSteps&&this.animationSteps.stopPreviewMode())},togglePreviewMode:function(){this.isPreviewMode?this.stopPreviewMode():this.startPreviewMode()},onAnimationPaste:function(){this.selected?this.updateAll():this.onClick()},renderStep:function(t,e){var i,n,a=this.block.getAnimationTriggers(this.currentUuid),r=a&&a.length>0,l=this.block.id,c=a&&1===a.length&&a.includes(l);this.isSwitcherVisible=Object(u.a)("constructor.hidingSwitcher")&&r&&!c&&0===e&&this.doesOpacityHaveDefaultvalues(),i=s.a.extend({index:e,isSwitcherVisible:this.isSwitcherVisible},t),n=Object(o.a)(this.step_template(i)),e>0?this.$steps_container.find(".step").eq(e-1).after(n):this.$steps_container.append(n),n.find("input").each(s.a.bind((function(t,e){var i=Object(o.a)(e).RMNumericInput({onChange:this.onParamInputChange,labelSelector:".units:not(.for-centering)",autoSize:!0}).data("changeValue");Object(o.a)(e).data("cb",i)}),this));var h=n.find(".js-start-when-in-view-switcher");h.length&&h.RMSwitcher({state:i.startWhenInView,height:26,width:44,"color-0":"#0078ff","color-1":"#c9c8c9","text-color-0":"transparent","text-color-1":"transparent"},this.onSwitcherChange.bind(this));var d=n.find(".js-hide-in-editor-switcher");d.length&&d.RMSwitcher({state:i.hideInEditor,height:26,width:44,"color-0":"#0078ff","color-1":"#c9c8c9","text-color-0":"transparent","text-color-1":"transparent"},this.onHidingSwitcherChange.bind(this))},destroyStep:function(t){this.$steps_container.find(".step").eq(t).remove()},destroyAllSteps:function(t){this.$steps_container.find(".step").remove()},updateStepsIndexes:function(){this.$steps_container.find(".step").each((function(t,e){Object(o.a)(e).attr("data-ind",t)}))},prevStepClick:function(t){var e=this;t.stopPropagation(),this.switchStep({updateWorkspaceSelectedStep:!0,cur:(this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})).selected||0)-1})},nextStepClick:function(t){var e=this;t.stopPropagation(),this.switchStep({updateWorkspaceSelectedStep:!0,cur:(this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})).selected||0)+1})},onStepPopupItemClick:function(t){var e=this,i=Object(o.a)(t.target).closest(".js-step-popup-item"),s=parseInt(i.data("ind"),10);s!==this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})).selected&&this.switchStep({updateWorkspaceSelectedStep:!0,cur:s})},onAnimationStepsSelect:function(t){this.switchStep({updateWorkspaceSelectedStep:!1,cur:t})},onStepsSortStart:function(){this.$(".js-step-popup").addClass("grabbing")},onStepsSortEnd:function(){this.$(".js-step-popup").removeClass("grabbing"),this.reorderSteps()},reorderSteps:function(){var t=this,e=this.someModel.getAnimations().find((function(e){return e.UUID===t.currentUuid})),i=e.steps,n=e.selected,a=[];s.a.each(this.$step_selector.find(".js-step-popup-item"),function(t,e){var s=Object(o.a)(t).data("ind");s===n&&this.setAnimation({selected:e},this.currentUuid);var r=i[s];a.push(r)}.bind(this)),this.setAnimation({steps:a},this.currentUuid),this.animationSteps&&this.animationSteps.updateSteps(),this.showSelectedStep({updateWorkspaceSelectedStep:!0})},switchStep:function(t){var e=this,i=this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})).steps.length;t.cur>=i||t.cur<0||(this.setAnimation({selected:t.cur},this.currentUuid,{historyMergeID:"selected",skipPreviewUpdate:!0}),this.showSelectedStep({updateWorkspaceSelectedStep:t.updateWorkspaceSelectedStep}),this.__scrollRecalc_debounced(),RM.analytics&&RM.analytics.sendEvent("Animation Switch Steps"))},addStepClick:function(t){var e=Object(o.a)(t.currentTarget).attr("data-value");this.addStep({use_effect:e}),RM.analytics&&RM.analytics.sendEvent("Animation Choose Effect",e.split("_").pop())},addStep:function(t){var e=this;t=t||{};var i,o=s.a.cloneWithObjects(this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})).steps),n=s.a.cloneWithObjects(this.DEFAULT_ANIMATION_STEP),a={};if("initial"!=t.after_step?i=null!=t.after_step?t.after_step+1:o.length:(i=0,a.from_opacity=o[0].from_opacity,a.from_rotate=o[0].from_rotate,a.from_scale=o[0].from_scale,o[0].use_opacity&&(a.use_opacity=!0,a.opacity=o[0].from_opacity),o[0].use_rotate&&(a.use_rotate=!0,a.rotate=o[0].from_rotate),o[0].use_scale&&(a.use_scale=!0,a.scale=o[0].from_scale),s.a.extend(n,a)),o.splice(i,0,n),this.setAnimation({selected:i,steps:o},this.currentUuid),1==o.length)return this.updateAll(),void this.addEffectItem(t.use_effect);this.renderStep(n,i),this.updateStepsIndexes(),this.animationSteps&&this.animationSteps.updateSteps(),this.showSelectedStep({updateWorkspaceSelectedStep:!0}),this.__scrollRecalc_debounced(),this.addEffectItem(t.use_effect),RM.analytics&&RM.analytics.sendEvent("Animation Add Step",i)},usePresetClick:function(t){if(!Object(o.a)(t.target).closest(".preview").length){var e=Object(o.a)(t.currentTarget).attr("data-value");this.setAnimation(this.PRESETS[e],this.currentUuid),this.updateAll(),RM.analytics&&RM.analytics.sendEvent("Animation Use Preset",e)}},previewPresetClick:function(t){},removeStep:function(t){var e=this,i=s.a.cloneWithObjects(this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})).steps),o={};if((0==t||"initial"==t)&&1==i.length)return this.setAnimation({selected:void 0,steps:[]},this.currentUuid),void this.updateAll();if(0==t&&i.length>1){var n=y.a.getNormalizedAnimation(this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})),this.isFixed,this.isFullwidth,this.isFullheight,1);o.from_opacity=i[0].from_opacity,o.from_rotate=i[0].from_rotate,o.from_scale=i[0].from_scale,i[0].use_opacity&&(o.opacity=n.steps[1].opacity,o.use_opacity=!0),i[0].use_rotate&&(o.rotate=n.steps[1].rotate,o.use_rotate=!0),i[0].use_scale&&(o.scale=n.steps[1].scale,o.use_scale=!0),s.a.extend(i[1],o)}"initial"!=t&&(i.splice(t,1),this.setAnimation({selected:t==i.length?t-1:t,steps:i},this.currentUuid),this.destroyStep(t),this.updateStepsIndexes(),this.animationSteps&&this.animationSteps.updateSteps({animateStepInd:t}),this.showSelectedStep({updateWorkspaceSelectedStep:!0}),this.__scrollRecalc_debounced(),RM.analytics&&RM.analytics.sendEvent("Animation Remove Step",t))},resetClick:function(){this.setAnimation({},this.currentUuid),this.updateAll()},uniteClick:function(){var t={},e=0,i=null;this.models.forEach((function(s){var o=y.a.getUuidHash(s.getAnimations());t[o]=(t[o]||0)+1,t[o]>e&&(i=s,e=t[o])})),this.setAnimations(i.getAnimations(),{skipHistory:!0}),this.updateAll()},onAnimationStepsChange:function(t){var e=this,i=t.id,o=s.a.cloneWithObjects(this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})).steps),n=!1;delete t.id,o[i]&&(s.a.extend(o[i],t),null==t.dx||o[i].use_move||(o[i].use_move=!0,n=!0),null==t.scale&&null==t.from_scale||o[i].use_scale||(o[i].use_scale=!0,n=!0),this.setAnimation({steps:o},this.currentUuid,{historyMergeID:s.a.keys(t).join("-")}),n&&this.updateCurrentStepParams({visibility:!0}),i==this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})).selected&&this.updateCurrentStepInputs(s.a.keys(t)))},onAnimationSelect:function(t){var e=Object(o.a)(t.currentTarget).data("uuid");this.switchToAnimation(e)},onAnimationRemove:function(t){var e=Object(o.a)(t.currentTarget).data("uuid"),i=this.someModel.getAnimations();if(i.length>1){var s=i.filter((function(t){return t.UUID!==e}));this.setAnimations(s),this.currentUuid===e?this.switchToAnimation(s[s.length-1].UUID):this.updateType()}else this.setAnimations([]),this.updateAll()},typeSelectorItemClick:function(t){var e=Object(o.a)(t.currentTarget).data("uuid")||r.b.generateUUID(),i=Object(o.a)(t.currentTarget).attr("data-value"),s=this.someModel.getAnimations().find((function(t){return t.UUID===e})),n=(s&&s.type)!==i;this.setAnimation({type:i},e),this.switchToAnimation(e,n)},switchToAnimation:function(t,e){var i=this.someModel.getAnimations().find((function(e){return e.UUID===t})),s=i&&i.type,o=this.checkPreviewEnabled(s),n=this.currentUuid!==t||e;if(o)return this.setAnimation({type:s},t),this.popupManager.closePopup("type-selector"),this.updateAll(),this.setAnimation({type:"none"},t),this.someModel.trigger("animation:type:change","none",t),void(this.animationSteps&&this.animationSteps.destroy());this.currentUuid=t,s&&this.setAnimation({type:s},t),this.popupManager.closePopup("type-selector"),n||this.someModel.get("preview_enabled")?this.updateAll():(this.updateType(),this.updateCurrentStepParams({visibility:!0,start:!0,delay:!0,duration:!0,delay_px:!0}),this.updateCurrentStepInputs()),e&&this.someModel.trigger("animation:type:change",s,t),RM.analytics&&RM.analytics.sendEvent("Animation Type Change",s)},addType:function(t){t.preventDefault()},addEffectItemClick:function(t){this.addEffectItem(Object(o.a)(t.currentTarget).attr("data-value")),this.popupManager.closePopup("add-effect")},addEffectItem:function(t){var e=this,i=this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})),o=i.selected||0,n={};if(!i.steps[o][t]){var a=s.a.cloneWithObjects(i.steps),r=y.a.getNormalizedAnimation(i,this.isFixed,this.isFullwidth,this.isFullheight,1);a[o][t]=!0,"use_move"==t&&null==a[o].dx&&(n.dx=r.steps[o].dx,n.dy=r.steps[o].dy+10),"use_opacity"==t&&null==a[o].opacity&&(n.opacity=Math.round(r.steps[o].opacity)),"use_rotate"==t&&null==a[o].rotate&&(n.rotate=r.steps[o].rotate+45),"use_scale"==t&&null==a[o].scale&&(n.scale=Math.round(.7*r.steps[o].scale)),s.a.extend(a[o],n),this.setAnimation({steps:a},this.currentUuid),this.updateCurrentStepParams({visibility:!0}),this.animationSteps&&this.animationSteps.updateSteps({animateStepInd:o}),this.__scrollRecalc_debounced(),this.updateCurrentStepInputs()}},removeEffectClick:function(t){var e=this,i=this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})),n=Object(o.a)(t.target).closest(".step").attr("data-ind")-0,a=Object(o.a)(t.currentTarget).attr("data-value"),r=s.a.cloneWithObjects(i.steps);r[n][a]=!1,this.setAnimation({steps:r},this.currentUuid),this.updateCurrentStepParams({visibility:!0}),this.animationSteps&&this.animationSteps.updateSteps({animateStepInd:n}),this.__scrollRecalc_debounced()},onTriggerButtonClick:function(t){var e=Object(o.a)(t.target).closest("[data-id]").data("id"),i=this.getTriggerButtonState(e),n=this.block.id;"none"===i.status?this.updateTriggerButton(e,"pending"):"onOtherPage"===i.status&&i.pageNumber&&(t.stopPropagation(),RM.constructorRouter.once("pageChange",(function(t){setTimeout((function(){var e=s.a.find(t.blocks,(function(t){return t.id==n}));e&&e.onClick()}),0)})),RM.constructorRouter.showWorkspace(i.pageNumber))},onTriggerCancelClick:function(t){var e=Object(o.a)(t.target).closest("[data-id]").data("id");t.stopPropagation(),this.removeTriggerButton(e)},onTriggerRemoveClick:function(t){t.stopPropagation();var e=Object(o.a)(t.target).closest("[data-id]").data("id"),i=this.block.getAnimationTriggers(this.currentUuid);-1!==i.indexOf(e)&&(this.highlightActiveTriggerBlock(e,!1,!0),this.setAnimation({trigger:s.a.without(i,e)},this.currentUuid),this.someModel.trigger("animation:trigger:remove",e)),RM.analytics&&RM.analytics.sendEvent("Animation Trigger Remove")},onTriggerNameMouseEnter:function(t){this.highlightActiveTriggerBlock(Object(o.a)(t.target).closest("[data-id]").data("id"),!0,!1)},onTriggerNameMouseLeave:function(){this.highlightActiveTriggerBlock(Object(o.a)(event.target).closest("[data-id]").data("id"),!1,!1)},onTriggerRemoveMouseEnter:function(t){this.highlightActiveTriggerBlock(Object(o.a)(t.target).closest("[data-id]").data("id"),!0,!0)},onTriggerRemoveMouseLeave:function(t){this.highlightActiveTriggerBlock(Object(o.a)(t.target).closest("[data-id]").data("id"),!1,!0)},onTriggerClick:function(t,e){if(y.a.canBeExternalTrigger(t,this.block)){e.stopPropagation();var i=t.id;this.highlightActiveTriggerBlock(i,!1,!1),this.setAnimation({trigger:this.removeMissingTriggers(this.block.getAnimationTriggers(this.currentUuid)).concat(i)},this.currentUuid),this.someModel.trigger("animation:trigger:add",i),RM.analytics&&RM.analytics.sendEvent("Animation Trigger Click")}},onTriggerMouseEnter:function(t){this.highlightPendingTriggerBlock(Object(o.a)(t.target).closest(".block").data("id"),!0)},onTriggerMouseLeave:function(t){this.highlightPendingTriggerBlock(Object(o.a)(t.target).closest(".block").data("id"),!1)},onLoopTypeClick:function(t){if(!this.$loop_types.hasClass("disabled")){var e=Object(o.a)(t.target);this.setAnimation({loop:!e.hasClass("checked")&&e.data("value")},this.currentUuid),this.updateLoop()}},highlightPendingTriggerBlock:function(t,e){var i=t&&this.master.workspace.findBlock(t);i&&i.highlight(e&&y.a.canBeExternalTrigger(i,this.block),y.a.ACTIVE_TRIGGER_HIGHLIGHT_CLASS)},highlightActiveTriggerBlock:function(t,e,i){var s=t&&this.master.workspace.findBlock(t),o=s&&1===this.blocks.length&&this.block.id===s.id,n=i?y.a.ACTIVE_TRIGGER_REMOVE_CLASS:y.a.ACTIVE_TRIGGER_HIGHLIGHT_CLASS;s&&s.highlight(e,n);var a=this.block.triggerAssets&&this.block.triggerAssets[t];if(a){var r=o?this.block.ownTooltip&&this.block.ownTooltip.getElement():a.tooltip&&a.tooltip.getElement();r&&r.toggleClass(n,Boolean(e))}},updateTriggerButtonHandlers:function(t){var e=s.a.map(t,(function(t){return t.status})),i=-1!==e.indexOf("pending")?"pending":-1!==e.indexOf("active")?"active":"none",o=this.master.workspace.getBlockElements(y.a.EXTERNAL_TRIGGER_BLOCK_EXCLUDE),n=o.not(s.a.map(this.block.getAnimationTriggers(this.currentUuid),(function(t){return'[data-id="'+t+'"]'})).join(", ")),a=function(){this.master.workspace.on("block:click",this.onTriggerClick),n.on("mouseenter",this.onTriggerMouseEnter),n.on("mouseleave",this.onTriggerMouseLeave)}.bind(this),r=function(){this.master.workspace.off("block:click",this.onTriggerClick),o.off("mouseenter",this.onTriggerMouseEnter),o.off("mouseleave",this.onTriggerMouseLeave)}.bind(this);switch(i){case"pending":this.waitingForTriggerClick=!0,a(),this.block.animationMode&&(this.willRestoreAnimationMode=!0,this.destroyAnimationSteps());break;case"active":case"onOtherPage":case"none":s.a.delay(function(){this.waitingForTriggerClick=!1}.bind(this)),r(),this.willRestoreAnimationMode&&(this.willRestoreAnimationMode=!1,this.initializeAnimationSteps())}},renderTriggerButton:function(t,e,i){var s=t&&this.master.workspace.findBlock(t),o=s&&1===this.blocks.length&&this.block.id===s.id;return A.a["template-constructor-control-common_animation-trigger"]({id:t,status:e,pageNumber:i,isSelf:o,triggerBlockName:s&&s.model.get("name")||s&&s.getStandardName()||"Trigger"})},getTriggerButtonState:function(t){return this.triggerButtonsState&&this.triggerButtonsState[t]||{}},getStepIndex:function(t){return Object(o.a)(t).closest(".step").attr("data-ind")-0},changeStepField:function(t,e){var i=this,o=this.someModel.getAnimations().find((function(t){return t.UUID===i.currentUuid})),n=s.a.cloneWithObjects(o.steps);s.a.extend(n[t],e),this.setAnimation({steps:n},this.currentUuid)},onSwitcherChange:function(t){this.changeStepField(0,{startWhenInView:t})},onHidingSwitcherChange:function(t){this.changeStepField(0,{hideInEditor:t})},startItemClick:function(t){var e=Object(o.a)(t.currentTarget).attr("data-value");this.changeStepField(this.getStepIndex(t.target),{start_point:e}),this.updateCurrentStepParams({start:!0})},accelerationItemClick:function(t){var e=Object(o.a)(t.currentTarget).attr("data-value");this.changeStepField(this.getStepIndex(t.target),{acceleration:e}),this.popupManager.closePopup("acceleration-selector"),this.updateCurrentStepParams({acceleration:!0})},accelerationItemMouseEnterLeave:function(t){var e=Object(o.a)(t.currentTarget).siblings(".acceleration-popup-preview").find(".ball"),i="mouseenter"==t.type?Object(o.a)(t.currentTarget).attr("data-value"):"";if(e.attr("data-acceleration")||""){var s=y.a.ANIMATION_PROPERTIES.animationIterationJS;e.off().one(s,(function(t){0==Math.round(t.originalEvent.elapsedTime/.7)%2?(e.attr("data-acceleration",""),e.outerHeight(),e.attr("data-acceleration",i)):e.off().one(s,(function(t){e.attr("data-acceleration",""),e.outerHeight(),e.attr("data-acceleration",i)}))}))}else e.attr("data-acceleration",i)},onParamInputChange:function(t,e){var i=this,n=this.getStepIndex(t),a=s.a.cloneWithObjects(this.someModel.getAnimations().find((function(t){return t.UUID===i.currentUuid})).steps),r=Object(o.a)(".move-block .numeric-input.left-align")[0].value,l=Object(o.a)(".move-block .numeric-input.right-align")[0].value,c=t.attr("data-param");if(r>9999||r<-9999||l>9999||l<-9999?Object(o.a)(".move-block .numeric-input").css("font-size","18px"):Object(o.a)(".move-block .numeric-input").css("font-size","22px"),a[n]&&(a[n][c]=e,this.setAnimation({steps:a},this.currentUuid,{historyMergeID:c}),s.a.contains(["rotate","scale","opacity","dx","dy","from_rotate","from_scale","from_opacity"],c)&&this.animationSteps&&this.animationSteps.updateSteps(),s.a.contains(["opacity","from_opacity"],c)&&0===n&&this.onOpacityChange(),"start_offset"==c&&this.updateCurrentStepParams({start:!0}),s.a.contains(["delay","duration","delay_px"],c))){var h={};h[c]=!0,this.updateCurrentStepParams(h)}},onOpacityChange:function(){this.doesOpacityHaveDefaultvalues()||this.changeStepField(0,{hideInEditor:!1}),(this.doesOpacityHaveDefaultvalues()&&!this.isSwitcherVisible||!this.doesOpacityHaveDefaultvalues()&&this.isSwitcherVisible)&&(this.updateSteps(),this.updateStepsIndexes(),this.showSelectedStep({updateWorkspaceSelectedStep:!0}))},doesOpacityHaveDefaultvalues:function(){var t=this,e=this.someModel.getAnimations().find((function(e){return e.UUID===t.currentUuid})),i=e&&e.steps&&e.steps[0]&&e.steps[0].from_opacity,s=e&&e.steps&&e.steps[0]&&e.steps[0].opacity;return 0===i&&100===s},onAnimationTriggerAdd:function(t){this.updateTriggerButton(t,"active")},onAnimationTriggerRemove:function(t){this.removeTriggerButton(t)},initializeAnimationSteps:function(){this.animationSteps=new O({uuid:this.currentUuid,blocks:this.blocks,workspace:this.master.workspace,isFixed:this.isFixed,isFullwidth:this.isFullwidth,isFullheight:this.isFullheight,isSticked:this.isSticked,popupManager:this.popupManager});var t=parseInt(this.animationSteps.$el.css("z-index"),10),e=s.a.max(s.a.map(this.blocks,(function(t){return t.model.attributes.z})));s.a.each(this.block.getTriggerBlocks(),(function(i,s){var o=i.$el.css("z-index"),n=i.model.attributes.z;e<n&&i.$el.css({"z-index":t+s+1}),i.$el.data({"original-element-z-index":o})})),this.updateSteps(),this.updateStepsIndexes(),this.showSelectedStep({updateWorkspaceSelectedStep:!0}),this.animationSteps.on("move scale",this.onAnimationStepsChange),this.animationSteps.on("add-step",this.addStep),this.animationSteps.on("remove-step",this.removeStep),this.animationSteps.on("select",this.onAnimationStepsSelect)},destroyAnimationSteps:function(){this.animationSteps&&this.animationSteps.destroy(),s.a.each(this.block.getTriggerBlocks(),(function(t){var e=t.$el.data("original-element-z-index");t.$el.css({"z-index":e&&"auto"!==e?e:null})}))},updateAll:function(t){if(t=t||{},this.isFullwidth=!!this.someModel.get("is_full_width"),this.isFullheight=!!this.someModel.get("is_full_height"),this.isFixed=!!this.someModel.get("fixed_position"),this.isSticked=!!this.someModel.get("sticked"),this.isMobileViewport="default"!=this.master.workspace.page.getCurrentViewport(),this.$panel.find('.top-block .type-selector .type-popup-item[data-value="hover"]').toggle(!this.isMobileViewport),this.updateControlState(),this.destroyAnimationSteps(),this.updateType(),!this.checkWidgetsCompatibility())return this.updateBlockHeight(),void this.stopPreviewMode();this.updateBlockHeight(),this.popupManager&&this.popupManager.closeAllPopups(),this.initializeAnimationSteps(),this.updateLoop(),this.updatePlayOnce(),this.resetTriggerButtons(),this.__scrollRecalc_debounced&&this.__scrollRecalc_debounced()},updateControlState:function(){this.$el.toggleClass("has-animation",s.a.any(this.models,(function(t){return t.getAnimations().length})))},checkWidgetsCompatibility:function(){var t=this,e=0,i=0,n=[],a=0,r=0,l=0,c=0,h={};if(s.a.each(this.models,s.a.bind((function(t){t.get("fixed_position")&&(i++,n.push(t.get("fixed_position"))),t.get("is_full_width")&&a++,t.get("is_full_height")&&r++,t.get("sticked")&&l++,y.a.canHaveAnimation(t)||c++,t.get("fixed_position")||t.get("is_full_width")||t.get("is_full_height")||t.get("sticked")||e++,h[y.a.getUuidHash(t.getAnimations())]=!0}),this)),this.$panel.removeClass("show-mixed-types show-multiple-fixeds show-multiple-stickeds show-multiple-fullwidths show-multiple-fullheights show-multiple-animations animation-disabled animation-without-steps show-non-animatable"),this.models.length>1){if(e&&(i||a||r||l)||!e&&(i&&a||i&&r||i&&l||l&&a||l&&r||a&&r))return this.$panel.addClass("show-mixed-types"),this.toggleFixedPanelSize(!0,this.MESSAGE_MIXED_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Mixed Types"),!1;if(i)return this.$panel.addClass("show-multiple-fixeds"),this.toggleFixedPanelSize(!0,this.MESSAGE_MULTIPLE_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Multiple Fixed"),!1;if(l)return this.$panel.addClass("show-multiple-stickeds"),this.toggleFixedPanelSize(!0,this.MESSAGE_MULTIPLE_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Multiple Sticky"),!1;if(a)return this.$panel.addClass("show-multiple-fullwidths"),this.toggleFixedPanelSize(!0,this.MESSAGE_MULTIPLE_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Multiple Full Width"),!1;if(r)return this.$panel.addClass("show-multiple-fullheights"),this.toggleFixedPanelSize(!0,this.MESSAGE_MULTIPLE_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Multiple Full Height"),!1;if(c)return this.$panel.addClass("show-non-animatable"),this.toggleFixedPanelSize(!0,this.MESSAGE_NON_ANIMATABLE_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Cannot Animate Group"),!1;if(s.a.keys(h).length>1)return this.$panel.addClass("show-multiple-animations"),this.toggleFixedPanelSize(!0,this.MESSAGE_UNITE_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Unite Animations Confirm"),!1}var d=this.someModel.getAnimations(),p=d.find((function(e){return e.UUID===t.currentUuid}))||{};return d.length&&p&&"none"!==p.type?s.a.isEmpty(p.steps)?(this.$panel.addClass("animation-without-steps"),this.$panel.find('.effects-presets-wrapper .effects-item[data-value="use_rotate"]').toggle(!(this.isFullwidth||this.isFullheight)),this.$panel.find('.effects-presets-wrapper .presets-item[data-value="rotate"]').toggle(!(this.isFullwidth||this.isFullheight)),this.destroyAllSteps(),this.toggleFixedPanelSize(!1),this.resizableScroll&&this.resizableScroll.changeGaps({gap_start:16}),this.__scrollRecalc_debounced&&this.__scrollRecalc_debounced(),!1):(this.resizableScroll&&this.resizableScroll.changeGaps({gap_start:88}),this.toggleFixedPanelSize(!1),!0):(this.$panel.addClass("animation-disabled"),this.toggleFixedPanelSize(!0,Object(o.a)(".js-top-block").height()),!1)},updateEffectPopupState:function(t){var e=this,i=this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid}))||{},o=i.selected||0,n=i.steps[o];t.find('.effect-popup-item[data-value="use_rotate"]').toggle(!(this.isFullwidth||this.isFullheight)),s.a.each(["use_move","use_opacity","use_rotate","use_scale"],(function(e){t.find('.effect-popup-item[data-value="'+e+'"]').toggleClass("used",!!n[e])}))},updateAccelerationPopupState:function(t){var e=t.position().top<130;t.toggleClass("shift-popup",e)},updateType:function(){var t=this,e=this.someModel.getAnimations(),i=e.find((function(e){return e.UUID===t.currentUuid}))||{},n=this.$panel.find(".js-top-block").empty(),a=i&&i.type,r=Object(o.a)(this.topBlockTemplate({animations:s.a.sortBy(e,(function(t){return y.a.EVENT_TYPES.indexOf(t.type)})),currentType:a,allowTriggers:function(t){return y.a.POINTER_EVENTS.includes(t.type)},currentUuid:this.currentUuid,max:y.a.EVENT_TYPES.length,renderTypePopup:function(i){var o=i.type,n=i.isInitial,r=i.uuid,l=i.cssClass;return t.typeSelectorTemplate({type:o,isInitial:n,uuid:r,cssClass:l,availableTypes:s.a.without.apply(s.a,[y.a.EVENT_TYPES].concat(L(e.map((function(t){return t.type!==o?t.type:void 0}))))),currentType:a})}}));n.append(r),this.resetTriggerButtons(),this.$panel.toggleClass("show-trigger",y.a.isExternalTriggerAllowed(a)&&!s.a.isEmpty(i&&i.steps)),this.$panel.toggleClass("show-loops","scroll"!==a),this.$panel.toggleClass("show-start-condition","load"===a),this.$panel.toggleClass("show-play-once","click"===a),this.toggleRequiresTrigger(),this.checkPreviewEnabled(),window.requestAnimationFrame(this.resizableScroll.recalc.bind(this.resizableScroll)),this.updateBlockHeight()},toggleRequiresTrigger:function(){var t=this,e=this.someModel.getAnimations().find((function(e){return e.UUID===t.currentUuid}))||{};this.$panel.toggleClass("show-requires-trigger",Boolean("click"===e.type&&!this.block.getAnimationTriggers(this.currentUuid).length&&"video"===this.someModel.get("type"))&&!s.a.isEmpty(e.steps)),this.updateCurrentStepInputs()},checkPreviewEnabled:function(t){var e=this,i=t||(this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid}))||{}).type,s=Boolean(this.someModel.get("preview_enabled")),o=Boolean("click"===i&&s);return this.$panel.toggleClass("show-cannot-use-with-picture-preview",o),this.updateCurrentStepInputs(),o},resetTriggerButtons:function(){this.updateTriggerButtons(s.a.reduce(this.block.getAnimationTriggers(this.currentUuid),function(t,e){return t[e]=this.verifyTriggerState(e,"active"),t}.bind(this),{}))},removeTriggerButton:function(t){if(t)var e="new"===t?s.a.extend({},this.triggerButtonsState,{new:{status:"none"}}):s.a.omit(this.triggerButtonsState,t);this.updateTriggerButtons(e),this.isSwitcherVisible&&(this.changeStepField(0,{hideInEditor:!1}),this.updateSteps(),this.updateStepsIndexes(),this.showSelectedStep({updateWorkspaceSelectedStep:!0}))},removeTriggerButtons:function(){this.updateTriggerButtons({})},updateTriggerButton:function(t,e){if(t){var i={};i[t]=this.verifyTriggerState(t,e);var o=s.a.extend({},s.a.omit(this.triggerButtonsState,"new"),i);this.updateTriggerButtons(o)}},updateTriggerButtons:function(t){!(t=s.a.omit(t,(function(t,e){return"new"!==e&&t&&"none"===t.status}))).new&&s.a.keys(t).length<this.TRIGGER_COUNT_LIMIT&&(t.new={status:"none"});var e=Object(o.a)(document.createDocumentFragment());s.a.each(t,function(t,i){e.append(this.renderTriggerButton(i,t.status,t.pageNumber))}.bind(this)),this.$panel.find(".js-trigger-buttons-container").empty().append(e),this.updateTriggerButtonHandlers(t),this.triggerButtonsState=t,this.updateBlockHeight(),this.toggleRequiresTrigger(),this.checkPreviewEnabled()},updateBlockHeight:function(){var t=this,e=(this.someModel.getAnimations().find((function(e){return e.UUID===t.currentUuid}))||{}).type||"none",i=this.$panel.find(".js-top-block"),s=this.$panel.find(".js-top-block-content"),o=this.$panel.find(".js-step-selector"),n=s.outerHeight();i.css({height:"none"===e?"":n}),this.$panel.find(".resizable-scroll-wrapper").css({top:n+(o[0]&&o[0].offsetHeight||0)}),o.css({top:n}),this.__scrollRecalc_debounced()},verifyTriggerState:function(t,e){if(-1!==["pending","none"].indexOf(e))return{status:e};var i=t&&this.master.workspace.findBlock(t),s=t&&!i?this.master.workspace.mag.getWidgetPage(t):null;return i?{status:"active"}:s&&s.id!==this.master.workspace.page.id?{status:"onOtherPage",pageNumber:s.attributes.num}:{status:"none"}},removeMissingTriggers:function(t){return s.a.filter(t,function(t){return t&&this.master.workspace.findBlock(t)||this.master.workspace.mag.getWidgetPage(t)}.bind(this))},updateCurrentStepParams:function(t){var e=this,i=this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid}))||{},n=i.type||"none",a=i.selected||0,r=i.steps;if(!s.a.isEmpty(r)){var l=this.$steps_container.find(".step").eq(a),c=r[a];if(t.visibility&&(Object(o.a)(" .param-wrapper.delay-block, .param-wrapper.duration-block",l).toggleClass("hide-unallowed","scroll"==n),Object(o.a)(".param-wrapper.delay_px-block",l).toggleClass("hide-unallowed","scroll"!=n||0==a&&!this.isFixed),Object(o.a)(".param-wrapper.speed-block",l).toggleClass("hide-unallowed","scroll"!=n),Object(o.a)(".param-wrapper.start-block",l).toggleClass("hide-unallowed","scroll"!=n||a>0||this.isFixed),Object(o.a)(".param-wrapper.move-block",l).toggleClass("hide-dx-input",this.isFullwidth),Object(o.a)(".param-wrapper.move-block",l).toggleClass("hide-dy-input",this.isFullheight),Object(o.a)(".param-wrapper.rotate-block",l).toggleClass("hide-unallowed",this.isFullwidth||this.isFullheight),Object(o.a)(".param-wrapper.opacity-block, .param-wrapper.rotate-block, .param-wrapper.scale-block",l).toggleClass("hide-from-input",a>0),Object(o.a)(".param-wrapper.move-block",l).toggleClass("hide-unused",!c.use_move),Object(o.a)(".param-wrapper.opacity-block",l).toggleClass("hide-unused",!c.use_opacity),Object(o.a)(".param-wrapper.rotate-block",l).toggleClass("hide-unused",!c.use_rotate),Object(o.a)(".param-wrapper.scale-block",l).toggleClass("hide-unused",!c.use_scale)),t.start&&!Object(o.a)(".param-wrapper.start-block",l).hasClass("hide-unallowed")){var h;(h=Object(o.a)('.param-wrapper.start-block .start-popup .start-popup-item[data-value="'+c.start_point+'"]',l)).addClass("curr").siblings(".start-popup-item").removeClass("curr"),Object(o.a)(".param-wrapper.start-block .start-value",l).text(h.text()),Object(o.a)(".param-wrapper.start-block .start-popup",l).toggleClass("has-offset",!!c.start_offset);var d=63*{top:0,center:.5,bottom:1}[c.start_point],p=-63*c.start_offset/Object(o.a)(window).height(),u=Math.max(Math.min(d+p,63),0);Object(o.a)(".param-wrapper.start-block .start-preview .start-point",l).css("top",d),Object(o.a)(".param-wrapper.start-block .start-preview .start-dist",l).css({top:Math.min(d,u),bottom:63-Math.max(d,u)}),Object(o.a)(".param-wrapper.start-block .start-preview .start-offset",l).css("top",u)}if(t.acceleration)(h=Object(o.a)('.param-wrapper.acceleration-block .acceleration-popup .acceleration-popup-item[data-value="'+c.acceleration+'"]',l)).addClass("curr").siblings(".acceleration-popup-item").removeClass("curr"),Object(o.a)(".param-wrapper.acceleration-block .acceleration-value",l).text(h.text());s.a.each(["delay","duration","delay_px"],(function(e){if(t[e]&&!Object(o.a)(".param-wrapper."+e+"-block",l).hasClass("hide-unallowed")){var i;i="delay_px"==e?Math.min(76*c[e]/Object(o.a)(window).height(),76):Math.min(20*c[e],76),Object(o.a)(".param-wrapper."+e+"-block .bg",l).height(i)}}))}},updateCurrentStepInputs:function(t){var e=this,i=this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid}))||{},o=i.selected||0;t=t||["start_offset","delay","duration","delay_px","speed","dx","dy","opacity","rotate","scale"];if(!s.a.isEmpty(i.steps)){var n=this.$steps_container.find(".step").eq(o);s.a.each(t,(function(t){var e;((e=n.find('input[data-param="'+t+'"]').data("cb"))&&e(i.steps[o][t],!0),"opacity"==t||"rotate"==t||"scale"==t)&&(t="from_"+t,(e=n.find('input[data-param="'+t+'"]').data("cb"))&&e(i.steps[o][t],!0))}))}},updateStepsPopup:function(){var t=this,e=this.someModel.getAnimations().find((function(e){return e.UUID===t.currentUuid})),i=e.steps,n=e.selected||0,a=this.$step_selector.find(".js-step-popup-content"),r=A.a["template-constructor-control-common_animation-step-popup-item"],l=Object(o.a)(document.createDocumentFragment());s.a.each(i,(function(t,e){var i=r({index:e,text:"Step "+(e+1),isSelected:e===n});l.append(i)})),a.empty().append(l),a.off("click.popup-item"),a.on("click.popup-item",".js-step-popup-item",this.onStepPopupItemClick)},updateLoop:function(){var t=this;this.$loop_types.find("[data-value]").removeClass("checked");var e=y.a.normalizeLoopValue(this.someModel.getAnimations().find((function(e){return e.UUID===t.currentUuid})).loop);e&&this.$loop_types.find("[data-value="+e+"]").addClass("checked")},updateSteps:function(){var t=this;this.destroyAllSteps(),s.a.each(this.someModel.getAnimations().find((function(e){return e.UUID===t.currentUuid})).steps,this.renderStep)},showSelectedStep:function(t){var e=this;t=t||{};var i=this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})),s=i.steps.length,o=i.selected||0;this.$step_selector.toggleClass("one-step",1==s),this.$step_selector.find(".js-step-caption").text(1==s?"Step 1":"Step "+(o+1)+"/"+s),this.$step_selector.find(".js-prev-step").toggleClass("disabled",0==o),this.$step_selector.find(".js-next-step").toggleClass("disabled",o==s-1),this.$steps_container.find(".step").hide().eq(o).show(),this.updateCurrentStepParams({visibility:!0,acceleration:!0,start:!0,delay:!0,duration:!0,delay_px:!0}),this.updateCurrentStepInputs(),this.updateStepsPopup(),t.updateWorkspaceSelectedStep&&this.animationSteps.selectStep(o)},setAnimation:function(t,e,i){var o=!e||!this.someModel.getAnimations().find((function(t){return t.UUID===e}))?[].concat(L(this.someModel.getAnimations()),[D({loop:!1,selected:0,steps:[],UUID:e||r.b.generateUUID()},t||{})]):this.someModel.getAnimations().map((function(i){return i.UUID===e?D({},s.a.cloneWithObjects(i),{},t||{}):i}));this.setAnimations(o,i)},setAnimations:function(t,e){e=e||{};var i=s.a.map(this.models,(function(e){return{_id:e.get("_id"),animation:t}}));e.skipHistory||e.redo||e.undo||!this.undoController||(this.undoController.isEmpty()&&this.undoController.add(s.a.cloneWithObjects(this.someModel.getAnimations())),this.undoController.add.__debounced(t,{historyMergeID:e.historyMergeID})),this.master.workspace.set_group(i),!e.skipPreviewUpdate&&this.isPreviewMode&&this.updatePreviewMode(),this.hasChanges=!0},save:function(){this.hasChanges&&(this.setAnimations(this.someModel.getAnimations().map((function(t){return D({},t,{UUID:r.b.generateUUID()})})),{skipHistory:!0,skipPreviewUpdate:!0}),this.master.workspace.save_group(this.models,{skipHistory:!0}),delete this.hasChanges),b.prototype.save.apply(this,arguments)},onPanelScroll:function(t){},select:function(){b.prototype.select.apply(this,arguments),this.undoController=new F({control:this,pid:this.models[0].get("pid")});var t=this.someModel.getAnimations(),e=t.find((function(t){return!t.steps||!t.steps.length}))||t.find((function(t){return"none"!==t.type}));e&&!e.UUID&&(e.UUID=r.b.generateUUID()),this.currentUuid=e&&e.UUID,this.updateAll(),this.$panel.hide(),this.$panel.outerHeight(),this.$panel.show()},deselect:function(){this.stopPreviewMode(),this.destroyAnimationSteps(),this.popupManager&&this.popupManager.closeAllPopups&&this.popupManager.closeAllPopups(),this.save(),this.undoController&&this.undoController.destroy(),delete this.undoController,b.prototype.deselect.apply(this,arguments)},onClick:function(){this.selected&&this.popupManager.openedPopup&&this.popupManager.closeAllPopups()||h.prototype.onClick.apply(this,arguments)},onEscKey:function(){this.isPreviewMode?this.stopPreviewMode():this.selected&&this.popupManager.openedPopup&&this.popupManager.closeAllPopups()||h.prototype.onEscKey.apply(this,arguments)},restrictions:function(t){var e=t.getSelectedBlocks();return s.a.find(e,(function(t){return y.a.canHaveAnimation(t)}))},canControlBeClosed:function(){return!(!this.popupManager.openedPopup||!this.popupManager.closeAllPopups())||(!!this.waitingForTriggerClick||h.prototype.canControlBeClosed.apply(this,arguments))},destroy:function(){this.selected&&this.deselect(),this.willRestoreAnimationMode=!1,this.removeTriggerButtons(),b.prototype.destroy.apply(this,arguments)}}),F=a.a.Model.extend({initialize:function(t){s.a.bindAll(this),this.control=t.control,this.pid=t.pid,this.undoIndex=-1,this.undoStack=[],this.add.__debounced=s.a.debounce(this.add,300),this.historyTriggers=k.a.setCustomHandlers({undo:this.undo,redo:this.redo,getLength:this.getLength})},isEmpty:function(){return-1==this.undoIndex},add:function(t,e){e=e||{},-1!=this.undoIndex&&s.a.isEqual(this.undoStack[this.undoIndex].animation,t)||(s.a.isEmpty(t)&&(t={}),this.undoIndex>=0&&e.historyMergeID&&e.historyMergeID==this.undoStack[this.undoIndex].historyMergeID||this.undoIndex++,this.undoStack[this.undoIndex]={animation:t,historyMergeID:e.historyMergeID},this.undoStack.length=this.undoIndex+1,this.historyTriggers.triggerChange(this.pid))},undo:function(t){this.undoIndex>0&&(this.undoIndex--,this.control.setAnimations(this.undoStack[this.undoIndex].animation,{undo:!0}),this.control.updateAll({undo:!0}),this.historyTriggers.triggerChange(this.pid),this.historyTriggers.triggerUndo(this.pid))},redo:function(t){this.undoIndex<this.undoStack.length-1&&(this.undoIndex++,this.control.setAnimations(this.undoStack[this.undoIndex].animation,{redo:!0}),this.control.updateAll({redo:!0}),this.historyTriggers.triggerChange(this.pid),this.historyTriggers.triggerRedo(this.pid))},getLength:function(t){return{undo:this.undoIndex,redo:this.undoStack.length-1-this.undoIndex,page:t}},destroy:function(){k.a.removeCustomHandlers()}});function H(t){this.popups={},this.openedPopup="",s.a.bindAll(this),this.closeAllPopups.__debounced=s.a.debounce(this.closeAllPopups,50)}H.prototype.addPopup=function(t){t.onClick=s.a.bind((function(e){e&&Object(o.a)(e.target).closest(t.popupSelector).length>0||this.onClick(t.name,e.currentTarget)}),this),t.$parent.on("click",t.selector,t.onClick),t.$parent.on("click",this.closeAllPopups.__debounced),this.popups[t.name]=t},H.prototype.onClick=function(t,e){this.openedPopup==t?this.closePopup(t):this.openPopup(t,e)},H.prototype.closePopup=function(t){this.openedPopup==t&&this.popups[t]&&(this.openedPopup="",Object(o.a)(this.popups[t].selector,this.popups[t].$parent).removeClass("opened"),this.popups[t].cbClose&&this.popups[t].cbClose())},H.prototype.openPopup=function(t,e){this.openedPopup!=t&&this.popups[t]&&(this.openedPopup&&this.closePopup(this.openedPopup),this.openedPopup=t,Object(o.a)(e).addClass("opened"),this.popups[t].cbOpen&&this.popups[t].cbOpen(Object(o.a)(e)))},H.prototype.closeAllPopups=function(t){return!this.openedPopup||!(t&&Object(o.a)(t.target).closest(this.popups[this.openedPopup].selector).length>0)&&(this.closePopup(this.openedPopup),!0)},H.prototype.destroy=function(){for(var t in this.popups)this.popups[t].$parent.off("click",this.popups[t].selector,this.popups[t].onClick),this.popups[t].$parent.off("click",this.closeAllPopups.__debounced);delete this.popups};var N=B,V=i("Kw5r"),U=i("G50q"),W=i.n(U),G=h.extend({name:"common_pack",className:"control common_pack",initialize:function(t){this.template=W.a["template-constructor-control-common_pack"],this.initControl(t)},bindLogic:function(){RM.constructorRouter.bindGlobalKeyPress([{key:"g",handler:this.onClick,optionKeys:Modernizr.mac?"meta":"ctrl"}])},unBindLogic:function(){RM.constructorRouter.unbindGlobalKeyPress("g",this.onClick)},restrictions:function(t){var e={},i=s.a.reduce(t.getSelectedBlocks(),(function(t,i){var s=i.model.get("pack_id"),o=s&&e[s]?0:1;return e[s]=1,t+o}),0)>1,o=s.a.uniq(s.a.map(t.getSelectedBlocks(),(function(t){var e=!!t.model.get("fixed_position");return e=e||!1}))).length<=1,n=s.a.uniq(s.a.map(t.getSelectedBlocks(),(function(t){return!!t.model.get("is_global")}))).length<=1,a=s.a.uniq(s.a.map(t.getSelectedBlocks(),(function(t){return!!t.model.get("is_above")}))).length<=1;return i&&o&&n&&a},onClick:function(){var t=r.b.generateUUID();V.a.nextTick(function(){var e=s.a.map(this.models,(function(e){var i={_id:e.id,pack_id:t};return e.get("is_locked")&&(e.set("is_locked",!1),s.a.extend(i,{is_locked:!1})),i}));this.master.workspace.set_group(e),Object(u.a)("constructor.zIndex")?(RM.constructorRouter.indexController.doPack(this.models,this.master.workspace.page,this.master.workspace.page.getCurrentViewport(),t),this.master.workspace.save_group(this.models),RM.constructorRouter.indexController.saveAffectedPages()):this.master.workspace.save_group(this.models),this.master.deselect()}.bind(this))}}),q=i("HIJs"),X=i.n(q),K=h.extend({name:"common_unpack",className:"control common_unpack",initialize:function(t){this.template=X.a["template-constructor-control-common_unpack"],this.initControl(t)},bindLogic:function(){RM.constructorRouter.bindGlobalKeyPress([{key:"g",handler:this.onClick,optionKeys:Modernizr.mac?["meta","shift"]:["ctrl","shift"]}])},unBindLogic:function(){RM.constructorRouter.unbindGlobalKeyPress("g",this.onClick)},restrictions:function(t){return s.a.reduce(t.getSelectedBlocks(),(function(t,e){return t+(e.model.get("pack_id")?1:0)}),0)>0},onClick:function(){var t=s.a.map(this.models,(function(t){var e={_id:t.id,pack_id:null};return t.get("is_locked")&&(t.set("is_locked",!1),s.a.extend(e,{is_locked:!1})),e}));this.master.workspace.set_group(t),Object(u.a)("constructor.zIndex")?(RM.constructorRouter.indexController.doUnpack(this.models,this.master.workspace.page,this.master.workspace.page.getCurrentViewport()),this.master.workspace.save_group(this.models),RM.constructorRouter.indexController.saveAffectedPages()):this.master.workspace.save_group(this.models),this.master.deselect()}}),Y={props:{selected:!1,alt:null,svgIcon:null,iconClass:null}},Z=i("KHd+"),J=Object(Z.a)(Y,(function(){var t,e=this.$createElement,i=this._self._c||e;return i("div",{directives:[{name:"svginject",rawName:"v-svginject"}],staticClass:"icon preloader noarrow",class:(t={},t[this.iconClass]=!!this.iconClass,t["rmalttext-disable"]=this.selected,t),attrs:{"data-alt":this.alt,"data-alt-pos":"left","data-alt-offset":"9"}},[this.svgIcon?i("img",{staticClass:"svg svg-icon",attrs:{src:this.svgIcon}}):this._e()])}),[],!1,null,null,null).exports,Q={props:{block:Object,raw_block:Object},data:function(){return{m:{}}},computed:{Globals:function(){return window}},created:function(){this.assignBlockState(this.block)},mounted:function(){var t=this;this.$watch("m",(function(e){t.$parent.$emit("change",e)}),{deep:!0})},watch:{block:{handler:function(t){this.assignBlockState(t)},deep:!0}},methods:{$:function(t){return Object(o.a)(this.$el.querySelector(t))},assignBlockState:function(t){var e=this;s.a.each(t,(function(t,i){return e.$set(e.m,i,t)}))},canClose:function(){var t=!0;return s.a.each(this.$children,(function(e){t=!e.visibleBox&&t,e.visibleBox=!1})),t},closeOthersPopups:function(t){t&&s.a.each(this.$children,(function(e){e!=t&&(e.visibleBox=!1)}))},hide:function(){this.$parent.deselect()}}},tt=Object(Z.a)(Q,void 0,void 0,!1,null,null,null).exports,et=i("tRog"),it={mixins:[tt],components:{NumericInput:et.a},data:function(){return{m:{angle:0,flip_v:!1,flip_h:!1}}},methods:{onEnter:function(){this.$parent.$emit("deselect")},onInputChange:function(t){this.setAngle(t)},onRotate90Click:function(){this.setAngle((this.m.angle||0)+90)},onFirstFocus:function(){this.transparentSelection=!1},setAngle:function(t){if(t=(t=t>=360?t-360:t)<=-360?t+360:t,this.raw_block.workspace.spacesController){var e=Math.abs(Math.cos(this.m.angle/180*Math.PI)),i=Math.abs(Math.sin(this.m.angle/180*Math.PI)),s=Math.abs(Math.cos(t/180*Math.PI)),o=Math.abs(Math.sin(t/180*Math.PI)),n=(this.m.w,this.m.h,this.m.w*o+this.m.h*s),a=this.m.y-n/2+this.m.h/2,r=this.raw_block.workspace.spacesController.getRestriction(this.raw_block.model,[this.raw_block.model]);(!r.canMoveTop||a<r.top)&&(this.m.y+=r.top-a)}this.m.angle=t},flipVertical:function(){this.flip("vertical")},flipHorizontal:function(){this.flip("horizontal")},flip:function(t){var e=(this.m.angle+360)%360,i=this.m.flip_v,o=this.m.flip_h,n=this.m.angle;e<=45||e>=135&&e<=225||e>=315?n=-this.m.angle:(e>45&&e<135||e>225&&e<315)&&(n=180-this.m.angle),"vertical"===t?i=!this.m.flip_v:o=!this.m.flip_h;var a={angle:n,flip_v:i,flip_h:o};s.a.extend(this.m,a)}}},st=Object(Z.a)(it,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel"},[i("div",{staticClass:"param-caption"},[t._v("Rotate")]),t._v(" "),i("div",{staticClass:"input-wrapper",class:{negative:t.m.angle<0}},[i("span",{staticClass:"balance-deg"},[t._v("")]),t._v(" "),i("numeric-input",{attrs:{value:t.m.angle,autofocus:!0,autosize:!0,wait:200,min:-360,max:360,dir:"v",speed:4,"shift-step":15},on:{change:t.onInputChange},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onEnter(e)}}}),t._v(" "),i("span",{staticClass:"deg"},[t._v("")]),t._v(" "),i("span",{staticClass:"balance-minus"},[t._v("-")])],1),t._v(" "),i("div",{staticClass:"separator"}),t._v(" "),i("div",{staticClass:"flip-h",on:{click:t.flipHorizontal}}),t._v(" "),i("div",{staticClass:"flip-v",on:{click:t.flipVertical}}),t._v(" "),i("div",{staticClass:"rotate90",on:{click:t.onRotate90Click}})])}),[],!1,null,null,null).exports,ot=i("gP9L"),nt=i("RLXn"),at=i("uGDn"),rt=i("XHB6"),lt={components:{FontFamilySelector:ot.a,FontStyleSelector:nt.a,RmSwitcher:at.a,NumericInput:et.a,ColorPicker:rt.a},mixins:[tt],data:function(){return{shapes:["rectangle","circle","square"],states:["default","hover","current"],state:"default"}},computed:{maxBorderWidth:function(){return Math.ceil(Math.min(this.w,this.h)/2)}},watch:{state:function(t){Object(o.a)(".common-button",this.raw_block.$el).toggleClass("hovered","hover"===t),Object(o.a)(".common-button",this.raw_block.$el).toggleClass("current","current"===t)}},destroyed:function(){this.setCorrectIconColor("default"),Object(o.a)(".common-button",this.raw_block.$el).toggleClass("hovered",!1),Object(o.a)(".common-button",this.raw_block.$el).toggleClass("current",!1)},mounted:function(){var t=this.m.clickLink;if(t&&this.m.is_global&&Object(o.a)(".controls .control.picture_link .placeholder-selector").hasClass("hidden"))if(/^http(s?)\:\/\//i.test(t)||/^mailto\:/i.test(t)||/^tel\:/i.test(t))this.states.pop();else{var e=t;RM.constructorRouter.mag.getPageUri(e)||this.states.pop()}else this.states.pop()},methods:{changeShapeHandler:function(t){this.m.form=t,this.closeOthersPopups(null)},changeStateHandler:function(t){this.state=t,this.closeOthersPopups(null),this.setCorrectIconColor(t)},changePropHandler:function(t,e){this.m[t]=e},setCorrectIconColor:function(t){this.raw_block.onIconColorChange(this.m,null,{},t)}}},ct=Object(Z.a)(lt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel"},[i("div",{staticClass:"row shape-type"},t._l(t.shapes,(function(e){var s;return i("div",{key:e,class:(s={shape:!0},s[e]=!0,s.current=t.m.form===e,s),on:{click:function(i){return t.changeShapeHandler(e)}}})})),0),t._v(" "),i("div",{staticClass:"row state-switcher-wrapper"},t._l(t.states,(function(e){var s;return i("div",{key:e,class:(s={"state-switcher":!0},s["caption-"+e]=!0,s.current=e===t.state,s),on:{click:function(i){return t.changeStateHandler(e)}}},[t._v("\n      "+t._s(e)+"\n    ")])})),0),t._v(" "),"default"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Shape Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["background-color"],alpha:t.m["background-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("background-color",e)},"update:alpha":function(e){return t.changePropHandler("background-color-opacity",e)}}})],1):t._e(),t._v(" "),"hover"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Shape Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["hover-background-color"],alpha:t.m["hover-background-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("hover-background-color",e)},"update:alpha":function(e){return t.changePropHandler("hover-background-color-opacity",e)}}})],1):t._e(),t._v(" "),"current"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Shape Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["current-background-color"],alpha:t.m["current-background-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("current-background-color",e)},"update:alpha":function(e){return t.changePropHandler("current-background-color-opacity",e)}}})],1):t._e(),t._v(" "),"default"===t.state&&"circle"!==t.m.form?i("div",{staticClass:"row"},[i("div",{staticClass:"caption input-correction"},[t._v("Radius")]),t._v(" "),i("numeric-input",{class:{"num-input":!0,"one-digit":t.m["border-radius"]<10,"two-digit":t.m["border-radius"]<100&&t.m["border-radius"]>9,"three-digit":t.m["border-radius"]>99},attrs:{autosize:!0,value:t.m["border-radius"],min:0,max:999},on:{change:function(e){return t.changePropHandler("border-radius",e)}}})],1):t._e(),t._v(" "),"current"===t.state&&"circle"!==t.m.form?i("div",{staticClass:"row"},[i("div",{staticClass:"caption input-correction"},[t._v("Radius")]),t._v(" "),i("numeric-input",{class:{"num-input":!0,"one-digit":t.m["current-border-radius"]<10,"two-digit":t.m["current-border-radius"]<100&&t.m["current-border-radius"]>9,"three-digit":t.m["current-border-radius"]>99},attrs:{autosize:!0,value:t.m["current-border-radius"],min:0,max:999},on:{change:function(e){return t.changePropHandler("current-border-radius",e)}}})],1):t._e(),t._v(" "),"default"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption input-correction"},[t._v("Border")]),t._v(" "),i("numeric-input",{class:{"num-input":!0,"one-digit":t.m["border-width"]<10,"two-digit":t.m["border-width"]<100&&t.m["border-width"]>9,"three-digit":t.m["border-width"]>99},attrs:{autosize:!0,value:t.m["border-width"],min:0,max:999},on:{change:function(e){return t.changePropHandler("border-width",e)}}})],1):t._e(),t._v(" "),"hover"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption input-correction"},[t._v("Border")]),t._v(" "),i("numeric-input",{class:{"num-input":!0,"one-digit":t.m["hover-border-width"]<10,"two-digit":t.m["hover-border-width"]<100&&t.m["hover-border-width"]>9,"three-digit":t.m["hover-border-width"]>99},attrs:{autosize:!0,value:t.m["hover-border-width"]},on:{change:function(e){return t.changePropHandler("hover-border-width",e)}}})],1):t._e(),t._v(" "),"current"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption input-correction"},[t._v("Border")]),t._v(" "),i("numeric-input",{class:{"num-input":!0,"one-digit":t.m["current-border-width"]<10,"two-digit":t.m["current-border-width"]<100&&t.m["current-border-width"]>9,"three-digit":t.m["current-border-width"]>99},attrs:{autosize:!0,value:t.m["current-border-width"],min:0,max:999},on:{change:function(e){return t.changePropHandler("current-border-width",e)}}})],1):t._e(),t._v(" "),"default"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["border-color"],alpha:t.m["border-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("border-color",e)},"update:alpha":function(e){return t.changePropHandler("border-color-opacity",e)}}})],1):t._e(),t._v(" "),"hover"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["hover-border-color"],alpha:t.m["hover-border-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("hover-border-color",e)},"update:alpha":function(e){return t.changePropHandler("hover-border-color-opacity",e)}}})],1):t._e(),t._v(" "),"current"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["current-border-color"],alpha:t.m["current-border-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("current-border-color",e)},"update:alpha":function(e){return t.changePropHandler("current-border-color-opacity",e)}}})],1):t._e(),t._v(" "),"default"===t.state?i("div",{staticClass:"row font-family-click-area",attrs:{title:"Font Family"}},[i("font-family-selector",{attrs:{family:t.m["font-family"]},on:{showPopup:t.closeOthersPopups,change:function(e){return t.changePropHandler("font-family",e)}}})],1):t._e(),t._v(" "),"current"===t.state?i("div",{staticClass:"row font-family-click-area",attrs:{title:"Font Family"}},[i("font-family-selector",{attrs:{family:t.m["current-font-family"]},on:{showPopup:t.closeOthersPopups,change:function(e){return t.changePropHandler("current-font-family",e)}}})],1):t._e(),t._v(" "),"default"===t.state?i("div",{staticClass:"row font-style-click-area",attrs:{title:"Font Style"}},[i("font-style-selector",{style:{"font-family":t.m["font-family"]},attrs:{"font-style":[t.m["font-style"]],"font-weight":[t.m["font-weight"]],"font-family":[t.m["font-family"]]},on:{showPopup:t.closeOthersPopups,"update:fontStyle":function(e){return t.changePropHandler("font-style",e)},"update:fontWeight":function(e){return t.changePropHandler("font-weight",e)}}})],1):t._e(),t._v(" "),"current"===t.state?i("div",{staticClass:"row font-style-click-area",attrs:{title:"Font Style"}},[i("font-style-selector",{style:{"font-family":t.m["current-font-family"]},attrs:{"font-style":t.m["current-font-style"],"font-weight":t.m["current-font-weight"],"font-family":t.m["current-font-family"]},on:{showPopup:t.closeOthersPopups,"update:fontStyle":function(e){return t.changePropHandler("current-font-style",e)},"update:fontWeight":function(e){return t.changePropHandler("current-font-weight",e)}}})],1):t._e(),t._v(" "),"default"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Text Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m.color,alpha:t.m["color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("color",e)},"update:alpha":function(e){return t.changePropHandler("color-opacity",e)}}})],1):t._e(),t._v(" "),"hover"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Text Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["hover-color"],alpha:t.m["hover-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("hover-color",e)},"update:alpha":function(e){return t.changePropHandler("hover-color-opacity",e)}}})],1):t._e(),t._v(" "),"current"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Text Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["current-color"],alpha:t.m["current-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("current-color",e)},"update:alpha":function(e){return t.changePropHandler("current-color-opacity",e)}}})],1):t._e(),t._v(" "),"default"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Icon Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m.icon_color,alpha:t.m.icon_color_opacity},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("icon_color",e)},"update:alpha":function(e){return t.changePropHandler("icon_color_opacity",e)}}})],1):t._e(),t._v(" "),"hover"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Icon Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["hover-icon_color"],alpha:t.m["hover-icon_color_opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("hover-icon_color",e)},"update:alpha":function(e){return t.changePropHandler("hover-icon_color_opacity",e)}}})],1):t._e(),t._v(" "),"current"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Icon Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["current-icon_color"],alpha:t.m["current-icon_color_opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("current-icon_color",e)},"update:alpha":function(e){return t.changePropHandler("current-icon_color_opacity",e)}}})],1):t._e(),t._v(" "),"hover"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Transition")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#2d90ff"},model:{value:t.m.transition,callback:function(e){t.$set(t.m,"transition",e)},expression:"m['transition']"}})],1):t._e(),t._v(" "),"default"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"font-size-icon"}),t._v(" "),i("numeric-input",{staticClass:"num-input",attrs:{autosize:!0,value:t.m["font-size"],min:8,max:999},on:{change:function(e){return t.changePropHandler("font-size",e)}}})],1):t._e(),t._v(" "),"current"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"font-size-icon"}),t._v(" "),i("numeric-input",{staticClass:"num-input",attrs:{autosize:!0,value:t.m["current-font-size"],min:8,max:999},on:{change:function(e){return t.changePropHandler("current-font-size",e)}}})],1):t._e(),t._v(" "),"default"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"letter-spacing-icon"}),t._v(" "),i("numeric-input",{staticClass:"num-input",attrs:{autosize:!0,value:t.m["letter-spacing"],min:-99,max:999,step:.1,"use-float":!0},on:{change:function(e){return t.changePropHandler("letter-spacing",e)}}})],1):t._e(),t._v(" "),"current"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"letter-spacing-icon"}),t._v(" "),i("numeric-input",{staticClass:"num-input",attrs:{autosize:!0,value:t.m["current-letter-spacing"],min:-99,max:999,step:.1,"use-float":!0},on:{change:function(e){return t.changePropHandler("current-letter-spacing",e)}}})],1):t._e()])}),[],!1,null,null,null).exports,ht={props:{data:{type:Object}},data:function(){return{url:""}},ounted:function(){this.url=this.updateUrl()},methods:{updateUrl:function(){return"page"===this.data.use_own_url?"Using the page URL":"mag"===this.data.use_own_url?"Using the project URL":this.data.url},updateUrlData:function(t,e){this.data.url=t,this.data.use_own_url=e,this.url=this.updateUrl()}}},dt=(i("F+PN"),Object(Z.a)(ht,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"variant-input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.url,expression:"url"}],staticClass:"input tweet-url",attrs:{readonly:!!t.data.use_own_url,placeholder:"URL"},domProps:{value:t.url},on:{input:function(e){e.target.composing||(t.url=e.target.value)}}}),t._v(" "),t.data.use_own_url||t.data.url&&t.data.url===t.url?i("div",{staticClass:"input-control clear",on:{click:function(e){return e.stopPropagation(),t.updateUrlData("","")}}}):t.data.use_own_url||t.data.url||t.url?t.url!==t.data.url?i("div",{staticClass:"input-control apply",on:{click:function(e){return e.stopPropagation(),t.updateUrlData(t.url,"")}}}):t._e():i("div",{staticClass:"input-control target"},[i("div",{staticClass:"use-url-popup"},[i("ul",[i("li",{on:{click:function(e){return e.stopPropagation(),t.updateUrlData("","mag")}}},[t._v("Using the project URL")]),t._v(" "),i("li",{on:{click:function(e){return e.stopPropagation(),t.updateUrlData("","page")}}},[t._v("Using the page URL")])]),t._v(" "),t._m(0),t._v(" "),i("div",{staticClass:"hover-zone"})])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"corner-wrapper"},[e("div",{staticClass:"corner"})])}],!1,null,null,null).exports),pt={props:{value:{},options:{type:Array,default:function(){return[]}},arrowSize:{default:"small"},showTitles:{type:Boolean,default:!1},callback:{type:Function,default:function(){}}},data:function(){return{isOpened:!1}},computed:{caption:function(){return(s.a.findWhere(this.options,{value:this.value})||{}).caption}},methods:{onClick:function(t){this.isOpened=!this.isOpened},emitValue:function(t){t.disabled||(this.$emit("input",t.value),this.callback(t))}}},ut=(i("muOB"),Object(Z.a)(pt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"selector",class:{opened:t.isOpened},on:{click:t.onClick}},[i("div",{staticClass:"types-popup"},t._l(t.options,(function(e){return i("div",{key:e.value,staticClass:"type-item",class:{curr:e.value===t.value,disabled:!!e.disabled},attrs:{title:t.showTitles?e.caption:""},on:{click:function(i){return t.emitValue(e)}}},[t._t("listitem",[t._v("\n        "+t._s(e.caption)+"\n        "),i("div",{staticClass:"point"})],{option:e,value:t.value})],2)})),0),t._v(" "),i("div",{staticClass:"caption"},[i("div",{staticClass:"caption-inner"},[t._v(t._s(t.caption))])]),t._v(" "),"small"===this.arrowSize?i("div",{staticClass:"popup-arrow"}):t._e(),t._v(" "),"big"===this.arrowSize?i("div",{staticClass:"popup-arrow-big"},[i("svg",{attrs:{width:"12",height:"7",xmlns:"http://www.w3.org/2000/svg"}},[i("path",{attrs:{d:"M5.24 6.114L1.416 1.651A1 1 0 0 1 2.175 0h7.65a1 1 0 0 1 .76 1.65L6.759 6.115a1 1 0 0 1-1.518 0z","fill-rule":"evenodd"}})])]):t._e()])}),[],!1,null,"473f91c6",null).exports),gt={props:{value:{type:String},prefix:{type:String,default:""}},data:function(){return{text:""}},mounted:function(){this.text=this.value}},mt=(i("/0Qt"),Object(Z.a)(gt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"apply-input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.text,expression:"text"}],staticClass:"input",class:{"no-prefix":!t.prefix},attrs:{placeholder:"Username"},domProps:{value:t.text},on:{input:function(e){e.target.composing||(t.text=e.target.value)}}}),t._v(" "),i("div",{staticClass:"input-prefix"},[t._v(t._s(t.prefix))]),t._v(" "),t.value!=t.text?i("div",{staticClass:"input-control apply",on:{click:function(e){return e.stopPropagation(),t.$emit("input",t.text)}}}):t.value?i("div",{staticClass:"input-control clear",on:{click:function(e){e.stopPropagation(),t.$emit("input",""),t.text=""}}}):t._e()])}),[],!1,null,null,null).exports),ft={mixins:[tt],components:{RmVariantInput:dt,RmSwitcher:at.a,RmSelect:ut,RmApplyInput:mt}},vt=Object(Z.a)(ft,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel"},[i("div",{staticClass:"panel-title"},[t._v("Twitter")]),t._v(" "),i("rm-select",{attrs:{options:[{value:"type_timeline",caption:"User Timeline"},{value:"type_embed",caption:"Embed Tweet"},{value:"type_tweet",caption:"Tweet Button"},{value:"type_follow",caption:"Follow Button"},{value:"type_hashtag",caption:"Hashtag Button"}]},model:{value:t.m.current_type,callback:function(e){t.$set(t.m,"current_type",e)},expression:"m.current_type"}}),t._v(" "),"type_timeline"==t.m.current_type?i("div",[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.m.type_timeline.code,expression:"m.type_timeline.code"}],staticClass:"textarea",attrs:{placeholder:"Paste embed code here"},domProps:{value:t.m.type_timeline.code},on:{input:function(e){e.target.composing||t.$set(t.m.type_timeline,"code",e.target.value)}}}),t._v(" "),t._m(0)]):t._e(),t._v(" "),"type_embed"==t.m.current_type?i("div",[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.m.type_embed.code,expression:"m.type_embed.code"}],staticClass:"textarea",attrs:{placeholder:"Paste embed code here"},domProps:{value:t.m.type_embed.code},on:{input:function(e){e.target.composing||t.$set(t.m.type_embed,"code",e.target.value)}}}),t._v(" "),t._m(1)]):t._e(),t._v(" "),"type_tweet"==t.m.current_type?i("div",[i("div",{staticClass:"input-wrapper"},[i("rm-variant-input",{attrs:{data:t.m.type_tweet}})],1),t._v(" "),i("div",{staticClass:"sep-line"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Large button")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#3366cc","color-off":"rgba(75, 75, 75, 0.4)"},model:{value:t.m.type_tweet.large_button,callback:function(e){t.$set(t.m.type_tweet,"large_button",e)},expression:"m.type_tweet.large_button"}})],1)]):t._e(),t._v(" "),"type_follow"==t.m.current_type?i("div",[i("div",{staticClass:"input-wrapper"},[i("rm-apply-input",{attrs:{prefix:"@"},model:{value:t.m.type_follow.username,callback:function(e){t.$set(t.m.type_follow,"username",e)},expression:"m.type_follow.username"}})],1),t._v(" "),i("div",{staticClass:"sep-line"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Show name")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#3366cc","color-off":"rgba(75, 75, 75, 0.4)"},model:{value:t.m.type_follow.show_name,callback:function(e){t.$set(t.m.type_follow,"show_name",e)},expression:"m.type_follow.show_name"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Large button")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#3366cc","color-off":"rgba(75, 75, 75, 0.4)"},model:{value:t.m.type_follow.large_button,callback:function(e){t.$set(t.m.type_follow,"large_button",e)},expression:"m.type_follow.large_button"}})],1)]):t._e(),t._v(" "),"type_hashtag"==t.m.current_type?i("div",[i("div",{staticClass:"input-wrapper"},[i("rm-apply-input",{attrs:{prefix:"#"},model:{value:t.m.type_hashtag.hash,callback:function(e){t.$set(t.m.type_hashtag,"hash",e)},expression:"m.type_hashtag.hash"}})],1),t._v(" "),i("div",{staticClass:"sep-line"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Large button")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#3366cc","color-off":"rgba(75, 75, 75, 0.4)"},model:{value:t.m.type_hashtag.large_button,callback:function(e){t.$set(t.m.type_hashtag,"large_button",e)},expression:"m.type_hashtag.large_button"}})],1)]):t._e()],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"center"},[e("a",{staticClass:"embed-tutorial",attrs:{target:"_blank",href:"https://dev.twitter.com/docs/embedded-timelines"}},[this._v("How to embed Timeline")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"center"},[e("a",{staticClass:"embed-tutorial",attrs:{target:"_blank",href:"https://dev.twitter.com/docs/embedded-tweets"}},[this._v("How to embed Tweet")])])}],!1,null,null,null).exports,bt=i("VZqm"),_t={mixins:[tt],components:{RmVariantInput:dt,RmSwitcher:at.a,RmSpinner:bt.a,RmSelect:ut,RmApplyInput:mt,NumericInput:et.a}},wt=Object(Z.a)(_t,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel"},[i("div",{staticClass:"panel-title"},[t._v("Facebook")]),t._v(" "),i("rm-select",{attrs:{options:[{value:"type_like_button",caption:"Like Button"},{value:"type_page",caption:"Page"},{value:"type_comments",caption:"Comments"}]},model:{value:t.m.current_type,callback:function(e){t.$set(t.m,"current_type",e)},expression:"m.current_type"}}),t._v(" "),"type_like_button"==t.m.current_type?i("div",[i("div",{staticClass:"input-wrapper"},[i("rm-variant-input",{attrs:{data:t.m.type_like_button}})],1),t._v(" "),i("div",[i("rm-spinner",{attrs:{variants:[{value:"standard",title:"Standard Layout"},{value:"button_count",title:"Button Count"},{value:"box_count",title:"Box Count"}]},model:{value:t.m.type_like_button.layout,callback:function(e){t.$set(t.m.type_like_button,"layout",e)},expression:"m.type_like_button.layout"}})],1),t._v(" "),i("div",{staticClass:"sep-line"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Share Button")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#2d90ff","color-off":"#313131"},model:{value:t.m.type_like_button.share_button,callback:function(e){t.$set(t.m.type_like_button,"share_button",e)},expression:"m.type_like_button.share_button"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Show Faces")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#2d90ff","color-off":"#313131"},model:{value:t.m.type_like_button.show_faces,callback:function(e){t.$set(t.m.type_like_button,"show_faces",e)},expression:"m.type_like_button.show_faces"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Color")]),t._v(" "),i("div",{staticClass:"theme-picker",class:t.m.type_like_button.theme},[i("div",{staticClass:"theme light",on:{click:function(e){e.stopPropagation(),t.m.type_like_button.theme="light"}}}),t._v(" "),i("div",{staticClass:"theme dark",on:{click:function(e){e.stopPropagation(),t.m.type_like_button.theme="dark"}}})])])]):t._e(),t._v(" "),"type_page"==t.m.current_type?i("div",[i("div",{staticClass:"input-wrapper"},[i("rm-apply-input",{model:{value:t.m.type_page.url,callback:function(e){t.$set(t.m.type_page,"url",e)},expression:"m.type_page.url"}})],1),t._v(" "),i("div",{staticClass:"sep-line"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Show Stream")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#2d90ff","color-off":"#313131"},model:{value:t.m.type_page.show_stream,callback:function(e){t.$set(t.m.type_page,"show_stream",e)},expression:"m.type_page.show_stream"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Small Header")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#2d90ff","color-off":"#313131"},model:{value:t.m.type_page.small_header,callback:function(e){t.$set(t.m.type_page,"small_header",e)},expression:"m.type_page.small_header"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Show Faces")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#2d90ff","color-off":"#313131"},model:{value:t.m.type_page.show_faces,callback:function(e){t.$set(t.m.type_page,"show_faces",e)},expression:"m.type_page.show_faces"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Color")]),t._v(" "),i("div",{staticClass:"theme-picker",class:t.m.type_page.theme},[i("div",{staticClass:"theme light",on:{click:function(e){e.stopPropagation(),t.m.type_page.theme="light"}}}),t._v(" "),i("div",{staticClass:"theme dark",on:{click:function(e){e.stopPropagation(),t.m.type_page.theme="dark"}}})])])]):t._e(),t._v(" "),"type_comments"==t.m.current_type?i("div",[i("div",{staticClass:"input-wrapper"},[i("rm-variant-input",{attrs:{data:t.m.type_comments}})],1),t._v(" "),i("div",{staticClass:"sep-line"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Number of posts")]),t._v(" "),i("numeric-input",{attrs:{autosize:!0,min:1,max:99},model:{value:t.m.type_comments.num_posts,callback:function(e){t.$set(t.m.type_comments,"num_posts",e)},expression:"m.type_comments.num_posts"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Color")]),t._v(" "),i("div",{staticClass:"theme-picker",class:t.m.type_comments.theme},[i("div",{staticClass:"theme light",on:{click:function(e){e.stopPropagation(),t.m.type_comments.theme="light"}}}),t._v(" "),i("div",{staticClass:"theme dark",on:{click:function(e){e.stopPropagation(),t.m.type_comments.theme="dark"}}})])])]):t._e()],1)}),[],!1,null,null,null).exports,yt={components:{RmSwitcher:at.a,RmSelect:ut},mixins:[tt],data:function(){return{m:{direction_route_type:"driving",custom_json:"",api_key:"",scrollwheel:!0},mapTypes:[{value:"standard",caption:"Standard"},{value:"directions",caption:"Directions"},{value:"custom",caption:"Custom map"}],directions:[{value:"driving",icon:"car"},{value:"transit",icon:"train"},{value:"walking",icon:"walk"},{value:"bicycling",icon:"bicycle"}],custom_json:"",api_key:"",is_json_invalid:!1}},mounted:function(){this.custom_json=this.m.custom_json,this.api_key=this.m.api_key},methods:{validateJSON:function(t){try{JSON.parse(t)}catch(t){return!1}return!0},validateApiKey:function(t){if(t)return 39===t.length},onRemove:function(){this.api_key="",this.m.api_key=""}},watch:{custom_json:s.a.debounce((function(t){!t||this.validateJSON(t)?(this.m.custom_json=t,this.is_json_invalid=!1):this.is_json_invalid=!0}),500),api_key:s.a.debounce((function(t){t&&!this.validateApiKey(t)||(this.m.api_key=t)}),500),"m.api_key":function(){this.api_key=this.m.api_key}}},kt=Object(Z.a)(yt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel"},[i("div",{staticClass:"param-caption"},[t._v("Google Maps")]),t._v(" "),i("div",{staticClass:"param",attrs:{"data-param":"code"}},[t.m.api_key&&t.validateApiKey(t.m.api_key)?t._e():i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.api_key,expression:"api_key"}],staticClass:"input",class:[{error:t.api_key&&!t.validateApiKey(t.api_key)}],attrs:{placeholder:"API Key",minlength:"39",maxlength:"39",required:""},domProps:{value:t.api_key},on:{input:function(e){e.target.composing||(t.api_key=e.target.value)}}})]),t._v(" "),t.m.api_key&&t.validateApiKey(t.m.api_key)?i("div",{staticClass:"gmap-api-enabled"},[i("span",[t._v("API Key Enabled")]),t._v(" "),i("div",{ref:"remove",staticClass:"remove map-icon",attrs:{"data-alt":"Delete Google Maps API Key "+t.m.api_key,"data-alt-style":"controls-gmap-icon-tooltip"},on:{click:t.onRemove}},[i("svg",{attrs:{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg"}},[i("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[i("circle",{attrs:{cx:"12",cy:"12",r:"12"}}),t._v(" "),i("path",{attrs:{d:"M12 10.586l4.536-4.536a1 1 0 0 1 1.414 1.414L13.414 12l4.536 4.536a1 1 0 0 1-1.414 1.414L12 13.414 7.464 17.95a1 1 0 0 1-1.414-1.414L10.586 12 6.05 7.464A1 1 0 0 1 7.464 6.05L12 10.586z","fill-rule":"nonzero"}})])])]),t._v(" "),i("a",{ref:"question-enabled",staticClass:"question map-icon",attrs:{href:"https://help.readymag.com/hc/en-us/articles/360020526932-Google-Maps",rel:"noreferrer noopener",target:"_blank","data-alt-style":"controls-gmap-icon-tooltip"}},[i("svg",{attrs:{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg"}},[i("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[i("circle",{attrs:{cx:"12",cy:"12",r:"12"}}),t._v(" "),i("path",{attrs:{d:"M8 9.259C8.06 7.371 9.294 6 11.542 6 13.615 6 15 7.259 15 9.02c0 1.219-.575 2.072-1.604 2.717-.992.614-1.272 1.02-1.272 1.809V14H10.37l-.008-.542c-.068-1.195.37-1.912 1.415-2.558.939-.597 1.256-1.02 1.256-1.808 0-.83-.635-1.427-1.589-1.427-.976 0-1.604.622-1.665 1.594H8zM11.5 18c-.904 0-1.5-.592-1.5-1.495 0-.913.596-1.505 1.5-1.505.922 0 1.5.592 1.5 1.505 0 .903-.578 1.495-1.5 1.495z"}})])])])]):t._e(),t._v(" "),t.m.api_key||t.api_key?t._e():i("a",{ref:"question-disabled",staticClass:"question map-icon",attrs:{href:"http://help.readymag.com/hc/en-us/articles/360020526932-Google-Maps",rel:"noreferrer noopener",target:"_blank","data-alt-style":"controls-gmap-icon-tooltip"}},[i("svg",{attrs:{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg"}},[i("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[i("circle",{attrs:{cx:"12",cy:"12",r:"12"}}),t._v(" "),i("path",{attrs:{d:"M8 9.259C8.06 7.371 9.294 6 11.542 6 13.615 6 15 7.259 15 9.02c0 1.219-.575 2.072-1.604 2.717-.992.614-1.272 1.02-1.272 1.809V14H10.37l-.008-.542c-.068-1.195.37-1.912 1.415-2.558.939-.597 1.256-1.02 1.256-1.808 0-.83-.635-1.427-1.589-1.427-.976 0-1.604.622-1.665 1.594H8zM11.5 18c-.904 0-1.5-.592-1.5-1.495 0-.913.596-1.505 1.5-1.505.922 0 1.5.592 1.5 1.505 0 .903-.578 1.495-1.5 1.495z"}})])])])]),t._v(" "),i("rm-select",{staticClass:"map-type-select",class:[{"no-line":"directions"===t.m.current_type||"custom"===t.m.current_type}],attrs:{options:t.mapTypes,"arrow-size":"big"},model:{value:t.m.current_type,callback:function(e){t.$set(t.m,"current_type",e)},expression:"m.current_type"}}),t._v(" "),i("div",{staticClass:"types-param"},["custom"==t.m.current_type?i("div",{staticClass:"type-param",attrs:{"data-type":"custom"}},[i("div",{staticClass:"param",attrs:{"data-param":"code"}},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.custom_json,expression:"custom_json"}],staticClass:"custom-json",class:{error:t.is_json_invalid,empty:!t.custom_json},attrs:{placeholder:"Paste JSON code",required:""},domProps:{value:t.custom_json},on:{input:function(e){e.target.composing||(t.custom_json=e.target.value)}}})]),t._v(" "),t._m(0)]):t._e(),t._v(" "),"directions"==t.m.current_type?i("div",{staticClass:"type-param",attrs:{"data-type":"directions"}},[i("div",{staticClass:"param",attrs:{"data-param":"route_type"}},[i("div",{staticClass:"route-switcher"},t._l(t.directions,(function(e,s){return i("div",{key:s,staticClass:"route-item",class:{active:t.m.direction_route_type===e.value},on:{click:function(i){t.m.direction_route_type=e.value}}},[i("div",{staticClass:"route-icon",class:[e.icon]})])})),0)])]):t._e()]),t._v(" "),i("div",{staticClass:"map-controls"},[i("div",{staticClass:"map-control"},[i("div",{staticClass:"caption"},[t._v("Controls")]),t._v(" "),i("rm-switcher",{staticClass:"controls-switcher",attrs:{"color-off":"#B8B8B8","color-on":"#0080FF",height:24,width:40},model:{value:t.m.show_controls,callback:function(e){t.$set(t.m,"show_controls",e)},expression:"m.show_controls"}})],1),t._v(" "),i("div",{staticClass:"map-control"},[i("div",{staticClass:"caption"},[t._v("Zoom on scroll")]),t._v(" "),i("rm-switcher",{staticClass:"controls-switcher",attrs:{"color-off":"#B8B8B8","color-on":"#0080FF",height:24,width:40},model:{value:t.m.scrollwheel,callback:function(e){t.$set(t.m,"scrollwheel",e)},expression:"m.scrollwheel"}})],1)])],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"wizard-link"},[e("a",{attrs:{target:"_blank",href:"https://mapstyle.withgoogle.com/"}},[this._v("Launch Maps Wizard")])])}],!1,null,null,null).exports,Ct=i("i7aS"),xt=i("TBxE"),St=i("wrlV"),Pt=i("CLR5"),$t={components:{NumericInput:et.a,ColorPicker:rt.a,RmOpacityDrag:Pt.a},mixins:[tt],data:function(){return{searchText:"",uploading:!1,dragging:!1,opacityActive:!1,m:{border_size:0,border_color:"ffffff",border_radius:0,border_radius_max:!1,opacity:1}}},computed:{trimmedSearchText:function(){return o.a.trim(this.searchText)},hasPicture:function(){return V.a.nextTick(function(){this.$emit("resize")}.bind(this)),this.block.picture&&this.block.picture.url&&!this.uploading||Ct.a.flagLambda()&&this.block.picture&&this.block.picture.type&&!this.uploading},opacityPercents:function(){return this.$refs.opacity.percent}},mounted:function(){this.uploader=new xt.a(this),this.uploader.on("start",this.onStartUpload),this.uploader.on("done",this.onDoneUpload),this.uploader.on("fail",this.onFailUpload),this.uploader.on("uploadFromUrl",this.uploadFromUrl),this.raw_block.workspace.on("main-dragover",this.highlightDropZone,this),this.$watch("block.picture",(function(){if(Ct.a.flagLambda()&&this.block.picture&&this.block.picture.type)this.uploading=!1,this.searchText="";else{var t=this.raw_block&&(this.raw_block.isVector()||this.raw_block.isAnimated());(this.block.picture&&this.block.picture.finalUrl||t&&this.block.picture.url)&&(this.uploading=!1,this.searchText="")}})),this.$watch("raw_block.isLoading",(function(){this.uploading=this.raw_block.isLoading})),this.$emit("resize")},beforeDestroy:function(){this.raw_block.workspace.off("main-dragover",this.highlightDropZone,this)},methods:{uploadOrDelete:function(t){Object(o.a)(t.target).hasClass("uploadInput")||Object(o.a)(this.$refs.uploadInput).trigger("click","stop")},uploadFromSearch:function(t){var e=o.a.trim(this.searchText);e&&(this.isURL(e)?this.uploadFromUrl(e):RM.views.searchBing&&RM.views.searchBing.show(e,{upload:this.uploadFromUrl}))},uploadFromUrl:function(t){var e=this;this.uploading=!0,this.raw_block.showIconLoader(),this.raw_block.loadFromUrl(t,{success:function(){},error:function(){e.onFailUpload()},save:!1}),t&&Ct.a.flagLambda()&&Object(St.b)(t).then((function(i){if(e.uploading){var s={width:i.width,height:i.height,content:t};e.uploading=!1,e.raw_block.setTempPicture(s)}})).catch((function(t){}))},cancelUpload:function(){this.uploading=!1,Ct.a.flagLambda()&&this.raw_block.removeTempPicture(),this.raw_block.removePicture()},searchFlickr:function(){RM.views.searchFlickr&&RM.views.searchFlickr.show("",{upload:this.uploadFromUrl})},searchUnsplash:function(){RM.views.searchUnsplash&&RM.views.searchUnsplash.show("",{upload:this.uploadFromUrl,preview:this.block.setPreviewImage})},onStartUpload:function(t,e){var i=this;if(Ct.a.flagLambda()){var s=t.target&&t.target.files.length&&t.target.files[0];s&&Object(St.a)(s).then((function(t){i.uploading&&t.ext&&Ct.a.allowedLambdaExt(t.ext)&&(i.uploading=!1,i.raw_block.setTempPicture(t))})).catch((function(t){}))}this.raw_block.showTempPreloader&&this.raw_block.showTempPreloader(),this.uploading=!0},onDoneUpload:function(t,e){e&&e.result?this.raw_block.changePicture(e.result):this.onFailUpload()},onFailUpload:function(){this.uploading=!1,this.searchText="",this.raw_block.removeTempPicture()},highlightDropZone:function(t){var e=this;this.dragging=!0,Object(o.a)(this.$el).find(t.target).length&&this.raw_block.$el.removeClass(".replace"),clearTimeout(this.highlightTimeout),this.highlightTimeout=setTimeout((function(){e.dragging=!1}),500)},updateColor:function(t){this.m.border_color=t},showPercents:function(t){this.opacityActive=t},toggleBorderRadiusMax:function(){this.m.border_radius_max=!this.m.border_radius_max},onBorderRadiusChange:function(){this.m.border_radius_max=!1},isURL:r.b.filters.isURL,flagLambda:Ct.a.flagLambda}},Ot=(i("OdK0"),Object(Z.a)($t,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel picture-settings",class:{uploading:t.uploading,"has-picture":t.hasPicture,dragging:t.dragging}},[i("div",{staticClass:"param-caption"},[t._v("Picture")]),t._v(" "),i("div",{staticClass:"upload"},[i("div",{staticClass:"upload-wrapper"},[i("div",{staticClass:"center-wrapper",on:{click:t.uploadOrDelete}},[i("div",{staticClass:"icon"}),t._v(" "),i("div",{staticClass:"caption-upload-dop"},[t._v(t._s(t.dragging?"drop here":"drop file here"))])])]),t._v(" "),i("input",{ref:"uploadInput",staticClass:"uploadInput",attrs:{type:"file",name:"upload","data-url":t.flagLambda()?"/api/upload/lambda/":"/api/upload/"}}),t._v(" "),i("div",{staticClass:"social"},[i("div",{staticClass:"search"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],class:{"has-icon":""!=t.searchText},attrs:{type:"text",spellcheck:"false",placeholder:"Search or paste URL"},domProps:{value:t.searchText},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.uploadFromSearch(e)},input:function(e){e.target.composing||(t.searchText=e.target.value)}}}),t._v(" "),i("div",{staticClass:"icon",class:{hidden:!t.trimmedSearchText,"upload-icon":t.isURL(t.trimmedSearchText)},on:{click:t.uploadFromSearch}})]),t._v(" "),i("div",{staticClass:"search-icons"},[i("div",{staticClass:"flickr",attrs:{title:"Flickr"},on:{click:t.searchFlickr}}),t._v(" "),i("div",{staticClass:"unsplash",attrs:{title:"Unsplash"},on:{click:t.searchUnsplash}})]),t._v(" "),i("div",{staticClass:"separator"})])]),t._v(" "),t._m(0),t._v(" "),i("div",{staticClass:"loading"},[i("div",{staticClass:"delete",on:{click:t.cancelUpload}})]),t._v(" "),i("div",{staticClass:"settings"},[i("div",{staticClass:"param param-component"},[i("div",{staticClass:"param-caption"},[t._v("Border")]),t._v(" "),i("numeric-input",{attrs:{autofocus:!0,autosize:!1,min:0,max:999,dir:"v",speed:5},model:{value:t.m.border_size,callback:function(e){t.$set(t.m,"border_size",e)},expression:"m.border_size"}}),t._v(" "),i("div",{staticClass:"border-color",attrs:{title:"Color"}},[i("color-picker",{ref:"colorpicker",staticClass:"color round",attrs:{color:t.m.border_color,"show-alpha":!1,"show-arrow-icon":!0},on:{"update:color":t.updateColor}})],1),t._v(" "),i("div",{staticClass:"separator"})],1),t._v(" "),i("div",{staticClass:"param param-component"},[i("div",{staticClass:"param-caption"},[t._v("Radius")]),t._v(" "),i("numeric-input",{class:{inactive:t.m.border_radius_max},attrs:{autofocus:!0,autosize:!1,min:0,max:999,dir:"v",speed:5},on:{change:t.onBorderRadiusChange},model:{value:t.m.border_radius,callback:function(e){t.$set(t.m,"border_radius",e)},expression:"m.border_radius"}}),t._v(" "),i("div",{staticClass:"border-radius-max",class:{active:t.m.border_radius_max},attrs:{title:"Radius: 100%"},on:{click:t.toggleBorderRadiusMax}}),t._v(" "),i("div",{staticClass:"separator"})],1),t._v(" "),i("div",{staticClass:"param-component opacity"},[i("transition",{attrs:{name:"fade"}},[t.opacityActive?t._e():i("div",{key:"title",staticClass:"param-caption"},[t._v("Opacity")]),t._v(" "),t.opacityActive?i("div",{key:"percent",staticClass:"percent param-caption"},[t._v(t._s(t.opacityPercents))]):t._e()]),t._v(" "),i("rm-opacity-drag",{ref:"opacity",on:{"opacity-active":t.showPercents},model:{value:t.m.opacity,callback:function(e){t.$set(t.m,"opacity",e)},expression:"m.opacity"}})],1)])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"picture_preloader rmpreloader"},[e("div",{staticClass:"shadow"}),this._v(" "),e("div",{staticClass:"arc"})])}],!1,null,"acc16b4e",null).exports),Tt={methods:{getAudioFromUrl:function(t){var e;if(/soundcloud\.com\/.+/.test(t)||/snd\.sc\/.+/.test(t)){var i={url:t=t.replace(/\/?#?$/,"")};e="http://soundcloud.com/oembed?format=json&url="+encodeURIComponent(t),this.audioEmbedXHR&&this.audioEmbedXHR.abort(),this.audioEmbedXHR=o.a.ajax({type:"GET",url:"/api/proxy/",dataType:"json",data:{url:e},global:!1,success:s.a.bind((function(e){e.parsed_url=this.parseUrl(e.html),e.thumbnail_url=e.thumbnail_url.replace("-large","-t300x300"),e.thumbnail_url=e.thumbnail_url.replace("-t500x500","-t300x300"),e.parsed_url?this.loadTracksData(s.a.extend(e,i),[{url:t}]):this.$emit("audioEmbedError")}),this),error:s.a.bind((function(t,e,i){"abort"!=e&&this.$emit("audioEmbedError")}),this)}),this.$emit("audioDataObtained",i)}else this.$emit("audioWrongUrl")},parseUrl:function(t){var e=t.match(/.*?src=\"(.*?)\".*?/);if(e&&e.length&&e[1]){var i=e[1].split("?"),o=i[0],n=i[1].split("&"),a=["auto_play","buying","liking","download","sharing","show_artwork","show_comments","show_playcount","color","auto_advance","show_user","visual"],r=[];return s.a.each(n,(function(t){var e=t.split("=");e[0]&&!s.a.contains(a,e[0])&&r.push(t)})),o+"?"+r.join("&")}},isURL:function(t){return/^http(s?)\:\/\//i.test(t)},scApiUrl:function(t){var e="https:"===document.location.protocol,i=(e||/^https/i.test(t)?"https":"http")+"://api.soundcloud.com/resolve?url=",s="format=json&client_id="+this.apiKey;return e&&(t=t.replace(/^http:/,"https:")),/api\./.test(t)?t+"?"+s:i+t+"&"+s},loadTracksData:function(t,e){var i=0,s={tracks:[]},n=this;if(this.apiKey){!function a(r){var l=n.scApiUrl(r.url);o.a.ajax({url:l,method:"GET",dataType:"json",success:function(l){i+=1,l.tracks?s.tracks=s.tracks.concat(l.tracks):l.duration?(l.permalink_url=r.url,s.tracks.push(l)):l.creator?e.push({url:l.uri+"/tracks"}):l.username?/favorites/.test(r.url)?e.push({url:l.uri+"/favorites"}):e.push({url:l.uri+"/tracks"}):o.a.isArray(l)&&(s.tracks=s.tracks.concat(l)),e[i]?a(e[i]):n.tracksDataIsLoaded(t,s.tracks)},error:function(t){n.$emit("audioEmbedError"),console.log("xhr : ",t)},context:this})}(e[i])}else this.$emit("audioEmbedError","No SoundCloud API key configured.")},tracksDataIsLoaded:function(t,e){e.length?((/tracks/i.test(t.parsed_url)||t.thumbnail_url&&/fb_placeholder/.test(t.thumbnail_url))&&(e[0].artwork_url?t.thumbnail_url=e[0].artwork_url.replace("-large","-t300x300"):e[0].user&&e[0].user.avatar_url&&(t.thumbnail_url=e[0].user.avatar_url.replace("-large","-t300x300")),t.title=e[0].title),t.thumbnail_url&&r.b.toHttps(t.thumbnail_url),this.$emit("audioEmbedLoaded",t)):this.$emit("audioEmbedError")}}},Mt=Object(Z.a)(Tt,void 0,void 0,!1,null,null,null).exports,jt={components:{RmSwitcher:at.a,RmSpinner:bt.a,ColorPicker:rt.a},mixins:[tt,Mt],data:function(){return{state:"default",errorMessage:"",apiKey:r.a.SOUNDCLOUD_API,search:this.url,playerVar:["visual","standard","minimal"],playerTitle:["Visual Player","Original Player","Minimal"]}},computed:{isUrl:function(){return this.isURL(this.search)},currInd:function(){var t=this.playerVar.indexOf(this.m.current_type);return t<0?0:t}},mounted:function(){this.$on("audioWrongUrl",this.onAudioWrongUrl),this.$on("audioEmbedError",this.onAudioEmbedError),this.$on("audioEmbedLoaded",this.onAudioEmbedLoaded),this.$on("audioDataObtained",this.onAudioDataObtained),this.search=this.m.url},methods:{spinType:function(t){this.m.current_type=this.playerVar[(this.currInd+t)%3]},loadAudio:function(){this.getAudioFromUrl(this.search)},resetAudio:function(){var t={url:"",parsed_url:"",thumbnail_url:"",title:"",embed_height:void 0,resized:!1};this.search="",this.$parent.$emit("change",t),this.errorMessage=""},onAudioWrongUrl:function(){console.log("onAudioWrongUrl",arguments)},onAudioEmbedError:function(){console.log("onAudioEmbedError",arguments),this.errorMessage="Can't add track due to it's privacy settings. Try change the sharing settings of your track"},onAudioEmbedLoaded:function(t){if(t.thumbnail_url){var e=s.a.pick(t,"url","thumbnail_url","title","parsed_url","height");e.embed_height=e.height,e.height=void 0,e.resized=!1,this.$parent.$emit("change",e),this.errorMessage=""}else this.onAudioEmbedError()},onAudioDataObtained:function(){console.log("onAudioDataObtained",arguments),this.errorMessage=""}}},It=Object(Z.a)(jt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel"},[i("div",{staticClass:"panel-title"},[t._v("Audio")]),t._v(" "),t.m.url?t._e():i("a",{staticClass:"soundcloud-logo",attrs:{href:"https://soundcloud.com/",target:"_blank"}}),t._v(" "),i("div",{staticClass:"search"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.search,expression:"search"}],staticClass:"search-input",class:{"with-icon":t.isUrl&&!t.m.url||t.m.url},attrs:{placeholder:"Paste URL"},domProps:{value:t.search},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.loadAudio(e)},input:function(e){e.target.composing||(t.search=e.target.value)}}}),t._v(" "),t.isUrl&&!t.m.url?i("div",{staticClass:"sicon apply-btn",on:{click:function(e){return e.stopPropagation(),t.loadAudio(e)}}}):t._e(),t._v(" "),t.m.url?i("div",{staticClass:"sicon remove-btn",on:{click:function(e){return e.stopPropagation(),t.resetAudio(e)}}}):t._e()]),t._v(" "),t.m.url?i("a",{staticClass:"soundcloud-logo-small",attrs:{href:"https://soundcloud.com/",target:"_blank"}}):t._e(),t._v(" "),t.errorMessage?i("div",{staticClass:"error-message"},[t._v(t._s(t.errorMessage))]):t._e(),t._v(" "),t.m.url?i("div",{staticClass:"settings"},[i("div",{staticClass:"description"},[t._v(t._s(t.m.title))]),t._v(" "),i("div",{staticClass:"separator"}),t._v(" "),i("rm-spinner",{attrs:{variants:[{value:"visual",title:"Visual Player"},{value:"standard",title:"Original Player"},{value:"minimal",title:"Minimal"}]},model:{value:t.m.current_type,callback:function(e){t.$set(t.m,"current_type",e)},expression:"m.current_type"}}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Comments")]),t._v(" "),i("rm-switcher",{model:{value:t.m.comments,callback:function(e){t.$set(t.m,"comments",e)},expression:"m.comments"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Artwork")]),t._v(" "),i("rm-switcher",{model:{value:t.m.artwork,callback:function(e){t.$set(t.m,"artwork",e)},expression:"m.artwork"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Social")]),t._v(" "),i("rm-switcher",{model:{value:t.m.socials,callback:function(e){t.$set(t.m,"socials",e)},expression:"m.socials"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Color")]),t._v(" "),i("color-picker",{attrs:{color:t.m.color,"show-alpha":!1},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.m.color=e}}})],1)],1):t._e()])}),[],!1,null,null,null).exports;function Et(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function At(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var Rt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),At(this,"prevSVGSearch",{}),At(this,"defaultIcons",[{rm_id:"rm0",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/00-star.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/00-star.svg")},{rm_id:"rm1",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/01-bolt.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/01-bolt.svg")},{rm_id:"rm2",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/02-bubble.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/02-bubble.svg")},{rm_id:"rm3",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/03-camera.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/03-camera.svg")},{rm_id:"rm4",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/04-cloud.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/04-cloud.svg")},{rm_id:"rm5",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/05-download1.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/05-download1.svg")},{rm_id:"rm6",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/06-download2.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/06-download2.svg")},{rm_id:"rm7",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/07-globe2.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/07-globe2.svg")},{rm_id:"rm8",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/08-globe.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/08-globe.svg")},{rm_id:"rm9",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/09-pin.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/09-pin.svg")},{rm_id:"rm10",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/10-share1.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/10-share1.svg")},{rm_id:"rm11",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/11-share2.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/11-share2.svg")},{rm_id:"rm12",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/12-send.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/12-send.svg")},{rm_id:"rm13",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/13-checkmark.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/13-checkmark.svg")},{rm_id:"rm14",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/14-x.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/14-x.svg")},{rm_id:"rm15",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/15-minus.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/15-minus.svg")},{rm_id:"rm16",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/16-plus.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/16-plus.svg")},{rm_id:"rm17",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/17-mail1.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/17-mail1.svg")},{rm_id:"rm18",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/18-mail2.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/18-mail2.svg")},{rm_id:"rm19",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/19-user.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/19-user.svg")},{rm_id:"rm20",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/20-clock.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/20-clock.svg")},{rm_id:"rm21",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/21-embed.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/21-embed.svg")},{rm_id:"rm22",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/22-flag.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/22-flag.svg")},{rm_id:"rm23",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/23-heart.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/23-heart.svg")},{rm_id:"rm24",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/24-itunes.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/24-itunes.svg")},{rm_id:"rm25",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/25-like.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/25-like.svg")},{rm_id:"rm26",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/26-music.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/26-music.svg")},{rm_id:"rm27",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/27-play.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/27-play.svg")},{rm_id:"rm28",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/28-video.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/28-video.svg")},{rm_id:"rm29",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/29-facebook.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/29-facebook.svg")},{rm_id:"rm30",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/30-twitter.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/30-twitter.svg")},{rm_id:"rm31",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/31-linkedin.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/31-linkedin.svg")},{rm_id:"rm32",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/32-pinterest.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/32-pinterest.svg")},{rm_id:"rm33",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/33-instagram.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/33-instagram.svg")},{rm_id:"rm34",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/34-googleplus.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/34-googleplus.svg")},{rm_id:"rm35",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/35-tumblr.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/35-tumblr.svg")},{rm_id:"rm36",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/36-youtube.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/36-youtube.svg")},{rm_id:"rm37",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/37-vimeo.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/37-vimeo.svg")},{rm_id:"rm38",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/38-flickr.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/38-flickr.svg")},{rm_id:"rm39",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/39-blogger.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/39-blogger.svg")},{rm_id:"rm40",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/40-dribbble.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/40-dribbble.svg")},{rm_id:"rm41",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/41-behance.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/41-behance.svg")},{rm_id:"rm42",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/42-rss.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/42-rss.svg")},{rm_id:"rm43",icon_url:Object(c.b)("./constructor/blocks/shape/default-collection/43-at.svg"),preview_url_42:Object(c.b)("./constructor/blocks/shape/default-collection/43-at.svg")}])}var e,i,n;return e=t,(i=[{key:"fetchIconsPage",value:function(t){var e;if(!t||this.searchInProgress)return Promise.resolve();var i=this.prevSVGSearch.nextPage||0;return this.prevSVGSearch.query!==t&&(i=0,this.prevSVGSearch.icons=[]),e="/icons/"+t+"?page="+i,new Promise(function(s,o){this.requestIcons(e,function(e,o){return e?(delete this.prevSVGSearch.nextPage,s(this.prevSVGSearch.icons)):(this.prevSVGSearch.icons=this.prevSVGSearch.icons.concat(o.icons),this.prevSVGSearch.query=t,this.prevSVGSearch.nextPage=i+1,s(this.prevSVGSearch.icons))}.bind(this))}.bind(this))}},{key:"requestIcons",value:function(t,e){this.destroyed||(this.searchXhr&&this.searchXhr.abort(),this.searchInProgress=!0,this.searchXhr=o.a.ajax({method:"GET",url:"/api/authservice/noun?uri="+encodeURIComponent(t),dataType:"json",success:function(t){e(null,t)},error:function(t){e(t)},complete:function(){this.searchInProgress=!1},context:this}))}},{key:"clearSearch",value:function(){this.prevSVGSearch={},this.searchXhr&&this.searchXhr.abort(),this.searchInProgress=!1}},{key:"findIcon",value:function(t){return t.rm_id?s.a.findWhere(this.defaultIcons,t):s.a.findWhere(this.prevSVGSearch.icons,{id:t.noun_id})}},{key:"destroy",value:function(){this.clearSearch(),this.destroyed=!0}}])&&Et(e.prototype,i),n&&Et(e,n),t}();function Dt(t,e,i,s,o,n,a){try{var r=t[n](a),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(s,o)}var zt,Lt,Bt={components:{RmScroll:i("0DSZ").a},props:{rawBlock:Object,placeholder:{type:String,default:"Search"}},data:function(){var t=new Rt;return{iconsutils:t,icons:t.prevSVGSearch.icons||t.defaultIcons,searchString:t.prevSVGSearch.query,currentSearchString:t.prevSVGSearch.query,isSearch:!!t.prevSVGSearch.query,iconsListLoading:!1,iconLoading:null,iconSelected:!1,savedScrollPosition:t.prevSVGSearch.savedScrollPosition||0}},watch:{"block.tp":{handler:function(){V.a.nextTick(function(){this.$emit("resize")}.bind(this))},immediate:!0}},mounted:function(){this.iconSelected=this.iconsutils.findIcon(s.a.pick(this.block,"noun_id","rm_id")),this._scroll=this.$refs.rmscroll},beforeDestroy:function(){this.iconsutils&&this.iconsutils.destroy()},methods:{onLoupeClick:function(t){this.isSearch?this.clearSearch():this.doSearch()},doSearch:function(){this.searchString&&this.currentSearchString!==this.searchString&&!this.iconsutils.searchInProgress&&(this.savedScrollPosition=0,this.currentSearchString=this.searchString,this.icons=[],delete window.prevSVGSearch,this.isSearch=!0,this.fetchIcons())},clearSearch:function(){this.savedScrollPosition=0,this.isSearch=!1,this.searchString="",this.currentSearchString="",this.icons=this.iconsutils.defaultIcons,this.iconsutils.clearSearch()},onPanelScroll:function(t){this.iconsutils.prevSVGSearch.savedScrollPosition=t.scroll_pos,this.savedScrollPosition=t.scroll_pos,t.content_size-t.container_size-t.scroll_pos<32&&this.iconsutils.prevSVGSearch.nextPage&&!this.iconsutils.searchInProgress&&this.fetchIcons()},fetchIcons:(zt=regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.iconsListLoading=!0,t.next=3,this.iconsutils.fetchIconsPage(this.searchString);case 3:this.icons=t.sent,this.iconsListLoading=!1,this._scroll.recalcScroll();case 6:case"end":return t.stop()}}),t,this)})),Lt=function(){var t=this,e=arguments;return new Promise((function(i,s){var o=zt.apply(t,e);function n(t){Dt(o,i,s,n,a,"next",t)}function a(t){Dt(o,i,s,n,a,"throw",t)}n(void 0)}))},function(){return Lt.apply(this,arguments)}),onIconItemClick:function(t){this.iconLoading||(this.$emit("dataObtained",t),this.iconLoading=!1)}}},Ft=Bt,Ht=(i("cre3"),Object(Z.a)(Ft,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"icons"},[i("div",{staticClass:"search-block"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.searchString,expression:"searchString"}],staticClass:"search",attrs:{type:"text",placeholder:t.placeholder,raw_block:t.raw_block},domProps:{value:t.searchString},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.doSearch(e)},input:function(e){e.target.composing||(t.searchString=e.target.value)}}}),t._v(" "),i("div",{staticClass:"loupe",class:{clear:t.isSearch,preloading:t.iconsListLoading},on:{click:t.onLoupeClick}},[t._m(0)])]),t._v(" "),i("div",{staticClass:"separator"}),t._v(" "),i("div",{staticClass:"common-wrapper"},[i("rm-scroll",{ref:"rmscroll",attrs:{"on-panel-scroll":t.onPanelScroll,"scroll-gap-start":8,"scroll-gap-end":8,"saved-scroll-position":t.savedScrollPosition}},t._l(t.icons||[],(function(e){return i("div",{key:e.id,staticClass:"icon-item",class:{preloading:t.iconLoading==e,selected:t.iconSelected==e},on:{click:function(i){return t.onIconItemClick(e)}}},[i("div",{staticClass:"noun-icon",style:{"background-image":"url('"+e.preview_url_42+"')"},attrs:{"data-id":e.id,"data-rm_id":e.rm_id,"data-url":e.icon_url}}),t._v(" "),t.iconLoading==e?i("div",{staticClass:"rmpreloader"},[i("div",{staticClass:"arc"})]):t._e()])})),0)],1)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"rmpreloader hidden"},[e("div",{staticClass:"arc"})])}],!1,null,"0d030c02",null)),Nt=Ht.exports,Vt={components:{NumericInput:et.a,ColorPicker:rt.a,ShapeSearch:Nt},mixins:[tt],data:function(){var t=new Rt;return{iconsutils:t,stroke_popup_visible:!1,icons:t.prevSVGSearch.icons||t.defaultIcons}},watch:{"block.tp":{handler:function(){V.a.nextTick(function(){this.$emit("resize")}.bind(this))},immediate:!0}},mounted:function(){this.iconSelected=this.iconsutils.findIcon(s.a.pick(this.block,"noun_id","rm_id"))},beforeDestroy:function(){this.iconsutils&&this.iconsutils.destroy()},methods:{selectShape:function(t){this.block.tp=t,"icon"!==t?this.abortRequests():this.updateShapeSearchScroll()},updateShapeSearchScroll:function(){this.$refs.shapeSearch.$refs.rmscroll.recalcScroll()},onInputChange:function(t,e){this.block[t]=e},updateColor:function(t){this.block.color=t.color,this.block.opacity=t.alpha},closeOtherPopups:function(){this.$refs.colorpicker.hide(),this.stroke_popup_visible=!1},toggleStrokePopup:function(t){Object(o.a)(t.target).closest(".stroke-selector .stroke-popup").length>0||(this.stroke_popup_visible=!this.stroke_popup_visible)},selectStroke:function(t){this.block.stroke=t,this.stroke_popup_visible=!1},onDataObtained:function(t){var e=this;this.raw_block.getIconSVG(t.id||t.rm_id,t.icon_url,{noCache:!0},(function(i){if(!i){var o={noun_url:t.icon_url};t.id?s.a.extend(o,{noun_id:t.id,rm_id:null}):t.rm_id&&s.a.extend(o,{noun_id:null,rm_id:t.rm_id}),e.raw_block.model.set(o)}}))},abortRequests:function(){this.iconsutils.clearSearch()}}},Ut=(i("MyX/"),Object(Z.a)(Vt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel resizable",class:{"overflow-visible":t.stroke_popup_visible},attrs:{"data-current-type":t.block.tp},on:{click:t.closeOtherPopups}},[i("div",{staticClass:"param-caption"},[t._v("Shape")]),t._v(" "),i("div",{staticClass:"selector",attrs:{"data-current-type":t.block.tp}},[t._l(["rectangle","polygon","ellipse","line","icon"],(function(e){return i("div",{key:e,staticClass:"shape",attrs:{"data-type":e},on:{click:function(i){return t.selectShape(e)}}})})),t._v(" "),i("div",{staticClass:"separator"})],2),t._v(" "),i("div",{staticClass:"details"},[i("div",{staticClass:"weight param-component"},[i("div",{staticClass:"param-caption"},[t._v("Weight")]),t._v(" "),i("numeric-input",{attrs:{autofocus:!0,autosize:!1,min:1,max:999,dir:"v",speed:5},model:{value:t.block.weight,callback:function(e){t.$set(t.block,"weight",e)},expression:"block.weight"}}),t._v(" "),i("div",{staticClass:"separator"})],1),t._v(" "),i("div",{staticClass:"sides param-component"},[i("div",{staticClass:"param-caption"},[t._v("Sides")]),t._v(" "),i("numeric-input",{attrs:{autofocus:!0,autosize:!1,min:3,max:30,dir:"v",speed:10},model:{value:t.block.sides,callback:function(e){t.$set(t.block,"sides",e)},expression:"block.sides"}}),t._v(" "),i("div",{staticClass:"separator"})],1),t._v(" "),i("div",{staticClass:"borders param-component"},[i("div",{staticClass:"param-caption name-border"},[t._v(t._s("ellipse"==t.block.tp?"Border":"Borders"))]),t._v(" "),i("numeric-input",{style:{width:"66px"},attrs:{autofocus:!0,autosize:!1,min:0,max:999,dir:"v",speed:5},model:{value:t.block.borders,callback:function(e){t.$set(t.block,"borders",e)},expression:"block.borders"}}),t._v(" "),i("div",{staticClass:"border-color",attrs:{title:"Color"}},[i("color-picker",{ref:"colorpicker",staticClass:"color round",attrs:{color:t.block.color,alpha:t.block.opacity,"opacity-multiplier":100,"v-offset":8,"show-alpha":!0,"show-arrow-icon":!0},on:{"update:all":t.updateColor}})],1),t._v(" "),i("div",{staticClass:"colorbox_container"}),t._v(" "),i("div",{staticClass:"separator"})],1),t._v(" "),i("div",{staticClass:"radius param-component"},[i("div",{staticClass:"param-caption"},[t._v("Radius")]),t._v(" "),i("numeric-input",{attrs:{autofocus:!0,autosize:!1,min:0,max:999,dir:"v",speed:5},model:{value:t.block.radius,callback:function(e){t.$set(t.block,"radius",e)},expression:"block.radius"}})],1),t._v(" "),i("div",{staticClass:"stroke param-component"},[i("div",{staticClass:"param-caption"},[t._v("Stroke")]),t._v(" "),i("div",{staticClass:"stroke-selector",class:{opened:t.stroke_popup_visible},attrs:{"data-current-type":t.block.stroke},on:{click:function(e){return e.stopPropagation(),t.toggleStrokePopup(e)}}},[i("div",{staticClass:"stroke-popup"},t._l(["solid","double","dotted","dashed"],(function(e){return i("div",{key:e,staticClass:"stroke-item",attrs:{"data-type":e},on:{click:function(i){return t.selectStroke(e)}}},[i("div",{staticClass:"preview"}),t._v(" "),i("div",{staticClass:"point"})])})),0),t._v(" "),i("div",{staticClass:"current"}),t._v(" "),i("div",{staticClass:"popup-arrow"})])])]),t._v(" "),i("shape-search",{ref:"shapeSearch",on:{dataObtained:t.onDataObtained}})],1)}),[],!1,null,"30763dfc",null).exports),Wt={components:{RmSwitcher:at.a,ColorPicker:rt.a,ShapeSearch:Nt,NumericInput:et.a},mixins:[tt],data:function(){var t=new Rt;return{iconsutils:t,uploading:!1,dragging:!1,activeNounArrow:"left",icons:t.prevSVGSearch.icons||t.defaultIcons,m:{pictures:[]}}},computed:{hasPictures:function(){return!s.a.isEmpty(this.m.pictures)},compoundProperty:function(){return[this.raw_block.queue,this.block.theme_data.captions].join()}},watch:{compoundProperty:{handler:function(){V.a.nextTick(function(){this.$emit("resize")}.bind(this))},immediate:!0}},mounted:function(){this.uploader=this.raw_block.uploader,this.uploader.on("start",this.showPreloader),this.uploader.on("done fail",this.checkFinishUpload),this.raw_block.settingsPanel=this,this.raw_block.updateDropZone(),this.raw_block.colorbox_visible=!1,this.raw_block.workspace.on("main-dragover",this.highlightDropZone,this)},beforeDestroy:function(){this.raw_block.workspace.off("main-dragover",this.highlightDropZone,this),this.iconsutils&&this.iconsutils.destroy()},methods:{upload:function(t){this.raw_block.$(".uploadInput").trigger("click","stop")},closePopups:function(t){s.a.each(this.$children,(function(e){e!==t&&(e.visibleBox=!1)}))},onShowPopup:function(t){this.closePopups(t),this.raw_block.colorbox_visible=!0},onUpdateColor:function(t){this.block.theme_data.controls_color=t,this.raw_block.needRasterize=!0},updateShapeSearchScroll:function(){this.$refs.shapeSearch.$refs.rmscroll.recalcScroll()},getCapitalizedName:function(t){return r.b.capitalize(t)},onCountersTypeClick:function(t){if(Object(o.a)(t.target).hasClass("dots")){if(Object(o.a)(t.target).hasClass("disabled"))return void t.preventDefault();this.block.theme_data.counters_type="dots"}else this.block.theme_data.counters_type="numbers"},onCrossfadeValueChange:function(t){this.block.theme_data.autoplay_delay<t&&(this.block.theme_data.autoplay_delay=t)},onThumbnailsChange:function(t){t&&(this.block.theme_data.counters_type="numbers",this.block.theme_data.captions=!1)},onCaptionsChange:function(t){this.raw_block.trigger("captions_changed",t),t&&(this.block.theme_data.thumbnails=!1)},onArrowsTypeChange:function(t){"library"!==t&&"noun"!==t||this.updateShapeSearchScroll(),this.block.theme_data.arrows_type=t,this.block.current_mode=t,this.raw_block.trigger("arrow_type_changed")},onDataObtained:function(t){var e=this,i="left"===this.activeNounArrow?"left_arrow_noun":"right_arrow_noun";this.raw_block.getIconSVG(t.id||t.rm_id,t.icon_url,i,(function(i,o){var n;e.raw_block.needRasterize=!0,i||(n={noun_url:t.icon_url},t.id?s.a.extend(n,{noun_id:t.id,rm_id:null}):t.rm_id&&s.a.extend(n,{noun_id:null,rm_id:t.rm_id}),"left"===e.activeNounArrow?e.block.theme_data.left_icon_noun=n:e.block.theme_data.right_icon_noun=n)}))},canUpload:function(){return!this.hasPictures&&!this.uploading},checkFinishUpload:function(){s.a.isEmpty(this.raw_block.queue)&&(this.uploading=!1)},highlightDropZone:function(t){var e=this;this.dragging=!0,clearTimeout(this.highlightTimeout),this.highlightTimeout=setTimeout((function(){e.dragging=!1}),500)},showPreloader:function(){this.uploading=!0},cancelUpload:function(){this.uploading=!1,this.raw_block.removePictures()}}},Gt=(i("Gc47"),Object(Z.a)(Wt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel slideshow-panel resizable",class:{noun:"library"===t.block.current_mode||"noun"===t.block.current_mode,"has-upload-images":t.hasPictures,uploading:t.uploading&&!t.hasPictures,dragging:t.dragging},on:{click:t.closePopups}},[i("div",{staticClass:"upload"},[i("div",{staticClass:"upload-wrapper"},[i("div",{staticClass:"center-wrapper",on:{click:function(e){return t.upload(e)}}},[i("div",{staticClass:"icon"}),t._v(" "),i("div",{staticClass:"caption-upload-dop"},[t._v(t._s(t.dragging?"drop here":"drop file here"))])])])]),t._v(" "),t._m(0),t._v(" "),i("div",{staticClass:"loading"},[i("div",{staticClass:"delete",on:{click:t.cancelUpload}})]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"default"===t.block.current_mode,expression:"block.current_mode === 'default'"}],staticClass:"settings"},[i("div",{staticClass:"colorbox_container"}),t._v(" "),i("div",{staticClass:"params",attrs:{"data-current-theme":t.block.current_theme}},[i("div",{staticClass:"param param-arrows solid-separator",class:{invisible:t.block.theme_data.arrows}},[i("div",{staticClass:"caption"},[t._v("Arrows")]),t._v(" "),i("rm-switcher",{attrs:{width:40,height:24,"color-on":"#282828","color-off":"#B8B8B8"},model:{value:t.block.theme_data.arrows,callback:function(e){t.$set(t.block.theme_data,"arrows",e)},expression:"block.theme_data.arrows"}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.block.theme_data.arrows,expression:"block.theme_data.arrows"}],staticClass:"param param-arrows-type"},t._l(["default","library"],(function(e){var s;return i("div",{key:e,staticClass:"arrows-type",class:(s={active:t.block.theme_data.arrows_type===e},s[e]=!0,s),on:{click:function(i){return t.onArrowsTypeChange(e)}}},[t._v("\n          "+t._s(t.getCapitalizedName(e))+"\n        ")])})),0),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.block.theme_data.arrows,expression:"block.theme_data.arrows"}],staticClass:"param param-arrows-view-mode solid-separator",class:{invisible:"normal"===t.block.theme_data.arrows_view_mode}},t._l(["normal","mouseover"],(function(e){var s;return i("div",{key:e,staticClass:"arrows-view-mode",class:(s={active:t.block.theme_data.arrows_view_mode===e},s[e]=!0,s),on:{click:function(i){t.block.theme_data.arrows_view_mode=e}}},[t._v("\n          "+t._s(t.getCapitalizedName(e))+"\n        ")])})),0),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.block.theme_data.arrows&&"normal"===t.block.theme_data.arrows_view_mode,expression:"block.theme_data.arrows && block.theme_data.arrows_view_mode === 'normal'"}],staticClass:"param param-arrows-position solid-separator"},t._l(["sides","bottom"],(function(e){var s;return i("div",{key:e,staticClass:"arrows-position",class:(s={active:t.block.theme_data.arrows_position===e},s[e]=!0,s),on:{click:function(i){t.block.theme_data.arrows_position=e}}},[t._v("\n          "+t._s(t.getCapitalizedName(e))+"\n        ")])})),0),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("div",{staticClass:"param param-counters solid-separator",class:{invisible:t.block.theme_data.counters}},[i("div",{staticClass:"caption"},[t._v("Counter")]),t._v(" "),i("rm-switcher",{attrs:{width:40,height:24,"color-on":"#282828","color-off":"#B8B8B8"},model:{value:t.block.theme_data.counters,callback:function(e){t.$set(t.block.theme_data,"counters",e)},expression:"block.theme_data.counters"}})],1)]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.block.theme_data.counters,expression:"block.theme_data.counters"}],staticClass:"param param-counters-type solid-separator",class:{invisible:"numbers"!==t.block.theme_data.counters_type}},t._l(["numbers","dots"],(function(e){var s;return i("div",{key:e,staticClass:"counters-type",class:(s={active:t.block.theme_data.counters_type===e,disabled:"dots"===e&&t.block.theme_data.thumbnails},s[e]=!0,s),on:{click:t.onCountersTypeClick}},[t._v("\n          "+t._s(t.getCapitalizedName(e))+"\n        ")])})),0),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.block.theme_data.counters&&"dots"===t.block.theme_data.counters_type,expression:"block.theme_data.counters && block.theme_data.counters_type === 'dots'"}],staticClass:"param param-counters-position solid-separator"},t._l(["inside","outside"],(function(e){var s;return i("div",{key:e,staticClass:"counters-position",class:(s={active:t.block.theme_data.counters_position===e,disabled:"dots"===e&&t.block.theme_data.thumbnails},s[e]=!0,s),on:{click:function(i){t.block.theme_data.counters_position=e}}},[t._v("\n          "+t._s(t.getCapitalizedName(e))+"\n        ")])})),0),t._v(" "),i("div",{staticClass:"param param-fullscreen solid-separator"},[i("div",{staticClass:"caption"},[t._v("Fullscreen")]),t._v(" "),i("rm-switcher",{attrs:{width:40,height:24,"color-on":"#282828","color-off":"#B8B8B8"},model:{value:t.block.theme_data.fullscreen,callback:function(e){t.$set(t.block.theme_data,"fullscreen",e)},expression:"block.theme_data.fullscreen"}})],1),t._v(" "),i("div",{staticClass:"param param-controls solid-separator"},[i("div",{staticClass:"caption"},[t._v("Icons color")]),t._v(" "),i("color-picker",{attrs:{color:t.block.theme_data.controls_color,"show-alpha":!1},on:{showPopup:t.onShowPopup,"update:color":function(e){return t.onUpdateColor(e)}}})],1),t._v(" "),i("div",{staticClass:"param param-captions"},[i("div",{staticClass:"caption"},[t._v("Captions")]),t._v(" "),i("rm-switcher",{attrs:{callback:t.onCaptionsChange,width:40,height:24,"color-on":"#282828","color-off":"#B8B8B8"},model:{value:t.block.theme_data.captions,callback:function(e){t.$set(t.block.theme_data,"captions",e)},expression:"block.theme_data.captions"}})],1),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("div",{staticClass:"param param-thumbnails"},[i("div",{staticClass:"caption"},[t._v("Thumbs")]),t._v(" "),i("rm-switcher",{attrs:{callback:t.onThumbnailsChange,width:40,height:24,"color-on":"#282828","color-off":"#B8B8B8"},model:{value:t.block.theme_data.thumbnails,callback:function(e){t.$set(t.block.theme_data,"thumbnails",e)},expression:"block.theme_data.thumbnails"}})],1)]),t._v(" "),i("div",{staticClass:"param param-fill solid-separator",class:{invisible:t.block.theme_data.thumbnails||!t.block.theme_data.fill||t.block.theme_data.radius>0}},[i("div",{staticClass:"caption"},[t._v("Fill")]),t._v(" "),i("rm-switcher",{attrs:{width:40,height:24,"color-on":"#282828","color-off":"#B8B8B8"},model:{value:t.block.theme_data.fill,callback:function(e){t.$set(t.block.theme_data,"fill",e)},expression:"block.theme_data.fill"}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.block.theme_data.thumbnails||!t.block.theme_data.fill||t.block.theme_data.radius>0,expression:"block.theme_data.thumbnails || !block.theme_data.fill || block.theme_data.radius > 0"}],staticClass:"param param-backgroundr solid-separator"},[i("div",{staticClass:"caption"},[t._v("Bg color")]),t._v(" "),i("color-picker",{attrs:{"vertical-align":"top",color:t.block.theme_data.background_color,alpha:t.block.theme_data.background_opacity,"opacity-multiplier":100,"show-alpha":!0},on:{"update:color":function(e){return t.block.theme_data.background_color=e},"update:alpha":function(e){return t.block.theme_data.background_opacity=e},showPopup:t.onShowPopup}})],1),t._v(" "),i("div",{staticClass:"param param-radius"},[i("div",{staticClass:"caption"},[t._v("Radius")]),t._v(" "),i("numeric-input",{class:{active:t.block.theme_data.radius>0},attrs:{autofocus:!1,autosize:!1,min:0,max:999,dir:"v",speed:5},model:{value:t.block.theme_data.radius,callback:function(e){t.$set(t.block.theme_data,"radius",e)},expression:"block.theme_data.radius"}})],1)],1)]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"library"===t.block.current_mode||"noun"===t.block.current_mode,expression:"block.current_mode === 'library' || block.current_mode === 'noun'"}],staticClass:"noun-settings"},[i("div",{staticClass:"noun-wrapper solid-separator"},t._l(["left","right"],(function(e){var s;return i("span",{key:e,staticClass:"arrow-noun",class:(s={active:t.activeNounArrow==e},s[e]=!0,s),on:{click:function(i){t.activeNounArrow=e}}},[t._v(t._s(t.getCapitalizedName(e)))])})),0),t._v(" "),i("shape-search",{ref:"shapeSearch",on:{dataObtained:t.onDataObtained}})],1)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"picture_preloader rmpreloader"},[e("div",{staticClass:"shadow"}),this._v(" "),e("div",{staticClass:"arc"})])}],!1,null,"bf848d06",null).exports),qt={components:{NumericInput:et.a},mixins:[tt],data:function(){return{isPlayOnScrollEnabled:Object(u.a)("constructor.playOnScroll"),isHoverDisabled:!1,methodsObject:{click:"Play on click",hover:"Play on hover",scroll:"On scroll",autoplay:"Autoplay"}}},computed:{},mounted:function(){this.raw_block.workspace.page.on("change:viewport",this.onChangeViewport),this.onChangeViewport()},methods:{onTransitionsValueChange:function(t){(this.block.theme_data.autoplay_delay<t||this.block.theme_data.hover_delay<t)&&(this.block.theme_data.autoplay_delay=t,this.block.theme_data.hover_delay=t)},onTransitionsTypeChange:function(t){this.block.transition_type=t,this.resetTransition()},resetTransition:function(){"scroll"===this.block.play_method&&"slider"===this.block.transition_type&&(this.block.theme_data.slider_transition=0)},onPlayMethodsChange:function(t){this.block.play_method=t,this.resetTransition()},onChangeViewport:function(){var t=this.raw_block.workspace.page.getCurrentViewport(),e=this.raw_block.workspace.page.getViewportParam("phone_portrait","enabled"),i=this.raw_block.workspace.page.getViewportParam("tablet_portrait","enabled");this.isHoverDisabled="default"!==t,(e||i)&&this.isHoverDisabled&&"hover"===this.block.play_method&&(this.block.play_method="autoplay")},getPlayMethods:function(){var t,e=this.raw_block.workspace.page.getCurrentViewport();return t=this.isPlayOnScrollEnabled?this.methodsObject:s.a.omit(this.methodsObject,"scroll"),t="default"!==e?s.a.omit(t,"hover"):t}}},Xt=Object(Z.a)(qt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel slideshow-transition-panel transitions resizable"},[i("div",{staticClass:"settings"},[i("div",{staticClass:"params"},[i("div",{staticClass:"param param-transition-type"},t._l(["slider","crossfade"],(function(e){var s;return i("div",{key:e,staticClass:"transition-type",class:(s={active:t.block.transition_type===e},s[e]=!0,s),on:{click:function(i){return t.onTransitionsTypeChange(e)}}},[t._v("\n          "+t._s(e.charAt(0).toUpperCase()+e.slice(1))+"\n        ")])})),0),t._v(" "),i("div",{staticClass:"param param-play-method",class:{click:"click"===t.block.play_method,hover:"hover"===t.block.play_method,autoplay:"autoplay"===t.block.play_method,scroll:"scroll"===t.block.play_method,scroll_enabled:t.isPlayOnScrollEnabled,hover_disabled:t.isHoverDisabled}},t._l(t.getPlayMethods(),(function(e,s){var o;return i("div",{key:s,staticClass:"play-method",class:(o={active:t.block.play_method===s},o[s]=!0,o),on:{click:function(e){return t.onPlayMethodsChange(s)}}},[t._v("\n          "+t._s(e)+"\n        ")])})),0),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"autoplay"===t.block.play_method,expression:"block.play_method === 'autoplay'"}],staticClass:"param param-autoplay-delay"},[i("div",{staticClass:"caption"},[t._v("Delay")]),t._v(" "),i("numeric-input",{class:{active:t.block.theme_data.autoplay_delay>0},attrs:{autofocus:!1,min:"crossfade"===t.block.transition_type?t.block.theme_data.crossfade:t.block.theme_data.slider_transition,max:60,dir:"v",step:.1,"use-float":!0,speed:5},model:{value:t.block.theme_data.autoplay_delay,callback:function(e){t.$set(t.block.theme_data,"autoplay_delay",e)},expression:"block.theme_data.autoplay_delay"}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"hover"===t.block.play_method,expression:"block.play_method === 'hover'"}],staticClass:"param param-hover-delay"},[i("div",{staticClass:"caption"},[t._v("Delay")]),t._v(" "),i("numeric-input",{class:{active:t.block.theme_data.hover_delay>0},attrs:{autofocus:!1,min:"crossfade"===t.block.transition_type?t.block.theme_data.crossfade:t.block.theme_data.slider_transition,max:60,dir:"v",step:.1,"use-float":!0,speed:5},model:{value:t.block.theme_data.hover_delay,callback:function(e){t.$set(t.block.theme_data,"hover_delay",e)},expression:"block.theme_data.hover_delay"}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"scroll"===t.block.play_method,expression:"block.play_method === 'scroll'"}],staticClass:"param param-start-offset"},[i("div",{staticClass:"caption"},[t._v("Start offset")]),t._v(" "),i("numeric-input",{class:{active:t.block.theme_data.start_offset>0},attrs:{autofocus:!1,min:0,max:3e3,dir:"v",step:1,"use-float":!0,speed:5},model:{value:t.block.theme_data.start_offset,callback:function(e){t.$set(t.block.theme_data,"start_offset",e)},expression:"block.theme_data.start_offset"}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"crossfade"===t.block.transition_type,expression:"block.transition_type === 'crossfade'"}],staticClass:"param param-crossfade",class:{scroll:"scroll"===t.block.play_method}},[i("div",{staticClass:"caption"},[t._v("rossfade")]),t._v(" "),i("numeric-input",{class:{active:t.block.theme_data.crossfade>0},attrs:{autofocus:!1,min:0,max:60,dir:"v",step:.1,"use-float":!0,speed:5},on:{change:t.onTransitionsValueChange},model:{value:t.block.theme_data.crossfade,callback:function(e){t.$set(t.block.theme_data,"crossfade",e)},expression:"block.theme_data.crossfade"}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"slider"===t.block.transition_type,expression:"block.transition_type === 'slider'"}],staticClass:"param param-slider-transition",class:{scroll:"scroll"===t.block.play_method}},[i("div",{staticClass:"caption"},[t._v("Transition")]),t._v(" "),i("numeric-input",{class:{active:t.block.theme_data.slider_transition>0},attrs:{autofocus:!1,min:0,max:"scroll"===t.block.play_method?0:60,dir:"v",step:.1,"use-float":!0,speed:5,readonly:"scroll"===t.block.play_method},on:{change:t.onTransitionsValueChange},model:{value:t.block.theme_data.slider_transition,callback:function(e){t.$set(t.block.theme_data,"slider_transition",e)},expression:"block.theme_data.slider_transition"}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"scroll"===t.block.play_method,expression:"block.play_method === 'scroll'"}],staticClass:"param param-scroll-delay"},[i("div",{staticClass:"caption"},[t._v("Delay")]),t._v(" "),i("numeric-input",{class:{active:t.block.theme_data.scroll_delay>0},attrs:{autofocus:!1,min:0,max:3e3,dir:"v",step:.1,"use-float":!0,speed:5},model:{value:t.block.theme_data.scroll_delay,callback:function(e){t.$set(t.block.theme_data,"scroll_delay",e)},expression:"block.theme_data.scroll_delay"}})],1)])])])}),[],!1,null,null,null).exports,Kt={props:{href:String}},Yt=(i("896M"),{mixins:[tt],components:{InlineHelp:Object(Z.a)(Kt,(function(){var t=this.$createElement;return(this._self._c||t)("a",{staticClass:"info",attrs:{href:this.href,rel:"noreferrer noopener",target:"_blank"}})}),[],!1,null,"4b1e125a",null).exports,VideoSearch:i("vIxw").a,RmSwitcher:at.a,ColorPicker:rt.a},data:function(){return{isLoading:!1,isError:!1,isUploading:!1,isDragging:!1,isDropZoneEnter:!1,isCustomThumbnail:!1,errorText:"",m:{url:null,video_id:null,provider_name:null,thumbnail_url:null,custom_thumbnail:!1,custom_thumbnail_url:null,title:null,start_time:null,autoplay:!1,loop:!1,mute:!1,info:!1,theme:null,color:null}}},beforeDestroy:function(){this.abortAjaxLoading(),this.raw_block.workspace.off("main-dragover",this.highlightDropZone,this)},created:function(){this.isCustomThumbnail=!0===this.m.custom_thumbnail},mounted:function(){Object(c.a)("controls-video_settings"),this.mountUploader()},computed:{logoClass:function(){var t={};return t[this.m.provider_name&&this.m.provider_name.toLowerCase()]=!0,t},hasVideo:function(){return Boolean(this.m.video_id)},providerName:function(){var t=this.m&&this.m.provider_name;return t&&t.toLowerCase()},isYoutube:function(){return"youtube"===this.providerName},isVimeo:function(){return"vimeo"===this.providerName},previewBackground:function(){if(!this.m.custom_thumbnail)return null;var t=this.m.custom_thumbnail_url;return t?"url("+t+")":null},isPrivate:function(){return this.hasVideo&&!this.m.title&&!this.m.thumbnail_url},backgroundColor:function(){return this.m.color||"3ab9ff"},showPreview:function(){return this.isLoading||this.hasVideo},isAutoplay:{get:function(){return this.m.autoplay},set:function(t){this.m.autoplay=t,this.m.mute=t,t&&(this.isCustomThumbnail=!t)}},hasCustomThumbnail:{get:function(){return this.isCustomThumbnail},set:function(t){var e=this;this.isCustomThumbnail=t,this.m.custom_thumbnail=t,t?(setTimeout((function(){e.$dropCaption=Object(o.a)(".video-panel-dropzone-container .caption-upload-dop"),e.$replaceIcon=Object(o.a)(".video-panel-icon-replace"),e.$dropCaption.css("opacity",0)}),0),setTimeout((function(){e.$dropCaption.show()}),150),setTimeout((function(){e.$dropCaption.css("opacity",.9)}),200),setTimeout((function(){e.$replaceIcon.show()}),300)):this.$dropCaption&&(this.$dropCaption.hide(),this.$replaceIcon.hide(),this.$dropCaption.css("opacity",0))}}},methods:{abortAjaxLoading:function(){this.videoEmbedXHR&&this.videoEmbedXHR.abort(),this.isLoading=!1},onLoaded:function(t){var e=this;if(this.isLoading=!1,t.html){t=s.a.pick(t,"url","video_id","provider_name","thumbnail_url","title","start_time"),this.m.start_time&&(t.start_time=t.start_time||null);var i=s.a.extend(t,{autoplay:Boolean(this.m.autoplay),loop:Boolean(this.m.loop),mute:Boolean(this.m.mute),info:Boolean(this.m.info),theme:this.m.theme||"dark",color:this.m.color||"3ab9ff"});s.a.extend(this.m,i),this.isCustomThumbnail=Boolean(this.m.custom_thumbnail&&this.m.custom_thumbnail_url),setTimeout((function(){e.mountUploader()}),0)}else this.onVideoSearchError()},onRemove:function(){s.a.extend(this.m,{video_id:"",provider_name:"",thumbnail_url:"",custom_thumbnail:!1,custom_thumbnail_url:"",title:""})},onDataObtained:function(t){clearTimeout(this.errorRemovalTimeout),this.m.url===t.url?this.abortAjaxLoading():(this.isLoading=!0,this.isError=!1,this.m.provider_name=t.provider_name,this.m.url=t.url)},onVideoSearchError:function(){this.showError("Sorry, but we can't get this video due to its limitations")},showError:function(t){var e=this;this.errorText=t,this.isError=!0,this.isLoading=!1,this.errorRemovalTimeout=setTimeout((function(){e.isError=!1,e.errorText=""}),2e3)},dismissError:function(){this.isError=!1,this.errorText="",clearTimeout(this.errorRemovalTimeout)},mountUploader:function(){this.$refs.uploadInput&&this.$refs.uploadInputDropZone&&!this.uploader&&(this.uploader=new xt.a(this,{fileInput:Object(o.a)(this.$refs.uploadInput),dropZone:Object(o.a)(this.$refs.uploadInputDropZone)}),this.uploader.on("start",this.onStartUpload),this.uploader.on("done",this.onDoneUpload),this.uploader.on("fail",this.onFailUpload),this.uploader.on("dragover",this.highlightDropZoneEnter),this.raw_block.workspace.on("main-dragover",this.highlightDropZone,this))},uploadCustomThumbnail:function(t){t&&Object(o.a)(t.target).hasClass("uploadInput")||(this.isUploading&&Object(o.a)(this.$refs.uploadInput).trigger("click","stop"),Object(o.a)(this.$refs.uploadInput).trigger("click"))},replaceCustomThumbnail:function(){this.isCustomThumbnail&&Object(o.a)(this.$refs.uploadInput).trigger("click")},onStartUpload:function(t,e){this.isUploading=!0},onDoneUpload:function(t,e){if(this.isUploading=!1,!e||!e.result)return this.showError("Sorry, but we couldn't upload a custom thumbnail"),void(this.isCustomThumbnail=!1);var i=e.result.picture&&e.result.picture.url;i?(this.isCustomThumbnail=!0,s.a.extend(this.m,{custom_thumbnail_url:i})):(this.isCustomThumbnail=!1,this.showError("Sorry, but we couldn't upload a custom thumbnail"))},onFailUpload:function(){this.isUploading=!1},cancelUpload:function(){this.isUploading=!1},highlightDropZone:function(t){var e=this;this.isDragging=!0,clearTimeout(this.highlightTimeout),this.highlightTimeout=setTimeout((function(){e.isDragging=!1}),500)},highlightDropZoneEnter:function(t){var e=this;this.isDropZoneEnter=!0,clearTimeout(this.dropZoneTimeout),this.dropZoneTimeout=setTimeout((function(){e.isDropZoneEnter=!1}),500)}}}),Zt=(i("Ib1Q"),Object(Z.a)(Yt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel control-panel video-panel",class:{error:t.isError,loading:t.isLoading,loaded:t.hasVideo,youtube:t.isYoutube,vimeo:t.isVimeo,"custom-thumb":t.isCustomThumbnail}},[i("div",{staticClass:"video-panel-header"},[t._v("Video")]),t._v(" "),i("video-search",{attrs:{"is-video-processed":t.m.video_id,"show-social":!t.isLoading&&!t.hasVideo,"highlight-on-error":!0},on:{dataObtained:t.onDataObtained,loaded:t.onLoaded,error:t.onVideoSearchError,remove:t.onRemove},model:{value:t.m.url,callback:function(e){t.$set(t.m,"url",e)},expression:"m.url"}}),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.showPreview?i("div",{staticClass:"video-panel-preview-logo",class:t.logoClass}):t._e()]),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.hasVideo?i("div",{staticClass:"video-panel-preview-caption"},[t._v(t._s(t.m.title))]):t._e(),t._v(" "),t.isPrivate?i("div",{staticClass:"video-panel-preview-caption video-panel-preview-caption-private"},[t._v("Private video")]):t._e()]),t._v(" "),i("transition",{attrs:{name:"slide"}},[t.showPreview?i("div",{staticClass:"video-panel-preview-wrapper"},[i("div",{staticClass:"video-panel-preview",class:{"custom-thumb":t.isCustomThumbnail,vimeo:t.isVimeo}},[i("transition",{attrs:{name:"fade"}},[i("div",{staticClass:"video-panel-preview-image-container",class:{vimeo:t.isVimeo,dragging:t.isDragging}},[!t.m.custom_thumbnail_url||t.isDragging||t.isUploading?t._e():i("div",{staticClass:"video-panel-preview-image-wrapper"},[i("div",{staticClass:"video-panel-preview-image",style:{backgroundImage:t.previewBackground}})]),t._v(" "),t.isCustomThumbnail&&!t.isDragging?i("div",{staticClass:"video-panel-preview-mask"}):t._e()])]),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.hasVideo?i("div",{staticClass:"video-panel-settings"},[i("div",{staticClass:"video-panel-setting autoplay"},[i("div",{staticClass:"video-panel-setting-caption"},[t._v("Autoplay")]),t._v(" "),i("rm-switcher",{staticClass:"video-panel-switcher",attrs:{state:t.isAutoplay,"color-off":"rgb(125, 125, 125)"},model:{value:t.isAutoplay,callback:function(e){t.isAutoplay=e},expression:"isAutoplay"}})],1),t._v(" "),i("div",{staticClass:"video-panel-setting loop"},[i("div",{staticClass:"video-panel-setting-caption"},[t._v("Loop")]),t._v(" "),i("rm-switcher",{staticClass:"video-panel-switcher",attrs:{state:t.m.loop,"color-off":"rgb(125, 125, 125)"},model:{value:t.m.loop,callback:function(e){t.$set(t.m,"loop",e)},expression:"m.loop"}})],1),t._v(" "),i("div",{staticClass:"video-panel-setting mute"},[i("div",{staticClass:"video-panel-setting-caption"},[t._v("\n                Mute\n                "),i("inline-help",{attrs:{href:"http://help.readymag.com/hc/en-us/articles/360020792871-Video"}})],1),t._v(" "),i("rm-switcher",{staticClass:"video-panel-switcher",attrs:{state:t.m.mute,"is-disabled":t.isAutoplay,"color-off":"rgb(125, 125, 125)"},model:{value:t.m.mute,callback:function(e){t.$set(t.m,"mute",e)},expression:"m.mute"}})],1),t._v(" "),t.isYoutube?t._e():i("div",{staticClass:"video-panel-setting info"},[i("div",{staticClass:"video-panel-setting-caption"},[t._v("Show Info")]),t._v(" "),i("rm-switcher",{staticClass:"video-panel-switcher",attrs:{state:t.m.info,"color-off":"rgb(125, 125, 125)"},model:{value:t.m.info,callback:function(e){t.$set(t.m,"info",e)},expression:"m.info"}})],1),t._v(" "),t.isVimeo?i("div",{staticClass:"video-panel-setting video-panel-setting-color video-panel-setting-color-vimeo"},[i("div",{staticClass:"video-panel-setting-caption"},[t._v("Color")]),t._v(" "),i("div",{staticClass:"video-panel-switcher video-panel-switcher-vimeo"},[i("color-picker",{staticClass:"video-panel-color-picker-vimeo",attrs:{color:t.backgroundColor,"show-alpha":!1},on:{"update:color":function(e){return t.m.color=e}}})],1)]):t._e(),t._v(" "),i("div",{staticClass:"video-panel-setting thumb"},[i("div",{staticClass:"video-panel-setting-caption"},[t._v("Thumbnail")]),t._v(" "),i("rm-switcher",{staticClass:"video-panel-switcher",attrs:{state:t.hasCustomThumbnail,"is-disabled":t.isAutoplay,"color-off":"rgb(125, 125, 125)"},model:{value:t.hasCustomThumbnail,callback:function(e){t.hasCustomThumbnail=e},expression:"hasCustomThumbnail"}})],1)]):t._e()]),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.isLoading?i("div",{staticClass:"video-panel-preview-preloader rmpreloader"},[i("div",{staticClass:"shadow"}),t._v(" "),i("div",{staticClass:"arc"})]):t._e()]),t._v(" "),i("input",{ref:"uploadInput",staticClass:"uploadInput",attrs:{type:"file",name:"upload","data-url":"/api/upload/"}}),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("div",{ref:"uploadInputDropZone"},[t.isCustomThumbnail?i("div",{staticClass:"video-panel-dropzone-container"},[!t.m.custom_thumbnail_url||t.isDragging||t.isUploading?t._e():i("div",{staticClass:"video-panel-icon-replace",on:{click:function(e){return t.replaceCustomThumbnail()}}}),t._v(" "),i("div",{staticClass:"video-panel-thumb-upload-container"},[i("div",{staticClass:"upload"},[i("div",{staticClass:"upload-wrapper"},[i("div",{staticClass:"center-wrapper",on:{click:function(e){return t.uploadCustomThumbnail(e)}}},[t.isUploading?t._e():i("div",{staticClass:"caption-upload-dop caption-upload-dop-light"},[t.m.custom_thumbnail_url?i("span",[t._v(t._s(t.isDragging?"Drop here":""))]):i("span",[t._v(t._s(t.isDragging?"Drop here":"Drop file here"))])])])])])]),t._v(" "),t.isUploading?i("div",{staticClass:"video-panel-thumb-preloader preloader"},[i("div",{staticClass:"rmpreloader"},[i("div",{staticClass:"arc"})])]):t._e()]):t._e()])])],1)]):t._e()]),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.isError?i("div",{staticClass:"video-panel-error",on:{click:t.dismissError}},[i("div",{staticClass:"error-text"},[t._v(t._s(t.errorText))])]):t._e()])],1)}),[],!1,null,null,null).exports),Jt={components:{ColorPicker:rt.a,NumericInput:et.a,FontFamilySelector:ot.a,FontStyleSelector:nt.a},mixins:[tt],data:function(){return{stylingState:"default"}},computed:{maxBorderWidth:function(){return Math.ceil(Math.min(this.m.w,this.m.h)/2)}},watch:{stylingState:function(t){Object(o.a)(".common-button",this.raw_block.$el).toggleClass("hovered","hover"===t),Object(o.a)(".common-button",this.raw_block.$el).toggleClass("current","current"===t)}},destroyed:function(){this.setCorrectIconColor("default"),Object(o.a)(".common-button",this.raw_block.$el).toggleClass("hovered",!1),Object(o.a)(".common-button",this.raw_block.$el).toggleClass("current",!1)},methods:{onChangeStylingState:function(t){t&&t!==this.stylingState&&(this.stylingState=t),this.closeOthersPopups(null),this.setCorrectIconColor(t)},changePropHandler:function(t,e){this.m[t]=e},setCorrectIconColor:function(t){this.raw_block.onIconColorChange(this.m,null,{},t)}}},Qt=(i("6ouf"),Object(Z.a)(Jt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel cart-settings-panel",class:{"default-tab":"default"===t.stylingState,"hover-tab":"hover"===t.stylingState}},[t._m(0),t._v(" "),i("div",{staticClass:"styling-state-switcher"},[i("span",{class:{btn:!0,active:"default"===t.stylingState},on:{click:function(e){return t.onChangeStylingState("default")}}},[t._v("Default")]),t._v(" "),i("span",{class:{btn:!0,active:"hover"===t.stylingState},on:{click:function(e){return t.onChangeStylingState("hover")}}},[t._v("Hover")])]),t._v(" "),i("div",{staticClass:"separator-filled"}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"default"===t.stylingState,expression:"stylingState === 'default'"}],staticClass:"settings-panel"},[i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Shape color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["background-color"],alpha:t.m["background-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("background-color",e)},"update:alpha":function(e){return t.changePropHandler("background-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Radius")]),t._v(" "),i("numeric-input",{staticClass:"num-input",class:{"one-digit":t.m["border-radius"]<10,"two-digit":t.m["border-radius"]<100&&t.m["border-radius"]>9,"three-digit":t.m["border-radius"]>99},attrs:{autosize:!0,value:t.m["border-radius"],min:0,max:999},on:{change:function(e){return t.changePropHandler("border-radius",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border")]),t._v(" "),i("numeric-input",{staticClass:"num-input",class:{"one-digit":t.m["border-width"]<10,"two-digit":t.m["border-width"]<100&&t.m["border-width"]>9,"three-digit":t.m["border-width"]>99},attrs:{autosize:!0,value:t.m["border-width"],min:0,max:t.maxBorderWidth},on:{change:function(e){return t.changePropHandler("border-width",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["border-color"],alpha:t.m["border-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("border-color",e)},"update:alpha":function(e){return t.changePropHandler("border-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("font-family-selector",{attrs:{family:t.m["font-family"]},on:{showPopup:t.closeOthersPopups,change:function(e){return t.changePropHandler("font-family",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("font-style-selector",{style:{"font-family":t.m["font-family"]},attrs:{"font-style":[t.m["font-style"]],"font-weight":[t.m["font-weight"]],"font-family":[t.m["font-family"]]},on:{showPopup:t.closeOthersPopups,"update:fontStyle":function(e){return t.changePropHandler("font-style",e)},"update:fontWeight":function(e){return t.changePropHandler("font-weight",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Size")]),t._v(" "),i("numeric-input",{staticClass:"num-input",attrs:{autosize:!0,value:t.m["font-size"],min:8,max:999},on:{change:function(e){return t.changePropHandler("font-size",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Letter spacing")]),t._v(" "),i("numeric-input",{staticClass:"num-input",attrs:{autosize:!0,value:t.m["letter-spacing"],min:-99,max:999,step:.1,"use-float":!0},on:{change:function(e){return t.changePropHandler("letter-spacing",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Text color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m.color,alpha:t.m["color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("color",e)},"update:alpha":function(e){return t.changePropHandler("color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Icon color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m.icon_color,alpha:t.m.icon_color_opacity},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("icon_color",e)},"update:alpha":function(e){return t.changePropHandler("icon_color_opacity",e)}}})],1)]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"hover"===t.stylingState,expression:"stylingState === 'hover'"}],staticClass:"settings-panel"},[i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Shape color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["hover-background-color"],alpha:t.m["hover-background-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("hover-background-color",e)},"update:alpha":function(e){return t.changePropHandler("hover-background-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Radius")]),t._v(" "),i("numeric-input",{staticClass:"num-input",class:{"one-digit":t.m["hover-border-radius"]<10,"two-digit":t.m["hover-border-radius"]<100&&t.m["hover-border-radius"]>9,"three-digit":t.m["hover-border-radius"]>99},attrs:{autosize:!0,value:t.m["hover-border-radius"],min:0,max:999},on:{change:function(e){return t.changePropHandler("hover-border-radius",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border")]),t._v(" "),i("numeric-input",{staticClass:"num-input",class:{"one-digit":t.m["hover-border-width"]<10,"two-digit":t.m["hover-border-width"]<100&&t.m["hover-border-width"]>9,"three-digit":t.m["hover-border-width"]>99},attrs:{autosize:!0,value:t.m["hover-border-width"],min:0,max:t.maxBorderWidth},on:{change:function(e){return t.changePropHandler("hover-border-width",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["hover-border-color"],alpha:t.m["hover-border-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("hover-border-color",e)},"update:alpha":function(e){return t.changePropHandler("hover-border-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Text color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["hover-color"],alpha:t.m["hover-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("hover-color",e)},"update:alpha":function(e){return t.changePropHandler("hover-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Icon color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["hover-icon_color"],alpha:t.m["hover-icon_color_opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("hover-icon_color",e)},"update:alpha":function(e){return t.changePropHandler("hover-icon_color_opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Transition")]),t._v(" "),i("numeric-input",{staticClass:"num-input",class:{"one-digit":t.m["hover-border-radius"]<10,"two-digit":t.m["hover-border-radius"]<100&&t.m["hover-border-radius"]>9,"three-digit":t.m["hover-border-radius"]>99},attrs:{autosize:!0,value:t.m["hover-tansition-duration"],min:0,max:2,step:.1,"use-float":!0},on:{change:function(e){return t.changePropHandler("hover-tansition-duration",e)}}})],1)])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title-row"},[e("div",{staticClass:"title"},[this._v("Cart button")])])}],!1,null,null,null).exports),te={components:{RmSelect:ut},mixins:[tt],data:function(){return{productsOptions:this.getProductsOptions()}},computed:{thereAreProducts:function(){return this.productsOptions&&this.productsOptions.length>1},isCurrentProductInactive:function(){return this.getCurrentProductActiveStatus()}},methods:{getProductsOptions:function(t){var e=t||this.raw_block.model.get("selected_product_id");return this.raw_block.workspace.eCommerceManager.getProductsLikeOptionsList(e)},getCurrentProductActiveStatus:function(t){var e=t||this.raw_block.model.get("selected_product_id");return!this.raw_block.workspace.eCommerceManager.isProductActive(e)},onProductSelect:function(t){this.isCurrentProductInactive&&(this.productsOptions=this.getProductsOptions(t.value))}}},ee=(i("ln7P"),Object(Z.a)(te,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:{panel:!0,"select-product-panel":!0,"no-products-wrap":!t.thereAreProducts}},[t.thereAreProducts?t._e():i("div",{staticClass:"no-products-alert"},[t._v("You have no active products to choose")]),t._v(" "),t.thereAreProducts?i("rm-select",{staticClass:"select-wrap",attrs:{options:t.productsOptions,"arrow-size":"big",callback:t.onProductSelect},scopedSlots:t._u([{key:"listitem",fn:function(e){return[i("span",{class:{"inactive-product":e.option.value===e.value&&t.getCurrentProductActiveStatus()},attrs:{title:e.option.value===e.value&&t.getCurrentProductActiveStatus()?"inactive product":""}},[t._v(t._s(e.option.caption))]),t._v(" "),i("div",{staticClass:"point"})]}}],null,!1,1835512949),model:{value:t.m.selected_product_id,callback:function(e){t.$set(t.m,"selected_product_id",e)},expression:"m.selected_product_id"}}):t._e()],1)}),[],!1,null,"2468a5ee",null).exports),ie=i("VxDd"),se=i.n(ie),oe=i("5bt+"),ne=i.n(oe),ae=i("Cmem"),re=i.n(ae),le=i("VsGE"),ce=i.n(le),he={components:{ColorPicker:rt.a,NumericInput:et.a,FontFamilySelector:ot.a,FontStyleSelector:nt.a},mixins:[tt],data:function(){return{stylingState:"default",haveProductAttributes:this.raw_block.haveProductAttributes(),layoutHorizontalImg:se.a,layoutVerticalImg:ne.a,colorDisabledImg:re.a,numberDisabledImg:ce.a}},computed:{maxBtnBorderWidth:function(){return Math.ceil(Math.min(this.m.btn_w,this.m.btn_h)/2)},selectionState:function(){return this.raw_block.selectionState}},watch:{stylingState:function(t){this.raw_block.$el.toggleClass("hovered","hover"===t)}},destroyed:function(){this.onChangeStylingState("default")},methods:{onChangeLayout:function(t){var e=t.currentTarget.dataset.layoutType;e&&this.m.layout&&this.m.layout!==e&&(this.m.layout=e)},onChangeStylingState:function(t){t&&t!==this.stylingState&&(this.stylingState=t,this.raw_block.changeStylingState(this.stylingState))},changeSinglePropHandler:function(t,e){this.m[t]=e},changeSelectIconProp:function(t,e){var i={"attrs-icon-w":e,"attrs-icon-h":this.m["attrs-icon-h"]+(e-this.m["attrs-icon-w"])};this.m=Object.assign(this.m,i)},changeIconPropHandler:function(t,e){var i={};i[t]=e,this.m[t]===this.m["hover-"+t]&&(i["hover-"+t]=e),this.m=Object.assign(this.m,i)},changeHoverPropHandler:function(t,e){var i={};"both"===this.selectionState&&(i[t]=e,i["attrs-"+t]=e),"button"===this.selectionState&&(i[t]=e),"selects"===this.selectionState&&(i["attrs-"+t]=e),this.m=Object.assign(this.m,i)},changePropHandler:function(t,e){var i={};"both"===this.selectionState&&(i[t]=e,i["attrs-"+t]=e,this.m[t]===this.m["hover-"+t]&&this.m["attrs-"+t]===this.m["attrs-hover-"+t]&&(i["hover-"+t]=e,i["attrs-hover-"+t]=e)),"button"===this.selectionState&&(i[t]=e,this.m[t]===this.m["hover-"+t]&&(i["hover-"+t]=e)),"selects"===this.selectionState&&(i["attrs-"+t]=e,this.m["attrs-"+t]===this.m["attrs-hover-"+t]&&(i["attrs-hover-"+t]=e)),this.m=Object.assign(this.m,i)},getFontFamilyValue:function(t){return"both"===this.selectionState?this.m[t]===this.m["attrs-"+t]?this.m[t]:[this.m[t],this.m["attrs-"+t]]:"button"===this.selectionState?this.m[t]:"selects"===this.selectionState?this.m["attrs-"+t]:void 0},getFontParam:function(t){return"both"===this.selectionState?"font-style"===t?this.m[t]===this.m["attrs-"+t]&&this.m["font-weight"]===this.m["attrs-font-weight"]?[this.m[t]]:[this.m[t],this.m["attrs-"+t]]:"font-weight"===t?this.m[t]===this.m["attrs-"+t]&&this.m["font-style"]===this.m["attrs-font-style"]?[this.m[t]]:[this.m[t],this.m["attrs-"+t]]:this.m[t]===this.m["attrs-"+t]?[this.m[t]]:[this.m[t],this.m["attrs-"+t]]:"button"===this.selectionState?[this.m[t]]:"selects"===this.selectionState?[this.m["attrs-"+t]]:void 0},getColorValue:function(t){return"both"===this.selectionState?this.m[t]===this.m["attrs-"+t]?this.m[t]:"000000":"button"===this.selectionState?this.m[t]:"selects"===this.selectionState?this.m["attrs-"+t]:void 0},getNumValue:function(t){return"both"===this.selectionState?this.m[t]===this.m["attrs-"+t]?this.m[t]:Math.min(this.m[t],this.m["attrs-"+t]):"button"===this.selectionState?this.m[t]:"selects"===this.selectionState?this.m["attrs-"+t]:void 0},isDisabledValue:function(t){return"both"===this.selectionState&&this.m[t]!==this.m["attrs-"+t]}}},de=(i("+/R+"),Object(Z.a)(he,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel addtocart-settings-panel",class:{"panel-default":"default"===t.stylingState,"panel-hover":"hover"===t.stylingState,"panel-both":"both"===t.selectionState,"panel-selects":"selects"===t.selectionState,"panel-button":"button"===t.selectionState}},[i("div",{staticClass:"title-row"},["both"===t.selectionState&&t.haveProductAttributes?i("div",{staticClass:"both-header header"},[i("div",{staticClass:"title"},[t._v("Layout")]),t._v(" "),i("div",{directives:[{name:"svginject",rawName:"v-svginject"}],staticClass:"layout-controls"},[i("div",{class:{"layout-btn":!0,"horizontal-layout":!0,active:"horizontal"===t.m.layout},attrs:{"data-layout-type":"horizontal"},on:{click:t.onChangeLayout}},[i("img",{staticClass:"svg layout-icon",attrs:{title:"horizontal layout",src:t.layoutHorizontalImg}})]),t._v(" "),i("div",{class:{"layout-btn":!0,"vertical-layout":!0,active:"vertical"===t.m.layout},attrs:{"data-layout-type":"vertical"},on:{click:t.onChangeLayout}},[i("img",{staticClass:"svg layout-icon",attrs:{title:"vertical layout",src:t.layoutVerticalImg}})])])]):t._e(),t._v(" "),"button"===t.selectionState||"both"===t.selectionState&&!t.haveProductAttributes?i("div",{staticClass:"button-header header"},[t._v("\n      Button\n    ")]):t._e(),t._v(" "),"selects"===t.selectionState?i("div",{staticClass:"selects-header header"},[t._v("Dropdown")]):t._e()]),t._v(" "),i("div",{staticClass:"styling-state-switcher"},[i("span",{class:{btn:!0,active:"default"===t.stylingState},on:{click:function(e){return t.onChangeStylingState("default")}}},[t._v("Default")]),t._v(" "),i("span",{class:{btn:!0,active:"hover"===t.stylingState},on:{click:function(e){return t.onChangeStylingState("hover")}}},[t._v("Hover")])]),t._v(" "),i("div",{staticClass:"separator-filled"}),t._v(" "),"default"===t.stylingState?i("div",{staticClass:"settings-panel"},[i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Shape color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.getColorValue("background-color"),alpha:t.getColorValue("background-color-opacity"),"custom-icon":t.isDisabledValue("background-color")||t.isDisabledValue("background-color-opacity")?t.colorDisabledImg:null},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("background-color",e)},"update:alpha":function(e){return t.changePropHandler("background-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Radius")]),t._v(" "),i("div",{staticClass:"num-input-wrap"},[i("img",{class:{"disabled-numeric":!0,"show-disabled-icon":t.isDisabledValue("border-radius")},attrs:{src:t.numberDisabledImg}}),t._v(" "),i("numeric-input",{class:{"num-input":!0,"hidden-num-input":t.isDisabledValue("border-radius")},attrs:{autosize:!0,value:t.getNumValue("border-radius"),min:0,max:999},on:{change:function(e){return t.changePropHandler("border-radius",e)}}})],1)]),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border")]),t._v(" "),i("div",{staticClass:"num-input-wrap"},[i("img",{class:{"disabled-numeric":!0,"show-disabled-icon":t.isDisabledValue("border-width")},attrs:{src:t.numberDisabledImg}}),t._v(" "),i("numeric-input",{class:{"num-input":!0,"hidden-num-input":t.isDisabledValue("border-width")},attrs:{autosize:!0,value:t.getNumValue("border-width"),min:0,max:t.maxBtnBorderWidth},on:{change:function(e){return t.changePropHandler("border-width",e)}}})],1)]),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.getColorValue("border-color"),alpha:t.getColorValue("border-color-opacity"),"custom-icon":t.isDisabledValue("border-color")||t.isDisabledValue("border-color-opacity")?t.colorDisabledImg:null},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("border-color",e)},"update:alpha":function(e){return t.changePropHandler("border-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("font-family-selector",{attrs:{family:t.getFontFamilyValue("font-family")},on:{showPopup:t.closeOthersPopups,change:function(e){return t.changePropHandler("font-family",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("font-style-selector",{style:{"font-family":1===t.getFontParam("font-family").length?t.getFontParam("font-family")[0]:"inherit"},attrs:{"font-style":t.getFontParam("font-style"),"font-weight":t.getFontParam("font-weight"),"font-family":t.getFontParam("font-family")},on:{showPopup:t.closeOthersPopups,"update:fontStyle":function(e){return t.changePropHandler("font-style",e)},"update:fontWeight":function(e){return t.changePropHandler("font-weight",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Size")]),t._v(" "),i("div",{staticClass:"num-input-wrap"},[i("img",{class:{"disabled-numeric":!0,"show-disabled-icon":t.isDisabledValue("font-size")},attrs:{src:t.numberDisabledImg}}),t._v(" "),i("numeric-input",{class:{"num-input":!0,"hidden-num-input":t.isDisabledValue("font-size")},attrs:{autosize:!0,value:t.getNumValue("font-size"),min:8,max:999},on:{change:function(e){return t.changePropHandler("font-size",e)}}})],1)]),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Letter spacing")]),t._v(" "),i("div",{staticClass:"num-input-wrap"},[i("img",{class:{"disabled-numeric":!0,"show-disabled-icon":t.isDisabledValue("letter-spacing")},attrs:{src:t.numberDisabledImg}}),t._v(" "),i("numeric-input",{class:{"num-input":!0,"hidden-num-input":t.isDisabledValue("letter-spacing")},attrs:{autosize:!0,value:t.getNumValue("letter-spacing"),min:-99,max:999,step:.1,"use-float":!0},on:{change:function(e){return t.changePropHandler("letter-spacing",e)}}})],1)]),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Text color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.getColorValue("color"),alpha:t.getColorValue("color-opacity"),"custom-icon":t.isDisabledValue("color")||t.isDisabledValue("color-opacity")?t.colorDisabledImg:null},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("color",e)},"update:alpha":function(e){return t.changePropHandler("color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),"selects"!==t.selectionState?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Icon color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m.icon_color,alpha:t.m.icon_color_opacity},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changeIconPropHandler("icon_color",e)},"update:alpha":function(e){return t.changeIconPropHandler("icon_color_opacity",e)}}})],1):t._e(),t._v(" "),"selects"===t.selectionState?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Icon size")]),t._v(" "),i("numeric-input",{staticClass:"num-input",attrs:{autosize:!0,value:t.m["attrs-icon-w"],min:5,max:100},on:{change:function(e){return t.changeSelectIconProp("attrs-icon-w",e)}}})],1):t._e()]):t._e(),t._v(" "),"hover"===t.stylingState?i("div",{staticClass:"settings-panel"},[i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Shape color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.getColorValue("hover-background-color"),alpha:t.getColorValue("hover-background-color-opacity"),"custom-icon":t.isDisabledValue("hover-background-color")||t.isDisabledValue("hover-background-color-opacity")?t.colorDisabledImg:null},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changeHoverPropHandler("hover-background-color",e)},"update:alpha":function(e){return t.changeHoverPropHandler("hover-background-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Radius")]),t._v(" "),i("div",{staticClass:"num-input-wrap"},[i("img",{class:{"disabled-numeric":!0,"show-disabled-icon":t.isDisabledValue("hover-border-radius")},attrs:{src:t.numberDisabledImg}}),t._v(" "),i("numeric-input",{class:{"num-input":!0,"hidden-num-input":t.isDisabledValue("hover-border-radius")},attrs:{autosize:!0,value:t.getNumValue("hover-border-radius"),min:0,max:999},on:{change:function(e){return t.changeHoverPropHandler("hover-border-radius",e)}}})],1)]),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border")]),t._v(" "),i("div",{staticClass:"num-input-wrap"},[i("img",{class:{"disabled-numeric":!0,"show-disabled-icon":t.isDisabledValue("hover-border-width")},attrs:{src:t.numberDisabledImg}}),t._v(" "),i("numeric-input",{class:{"num-input":!0,"hidden-num-input":t.isDisabledValue("hover-border-width")},attrs:{autosize:!0,value:t.getNumValue("hover-border-width"),min:0,max:t.maxBtnBorderWidth},on:{change:function(e){return t.changeHoverPropHandler("hover-border-width",e)}}})],1)]),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.getColorValue("hover-border-color"),alpha:t.getColorValue("hover-border-color-opacity"),"custom-icon":t.isDisabledValue("hover-border-color")||t.isDisabledValue("hover-border-color-opacity")?t.colorDisabledImg:null},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changeHoverPropHandler("hover-border-color",e)},"update:alpha":function(e){return t.changeHoverPropHandler("hover-border-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Text color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.getColorValue("hover-color"),alpha:t.getColorValue("hover-color-opacity"),"custom-icon":t.isDisabledValue("hover-color")||t.isDisabledValue("hover-color-opacity")?t.colorDisabledImg:null},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changeHoverPropHandler("hover-color",e)},"update:alpha":function(e){return t.changeHoverPropHandler("hover-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Icon color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["hover-icon_color"],alpha:t.m["hover-icon_color_opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changeSinglePropHandler("hover-icon_color",e)},"update:alpha":function(e){return t.changeSinglePropHandler("hover-icon_color_opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Transition")]),t._v(" "),i("numeric-input",{staticClass:"num-input",attrs:{autosize:!0,value:t.m["hover-tansition-duration"],min:0,max:2,step:.1,"use-float":!0},on:{change:function(e){return t.changeSinglePropHandler("hover-tansition-duration",e)}}})],1)]):t._e()])}),[],!1,null,null,null).exports),pe={components:{RmSwitcher:at.a},mixins:[tt],data:function(){return{connectedToStripe:this.raw_block.workspace.eCommerceManager.isMagConnectedToStripe(),loading:!1}},computed:{switcherPosition:{get:function(){return this.loading?void 0:this.connectedToStripe},set:function(t){this.connectedToStripe=t}}},methods:{switcherChange:function(t){var e=this;this.loading||(this.loading=!0,t?this.raw_block.workspace.eCommerceManager.connectToStripe().then((function(){e.switcherPosition=!0,e.checkControlsRestrictions(),e.raw_block.workspace.eCommerceManager.getProducts(),e.loading=!1,RM.analytics&&RM.analytics.sendEvent("Stripe","enabled")})).catch((function(t){e.switcherPosition=!1,e.loading=!1,e.checkControlsRestrictions()})):this.raw_block.workspace.eCommerceManager.disconnectFromStripe().then((function(t){e.switcherPosition=!1,e.checkControlsRestrictions(),e.loading=!1,RM.analytics&&RM.analytics.sendEvent("Stripe","disabled")})).catch((function(t){e.switcherPosition=!0,e.loading=!1,e.checkControlsRestrictions()})))},checkControlsRestrictions:function(){this.raw_block.workspace.controls.setControls(this.raw_block.controls,this.raw_block)}}},ue=(i("EvVy"),Object(Z.a)(pe,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"panel connect-panel"},[e("div",{staticClass:"title"},[this._v(this._s(this.connectedToStripe?"Connected":"Connect")+" to Stripe")]),this._v(" "),e("div",{staticClass:"connect-to-stripe"},[e("rm-switcher",{attrs:{value:this.switcherPosition,width:40,height:24,"color-on":"#0080FF","color-off":"#B8B8B8",callback:this.switcherChange}})],1),this._v(" "),e("a",{ref:"question-enabled",staticClass:"question-icon",attrs:{href:"https://help.readymag.com/hc/en-us/articles/360035903372",rel:"noreferrer noopener",target:"_blank","data-alt-style":"controls-ecommerce-connection-icon-tooltip"}},[this._v("?")])])}),[],!1,null,null,null).exports),ge={mixins:[tt],data:function(){return{m:{alt:""}}}},me=(i("UyQn"),Object(Z.a)(ge,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel picture-alt"},[i("div",{staticClass:"param-caption"},[i("span",[t._v("Semantics")]),t._v(" "),i("a",{staticClass:"question-icon",attrs:{href:"https://help.readymag.com/hc/en-us/articles/360019989052-Picture",rel:"noreferrer noopener",target:"_blank","data-alt-style":"controls-picture-alt-tooltip"}},[i("svg",{attrs:{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg"}},[i("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[i("circle",{attrs:{cx:"12",cy:"12",r:"12"}}),t._v(" "),i("path",{attrs:{d:"M8 9.259C8.06 7.371 9.294 6 11.542 6 13.615 6 15 7.259 15 9.02c0 1.219-.575 2.072-1.604 2.717-.992.614-1.272 1.02-1.272 1.809V14H10.37l-.008-.542c-.068-1.195.37-1.912 1.415-2.558.939-.597 1.256-1.02 1.256-1.808 0-.83-.635-1.427-1.589-1.427-.976 0-1.604.622-1.665 1.594H8zM11.5 18c-.904 0-1.5-.592-1.5-1.495 0-.913.596-1.505 1.5-1.505.922 0 1.5.592 1.5 1.505 0 .903-.578 1.495-1.5 1.495z"}})])])])]),t._v(" "),i("div",{staticClass:"param",attrs:{"data-param":"alt_text"}},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.m.alt,expression:"m.alt"}],attrs:{placeholder:"Descriptive alt text",maxlength:"100"},domProps:{value:t.m.alt},on:{input:function(e){e.target.composing||t.$set(t.m,"alt",e.target.value)}}})])])}),[],!1,null,"60cc4a0c",null).exports),fe={mixins:[tt],components:{RmSelect:ut},data:function(){return{m:{activeLink:""}}}},ve=(i("Y+fa"),{components:{ControlIcon:J,PanelAddtocartSettings:de,PanelRotation:st,PanelButtonSettings:ct,PanelTwitterSettings:vt,PanelFacebookSettings:wt,PanelGmapsSettings:kt,PanelPictureSettings:Ot,PanelPictureAlt:me,PanelAudioSettings:It,PanelShapeSettings:Ut,PanelSlideshowSettings:Gt,PanelSlideshowTransitions:Xt,PanelVideo:Zt,PanelCartConnections:ue,PanelCartSettings:Qt,PanelProductSelector:ee,PanelRmheaderSettings:Object(Z.a)(fe,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel rmheader_settings"},[t._m(0),t._v(" "),i("rm-select",{attrs:{options:[{value:"none",caption:"None"},{value:"features",caption:"Features"},{value:"pricing",caption:"Pricing"},{value:"examples",caption:"Examples"},{value:"learn",caption:"Learn"}]},model:{value:t.m.activeLink,callback:function(e){t.$set(t.m,"activeLink",e)},expression:"m.activeLink"}})],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"param-caption"},[e("span",[this._v("RM Header")])])}],!1,null,null,null).exports},computed:{cssClasses:function(){var t={fade:this.faded&&!this.selected||this.disabled,checked:this.selected,loading:this.loading};if(this.raw_block.controlsClasses&&"function"==typeof this.raw_block.controlsClasses){var e=this.raw_block.controlsClasses(this.panelComponent);e&&(t[e]=!0)}return t[this.cssClass]=!0,t},svgIcon:function(){return this.raw_block.controlsSvgIcons&&this.raw_block.controlsSvgIcons[this.panelComponent]?this.raw_block.controlsSvgIcons[this.panelComponent]:null},iconClass:function(){if(this.raw_block.controlsIconClasses&&"function"==typeof this.raw_block.controlsIconClasses){var t=this.raw_block.controlsIconClasses();return t&&t[this.panelComponent]?"function"==typeof t[this.panelComponent]?t[this.panelComponent]():t[this.panelComponent]:null}return null}},methods:{onIconClick:function(){this.selected||this.disabled?this.selected&&this.deselect():this.select()},deselect:function(){this.$emit("deselect")},select:function(){this.$emit("select")},canClosePanel:function(){if(!this.selected)return!0;var t=null;return s.a.each(this.$children,(function(e){e.canClose&&null===t&&(t=e.canClose())})),null===t||t},closePopups:function(){this.$refs.panel.closeOthersPopups()},onPanelResize:function(){this.$emit("panel-resize",this.$refs.panel.$el)}}}),be=(i("Tjx0"),Object(Z.a)(ve,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("transition",{attrs:{name:"control",appear:t.appearanceAnimation},on:{"after-leave":t.afterLeave}},[t.visible?i("div",{staticClass:"control",class:t.cssClasses,style:{top:t.y+"px"}},[i("control-icon",{attrs:{selected:t.selected,alt:t.alt,"svg-icon":t.svgIcon,"icon-class":t.iconClass},nativeOn:{click:function(e){return t.onIconClick(e)}}}),t._v(" "),i("transition",{attrs:{name:"panel"}},[t.selected?i(t.panelComponent,{ref:"panel",tag:"component",attrs:{block:t.block,raw_block:t.raw_block},on:{resize:t.onPanelResize},nativeOn:{click:function(e){return t.closePopups(e)}}}):t._e()],1)],1):t._e()])}),[],!1,null,null,null).exports),_e=h.extend({name:null,panelComponent:null,$el:null,alt:null,saveOnDeselect:!0,saveOnDestroy:!0,waitForRender:function(t,e){return this.isRendered()?t.apply(this,e):V.a.nextTick(function(){return t.apply(this,e)}.bind(this))},initialize:function(t){t=t||{},h.prototype.initialize.apply(this,arguments),this.block=this.blocks[0],this.model=t.models&&t.models.length&&t.models[0],this.y=t.y||t.fromY,this.bindShortcuts()},getData:function(){return{cssClass:this.name,panelComponent:this.panelComponent,faded:!1,selected:!1,disabled:!1,y:this.y,visible:!1,alt:this.alt,block:JSON.parse(JSON.stringify(this.model.attributes)),raw_block:this.blocks[0],loading:!1,appearanceAnimation:this.appearanceAnimation}},onModelChange:function(){this.waitForRender(this._onModelChange.bind(this),arguments)},_onModelChange:function(t){this.vue.block=s.a.extend({},this.vue.block,s.a.pick(s.a.cloneWithObjects(t.attributes),(function(t){return void 0!==t})))},onPanelChange:function(t){this.model.set(s.a.cloneWithObjects(t))},render:function(){if(!this.isRendered()){var t=this,e=function(e){var i=e.$emit;e.$emit=function(){t.trigger.apply(t,arguments),i.apply(e,arguments)}};this.vue=new V.a({mixins:[be],data:this.getData(),mounted:function(){e.called||(e(this),e.called=!0)},updated:function(){e.called||(e(this),e.called=!0)},methods:{afterLeave:function(){this.$el.remove(),this.$destroy()}}}),this.vue.$on("panel-resize",this.onPanelResize),this.vue.visible=!0,this.$container.append('<div id="'+this.name+'">'),this.vue.$mount("#"+this.name),this.$el=Object(o.a)(this.vue.$el),this.on("select",function(){this.master.select(this)}.bind(this)),this.on("deselect",function(){this.master.deselect()}.bind(this)),this.on("change",this.onPanelChange.bind(this)),this.listenTo(this.model,"change",this.onModelChange.bind(this)),this.setControlsStatusByBlockData(),this.block.on("disabledControls:changed",this.onDisabledControlsChanged.bind(this)),this.bindLogic()}},bindShortcuts:function(){this.shortcutHandler=this.master.select.bind(this.master,this),this.keyboardShortcut&&RM.constructorRouter.bindGlobalKeyPress([{key:this.keyboardShortcut,handler:this.shortcutHandler}]),this.onWindowKeyUpBound=this.onWindowKeyUp.bind(this),Object(o.a)(window).on("keyup",this.onWindowKeyUpBound)},unbindShortcuts:function(){this.keyboardShortcut&&RM.constructorRouter.unbindGlobalKeyPress(this.keyboardShortcut,this.shortcutHandler),Object(o.a)(window).off("keyup",this.onWindowKeyUpBound)},isRendered:function(){return Boolean(this.vue)},onPanelResize:function(t){this.$panel=Object(o.a)(t),this.updatePanelVerticalPosition()},select:function(){this.waitForRender(this._select.bind(this),arguments)},_select:function(){this.makeModelSnapshot(),Object(c.a)("controls"),s.a.extend(this.vue,{selected:!0,faded:!1}),this.selected=!0},deselect:function(){this.waitForRender(this._deselect.bind(this),arguments)},_deselect:function(){if(this.vue){var t=this.vue.selected;s.a.extend(this.vue,{selected:!1,faded:!1}),this.selected=!1,this.clearModelSnapshot(t)}},fade:function(){this.waitForRender(this._fade.bind(this),arguments)},_fade:function(){this.deselect(),s.a.extend(this.vue,{faded:!0})},setEnabled:function(){this.waitForRender(this._setEnabled.bind(this),arguments)},_setEnabled:function(){this.vue.disabled=!1},setDisabled:function(){this.waitForRender(this._setDisabled.bind(this),arguments)},_setDisabled:function(){s.a.extend(this.vue,{selected:!1,disabled:!0})},canControlBeClosed:function(){this.waitForRender(this._canControlBeClosed.bind(this),arguments)},_canControlBeClosed:function(){return!(!this.vue||!this.vue.selected)&&(this.vue.canClosePanel()&&this.master.deselect(),!0)},moveToNewPos:function(){this.waitForRender(this._moveToNewPos.bind(this),arguments)},_moveToNewPos:function(t){this.vue?this.vue.y=t:this.y=t},onEscKey:function(){this.waitForRender(this._onEscKey.bind(this),arguments)},_onEscKey:function(){this.vue.selected&&this.master.deselect()},save:function(){this.model.save({})},destroy:function(t){this.vue&&(this.vue.visible=!1,t||(this.vue.$el.remove(),this.vue.$destroy()),this.block.off("disabledControls:changed",this.onDisabledControlsChanged),this.unBindLogic(),this.unbindShortcuts(),this.stopListening(this.model,"change"),this.clearModelSnapshot(this.vue.selected))}}),we=_e.extend({name:"common_rotation",alt:"Rotation",panelComponent:"panel-rotation",keyboardShortcut:"r",onPanelChange:function(t){_e.prototype.onPanelChange.apply(this,arguments),(this.model.changed.hasOwnProperty("flip_v")||this.model.changed.hasOwnProperty("flip_h"))&&this.model.save({})},select:function(){_e.prototype.select.apply(this,arguments),this.block.frame.setRotationState()},deselect:function(){this.block.frame.removeRotationState(),_e.prototype.deselect.apply(this,arguments)},restrictions:function(t){var e=t.getSelectedBlocks();return e.length&&!e[0].isFullWidth()&&!e[0].isFullHeight()}}),ye=i("v92f"),ke=i("rVpV"),Ce=i("L3tv"),xe=i.n(Ce),Se=h.extend({saveOnDeselect:!0,saveOnDestroy:!0,name:"common_position",className:"control common_position",events:{"click li":"toggleFixed","click .position-wrapper .sticked-left":"toggleSticked","click .position-wrapper .sticked-right":"toggleSticked","click .position-wrapper .sticked-top":"toggleSticked","click .position-wrapper .sticked-bottom":"toggleSticked","click .position-wrapper .full-width:not(.margin-input):not(.full-screen-video)":"toggleFullWidth","click .position-wrapper .full-height:not(.margin-input):not(.full-screen-video)":"toggleFullHeight","click .position-wrapper .full-screen-video.full-height":"toggleFullScreen","click .position-wrapper .full-screen-video.full-width":"toggleFullScreen","mouseover .position-wrapper .margin-input":"addHoveredClass","mouseleave .position-wrapper .margin-input":"removeHoveredClass","mouseover .position-wrapper .togglers-wrapper .full-height.active":"addFullWidthClass","mouseleave .position-wrapper .togglers-wrapper .full-height":"removeFullWidthClass","focus .position-wrapper .margin-input":"addHoveredClass","focusout .position-wrapper .margin-input":"removeHoveredClass"},POS_LIST:["nw","n","ne","w","c","e","sw","s","se"],ALLOW_FULL_WIDTH:["shape","picture","video","iframe","rmfooter","rmheader"],ALLOW_FULL_HEIGHT:["shape","picture","video","iframe"],initialize:function(t){this.template=xe.a["template-constructor-control-common_position"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model},restrictions:function(t){var e={},i=t.getSelectedBlocks();return s.a.reduce(i,(function(o,n){if(!o)return o;if(n.model.get("pack_id")){var a=n.model.get("pack_id");return e[a]?o:(e[a]=s.a.filter(t.blocks,(function(t){return t.model.get("pack_id")===a})),o&&s.a.filter(i,(function(t){return t.model.get("pack_id")===a})).length===e[a].length)}return o}),!0)},bindLogic:function(){var t=Object(s.a)(["fixed_position","is_full_width","full_width_margin","is_full_height","full_height_margin","sticked","sticked_margin","is_global","is_above"]).map((function(t){return"change:"+t})).join(" ");this.listenTo(this.model,t,function(){s.a.defer(this.updatePanel)}.bind(this))},unBindLogic:function(){this.stopListening(this.model)},select:function(){this.updatePanel(),h.prototype.select.apply(this,arguments),Object(c.a)("controls-common_position")},updateModel:function(t){this.model.set(t)},render:function(){var t=!!h.prototype.render.apply(this,arguments);if(t){this.$fullwidthMarginInput=Object(o.a)(this.$(".full-width.margin-input")),this.$fullwidthMarginInput.RMNumericInput({onChange:function(t,e){this.setFullwidth()}.bind(this)}),this.$fullheightMarginInput=Object(o.a)(this.$(".full-height.margin-input")),this.$fullheightMarginInput.RMNumericInput({onChange:function(t,e){this.setFullheight()}.bind(this)}),Object(o.a)(this.$(".margin-input")).RMDrag({start:this.addHoveredClass,end:this.removeHoveredClass,silent:!0});var e={width:40,height:24,"color-0":"#0078ff","color-1":"#c9c8c9","text-0":"","text-1":""},i=!1;if(this.blocks&&this.blocks[0]&&this.blocks[0].mag&&this.blocks[0].workspace.eCommerceManager.haveEcommerceCartWidget){var n=this.blocks.find((function(t){return t.blockName===r.a.ecommerceCartBlockName}));n&&(i=!0)}var a=function(t,e){var i=!0,o=!0;s.a.each(this.blocks,(function(t){t.model.get(e)||(i=!1),t.model.get(e)&&(o=!1)})),i||o?t.setState(i,!0):t.setUndefinedState()}.bind(this);return this.globalSwitcher=Object(o.a)(this.$(".switcher.global")).RMSwitcher(i?Object.assign({},e,{disabled:!0}):e,function(t){this.setGlobal(t)}.bind(this)).data("switcher"),a(this.globalSwitcher,"is_global"),this.aboveSwitcher=Object(o.a)(this.$(".switcher.above")).RMSwitcher(e,function(t){this.setAbove(t)}.bind(this)).data("switcher"),a(this.aboveSwitcher,"is_above"),this.updatePanel(),this}this.updatePanel()},addFullWidthClass:function(){Object(o.a)(".position-wrapper .togglers-wrapper .full-width.active").addClass("light-blue")},removeFullWidthClass:function(){var t=Object(o.a)(".position-wrapper .togglers-wrapper .full-width");t.hasClass("light-blue")&&t.removeClass("light-blue")},addHoveredClass:function(t){Object(o.a)(t.currentTarget).hasClass("full-width")?this.$el.removeClass("full-height-hovered"):this.$el.removeClass("full-width-hovered"),this.$el.addClass(t.currentTarget.classList[0]+"-hovered")},removeHoveredClass:function(t){s.a.defer(function(){Object(o.a)(t.target).hasClass("dragging")||Object(o.a)(t.target).hasClass("focused")||this.$el.removeClass(this.$el.hasClass("full-width-hovered")?"full-width-hovered":"full-height-hovered")}.bind(this))},toggleFixed:function(t){var e=Object(o.a)(t.currentTarget),i=this.POS_LIST[e.index()];e.hasClass("active")?this.resetFixed(i):this.setFixed(i)},toggleFullScreen:function(){var t=Object(o.a)(".position-wrapper .full-width:not(.margin-input)"),e=Object(o.a)(".position-wrapper .full-height:not(.margin-input)");t.hasClass("disabled")||e.hasClass("disabled")||(t.hasClass("active")&&!e.hasClass("active")?this.setFullheight({storeHeight:!0}):t.hasClass("active")||e.hasClass("active")?(this.resetFullheight(),this.resetFullwidth()):(this.setFullheight({storeHeight:!0}),this.setFullwidth({storeWidth:!0})))},setFixedPositionInViewports:function(){var t=this,e=this.master.workspace.page.getCurrentViewport(),i=this.getBlocksWithHotspotBlocks(),o={};s.a.each(i,function(t){var i=t.model,n=e;s.a.each(ye.b.viewport_listall,function(e){var a=(e=e.replace("viewport_",""))!==n?i["viewport_"+e]:i.attributes,r=!s.a.isEmpty(a),l=r&&!a.fixed_position,c=r&&!a.hidden;r&&l&&(e!==n&&c?(n=e,o[e]=o[e]||[],o[e].push(t)):c?(o[e]=o[e]||[],o[e].push(t)):a.fixed_position="n")}.bind(this))}.bind(this)),s.a.each(o,(function(i,o){o=o.replace("viewport_",""),s.a.each(i,(function(t){if(o!==e){var i=t.model;i.storeViewport(e),i.restoreViewport(o)}})),t.setFixed("c",i),s.a.each(i,(function(t){if(o!==e){var i=t.model;i.storeViewport(o),i.restoreViewport(e)}}))})),this.master.workspace.set_group(s.a.pluck(i,"model"))},updatePageIndex:function(t){Object(u.a)("constructor.zIndex")&&RM.constructorRouter.indexController.updateIndex(this.master.workspace.page,s.a.map(t,(function(t){return t.model})),!1)},setFixed:function(t,e){e=e?s.a.isArray(e)?e:[e]:this.blocks,this.resetSticked(e);var i=[],o={t:Number.POSITIVE_INFINITY,l:Number.POSITIVE_INFINITY,b:Number.NEGATIVE_INFINITY,r:Number.NEGATIVE_INFINITY},n=this,a=s.a.max(this.master.workspace.blocks,(function(t){return t.model.get("z")})).model.get("z"),r=s.a.min(this.blocks,(function(t){return t.model.get("z")})).model.get("z");s.a.each(e||this.blocks,(function(t){var e=t.getBoxData({includeBoundingBox:!0,checkFixedPosition:!0});o.t=Math.min(o.t,e.bb_y),o.l=Math.min(o.l,e.bb_x),o.b=Math.max(o.b,e.bb_y+e.bb_h),o.r=Math.max(o.r,e.bb_x+e.bb_w)})),s.a.each(e,(function(e){var l=0,c=0,h=e.getBoxData({includeBoundingBox:!0,checkFixedPosition:!0});-1!=["n","c","s"].indexOf(t)&&(l=h.w/2-(o.r-o.l)/2),-1!=["w","c","e"].indexOf(t)&&(c=h.h/2-(o.b-o.t)/2),t.indexOf("s")>-1?0!==(c=h.y-o.b+h.h-c)&&(c*=-1):c+=h.y-o.t,t.indexOf("e")>-1?0!==(l=h.x-o.r+h.w-l)&&(l*=-1):l+=h.x-o.l;var d={_id:e.model.id,fixed_position:t,x:l,y:c};Object(u.a)("constructor.zIndex")||e.model.get("fixed_position")||(d.z=e.model.get("z")+a-r+1),s.a.defer(function(){e.model.get("is_full_height")&&n.setFullheight()}.bind(n)),i.push(d)})),this.master.workspace.set_group(i),this.updatePageIndex(e)},resetFixed:function(t){var e=[],i=this;s.a.each(this.blocks,(function(o){if(o.model.get("fixed_position")&&(!t||o.model.get("fixed_position")==t)){var n=o.$el.offset(),a=o.workspace.position;e.push({_id:o.model.id,fixed_position:"",x:n.left-a.left,y:n.top-a.top}),s.a.defer(function(){o.model.get("is_full_height")&&i.setFullheight()}.bind(i))}})),s.a.isEmpty(e)||(this.master.workspace.set_group(e),this.setAbove(!1))},toggleFullHeight:function(t){var e=Object(o.a)(t.currentTarget);e.hasClass("disabled")||(e.hasClass("active")?(this.removeFullWidthClass(),this.resetFullheight()):this.setFullheight({storeHeight:!0}))},toggleFullWidth:function(t){var e=Object(o.a)(t.currentTarget);e.hasClass("disabled")||e.hasClass(".full-screen-video")||(e.hasClass("active")?this.resetFullwidth():this.setFullwidth({storeWidth:!0}))},setFullheight:function(t){this.resetSticked(null,{vertical_only:!0}),t=t||{};var e=[],i=parseInt(this.$fullheightMarginInput.val(),10)||0,o=this.block.getFullHeightDims(i);s.a.each(this.blocks,(function(n){var a={_id:n.model.get("_id"),is_full_height:!0,h:o.h,full_height_margin:i};t.storeHeight&&(s.a.extend(a,{full_height_initial_y:n.model.get("y"),full_height_initial_h:n.model.get("h")}),n.model.get("angle")&&(a.angle=0),n.model.get("flip_v")&&(a.flip_v=!1),n.model.get("flip_h")&&(a.flip_h=!1)),e.push(a)})),this.master.workspace.set_group(e)},setFullwidth:function(t){this.resetSticked(null,{horizontal_only:!0}),t=t||{};var e=[],i=parseInt(this.$fullwidthMarginInput.val(),10)||0,o=this.block.getFullWidthDims(i);s.a.each(this.blocks,(function(n){var a={_id:n.model.get("_id"),is_full_width:!0,w:o.w/RM.constructorRouter.zoom.getZoom(),full_width_margin:i};t.storeWidth&&(s.a.extend(a,{full_width_initial_x:n.model.get("x"),full_width_initial_w:n.model.get("w")}),n.model.get("angle")&&(a.angle=0),n.model.get("flip_v")&&(a.flip_v=!1),n.model.get("flip_h")&&(a.flip_h=!1)),e.push(a)})),this.master.workspace.set_group(e)},resetFullheight:function(){var t=[],e=this;s.a.each(this.blocks,(function(i){i.model.get("is_full_height")&&t.push({_id:i.model.get("_id"),is_full_height:!1,y:i.model.get("full_height_initial_y")||i.model.get("y"),h:i.model.get("full_height_initial_h")||i.model.get("h")}),i.model.get("is_full_width")&&t.push({_id:i.model.get("_id"),w:i.getFullWidthDims().w/RM.constructorRouter.zoom.getZoom()}),s.a.defer(function(){i.model.get("fixed_position")&&e.setFixed(i.model.get("fixed_position"),i)}.bind(e))})),s.a.isEmpty(t)||this.master.workspace.set_group(t)},resetFullwidth:function(){var t=[],e=this;s.a.each(this.blocks,(function(i){i.model.get("is_full_width")&&t.push({_id:i.model.get("_id"),is_full_width:!1,x:i.model.get("full_width_initial_x")||i.model.get("x"),w:i.model.get("full_width_initial_w")||i.model.get("w")}),i.model.get("is_full_height")&&t.push({_id:i.model.get("_id"),h:i.getFullHeightDims().h}),s.a.defer(function(){i.model.get("fixed_position")&&e.setFixed(i.model.get("fixed_position"),i)}.bind(e))})),s.a.isEmpty(t)||this.master.workspace.set_group(t)},toggleSticked:function(t){var e=Object(o.a)(t.currentTarget),i=e.attr("data-side");e.hasClass("disabled")||(e.hasClass("active")?this.resetSticked(null,{side:i}):this.setSticked(i))},setSticked:function(t){this.resetFixed(),"left"!=t&&"right"!=t||this.resetFullwidth(),"top"!=t&&"bottom"!=t||this.resetFullheight();var e={t:Number.POSITIVE_INFINITY,l:Number.POSITIVE_INFINITY,b:Number.NEGATIVE_INFINITY,r:Number.NEGATIVE_INFINITY};s.a.each(this.blocks,(function(t){var i=t.getBoxData({includeBoundingBox:!0});e.t=Math.min(e.t,i.bb_y),e.l=Math.min(e.l,i.bb_x),e.b=Math.max(e.b,i.bb_y+i.bb_h),e.r=Math.max(e.r,i.bb_x+i.bb_w)}));var i=[];s.a.each(this.blocks,(function(s){var o=0,n=s.getBoxData({includeBoundingBox:!0});"left"==t?o=n.x-e.l:"right"==t?o=(e.r-(n.x+n.w))/RM.constructorRouter.zoom.getZoom():"top"==t?o=n.y-e.t:"bottom"==t&&(o=e.b-(n.y+n.h));var a=s.getStickedDims(t,o);i.push({_id:s.model.id,sticked:t,sticked_margin:o,x:a.x,y:a.y})})),s.a.isEmpty(i)||(this.master.workspace.set_group(i),this.setAbove(!1)),"top"==t?this.master.workspace.scrollToTop():"bottom"==t&&this.master.workspace.scrollToBottom()},resetSticked:function(t,e){e=e||{};var i=[];s.a.each(t||this.blocks,(function(t){var s=t.model.get("sticked");if(s&&(!e.side||s==e.side)){if(e.horizontal_only&&"left"!==s&&"right"!==s)return;if(e.vertical_only&&"bottom"!==s&&"top"!==s)return;var o=t.getStickedDims();i.push({_id:t.model.id,sticked:"",x:o.x,y:o.y})}})),s.a.isEmpty(i)||this.master.workspace.set_group(i)},setGlobal:function(t){var e,i=[],o=this.getBlocksWithHotspotBlocks();s.a.each(o,(function(e){i.push({_id:e.model.id,is_global:t})})),t?s.a.each(o,function(t){var e=this.master.workspace.page.getCurrentViewport();ke.a.resetGlobalData(t.model,e)}.bind(this)):(e=this.master.workspace.mag.changeParentPage(s.a.pluck(o,"model"),this.master.workspace.page,{silent:!0}),this.changedPages=this.changedPages||new Backbone.Collection,this.changedPages.add(e),this.aboveSwitcher.setState(t)),s.a.isEmpty(i)||(this.master.workspace.set_group(i),this.updatePageIndex(o),this.master.workspace.trigger("widget:context:change",o))},setAbove:function(t){var e=[],i=this.getBlocksWithHotspotBlocks();void 0!==t&&this.aboveSwitcher&&this.aboveSwitcher.setState(t),t&&this.globalSwitcher.setState(t),s.a.each(i,(function(i){e.push({_id:i.model.id,is_above:t})})),t&&this.setFixedPositionInViewports(),RM.constructorRouter.workspace.common_layer&&RM.constructorRouter.workspace.common_layer.fixBadZIndexes(),s.a.isEmpty(e)||(this.master.workspace.set_group(e),this.updatePageIndex(i),this.master.workspace.trigger("widget:context:change",i))},getBlocksWithHotspotBlocks:function(){var t=[];return s.a.each(this.blocks,(function(e){"hotspot"==e.model.get("type")&&(t=s.a.union(t,e.getGroupBlocks()))})),s.a.union(t,this.blocks)},updatePanel:function(){var t=!0,e=!0,i=!1,o=!1,n=!1,a=!1,l=!1,c=!1,h=!1,d=!1,p=!1,u=!0,g=0,m=0,f=!1,v=this.$("ul li").removeClass("active"),b="default"==this.master.workspace.page.getCurrentViewport();s.a.each(this.blocks,function(b){if(i=i||"left"==b.model.get("sticked"),o=o||b.model.get("is_full_width"),n=n||b.model.get("is_full_height"),a=a||"right"==b.model.get("sticked"),l=l||"top"==b.model.get("sticked"),c=c||"bottom"==b.model.get("sticked"),d=d||b.model.get("fixed_position"),p=d||b.model.get("is_global"),u=u&&b.model.get("is_global"),h=b.model.get("video_id"),f=f||b.model.get("type")===r.a.ecommerceCartBlockName,t=t&&s.a.contains(this.ALLOW_FULL_WIDTH,b.model.get("type"))&&!("shape"==b.model.get("type")&&"icon"==b.model.get("tp")),e=e&&s.a.contains(this.ALLOW_FULL_HEIGHT,b.model.get("type"))&&!("shape"==b.model.get("type")&&("icon"==b.model.get("tp")||"line"==b.model.get("tp"))),b.model.get("fixed_position")&&!b.restoreFixed){var _=this.POS_LIST.indexOf(b.model.get("fixed_position"));v.eq(_).addClass("active")}b.model.get("is_full_width")&&(g=Math.max(g,b.model.get("full_width_margin")||0)),b.model.get("is_full_height")&&(m=Math.max(m,b.model.get("full_height_margin")||0))}.bind(this)),u&&this.globalSwitcher.setState(!0,!0),f&&this.globalSwitcher.setDisabled(!0),this.$fullwidthMarginInput.val(g),this.$fullheightMarginInput.val(m),this.$(".position-wrapper .sticked-left").toggleClass("disabled",!b).toggleClass("active",!!i),this.$(".position-wrapper .full-width").toggleClass("disabled",!b).toggleClass("hidden",!t).toggleClass("active",!!o).toggleClass("full-screen-video",!!h&&!!o&&!!n),this.$(".position-wrapper .full-height").toggleClass("disabled",!b).toggleClass("hidden",!e).toggleClass("active",!!n).toggleClass("full-screen-video",!!h),this.$(".position-wrapper .sticked-right").toggleClass("disabled",!b).toggleClass("active",!!a),this.$(".position-wrapper .sticked-top").toggleClass("disabled",!b).toggleClass("active",!!l),this.$(".position-wrapper .sticked-bottom").toggleClass("active",!!c),this.$el.toggleClass("full-width-margin",!(!t||!o)&&b).toggleClass("full-height-margin",!(!e||!n)&&b).toggleClass("control-active",!!(i||o||n||a||l||c||d||p)),this.updatePanelVerticalPosition()},save:function(){var t=s.a.pluck(this.getBlocksWithHotspotBlocks(),"model");s.a.isEmpty(this.changedPages)||(t=t.concat(this.changedPages.models));var e=this.master.workspace.page.getCurrentViewport();"default"!=e&&s.a.each(t,(function(t){t.storeViewport(e)})),this.master.workspace.save_group(t,{viewport:"default"}),Object(u.a)("constructor.zIndex")&&s.a.each(RM.constructorRouter.indexController.getPagesToSave(),(function(t){t.save(null,{silent:!0})})),"default"!==e&&s.a.each(t,(function(t){t.restoreViewport(e)})),this.master.workspace.common_layer.fixBadZIndexes()}}),Pe=i("Fts9"),$e=i("amZL"),Oe=i("qOkM"),Te=i.n(Oe),Me=b.extend({name:"text_styles",className:"control text_styles",MIN_PANEL_HEIGHT:275,MAX_PANEL_HEIGHT:640,STYLE_PROPERTIES:["color","opacity","font-family","font-size","font-style","font-weight","letter-spacing","line-height","text-align","text-decoration","text-transform","vertical-align","padding-top","padding-right","padding-bottom","padding-left"],saveOnDestroy:!0,initialize:function(t){this.template=Te.a["template-constructor-control-text_styles"],this.style_template=Te.a["template-constructor-control-text_styles-style"],this.initControl(t),this.block=this.blocks[0],this.refreshEditorCssDebounced=s.a.debounce(this.refreshEditorCss,100)},bindLogic:function(){this.textStyles=RM.constructorRouter.textStyles,this.textStyles.on("change:paragraph_styles",this.onStylesChange),this.$panel.on("click",".add-block .add",this.addClick),this.$panel.on("click",".paragraph-style",this.onParagraphStyleClick),this.$panel.on("click",".paragraph-style .tag-changer",this.changeStyleTag),this.$panel.on("click",".paragraph-style .menu-button",this.toggleMenu),this.$panel.on("click",".style-menu .redefine-button",this.onRedefineClick),this.$panel.on("click",".style-menu .revert-button",this.onRevertClick),this.$panel.on("click",".style-menu .edit-button",this.onEditClick),this.$panel.on("click",".style-menu .duplicate-button",this.onDuplicateClick),this.$panel.on("click",".style-menu .delete-button",this.onDeleteClick),this.params=this.block&&this.block.params||{},this.block&&this.block.on("selection_styles_all_changed",this.selectionStylesAllChanged.bind(this)),Object(o.a)(this.$panel.find(".styles-wrapper")).sortable({distance:10,axis:"y",scrollSpeed:20,containment:"parent",tolerance:"pointer",start:s.a.bind((function(t,e){this.closeMenu(!1)}),this),stop:s.a.bind((function(t,e){this.reorder()}),this)}),this.renderParagraphStyles(),this.$panel.on("click",".add-block .save",this.saveEditClick),this.$panel.on("click",".add-block .cancel",this.cancelEditClick),this.$panel.on("input",".edit-content .caption",this.onEditCaptionChange),this.$panel.on("click",".edit-content .switcher",this.onSwitcherClick),this.$panel.on("click",".edit-content .color-click-area",this.onColorboxShowClick),this.$panel.on("click",".edit-content .font-family-click-area",this.onFontSelectorShowClick),this.$panel.on("click",".edit-content .font-style-click-area",this.onFontStyleShowClick),this.$panel.on("click",".edit-scroll-wrapper",this.closeAllEditPopups),this.$panel.on("dblclick",".paragraph-style",this.onDoubleClick),this.$panel.on("click",".edit-content .tag-changer",this.changeStyleTag),this.colorbox=new Pe.a({$parent:this.$(".colorbox_container"),type:"small"}),this.colorbox.on("colorchange",this.colorOpacityChanged),this.colorbox.on("opacitychange",this.colorOpacityChanged),this.fontselector=new $e.a({$parent:this.$(".fontselector_container")}),this.fontselector.on("selectfont",this.fontChanged),this.editFontSizeChangeValue=Object(o.a)(this.$panel.find(".edit-content .font-size")).RMNumericInput({min:this.params.minFontSize,max:this.params.maxFontSize,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.editLineHeightChangeValue=Object(o.a)(this.$panel.find(".edit-content .line-height")).RMNumericInput({min:this.params.minLineHeight,max:this.params.maxLineHeight,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.editLetterSpacingChangeValue=Object(o.a)(this.$panel.find(".edit-content .letter-spacing")).RMNumericInput({min:this.params.minLetterSpacing,max:this.params.maxLetterSpacing,mouseDir:"h",useFloat:!0,step:.2,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.editPaddingLeftChangeValue=Object(o.a)(this.$panel.find(".edit-content .padding-left")).RMNumericInput({min:0,max:999,mouseSpeed:4,mouseDir:"h",onChange:this.onEditInputChanged}).data("changeValue"),this.editPaddingRightChangeValue=Object(o.a)(this.$panel.find(".edit-content .padding-right")).RMNumericInput({min:0,max:999,mouseSpeed:4,mouseDir:"h",invertMouse:!0,onChange:this.onEditInputChanged}).data("changeValue"),this.editPaddingTopChangeValue=Object(o.a)(this.$panel.find(".edit-content .padding-top")).RMNumericInput({min:0,max:999,mouseSpeed:4,invertMouse:!0,onChange:this.onEditInputChanged}).data("changeValue"),this.editPaddingBottomChangeValue=Object(o.a)(this.$panel.find(".edit-content .padding-bottom")).RMNumericInput({min:0,max:999,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.editScroll=Object(o.a)(this.$el.find(".edit-scroll-wrapper")).RMScroll({$container:this.$el.find(".edit-content-wrapper"),$content:this.$el.find(".edit-content"),$handle:this.$el.find(".edit-scroll"),wheelScrollSpeed:.4,gap_start:16,gap_end:16,onScroll:this.onEditScroll.bind(this)}).data("scroll")},unBindLogic:function(){this.block.off(null,null,this),this.textStyles.off("change:paragraph_styles",this.onStylesChange),this.$panel.off("click",".add-block .add",this.addClick),this.$panel.off("click",".paragraph-style",this.onParagraphStyleClick),this.$panel.off("click",".paragraph-style .tag-changer",this.changeStyleTag),this.$panel.off("click",".paragraph-style .menu-button",this.toggleMenu),this.$panel.off("click",".style-menu .redefine-button",this.onRedefineClick),this.$panel.off("click",".style-menu .revert-button",this.onRevertClick),this.$panel.off("click",".style-menu .edit-button",this.onEditClick),this.$panel.off("click",".style-menu .duplicate-button",this.onDuplicateClick),this.$panel.off("click",".style-menu .delete-button",this.onDeleteClick),this.$panel.off("dblclick",".paragraph-style",this.onDoubleClick),this.$panel.off("click",".edit-content .tag-changer",this.changeStyleTag),this.block&&this.block.off("selection_styles_all_changed",this.selectionStylesAllChanged),this.$panel.off("click",".add-block .save",this.saveEditClick),this.$panel.off("click",".add-block .cancel",this.cancelEditClick),this.$panel.off("input",".edit-content .caption",this.onEditCaptionChange),this.$panel.off("click",".edit-content .switcher",this.onSwitcherClick),this.$panel.off("click",".edit-content .color-click-area",this.onColorboxShowClick),this.$panel.off("click",".edit-content .font-family-click-area",this.onFontSelectorShowClick),this.$panel.off("click",".edit-content .font-style-click-area",this.onFontStyleShowClick),this.$panel.off("click",".edit-scroll-wrapper",this.closeAllEditPopups),this.colorbox&&this.colorbox.off("colorchange",this.colorOpacityChanged),this.colorbox&&this.colorbox.off("opacitychange",this.colorOpacityChanged),this.colorbox&&this.colorbox.destroy(),this.colorbox=null,this.fontselector&&this.fontselector.off("selectfont",this.fontChanged),this.fontselector&&this.fontselector.destroy(),this.fontselector=null},onStylesChange:function(t,e,i){(i=i||{}).socketUpdate&&this.renderParagraphStyles()},renderParagraphStyles:function(){var t=this.textStyles.getStylesListSorted("paragraph"),e="";s.a.each(t,(function(t){e+=this.style_template(t)}),this),this.$panel.find(".styles-wrapper").html(e),this.resizableScroll&&this.resizableScroll.recalc(),Object(o.a)(this.$panel.find(".styles-wrapper")).sortable("refresh")},reorder:function(){var t=[];this.$(".paragraph-style").each((function(){t.push(Object(o.a)(this).attr("data-id"))})),this.textStyles.reorder("paragraph",t)},selectionStylesAllChanged:function(t){if(this.selected){var e={};this.$(".paragraph-style.active").each((function(){e[Object(o.a)(this).attr("data-id")]=!0})),this.closeMenu(!0);var i={},n={};s.a.each(t,s.a.bind((function(t,e){var o=this.textStyles.findStyle("paragraph",t["paragraph-class"]),a=o?o._name:"",r=s.a.pick.apply(void 0,s.a.union([t],this.STYLE_PROPERTIES)),l=s.a.values(r).join("|");if(i[a]||(i[a]={}),n[l]=!0,0==e&&this.$panel.find(".add-block .add").attr("data-redefine",l),o){var c=s.a.pick.apply(void 0,s.a.union([o],this.STYLE_PROPERTIES));l!=s.a.values(c).join("|")&&(i[a][l]=!0)}else i[a][l]=!0}),this)),this.$(".paragraph-style").removeClass("active is-changed can-redefine can-override"),s.a.each(i,s.a.bind((function(t,e){if(e){var i=this.$('.paragraph-style[data-id="'+e+'"]');i.addClass("active"),s.a.isEmpty(t)||i.addClass("is-changed can-override")}else this.$('.paragraph-style[data-id="paragraph-none"]').addClass("active")}),this));var a=s.a.keys(n).length;if(a<=2){var r=s.a.keys(n);this.$(".paragraph-style").each(s.a.bind((function(t,e){var i=Object(o.a)(e),n=this.textStyles.findStyle("paragraph",i.attr("data-id"));if(n){var l,c=s.a.pick.apply(void 0,s.a.union([n],this.STYLE_PROPERTIES)),h=s.a.values(c).join("|");1==a&&h!=r[0]&&(l=r[0]),2==a&&h==r[0]&&(l=r[1]),2==a&&h==r[1]&&(l=r[0]),l&&i.addClass("can-redefine").attr("data-redefine",l)}}),this))}var l={};if(this.$(".paragraph-style.active").each((function(){l[Object(o.a)(this).attr("data-id")]=!0})),!s.a.isEqual(e,l)){var c=this.$(".paragraph-style.active").first();if(c.length){var h,d=this.$panel.find(".resizable-content-wrapper"),p=c.position().top,u=d.height(),g=c.outerHeight();p+g-d.scrollTop()>u-8?h=p+g-u+8:p-d.scrollTop()<8&&(h=p-8),null!=h&&d.stop().animate({scrollTop:h},200)}}}},onParagraphStyleClick:function(t){if(!Object(o.a)(t.target).closest(".menu-button").length&&!Object(o.a)(t.target).closest(".tag-changer").length){var e=Object(o.a)(t.target).closest(".paragraph-style").attr("data-id");this.block&&("paragraph-none"==e?this.block.trigger("changeClassParagraph",{remove:!0}):this.block.trigger("changeClassParagraph",{class:e}))}},getNextStyleTag:function(t){var e=r.a.AVAILABLE_TEXT_TAGS,i=e.indexOf(t);return i>-1?e[i+1]||e[0]:t},changeStyleTag:function(t){if(this.currentEditStyle){var e=this.getNextStyleTag(this.currentEditStyle.tag||"p");this.currentEditStyle.tag=e,this.setEditParams(this.currentEditStyle),this.refreshEditorCssDebounced(),this.renderParagraphStyles()}else{var i=Object(o.a)(t.target),s=i.closest(".paragraph-style"),n=s.attr("data-id"),a=s.attr("data-tag"),r=this.textStyles.findStyle("paragraph",n);r.tag=this.getNextStyleTag(a),this.textStyles.changeStyle("paragraph",r._name),i.text(r.tag),s.attr("data-tag",r.tag)}},toggleMenu:function(t){var e=Object(o.a)(t.currentTarget),i=e.hasClass("active"),n=this.$(".style-menu");i?this.closeMenu(!0):(this.$(".paragraph-style .menu-button.active").length>0&&this.closeMenu(!1),setTimeout(s.a.bind((function(){var t=e.closest(".paragraph-style"),i=t.position().top+e.position().top+e.height()-this.$panel.find(".resizable-content-wrapper").scrollTop()-5;n.css("top",i).addClass("shown").attr("data-id",t.attr("data-id")).toggleClass("can-redefine",t.hasClass("can-redefine")).toggleClass("can-override",t.hasClass("can-override")),e.addClass("active")}),this),40))},closeMenu:function(t){var e=this.$(".style-menu");t||e.removeClass("transition-enable"),e.removeClass("shown"),t||setTimeout((function(){e.addClass("transition-enable")}),20),this.$(".paragraph-style .menu-button").removeClass("active")},onPanelScroll:function(t){this.closeMenu(!0)},onRedefineClick:function(t){var e=Object(o.a)(t.currentTarget).closest(".style-menu"),i=this.$('.paragraph-style[data-id="'+e.attr("data-id")+'"]').attr("data-redefine"),n=s.a.object(this.STYLE_PROPERTIES,i.split("|"));this.textStyles.redefineStyle("paragraph",e.attr("data-id"),n),RM.constructorRouter.textStyles.generateCSS("paragraph","editor",this.block.iframe_document),RM.constructorRouter.textStyles.generateCSS("paragraph","constructor",document),this.resizableScroll&&this.resizableScroll.recalc(),this.block.somethingChangedInEditor("styleRedefined")},onRevertClick:function(t){var e=Object(o.a)(t.currentTarget).closest(".style-menu").attr("data-id");this.block&&("paragraph-none"==e?this.block.trigger("changeClassParagraph",{remove:!0,override:!0}):this.block.trigger("changeClassParagraph",{class:e,override:!0}))},onDuplicateClick:function(t){var e=Object(o.a)(t.currentTarget).closest(".style-menu").attr("data-id"),i=this.textStyles.duplicateStyle("paragraph",e),n=this.$('.paragraph-style[data-id="'+e+'"]');if(i){RM.constructorRouter.textStyles.generateCSS("paragraph","editor",this.block.iframe_document),RM.constructorRouter.textStyles.generateCSS("paragraph","constructor",document),this.block.somethingChangedInEditor("styleAdded");var a=Object(o.a)(this.style_template(i));a.addClass("enable-transition").css("margin-top",-n.outerHeight()),a.insertAfter(n),setTimeout(s.a.bind((function(){a.css("margin-top",0),setTimeout(s.a.bind((function(){a.removeClass("enable-transition"),Object(o.a)(this.$panel.find(".styles-wrapper")).sortable("refresh"),this.resizableScroll&&this.resizableScroll.recalc()}),this),270)}),this),50)}},onDeleteClick:function(t){var e=Object(o.a)(t.currentTarget).closest(".style-menu").attr("data-id"),i=this.$('.paragraph-style[data-id="'+e+'"]');this.closeMenu(!0),i.addClass("enable-transition"),setTimeout(s.a.bind((function(){i.addClass("shift-left"),setTimeout(s.a.bind((function(){i.css("margin-top",-i.outerHeight()),setTimeout(s.a.bind((function(){i.remove(),Object(o.a)(this.$panel.find(".styles-wrapper")).sortable("refresh"),this.resizableScroll&&this.resizableScroll.recalc(),RM.constructorRouter.textStyles.deleteStyle("paragraph",e),RM.constructorRouter.textStyles.generateCSS("paragraph","editor",this.block.iframe_document),RM.constructorRouter.textStyles.generateCSS("paragraph","constructor",document),this.block.somethingChangedInEditor("styleDeleted")}),this),270)}),this),270)}),this),50)},addClick:function(t){var e=Object(o.a)(t.currentTarget).attr("data-redefine"),i=s.a.object(this.STYLE_PROPERTIES,e.split("|")),n=this.textStyles.addStyle("paragraph",i);RM.constructorRouter.textStyles.generateCSS("paragraph","editor",this.block.iframe_document),RM.constructorRouter.textStyles.generateCSS("paragraph","constructor",document),this.block.somethingChangedInEditor("styleAdded");var a=Object(o.a)(this.style_template(n));a.addClass("enable-transition").addClass("collapsed"),this.$panel.find(".styles-wrapper").append(a);var r=Object(o.a)(a).closest(".paragraph-style").attr("data-id");this.block&&this.block.trigger("changeClassParagraph",{class:r}),this.$el.find(".resizable-content-wrapper").scrollTop(9999),setTimeout(s.a.bind((function(){a.removeClass("collapsed"),setTimeout(s.a.bind((function(){a.removeClass("enable-transition"),Object(o.a)(this.$panel.find(".styles-wrapper")).sortable("refresh"),this.resizableScroll&&this.resizableScroll.recalc()}),this),270)}),this),50)},onScrollRecalc:function(t){this.editScroll&&this.editScroll.recalc()},openMenu:function(t){var e=this.textStyles.findStyle("paragraph",t);this.originalEditStyle=s.a.clone(e),this.currentEditStyle=e,this.setEditParams(this.currentEditStyle),this.$panel.addClass("toggle-opaque"),this.closeMenu(!0),setTimeout(s.a.bind((function(){this.$panel.addClass("show-style-edit")}),this),300)},onEditClick:function(t){var e=Object(o.a)(t.currentTarget).closest(".style-menu").attr("data-id");this.openMenu(e)},onDoubleClick:function(t){var e=Object(o.a)(t.target).closest(".paragraph-style").attr("data-id");this.openMenu(e)},editClose:function(){this.closeAllEditPopups(),RM.constructorRouter.textStyles.generateCSS("paragraph","editor",this.block.iframe_document),RM.constructorRouter.textStyles.generateCSS("paragraph","constructor",document),this.resizableScroll&&this.resizableScroll.recalc(),this.block.somethingChangedInEditor("styleChanged"),this.$panel.removeClass("show-style-edit"),setTimeout(s.a.bind((function(){this.$panel.removeClass("toggle-opaque")}),this),400),this.currentEditStyle=void 0},setEditParams:function(t){var e=this.$panel.find(".edit-content");e.find(".caption").val(t._caption);var i=RM.constructorRouter.fonts.findFontByCSSName(t["font-family"]);e.find(".font-family").text(i.name).css("font-family",i.css_name);var s=RM.constructorRouter.fonts.getStyleName(t["font-weight"],t["font-style"],i.name);e.find(".font-style").text(s).css({"font-family":i.css_name,"font-style":t["font-style"],"font-weight":t["font-weight"]}),e.find(".color-value").text("#"+t.color),e.find(".color-circle").css({background:"#"+t.color,opacity:t.opacity/100}),this.editFontSizeChangeValue(t["font-size"],!0),this.editLineHeightChangeValue(t["line-height"],!0),this.editLetterSpacingChangeValue(t["letter-spacing"],!0),e.find(".text-align-left").toggleClass("active","left"==t["text-align"]),e.find(".text-align-center").toggleClass("active","center"==t["text-align"]),e.find(".text-align-right").toggleClass("active","right"==t["text-align"]),e.find(".text-align-justify").toggleClass("active","justify"==t["text-align"]),e.find(".text-transform").toggleClass("active","uppercase"==t["text-transform"]),e.find(".text-underline").toggleClass("active","underline"==t["text-decoration"]),e.find(".text-strike").toggleClass("active","line-through"==t["text-decoration"]),this.editPaddingLeftChangeValue(t["padding-left"],!0),this.editPaddingRightChangeValue(t["padding-right"],!0),this.editPaddingTopChangeValue(t["padding-top"],!0),this.editPaddingBottomChangeValue(t["padding-bottom"],!0),e.find(".tag-changer span").text(t.tag||"p")},onEditCaptionChange:function(t){this.currentEditStyle._caption=Object(o.a)(t.target).val()},onEditInputChanged:function(t,e){this.currentEditStyle[t.attr("data-param")]=e,this.refreshEditorCssDebounced()},onSwitcherClick:function(t){var e=Object(o.a)(t.target).attr("data-param"),i=Object(o.a)(t.target).attr("data-val");this.currentEditStyle[e]==i?this.currentEditStyle[e]="text-align"==e?"start":"none":this.currentEditStyle[e]=i,this.setEditParams(this.currentEditStyle),this.refreshEditorCssDebounced()},colorOpacityChanged:function(t,e,i,s){this.currentEditStyle.color=this.colorbox&&this.colorbox.rgb2hex([t,e,i]),this.currentEditStyle.opacity=100*s,this.setEditParams(this.currentEditStyle),this.refreshEditorCssDebounced()},fontChanged:function(t){this.currentEditStyle["font-family"]=t,this.setEditParams(this.currentEditStyle),this.refreshEditorCssDebounced()},styleChanged:function(t){this.currentEditStyle["font-weight"]=Object(o.a)(t.currentTarget).attr("data-font-weight"),this.currentEditStyle["font-style"]=Object(o.a)(t.currentTarget).attr("data-font-style"),this.setEditParams(this.currentEditStyle),this.refreshEditorCssDebounced(),this.closeFontStyle()},refreshEditorCss:function(){RM.constructorRouter.textStyles.generateCSS("paragraph","editor",this.block.iframe_document),this.block.somethingChangedInEditor("styleChanging")},onColorboxShowClick:function(t){this.colorbox_visible?this.closeColorBox():(this.closeAllEditPopups(),this.colorbox_visible=!0,this.$(".colorbox_container").fadeIn(200),this.colorbox.setOpacity(this.currentEditStyle.opacity/100),this.colorbox.setColor(this.currentEditStyle.color),this.positionPopup(this.$(".colorbox_container"),this.$(".edit-content .color-click-area")))},onFontSelectorShowClick:function(t){this.fontselector_visible?this.closeFontSelector():(this.closeAllEditPopups(),this.fontselector_visible=!0,this.fontselector&&this.fontselector.show([this.currentEditStyle["font-family"]]),this.positionPopup(this.$(".fontselector_container"),this.$(".edit-content .font-family-click-area")))},onFontStyleShowClick:function(t){if(this.fontstyle_visible)this.closeFontStyle();else{this.closeAllEditPopups();var e=this.$(".fontstyle_container .font-style-wrapper");e.empty();var i=RM.constructorRouter.fonts.findFontByCSSName(this.currentEditStyle["font-family"]);i&&(s.a.each(i.variations,s.a.bind((function(t){var s=100*(t.substr(1,1)-0),n="n"==t.substr(0,1)?"normal":"italic",a=RM.constructorRouter.fonts.getStyleName(s,n,i.name),r=Object(o.a)("<div>").appendTo(e).addClass("font-style-item").text(a).css({"font-family":i.css_name,"font-weight":s+"","font-style":n}).attr("data-font-weight",s).attr("data-font-style",n).on("click",this.styleChanged);Object(o.a)("<div>").appendTo(r).addClass("point");s==this.currentEditStyle["font-weight"]&&n==this.currentEditStyle["font-style"]&&r.addClass("curr")}),this)),this.fontstyle_visible=!0,this.$(".fontstyle_container").fadeIn(200),this.positionPopup(this.$(".fontstyle_container"),this.$(".edit-content .font-style-click-area")))}},positionPopup:function(t,e){var i=t.children().first().height(),s=this.$panel.height(),o=Math.floor((s-i)/2),n=e.position().top-this.$panel.find(".edit-content-wrapper").scrollTop();t.css({top:Math.min(o,n)})},closeColorBox:function(){this.colorbox_visible=!1,this.$(".colorbox_container").fadeOut(200)},closeFontSelector:function(){this.fontselector_visible=!1,this.fontselector.hide()},closeFontStyle:function(){this.fontstyle_visible=!1,this.$(".fontstyle_container").fadeOut(200)},closeAllEditPopups:function(t){if(t){if(Object(o.a)(t.target).closest(".colorbox_container").length>0)return;if(Object(o.a)(t.target).closest(".color-click-area").length>0)return;if(Object(o.a)(t.target).closest(".fontselector_container").length>0)return;if(Object(o.a)(t.target).closest(".font-family-click-area").length>0)return;if(Object(o.a)(t.target).closest(".fontstyle_container").length>0)return;if(Object(o.a)(t.target).closest(".font-style-click-area").length>0)return}this.colorbox_visible&&this.closeColorBox(),this.fontselector_visible&&this.closeFontSelector(),this.fontstyle_visible&&this.closeFontStyle()},onEditScroll:function(){this.closeAllEditPopups()},saveEditClick:function(){this.$('.paragraph-style[data-id="'+this.currentEditStyle._name+'"]').find(".style-caption").text(this.currentEditStyle._caption),this.textStyles.changeStyle("paragraph",this.currentEditStyle._name),this.editClose()},onEnterKey:function(){this.$panel.hasClass("show-style-edit")&&this.saveEditClick()},cancelEditClick:function(){this.textStyles.restoreStyle("paragraph",this.currentEditStyle._name,this.originalEditStyle),this.editClose()},save:function(){s.a.isEqual(this.textStyles.getOrder("paragraph"),this.textStyles.orderBefore.paragraph)||this.textStyles.save()},deselect:function(){this.closeAllEditPopups(),b.prototype.deselect.apply(this,arguments)},destroy:function(){this.$panel.hasClass("show-style-edit")&&this.saveEditClick(),this.save(),b.prototype.destroy.apply(this,arguments)},select:function(){b.prototype.select.apply(this,arguments),this.block&&this.selectionStylesAllChanged(this.block.cur_selection_styles_all),Object(c.a)("controls-text_styles")},onClick:function(){if(this.selected){if(this.colorbox_visible||this.fontselector_visible||this.fontstyle_visible)return void this.closeAllEditPopups();if(this.$(".style-menu").hasClass("shown"))return void this.closeMenu(!0)}b.prototype.onClick.apply(this,arguments)},onEscKey:function(){if(this.selected){if(this.colorbox_visible||this.fontselector_visible||this.fontstyle_visible)return void this.closeAllEditPopups();if(this.$(".style-menu").hasClass("shown"))return void this.closeMenu(!0)}b.prototype.onEscKey.apply(this,arguments)},canControlBeClosed:function(){return this.colorbox_visible||this.fontselector_visible||this.fontstyle_visible?(this.closeAllEditPopups(),!0):this.$(".style-menu").hasClass("shown")?(this.closeMenu(!0),!0):b.prototype.canControlBeClosed.apply(this,arguments)}}),je=i("+teE"),Ie=i.n(je),Ee=h.extend({name:"text_typography",className:"control text_typography",initialize:function(t){this.template=Ie.a["template-constructor-control-text_typography"],this.initControl(t)},select:function(){h.prototype.select.apply(this,arguments),Object(c.a)("controls-text_typography")},bindLogic:function(){this.$panel.on("click",this.closeAllPopups),this.fontselector=new $e.a({$parent:this.$panel,css:{left:-79,top:-33}}),this.fontselector.on("selectfont",this.fontChanged),this.params=this.blocks&&this.blocks[0].params||{},this.$panel.on("click",".linked",this.onLinkedClick),this.$panel.on("click",".font-family-popup",this.onFontPopupClick),this.$panel.on("click",".font-style-popup",this.onFontStylePopupClick),this.editFontSizeChangeValue=Object(o.a)(this.$panel.find(".font-size")).RMNumericInput({min:this.params.minFontSize,max:this.params.maxFontSize,mouseSpeed:4,onChange:this.onInputChanged}).data("changeValue"),this.editLineHeightChangeValue=Object(o.a)(this.$panel.find(".line-height")).RMNumericInput({min:this.params.minLineHeight,max:this.params.maxLineHeight,mouseSpeed:4,onChange:this.onInputChanged}).data("changeValue"),this.editLetterSpacingChangeValue=Object(o.a)(this.$panel.find(".letter-spacing")).RMNumericInput({min:this.params.minLetterSpacing,max:this.params.maxLetterSpacing,mouseDir:"h",useFloat:!0,step:.2,shiftStep:1,mouseSpeed:4,onChange:this.onLetterSpacingChanged}).data("changeValue"),this.blocks&&this.blocks[0].on("selection_styles_changed",this.selectionStylesChanged),this.blocks&&this.blocks[0].on("selection_styles_all_changed",this.selectionStylesAllChanged),this.blocks&&this.selectionStylesChanged(this.blocks[0].cur_selection_styles),this.blocks&&this.selectionStylesAllChanged(this.blocks[0].cur_selection_styles_all)},unBindLogic:function(){this.$panel.off("click",this.closeAllPopups),this.fontselector&&this.fontselector.off("selectfont",this.fontChanged),this.fontselector&&this.fontselector.destroy(),this.font_selector_visible=!1,this.fontselector=null,this.$panel.off("click",".linked",this.onLinkedClick),this.$panel.off("click",".font-family-popup",this.onFontPopupClick),this.$panel.off("click",".font-style-popup, .font-style",this.onFontStylePopupClick),this.blocks&&this.blocks[0].off("selection_styles_changed",this.selectionStylesChanged),this.blocks&&this.blocks[0].off("selection_styles_all_changed",this.selectionStylesAllChanged)},plusAnimation:function(){this.$el.flashClass("plus-animation",1200)},selectionStylesAllChanged:function(t){this.$panel.find(".font-style").fadeOut(200),this.font_style_visible=!1,this.fonts_in_selection=[],this.styles_in_selection=[];var e,i=[],n=[],a=[];if(t&&RM.constructorRouter.fonts&&t.length>0){for(var r=0;r<t.length;r++){n.push(t[r]["font-family"]);var l=RM.constructorRouter.fonts.getVisualRenderedFontStyles(t[r]["font-family"],t[r]["font-weight"],t[r]["font-style"]);a.push(l["font-weight"]+"-"+l["font-style"])}if(n=s.a.uniq(n),a=s.a.uniq(a),n.length>0&&(this.fonts_in_selection=n),1==n.length&&(e=n[0]),a.length>0&&s.a.each(a,s.a.bind((function(t){var i=t.split("-");2==i.length&&this.styles_in_selection.push({name:RM.constructorRouter.fonts.getStyleName(i[0],i[1],e),"font-weight":i[0],"font-style":i[1]})}),this)),n.length>0&&a.length>0){var c=RM.constructorRouter.fonts.findCommonFontsStylesAvailable(n);s.a.each(c,(function(t){var s=t.split("-");2==s.length&&i.push({name:RM.constructorRouter.fonts.getStyleName(s[0],s[1],e),"font-weight":s[0],"font-style":s[1]})}))}}var h=s.a.map(this.fonts_in_selection,(function(t){return RM.constructorRouter.fonts.findFontByCSSName(t).name}));this.$panel.find(".font-family-popup .popup-caption").text(h.join(", ")).css("font-family",this.fonts_in_selection.length>0?this.fonts_in_selection[0]:"Arial");var d=s.a.pluck(this.styles_in_selection,"name");this.$panel.find(".font-style-popup .popup-caption").text(d.join(", ")).css({"font-family":this.fonts_in_selection.length>0?this.fonts_in_selection[0]:"Arial","font-weight":this.styles_in_selection.length>0?this.styles_in_selection[0]["font-weight"]:"400","font-style":this.styles_in_selection.length>0?this.styles_in_selection[0]["font-style"]:"normal"});var p=this.$panel.find(".font-style-wrapper");if(p.empty(),s.a.each(i,s.a.bind((function(t,e){var i=Object(o.a)("<div>").appendTo(p).addClass("font-style-item").text(t.name).css({"font-family":this.fonts_in_selection.length>0?this.fonts_in_selection[0]:"Arial","font-weight":t["font-weight"]+"","font-style":t["font-style"]}).attr("font-weight",t["font-weight"]).attr("font-style",t["font-style"]).on("click",this.styleChanged);Object(o.a)("<div>").appendTo(i).addClass("point");s.a.indexOf(d,t.name)+1&&i.addClass("curr")}),this)),this.$panel.find(".font-style-popup").toggleClass("disabled",0==i.length),this.font_selector_visible){var u=this.blocks[0].initiatorControl==this.name?void 0:300;this.fontselector&&this.fontselector.setActiveFont(this.fonts_in_selection||[],u)}t.length&&this.$panel.find(".linked").toggleClass("active",t[0]["size-leading-linked"])},selectionStylesChanged:function(t){"text_typography"!==this.blocks[0].initiatorControl&&this.blocks[0].initiatorControl==this.name||this.updateState(t)},updateState:function(t){null!=t["font-size"]&&this.setMultipleState(this.$panel.find(".font-size"),this.editFontSizeChangeValue,t,"font-size",!0),null!=t["line-height"]&&this.setMultipleState(this.$panel.find(".line-height"),this.editLineHeightChangeValue,t,"line-height",!0),null!=t["letter-spacing"]&&this.setMultipleState(this.$panel.find(".letter-spacing"),this.editLetterSpacingChangeValue,t,"letter-spacing",!1)},setMultipleState:function(t,e,i,s,o){if(this.blocks){var n,a=t.parent().find(".multiple-layer");i[s]==this.blocks[0].params.multipleName?(a.css("display","block"),t.css("opacity",0),n=this.blocks[0].cur_selection_styles_all.length>0?this.blocks[0].cur_selection_styles_all[0][s]:"line-height"==s?this.params.minLineHeight:this.params.minFontSize):(a.css("display","none"),t.css("opacity",1),n=i[s]),e(n=parseFloat(n),!0),o&&this.onInputChanged(t,n,!0,!0)}},onLinkedClick:function(){var t=this.$panel.find(".linked"),e=(this.$panel.find(".font-size"),this.blocks[0].cur_selection_styles_all);if(t.toggleClass("active"),t.hasClass("active")?t.attr("title","Unbind Font Size and Line Height"):t.attr("title","Bind Font Size and Line Height"),this.blocks[0].cur_selection_styles["size-leading-linked"]!=this.blocks[0].params.multipleName&&this.blocks[0].cur_selection_styles["size-leading-ratio"]!=this.blocks[0].params.multipleName){var i={"size-leading-linked":this.$panel.find(".linked").hasClass("active"),"size-leading-ratio":parseInt(e[0]["line-height"],10)/parseInt(e[0]["font-size"],10)};isNaN(i["size-leading-ratio"])&&(i["size-leading-ratio"]=this.params.fontSizeLineHeightRatio),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleParagraph",i))}},onInputChanged:function(t,e,i,o){if(this.blocks){var n=t.attr("data-class"),a="line-height"==n?this.params.minLineHeight:this.params.minFontSize;"line-height"==n?this.params.maxLineHeight:this.params.maxFontSize;this["springEffect-"+n]=this["springEffect-"+n]||0;try{var r=this.blocks[0].cur_selection_styles_all[0]["size-leading-ratio"];if(isNaN(r))r=this.params.fontSizeLineHeightRatio}catch(t){console.log(t.message,t.stack),this.blocks&&(console.log(this.blocks),this.blocks[0]&&(console.log(this.blocks[0]),this.blocks[0].cur_selection_styles_all&&(console.log(this.blocks[0].cur_selection_styles_all),this.blocks[0].cur_selection_styles_all[0]&&console.log(this.blocks[0].cur_selection_styles_all[0]))));r=this.params.fontSizeLineHeightRatio}if(this.$panel.find(".linked").hasClass("active")&&!i&&"font-size"==n){var l=Math.round(e*r);this.editLineHeightChangeValue(l,!0),this.onInputChanged(this.$panel.find(".line-height"),l,!0)}if(this.$panel.find(".linked").hasClass("active")&&!i&&"line-height"==n){l=Math.round(e/r);this.editFontSizeChangeValue(l,!0),this.onInputChanged(this.$panel.find(".font-size"),l,!0)}t.toggleClass("big-number",e>99);var c=0;this["oldVal-"+n]>e&&(c=-1),this["oldVal-"+n]<e&&(c=1),this["oldVal-"+n]=e;var h=(e-a)/63;if(h>1){if(clearTimeout(this["springTimeout-"+n]),this["springEffect-"+n]-=1*c,this["springEffect-"+n]>100&&(this["springEffect-"+n]=100),this["springEffect-"+n]<-100&&(this["springEffect-"+n]=-100),this["springEffect-"+n]>0)var d=Math.sqrt(this["springEffect-"+n]);else d=-Math.sqrt(-this["springEffect-"+n]);t.parent().removeClass("spring-effect"),t.parent().css({"margin-top":-25+d}),this["springTimeout-"+n]=setTimeout(s.a.bind((function(){t.parent().addClass("spring-effect").css({"margin-top":"-25px"}),this["springEffect-"+n]=0}),this),200),h=1}var p=188+-63*h;if(t.parent().css({top:p}),this.$panel.find("."+n+"-gauge").height(188-p+17),!o){var u={};u[n]=e+"px",this.updateState(u),this.$panel.find(".linked").hasClass("active")&&(u["font-size"]=this.$panel.find(".font-size").val()+"px",u["line-height"]=this.$panel.find(".line-height").val()+"px"),u["size-leading-linked"]=this.$panel.find(".linked").hasClass("active"),u["size-leading-ratio"]=r,this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleParagraph",u))}}},onLetterSpacingChanged:function(t,e){var i={"letter-spacing":e+"px"};this.updateState(i),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",i))},onFontPopupClick:function(t){this.fontselector&&this.fontselector.show(this.fonts_in_selection||[]),this.font_selector_visible=!0},onFontStylePopupClick:function(t){this.$panel.find(".font-style-popup").hasClass("disabled")||(this.font_style_visible=!this.$panel.find(".font-style").is(":visible"),this.$panel.find(".font-style").fadeToggle(200))},fontChanged:function(t){var e={"font-family":t};this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",e))},styleChanged:function(t){var e=Object(o.a)(t.currentTarget),i={"font-weight":e.attr("font-weight"),"font-style":e.attr("font-style")};this.closeFontStyle(),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",i))},closeFontSelector:function(){this.font_selector_visible=!1,this.fontselector&&this.fontselector.hide()},closeFontStyle:function(){this.font_style_visible=!1,this.$panel.find(".font-style").fadeOut(200)},closeAllPopups:function(t){if(t){if(Object(o.a)(t.target).closest(".rmfontselector").length>0)return;if(Object(o.a)(t.target).closest(".font-family-popup").length>0)return;if(Object(o.a)(t.target).closest(".font-style-wrapper").length>0)return;if(Object(o.a)(t.target).closest(".font-style-popup").length>0)return}this.font_selector_visible&&this.fontselector.handleEscape()&&this.closeFontSelector(),this.font_style_visible&&this.closeFontStyle()},onClick:function(){this.selected&&(this.font_selector_visible||this.font_style_visible)?this.closeAllPopups():h.prototype.onClick.apply(this,arguments)},onEscKey:function(){this.selected&&(this.font_selector_visible||this.font_style_visible)?this.closeAllPopups():h.prototype.onEscKey.apply(this,arguments)},deselect:function(){this.closeAllPopups(),h.prototype.deselect.apply(this,arguments)},canControlBeClosed:function(){return this.font_selector_visible||this.font_style_visible?(this.closeAllPopups(),!0):h.prototype.canControlBeClosed.apply(this,arguments)}}),Ae=i("+uCx"),Re=i.n(Ae),De=h.extend({name:"text_bius",className:"control text_bius",initialize:function(t){this.template=Re.a["template-constructor-control-text_bius"],this.initControl(t),s.a.bindAll(this)},select:function(){h.prototype.select.apply(this,arguments),Object(c.a)("controls-text_bius")},bindLogic:function(){this.$panel.on("click",".all-caps",this.allaps),this.$panel.on("click",".small-caps",this.smallaps),this.$panel.on("click",".sup",this.sup),this.$panel.on("click",".sub",this.sub),this.$panel.on("click",".bold",this.bold),this.$panel.on("click",".italic",this.italic),this.$panel.on("click",".underline",this.underline),this.$panel.on("click",".strike",this.strike),this.blocks&&this.blocks[0].on("selection_styles_changed",this.selectionStylesChanged),this.blocks&&this.selectionStylesChanged(this.blocks[0].cur_selection_styles)},unBindLogic:function(){this.$panel.off("click",".all-caps",this.allaps),this.$panel.off("click",".small-caps",this.smallaps),this.$panel.off("click",".sup",this.sup),this.$panel.off("click",".sub",this.sub),this.$panel.off("click",".bold",this.bold),this.$panel.off("click",".italic",this.italic),this.$panel.off("click",".underline",this.underline),this.$panel.off("click",".strike",this.strike),this.blocks&&this.blocks[0].off("selection_styles_changed",this.selectionStylesChanged)},selectionStylesChanged:function(t){this.blocks[0].initiatorControl!=this.name&&this.updateState(t)},updateState:function(t){t["text-transform"]&&(this.$panel.find(".all-caps").toggleClass("curr","uppercase"==t["text-transform"]),this.$panel.find(".small-caps").toggleClass("curr","lowercase"==t["text-transform"])),t["vertical-align"]&&(this.$panel.find(".sup").toggleClass("curr","super"==t["vertical-align"]),this.$panel.find(".sub").toggleClass("curr","sub"==t["vertical-align"])),t["font-weight"]&&this.$panel.find(".bold").toggleClass("curr","700"==t["font-weight"]),t["font-style"]&&this.$panel.find(".italic").toggleClass("curr","italic"==t["font-style"]),t["text-decoration"]&&(this.$panel.find(".underline").toggleClass("curr","underline"==t["text-decoration"]),this.$panel.find(".strike").toggleClass("curr","line-through"==t["text-decoration"]))},"allaps":function(t){var e={"text-transform":"uppercase"};Object(o.a)(t.currentTarget).hasClass("curr")&&(e={"text-transform":"none"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",e))},"smallaps":function(t){var e={"text-transform":"lowercase"};Object(o.a)(t.currentTarget).hasClass("curr")&&(e={"text-transform":"none"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",e))},sup:function(t){var e={"vertical-align":"super"};Object(o.a)(t.currentTarget).hasClass("curr")&&(e={"vertical-align":"baseline"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",e))},sub:function(t){var e={"vertical-align":"sub"};Object(o.a)(t.currentTarget).hasClass("curr")&&(e={"vertical-align":"baseline"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",e))},bold:function(t){var e={"font-weight":"700"};Object(o.a)(t.currentTarget).hasClass("curr")&&(e={"font-weight":"400"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",e))},italic:function(t){var e={"font-style":"italic"};Object(o.a)(t.currentTarget).hasClass("curr")&&(e={"font-style":"normal"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",e))},underline:function(t){var e={"text-decoration":"underline"};Object(o.a)(t.currentTarget).hasClass("curr")&&(e={"text-decoration":"none"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",e))},strike:function(t){var e={"text-decoration":"line-through"};Object(o.a)(t.currentTarget).hasClass("curr")&&(e={"text-decoration":"none"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",e))}}),ze=i("P6JF"),Le=i.n(ze),Be=h.extend({name:"text_align",className:"control text_align",initialize:function(t){this.template=Le.a["template-constructor-control-text_align"],this.initControl(t)},select:function(){h.prototype.select.apply(this,arguments),Object(c.a)("controls-text_align")},bindLogic:function(){this.$panel.on("click",".left",this.left),this.$panel.on("click",".center",this.center),this.$panel.on("click",".right",this.right),this.$panel.on("click",".justify",this.justify),this.blocks&&this.blocks[0].on("selection_styles_changed",this.selectionStylesChanged),this.blocks&&this.selectionStylesChanged(this.blocks[0].cur_selection_styles)},unBindLogic:function(){this.$panel.off("click",".left",this.left),this.$panel.off("click",".center",this.center),this.$panel.off("click",".right",this.right),this.$panel.off("click",".justify",this.justify),this.blocks&&this.blocks[0].off("selection_styles_changed",this.selectionStylesChanged)},selectionStylesChanged:function(t){this.blocks[0].initiatorControl!=this.name&&this.updateState(t)},updateState:function(t){t["text-align"]&&(this.$panel.find(".left").toggleClass("curr","left"==t["text-align"]),this.$panel.find(".center").toggleClass("curr","center"==t["text-align"]),this.$panel.find(".right").toggleClass("curr","right"==t["text-align"]),this.$panel.find(".justify").toggleClass("curr","justify"==t["text-align"]),this.$icon.toggleClass("left","right"!=t["text-align"]&&"center"!=t["text-align"]&&"justify"!=t["text-align"]),this.$icon.toggleClass("right","right"==t["text-align"]),this.$icon.toggleClass("center","center"==t["text-align"]),this.$icon.toggleClass("justify","justify"==t["text-align"]))},left:function(t){var e={"text-align":"left"};Object(o.a)(t.currentTarget).hasClass("curr")&&(e={"text-align":"inherit"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleParagraph",e))},center:function(t){var e={"text-align":"center"};Object(o.a)(t.currentTarget).hasClass("curr")&&(e={"text-align":"inherit"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleParagraph",e))},right:function(t){var e={"text-align":"right"};Object(o.a)(t.currentTarget).hasClass("curr")&&(e={"text-align":"inherit"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleParagraph",e))},justify:function(t){var e={"text-align":"justify"};Object(o.a)(t.currentTarget).hasClass("curr")&&(e={"text-align":"inherit"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleParagraph",e))}}),Fe=i("7E8S"),He=i.n(Fe),Ne=h.extend({name:"text_autosize",className:"control text_autosize",initialize:function(t){this.template=He.a["template-constructor-control-text_autosize"],this.initControl(t)},select:function(){h.prototype.select.apply(this,arguments),Object(c.a)("controls-text_autosize")},bindLogic:function(){s.a.each(this.models,function(t){this.listenTo(t,"change:autosize",this.updateState)}.bind(this))},unBindLogic:function(){},onClick:function(){var t=this.models[0].get("autosize");this.models[0].save("autosize",!t)},updateState:function(){var t=!!this.models[0].get("autosize");this.$el.toggleClass("autosize",t),this.$(".icon").attr("data-alt",t?"Auto-size on":"Auto-size off")},render:function(){h.prototype.render.apply(this,arguments),this.updateState()}}),Ve=i("vetb"),Ue=i.n(Ve),We=a.a.View.extend({template:Ue.a["template-constructor-control-anchor_picker"],initialize:function(t){s.a.bindAll(this),s.a.extend(this,t)},render:function(){return this.setElement(Object(o.a)(this.template())),this.$picker=this.$el.find(".anchor-picker"),this.$popup=this.$el.find(".popup"),this.workspace=RM.constructorRouter.workspace,this.listenTo(this.workspace,"workspace-resize",this.setOverlayPosition),this.setOverlayPosition(),this},show:function(){this.render(),this.$el.insertAfter(this.$after),Object(o.a)(window).on("resize",this.onWindowResize)},hide:function(){this.stopFollowing(),Object(o.a)(window).off("resize",this.onWindowResize),this.remove()},startFollowing:function(){Object(o.a)(window).on("mousemove",this.onMouseMove),this.$el.on("click",this.onMouseClick),this.$el.addClass("target-mode"),this.containerInitialScroll=this.$container.scrollTop()},stopFollowing:function(){Object(o.a)(window).off("mousemove",this.onMouseMove),this.$el.off("click",this.onMouseClick),this.$el.removeClass("target-mode"),void 0!==this.containerInitialScroll&&this.$container.animate({scrollTop:this.containerInitialScroll},500)},onMouseMove:function(t){this.updateY(t.pageY+this.$container.scrollTop()-this.top),this.$popup.css("left",t.pageX)},onMouseClick:function(t){this.stopFollowing(),this.trigger("target-select",{y:t.offsetY})},updateY:function(t){this.$picker.css("top",t)},onWindowResize:function(t){this.setOverlayPosition()},setOverlayPosition:function(){var t=this.$after.height(),e=parseInt(this.$after.css("top"),10),i=parseInt(this.$after.css("border-top-width"),10);this.top=e+i,this.$el.height(t),this.$el.css("top",this.top)}}),Ge=i("HxOx"),qe=i.n(Ge),Xe=h.extend({name:"text_link",className:"control text_link",urlRegexp:/^http(s?)\:\/\//i,shortUrlRegexp:/^[\da-z\.-]+\.[a-z-]{2,}.*/i,telRegexp:/\+(9[976]\d|8[987530]\d|6[987]\d|5[90]\d|42\d|3[875]\d|2[98654321]\d|9[8543210]|8[6421]|6[6543210]|5[87654321]|4[987654310]|3[9643210]|2[70]|7|1)\d{1,14}$/i,backRegexp:/^(back|scroll)\sto\stop$/i,backLink:"Back to Top",backDisplayName:"Scroll to Top",gobackRegexp:/^(__rm_goback|go\sback)$/i,gobackLink:"__rm_goback",gobackDisplayName:"Go Back",mailchimpRegexp:/^(__rm_mailchimp_.*|<script.*mailchimp\.com.*\{.*baseUrl.*uuid.*lid.*\}.*)$/i,mailchimpMatcher:/start\((\{.*\})\).*\}\)/i,mailchimpLink:"__rm_mailchimp_",mailchimpDisplayName:"Mailchimp Popup",anchorRegexp:/^(__rm_anchor|\d+px)$/i,anchorMatcher:/^(\d+)px$/i,anchorLink:"__rm_anchor",shareRegexp:/^share\.(facebook|twitter|pinterest|gplus|linkedin|email)\.(mag|page)$/i,NEW_DEFAULT_STYLE:{color:"0078ff",opacity:100,"u-style":"solid","u-color":"0078ff","u-opacity":100,"u-size":1,"u-offset":0,"hover-color":"inherit","hover-opacity":"inherit","hover-u-style":"none","hover-u-color":"inherit","hover-u-opacity":"inherit","hover-u-size":"inherit","hover-u-offset":"inherit","current-color":"inherit","current-opacity":"inherit","current-u-style":"none","current-u-color":"inherit","current-u-opacity":"inherit","current-u-size":"inherit","current-u-offset":"inherit"},saveOnDestroy:!0,initialize:function(t){this.template=qe.a["template-constructor-control-text_link"],this.style_template=qe.a["template-constructor-control-text_link-style"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model,this.refreshEditorCssDebounced=s.a.debounce(this.refreshEditorCss,100)},bindLogic:function(){this.bindLogicCommon(),this.bindLogicSpecific()},bindLogicCommon:function(){this.$input=this.$panel.find(".search-wrapper input"),this.$action_icon=this.$panel.find(".search-wrapper .action-icon"),this.$placeholder=this.$panel.find(".search-wrapper .placeholder"),this.$placeholder_icon=this.$panel.find(".search-wrapper .placeholder-selector"),this.$target_input=this.$panel.find(".target-wrapper input"),this.$target_wrapper=this.$panel.find(".target-wrapper"),this.$search_wrapper=this.$panel.find(".search-wrapper"),this.$target_icon=this.$panel.find(".target-icon"),this.$input.on("input",this.onInputChange),this.$input.on("keyup",this.onInputKey),this.$action_icon.on("click",this.inputIconClick),this.$target_input.on("change",this.onTargetInputChange),this.$target_icon.on("click",this.anchorOnTargetClick),this.$panel.on("click",".placeholder-selector",this.togglePlaceholderPopup),this.$panel.on("click",".placeholder-selector .placeholder-item",this.clickPlaceholder),this.$panel.on("click",this.closePlaceholderPopup)},bindLogicSpecific:function(){this.resizableScroll=this.$el.find(".resizable-scroll-wrapper").RMScroll({$container:this.$el.find(".resizable-content-wrapper"),$content:this.$el.find(".resizable-content"),$handle:this.$el.find(".resizable-scroll"),wheelScrollSpeed:.4,gap_start:8,gap_end:8,onScroll:this.onPanelScroll.bind(this)}).data("scroll"),Object(o.a)(window).on("resize",this.repositionPanel),this.textStyles=RM.constructorRouter.textStyles,this.textStyles.on("change:link_styles",this.onStylesChange),this.$panel.on("click",".add-block .add",this.addClick),this.$panel.on("click",".link-style",this.onLinkStyleClick),this.$panel.on("click",".link-style .menu-button",this.toggleMenu),this.$panel.on("click",".style-menu .edit-button",this.onEditClick),this.$panel.on("dblclick",".link-style .style-caption",this.onEditClick),this.$panel.on("click",".style-menu .duplicate-button",this.onDuplicateClick),this.$panel.on("click",".style-menu .delete-button",this.onDeleteClick),this.$panel.find(".styles-wrapper").sortable({distance:10,axis:"y",scrollSpeed:20,containment:"parent",tolerance:"pointer",start:s.a.bind((function(t,e){this.closeMenu(!1)}),this),stop:s.a.bind((function(t,e){this.reorder()}),this)}),this.renderLinkStyles(),this.block&&this.block.on("selection_styles_changed",this.selectionStylesChanged),this.block&&this.selectionStylesChanged(this.block.cur_selection_styles),this.$panel.on("click",".add-block .save",this.saveEditClick),this.$panel.on("click",".add-block .cancel",this.cancelEditClick),this.$panel.on("click",".edit-wrapper .state-switcher-wrapper .state-switcher",this.onStateSwitchClick),this.$panel.on("input",'.edit-wrapper .edit-item[data-field="_caption"] input',this.onEditCaptionChange),this.$panel.on("click",".edit-wrapper .color-click-area",this.onColorboxShowClick),this.$panel.on("click",".edit-wrapper .underline-style-click-area",this.onUnderlineStyleShowClick),this.$panel.on("click",".underline_style_container .underline-style-item",this.underlineStyleChanged),this.$panel.on("click",".edit-wrapper",this.closeAllEditPopups),this.colorbox=new Pe.a({$parent:this.$(".colorbox_container"),type:"small"}),this.colorbox.on("colorchange",this.colorOpacityChanged),this.colorbox.on("opacitychange",this.colorOpacityChanged),this.editUnderlineWidthChangeValue=this.$panel.find('.edit-wrapper .edit-item[data-field="u-size"] input').RMNumericInput({min:1,max:99,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.editPaddingChangeValue=this.$panel.find('.edit-wrapper .edit-item[data-field="u-offset"] input').RMNumericInput({min:-99,max:99,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.editHoverUnderlineWidthChangeValue=this.$panel.find('.edit-wrapper .edit-item[data-field="hover-u-size"] input').RMNumericInput({min:1,max:99,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.editHoverPaddingChangeValue=this.$panel.find('.edit-wrapper .edit-item[data-field="hover-u-offset"] input').RMNumericInput({min:-99,max:99,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.editCurrentUnderlineWidthChangeValue=this.$panel.find('.edit-wrapper .edit-item[data-field="current-u-size"] input').RMNumericInput({min:1,max:99,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.editCurrentPaddingChangeValue=this.$panel.find('.edit-wrapper .edit-item[data-field="current-u-offset"] input').RMNumericInput({min:-99,max:99,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue")},unBindLogic:function(){this.unBindLogicCommon(),this.unBindLogicSpecific()},unBindLogicCommon:function(){this.$input.off("input",this.onInputChange),this.$input.off("keyup",this.onInputKey),this.$action_icon.off("click",this.inputIconClick),this.$target_input.off("change",this.onTargetInputChange),this.$panel.off("click",".placeholder-selector",this.togglePlaceholderPopup),this.$panel.off("click",".placeholder-selector .placeholder-item",this.clickPlaceholder),this.$panel.off("click",this.closePlaceholderPopup)},unBindLogicSpecific:function(){Object(o.a)(window).off("resize",this.repositionPanel),this.block&&this.block.off(null,null,this),this.textStyles.off("change:link_styles",this.onStylesChange),this.$panel.off("click",".add-block .add",this.addClick),this.$panel.off("click",".link-style",this.onLinkStyleClick),this.$panel.off("click",".link-style .menu-button",this.toggleMenu),this.$panel.off("click",".style-menu .edit-button",this.onEditClick),this.$panel.off("click",".style-menu .duplicate-button",this.onDuplicateClick),this.$panel.off("click",".style-menu .delete-button",this.onDeleteClick),this.$panel.off("click",".add-block .save",this.saveEditClick),this.$panel.off("click",".add-block .cancel",this.cancelEditClick),this.$panel.off("click",".edit-wrapper .state-switcher-wrapper .state-switcher",this.onStateSwitchClick),this.$panel.off("input",'.edit-wrapper .edit-item[data-field="_caption"] input',this.onEditCaptionChange),this.$panel.off("click",".edit-wrapper .color-click-area",this.onColorboxShowClick),this.$panel.off("click",".edit-wrapper .underline-style-click-area",this.onUnderlineStyleShowClick),this.$panel.off("click",".edit-wrapper",this.closeAllEditPopups),this.colorbox&&this.colorbox.off("colorchange",this.colorOpacityChanged),this.colorbox&&this.colorbox.off("opacitychange",this.colorOpacityChanged),this.colorbox&&this.colorbox.destroy(),this.colorbox=null,this.block&&this.block.off("selection_styles_changed",this.selectionStylesChanged)},repositionPanel:function(){this.$panel.css("margin-top","");var t=this.$panel.height(),e=this.$panel.offset().top,i=Math.max(Object(o.a)(window).height(),324)-10;t+e>i&&this.$panel.css("margin-top",i-t-e)},toggleCurrentStateSwitch:function(t){var e=this.hasCurrentState(t);this.isInState("current")&&!e&&this.switchState("default"),this.$panel.find(".state-switcher.caption-current").toggle(e)},canHaveCurrentState:function(){var t=this.model.get("is_global"),e=this.block.workspace,i=e&&e.block&&e.block.model&&e.block.model.get("is_global");return Boolean(t||i)},hasCurrentState:function(t){return Boolean(this.canHaveCurrentState()&&t)},initCurrentStyle:function(){var t=function(t){return s.a.pick(t,(function(t,e){return/^current/.test(e)}))},e=t(this.currentEditStyle),i=t(this.NEW_DEFAULT_STYLE);this.canHaveCurrentState()&&s.a.values(e).length<s.a.values(i).length&&s.a.extend(this.currentEditStyle,i,e)},togglePlaceholderPopup:function(t){t&&Object(o.a)(t.target).closest(".placeholder-selector .placeholder-popup").length>0||(this.placeholder_popup_visible?this.closePlaceholderPopup():(this.anchorExitTargetMode(),this.placeholder_popup_visible=!0,this.$(".placeholder-selector").addClass("opened")))},closePlaceholderPopup:function(t){t&&Object(o.a)(t.target).closest(".placeholder-selector").length>0||(this.placeholder_popup_visible=!1,this.$(".placeholder-selector").removeClass("opened"))},clickPlaceholder:function(t){var e=Object(o.a)(t.currentTarget).attr("data-type");this.setPlaceholder(e),"back"==e&&(this.$input.val(this.backDisplayName),this.onInputChange(),this.applyLink()),"goback"==e&&(this.$input.val(this.gobackDisplayName),this.onInputChange(),this.applyLink()),"anchor"==e?(this.anchorEnterMode(),this.$input.val()||this.anchorEnterTargetMode()):this.anchorExitMode(),this.focusInputField()},setPlaceholder:function(t){var e=this.$panel.find('.search-wrapper .placeholder-selector .placeholder-item[data-type="'+t+'"]');this.$placeholder.text(this.$placeholder.attr("data-"+(t||"initial"))),this.closePlaceholderPopup(),this.$panel.find(".search-wrapper .placeholder-selector .placeholder-item").removeClass("active"),e.addClass("active")},anchorEnterMode:function(t){this.isAnchorMode||(this.$search_wrapper.addClass("anchor-mode"),this.anchorPicker=new We({$container:Object(o.a)("#main"),$after:Object(o.a)(".workspace-container:visible")}),this.anchorPicker.show()),t&&this.anchorPicker.updateY(t),this.isAnchorMode=!0},anchorExitMode:function(){this.isAnchorMode&&(this.$search_wrapper.removeClass("anchor-mode"),this.anchorPicker&&(this.anchorPicker.hide(),this.anchorPicker=null),this.isAnchorMode=!1)},anchorOnTargetClick:function(){this.$target_icon.hasClass("active")?this.anchorExitTargetMode():this.anchorEnterTargetMode()},anchorEnterTargetMode:function(){this.$target_icon.addClass("active"),this.anchorPicker.startFollowing(),this.listenToOnce(this.anchorPicker,"target-select",this.anchorOnTargetSelect),this.isAnchorTargetMode=!0},anchorExitTargetMode:function(){s.a.defer(function(){this.isAnchorTargetMode=!1}.bind(this)),this.anchorPicker&&(this.$target_icon.removeClass("active"),this.anchorPicker.stopFollowing())},anchorOnTargetSelect:function(t){var e=t.y;this.anchorExitTargetMode(),this.$input.val(e+"px"),this.applyLink()},onStylesChange:function(t,e,i){(i=i||{}).socketUpdate&&this.renderLinkStyles()},renderLinkStyles:function(){var t=this.textStyles.getStylesListSorted("link"),e="";s.a.each(t,(function(t){e+=this.style_template(t)}),this),this.$panel.find(".styles-wrapper").html(e),this.resizableScroll&&this.resizableScroll.recalc(),this.$panel.find(".styles-wrapper").sortable("refresh")},reorder:function(){var t=[];this.$(".link-style").each((function(){t.push(Object(o.a)(this).attr("data-id"))})),this.textStyles.reorder("link",t)},selectionStylesChanged:function(t){this.updateState(t)},onTargetInputChange:function(){var t=this.$target_input.prop("checked");this.block&&this.block.trigger("changeLink",{action:"change-target",target:t?"_blank":null})},updateState:function(t){var e,i=t&&t.link_nodes,n=!(!i||!i.length);if(this.$panel.toggleClass("collapsed",!n),this.anchorExitMode(),setTimeout(this.repositionPanel,400),this.closeMenu(!1),this.placeholder_popup_visible&&this.closePlaceholderPopup(),n){var a=[],r=[],l=[];if(s.a.each(i,(function(t){a.push(Object(o.a)(t).attr("data-uuid")),l.push(Object(o.a)(t).attr("target")),r.push(t.className)})),a=s.a.uniq(a),r=s.a.uniq(r),l=s.a.uniq(l),this.$target_wrapper.addClass("disabled"),a.length>1)this.$input.val(""),this.setPlaceholder("multiple");else{var c=Object(o.a)(i[0]);if(e=c.attr("data-pid")){this.setPlaceholder("page");var h=RM.constructorRouter.mag.getPageUri(e);h?this.$input.val(h):(this.$input.val(""),this.setPlaceholder("no-page"))}else{var d=c.attr("href");if(/^mailto\:/i.test(d))this.setPlaceholder("email");else if(/^tel\:/i.test(d))this.setPlaceholder("phone");else if(this.backRegexp.test(d))this.setPlaceholder("back"),d=this.backDisplayName;else if(this.gobackRegexp.test(d))this.setPlaceholder("goback"),d=this.gobackDisplayName;else if(this.mailchimpRegexp.test(d))this.setPlaceholder("mailchimp"),d=this.mailchimpDisplayName;else if(this.anchorRegexp.test(d)){this.setPlaceholder("anchor");var p=parseInt(c.attr("data-anchor-link-pos"),10)||0;d=p+"px",this.anchorEnterMode(p)}else this.setPlaceholder("url"),this.$target_wrapper.removeClass("disabled");this.$input.val(d.replace(/^mailto\:/i,"").replace(/^tel\:/i,""))}}this.onInputChange(),this.$action_icon.addClass("remove-icon"),this.$action_icon.removeClass("hidden"),this.$placeholder_icon.addClass("hidden"),this.$target_input.prop("checked",1==l.length&&"_blank"==l[0]),this.$target_input.prop("indeterminate",l.length>1),this.showActiveStyles(r)}else this.$input.val(""),this.onInputChange(),this.setPlaceholder("initial");this.toggleCurrentStateSwitch(e),this.$icon.toggleClass("highlighted",!(!i||!i.length))},onInputChange:function(){this.$action_icon.toggleClass("hidden",!this.getUrlData(this.$input.val()).result),this.$action_icon.removeClass("remove-icon"),this.$placeholder_icon.toggleClass("hidden",""!=this.$input.val())},getUrlData:function(t){var e=RM.constructorRouter.mag,i=RM.constructorRouter.me;t=o.a.trim(t);var s=this.urlRegexp.test(t),n=new RegExp("/(edit|"+i.get("uri")+")/(\\d+|"+e.get("uri")+")/(preview/)?(.*)","i"),a=t.match(n);!a||e.get("uri")!=a[2]&&e.get("num_id")!=a[2]||(t=(a[4]||"1").replace("/",""));var l=""!=t&&!!e.getPageId(t);t=t.replace(/^mailto\:/i,"");var c=r.b.isValidEmailLink(t);t=t.replace(/^tel\:/i,"");var h=this.telRegexp.test(t),d=this.backRegexp.test(t),p=this.gobackRegexp.test(t),u=this.mailchimpRegexp.test(t),g=this.anchorRegexp.test(t),m=this.shareRegexp.test(t);return s||l||c||h||u||m||(s=this.shortUrlRegexp.test(t))&&(t="http://"+t),u&&(t=this.mailchimpLink+this.getMailchimpData(t)),g&&(t=t.match(this.anchorMatcher)[1]),{result:s||l||c||h||d||p||u||g||m,isURL:s,isEmail:c,isTel:h,isValidPageNumber:l,isBack:d,isGoBack:p,isMailchimp:u,isAnchor:g,isShare:m,url:t}},getMailchimpData:function(t){var e,i=t.match(this.mailchimpMatcher);try{e=i&&i[1]&&!!JSON.parse(i[1])}catch(t){e=!1}return e?i[1]:""},inputIconClick:function(t){this.$action_icon.hasClass("remove-icon")?(this.removeLink(),this.anchorExitMode()):this.applyLink()},onInputKey:function(t){var e=this.block&&this.block.cur_selection_styles&&this.block.cur_selection_styles.link_nodes;t.keyCode==o.a.keycodes.enter&&this.applyLink(),t.keyCode==o.a.keycodes.del&&""==this.$input.val()&&e&&e.length&&this.removeLink()},applyLink:function(){var t,e,i=this.$input.val(),n=this.getUrlData(i);if(n.result){n.isEmail&&(n.url="mailto:"+n.url),n.isTel&&(n.url="tel:"+n.url),n.isBack&&(n.url=this.backLink),n.isGoBack&&(n.url=this.gobackLink),n.isAnchor&&(t=n.url,n.url=this.anchorLink);var a=this.block&&this.block.cur_selection_styles&&this.block.cur_selection_styles.link_nodes,r="link-1",l=n.isURL?"_blank":null;a.length&&(r=a[0].className,r=/^link\-/.test(r)?r:null,n.isURL&&(l="_blank"==(l=Object(o.a)(a[0]).attr("target"))?l:null)),this.block&&(e={action:"create",url:n.url,class:r,target:l},t&&s.a.extend(e,{anchor_pos:t,clickPage:this.blocks[0].workspace.page.id}),this.block.trigger("changeLink",e))}},removeLink:function(){this.block&&this.block.trigger("changeLink",{action:"remove"})},focusInputField:function(){this.$panel.find(".search-wrapper input").focus()},showActiveStyles:function(t){if(this.selected&&t){var e={},i={};this.$(".link-style.active").each((function(){e[Object(o.a)(this).attr("data-id")]=!0})),this.closeMenu(!0),this.$(".link-style").removeClass("active");for(var n=0;n<t.length;n++)this.$('.link-style[data-id="'+t[n]+'"]').addClass("active");if(this.$(".link-style.active").each((function(){i[Object(o.a)(this).attr("data-id")]=!0})),!s.a.isEqual(e,i)){var a=this.$(".link-style.active").first();if(a.length){var r,l=this.$panel.find(".resizable-content-wrapper"),c=a.position().top,h=l.height(),d=a.outerHeight();c+d-l.scrollTop()>h-0?r=c+d-h+0:c-l.scrollTop()<0&&(r=c-0),null!=r&&l.stop().animate({scrollTop:r},200)}}}},onLinkStyleClick:function(t){if(!Object(o.a)(t.target).closest(".menu-button").length){var e=Object(o.a)(t.target).closest(".link-style").attr("data-id");this.block&&this.block.trigger("changeLink",{action:"change-class",class:e})}},toggleMenu:function(t){var e=Object(o.a)(t.currentTarget),i=e.hasClass("active"),n=this.$(".style-menu");i?this.closeMenu(!0):(this.$(".link-style .menu-button.active").length>0&&this.closeMenu(!1),setTimeout(s.a.bind((function(){var t=e.closest(".link-style"),i=this.$(".resizable-scroll-wrapper").position().top+t.position().top+e.position().top-this.$panel.find(".resizable-content-wrapper").scrollTop(),s=e.height(),a=i+7,r=Math.max(Object(o.a)(window).height(),304)-10;n.css("top",a).addClass("shown").addClass("shift-bottom").removeClass("shift-left").attr("data-id",t.attr("data-id"));var l=n.offset().top+n.height();if(l+8>r){var c=l-r,h=s/2+7,d=h+n.height()-s;c=Math.min(Math.max(c,h+4),d-8);n.css("top",a-c).addClass("shift-left").removeClass("shift-bottom").find(".corner-wrapper").css("top",c-h+4),e.addClass("shift-left")}else e.removeClass("shift-left");e.addClass("active")}),this),40))},closeMenu:function(t){var e=this.$(".style-menu");t||e.removeClass("transition-enable"),e.removeClass("shown"),t||setTimeout((function(){e.addClass("transition-enable")}),20),this.$(".link-style .menu-button").removeClass("active")},onPanelScroll:function(t){this.closeMenu(!0)},onDuplicateClick:function(t){var e=Object(o.a)(t.currentTarget).closest(".style-menu").attr("data-id"),i=this.textStyles.duplicateStyle("link",e),n=this.$('.link-style[data-id="'+e+'"]');if(i){RM.constructorRouter.textStyles.generateCSS("link","editor",this.block.iframe_document),RM.constructorRouter.textStyles.generateCSS("link","constructor",document),this.block.somethingChangedInEditor("styleAdded");var a=Object(o.a)(this.style_template(i));a.addClass("enable-transition").css("margin-top",-n.outerHeight()),a.insertAfter(n),setTimeout(s.a.bind((function(){a.css("margin-top",0),setTimeout(s.a.bind((function(){a.removeClass("enable-transition"),this.$panel.find(".styles-wrapper").sortable("refresh"),this.resizableScroll&&this.resizableScroll.recalc()}),this),270)}),this),50)}},onDeleteClick:function(t){var e=Object(o.a)(t.currentTarget).closest(".style-menu").attr("data-id"),i=this.$('.link-style[data-id="'+e+'"]');this.closeMenu(!0),i.addClass("enable-transition"),setTimeout(s.a.bind((function(){i.addClass("shift-left"),setTimeout(s.a.bind((function(){i.css("margin-top",-i.outerHeight()),setTimeout(s.a.bind((function(){i.remove(),this.$panel.find(".styles-wrapper").sortable("refresh"),this.resizableScroll&&this.resizableScroll.recalc(),RM.constructorRouter.textStyles.deleteStyle("link",e),RM.constructorRouter.textStyles.generateCSS("link","editor",this.block.iframe_document),RM.constructorRouter.textStyles.generateCSS("link","constructor",document),this.block.somethingChangedInEditor("styleDeleted")}),this),270)}),this),270)}),this),50)},addClick:function(t){var e=this.textStyles.addStyle("link",this.NEW_DEFAULT_STYLE);RM.constructorRouter.textStyles.generateCSS("link","editor",this.block.iframe_document),RM.constructorRouter.textStyles.generateCSS("link","constructor",document),this.block.somethingChangedInEditor("styleAdded");var i=Object(o.a)(this.style_template(e));i.addClass("enable-transition").addClass("collapsed"),this.$panel.find(".styles-wrapper").append(i),this.$el.find(".resizable-content-wrapper").scrollTop(9999),setTimeout(s.a.bind((function(){i.removeClass("collapsed"),setTimeout(s.a.bind((function(){i.removeClass("enable-transition"),this.$panel.find(".styles-wrapper").sortable("refresh"),this.resizableScroll&&this.resizableScroll.recalc()}),this),270)}),this),50)},refreshEditorCss:function(){var t=("hover"===this.currentStyleEditMode||"current"===this.currentStyleEditMode)&&this.currentStyleEditMode,e={forcePseudoState:t,forcePseudoClass:!!t&&this.getEditValue("_name")};RM.constructorRouter.textStyles.generateCSS("link","editor",this.block.iframe_document,e),this.block.somethingChangedInEditor("styleChanging")},onEditClick:function(t){var e={dblclick:function(t){return Object(o.a)(t.currentTarget).closest(".link-style")},click:function(){return Object(o.a)(t.currentTarget).closest(".style-menu")}}[t.type](t),i=Object(o.a)(t.currentTarget).closest(e).attr("data-id"),n=this.textStyles.findStyle("link",i);this.originalEditStyle=s.a.clone(n),this.currentEditStyle=n,this.initCurrentStyle(),this.setEditParams(),this.switchState("default"),this.$panel.addClass("toggle-opaque"),this.closeMenu(!0),setTimeout(s.a.bind((function(){this.$panel.addClass("show-style-edit")}),this),300)},editClose:function(){this.closeAllEditPopups(),RM.constructorRouter.textStyles.generateCSS("link","editor",this.block.iframe_document),RM.constructorRouter.textStyles.generateCSS("link","constructor",document),this.resizableScroll&&this.resizableScroll.recalc(),this.block.somethingChangedInEditor("styleChanged"),this.$panel.removeClass("show-style-edit"),setTimeout(s.a.bind((function(){this.$panel.removeClass("toggle-opaque")}),this),400)},isInState:function(t){return this.$panel.find(".edit-wrapper").hasClass(t+"-state")},onStateSwitchClick:function(t){this.colorbox_visible||this.underline_style_visible||(Object(o.a)(t.currentTarget).hasClass("caption-default")&&this.switchState("default"),Object(o.a)(t.currentTarget).hasClass("caption-hover")&&this.switchState("hover"),Object(o.a)(t.currentTarget).hasClass("caption-current")&&this.switchState("current"))},switchState:function(t){var e=this.$panel.find(".edit-wrapper");e.removeClass("hover-state default-state current-state"),e.addClass(t+"-state"),"hover"!==t&&"current"!==t||this.setEditParams(),this.currentStyleEditMode=t,this.refreshEditorCssDebounced()},getEditValue:function(t){if(this.currentEditStyle){var e=s.a.isUndefined(this.currentEditStyle[t])&&/^current/.test(t)?this.NEW_DEFAULT_STYLE[t]:this.currentEditStyle[t];return"inherit"==e&&(e=this.currentEditStyle[t.replace(/^(hover|current)\-/,"")]),e}},setEditParams:function(){var t=this.$panel.find(".edit-wrapper");t.find('.edit-item[data-field="_caption"] input').val(this.getEditValue("_caption")),t.find('.edit-item[data-field="u-style"] .underline-style').attr("data-type",this.getEditValue("u-style")),t.find('.edit-item[data-field="hover-u-style"] .underline-style').attr("data-type",this.getEditValue("hover-u-style")),t.find('.edit-item[data-field="current-u-style"] .underline-style').attr("data-type",this.getEditValue("current-u-style")),t.find('.edit-item[data-field="color"] .color-circle').css({background:"#"+this.getEditValue("color"),opacity:this.getEditValue("opacity")/100}),t.find('.edit-item[data-field="u-color"] .color-circle').css({background:"#"+this.getEditValue("u-color"),opacity:this.getEditValue("u-opacity")/100}),t.find('.edit-item[data-field="hover-color"] .color-circle').css({background:"#"+this.getEditValue("hover-color"),opacity:this.getEditValue("hover-opacity")/100}),t.find('.edit-item[data-field="current-color"] .color-circle').css({background:"#"+this.getEditValue("current-color"),opacity:this.getEditValue("current-opacity")/100}),t.find('.edit-item[data-field="hover-u-color"] .color-circle').css({background:"#"+this.getEditValue("hover-u-color"),opacity:this.getEditValue("hover-u-opacity")/100}),t.find('.edit-item[data-field="current-u-color"] .color-circle').css({background:"#"+this.getEditValue("current-u-color"),opacity:this.getEditValue("current-u-opacity")/100}),this.editUnderlineWidthChangeValue(this.getEditValue("u-size"),!0),this.editPaddingChangeValue(this.getEditValue("u-offset"),!0),this.editHoverUnderlineWidthChangeValue(this.getEditValue("hover-u-size"),!0),this.editHoverPaddingChangeValue(this.getEditValue("hover-u-offset"),!0),this.editCurrentUnderlineWidthChangeValue(this.getEditValue("current-u-size"),!0),this.editCurrentPaddingChangeValue(this.getEditValue("current-u-offset"),!0),this.fixInputsPadding(),this.checkNoUnderline()},fixInputsPadding:function(){for(var t=["u-size","u-offset","hover-u-size","hover-u-offset","current-u-size","current-u-offset"],e=0;e<t.length;e++){var i=this.$panel.find('.edit-wrapper .edit-item[data-field="'+t[e]+'"] input');i.toggleClass("padding-for-one",Math.abs(i.val())%10==1)}},onEditCaptionChange:function(t){this.currentEditStyle._caption=Object(o.a)(t.target).val()},onEditInputChanged:function(t,e){this.currentEditStyle[t.closest(".edit-item").attr("data-field")]=e,this.fixInputsPadding(),this.refreshEditorCssDebounced()},onColorboxShowClick:function(t){var e=Object(o.a)(t.currentTarget),i=e.attr("data-field"),s=e.attr("data-field-dop"),n=200;if(this.colorbox_visible){if(i==this.colorbox_for_field)return void this.closeColorBox();this.closeColorBox(!0),n=0}this.closeAllEditPopups(),this.colorbox_visible=!0,this.$(".colorbox_container").fadeIn(n),this.colorbox_for_field=i,this.colorbox_for_field_dop=s,this.synchonizeColors="color"==i&&this.getEditValue("color")==this.getEditValue("u-color")&&this.getEditValue("opacity")==this.getEditValue("u-opacity"),this.colorbox.setOpacity(this.getEditValue(s)/100),this.colorbox.setColor(this.getEditValue(i))},colorOpacityChanged:function(t,e,i,s){this.currentEditStyle[this.colorbox_for_field]=this.colorbox&&this.colorbox.rgb2hex([t,e,i]),this.currentEditStyle[this.colorbox_for_field_dop]=100*s,this.synchonizeColors&&(this.currentEditStyle["u-color"]=this.colorbox&&this.colorbox.rgb2hex([t,e,i]),this.currentEditStyle["u-opacity"]=100*s),this.setEditParams(),this.refreshEditorCssDebounced()},onUnderlineStyleShowClick:function(t){if(this.underline_style_visible)this.closeUnderlineStyle();else{this.closeAllEditPopups(),this.underline_style_visible=!0,this.$(".underline_style_container").fadeIn(200);var e=Object(o.a)(t.currentTarget).attr("data-field");this.underline_style_for_field=e,this.$('.underline_style_container .underline-style-item[data-type="'+this.getEditValue(e)+'"]').addClass("active").siblings(".underline-style-item").removeClass("active")}},underlineStyleChanged:function(t){this.currentEditStyle[this.underline_style_for_field]=Object(o.a)(t.currentTarget).attr("data-type"),this.setEditParams(),this.checkNoUnderline(),this.refreshEditorCssDebounced(),this.closeUnderlineStyle()},checkNoUnderline:function(){for(var t=["u-style","hover-u-style","current-u-style"],e=0;e<t.length;e++){var i=this.getEditValue(t[e]);this.$panel.find('.edit-wrapper .edit-item[data-field="'+t[e]+'"]').closest(".params-block").toggleClass("no-underline","none"==i)}},closeColorBox:function(t){this.colorbox_visible=!1,this.$(".colorbox_container").fadeOut(t?0:200)},closeUnderlineStyle:function(){this.underline_style_visible=!1,this.$(".underline_style_container").fadeOut(200)},closeAllEditPopups:function(t){if(t){if(Object(o.a)(t.target).closest(".colorbox_container").length>0)return;if(Object(o.a)(t.target).closest(".color-click-area").length>0)return;if(Object(o.a)(t.target).closest(".underline_style_container").length>0)return;if(Object(o.a)(t.target).closest(".underline-style-click-area").length>0)return}this.colorbox_visible&&this.closeColorBox(),this.underline_style_visible&&this.closeUnderlineStyle()},saveEditClick:function(){this.$('.link-style[data-id="'+this.getEditValue("_name")+'"]').find(".style-caption").text(this.getEditValue("_caption")),this.textStyles.changeStyle("link",this.getEditValue("_name")),this.editClose()},cancelEditClick:function(){this.textStyles.restoreStyle("link",this.getEditValue("_name"),this.originalEditStyle),this.editClose()},save:function(){s.a.isEqual(this.textStyles.getOrder("link"),this.textStyles.orderBefore.link)||this.textStyles.save()},deselect:function(){this.closeAllEditPopups(),this.placeholder_popup_visible&&this.closePlaceholderPopup(),this.anchorExitMode(),h.prototype.deselect.apply(this,arguments)},destroy:function(){this.$panel.hasClass("show-style-edit")&&this.saveEditClick(),this.anchorExitMode(),this.save(),h.prototype.destroy.apply(this,arguments)},select:function(){h.prototype.select.apply(this,arguments),this.block&&this.selectionStylesChanged(this.block.cur_selection_styles),this.resizableScroll&&this.resizableScroll.recalc(),this.repositionPanel(),Object(c.a)("controls-text_link")},onClick:function(){if(this.selected){if(this.colorbox_visible||this.underline_style_visible)return void this.closeAllEditPopups();if(this.$(".style-menu").hasClass("shown"))return void this.closeMenu(!0);if(this.placeholder_popup_visible)return void this.closePlaceholderPopup()}h.prototype.onClick.apply(this,arguments)},onEscKey:function(){if(this.selected){if(this.colorbox_visible||this.underline_style_visible)return void this.closeAllEditPopups();if(this.$(".style-menu").hasClass("shown"))return void this.closeMenu(!0);if(this.placeholder_popup_visible)return void this.closePlaceholderPopup();if(this.isAnchorTargetMode)return void this.anchorExitTargetMode()}h.prototype.onEscKey.apply(this,arguments)},canControlBeClosed:function(){return this.colorbox_visible||this.underline_style_visible?(this.closeAllEditPopups(),!0):this.$(".style-menu").hasClass("shown")?(this.closeMenu(!0),!0):this.placeholder_popup_visible?(this.closePlaceholderPopup(),!0):!!this.isAnchorTargetMode||h.prototype.canControlBeClosed.apply(this,arguments)}}),Ke=i("s1Hx"),Ye=i.n(Ke),Ze=h.extend({name:"text_color",className:"control text_color",initialize:function(t){this.template=Ye.a["template-constructor-control-text_color"],this.initControl(t)},bindLogic:function(){this.colorbox=new Pe.a({$parent:this.$panel,type:"small"}),this.colorbox.on("colorchange",this.colorChanged),this.colorbox.on("opacitychange",this.colorChanged),this.blocks&&this.blocks[0].on("selection_styles_changed",this.selectionStylesChanged),this.blocks&&this.selectionStylesChanged(this.blocks[0].cur_selection_styles)},unBindLogic:function(){this.colorbox&&this.colorbox.off("colorchange",this.colorChanged),this.colorbox&&this.colorbox.off("opacitychange",this.colorChanged),this.colorbox&&this.colorbox.destroy(),this.blocks&&this.blocks[0].off("selection_styles_changed",this.selectionStylesChanged)},selectionStylesChanged:function(t){if(this.blocks&&this.blocks[0].initiatorControl!=this.name){var e=t.color,i=t.opacity;if(e==this.blocks[0].params.multipleName){if(!(this.blocks[0].cur_selection_styles_all.length>0))return;e=this.blocks[0].cur_selection_styles_all[0].color}if(i==this.blocks[0].params.multipleName){if(!(this.blocks[0].cur_selection_styles_all.length>0))return;i=this.blocks[0].cur_selection_styles_all[0].opacity}this.updateIconState(e,i/100),this.updateColorboxState(e,i/100)}},updateIconState:function(t,e){t&&e&&this.$icon&&this.$icon.find(".color-circle").css({background:"#"+t,opacity:e})},updateColorboxState:function(t,e){t&&null!=e&&this.colorbox&&(this.colorbox.setOpacity(e),this.colorbox.setColor(t))},colorChanged:function(t,e,i,s){var o="";o=s>.99?"rgb("+t+","+e+","+i+")":"rgba("+t+","+e+","+i+", "+s+")";var n=this.colorbox&&this.colorbox.rgb2hex([t,e,i]);this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",{color:o},{color:n,opacity:100*s})),this.updateIconState(n,s)}}),Je=i("DA8H"),Qe=i.n(Je),ti=h.extend({name:"text_columns",className:"control text_columns",MAX_COLUMN_COUNT:12,initialize:function(t){this.template=Qe.a["template-constructor-control-text_columns"],this.initControl(t)},select:function(){h.prototype.select.apply(this,arguments),Object(c.a)("controls-text_columns")},bindLogic:function(){this.$panel.on("click",".substract",this.substract),this.$panel.on("click",".add",this.add),this.$panel.on("click",".bg-color",this.toggleColorbox),this.$panel.on("click",this.closeColorBox),Object(o.a)(this.$(this.$panel.find(".gap"))).RMNumericInput({min:0,max:999,mouseDir:"h",mouseSpeed:1,onChange:this.onGapChanged}),this.colorbox=new Pe.a({$parent:this.$(".colorbox_container"),type:"small"}),this.colorbox.on("colorchange",this.colorChanged),this.colorbox.on("opacitychange",this.opacityChanged),this.blocks&&this.updateState({column_count:this.blocks[0].model.get("column_count"),column_gap:this.blocks[0].model.get("column_gap"),bg_color:this.blocks[0].model.get("bg_color"),bg_opacity:this.blocks[0].model.get("bg_opacity")})},unBindLogic:function(){this.$panel.off("click",".substract",this.substract),this.$panel.off("click",".add",this.add),this.$panel.off("click",".bg-color",this.toggleColorbox),this.$panel.off("click",this.closeColorBox),this.colorbox&&this.colorbox.off("colorchange",this.colorChanged),this.colorbox&&this.colorbox.off("opacitychange",this.opacityChanged),this.colorbox&&this.colorbox.destroy()},updateState:function(t){null!=t.column_count&&(this.$panel.find(".number").text(t.column_count),this.$panel.toggleClass("one-column",1==t.column_count),t.column_count>1?this.$panel.find(".gap, .grid").css("display","block"):setTimeout(s.a.bind((function(){this.$panel.find(".gap, .grid").css("display","none")}),this),500)),null!=t.column_gap&&this.$panel.find(".gap").val(t.column_gap),null!=t.bg_color&&null!=t.bg_opacity&&this.$(".bg-color .color").css({"background-color":"#"+t.bg_color,opacity:t.bg_opacity})},substract:function(t){var e=this.$panel.find(".number").text()-0;if(1!=e){--e<1&&(e=1);var i={column_count:e};this.updateState(i),this.blocks&&this.blocks[0].trigger("changeColumns",i)}},add:function(t){var e=this.$panel.find(".number").text()-0;if(e!=this.MAX_COLUMN_COUNT){++e>this.MAX_COLUMN_COUNT&&(e=this.MAX_COLUMN_COUNT);var i={column_count:e};this.updateState(i),this.blocks&&this.blocks[0].trigger("changeColumns",i)}},onGapChanged:function(t,e){var i={column_gap:e};this.updateState(i),this.blocks&&this.blocks[0].trigger("changeColumns",i)},toggleColorbox:function(t){this.colorbox_visible?this.closeColorBox():(this.colorbox_visible=!0,this.$(".colorbox_container").fadeIn(200),this.colorbox.setOpacity(this.blocks[0].model.get("bg_opacity")),this.colorbox.setColor(this.blocks[0].model.get("bg_color")))},closeColorBox:function(t){if(t){if(Object(o.a)(t.target).closest(".colorbox_container").length>0)return;if(Object(o.a)(t.target).closest(".bg-color").length>0)return}this.colorbox_visible=!1,this.$(".colorbox_container").fadeOut(200)},colorChanged:function(t,e,i,s){"ffffff"!=this.blocks[0].model.get("bg_color")||0!=this.blocks[0].model.get("bg_opacity")||this.firstColorChange||(this.firstColorChange=!0,this.colorbox.setOpacity(1,!0),s=1),this.colorOpacityChanged(t,e,i,s)},opacityChanged:function(t,e,i,s){this.colorOpacityChanged(t,e,i,s)},colorOpacityChanged:function(t,e,i,s){var o={bg_color:this.colorbox&&this.colorbox.rgb2hex([t,e,i]),bg_opacity:s};this.updateState(o),this.blocks&&this.blocks[0].trigger("changeColumns",o)},deselect:function(){this.colorbox_visible&&this.closeColorBox(),h.prototype.deselect.apply(this,arguments)},onClick:function(){this.selected&&this.colorbox_visible?this.closeColorBox():h.prototype.onClick.apply(this,arguments)},onEscKey:function(){this.selected&&this.colorbox_visible?this.closeColorBox():h.prototype.onEscKey.apply(this,arguments)},canControlBeClosed:function(){return this.colorbox_visible?(this.closeColorBox(),!0):h.prototype.canControlBeClosed.apply(this,arguments)}}),ei=i("oRHT"),ii=i.n(ei),si=h.extend({name:"text_edit",className:"control text_edit",initialize:function(t){this.template=ii.a["template-constructor-control-text_edit"],this.initControl(t)},select:function(){h.prototype.select.apply(this,arguments),Object(c.a)("controls-text_edit"),s.a.defer(function(){this.blocks&&this.blocks[0].enterEditMode()}.bind(this))}}),oi=i("NEuE"),ni=i.n(oi),ai=h.prototype,ri=h.extend({name:"picture_crop",className:"control picture_crop",events:{"click .equilateral":"equilateral","click .fill":"fill","click .fit":"fit","click .x1":"x1","click .scale":"setScale"},scaleParams:{min:.01,max:5},HANDLER_SIZE:26,initialize:function(t){this.template=ni.a["template-constructor-control-picture_crop"],this.initControl(t),this.block=this.blocks[0],this.block.model.get("picture")||this.$el.hide(),this.onFullWidthChange(),this.onFullHeightChange()},onClick:function(){this.block.$picture&&(this.$el.hasClass("inactive")||ai.onClick.apply(this,arguments))},render:function(){ai.render.apply(this,arguments),this.initScale(),this.onScaleChange(),this.block.has_parent_block&&this.$el.addClass("hide-all-except-scale"),this.$equilateral=this.$(".equilateral")},select:function(){this.block.enterCropMode(),this.$el.removeClass("fade"),this.$handler.css("top",this.toScale(this.block.model.get("scale"))),this.$helper.text(Math.floor(100*this.block.model.get("scale"))+"%")},deselect:function(){this.block.leaveCropMode(),ai.deselect.apply(this,arguments)},toggleEnabled:function(t,e){clearTimeout(this.cancelLoadingTimeout),t&&e?this.block.originalLoaded||this.$el.addClass("loading"):(this.$el.addClass("checked"),this.$icon.addClass("rmalttext-disable"),this.cancelLoadingTimeout=setTimeout(s.a.bind((function(){this.$el.removeClass("loading")}),this),200),t&&ai.select.apply(this,arguments))},onPictureLoaded:function(){this.$el.show()},bindLogic:function(){this.block.model.on("change:scale",this.onScaleChange),this.block.model.on("change:w change:h",this.onSizeChange),this.block.model.on("change:is_full_width",this.onFullWidthChange),this.block.model.on("change:is_full_height",this.onFullHeightChange),this.block.on("picture_added",this.onPictureLoaded),this.$scale=this.$panel.find(".scale"),this.$handler=this.$panel.find(".handler"),this.$helper=this.$panel.find(".helper"),this.$handler.on("dragstart",this.onScaleStart),this.$handler.on("drag",this.onScale),this.$handler.on("dragend",this.onScaleStop),this.block.on("crop_click",this.onClick),this.block.on("transitionmode",this.toggleEnabled)},unBindLogic:function(){this.block.off("transitionmode",this.toggleEnabled),this.block.off("crop_click",this.onClick),this.$handler&&(this.$handler.off("dragstart",this.onScaleStart),this.$handler.off("drag",this.onScale),this.$handler.off("dragend",this.onScaleStop),this.block.model.off("change:scale",this.onScaleChange),this.block.model.off("change:w change:h",this.onSizeChange),this.block.model.off("change:is_full_width",this.onFullWidthChange),this.block.model.off("change:is_full_height",this.onFullHeightChange),this.block.off("picture_added",this.onPictureLoaded))},equilateral:function(){if(!this.$equilateral.hasClass("fade")){var t=this.block.getBoxData();if(t.w>t.h){var e={width:t.h,height:t.h,left:t.x+(t.w-t.h)/2,top:t.y};this.block.frame.doResize(e),this.block.onCropResize(e),this.block.onResizeEnd()}else{e={width:t.w,height:t.w,top:t.y+(t.h-t.w)/2,left:t.x};this.block.frame.doResize(e),this.block.onCropResize(e),this.block.onResizeEnd()}this.$equilateral.addClass("fade")}},fill:function(){this.block.fill()},fit:function(){this.block.fit()},x1:function(){this.$(".x1").hasClass("fade")||this.block.rescale(1,{smooth:!0})},onScaleStart:function(t,e){e.offset=parseInt(this.$handler.css("top")),this.$handler.addClass("dragging")},onScale:function(t,e){var i=e.deltaY+e.offset,s=this.fromScale(i).toFixed(2);s<this.scaleParams.min&&(s=this.scaleParams.min),s>this.scaleParams.max&&(s=this.scaleParams.max),this.block.rescale(s)},onScaleChange:function(t,e,i){var s=i&&i.smooth?"animate":"css";this.$handler[s]({top:this.toScale(e)}),this.$helper.text(Math.floor(100*e)+"%"),this.$(".x1").toggleClass("fade",Math.abs(this.block.model.get("scale")-1)<.01)},onSizeChange:function(t,e,i){t.get("w")!=t.get("h")&&this.$equilateral.hasClass("fade")&&this.$equilateral.removeClass("fade")},onScaleStop:function(){this.$handler.removeClass("dragging")},setScale:function(t){if(!Object(o.a)(t.target).closest(".handler").length){var e=t.pageY-Object(o.a)(t.target).offset().top-this.HANDLER_SIZE/2;this.block.rescale(this.fromScale(e).toFixed(2),{smooth:!0})}},initScale:function(){this._scaleHeight=parseInt(this.$scale.css("height"))-parseInt(this.$handler.css("height"))-4;var t=this.scaleParams.min,e=this.scaleParams.max,i=this._scaleHeight,o=Math.floor(this._scaleHeight/2),n=(1-t)*i/((e-1)*i/o-e+t),a=(e-1)*(n/o+1)*n,r=e-a/n;s.a.extend(this.scaleParams,{a:r,b:a,c:n})},toScale:function(t){(t-=0)>this.scaleParams.max&&(this.scaleParams.max=t,this.initScale());var e=this.scaleParams.a;return this.scaleParams.b/(t-e)-this.scaleParams.c},fromScale:function(t){return t<0?this.scaleParams.max:this.scaleParams.a+this.scaleParams.b/(this.scaleParams.c+t)},restrictions:function(t){var e=t.getSelectedBlocks();return!(1==e.length&&(e[0].isPictureEmpty&&e[0].isPictureEmpty()||e[0].isFullWidth()||e[0].isFullHeight()))},onEnterKey:function(){this.selected&&this.master.deselect()},onFullWidthChange:function(){this.$el.toggleClass("inactive",!!this.block.model.get("is_full_width"))},onFullHeightChange:function(){this.$el.toggleClass("inactive",!!this.block.model.get("is_full_height"))}}),li=i("5jX/"),ci=i.n(li),hi=h.prototype,di=h.extend({name:"picture_fwpos",className:"control picture_fwpos",initialize:function(t){this.template=ci.a["template-constructor-control-picture_fwpos"],this.initControl(t),this.block=this.blocks[0],this.block.model.get("picture")||this.$el.hide()},onClick:function(){this.block.$picture&&(this.$el.hasClass("inactive")||hi.onClick.apply(this,arguments))},select:function(){this.block.enterFWPosMode(),this.$el.addClass("active"),hi.select.apply(this,arguments)},deselect:function(){this.block.leaveFWPosMode(),this.$el.removeClass("active"),hi.deselect.apply(this,arguments)},onPictureLoaded:function(){this.$el.show()},bindLogic:function(){this.block.on("picture_added",this.onPictureLoaded),this.block.on("fwpos_click",this.onClick)},unBindLogic:function(){this.block.off("crop_click",this.onClick),this.block.off("picture_added",this.onPictureLoaded)},restrictions:function(t){var e=t.getSelectedBlocks();return 1==e.length&&!(e[0].isPictureEmpty&&e[0].isPictureEmpty())&&(e[0].isFullWidth()||e[0].isFullHeight())},onEnterKey:function(){this.selected&&this.master.deselect()}}),pi=Xe.extend({name:"picture_link",className:"control picture_link",saveOnDestroy:!1,bindLogicSpecific:function(){this.listenTo(this.blocks[0].model,"change:clickLink change:clickTarget",this.updateState),this.updateState()},unBindLogicSpecific:function(){this.stopListening(this.model)},onTargetInputChange:function(){var t=this.$target_input.prop("checked");this.models[0].save({clickTarget:t?"_blank":"_self"})},updateState:function(t){var e=this.models[0].get("clickLink"),i=this.models[0].get("clickTarget");if(this.$panel.toggleClass("collapsed",!e),this.placeholder_popup_visible&&this.closePlaceholderPopup(),e){if(this.$target_wrapper.addClass("disabled"),/^mailto\:/i.test(e)?this.setPlaceholder("email"):/^tel\:/i.test(e)?this.setPlaceholder("phone"):this.backRegexp.test(e)?this.setPlaceholder("back"):this.gobackRegexp.test(e)?this.setPlaceholder("goback"):this.mailchimpRegexp.test(e)?this.setPlaceholder("mailchimp"):this.anchorRegexp.test(e)?this.setPlaceholder("anchor"):(this.setPlaceholder("url"),this.$target_wrapper.removeClass("disabled")),e=(e=e.replace(/^mailto\:/i,"")).replace(/^tel\:/i,""),this.urlRegexp.test(e)||this.shortUrlRegexp.test(e)||r.b.isValidEmailLink(e)||this.telRegexp.test(e))this.$input.val(e);else if(this.backRegexp.test(e))this.setPlaceholder("back"),this.$input.val(this.backDisplayName);else if(this.gobackRegexp.test(e))this.setPlaceholder("goback"),this.$input.val(this.gobackDisplayName);else if(this.mailchimpRegexp.test(e))this.$input.val(this.mailchimpDisplayName);else if(this.anchorRegexp.test(e)){var s=this.models[0].get("anchor_link_pos")||0;this.anchorEnterMode(s),this.$input.val(s+"px")}else{this.setPlaceholder("page"),this.$target_wrapper.addClass("disabled");var o=RM.constructorRouter.mag.getPageUri(e);o?this.$input.val(o):(this.$input.val(""),this.setPlaceholder("no-page"))}this.onInputChange(),this.$action_icon.addClass("remove-icon"),this.$action_icon.removeClass("hidden"),this.$placeholder_icon.addClass("hidden"),this.$target_input.prop("checked","_blank"==i)}else this.$input.val(""),this.onInputChange(),this.setPlaceholder("initial");this.$icon.toggleClass("highlighted",!!e)},onInputKey:function(t){t.keyCode==o.a.keycodes.enter&&this.applyLink(),t.keyCode==o.a.keycodes.del&&""==this.$input.val()&&this.models[0].get("clickLink")&&this.removeLink()},applyLink:function(){var t=this.$input.val(),e={},i=this.getUrlData(t);if(i.result){i.isEmail&&(i.url="mailto:"+i.url),i.isTel&&(i.url="tel:"+i.url),i.isBack&&(i.url=this.backLink),i.isGoBack&&(i.url=this.gobackLink),i.isAnchor?(e.anchor_link_pos=parseInt(i.url,10)||0,i.url=this.anchorLink,i.page=this.blocks[0].workspace.page.id):this.anchorExitMode(),i.isValidPageNumber&&(i.url=RM.constructorRouter.mag.getPageId(i.url));var n=i.isURL?"_blank":"_self";s.a.extend(e,{clickLink:i.url,clickTarget:n}),i.page&&(e.clickPage=i.page),this.models[0].save(e),this.updateState(),Object(o.a)("#main").focus()}},removeLink:function(){this.models[0].unset("clickLink"),this.models[0].unset("clickTarget"),this.models[0].save(),this.updateState()},restrictions:function(t){var e=t.getSelectedBlocks();return 1!=e.length||"Picture"!=e[0].name||!e[0].isPictureEmpty()},save:function(){},destroy:function(){this.anchorExitMode(),h.prototype.destroy.apply(this,arguments)},select:function(){if(h.prototype.select.apply(this,arguments),this.isPreviewEnabled())return this.$panel.addClass("show-picture-preview-error");this.$panel.removeClass("show-picture-preview-error"),Object(c.a)("controls-text_link")},isPreviewEnabled:function(){return!!this.model.get("preview_enabled")}}),ui=i("EYyZ"),gi=i.n(ui),mi=h.extend({name:"picture_1x1",className:"control picture_1x1",initialize:function(t){this.template=gi.a["template-constructor-control-picture_1x1"],this.initControl(t),this.block=this.blocks[0],this.block.on("picture_added",(function(){this.$el.show()}),this),this.block.model.get("picture")||this.$el.hide(),this.onScaleChange.__debounced=s.a.debounce(this.onScaleChange,100),this.block.model.on("change",this.onScaleChange.__debounced),this.block.on("modechanged",this.onScaleChange),this.onScaleChange(),this.$el.hover(s.a.bind((function(){this.$el.hasClass("inactive-all")||(this.$(".icon1x2").addClass("visible"),clearTimeout(this.hoverTimeout))}),this),s.a.bind((function(){clearTimeout(this.hoverTimeout),this.hoverTimeout=setTimeout(s.a.bind((function(){this.$(".icon1x2").removeClass("visible")}),this),200)}),this)),this.$el.on("click",".icon1x2",s.a.bind(this.on1x2Click,this))},onClick:function(){this.saving||this.block.$picture&&(this.$el.hasClass("inactive")||this.$el.hasClass("inactive-all")||(this.block.cropmode&&this.block.leaveCropMode(!0),this.saving=!0,this.block.model.once("sync",(function(){delete this.saving}),this),this.master.deselect(),this.block.setActualScale(),RM.analytics&&RM.analytics.sendEvent("Picture Scale","actual size")))},on1x2Click:function(){this.saving||this.block.$picture&&(this.$el.hasClass("inactive1x2")||(this.block.cropmode&&this.block.leaveCropMode(!0),this.saving=!0,this.block.model.once("sync",(function(){delete this.saving}),this),this.master.deselect(),this.block.setActualScale({retina:!0}),RM.analytics&&RM.analytics.sendEvent("Picture Scale","half size")))},onScaleChange:function(){var t=0==this.block.model.get("cropX")&&0==this.block.model.get("cropY")&&this.block.model.get("cropW")==this.block.model.get("originalW")&&this.block.model.get("cropH")==this.block.model.get("originalH"),e=Math.abs(this.block.model.get("scale")-1)<.01&&t,i=Math.abs(this.block.model.get("scale")-.5)<.01&&t;e?this.$el.addClass("inactive"):this.$el.removeClass("inactive"),i?this.$el.addClass("inactive1x2"):this.$el.removeClass("inactive1x2")},fade:function(){this.$el.addClass("fade")},unfade:function(){this.$el.removeClass("fade")},restrictions:function(t){var e=t.getSelectedBlocks();return!(1==e.length&&(e[0].isPictureEmpty&&e[0].isPictureEmpty()||e[0].isFullWidth()||e[0].isFullHeight()))},unBindLogic:function(){this.block.model.off("change",this.onScaleChange.__debounced,this),this.block.off("modechanged",this.onScaleChange)}}),fi=i("btdP"),vi=i.n(fi),bi=h.extend({name:"picture_color",className:"control picture_color",saveOnDeselect:!0,saveOnDestroy:!0,initialize:function(t){this.template=vi.a["template-constructor-control-picture-color"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model,this.block.on("picture_added",(function(){this.$el.toggle(this.block.isVector())}),this),this.block.model.get("picture")||this.$el.hide()},bindLogic:function(){this.colorbox=new Pe.a({$parent:this.$panel,type:"small"}),this.colorbox.on("colorchange",this.colorChanged),this.colorbox.on("opacitychange",this.colorChanged),this.model.on("change:pic_color",this.onColorChange),this.model.on("change:pic_opacity",this.onColorChange),this.updateState()},unBindLogic:function(){this.colorbox&&this.colorbox.off("colorchange",this.colorChanged),this.colorbox&&this.colorbox.off("opacitychange",this.colorChanged),this.colorbox&&this.colorbox.destroy(),this.model.off("change:pic_color",this.onColorChange),this.model.off("change:pic_opacity",this.onColorChange)},updateIconState:function(t,e){t&&null!=e&&this.$icon&&this.$icon.find(".color-circle").css({background:"#"+t,opacity:e})},updateColorboxState:function(t,e){t&&null!=e&&this.colorbox&&(this.colorbox.setOpacity(e),this.colorbox.setColor(t))},colorChanged:function(t,e,i,s){var o=this.colorbox&&this.colorbox.rgb2hex([t,e,i]);this.updateIconState(o,s),this.model.set({pic_color:o,pic_opacity:s}),this.block.$svg&&this.block.setVectorColor(o,s)},updateState:function(){var t=this.model.get("pic_color")||"000000",e=this.model.get("pic_opacity")||1;this.updateIconState(t,e),this.updateColorboxState(t,e),this.block.$svg},onColorChange:function(t,e,i){(i.undo||i.redo)&&this.updateState()},save:function(){this.block.saveSvg(s.a.bind(this.model.save,this.model))}}),_i=_e.extend({name:"picture_settings",alt:"Picture",panelComponent:"panel-picture-settings",select:function(){_e.prototype.select.apply(this,arguments),Object(c.a)("controls-picture_settings")}}),wi=i("kwFJ"),yi=i.n(wi),ki=b.extend({name:"slideshow_manager",className:"control slideshow_manager",events:{},MIN_PANEL_HEIGHT:275,MAX_PANEL_HEIGHT:640,CREATE_SPEED:270,initialize:function(t){s.a.bindAll(this),this.template=yi.a["template-constructor-control-slideshow_manager"],this.image_template=yi.a["template-constructor-control-slideshow_manager-image"],this.initControl(t),this.block=this.blocks[0],this.block.manager=this,this.block.workspace.on("main-dragover",this.highlightDropZone),this.slideshowPlayer=this.block.slideshowPlayer},bindLogic:function(){this.block.on("addUpload",this.onAddImage,this),this.block.on("addUpload replaceUpload",this.showLoader,this),this.block.on("nowUploading",this.onStartUploading,this),this.block.on("doneUpload",this.onDoneUpload,this),this.block.on("failUpload",this.onFailUpload,this),this.block.model.on("change:pictures",this.redrawAll,this),this.block.on("clear",this.clearImages),this.$panel.on("click",".add-block .add",this.addClick),this.$panel.on("click",".slideshow-image-wrapper .remove",this.onRemoveImage),this.$panel.on("click",".slideshow-image-wrapper .update",this.onUpdateImage),this.$panel.on("mouseenter",".slideshow-image-wrapper .image",this.onImageMouseEnter),this.$panel.on("mouseleave",".slideshow-image-wrapper .image",this.onImageMouseLeave),this.$panel.on("click",".slideshow-image-wrapper .image",this.onImageClick),this.$resizableContent=Object(o.a)(this.$panel.find(".resizable-content")),this.block.on("reorder",this.reorder,this),this.$resizableContent.sortable({distance:10,axis:"y",scrollSpeed:20,containment:this.$(".resizable-scroll-wrapper"),tolerance:"pointer",cursorAt:{top:50},start:s.a.bind((function(t,e){this.onImageMouseLeave(),e.item.find(".slideshow-image").addClass("dragging"),this.$resizableContent.css("height",this.$resizableContent.height()+30)}),this),stop:s.a.bind((function(t,e){setTimeout(s.a.bind((function(){e.item.find(".slideshow-image").removeClass("dragging")}),this),50),e.position.top>this.$resizableContent.height()-30-e.item.height()&&e.item.detach().closest(".slideshow-image-wrapper").appendTo(this.$resizableContent),this.block.swapPictures(e.item.data("num"),e.item.index()+1),this.$resizableContent.css("height","auto")}),this)}),this.$uploadDropZone=this.$el,this.block.updateDropZone(),this.renderPictures(),this.slideshowPlayer&&this.slideshowPlayer.on("currentImageChanged",this.onCurrentImageChanged),this.block.queue.length&&this.showLoader()},unBindLogic:function(){this.block.off(null,null,this),this.$panel.off("click",".add-block .add",this.addClick),this.$panel.off("click",".slideshow-image-wrapper .remove",this.onRemoveImage),this.$panel.off("click",".slideshow-image-wrapper .update",this.onUpdateImage),this.$panel.off("mouseenter",".slideshow-image-wrapper .image",this.onImageMouseEnter),this.$panel.off("mouseleave",".slideshow-image-wrapper .image",this.onImageMouseLeave),this.$panel.off("click",".slideshow-image-wrapper .image",this.onImageClick),this.slideshowPlayer&&this.slideshowPlayer.off(),delete this.$uploadDropZone},renderPictures:function(t){var e=s.a.sortBy(this.block.getAllPics(),(function(t){return t.num})),i="";s.a.each(e,(function(t){i+=this.image_template({pic:t})}),this),t&&t.clear&&this.$panel.find(".resizable-content").html(""),this.$panel.find(".resizable-content").append(i);var n=this.block.queue[0];n&&this.onStartUploading(n),this.rendered=!0,this.resizableScroll&&this.resizableScroll.recalc(),Object(o.a)(this.$panel.find(".resizable-content")).sortable("refresh")},redrawAll:function(t,e,i){i&&(i.undo||i.redo)&&this.rendered&&(this.$el.addClass("updating"),setTimeout(s.a.bind((function(){this.renderPictures({clear:!0}),this.$el.removeClass("updating"),this.slideshowPlayer&&this.onCurrentImageChanged(this.slideshowPlayer.currentImageID,!1,"change-pictures")}),this),50)),s.a.isEmpty(t.get("pictures"))&&this.clearImages()},clearImages:function(){this.$(".resizable-content").empty(),this.resizableScroll&&this.resizableScroll.recalc();var t=Object(o.a)(this.$panel.find(".resizable-content"));t.data("ui-sortable")&&t.sortable("refresh")},reorder:function(){this.$(".slideshow-image-wrapper:not(.deleting)").each((function(t){Object(o.a)(this).data("num",t+1).find(".num").text(t+1)}))},onCurrentImageChanged:function(t,e,i){var s=this.$panel.find('.slideshow-image-wrapper .image[data-id="'+t+'"]');if(s.length||(s=this.$panel.find(".slideshow-image-wrapper .image:first")),s.length&&(this.$panel.find(".slideshow-image").removeClass("active"),s.closest(".slideshow-image").addClass("active"),"switch-to-image"==i||"control-show"==i)){s=s.closest(".slideshow-image-wrapper");var o,n=this.$panel.find(".resizable-content-wrapper"),a=s.position().top,r=n.height(),l=s.height();a+2*l-n.scrollTop()>r-8?o=a+2*l-r+8:a-l-n.scrollTop()<8&&(o=a-l-8),null!=o&&(e?n.stop().animate({scrollTop:o},200):n.scrollTop(o))}},onScrollRecalc:function(t){this.slideshowPlayer&&this.onCurrentImageChanged(this.slideshowPlayer.currentImageID,!1,t)},onImageClick:function(t){var e=Object(o.a)(t.target).attr("data-id");e&&this.slideshowPlayer&&this.slideshowPlayer.moveToImage(e,!0,"switch-to-image")},onImageMouseEnter:function(t){var e=Object(o.a)(t.currentTarget),i=e.closest(".slideshow-image-wrapper"),s=this.$(".error-panel");if(!e.closest(".slideshow-image").hasClass("dragging")&&i.hasClass("error")){var n=e.width(),a=e.offset().left-this.$panel.offset().left,r=e.offset().top-this.$panel.offset().top;s.find(".error-panel-text").text(i.attr("data-error")),s.addClass("shown").css({left:a+n/2,top:r-s.outerHeight()})}},onImageMouseLeave:function(t){this.$(".error-panel").removeClass("shown")},addClick:function(){this.block.$(".uploadInput").trigger("click","stop")},onAddImage:function(t){var e=Object(o.a)(this.image_template({pic:t}));e.appendTo(this.$panel.find(".resizable-content")),e.addClass("enable-transition").addClass("collapsed").addClass("collapsed-half"),setTimeout(s.a.bind((function(){e.removeClass("collapsed"),setTimeout(s.a.bind((function(){e.removeClass("collapsed-half"),setTimeout(s.a.bind((function(){e.removeClass("enable-transition"),this.resizableScroll&&this.resizableScroll.recalc(),Object(o.a)(this.$panel.find(".resizable-content")).sortable("refresh")}),this),this.CREATE_SPEED)}),this),this.CREATE_SPEED)}),this),50)},showLoader:function(){this.$el.addClass("loading")},onStartUploading:function(t){this.getImage(t).addClass("loading")},onDoneUpload:function(t){var e=this.getImage(t);e.find(".rmpreloader").fadeOut("fast",(function(){e.removeClass("loading"),Object(o.a)(this).attr("style","")})),e.find(".image").css("background-image",'url("'+t.thumbUrl+'")').attr("data-id",t.id),this.block.queue.length||this.$el.removeClass("loading")},onFailUpload:function(t,e){var i=this.getImage(t);t.error&&i.addClass("error").attr("data-error",e),this.block.queue.length||this.$el.removeClass("loading")},onRemoveImage:function(t){var e=Object(o.a)(t.target).closest(".slideshow-image-wrapper"),i=e.addClass("deleting").data("num");this.block.deletePic(i),e.addClass("enable-transition"),setTimeout(s.a.bind((function(){e.addClass("removed-half"),setTimeout(s.a.bind((function(){e.addClass("removed"),setTimeout(s.a.bind((function(){e.removeClass("enable-transition").remove(),this.resizableScroll&&this.resizableScroll.recalc()}),this),this.CREATE_SPEED)}),this),this.CREATE_SPEED)}),this),50)},getImage:function(t){return this.$(".slideshow-image-wrapper").filter((function(){return Object(o.a)(this).data("num")===t.num}))},onUpdateImage:function(t){var e=Object(o.a)(t.target).closest(".slideshow-image-wrapper").removeClass("error").data("error","").attr("style","").data("num");this.block.updatePic(e)},highlightDropZone:function(){this.$panel.addClass("show-dropzone"),clearTimeout(this.highlightTimeout),this.highlightTimeout=setTimeout(s.a.bind((function(){this.$panel.removeClass("show-dropzone")}),this),500)},select:function(){b.prototype.select.apply(this,arguments),Object(c.a)("controls-slideshow_manager")},restrictions:function(t){var e=s.a.pluck(t.getSelectedBlocks(),"model");return s.a.all(e,(function(t){return"slideshow"==!t.get("type")||(t.get("pictures")||[]).length>0}))},destroy:function(){b.prototype.destroy.apply(this,arguments),this.rendered=!1}}),Ci=i("u/SR"),xi=i.n(Ci),Si=h.extend({name:"shape_color",className:"control shape_color",saveOnDeselect:!0,saveOnDestroy:!0,initialize:function(t){this.template=xi.a["template-constructor-control-shape_color"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model,s.a.bindAll(this)},bindLogic:function(){this.colorbox=new Pe.a({$parent:this.$panel,type:"small"}),this.colorbox.on("colorchange",this.colorChanged),this.colorbox.on("opacitychange",this.colorChanged),this.model.on("change:bg_color",this.onColorChange),this.model.on("change:bg_opacity",this.onColorChange),this.updateState()},unBindLogic:function(){this.colorbox&&this.colorbox.off("colorchange",this.colorChanged),this.colorbox&&this.colorbox.off("opacitychange",this.colorChanged),this.colorbox&&this.colorbox.destroy(),this.model.off("change:bg_color",this.onColorChange),this.model.off("change:bg_opacity",this.onColorChange)},updateIconState:function(t,e){t&&null!=e&&this.$icon&&this.$icon.find(".color-circle").css({background:"#"+t,opacity:e})},updateColorboxState:function(t,e){t&&null!=e&&this.colorbox&&(this.colorbox.setOpacity(e),this.colorbox.setColor(t))},colorChanged:function(t,e,i,s){var o=this.colorbox&&this.colorbox.rgb2hex([t,e,i]);this.updateIconState(o,s),this.model.set({bg_color:o,bg_opacity:s})},updateState:function(){var t=this.model.get("bg_color"),e=this.model.get("bg_opacity");this.updateIconState(t,e),this.updateColorboxState(t,e)},onColorChange:function(t,e,i){(i.undo||i.redo)&&this.updateState()},save:function(){"icon"!==this.model.get("tp")?this.model.save({}):this.block.saveNewColor()}}),Pi=_e.extend({name:"shape_settings",alt:"Settings",panelComponent:"panel-shape-settings",onPanelChange:function(t){_e.prototype.onPanelChange.apply(this,arguments)},select:function(){_e.prototype.select.apply(this,arguments),Object(c.a)("controls-shape_settings")},deselect:function(){this.colorbox_visible&&this.closeColorBox(),this.stroke_popup_visible&&this.closeStrokePopup(),_e.prototype.deselect.apply(this,arguments)}}),$i=i("2d4q"),Oi=i.n($i),Ti=h.extend({name:"shape_1x1",className:"control shape_1x1",initialize:function(t){this.template=Oi.a["template-constructor-control-shape_1x1"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model,this.onScaleChange.__debounced=s.a.debounce(this.onScaleChange,100)},bindLogic:function(){this.model.on("change",this.onScaleChange.__debounced),this.onScaleChange()},unBindLogic:function(){this.model.off("change",this.onScaleChange.__debounced)},onScaleChange:function(){if(this.model){var t=this.model.get("h")==this.model.get("w");this.$el.toggleClass("inactive",t)}},onClick:function(){this.$el.hasClass("inactive")||(this.block.makeSquare(),this.model.save(),this.master.deselect())},restrictions:function(t){var e=t.getSelectedBlocks();return e.length&&!e[0].isFullWidth()&&!e[0].isFullHeight()}}),Mi=i("voD7"),ji=i.n(Mi),Ii=b.extend({name:"shape_icon",className:"control shape_icon",MIN_PANEL_HEIGHT:264,MAX_PANEL_HEIGHT:640,SCROLL_GAP_START:0,SCROLL_GAP_END:8,API_URL:"/api/authservice/noun?uri=",LIMIT_TO_PUBLIC_DOMAIN:!1,DEFAULT_COLLECTION_ID:1335,saveOnDestroy:!0,saveOnDeselect:!0,events:{"click .icon-item":"onIconItemClick"},initialize:function(t){this.template=ji.a["template-constructor-control-shape_icon"],this.templateItem=ji.a["template-constructor-control-shape_icon-item"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model},render:function(){b.prototype.render.apply(this,arguments),this.$result=this.$(".panel .resizable-content"),window.prevSVGSearch?(this.nextPage=window.prevSVGSearch.nextPage,this.$(".search").val(window.prevSVGSearch.phrase),this.search_string=window.prevSVGSearch.phrase,this.drawSearchResults(window.prevSVGSearch),this.$(".loupe").addClass("clear")):this.getDefaultCollection()},bindLogic:function(){this.$(".search").on("keyup",this.onSearchKeyUp),this.$(".loupe:not(.preloading)").on("click",this.onLoupeClick),this.listenTo(this.block.model,"change:tp",this.onShapeTypeChange)},unBindLogic:function(){this.$(".search").off("keyup",this.onSearchKeyUp),this.$(".loupe").off("click",this.onLoupeClick),this.stopListening(this.block.model)},onSearchKeyUp:function(t){t.keyCode===o.a.keycodes.enter&&this.doSearch()},onLoupeClick:function(t){this.$(".loupe").hasClass("clear")?this.clearSearch():this.doSearch()},doSearch:function(){var t=this.$(".search").val().trim();t&&this.search_string!=t&&!this.requestInProgress&&(this.search_string=t,this.$result.empty(),delete window.prevSVGSearch,this.$(".loupe").addClass("clear"),this.nextPage=1,this.getDataPage(this.nextPage))},clearSearch:function(){this.$(".loupe").removeClass("clear"),delete window.prevSVGSearch,this.$(".search").val(""),this.search_string="",this.$result.empty(),this.getDefaultCollection()},getDataPage:function(t){var e;this.search_string&&!this.requestInProgress&&(e="/icons/"+this.search_string+"?page="+t,this.LIMIT_TO_PUBLIC_DOMAIN&&(e+="&limit_to_public_domain=1"),this.requestIcons(e,function(t,e){t?delete this.nextPage:(window.prevSVGSearch=window.prevSVGSearch||{icons:[]},window.prevSVGSearch.icons=window.prevSVGSearch.icons.concat(e.icons),window.prevSVGSearch.phrase=this.search_string,window.prevSVGSearch.nextPage=this.nextPage,this.drawSearchResults(e))}.bind(this)))},requestIcons:function(t,e){this.searchXhr&&this.searchXhr.abort(),this.searchInProgress=!0,this.showSearchPreloader(),this.searchXhr=o.a.ajax({method:"GET",url:this.API_URL+encodeURIComponent(t),dataType:"json",success:function(t){e(null,t)},error:function(t){e(t)},complete:function(){this.searchInProgress=!1,this.hideSearchPreloader()},context:this})},getDefaultCollection:function(){this.drawSearchResults(this.defaultCollection)},drawSearchResults:function(t){s.a.isArray(t.icons)&&t.icons.length?(s.a.each(t.icons,function(t){this.$result.append(this.templateItem({icon:t}))}.bind(this)),this.__scrollRecalc_debounced()):delete this.nextPage},select:function(){b.prototype.select.apply(this,arguments),s.a.delay(function(){this.$(".search").focus().select()}.bind(this),400)},save:function(){this.model.save(),b.prototype.save.apply(this,arguments)},onIconItemClick:function(t){var e=Object(o.a)(t.currentTarget),i=e.find(".noun-icon"),n=i.attr("data-id"),a=i.attr("data-rm_id"),r=i.attr("data-url");this.$(".resizable-content").hasClass("preloading")||(this.hideIconPreloader(),this.showIconPreloader(e),this.block.getIconSVG(n||a,r,function(t,i){var o;this.hideIconPreloader(),t||(this.$(".icon-item").removeClass("selected"),e.addClass("selected"),o={noun_url:r},n?s.a.extend(o,{noun_id:n,rm_id:null}):a&&s.a.extend(o,{noun_id:null,rm_id:a}),this.block.model.set(o))}.bind(this)))},onPanelScroll:function(t){this.selected&&t.content_size-t.container_size-t.scroll_pos<32&&this.nextPage&&!this.searchInProgress&&this.getDataPage(++this.nextPage)},abortRequests:function(){this.searchXhr&&this.searchXhr.abort(),this.searchInProgress=!1},onShapeTypeChange:function(){"icon"!==this.block.model.get("tp")&&this.abortRequests()},showSearchPreloader:function(){this.$(".loupe").addClass("preloading")},hideSearchPreloader:function(){this.$(".loupe").removeClass("preloading")},showIconPreloader:function(t){t.append(Object(o.a)('<div class="rmpreloader"><div class="arc"></div></div>')),this.$(".resizable-content").add(t).addClass("preloading")},hideIconPreloader:function(t){this.$(".resizable-content").find(".rmpreloader").remove(),this.$(".resizable-content").add(this.$(".icon-item")).removeClass("preloading")},destroy:function(){this.abortRequests(),b.prototype.destroy.apply(this,arguments)}}),Ei=i("0SXY"),Ai=i.n(Ei),Ri=h.extend({name:"gmaps_edit",className:"control gmaps_edit",saveOnDeselect:!0,saveOnDestroy:!0,initialize:function(t){this.template=Ai.a["template-constructor-control-gmaps_edit"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model},select:function(){h.prototype.select.apply(this,arguments),this.block.enterEditState(),this.$(".icon").addClass("edit")},deselect:function(){this.block.exitEditState(),h.prototype.deselect.apply(this,arguments),this.$(".icon").removeClass("edit")},bindLogic:function(){this.block.on("editMapClick",this.onClick)},unBindLogic:function(){this.block.off("editMapClick",this.onClick)},save:function(){this.model.save({})}}),Di=_e.extend({name:"gmaps_settings",alt:"Settings",panelComponent:"panel-gmaps-settings"}),zi=i("TGSb"),Li=i.n(zi),Bi=h.extend({name:"common_lock",className:"control common_lock",initialize:function(t){this.template=Li.a["template-constructor-control-common_lock"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model},render:function(){h.prototype.render.apply(this,arguments),this.updateState()},bindLogic:function(){RM.constructorRouter.bindGlobalKeyPress([{key:"l",handler:this.onClick}]),s.a.each(this.models,function(t){this.listenTo(t,"change:is_locked",this.onLockChange)}.bind(this))},unBindLogic:function(){RM.constructorRouter.unbindGlobalKeyPress("l",this.onClick),s.a.each(this.models,function(t){this.stopListening(t,"change:is_locked")}.bind(this))},onClick:function(){if(!this.isOnClickDisabled()){var t=s.a.all(this.models,(function(t){return!t.get("is_locked")})),e=s.a.map(this.models,(function(e){return{_id:e.id,is_locked:t}}));this.master.workspace.save_group(e),this.master.deselect()}},onLockChange:function(){this.updateState()},updateState:function(){var t=s.a.any(this.models,(function(t){return t.get("is_locked")}));this.$el.toggleClass("locked",t),this.$(".icon").attr("data-alt",t?"Unlock":"Lock"),s.a.each(this.models,(function(e){var i=e.get("pack_id");i&&Object(o.a)("#pack_"+i).toggleClass("no-drag",t)}))}}),Fi=i("ibKe"),Hi=i.n(Fi),Ni=h.extend({name:"button_edit",className:"control button_edit",saveOnDeselect:!0,saveOnDestroy:!0,initialize:function(t){this.template=Hi.a["template-constructor-control-button_edit"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model},select:function(){h.prototype.select.apply(this,arguments),Object(c.a)("controls-button_edit")},onClick:function(){if(!this.isOnClickDisabled()){var t=this.blocks&&this.blocks[0];t.isEditMode?t.leaveEditMode({deselectControl:!0}):t.enterEditMode()}},onEscKey:function(){var t=this.blocks&&this.blocks[0];t.isEditMode&&t.leaveEditMode({deselectControl:!0,saveWidgetData:!0})},onEnterKey:function(){var t=this.blocks&&this.blocks[0];t.isEditMode&&t.leaveEditMode({deselectControl:!0,saveWidgetData:!0})},save:function(){(this.blocks&&this.blocks[0]).saveWidgetData()},canControlBeClosed:function(){return!1},deselect:function(){var t=this.blocks&&this.blocks[0];t.isEditMode&&t.leaveEditMode(),h.prototype.deselect.apply(this,arguments)},destroy:function(){var t=this.blocks&&this.blocks[0];t&&t.isEditMode&&t.leaveEditMode(),h.prototype.destroy.apply(this,arguments)}}),Vi=_e.extend({name:"button_settings",alt:"Settings",panelComponent:"panel-button-settings"}),Ui=i("a3mI"),Wi=i.n(Ui),Gi=b.extend({name:"button_icon",className:"control button_icon",MIN_PANEL_HEIGHT:274,MAX_PANEL_HEIGHT:640,SCROLL_GAP_START:4,SCROLL_GAP_END:4,API_URL:"/api/authservice/noun?uri=",LIMIT_TO_PUBLIC_DOMAIN:!1,DEFAULT_COLLECTION_ID:1335,saveOnDestroy:!0,saveOnDeselect:!0,initialize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.template=Wi.a["template-constructor-control-button_icon"],this.templateItem=Wi.a["template-constructor-control-button_icon-item"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model,this.applyIconSizeParamVisualState.__debounced=s.a.debounce(this.applyIconSizeParamVisualState,20),this.bindModelEvents()},render:function(){b.prototype.render.apply(this,arguments),this.$result=this.$(".panel .resizable-content"),window.prevSVGSearch?(this.nextPage=window.prevSVGSearch.nextPage,this.$(".search").val(window.prevSVGSearch.phrase),this.search_string=window.prevSVGSearch.phrase,this.drawSearchResults(window.prevSVGSearch),this.$(".loupe").addClass("clear")):this.getDefaultIconsCollection()},bindLogic:function(){this.$el.on("click",".icon-item",this.onIconItemClick),this.$(".search").on("keyup",this.onSearchKeyUp),this.$(".loupe:not(.preloading)").on("click",this.onLoupeClick),this.$iconPositionParam=this.$panel.find('.edit-item[data-field="icon_pos"]'),this.$iconPositions=this.$iconPositionParam.find(".position"),this.$disableIcon=this.$panel.find(".disable-icon"),this.$lastIcon=this.$panel.find(".last-icon"),this.$disableIcon.on("click",this.onDisableIconClick),this.iconSizeEditParamInput=Object(o.a)(this.$panel.find('.edit-item[data-field="icon_h"] input')).RMNumericInput({min:this.block.MIN_FONT_SIZE,max:this.block.MAX_FONT_SIZE,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.$iconPositionParam.find(".position").on("click",this.onPositionClick),this.applyIconEnabledVisualState(),this.applyIconSizeParamVisualState(),this.applyIconPositionParamVisualState()},unBindLogic:function(){this.$el.off("click",".icon-item",this.onIconItemClick),this.$(".search").off("keyup",this.onSearchKeyUp),this.$(".loupe:not(.preloading)").off("click",this.onLoupeClick),this.$iconPositions.off("click",this.onPositionClick),this.$disableIcon.off("click",this.onDisableIconClick),this.model&&this.model.off(null,null,this)},bindModelEvents:function(){this.model.on("change:icon_h",this.applyIconSizeParamVisualState.__debounced,this),this.model.on("change:icon_pos",this.applyIconPositionParamVisualState,this),this.model.on("change:icon_enabled",this.applyIconEnabledVisualState)},onEditInputChanged:function(t,e){this.model.set(t.closest(".edit-item").attr("data-field"),e)},onPositionClick:function(t){var e=Object(o.a)(t.currentTarget).data("position");this.model.set("icon_pos",e)},applyIconEnabledVisualState:function(){var t=this.model.get("icon_enabled");this.$disableIcon.add(this.$lastIcon).removeClass("active"),t?this.$lastIcon.addClass("active"):this.$disableIcon.addClass("active")},applyIconSizeParamVisualState:function(){this.iconSizeEditParamInput(this.model.get("icon_h"),!0)},applyIconPositionParamVisualState:function(){this.$iconPositionParam.find(".current").removeClass("current"),this.$iconPositionParam.find("."+this.model.get("icon_pos")).addClass("current")},onSearchKeyUp:function(t){t.keyCode===o.a.keycodes.enter&&this.doSearch()},onLoupeClick:function(t){this.$(".loupe").hasClass("clear")?this.clearSearch():this.doSearch()},doSearch:function(){var t=this.$(".search").val().trim();t&&this.search_string!==t&&!this.requestInProgress&&(this.search_string=t,this.$result.find(".icon-item").remove(),delete window.prevSVGSearch,this.$(".loupe").addClass("clear"),this.nextPage=1,this.getDataPage(this.nextPage))},clearSearch:function(){this.$(".loupe").removeClass("clear"),delete window.prevSVGSearch,this.$(".search").val(""),this.search_string="",this.$result.find(".icon-item").remove(),this.getDefaultIconsCollection()},getDataPage:function(t){var e;this.search_string&&!this.requestInProgress&&(e="/icons/"+this.search_string+"?page="+t,this.LIMIT_TO_PUBLIC_DOMAIN&&(e+="&limit_to_public_domain=1"),this.requestIcons(e,function(t,e){t?delete this.nextPage:(window.prevSVGSearch=window.prevSVGSearch||{icons:[]},window.prevSVGSearch.icons=window.prevSVGSearch.icons.concat(e.icons),window.prevSVGSearch.phrase=this.search_string,window.prevSVGSearch.nextPage=this.nextPage,this.drawSearchResults(e))}.bind(this)))},requestIcons:function(t,e){this.searchXhr&&this.searchXhr.abort(),this.searchInProgress=!0,this.showSearchPreloader(),this.searchXhr=o.a.ajax({method:"GET",url:this.API_URL+encodeURIComponent(t),dataType:"json",success:function(t){e(null,t)},error:function(t){e(t)},complete:function(){this.searchInProgress=!1,this.hideSearchPreloader()}.bind(this),context:this})},getDefaultIconsCollection:function(){this.drawSearchResults(this.defaultIconsCollection)},drawSearchResults:function(t){s.a.isArray(t.icons)&&t.icons.length?(s.a.each(t.icons,function(t){this.$result.append(this.templateItem({icon:t}))}.bind(this)),this.__scrollRecalc_debounced()):delete this.nextPage},select:function(){b.prototype.select.apply(this,arguments),s.a.delay(function(){this.$(".search").focus().select()}.bind(this),400)},save:function(){this.block.saveWidgetData(),b.prototype.save.apply(this,arguments)},onIconItemClick:function(t){var e=Object(o.a)(t.currentTarget),i=e.find(".noun-icon"),n=i.attr("data-id"),a=i.attr("data-rm_id"),r=i.attr("data-url");this.$(".resizable-content").hasClass("preloading")||(this.hideIconPreloader(),this.showIconPreloader(e),this.block.getIconSVG(n||a,r,function(t,i){var o,l=this.model.get("icon_enabled");this.hideIconPreloader(),t||(this.$(".icon-item.selected").removeClass("selected"),e.addClass("selected"),o={icon_noun_url:r},n?s.a.extend(o,{icon_noun_id:n,icon_rm_id:null}):a&&s.a.extend(o,{icon_noun_id:null,icon_rm_id:a}),l||s.a.extend(o,{icon_enabled:!0}),this.block.model.set(o),this.$lastIcon.find(".noun-icon").css({"background-image":'url("'+i.noun_url+'")'}))}.bind(this)))},onDisableIconClick:function(){var t=this.model.get("icon_enabled");this.$(".icon-item.selected").removeClass("selected"),t&&(this.model.set("icon_enabled",!1),this.block.$buttonIcon.empty(),this.block.recalcButtonSize())},onPanelScroll:function(t){this.selected&&t.content_size-t.container_size-t.scroll_pos<32&&this.nextPage&&!this.searchInProgress&&this.getDataPage(++this.nextPage)},abortRequests:function(){this.searchXhr&&this.searchXhr.abort(),this.searchInProgress=!1},showSearchPreloader:function(){this.$(".loupe").addClass("preloading")},hideSearchPreloader:function(){this.$(".loupe").removeClass("preloading")},showIconPreloader:function(t){t.append(Object(o.a)('<div class="rmpreloader"><div class="arc"></div></div>')),this.$(".resizable-content").add(t).addClass("preloading")},hideIconPreloader:function(t){this.$(".resizable-content").find(".rmpreloader").remove(),this.$(".resizable-content").add(this.$(".icon-item")).removeClass("preloading")},destroy:function(){this.abortRequests(),b.prototype.destroy.apply(this,arguments)}});Gi.prototype.defaultIconsCollection={icons:[{rm_id:"rm0",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/00-star.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/00-star.svg")},{rm_id:"rm1",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/01-bolt.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/01-bolt.svg")},{rm_id:"rm2",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/02-bubble.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/02-bubble.svg")},{rm_id:"rm3",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/03-camera.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/03-camera.svg")},{rm_id:"rm4",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/04-cloud.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/04-cloud.svg")},{rm_id:"rm5",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/05-download1.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/05-download1.svg")},{rm_id:"rm6",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/06-download2.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/06-download2.svg")},{rm_id:"rm7",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/07-globe2.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/07-globe2.svg")},{rm_id:"rm8",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/08-globe.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/08-globe.svg")},{rm_id:"rm9",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/09-pin.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/09-pin.svg")},{rm_id:"rm10",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/10-share1.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/10-share1.svg")},{rm_id:"rm11",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/11-share2.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/11-share2.svg")},{rm_id:"rm12",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/12-send.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/12-send.svg")},{rm_id:"rm13",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/13-checkmark.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/13-checkmark.svg")},{rm_id:"rm14",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/14-x.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/14-x.svg")},{rm_id:"rm15",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/15-minus.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/15-minus.svg")},{rm_id:"rm16",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/16-plus.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/16-plus.svg")},{rm_id:"rm17",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/17-mail1.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/17-mail1.svg")},{rm_id:"rm18",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/18-mail2.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/18-mail2.svg")},{rm_id:"rm19",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/19-user.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/19-user.svg")},{rm_id:"rm20",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/20-clock.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/20-clock.svg")},{rm_id:"rm21",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/21-embed.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/21-embed.svg")},{rm_id:"rm22",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/22-flag.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/22-flag.svg")},{rm_id:"rm23",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/23-heart.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/23-heart.svg")},{rm_id:"rm24",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/24-itunes.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/24-itunes.svg")},{rm_id:"rm25",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/25-like.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/25-like.svg")},{rm_id:"rm26",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/26-music.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/26-music.svg")},{rm_id:"rm27",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/27-play.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/27-play.svg")},{rm_id:"rm28",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/28-video.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/28-video.svg")},{rm_id:"rm29",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/29-facebook.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/29-facebook.svg")},{rm_id:"rm30",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/30-twitter.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/30-twitter.svg")},{rm_id:"rm31",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/31-linkedin.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/31-linkedin.svg")},{rm_id:"rm32",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/32-pinterest.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/32-pinterest.svg")},{rm_id:"rm33",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/33-instagram.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/33-instagram.svg")},{rm_id:"rm34",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/34-googleplus.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/34-googleplus.svg")},{rm_id:"rm35",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/35-tumblr.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/35-tumblr.svg")},{rm_id:"rm36",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/36-youtube.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/36-youtube.svg")},{rm_id:"rm37",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/37-vimeo.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/37-vimeo.svg")},{rm_id:"rm38",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/38-flickr.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/38-flickr.svg")},{rm_id:"rm39",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/39-blogger.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/39-blogger.svg")},{rm_id:"rm40",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/40-dribbble.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/40-dribbble.svg")},{rm_id:"rm41",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/41-behance.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/41-behance.svg")},{rm_id:"rm42",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/42-rss.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/42-rss.svg")},{rm_id:"rm43",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/43-at.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/43-at.svg")}]};var qi=Gi,Xi=i("sviH"),Ki=i("7TSX"),Yi=i.n(Ki),Zi=h.extend({name:"hotspot_add",className:"control hotspot_add",pin_attributes:["hotspots_group_id","pin_type","w","h","bg_color","bg_opacity","color","opacity","borders","noun_id","rm_id","noun_url","rasterUrl","raster2xUrl","tip_show_on","tip_background-color","tip_background-color-opacity","tip_border-radius","tip_box-shadow","is_global","is_above"],initialize:function(t){this.template=Yi.a["template-constructor-control-hotspot_add"],this.initControl(t)},onClick:function(){h.prototype.onClick.apply(this,arguments);var t=this.blocks[0],e=s.a.clone(t.model.attributes),i=Xi.a.hotspot.defaults,o={type:"hotspot"};s.a.extend(o,i);var n={};e.is_above&&(n={fixed_position:"n",x:0,y:460}),s.a.extend(o,s.a.pick(e,this.pin_attributes),n),RM.constructorRouter.workspace.addWidget(o)}}),Ji=i("Rn2B"),Qi=i.n(Ji),ts=b.extend({name:"hotspot_pin_settings",className:"control hotspot_pin_settings",MIN_PANEL_HEIGHT:274,MAX_PANEL_HEIGHT:640,SCROLL_GAP_START:4,SCROLL_GAP_END:4,API_URL:"/api/authservice/noun?uri=",LIMIT_TO_PUBLIC_DOMAIN:!1,DEFAULT_COLLECTION_ID:1335,saveOnDestroy:!0,saveOnDeselect:!0,initialize:function(t){this.template=Qi.a["template-constructor-control-hotspot-pin-settings"],this.templateItem=Qi.a["template-constructor-control-hotspot-pin-settings-icon-item"],t=t||{},this.initControl(t),this.block=this.blocks[0],this.model=this.block.model},render:function(){b.prototype.render.apply(this,arguments),this.$result=this.$(".panel .resizable-content"),window.prevSVGSearch?(this.nextPage=window.prevSVGSearch.nextPage,this.$(".search").val(window.prevSVGSearch.phrase),this.search_string=window.prevSVGSearch.phrase,this.drawSearchResults(window.prevSVGSearch),this.$(".loupe").addClass("clear")):this.getDefaultIconsCollection(),this.apply_type_related_visual_state(),this.apply_edit_params_visual_state()},bindLogic:function(){this.bind_model_events(),this.$el.on("click",".resizable-content .item",this.on_icon_click),this.$(".search").on("keyup",this.onSearchKeyUp),this.$(".loupe:not(.preloading)").on("click",this.onLoupeClick),this.$rectangleIcon=this.$panel.find(".rectangle-icon"),this.$circleIcon=this.$panel.find(".circle-icon"),this.$border_edit_param=this.$panel.find('[data-field="borders"]'),this.$borderWidthInput=Object(o.a)(this.$border_edit_param.children("input")),this.$bg_color_edit_param=this.$panel.find('[data-field="bg_color"]'),this.$colorbox_container=this.$panel.find(".colorbox_container"),this.$panel.find('.edit-item[data-field="tip_show_on"] .switcher').on("click",this.toggleShowMode),this.$panel.on("click",".edit-wrapper",this.closeAllEditPopups),this.$panel.on("click",".color-click-area",this.onColorboxShowClick),this.colorbox=new Pe.a({$parent:this.$colorbox_container,type:"small"}),this.colorbox.on("colorchange",this.on_color_or_opacity_changed),this.colorbox.on("opacitychange",this.on_color_or_opacity_changed),this.borderWidthEditParamInput=this.$borderWidthInput.RMNumericInput({min:0,max:999,mouseSpeed:4,onChange:this.on_edit_input_changed}).data("changeValue")},unBindLogic:function(){this.$el.off("click",".resizable-content .item",this.on_icon_click),this.$(".search").off("keyup",this.onSearchKeyUp),this.$(".loupe:not(.preloading)").off("click",this.onLoupeClick),this.model&&this.model.off(null,null,this)},toggleShowMode:function(){var t=this.$panel.find('.edit-item[data-field="tip_show_on"] .switcher').attr("data-active");t="click"==t?"hover":"click";var e=[];this.block.hotspots_group_collection.models.forEach((function(i){e.push({_id:i.get("_id"),tip_show_on:t})})),this.block.workspace.set_group(e)},getEditValue:function(t){return this.model.get(t)},closeAllEditPopups:function(t){t&&Object(o.a)(t.target).closest(".color-click-area").length>0||this.colorbox_visible&&this.closeColorBox()},bind_model_events:function(){this.listenTo(this.model,"change:pin_type",this.apply_type_related_visual_state),this.listenTo(this.model,"change:bg_color change:bg_opacity change:color change:opacity change:borders change:tip_show_on",this.apply_edit_params_visual_state)},on_edit_input_changed:function(t,e){var i=[];this.block.hotspots_group_collection.models.forEach((function(t){i.push({_id:t.get("_id"),borders:e})})),this.block.workspace.set_group(i)},on_color_or_opacity_changed:function(t,e,i,o){var n={};n[this.colorbox_for_field]=this.colorbox.rgb2hex([t,e,i]),n[this.colorbox_for_field_dop]=o;var a=[];this.block.hotspots_group_collection.models.forEach((function(t){a.push(s.a.extend({_id:t.get("_id")},n))})),this.block.workspace.set_group(a),this.needRasterize=!0},onClick:function(){this.selected&&this.colorbox_visible?this.closeAllEditPopups():b.prototype.onClick.apply(this,arguments)},apply_edit_params_visual_state:function(){this.$panel.find('.edit-item[data-field="tip_show_on"] .switcher').attr("data-active",this.getEditValue("tip_show_on")),this.apply_type_related_visual_state(),this.$panel.find('.edit-item[data-field="bg_color"] .color-circle').css("background-color",r.b.getRGBA(this.getEditValue("bg_color"),this.getEditValue("bg_opacity"))),this.$panel.find('.edit-item[data-field="color"] .color-circle').css("background-color",r.b.getRGBA(this.getEditValue("color"),this.getEditValue("opacity"))),this.borderWidthEditParamInput(this.getEditValue("borders"),!0)},apply_type_related_visual_state:function(){var t=this.model.get("pin_type");this.$rectangleIcon.add(this.$circleIcon).removeClass("selected"),"ellipse"===t?(this.$circleIcon.addClass("selected"),this.$bg_color_edit_param.removeClass("hidden"),this.$border_edit_param.removeClass("hidden"),this.$(".icon-item").removeClass("selected")):"icon"===t?(this.$bg_color_edit_param.removeClass("hidden"),this.$border_edit_param.addClass("hidden")):"rectangle"===t&&(this.$rectangleIcon.addClass("selected"),this.$bg_color_edit_param.addClass("hidden"),this.$border_edit_param.addClass("hidden"),this.$(".icon-item").removeClass("selected"));var e=this.$(".params-wrapper"),i=0;e.children(".edit-item").filter(":not(.hidden)").each((function(){i+=Object(o.a)(this).height()})),e.height(i),this.$(".resizable-scroll-wrapper").height("calc(100% - "+i+"px)"),this.__scrollRecalc_debounced()},onSearchKeyUp:function(t){t.keyCode===o.a.keycodes.enter&&this.doSearch()},onLoupeClick:function(t){this.$(".loupe").hasClass("clear")?this.clearSearch():this.doSearch()},doSearch:function(){var t=this.$(".search").val().trim();t&&this.search_string!=t&&!this.requestInProgress&&(this.search_string=t,this.$result.find(".icon-item").remove(),delete window.prevSVGSearch,this.$(".loupe").addClass("clear"),this.nextPage=1,this.getDataPage(this.nextPage))},clearSearch:function(){this.$(".loupe").removeClass("clear"),delete window.prevSVGSearch,this.$(".search").val(""),this.search_string="",this.$result.find(".icon-item").remove(),this.getDefaultIconsCollection()},getDataPage:function(t){var e;this.search_string&&!this.requestInProgress&&(e="/icons/"+this.search_string+"?page="+t,this.LIMIT_TO_PUBLIC_DOMAIN&&(e+="&limit_to_public_domain=1"),this.requestIcons(e,function(t,e){t?delete this.nextPage:(window.prevSVGSearch=window.prevSVGSearch||{icons:[]},window.prevSVGSearch.icons=window.prevSVGSearch.icons.concat(e.icons),window.prevSVGSearch.phrase=this.search_string,window.prevSVGSearch.nextPage=this.nextPage,this.drawSearchResults(e))}.bind(this)))},requestIcons:function(t,e){this.searchXhr&&this.searchXhr.abort(),this.searchInProgress=!0,this.showSearchPreloader(),this.searchXhr=o.a.ajax({method:"GET",url:this.API_URL+encodeURIComponent(t),dataType:"json",success:function(t){e(null,t)},error:function(t){e(t)},complete:function(){this.searchInProgress=!1,this.hideSearchPreloader()}.bind(this),context:this})},getDefaultIconsCollection:function(){this.drawSearchResults(this.defaultIconsCollection)},drawSearchResults:function(t){s.a.isArray(t.icons)&&t.icons.length?(s.a.each(t.icons,function(t){this.$result.append(this.templateItem({icon:t}))}.bind(this)),this.__scrollRecalc_debounced()):delete this.nextPage},select:function(){b.prototype.select.apply(this,arguments),s.a.delay(function(){this.$(".search").focus().select()}.bind(this),400)},save:function(){this.block.workspace.save_group(this.block.hotspots_group_collection.models),this.needRasterize&&(this.block.rasterize_icon_SVG(),delete this.needRasterize),b.prototype.save.apply(this,arguments)},on_icon_click:function(t){if(!this.$(".resizable-content").hasClass("preloading")){this.$(".resizable-content .item").removeClass("selected");var e,i,n=Object(o.a)(t.currentTarget),a=[];if(!n.hasClass("selected")&&(n.hasClass("icon-item")&&(e="icon"),n.hasClass("circle-icon")&&(e="ellipse"),n.hasClass("rectangle-icon")&&(e="rectangle"),"ellipse"!=e&&"rectangle"!=e||(n.addClass("selected"),this.block.icon_XHR&&this.block.icon_XHR.abort(),i={pin_type:e,noun_url:null,noun_id:null,rm_id:null},this.block.hotspots_group_collection.models.forEach((function(t){var o={};if("ellipse"==e){var n=t.get("x"),r=t.get("w"),l=t.get("h"),c=Math.floor((r-l)/2);o.w=l,o.x=n+c}a.push(s.a.extend({_id:t.get("_id")},i,o))})),this.block.workspace.set_group(a)),"icon"==e)){var r=n.find(".noun-icon"),l=r.attr("data-id"),c=r.attr("data-rm_id"),h=r.attr("data-url");this.hideIconPreloader(),this.showIconPreloader(n),this.block.get_icon_SVG(l||c,h,function(t,e){if(this.hideIconPreloader(),!t){n.addClass("selected"),i={pin_type:"icon",noun_url:h,noun_id:l||null,rm_id:c||null},this.block.render_pin_shape({pin_type:"icon"});var o=this.block.adjust_box_to_icon(),r=o.x-this.model.get("x"),d=o.y-this.model.get("y");this.block.hotspots_group_collection.models.forEach(function(t){a.push(s.a.extend({_id:t.get("_id")},i,o,{x:t.get("x")+r,y:t.get("y")+d}))}.bind(this)),this.block.workspace.set_group(a),this.needRasterize=!0}}.bind(this))}}},onColorboxShowClick:function(t){var e=Object(o.a)(t.currentTarget),i=e.attr("data-field"),s=e.attr("data-field-dop"),n=200;if(this.colorbox_visible){if(i==this.colorbox_for_field)return void this.closeColorBox();this.closeColorBox(!0),n=0}this.closeAllEditPopups(),this.colorbox_visible=!0,"bg_color"!==i&&"color"!==i||("color"===i?this.$colorbox_container.css({top:e.parent(".edit-item").position().top-this.$colorbox_container.height()+this.$panel.find(".resizable-content-wrapper").height()+this.$panel.find(".common-wrapper").position().top+"px"}):this.$colorbox_container.css({top:e.position().top-this.$colorbox_container.height()+this.$panel.find(".resizable-content-wrapper").height()+this.$panel.find(".common-wrapper").position().top+"px"})),this.$colorbox_container.fadeIn(n),this.colorbox_for_field=i,this.colorbox_for_field_dop=s,this.colorbox.setOpacity(this.getEditValue(s)),this.colorbox.setColor(this.getEditValue(i))},closeColorBox:function(t){this.colorbox_visible=!1,this.$colorbox_container.fadeOut(t?0:200)},onPanelScroll:function(t){this.selected&&t.content_size-t.container_size-t.scroll_pos<32&&this.nextPage&&!this.searchInProgress&&this.getDataPage(++this.nextPage)},abortRequests:function(){this.searchXhr&&this.searchXhr.abort(),this.searchInProgress=!1},showSearchPreloader:function(){this.$(".loupe").addClass("preloading")},hideSearchPreloader:function(){this.$(".loupe").removeClass("preloading")},showIconPreloader:function(t){t.append(Object(o.a)('<div class="rmpreloader"><div class="arc"></div></div>')),this.$(".resizable-content").add(t).addClass("preloading")},hideIconPreloader:function(t){this.$(".resizable-content").find(".rmpreloader").remove(),this.$(".resizable-content").add(this.$(".icon-item")).removeClass("preloading")},canControlBeClosed:function(){return this.colorbox_visible?(this.closeAllEditPopups(),!0):h.prototype.canControlBeClosed.apply(this,arguments)},deselect:function(){this.closeAllEditPopups(),h.prototype.deselect.apply(this,arguments)},destroy:function(){this.abortRequests(),b.prototype.destroy.apply(this,arguments)}});ts.prototype.defaultIconsCollection={icons:[{rm_id:"rm44",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/44-oval.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/44-oval.svg")},{rm_id:"rm45",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/45-plus.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/45-plus.svg")},{rm_id:"rm46",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/46-expl.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/46-expl.svg")},{rm_id:"rm47",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/47-que.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/47-que.svg")},{rm_id:"rm48",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/48-photo1.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/48-photo1.svg")},{rm_id:"rm49",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/49-photo2.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/49-photo2.svg")},{rm_id:"rm50",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/50-info.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/50-info.svg")},{rm_id:"rm51",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/51-info2.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/51-info2.svg")},{rm_id:"rm0",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/00-star.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/00-star.svg")},{rm_id:"rm1",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/01-bolt.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/01-bolt.svg")},{rm_id:"rm2",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/02-bubble.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/02-bubble.svg")},{rm_id:"rm3",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/03-camera.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/03-camera.svg")},{rm_id:"rm4",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/04-cloud.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/04-cloud.svg")},{rm_id:"rm5",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/05-download1.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/05-download1.svg")},{rm_id:"rm6",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/06-download2.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/06-download2.svg")},{rm_id:"rm7",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/07-globe2.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/07-globe2.svg")},{rm_id:"rm8",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/08-globe.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/08-globe.svg")},{rm_id:"rm9",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/09-pin.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/09-pin.svg")},{rm_id:"rm10",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/10-share1.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/10-share1.svg")},{rm_id:"rm11",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/11-share2.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/11-share2.svg")},{rm_id:"rm12",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/12-send.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/12-send.svg")},{rm_id:"rm13",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/13-checkmark.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/13-checkmark.svg")},{rm_id:"rm14",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/14-x.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/14-x.svg")},{rm_id:"rm15",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/15-minus.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/15-minus.svg")},{rm_id:"rm16",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/16-plus.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/16-plus.svg")},{rm_id:"rm17",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/17-mail1.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/17-mail1.svg")},{rm_id:"rm18",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/18-mail2.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/18-mail2.svg")},{rm_id:"rm19",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/19-user.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/19-user.svg")},{rm_id:"rm20",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/20-clock.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/20-clock.svg")},{rm_id:"rm21",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/21-embed.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/21-embed.svg")},{rm_id:"rm22",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/22-flag.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/22-flag.svg")},{rm_id:"rm23",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/23-heart.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/23-heart.svg")},{rm_id:"rm24",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/24-itunes.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/24-itunes.svg")},{rm_id:"rm25",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/25-like.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/25-like.svg")},{rm_id:"rm26",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/26-music.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/26-music.svg")},{rm_id:"rm27",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/27-play.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/27-play.svg")},{rm_id:"rm28",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/28-video.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/28-video.svg")},{rm_id:"rm29",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/29-facebook.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/29-facebook.svg")},{rm_id:"rm30",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/30-twitter.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/30-twitter.svg")},{rm_id:"rm31",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/31-linkedin.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/31-linkedin.svg")},{rm_id:"rm32",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/32-pinterest.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/32-pinterest.svg")},{rm_id:"rm33",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/33-instagram.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/33-instagram.svg")},{rm_id:"rm34",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/34-googleplus.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/34-googleplus.svg")},{rm_id:"rm35",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/35-tumblr.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/35-tumblr.svg")},{rm_id:"rm36",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/36-youtube.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/36-youtube.svg")},{rm_id:"rm37",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/37-vimeo.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/37-vimeo.svg")},{rm_id:"rm38",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/38-flickr.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/38-flickr.svg")},{rm_id:"rm39",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/39-blogger.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/39-blogger.svg")},{rm_id:"rm40",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/40-dribbble.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/40-dribbble.svg")},{rm_id:"rm41",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/41-behance.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/41-behance.svg")},{rm_id:"rm42",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/42-rss.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/42-rss.svg")},{rm_id:"rm43",icon_url:Object(c.b)("./constructor/blocks/button/default-icons-collection/43-at.svg"),preview_url_42:Object(c.b)("./constructor/blocks/button/default-icons-collection/43-at.svg")}]};var es=ts,is=i("s0L4"),ss=i.n(is),os=h.extend({name:"hotspot_tip_settings",className:"control hotspot_tip_settings",saveOnDeselect:!0,saveOnDestroy:!0,initialize:function(t){this.template=ss.a["template-constructor-control-hotspot-tip-settings"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model,this.apply_edit_params_visual_state.__debounced=s.a.debounce(this.apply_edit_params_visual_state,20),this.bind_model_events()},bindLogic:function(){this.$colorbox_container=this.$(".colorbox_container"),this.$border_radius_param=this.$panel.find('.edit-wrapper .edit-item[data-field="tip_border-radius"]'),this.$shadow_param=this.$panel.find('.edit-wrapper .edit-item[data-field="tip_box-shadow"]'),this.$position_param=this.$panel.find('.edit-item[data-field="tip_pos"]'),this.$panel.on("click",".edit-wrapper",this.close_all_edit_popups),this.$position_param.find(".position").on("click",this.on_position_click),this.$panel.on("click",".edit-wrapper .color-click-area",this.on_colorbox_show_click),this.colorbox=new Pe.a({$parent:this.$colorbox_container,type:"small"}),this.colorbox.on("colorchange",this.color_opacity_changed),this.colorbox.on("opacitychange",this.color_opacity_changed),this.border_radius_edit_param_input=Object(o.a)(this.$border_radius_param.find("input")).RMNumericInput({min:0,max:999,mouseSpeed:4,onChange:this.on_edit_input_changed}).data("changeValue"),this.shadow_switcher=Object(o.a)(this.$shadow_param.find(".switcher")).RMSwitcher({state:this.model.get("tip_box-shadow"),width:50,height:28,"text-size-0":12,"text-size-1":12,"color-0":"#0078ff"},function(t){s.a.delay(function(){this.model.set("tip_box-shadow",t)}.bind(this),300)}.bind(this)).data("switcher"),this.apply_edit_params_visual_state(),this.apply_tip_position_param_visual_state(),this.bind_model_events()},unBindLogic:function(){},on_position_click:function(t){var e=Object(o.a)(t.currentTarget).data("position");this.model.set("tip_pos",e)},on_edit_input_changed:function(t,e){var i={};i[t.closest(".edit-item").attr("data-field")]=e,this.model.set(i),this.adjust_inputs_padding()},adjust_inputs_padding:function(){for(var t=["tip_border-radius"],e=0;e<t.length;e++){var i=this.$panel.find('.edit-wrapper .edit-item[data-field="'+t[e]+'"] input'),s=i.val();i.toggleClass("extra-padding-for-one-symbol",1===s.length),i.toggleClass("extra-padding-for-two-symbols",2===s.length)}},bind_model_events:function(){var t=["tip_pos","tip_background-color","tip_background-color-opacity","tip_border-radius"];t.forEach((function(t,e,i){i[e]="change:"+t})),t=t.join(" "),this.listenTo(this.model,t,this.apply_edit_params_visual_state),this.listenTo(this.model,"change:tip_pos",this.apply_tip_position_param_visual_state)},apply_edit_params_visual_state:function(){this.$panel.find(".edit-wrapper").find('.edit-item[data-field="tip_background-color"] .color-circle').css("background-color",r.b.getRGBA(this.get_edit_value("tip_background-color"),this.get_edit_value("tip_background-color-opacity")/100)),this.border_radius_edit_param_input(this.get_edit_value("tip_border-radius"),!0),this.adjust_inputs_padding()},apply_tip_position_param_visual_state:function(){this.$position_param.find(".current").removeClass("current"),this.$position_param.find("."+this.model.get("tip_pos")).addClass("current")},get_edit_value:function(t){return this.model.get(t)},on_colorbox_show_click:function(t){var e=Object(o.a)(t.currentTarget),i=e.attr("data-field"),s=e.attr("data-field-dop"),n=200;if(this.colorbox_visible){if(i===this.colorbox_for_field)return void this.close_colorbox();this.close_colorbox(!0),n=0}this.close_all_edit_popups(),this.colorbox_visible=!0,this.$colorbox_container.css({top:e.position().top+e.height()+"px"}),this.$colorbox_container.fadeIn(n),this.colorbox_for_field=i,this.colorbox_for_field_dop=s,this.colorbox.setOpacity(this.get_edit_value(s)/100),this.colorbox.setColor(this.get_edit_value(i))},close_colorbox:function(t){this.colorbox_visible=!1,this.$colorbox_container.fadeOut(t?0:200)},color_opacity_changed:function(t,e,i,o){s.a.clone(this.model.attributes);var n=this.colorbox.rgb2hex([t,e,i]),a=100*o,r={};r[this.colorbox_for_field]=n,r[this.colorbox_for_field_dop]=a,this.model.set(r)},onClick:function(){this.selected&&this.colorbox_visible?this.close_all_edit_popups():h.prototype.onClick.apply(this,arguments)},close_all_edit_popups:function(t){t&&Object(o.a)(t.target).closest(".color-click-area").length>0||this.colorbox_visible&&this.close_colorbox()},select:function(){h.prototype.select.apply(this,arguments),Object(c.a)("controls-button_settings")},deselect:function(){this.close_all_edit_popups(),h.prototype.deselect.apply(this,arguments)},canControlBeClosed:function(){return this.colorbox_visible?(this.close_all_edit_popups(),!0):h.prototype.canControlBeClosed.apply(this,arguments)},save:function(){this.model.save()},destroy:function(t){h.prototype.destroy.apply(this,arguments)}}),ns=i("xka6"),as=i.n(ns),rs={text:"Text",number:"Number",name:"Name",email:"Email",phone:"Phone number",dropdown:"Dropdown",dropdownEditMode:"Edit dropdown",submit:"Text",textAfterSubmit:"Text after submit",toUrlAfterSubmit:"URL",toPageAfterSubmit:"Jump to page",option:"Edit option",checkbox:"Checkbox"},ls=function(t,e){return!e||cs(t,e)?null:e},cs=function(t,e){var i=e&&e.toLowerCase(),s=i===hs(t).toLowerCase();return"dropdown"!==t&&"dropdownEditMode"!==t||(s=i===hs("dropdown").toLowerCase()||i===hs("dropdownEditMode").toLowerCase()),s||i==="Field Text".toLowerCase()},hs=function(t){return rs[t]||"Field Text"},ds=function(t,e){var i=s.a.debounce(t,e||300);return function(e){13===e.keyCode?(t(e),Object(o.a)(e.target).blur()):i(e)}},ps=b.prototype,us=b.extend({name:"form_content",className:"control form_content",events:{"click .js-panel":"onPanelClick","click .js-add":"onAddClick","click .js-field-type":"onFieldTypeClick","click .js-submit-field-type":"onSubmitFieldClick","click .js-dropdown-trigger":"onDropdownTriggerClick","click .js-settings-trigger":"onSettingsTriggerClick","click .js-delete-field":"onDeleteFieldClick","keydown .js-field-caption":"onFieldCaptionKeydown","click .js-submit-dropdown-trigger":"onSubmitArrowClick","click .action-icon:not(.remove-icon)":"onActionIconClick","click .remove-icon":"onRemoveIconClick","click .search-wrapper .placeholder-selector .placeholder-item":"clickPlaceholder","focus .form-fields-caption-submitAfter.toPageAfterSubmit ":"changeAfterSubmitToPageInput","focusout .form-fields-caption-submitAfter.toPageAfterSubmit ":"changeAfterSubmitToPageInput"},MIN_PANEL_HEIGHT:350,MAX_PANEL_HEIGHT:504,SCROLL_GAP_START:4,SCROLL_GAP_END:4,FIELD_TYPES:{text:"Text",number:"Number",name:"Name",email:"Email",phone:"Phone Number",dropdown:"Dropdown",checkbox:"Checkbox"},SUBMIT_FIELD_TYPES:{textAfterSubmit:"Text after submit",toUrlAfterSubmit:"Website URL",toPageAfterSubmit:"Jump to Page"},SUBMIT_MODES:{textAfterSubmit:"textAfterSubmit",toUrlAfterSubmit:"toUrlAfterSubmit",toPageAfterSubmit:"toPageAfterSubmit"},PAGE_AFTER_SUBMIT_SHORT_PLACEHOLDER:"Jump to p.",saveOnDestroy:!0,saveOnDeselect:!0,idMap:{},dropdownPanels:{},dropdownModels:[],initialize:function(t){this.template=as.a["template-constructor-control-form_content"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model,s.a.bindAll(this)},bindLogic:function(){this.listenTo(this.model,"field:add",this.onFieldsChange),this.listenTo(this.model,"field:delete",this.onFieldsChange),this.listenTo(this.model,"field:tp:change",this.onFieldTypeChange),this.listenTo(this.model,"field:caption:change",this.onFieldCaptionChange),this.updateCaptionDebounced=ds(this.updateCaption.bind(this),300)},unBindLogic:function(){this.stopListening(this.model)},render:function(){ps.render.apply(this,arguments),this.$content=Object(o.a)(this.$el.find(".js-fields-container")),this.$settingsPopupContainer=this.$el.find(".js-settings-popup-container"),this.$dropdownPanelContainer=this.$el.find(".js-dropdown-panel-container"),this.$addBlock=this.$el.find(".js-add-block"),this.$scrollable=this.$el.find(".resizable-content-wrapper"),this.$content.sortable({items:".js-sortable",distance:10,axis:"y",scrollSpeed:10,containment:"parent",tolerance:"pointer",start:this.onSortStart.bind(this),stop:this.onSortEnd.bind(this)}),this.renderContent(),this.updatePanelHeight(this.MIN_PANEL_HEIGHT),this.$addBlock.append(this.renderSettingsPopup({edit:!1})),this.$addSettingsPopup=this.$el.find(".js-add-settings"),this.$submitPopup=this.$el.find(".submit-wrapper"),this.isPageMode()&&this.changeAfterSubmitToPageInput()},select:function(){ps.select.apply(this,arguments),this.resizeToFit()},renderContent:function(){this.$content.empty().append(this.renderFields()),this.refreshSort(),this.resizableScroll&&this.resizableScroll.recalc(),this.$settingsPopupContainer.empty().append(this.renderSettingsPopups()),this.$addBlock.append(this.renderSubmitPopup()),this.$dropdownPanelContainer.empty().append(this.renderDropdowns())},renderFields:function(){var t=Object(o.a)(document.createDocumentFragment());this.idMap={},s.a.each(this.model.get("fields"),function(e,i,o){var n="field-"+r.b.generateUUID();this.idMap[e.sort]=n;var a=this.renderField(s.a.extend({id:n,isOnly:1===o.length},e));t.append(a)}.bind(this)),t.append('<div class="button-header">Button</div>');var e=this.renderField({id:null,caption:this.model.get("button-caption"),tp:"submit"});t.append(e);var i=this.renderField({id:null,caption:this.model.get("button_caption_after_submit"),tp:"submitAfter"});return t.append(i),t},renderField:function(t){return(0,as.a["template-constructor-control-form_content-field"])({tp:t.tp,typeLetter:"number"===t.tp?"":t.tp[0],text:ls("submitAfter"===t.tp?this.model.get("submit_mode"):t.tp,t.caption),sort:t.sort,id:t.id,placeholder:hs("submitAfter"===t.tp?this.model.get("submit_mode"):t.tp),showSettings:"submit"!==t.tp&&"submitAfter"!==t.tp,showDelete:"submit"!==t.tp&&!t.isOnly&&"submitAfter"!==t.tp,isSortable:"submit"!==t.tp&&"submitAfter"!==t.tp,showSubmitAfterArrow:"submitAfter"===t.tp,mode:"submitAfter"===t.tp?this.model.get("submit_mode"):"",showRemoveArrow:this.model.get("submit_mode")!==this.SUBMIT_MODES.textAfterSubmit&&this.model.get("link_after_submit")})},reRenderField:function(t,e){var i=this.model.get("fields"),o=this.getPredicate(t),n=this.getField(o),a=this.$el.find(".js-field[data-id="+t+"]"),r=this.renderField(s.a.extend({id:t,isOnly:1===i.length},n));a.replaceWith(r),this.refreshSort(),"dropdown"!==n.tp&&"dropdown"!==e||this.$dropdownPanelContainer.empty().append(this.renderDropdowns())},renderSettingsPopups:function(){var t=Object(o.a)(document.createDocumentFragment());return s.a.each(this.model.get("fields"),function(e){var i=this.idMap[e.sort],s=this.renderSettingsPopup({showOptionalSwitcher:!0,selectedType:e.tp,edit:!0,optional:e.optional,id:i});t.append(s)}.bind(this)),t},renderSettingsPopup:function(t){var e=(0,as.a["template-constructor-control-form_content-settings"])(t=s.a.extend({types:this.FIELD_TYPES,showOptionalSwitcher:!1,selectedType:null,edit:!1,id:null,sort:null,_:s.a},t)),i=Object(o.a)(e),n=Object(o.a)(i.find(".switcher"));return n.length&&n.RMSwitcher({state:t.optional,height:26,width:44,"color-0":"#0078ff","color-1":"#c9c8c9","text-color-0":"transparent","text-color-1":"transparent",id:t.id},this.onSwitcherChange.bind(this)),i},renderSubmitPopup:function(t){var e=(0,as.a["template-constructor-control-form_content-after-submit"])(t=s.a.extend({types:this.SUBMIT_FIELD_TYPES,selectedType:this.model.get("submit_mode")||this.SUBMIT_MODES.textAfterSubmit,edit:!1,id:null,sort:null,_:s.a},t));return Object(o.a)(e)},renderDropdowns:function(){var t=Object(o.a)(document.createDocumentFragment()),e=s.a.where(this.model.get("fields"),{tp:"dropdown"});return this.destroyDropdowns(),s.a.each(e,function(e){var i=this.idMap[e.sort],s=this.renderDropdown(e);this.dropdownPanels[i]=s,t.append(s.el)}.bind(this)),t},renderDropdown:function(t){var e=new a.a.Model(s.a.clone(t));this.dropdownModels.push(e),this.listenTo(e,"change:caption",this.onDropdownCaptionChange),this.listenTo(e,"change:items",this.onDropdownItemsChange),this.listenTo(e,"change:height",this.onDropdownHeightChange),this.listenTo(e,"save",this.onDropdownSave);var i=new gs({model:e});return i.render(),i},onSortStart:function(){this.hideSettingsPopups(),this.$el.find(":input").blur(),this.$el.addClass("grabbing")},onSortEnd:function(){this.$el.removeClass("grabbing"),this.reorder(),this.$el.find(".js-field").attr("style","")},onScrollRecalc:function(){s.a.each(this.dropdownPanels,(function(t){t.resizableScroll&&t.resizableScroll.recalc()}))},onSwitcherChange:function(t,e){var i=e.settings.id,s=this.getPredicate(i);this.block.changeField(s,{optional:t})},onPanelClick:function(t){Object(o.a)(t.target).closest(".js-settings-trigger, .js-add, .js-settings-popup, .js-submit-dropdown-trigger").length||this.hideSettingsPopups()},onAddClick:function(){this.toggleSettingsPopup(this.$addSettingsPopup)},onFieldTypeClick:function(t){t.stopPropagation();var e=Object(o.a)(t.target).closest(".js-field-type"),i=e.data("value");if("add"===e.data("action"))this.addField({tp:i}),this.hideSettingsPopups(),this.scrollToBottom(),this.isPageMode()&&this.changeAfterSubmitToPageInput();else{var s=this.getPredicate(t.target);this.changeFieldType(s,i)}},onSubmitFieldClick:function(t){t.stopPropagation();var e=Object(o.a)(event.target).data("value");e!==this.model.get("submit_mode")&&(this.setAfterSubmitMode(e),this.reRenderAfterSubmit(e)),this.hideSettingsPopups()},isPageMode:function(){return this.model.get("submit_mode")&&this.model.get("submit_mode")===this.SUBMIT_MODES.toPageAfterSubmit},reRenderAfterSubmit:function(t){var e=this.$el.find(".form-fields-item-submitAfter"),i={tp:"submitAfter",selectedType:t},o=this.renderField(s.a.extend(i));this.$el.find(".js-submit-field-type").removeClass("selected"),this.$el.find(".js-submit-field-type[data-value="+t+"]").addClass("selected"),e.replaceWith(o)},changeAfterSubmitToPageInput:function(t){var e=t?Object(o.a)(t.currentTarget):this.$el.find(".js-field-caption-submitAfter"),i=e.val(),s=this.PAGE_AFTER_SUBMIT_SHORT_PLACEHOLDER,n=-1!==i.indexOf(s)?o.a.trim(i.replace(s,"")):i;-1===i.indexOf(s)&&this.getUrlData(n).result?e.val(s+" "+i):e.val(n)},getUrlData:function(t){var e=this.model.get("submit_mode"),i=RM.constructorRouter.mag,s=tn.text_link.prototype.getUrlData(t);return t=s.url,s.isValidPageNumber&&(t=i.getPageId(t)),{result:s.isURL&&e===this.SUBMIT_MODES.toUrlAfterSubmit||s.isValidPageNumber&&this.isPageMode(),url:t}},setAfterSubmitMode:function(t){this.model.set("submit_mode",t)},onDropdownTriggerClick:function(t){var e=Object(o.a)(t.target).closest("[data-id]").data("id"),i=this.dropdownPanels[e];this.hideSettingsPopups(),i&&i.show()},onSettingsTriggerClick:function(t){var e=Object(o.a)(t.target),i=e.closest("[data-id]").data("id"),s=this.$el.find(".js-settings-popup[data-id="+i+"]"),n=e.offset().top-this.$scrollable.offset().top+e.height()/2,a=this.$scrollable.height()-n;this.toggleSettingsPopup(s,{bottom:a})},onDeleteFieldClick:function(t){var e=this.getPredicate(t.target);this.deleteField(e),this.isPageMode()&&this.changeAfterSubmitToPageInput()},onFieldCaptionKeydown:function(t){this.updateCaptionDebounced(t)},updateCaption:function(t){var e=Object(o.a)(t.target),i=this.getPredicate(e),s=e.val(),n=e.closest(".js-field").data("type");if("submit"===n)this.changeButton(s||hs("submit"));else if("submitAfter"===n)this.changeButtonAfterSubmit(s||""),this.model.get("submit_mode")!==this.SUBMIT_MODES.textAfterSubmit&&this.updateClasses(s),this.isPageMode()&&!this.getUrlData(s).result&&(this.changeButtonAfterSubmit(""),this.model.set("link_after_submit",""));else{var a=this.getField(i);s=s||hs(a.tp),this.block.changeField(i,{caption:s})}},updateClasses:function(t){var e=this.$el.find(".form-fields-placeholder-selector");e.hasClass("remove-icon")&&e.removeClass("remove-icon"),e.toggleClass("js-submit-dropdown-trigger",!this.getUrlData(t).result),e.toggleClass("action-icon",this.getUrlData(t).result)},onActionIconClick:function(){var t=this.$el.find(".form-fields-placeholder-selector"),e=this.model.get("button_caption_after_submit");t.addClass("remove-icon"),this.model.set("link_after_submit",this.getUrlData(e).url)},onRemoveIconClick:function(){var t=this.$el.find(".form-fields-placeholder-selector"),e=this.$el.find(".form-fields-caption-submitAfter");t.removeClass("action-icon remove-icon").addClass("js-submit-dropdown-trigger"),e.val(""),this.changeButtonAfterSubmit(""),this.model.set("link_after_submit","")},onFieldsChange:function(){this.renderContent()},onFieldTypeChange:function(t,e){var i=this.idMap[t.sort],s=this.$el.find(".js-settings-popup[data-id="+i+"]");s.find(".js-field-type").removeClass("selected"),s.find(".js-field-type[data-value="+t.tp+"]").addClass("selected"),this.reRenderField(i,e)},onFieldCaptionChange:function(t){if("dropdown"===t.tp){var e=this.idMap[t.sort];this.$el.find(".js-field[data-id="+e+"]").find(".js-field-caption").val(ls(t.tp,t.caption))}},onDropdownItemsChange:function(t,e){this.block.changeField({sort:t.get("sort")},{items:s.a.clone(e)})},onDropdownHeightChange:function(t){(t>0||t<0&&this.getContentOverflow(t)<=0)&&this.updatePanelHeight(this.$panel.height()+t)},onDropdownCaptionChange:function(t,e){this.block.changeField({sort:t.get("sort")},{caption:e||hs("dropdown")})},onDropdownSave:function(t){var e={caption:t.caption,items:s.a.clone(t.items)};this.block.changeField({sort:t.sort},e),this.save()},onPanelScroll:function(){this.hideSettingsPopups()},toggleSettingsPopup:function(t,e){t.is(".shown")?this.hideSettingsPopup(t):this.showSettingsPopup(t,e)},showSettingsPopup:function(t,e){this.hideSettingsPopups(),s.a.isUndefined(e)||(t.css(e),t.removeClass("below"),t[0].getBoundingClientRect().top<0&&t.addClass("below")),t.addClass("shown")},hideSettingsPopup:function(t){t.removeClass("shown")},hideSettingsPopups:function(){this.hideSettingsPopup(this.$el.find(".js-settings-popup"))},hasSettingsPopupsOpen:function(){return Boolean(this.$el.find(".js-settings-popup.shown").length)},onSubmitArrowClick:function(t){var e=Object(o.a)(t.target),i=e.offset().top-this.$scrollable.offset().top+1.5*e.height(),s=this.$scrollable.height()-i;this.toggleSettingsPopup(this.$submitPopup,{bottom:s})},hideDropdownPanels:function(){s.a.each(this.dropdownPanels,(function(t){t.hide()}))},hasDropdownPanelsOpen:function(){return Boolean(s.a.find(this.dropdownPanels,(function(t){return t.isShown()})))},getPredicate:function(t){var e=s.a.isString(t)?t:Object(o.a)(t).closest("[data-id]").data("id"),i=s.a.invert(this.idMap)[e];return{sort:i?parseInt(i):i}},addField:function(t){var e=s.a.clone(this.model.get("fields")),i=s.a.max(e,"sort").sort||0,o={tp:t.tp,caption:hs(t.tp),optional:!1,sort:i+1};"dropdown"===o.tp&&(o.items=this.getDefaultDropdownItems()),e.push(o),this.model.set("fields",e),this.model.trigger("field:add",o),s.a.defer(function(){this.block.trigger("resize")}.bind(this))},changeField:function(t,e){var i=s.a.clone(this.model.get("fields")),o=s.a.findIndex(i,t),n=i[o],a={};s.a.each(e,(function(t,e){a[e]=s.a.clone(n[e])})),null===(n=s.a.extend(s.a.clone(n),e)).items&&delete n.items,i[o]=n,this.model.set("fields",i),s.a.each(e,function(t,e){this.model.trigger("field:"+e+":change",n,a[e])}.bind(this)),this.model.trigger("field:change",n)},changeFieldType:function(t,e){var i=this.getField(t);if(i&&i.tp!==e){var s={tp:e};cs(i.tp,i.caption)&&(s.caption=hs(e)),"dropdown"===e?s.items=this.getDefaultDropdownItems():"dropdown"===i.tp&&(s.items=null),this.block.changeField(t,s)}},getField:function(t){var e=s.a.find(this.model.get("fields"),t);return e?s.a.clone(e):e},getDefaultDropdownItems:function(){return[hs("option"),hs("option")]},changeButton:function(t){this.model.set("button-caption",t)},changeButtonAfterSubmit:function(t){this.model.set("button_caption_after_submit",t)},deleteField:function(t){var e=this.model.get("fields");e.length>1&&(e=s.a.reject(e,t),this.model.set("fields",e),this.model.trigger("field:delete",t))},reorder:function(){var t=[],e={};s.a.each(this.$content.find(".js-sortable"),function(i,s){var o=this.getPredicate(i),n=this.getField(o);e[s]=this.idMap[n.sort],n.sort=s,t.push(n)}.bind(this)),this.model.set("fields",t),this.idMap=e,this.$dropdownPanelContainer.empty().append(this.renderDropdowns()),this.model.trigger("fields:reorder")},refreshSort:function(){Object(o.a)(this.$content).sortable("refresh")},scrollToBottom:function(){this.$scrollable.animate({scrollTop:this.$content.height()-this.$scrollable.height()})},getContentOverflow:function(t){return this.$content.height()-(this.$content.parent().height()+(t||0))},resizeToFit:function(){var t=[];t.push(this.getContentOverflow()),s.a.each(this.dropdownPanels,(function(e){t.push(e.getContentOverflow())}));var e=Math.max.apply(null,t);this.updatePanelHeight(this.$panel.height()+e)},canControlBeClosed:function(){return this.hasSettingsPopupsOpen()?(this.hideSettingsPopups(),!0):ps.canControlBeClosed.apply(this,arguments)},save:function(){this.model.save({})},destroyDropdowns:function(){s.a.each(this.dropdownPanels,(function(t){t.destroy()})),this.dropdownPanels={},s.a.each(this.dropdownModels,function(t){this.stopListening(t)}.bind(this)),this.dropdownModels=[]},destroy:function(){this.destroyDropdowns(),ps.destroy.apply(this,arguments)}}),gs=a.a.View.extend({SCROLL_GAP_START:4,SCROLL_GAP_END:4,originalState:null,events:{"click .js-add-option":"onAddOptionClick","click .js-delete-option":"onDeleteOptionClick","click .js-cancel-dropdown":"onCancelDropdownClick","click .js-save-dropdown":"onSaveDropdownClick","keydown .js-dropdown-caption":"onCaptionKeydown","keydown .js-dropdown-option-value":"onOptionKeydown"},initialize:function(t){this.model=t.model,this.template=as.a["template-constructor-control-form_content-dropdown"]},rememberState:function(){var t=this.model.attributes;this.originalState=JSON.parse(JSON.stringify(t))},render:function(){var t=this.template();return this.setElement(t),this.$scrollable=this.$el.find(".resizable-content-wrapper"),this.$content=this.$el.find(".js-dropdown-content"),this.$captionContainer=this.$el.find(".js-dropdown-caption-container"),this.$optionsContainer=Object(o.a)(this.$el.find(".js-dropdown-options-container")),this.resizableScroll=Object(o.a)(this.$el.find(".resizable-scroll-wrapper")).RMScroll({$container:this.$el.find(".resizable-content-wrapper"),$content:this.$el.find(".resizable-content"),$handle:this.$el.find(".resizable-scroll"),wheelScrollSpeed:.4,gap_start:this.SCROLL_GAP_START,gap_end:this.SCROLL_GAP_END}).data("scroll"),this.$optionsContainer.sortable({items:".js-sortable",distance:10,axis:"y",scrollSpeed:10,containment:"parent",tolerance:"pointer",start:this.onSortStart.bind(this),stop:this.onSortEnd.bind(this)}),this.renderContent(),this.bindLogic(),this},renderContent:function(){this.$captionContainer.empty().append(this.renderCaption()),this.$optionsContainer.empty().append(this.renderDropdownOptions()),this.refreshSort(),this.resizableScroll&&this.resizableScroll.recalc()},renderCaption:function(){var t=as.a["template-constructor-control-form_content-dropdown-caption"],e=this.model.get("caption");return t({text:ls("dropdownEditMode",e),placeholder:hs("dropdownEditMode")})},renderDropdownOptions:function(){var t=Object(o.a)(document.createDocumentFragment()),e=as.a["template-constructor-control-form_content-dropdown-option"];return s.a.each(this.model.get("items"),function(i,s,o){var n=e({text:ls("option",i),number:s+1,placeholder:hs("option"),showDelete:o.length>1});t.append(n)}.bind(this)),t},bindLogic:function(){this.listenTo(this.model,"item:add",this.onModelChange),this.listenTo(this.model,"item:delete",this.onModelChange),this.listenTo(this.model,"revert",this.onModelChange),this.listenTo(this.model,"reorder",this.onModelChange),this.updateCaptionDebounced=ds(this.updateCaption.bind(this),300),this.updateOptionDebounced=ds(this.updateOption.bind(this),300)},unbindLogic:function(){this.stopListening(this.model)},refreshSort:function(){Object(o.a)(this.$optionsContainer).sortable("refresh")},onSortStart:function(){this.$el.find(":input").blur(),this.$el.addClass("grabbing")},onSortEnd:function(){this.$el.removeClass("grabbing"),this.reorder(),this.$el.find(".js-dropdown-option").attr("style","")},onAddOptionClick:function(){this.addOption(),this.$el.find(".js-dropdown-option-value:last").focus();var t=this.getContentOverflow();t>0&&this.model.trigger("change:height",t),this.scrollToBottom()},onDeleteOptionClick:function(t){var e=Object(o.a)(t.target).closest("[data-number]").data("number"),i=e?parseInt(e)-1:-1;this.deleteOption(i)},onCancelDropdownClick:function(){this.revert(),this.hide()},onSaveDropdownClick:function(){this.save(),this.hide()},onCaptionKeydown:function(t){this.updateCaptionDebounced(t)},onOptionKeydown:function(t){this.updateOptionDebounced(t)},updateCaption:function(t){var e=Object(o.a)(t.target).val()||hs("dropdown");this.model.set("caption",e)},updateOption:function(t){var e=Object(o.a)(t.target),i=e.val(),n=parseInt(e.data("number"))-1,a=s.a.clone(this.model.get("items"));a[n]=i||hs("option"),this.model.set("items",a)},onModelChange:function(){this.renderContent()},addOption:function(){var t=s.a.clone(this.model.get("items")),e=hs("option");t.push(e),this.model.set("items",t),this.model.trigger("item:add",e)},deleteOption:function(t){var e=s.a.clone(this.model.get("items"));e.splice(t,1),this.model.set("items",e),this.model.trigger("item:delete",t)},reorder:function(){var t=[],e=this.model.get("items");s.a.each(this.$optionsContainer.find(".js-sortable"),(function(i){var s=parseInt(Object(o.a)(i).data("number")),n=e[s-1];t.push(n)})),this.model.set("items",t),this.model.trigger("reorder")},scrollToBottom:function(){this.$scrollable.animate({scrollTop:this.$content.height()-this.$scrollable.height()})},getContentOverflow:function(t){return this.$content.height()-(this.$content.parent().height()+(t||0))},isShown:function(){return this.$el.is(".shown")},show:function(){this.$el.addClass("shown"),this.rememberState()},hide:function(){this.$el.removeClass("shown")},save:function(){this.model.trigger("save",this.model.attributes)},revert:function(){this.model.set("caption",this.originalState.caption),this.model.set("items",s.a.clone(this.originalState.items)),this.model.trigger("revert")},destroy:function(){this.unbindLogic()}}),ms=us,fs=i("tzyo"),vs=i.n(fs),bs=h.prototype,_s=h.extend({name:"form_endpoints",className:"control form_endpoints",events:{"click .connect-button:not(.disabled)":"onConnectButtonClick","click .action-icon":"onActionIconClick","input .reach-input":"onReachInputChange","change .list-select":"onListSelectChange","click .try-another":"tryAnotherClick","click .change-email":"changeEmailClick","click .cancel":"cancelRequestClick","click .resend":"resendCodeClick","click .back":"backClick","change .choice-email":"onEmailsSelectChange"},saveOnDeselect:!0,saveOnDestroy:!0,GOOGLE_DEFAULT_SHEET_NAME:"New Form",initialize:function(t){this.template=vs.a["template-constructor-control-form_endpoints"],this.listOptionsTemplate=vs.a["template-constructor-control-form_endpoints-list-selector"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model,this.switchers={}},render:function(){var t=[],e=RM.constructorRouter.me.get("additionalEmails");e&&e.length>0&&(e.forEach((function(e){!0===e.confirmed&&t.push(e)})),this.model.set("endpoint_additonal_emails",t)),bs.render.apply(this,arguments),this.createSwitchers(),this.$confirmationView=this.$(".panel-section.second_email .confirmation"),this.$emailNew=this.$(".panel-section.second_email .new-email"),this.$inputWrapper=this.$(".panel-section.second_email .input-wrapper"),this.$selectWrapper=this.$(".panel-section.second_email .choice-email"),this.$changeEmail=this.$(".panel-section.second_email .change-email"),this.$(".current-email").text(RM.constructorRouter.me.get("email"));var i=this.$(".input-sheet-name"),s=this.getEndpointParam("google","sheet_name");s&&(i.val(s),this.setReachInputIcon(i,"remove-icon"));var n=this.$(".input-custom-url"),a=this.getEndpointParam("url","custom_url")||"";n.val(a),this.setReachInputIcon(n,a?"remove-icon":"hidden"),this.$panel=this.$(".panel"),RM.constructorRouter.mag.get("shared")&&this.$el.addClass("disabled no-hover"),this.setEmailsView(),Object(o.a)(window).on("resize",this.updateSwitchers)},renderListOptions:function(t,e){this.$(".list-select").html(this.listOptionsTemplate({lists:t,selected:e,_:s.a}))},setEndpointParam:function(t,e,i,o){var n,a="endpoint_"+t,r=this.model.get(a)||{},l={};if("google"==t&&"sheet_name"==e&&i!==r.sheet_name&&delete r.sheet_id,l[e]=i,"additonal_emails"==t)return(n=s.a.isEmpty(r)?[]:r).push(l),void this.model.set(a,n);this.model.set(a,s.a.extend({},r,l),o)},getEndpointParam:function(t,e){var i="endpoint_"+t;return(this.model.get(i)||{})[e]},onReachInputChange:function(t){var e=t instanceof o.a?t:Object(o.a)(t.currentTarget),i=e.val().trim();this.setReachInputIcon(e,i&&this.validateInput(e)?"apply-icon":"hidden")},validateInput:function(t){var e=t.val().trim(),i=t.attr("data-provider");return"url"===i?/http(s?):\/\/.+/i.test(e):"second_email"===i?/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e):"confirmation-code"!==i||4===e.length&&!isNaN(e)},setReachInputIcon:function(t,e){t.closest(".input-wrapper").find(".action-icon").removeClass(["apply-icon","remove-icon","preloader-icon","hidden"].join(" ")).addClass(e)},checkPanelPosition:function(t){if(Object(o.a)(".control.form_endpoints").hasClass("checked")){var e=Object(o.a)(".panel."+t).outerHeight();Object(o.a)(window).height()<=768&&e>=450&&Object(o.a)(".panel").css({top:-Math.round(e/2.3)}),e<450&&Object(o.a)(".panel").css({top:-149})}},createSwitchers:function(){this.model;var t=this.$(".switcher"),e=["google","mailchimp"];s.a.each(t,function(t){var i=Object(o.a)(t),n=i.attr("data-provider");this.switchers[n]=i.RMSwitcher({state:!1,height:26,width:44,"color-0":"#0078ff","color-1":"#c9c8c9","text-color-0":"transparent","text-color-1":"transparent"},this.getSwitcherHandler(n)).data("switcher");s.a.contains(e,n)&&this.checkAccountConnected(n)}.bind(this)),this.updateState()},getSwitcherHandler:function(t){return function(e){s.a.delay(function(){this.setEndpointParam(t,"enabled",e)}.bind(this),300)}.bind(this)},checkAccountConnected:function(t,e){var i=this.$(".connect-button[data-provider="+t+"]");i.addClass("disabled"),this.xhr=o.a.ajax({dataType:"json",url:"/api/connect/forms/"+t+"/check",method:"GET",success:function(e){this.onSuccessfulConnect(t,e)}.bind(this),error:function(){this.switchers[t].setState(!1)}.bind(this),complete:function(){i.removeClass("disabled")}.bind(this)})},onSuccessfulConnect:function(t,e){e=e||{},this.$(".connect-button[data-provider="+t+"]").closest(".switcher-wrapper").removeClass("disconnected"),"mailchimp"==t&&e.accessToken&&this.updateMailchimpList(e)},updateMailchimpList:function(t){var e=this.$(".input-list-name"),i=this.$(".list-select");this.setReachInputIcon(e,"preloader-icon"),i.prop("disabled",!0),this.xhr=o.a.ajax({dataType:"json",url:"/api/connect/forms/mailchimp/lists",method:"GET",success:function(t){var s=(t=t||{}).lists||[];if(s.length){var o=this.getEndpointParam("mailchimp","list_id");this.renderListOptions(s,o),this.onListSelectChange(),i.prop("disabled",!1)}else e.val("No lists")}.bind(this),error:function(t){console.log("xhr : ",t)}.bind(this),complete:function(){this.setReachInputIcon(e,"hidden")}.bind(this)})},onListSelectChange:function(){var t=this.$(".list-select"),e=(t.val(),t.find("option:selected"));this.$(".input-list-name").val(e.text()),this.setEndpointParam("mailchimp","list_id",e.val()),RM.analytics&&RM.analytics.sendEvent("Form Storage Delete Endpoint Param","mailchimp "+e.text())},processWindowMessage:function(t){var e;if((t=t.originalEvent||{}).origin==r.a.readymag_auth_host){try{e=JSON.parse(decodeURIComponent(t.data))}catch(t){}e&&"social-auth"==e.event&&(Object(o.a)(window).off("message",this.processWindowMessage),this.AuthWindow&&this.AuthWindow.close(),this.AuthWindow=null,this.handleAuthResult(e.message))}},startOauth:function(t){this.AuthWindow&&this.AuthWindow.close(),Object(o.a)(window).on("message",this.processWindowMessage);var e=screen.width,i=screen.height,s=Math.min(1e3,e),n=Math.min(700,i-40),a=Math.ceil((e-s)/2),r=Math.ceil((i-n)/2);this.AuthWindow=window.open("/api/connect/forms/"+t+"/connect","_blank",["toolbar=no","location="+(window.opera?"no":"yes"),"directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no","width="+s,"height="+n,"top="+r,"left="+a].join())},handleAuthResult:function(t){var e=((t=t||{}).data||{}).provider;e&&(this.onSuccessfulConnect(e,t.data),this.switchers[e].setState(!0),RM.analytics&&RM.analytics.sendEvent("Form Storage Successful OAuth Result",e))},onConnectButtonClick:function(t){var e=Object(o.a)(t.currentTarget).attr("data-provider");"google"==e&&this.startOauth("google"),"mailchimp"==e&&this.startOauth("mailchimp"),RM.analytics&&RM.analytics.sendEvent("Form Storage Connect Click",e)},onActionIconClick:function(t){var e=Object(o.a)(t.currentTarget),i=e.closest(".input-wrapper").find("input"),s=i.val().trim(),n=i.attr("data-provider");if(e.hasClass("remove-icon"))i.val(""),this.onReachInputChange(i),"google"==n&&(this.setEndpointParam("google","sheet_name",null),this.setEndpointParam("google","sheet_id",null)),"url"==n&&this.setEndpointParam("url","custom_url",null),RM.analytics&&RM.analytics.sendEvent("Form Storage Delete Endpoint Param",n);else if(e.hasClass("apply-icon")){if(this.setReachInputIcon(i,"remove-icon"),"google"==n)this.getEndpointParam("google","sheet_name")==s||(this.setReachInputIcon(i,"preloader-icon"),this.createSheet(s,function(t,e){this.setReachInputIcon(i,t?"apply-icon":"remove-icon"),!t&&e.spreadsheetId?(this.setEndpointParam("google","sheet_name",s),this.setEndpointParam("google","sheet_id",e.spreadsheetId),RM.analytics&&RM.analytics.sendEvent("Form Storage Set Endpoint Param",n+' "'+s+'"')):RM.analytics&&RM.analytics.sendEvent("Form Storage Set Endpoint Param",n+" error")}.bind(this)));"url"==n&&(this.setEndpointParam("url","custom_url",s),RM.analytics&&RM.analytics.sendEvent("Form Storage Set Endpoint Param",n+" "+s)),"second_email"==n&&(this.addEmail(s,i),RM.analytics&&RM.analytics.sendEvent("Form Storage Set Endpoint Param",n+" "+s)),"confirmation-code"==n&&this.checkConfirmationCode(s,i)}},addEmail:function(t,e){var i={additonal_email:t,mag_title:RM.constructorRouter.mag.get("title")?RM.constructorRouter.mag.get("title"):"Project Title",page_number:RM.constructorRouter.workspace.getPageNum()};this.xhr=o.a.ajax({dataType:"json",url:"/api/me/addemail",method:"POST",data:i,success:function(){this.$(".panel-section.second_email .back").hasClass("hidden")||this.$(".panel-section.second_email .back").addClass("hidden"),this.$confirmationView.removeClass("hidden"),e.val(""),this.$(".panel-section.second_email .email-for-confirmation").text(t),e.attr("data-provider","confirmation-code"),this.onReachInputChange(e),e.addClass("padding-right-zero"),e.attr("type","text"),e.attr("placeholder","and paste code"),this.checkPanelPosition("second_email")}.bind(this),error:function(e){this.$inputWrapper.addClass("hidden"),this.$(".panel-section.second_email .error.email-for-confirmation").text(t),this.$(".panel-section.second_email .error-block").removeClass("hidden"),console.log("xhr : ",e)}.bind(this)})},setEmailsView:function(t){var e,i,s,n,a=this.model.get("endpoint_additonal_emails")?this.model.get("endpoint_additonal_emails").length:0,r=this.getEndpointParam("selected_email","last_selected_email")?this.getEndpointParam("selected_email","last_selected_email"):"";t=t||r;if(0===a)this.setInputView();else if(1===a)this.$emailNew.removeClass("hidden"),this.$emailNew.text(t),r||this.setEndpointParam("selected_email","last_selected_email",t),this.$inputWrapper.addClass("hidden"),this.$changeEmail.removeClass("hidden");else{e=this.model.get("endpoint_additonal_emails"),0!==(i=Object(o.a)(".panel-section.second_email .choice-email select")).children("option").length&&i.children("option").remove(),n=e.map((function(t){return t.additonal_email})),r&&!n.includes(r)&&n.push(r);for(var l=0;l<n.length;l++)s=Object(o.a)("<option></option>").text(n[l]),i[0].add(s[0]);i.children("option").filter((function(){return Object(o.a)(this).text()===t})).prop("selected",!0),this.setEndpointParam("selected_email","last_selected_email",t),this.$inputWrapper.addClass("hidden"),this.$changeEmail.removeClass("hidden"),this.$selectWrapper.removeClass("hidden")}},checkConfirmationCode:function(t,e){var i={confirmation_code:t},n=this.$(".panel-section.second_email .confirmation .confirmation.email-for-confirmation").text();this.xhr=o.a.ajax({dataType:"json",url:"/api/me/checkcode",method:"POST",data:i,success:function(){this.setEndpointParam("additonal_emails","additonal_email",n),this.setEmailsView(n),this.$confirmationView.addClass("hidden")}.bind(this),error:function(t){e.addClass("err-code"),setTimeout(s.a.bind((function(){e.removeClass("err-code"),e.val(""),this.$(".panel-section.second_email .input-wrapper .action-icon").removeClass("remove-icon").addClass("hidden")}),this),3e3),console.log("xhr : ",t)}.bind(this)})},backClick:function(){var t=this.getEndpointParam("selected_email","last_selected_email");this.setEmailsView(t),this.$(".panel-section.second_email .back").addClass("hidden")},tryAnotherClick:function(){this.$inputWrapper.removeClass("hidden"),this.$(".panel-section.second_email .error-block").addClass("hidden")},setInputView:function(){var t=this.$(".panel-section.second_email .input-second-email");t.val(""),t.removeClass("padding-right-zero"),t.attr("type","email"),t.attr("placeholder","Add email"),this.$inputWrapper.removeClass("hidden"),t.attr("data-provider","second_email"),this.$(".panel-section.second_email .input-wrapper .action-icon").removeClass("remove-icon").addClass("hidden")},changeEmailClick:function(){this.$(".panel-section.second_email .input-second-email");this.$(".panel-section.second_email .back").removeClass("hidden"),this.model.get("endpoint_additonal_emails").length>1&&this.$(".panel-section.second_email .back").text("Back to list"),this.$selectWrapper.hasClass("hidden")||this.$selectWrapper.addClass("hidden"),this.setInputView(),this.$emailNew.addClass("hidden"),this.$changeEmail.addClass("hidden")},onEmailsSelectChange:function(){var t;Object(o.a)(".choice-email option:selected").each((function(){t=Object(o.a)(this).val()})),this.setEndpointParam("selected_email","last_selected_email",t)},resendCodeClick:function(){var t={additonal_email:this.$(".panel-section.second_email .confirmation .email-for-confirmation").text(),mag_title:RM.constructorRouter.mag.get("title")?RM.constructorRouter.mag.get("title"):"Project Title",page_number:RM.constructorRouter.workspace.getPageNum()};this.xhr=o.a.ajax({dataType:"json",url:"/api/me/resendcode",method:"POST",data:t,success:function(){setTimeout(s.a.bind((function(){this.$(".panel-section.second_email .confirmation.resend").text("Resend confirmation")}),this),4e3),this.$(".panel-section.second_email .confirmation.resend").text("Confirmation sent")}.bind(this),error:function(t){console.log("xhr : ",t)}.bind(this)})},cancelRequestClick:function(){var t={additonal_email:this.$(".panel-section.second_email .confirmation .email-for-confirmation").text()};this.xhr=o.a.ajax({dataType:"json",url:"/api/me/cancelrequest",method:"POST",data:t,success:function(){this.setEmailsView(),this.$confirmationView.addClass("hidden")}.bind(this),error:function(t){console.log("xhr : ",t)}.bind(this)})},createSheet:function(t,e){this.xhr=o.a.ajax({dataType:"json",url:"/api/connect/forms/google/createsheet",method:"POST",data:{title:t},success:function(t){e(null,t.sheet)}.bind(this),error:function(t){console.log("xhr : ",t),e(t.responseText)}.bind(this)})},setSectionCollapsed:function(t,e){this.$(".panel-section."+t).toggleClass("collapsed",e),this.$panel.toggleClass(t,!e)},hasMailchimpFields:function(){var t=this.model.get("fields");return s.a.any(t,(function(t){return"email"==t.tp&&!t.optional}))},onFieldsChange:function(){this.updateState()},onEndpointsChange:function(){this.updateState()},getEndpointProviders:function(){return s.a.map(this.$(".switcher"),(function(t){return Object(o.a)(t).attr("data-provider")}))},updateState:function(){var t=this.hasMailchimpFields(),e=this.getEndpointProviders();this.allExceptEmailDisabled=!0,s.a.each(s.a.without(e,"email"),function(e){var i=!!this.getEndpointParam(e,"enabled");"mailchimp"==e&&(t||(this.setEndpointParam(e,"enabled",!1,{silent:!0}),i=!1),this.$(".panel-section.mailchimp").find(".switcher-wrapper").toggleClass("forbidden",!t)),i&&(this.allExceptEmailDisabled=!1)}.bind(this)),this.allExceptEmailDisabled&&this.setEndpointParam("email","enabled",!0,{silent:!0}),this.updateSwitchers()},updateSwitchers:function(){s.a.each(s.a.keys(this.switchers),function(t){var e=this.switchers[t],i=!!this.getEndpointParam(t,"enabled");e.setState(i,!0),this.setSectionCollapsed(t,!i),"email"==t&&e.setDisabled(!!this.allExceptEmailDisabled),i&&this.checkPanelPosition(t)}.bind(this))},bindLogic:function(){this.listenTo(this.model,"change:fields",this.onFieldsChange),this.listenTo(this.model,"change:endpoint_email change:endpoint_second_email change:endpoint_google change:endpoint_mailchimp change:endpoint_url",this.onEndpointsChange)},unBindLogic:function(){this.stopListening(this.model)},save:function(){this.model.save({})},deselect:function(){this.getEndpointParam("google","sheet_id")||this.setEndpointParam("google","enabled",!1),this.getEndpointParam("mailchimp","list_id")||this.setEndpointParam("mailchimp","enabled",!1),this.getEndpointParam("url","custom_url")||this.setEndpointParam("url","enabled",!1),this.updateState(),bs.deselect.apply(this,arguments)},destroy:function(){this.xhr&&this.xhr.abort(),Object(o.a)(window).off("message",this.processWindowMessage),bs.destroy.apply(this,arguments)}}),ws=i("tVJf"),ys=i.n(ws),ks=h.extend({name:"form_styles",className:"control form_styles",saveOnDeselect:!0,saveOnDestroy:!0,initialize:function(t){this.template=ys.a["template-constructor-control-form_styles"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model,this.state="fields",this.buttonState="default"},bindLogic:function(){var t=this;function e(e,i,s){t.inputs[e][i]=Object(o.a)(t.$panel.find(".edit-wrapper .params-block.params-"+e+' .edit-item[data-field="'+i+'"] input')).RMNumericInput(s).data("changeValue")}this.$colorbox_container=this.$(".colorbox_container"),this.$panel.on("click",".edit-wrapper",this.closeAllEditPopups),this.$panel.on("click",".edit-wrapper .layout-wrapper .layout-switcher",this.onLayoutSwitchClick),this.$panel.on("click",".edit-wrapper .style-wrapper .prev-style",this.onStyleSwitchClick),this.$panel.on("click",".edit-wrapper .style-wrapper .next-style",this.onStyleSwitchClick),this.$panel.on("click",".edit-wrapper .type-wrapper .type-switcher",this.onTypeSwitchClick),this.$panel.on("click",".edit-wrapper .button-switcher-wrapper .button-switcher",this.onButtonSwitchClick),this.$panel.on("click",".edit-wrapper .color-click-area",this.onColorboxShowClick),this.colorbox=new Pe.a({$parent:this.$colorbox_container,type:"small"}),this.colorbox.on("colorchange",this.colorOpacityChanged),this.colorbox.on("opacitychange",this.colorOpacityChanged),this.fontselector=new $e.a({$parent:this.$(".fontselector_container")}),this.fontselector.on("selectfont",this.fontChanged),this.$panel.on("click",".edit-wrapper .font-family-click-area",this.onFontSelectorShowClick),this.$panel.on("click",".edit-wrapper .font-style-click-area",this.onFontStyleShowClick),this.$panel.on("click",".edit-wrapper .align",this.onAlignChangeClick),this.model.on("change",this.onChange),this.inputs={fields:{},"button-default":{},"button-hover":{}},e("fields","gutter",{min:-99,max:999,mouseSpeed:4,onChange:this.onEditInputChanged}),e("fields","border-radius",{min:0,max:999,mouseSpeed:4,onChange:this.onEditInputChanged}),e("fields","border-width",{min:0,max:999,mouseSpeed:4,onChange:this.onEditInputChanged}),e("fields","underline-width",{min:0,max:99,mouseSpeed:4,onChange:this.onEditInputChanged}),e("fields","font-size",{min:this.block.MIN_FONT_SIZE,max:this.block.MAX_FONT_SIZE,mouseSpeed:4,onChange:this.onEditInputChanged}),e("fields","letter-spacing",{min:this.block.MIN_LETTER_SPACING,max:this.block.MAX_LETTER_SPACING,mouseDir:"h",useFloat:!0,step:.2,mouseSpeed:4,onChange:this.onEditInputChanged}),e("button-default","gutter",{min:0,max:999,mouseSpeed:4,onChange:this.onEditInputChanged}),e("button-default","border-radius",{min:0,max:999,mouseSpeed:4,onChange:this.onEditInputChanged}),e("button-default","border-width",{min:0,max:999,mouseSpeed:4,onChange:this.onEditInputChanged}),e("button-default","font-size",{min:this.block.MIN_FONT_SIZE,max:this.block.MAX_FONT_SIZE,mouseSpeed:4,onChange:this.onEditInputChanged}),e("button-default","letter-spacing",{min:this.block.MIN_LETTER_SPACING,max:this.block.MAX_LETTER_SPACING,mouseDir:"h",useFloat:!0,step:.2,mouseSpeed:4,onChange:this.onEditInputChanged}),e("button-hover","border-width",{min:0,max:999,mouseSpeed:4,onChange:this.onEditInputChanged}),Object(o.a)(this.$panel.find('.edit-wrapper .params-block.params-button-hover .edit-item[data-field="transition"] .switcher')).RMSwitcher({state:this.getCurrentStyleParam("button-hover","transition"),width:44,height:26,"text-size-0":0,"text-size-1":0,"color-0":"#0078ff"},function(t){s.a.delay(function(){this.setCurrentStyleParam("button-hover","transition",t)}.bind(this),300)}.bind(this)).data("switcher"),this.setAlignText(),this.updateControlState(),this.updateStylesState()},unBindLogic:function(){this.$panel.off("click",".edit-wrapper",this.closeAllEditPopups),this.$panel.off("click",".edit-wrapper .layout-wrapper .layout-switcher",this.onLayoutSwitchClick),this.$panel.off("click",".edit-wrapper .style-wrapper .prev-style",this.onStyleSwitchClick),this.$panel.off("click",".edit-wrapper .style-wrapper .next-style",this.onStyleSwitchClick),this.$panel.off("click",".edit-wrapper .type-wrapper .type-switcher",this.onTypeSwitchClick),this.$panel.off("click",".edit-wrapper .button-switcher-wrapper .button-switcher",this.onButtonSwitchClick),this.$panel.off("click",".edit-wrapper .color-click-area",this.onColorboxShowClick),this.$panel.off("click",".edit-wrapper .align",this.onAlignChangeClick),this.colorbox&&(this.colorbox.off("colorchange",this.colorOpacityChanged),this.colorbox.off("opacitychange",this.colorOpacityChanged),this.colorbox.destroy(),this.colorbox=null),this.fontselector&&(this.fontselector.off("selectfont",this.fontChanged),this.$panel.off("click",".edit-wrapper .font-family-click-area",this.onFontSelectorShowClick),this.$panel.off("click",".edit-wrapper .font-style-click-area",this.onFontStyleShowClick),this.fontselector.destroy(),this.fontselector=null),this.model&&this.model.off(null,null,this)},onChange:function(t,e){(e.undo||e.redo)&&(this.updateControlState(),this.updateStylesState(e))},onAlignChangeClick:function(){var t=this.getCurrentStyleParam(this.getCurrentState(),"text-align")||"center";this.setCurrentStyleParam(this.getCurrentState(),"text-align","center"===t?"left":"center"),this.setAlignText(),this.updateControlState(),this.updateStylesState()},setAlignText:function(){var t=Object(o.a)(".edit-wrapper .align .caption"),e=this.getCurrentStyleParam(this.getCurrentState(),"text-align")||"center",i="center"===e?"center":"left";this.setCurrentStyleParam(this.getCurrentState(),"text-align",e),t.text("Aligned ".concat(i))},onLayoutSwitchClick:function(t){Object(o.a)(t.currentTarget).hasClass("layout-vertical")?this.model.set({layout:"vertical"}):this.model.set({layout:"horizontal"});var e=this.block.getDefaultDimensions();this.model.set({w:e.width,h:e.height}),this.updateControlState(),this.updateStylesState()},onStyleSwitchClick:function(t){var e=Object(o.a)(t.currentTarget).hasClass("prev-style")?-1:1,i=["colored","outlined","underlined"],n=(s.a.indexOf(i,this.model.get("style"))+i.length+e)%i.length;this.model.set("style",i[n]),this.setAlignText(),this.updateControlState(),this.updateStylesState()},onTypeSwitchClick:function(t){Object(o.a)(t.currentTarget).hasClass("type-fields")?this.state="fields":this.state="button",this.updateControlState(),this.updateStylesState()},onButtonSwitchClick:function(t){Object(o.a)(t.currentTarget).hasClass("button-default")?this.buttonState="default":this.buttonState="hover",this.updateControlState(),this.updateStylesState()},getCurrentStyleParam:function(t,e){var i="style-"+this.model.get("style")+"-"+t,s=this.model.get(i)[e];return"inherit"===s&&"button-default"==t&&(i="style-"+this.model.get("style")+"-fields",s=this.model.get(i)[e]),"inherit"===s&&"button-hover"==t&&(i="style-"+this.model.get("style")+"-button-default","inherit"===(s=this.model.get(i)[e])&&(i="style-"+this.model.get("style")+"-fields",s=this.model.get(i)[e])),s},setCurrentStyleParam:function(t,e,i){var o="style-"+this.model.get("style")+"-"+t,n=s.a.clone(this.model.get(o));if(n[e]=i,"font-family"==e){var a=this.getCurrentStyleParam(this.getCurrentState(),"font-weight"),r=this.getCurrentStyleParam(this.getCurrentState(),"font-style"),l=RM.constructorRouter.fonts.findFontByCSSName(i),c=("italic"==r.toLowerCase()?"i":"n")+Math.floor(a/100);s.a.contains(l.variations,c)||(n["font-weight"]=100*(l.variations[0]||"n4").slice(1))}this.model.set(o,n)},getCurrentState:function(){var t=this.state;return"button"==t&&(t+="-"+this.buttonState),t},updateControlState:function(){this.$(".edit-wrapper").attr("data-state",this.state).attr("data-button-state",this.buttonState).attr("data-style",this.model.get("style")).attr("data-layout",this.model.get("layout")),this.$(".style-wrapper .style-caption").text(r.b.capitalize(this.model.get("style"))),"button"==this.state&&"hover"==this.buttonState?this.block.setButtonHoverState():this.block.unsetButtonHoverState()},updateStylesState:function(t){t=t||{};var e=this.getCurrentState(),i=this.inputs[e],s=this.$panel.find(".edit-wrapper .params-block.params-"+e);if(["gutter","border-radius","border-width","underline-width","font-size","letter-spacing","text-align"].forEach(function(o){var n=s.find(".edit-item[data-field="+o+"] input"),a=i[o],r=this.getCurrentStyleParam(e,o);a&&(a(r,!0),t.undo||t.redo||this.onEditInputChanged(n,r))}.bind(this)),this.getCurrentStyleParam(e,"color")&&s.find('.edit-item[data-field="color"] .color-circle').css("background-color",r.b.getRGBA(this.getCurrentStyleParam(e,"color"),this.getCurrentStyleParam(e,"opacity")/100)),this.getCurrentStyleParam(e,"border-color")&&s.find('.edit-item[data-field="border-color"] .color-circle').css("background-color",r.b.getRGBA(this.getCurrentStyleParam(e,"border-color"),this.getCurrentStyleParam(e,"border-opacity")/100)),this.getCurrentStyleParam(e,"underline-color")&&s.find('.edit-item[data-field="underline-color"] .color-circle').css("background-color",r.b.getRGBA(this.getCurrentStyleParam(e,"underline-color"),this.getCurrentStyleParam(e,"underline-opacity")/100)),this.getCurrentStyleParam(e,"text-color")&&s.find('.edit-item[data-field="text-color"] .color-circle').css("background-color",r.b.getRGBA(this.getCurrentStyleParam(e,"text-color"),this.getCurrentStyleParam(e,"text-opacity")/100)),s.find(".font-family").length){var o=RM.constructorRouter.fonts.findFontByCSSName(this.getCurrentStyleParam(e,"font-family")),n=RM.constructorRouter.fonts.getStyleName(this.getCurrentStyleParam(e,"font-weight"),this.getCurrentStyleParam(e,"font-style"),o.name);s.find(".font-family").text(o.name).css("font-family",o.css_name),s.find(".font-style").text(n).css({"font-family":o.css_name,"font-style":this.getCurrentStyleParam(e,"font-style"),"font-weight":this.getCurrentStyleParam(e,"font-weight")})}},onEditInputChanged:function(t,e){var i=t.closest(".edit-item").attr("data-field"),s=(e-this.getCurrentStyleParam(this.getCurrentState(),i))*("fields"==this.state?this.model.get("fields").length:1),o="vertical"==this.model.get("layout")?"h":"w";if(this.setCurrentStyleParam(this.getCurrentState(),i,e),"gutter"==i&&this.model.set(o,this.model.get(o)+s),"font-size"==i||"underline-width"==i){var n=this.block.getMinimalDimensions();(n.width>this.model.get("w")||n.height>this.model.get("h"))&&this.model.set({w:Math.max(n.width,this.model.get("w")),h:Math.max(n.height,this.model.get("h"))})}},fontChanged:function(t){this.setCurrentStyleParam(this.getCurrentState(),"font-family",t),this.updateStylesState()},fontStyleChanged:function(t){this.setCurrentStyleParam(this.getCurrentState(),"font-weight",Object(o.a)(t.currentTarget).attr("data-font-weight")),this.setCurrentStyleParam(this.getCurrentState(),"font-style",Object(o.a)(t.currentTarget).attr("data-font-style")),this.closeFontStyle(),this.updateStylesState()},colorOpacityChanged:function(t,e,i,s){var o=this.colorbox.rgb2hex([t,e,i]),n=100*s;this.setCurrentStyleParam(this.getCurrentState(),this.colorbox_for_field,o),this.setCurrentStyleParam(this.getCurrentState(),this.colorbox_for_field_dop,n),this.updateStylesState()},onFontSelectorShowClick:function(t){this.fontselector_visible?this.closeFontSelector():(this.closeAllEditPopups(),this.fontselector_visible=!0,this.fontselector&&this.fontselector.show([this.getCurrentStyleParam(this.getCurrentState(),"font-family")]),this.positionPopup(this.$(".fontselector_container"),Object(o.a)(t.currentTarget)))},onFontStyleShowClick:function(t){if(this.fontstyle_visible)this.closeFontStyle();else{this.closeAllEditPopups();var e=this.$(".fontstyle_container .font-style-wrapper");e.empty();var i=RM.constructorRouter.fonts.findFontByCSSName(this.getCurrentStyleParam(this.getCurrentState(),"font-family"));i&&(s.a.each(i.variations,function(t){var s=100*(t.substr(1,1)-0),n="n"==t.substr(0,1)?"normal":"italic",a=RM.constructorRouter.fonts.getStyleName(s,n,i.name),r=Object(o.a)("<div>").appendTo(e).addClass("font-style-item").text(a).css({"font-family":i.css_name,"font-weight":s+"","font-style":n}).attr("data-font-weight",s).attr("data-font-style",n).on("click",this.fontStyleChanged);Object(o.a)("<div>").appendTo(r).addClass("point");s==this.getCurrentStyleParam(this.getCurrentState(),"font-weight")&&n==this.getCurrentStyleParam(this.getCurrentState(),"font-style")&&r.addClass("curr")}.bind(this)),this.fontstyle_visible=!0,this.$(".fontstyle_container").fadeIn(200),this.positionPopup(this.$(".fontstyle_container"),Object(o.a)(t.currentTarget)))}},onColorboxShowClick:function(t){var e=Object(o.a)(t.currentTarget),i=e.attr("data-field"),s=e.attr("data-field-dop"),n=200;if(this.colorbox_visible){if(i==this.colorbox_for_field)return void this.closeColorBox();this.closeColorBox(!0),n=0}this.closeAllEditPopups(),this.colorbox_visible=!0,this.$colorbox_container.fadeIn(n),"text-color"===i&&"fields"===this.state&&this.block.toggleInputValue(!0),this.colorbox_for_field=i,this.colorbox_for_field_dop=s,this.colorbox.setOpacity(this.getCurrentStyleParam(this.getCurrentState(),s)/100),this.colorbox.setColor(this.getCurrentStyleParam(this.getCurrentState(),i)),this.positionPopup(this.$colorbox_container,Object(o.a)(t.currentTarget))},positionPopup:function(t,e){var i=t.children().first().height(),s=this.$panel.height(),o=Math.floor((s-i)/2),n=e.offset().top-this.$panel.offset().top,a=Math.max(n+i-s+16,0);t.css({top:Math.max(o,n-a)})},closeFontSelector:function(){this.fontselector_visible=!1,this.fontselector.hide()},closeFontStyle:function(){this.fontstyle_visible=!1,this.$(".fontstyle_container").fadeOut(200)},closeColorBox:function(t){this.colorbox_visible=!1,this.$colorbox_container.fadeOut(t?0:200),"text-color"===this.colorbox_for_field&&"fields"===this.state&&this.block.toggleInputValue(!1)},onClick:function(){this.selected&&(this.colorbox_visible||this.fontselector_visible||this.fontstyle_visible)?this.closeAllEditPopups():h.prototype.onClick.apply(this,arguments)},closeAllEditPopups:function(t){if(t){if(Object(o.a)(t.target).closest(".color-click-area").length>0)return;if(Object(o.a)(t.target).closest(".font-family-click-area").length>0)return;if(Object(o.a)(t.target).closest(".font-style-click-area").length>0)return}this.colorbox_visible&&this.closeColorBox(),this.fontselector_visible&&this.closeFontSelector(),this.fontstyle_visible&&this.closeFontStyle()},canControlBeClosed:function(){return this.colorbox_visible||this.fontselector_visible||this.fontstyle_visible?(this.closeAllEditPopups(),!0):h.prototype.canControlBeClosed.apply(this,arguments)},save:function(){this.model.save({})},select:function(){h.prototype.select.apply(this,arguments),this.updateControlState()},deselect:function(){this.closeAllEditPopups(),"button"==this.state&&"hover"==this.buttonState&&setTimeout(function(){this.block.unsetButtonHoverState()}.bind(this),250),h.prototype.deselect.apply(this,arguments)},destroy:function(t){"button"==this.state&&"hover"==this.buttonState&&setTimeout(function(){this.block.unsetButtonHoverState()}.bind(this),250),h.prototype.destroy.apply(this,arguments)}}),Cs=_e.extend({name:"video_settings",alt:"Video",panelComponent:"panel-video",select:function(){_e.prototype.select.apply(this,arguments),Object(c.a)("controls-video_settings")},restrictions:function(t){var e=t.getSelectedBlocks();return 1===e.length&&"video"===e[0].model.get("type")},onPanelChange:function(t){_e.prototype.onPanelChange.apply(this,arguments),this.model.changed.hasOwnProperty("video_id")&&this.model.save({})}}),xs=_e.extend({name:"audio_settings",alt:"Settings",panelComponent:"panel-audio-settings",select:function(){_e.prototype.select.apply(this,arguments),Object(c.a)("controls-audio_settings")}}),Ss=_e.extend({name:"twitter_settings",alt:"Settings",panelComponent:"panel-twitter-settings"}),Ps=_e.extend({name:"facebook_settings",alt:"Settings",panelComponent:"panel-facebook-settings"}),$s=_e.extend({name:"iframe_edit",alt:"Edit Code",select:function(){_e.prototype.select.apply(this,arguments),this.block.showPanel()},deselect:function(){this.block.hidePanel(),_e.prototype.deselect.apply(this,arguments)},bindLogic:function(){this.block.on("editCodeClick",this.onClick)},unBindLogic:function(){this.block.off("editCodeClick")}}),Os=_e.extend({name:"cart_connections",alt:"Cart connections",panelComponent:"panel-cart-connections"}),Ts=_e.extend({name:"cart_settings",alt:"Settings",panelComponent:"panel-cart-settings"}),Ms=i("QP/g"),js=i.n(Ms),Is=i("3ED2"),Es=i.n(Is),As=h.extend({name:"cart_add_product_widget",className:"control cart_add_product_widget",restrictions:function(t){return t.eCommerceManager.isMagConnectedToStripe()},initialize:function(t){this.template=js.a["template-constructor-control-cart_add_product_widget"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model},render:function(){h.prototype.render.apply(this,arguments);var t=this.$el.find(".svg");Es()(t)},onClick:function(){this.isOnClickDisabled()||this.block&&this.block.workspace&&this.block.workspace.createWidget(r.a.addToCartBlockName)}}),Rs=_e.extend({name:"product_selector",alt:"Select product",panelComponent:"panel-product-selector"}),Ds=_e.extend({name:"add_to_cart_settings",alt:"Settings",panelComponent:"panel-addtocart-settings"}),zs=_e.extend({name:"slideshow_settings",alt:"Settings",panelComponent:"panel-slideshow-settings",select:function(){_e.prototype.select.apply(this,arguments),Object(c.a)("controls-slideshow_settings"),this.block.updateDropZone()},setPopupToDefault:function(){this.model.set("current_mode","default")},onEscKey:function(){if(this.selected&&this.checkNeedClosePopup())return this.setPopupToDefault(),void this.closeColorBox();_e.prototype.onEscKey.apply(this,arguments)},checkNeedClosePopup:function(){return"default"!==this.model.get("current_mode")||this.block.colorbox_visible},canControlBeClosed:function(){if(this.checkNeedClosePopup())return this.closeColorBox(),this.setPopupToDefault(),!0;_e.prototype.canControlBeClosed.apply(this,arguments)},closeColorBox:function(){this.block.settingsPanel.closePopups(),this.block.colorbox_visible=!1},deselect:function(){this.setPopupToDefault(),_e.prototype.deselect.apply(this,arguments)},destroy:function(){this.block.needRasterize&&(this.block.rasterizeIconsBeforeDestroy(),delete this.block.needRasterize),_e.prototype.destroy.apply(this,arguments)}}),Ls=_e.extend({name:"slideshow_transitions",alt:"Transitions",panelComponent:"panel-slideshow-transitions",onPanelChange:function(t){_e.prototype.onPanelChange.apply(this,arguments)},select:function(){_e.prototype.select.apply(this,arguments),Object(c.a)("controls-slideshow_transitions")},deselect:function(){_e.prototype.deselect.apply(this,arguments)}}),Bs=i("RedZ"),Fs=i.n(Bs),Hs=i("udqo"),Ns=h.extend({name:"picture_preview",className:"control picture_preview",initialize:function(t){var e=this;this.template=Fs.a["template-constructor-control-picture_preview"],this.initControl(t),this.updateState();var i=this.models[0];this.preview=new Hs.a({$container:Object(o.a)("#main"),$el:this.blocks[0].$el,overlayColor:i.get("preview_overlay_color"),picture:i.get("picture"),originalW:i.get("originalW"),width:i.get("w")}),this.saveDebounced=s.a.debounce((function(){e.master.workspace.save_group(s.a.pluck(e.blocks,"model"))}),1e3)},select:function(){if(!this.$preview){if(h.prototype.select.apply(this,arguments),this.hasOnClickAnimation())return this.$panel.addClass("show-animation-error");if(this.hasLink())return this.$panel.addClass("show-link-error");this.$panel.removeClass("show-animation-error show-link-error"),1===this.models.length&&this.models[0].get("preview_enabled")&&(this.$preview=this.preview.render())}},deselect:function(){var t=this;this.selected&&this.colorboxOpened?this.colorbox.hide():(this.preview.remove((function(){delete t.$preview})),this.colorbox.hide(),h.prototype.deselect.apply(this,arguments))},render:function(){h.prototype.render.apply(this,arguments);var t=this.$el.find(".svg");Es()(t)},bindLogic:function(){this.$(".icon-preview-toggle").on("click",this.previewToggle),this.$colorbox_container=this.$(".colorbox_container"),this.models[0].on("change",this.onPictureChange);var t=this.models[0].get("preview_overlay_color"),e=t?r.b.rgba2alpha(t):.6;if(!t){var i=this.models.map((function(t){return{_id:t.id,preview_overlay_color:"rgba(0, 0, 0, "+e+")"}}));this.master.workspace.set_group(i),this.saveDebounced()}var s=V.a.extend(rt.a);this.colorbox=new s({el:this.$colorbox_container.get(0),propsData:{type:"small",color:t?r.b.rgba2hex(t).slice(1):"000000",alpha:100*e,hOffset:36,vOffset:-64}}),this.colorbox.$on("update:all",this.onColorChanged),this.colorbox.$on("showPopup",this.onColorboxOpened),this.colorbox.$on("hidePopup",this.onColorboxClosed)},onColorboxOpened:function(){this.colorboxOpened=!0},onColorboxClosed:function(){this.colorboxOpened=!1},unBindLogic:function(){var t=this;this.$(".icon-preview-toggle").off("click",this.previewToggle),this.models[0].off("change",this.onPictureChange),this.colorbox.$off("update:all",this.onColorChanged),this.preview.remove((function(){delete t.$preview}))},updateState:function(){this.previewEnabled=this.models[0].get("preview_enabled"),this.$el.toggleClass("enabled",!!this.previewEnabled)},onColorChanged:function(t){var e=r.b.hex2rgb(t.color),i="rgba("+e[0]+", "+e[1]+", "+e[2]+", "+t.alpha/100+")",s=this.models.map((function(t){return{_id:t.id,preview_overlay_color:i}}));this.master.workspace.set_group(s),this.saveDebounced(),this.preview.changeColor(i)},restrictions:function(t){var e=t.getSelectedBlocks();return e.length<=1||e.map((function(t){return t.model.get("preview_enabled")})).every((function(t,e,i){return t===i[0]}))},previewToggle:function(){var t=this;if(!this.isOnClickDisabled()){this.previewEnabled=!this.previewEnabled,RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Picture Settings","Lightbox ".concat(this.previewEnabled?"enabled":"disabled"));var e=this.models.map((function(e){return{_id:e.id,preview_enabled:t.previewEnabled}}));this.master.workspace.set_group(e),this.saveDebounced(),this.updateState(),this.previewEnabled?1===this.models.length&&(this.$preview=this.preview.render()):(this.preview.remove((function(){delete t.$preview})),this.colorbox.hide())}},hasOnClickAnimation:function(){return this.models.reduce((function(t,e){return t||Boolean(e.getAnimations().find((function(t){return"click"===t.type&&t.steps&&t.steps.length})))}),!1)},hasLink:function(){return this.models.reduce((function(t,e){return t||!!e.get("clickLink")}),!1)},onPictureChange:function(){if(this.preview){var t=this.models[0].get("picture");this.preview.picture=t,this.preview.overlayColor=this.models[0].get("preview_overlay_color"),this.preview.originalW=this.models[0].get("originalW"),this.preview.height=this.models[0].get("h"),this.preview.width=this.models[0].get("w")}},onClick:function(){this.selected&&this.colorboxOpened?this.colorbox.hide():h.prototype.onClick.apply(this,arguments)},onEscKey:function(){this.selected&&this.colorboxOpened?this.colorbox.hide():h.prototype.onEscKey.apply(this,arguments)},canControlBeClosed:function(){if(this.colorboxOpened)return this.colorbox.hide(),!0;h.prototype.canControlBeClosed.apply(this,arguments)}}),Vs=_e.extend({name:"picture_alt",alt:"Alt text for picture",panelComponent:"panel-picture-alt",select:function(){_e.prototype.select.apply(this,arguments),Object(c.a)("controls-picture_alt")},restrictions:function(t){var e=RM.constructorRouter&&RM.constructorRouter.me&&RM.constructorRouter.me.get("permissions"),i=t.getSelectedBlocks();return 1===i.length&&i[0].model.get("picture")&&e&&e.can_use_picture_alt}}),Us=_e.extend({name:"rmheader_settings",alt:"RM Header Settings",panelComponent:"panel-rmheader-settings"}),Ws=i("q1tI"),Gs=i.n(Ws),qs=i("i8i4"),Xs=i.n(qs),Ks=i("8AXF"),Ys=Gs.a.createContext({}),Zs=h.extend({name:null,component:null,alt:null,saveOnDeselect:!0,saveOnDestroy:!0,initialize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h.prototype.initialize.apply(this,arguments),this.block=this.blocks[0],this.model=t.models&&t.models.length&&t.models[0],this.workspace=t.master&&t.master.workspace||{},this.page=this.workspace.page,this.project=this.workspace.mag,this.user=this.project.user,this.y=t.y||t.fromY,this.propsModel=new a.a.Model({faded:this.faded||!1,selected:this.selected||!1,disabled:this.disabled||!1,visible:this.visible||!1,y:this.y,alt:this.alt,select:this.setSelected,appearanceAnimation:this.appearanceAnimation,page:this.page,project:this.project,user:this.user}),this.propsModel.on("change",this.onPropsModelChanged)},render:function(){var t=this;if(!document.querySelector('[data-control-type="'.concat(this.name,'"]'))&&(this.$container.append('<div data-control-type="'.concat(this.name,'">')),this.domElement=document.querySelector('[data-control-type="'.concat(this.name,'"]')),this.domElement)){Object(Ks.renderReact)({component:function(){return Gs.a.createElement(Ks.CreateContextProvider,{context:Ys,model:t.propsModel},Gs.a.createElement(t.component,null))},domElement:this.domElement,model:this.model}),setTimeout((function(){t.show(),t.$el=Object(o.a)(t.domElement).find(":first")})),this.setControlsStatusByBlockData(),this.block.on("disabledControls:changed",this.onDisabledControlsChanged.bind(this)),this.bindLogic()}},updatePropsModel:function(t){this.propsModel&&this.propsModel.set(t)},destroy:function(t){t?this.hide():this.destroyReact(),this.block.off("disabledControls:changed",this.onDisabledControlsChanged),this.unBindLogic(),this.stopListening(this.model,"change")},destroyReact:function(){var t=this.$el.parent();Xs.a.unmountComponentAtNode(t[0])&&t.remove()},hide:function(){this.updatePropsModel({visible:!1})},show:function(){this.updatePropsModel({visible:!0})},moveToNewPos:function(t){this.y=t,this.domElement&&this.updatePropsModel({y:t})},bindShortcuts:function(){this.shortcutHandler=this.master.select.bind(this.master,this),this.keyboardShortcut&&window.RM.constructorRouter.bindGlobalKeyPress([{key:this.keyboardShortcut,handler:this.shortcutHandler}]),this.onWindowKeyUpBound=this.onWindowKeyUp.bind(this),Object(o.a)(window).on("keyup",this.onWindowKeyUpBound)},unbindShortcuts:function(){this.keyboardShortcut&&window.RM.constructorRouter.unbindGlobalKeyPress(this.keyboardShortcut,this.shortcutHandler),Object(o.a)(window).off("keyup",this.onWindowKeyUpBound)},select:function(){this.makeModelSnapshot(),this.updatePropsModel({selected:!0,faded:!1})},setSelected:function(){this.isOnClickDisabled()||(this.selected||this.disabled?this.master.deselect():this.master.select(this))},deselect:function(){var t=!!this.selected;this.updatePropsModel({selected:!1,faded:!1}),this.clearModelSnapshot(t)},fade:function(){this.deselect(),this.updatePropsModel({faded:!0})},setEnabled:function(){this.updatePropsModel({disabled:!1})},setDisabled:function(){this.updatePropsModel({selected:!1,disabled:!0})},save:function(){this.model.save({})},canControlBeClosed:function(){return!!this.selected&&(this.master.deselect(),!0)},onEscKey:function(){this.selected&&this.master.deselect()},onPropsModelChanged:function(){this.selected=this.propsModel.get("selected"),this.disabled=this.propsModel.get("disabled"),this.faded=this.propsModel.get("faded"),this.visible=this.propsModel.get("visible")}}),Js=i("iC7s"),Qs=i("vOnD"),to=i("wEEd"),eo=Object(Qs.d)(Js.a).withConfig({displayName:"control___StyledBox"})(["transition:opacity 0.2s ease;"]),io=function(t){var e=t.children,i=t.onClick,s=Object(Ws.useContext)(Ks.BackboneContext),o=(s.model,s.modelSet,s.destroy),n=Object(Ws.useContext)(Ys).model,a=Object(to.c)(n.visible,null,{config:{duration:200},from:n.appearanceAnimation?{opacity:0,transform:"translateX(7px)"}:{},enter:{opacity:1,transform:"translateX(0px)"},leave:{opacity:0,transform:"translateX(-7px)"},onDestroyed:function(t){t&&o()}});return Gs.a.createElement(Gs.a.Fragment,null,a.map((function(t){var s=t.item,o=t.key,a=t.props;return s&&Gs.a.createElement(to.a.div,{key:o,style:a},Gs.a.createElement(eo,{left:"0px",position:"absolute",top:n.y,opacity:n.disabled?.3:n.faded?.4:1},Gs.a.createElement(Js.b,{bg:"rgba(68, 68, 76, 0.95)",width:30,height:30,borderRadius:"50%",disabled:n.disabled,display:"block",onClick:i},e)))})))};function so(){return(so=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(this,arguments)}function oo(t,e){if(null==t)return{};var i,s,o=function(t,e){if(null==t)return{};var i,s,o={},n=Object.keys(t);for(s=0;s<n.length;s++)i=n[s],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(s=0;s<n.length;s++)i=n[s],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}var no=function(t){var e=t.children,i=(t.color,oo(t,["children","color"])),s=Object(Ws.useContext)(Ys).model,o=Object(to.c)(s.selected,null,{config:{duration:200},from:{opacity:0,transform:"translateX(8px)"},enter:{opacity:1,transform:"translateX(0px)"},leave:{opacity:0,transform:"translateX(8px)"}});return Gs.a.createElement(Gs.a.Fragment,null,o.map((function(t){var s=t.item,o=t.key,n=t.props;return s&&Gs.a.createElement(to.a.div,{key:o,style:n},Gs.a.createElement(Js.a,so({position:"absolute",top:"-30px",right:"40px",bg:"lightGray",borderRadius:8},i),e))})))},ao=i("zjto"),ro=i("bLmx"),lo=i("UGoK"),co=i("ICos"),ho=i("LDvm");function po(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function uo(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function go(t,e,i,s,o,n,a){try{var r=t[n](a),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(s,o)}function mo(t){return function(){var e=this,i=arguments;return new Promise((function(s,o){var n=t.apply(e,i);function a(t){go(n,s,o,a,r,"next",t)}function r(t){go(n,s,o,a,r,"throw",t)}a(void 0)}))}}function fo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var i=[],s=!0,o=!1,n=void 0;try{for(var a,r=t[Symbol.iterator]();!(s=(a=r.next()).done)&&(i.push(a.value),!e||i.length!==e);s=!0);}catch(t){o=!0,n=t}finally{try{s||null==r.return||r.return()}finally{if(o)throw n}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var vo={hsl:{h:231.42857142857144,s:.6633,l:.45439999999999997,a:1},hex:"#273dc1",rgb:{r:39,g:61,b:193,a:1},hsv:{h:231.42857142857144,s:.7975710936090904,v:.75580352,a:1}},bo=function(t){var e=t.reduce((function(t,e,i){return null!==t||e?t:i}),null);return null!==e?e:t.length},_o=function(){var t=Object(Ws.useContext)(Ks.BackboneContext),e=t.model,i=(t.modelSet,Object(Ws.useContext)(Ys).model),s=fo(Object(Ws.useState)({favourites:[],regular:[]}),2),o=s[0],n=s[1],a=fo(Object(Ws.useState)({favourites:[],regular:[]}),2),r=a[0],l=a[1],c=i.project.get("num_id"),h=i.user.get("_id");Object(Ws.useEffect)((function(){Object(ho.b)(c).then((function(t){var e=t.data;n(e)})),Object(ho.a)(h).then((function(t){var e=t.data;l(e)}))}),[c,h]);var d=fo(Object(ao.useTextWidgetStore)(e._id)(),2),p=d[0],u=d[1],g=Object(ro.c)(p),m=fo(Object(Ws.useState)(vo),2),f=m[0],v=m[1];return Object(Ws.useEffect)((function(){var t=Object(ro.c)(p).filter((function(t){return!!t&&t.startsWith(lo.a.Color)})).first();if(t){var e=t.replace("".concat(lo.a.Color,"_"),""),i=Object(co.a)(e);v(Object(Js.q)({rgb:i,source:"rgb"},f.oldHue))}else v(Object(Js.q)({hex:"#000000",source:"hex"},f.oldHue))}),[g]),Gs.a.createElement(Gs.a.Fragment,null,Gs.a.createElement(io,{onClick:function(t){t.preventDefault(),i.disabled||i.select()}},Gs.a.createElement(Js.e,{alignItems:"center",justifyContent:"center"},Gs.a.createElement(Js.a,{width:24,height:24,borderRadius:"50%",border:"1px solid #fff",bg:f.hex}))),Gs.a.createElement(no,{width:"auto",bg:"transparent"},Gs.a.createElement(Js.c,{onChangeComplete:function(t){if(t.rgb){var e=Object(lo.b)({key:lo.a.Color,value:Object(co.b)(t.rgb),editorState:p});u(e)}},onChange:function(t){return v(t)},color:f,projectSwatches:o,globalSwatches:r,onSwatchAdd:function(){var t=mo(regeneratorRuntime.mark((function t(e,i){var s,a,d,p;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e!==Js.l.project){t.next=8;break}return t.next=3,Object(ho.g)({projectNumId:c,color:i,index:bo(o.regular),type:Js.k.regular});case 3:s=t.sent,a=s.data,n(a),t.next=13;break;case 8:return t.next=10,Object(ho.f)({userId:h,color:i,index:bo(r.regular),type:Js.k.regular});case 10:d=t.sent,p=d.data,l(p);case 13:case"end":return t.stop()}}),t)})));return function(e,i){return t.apply(this,arguments)}}(),onSwatchRemove:function(){var t=mo(regeneratorRuntime.mark((function t(e,i){var s,a,d,p,u,g,m,f,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=e===Js.l.project?o:r,a=e===Js.l.project?n:l,d=e===Js.l.project?ho.g:ho.f,p=s.regular.findIndex((function(t){return t&&t.toLowerCase()===i.toLowerCase()})),u=s.favourites.findIndex((function(t){return t&&t.toLowerCase()===i.toLowerCase()})),!(p>-1)){t.next=13;break}return t.next=8,d({color:void 0,index:p,type:Js.k.regular,projectNumId:c,userId:h});case 8:g=t.sent,m=g.data,a(m),t.next=19;break;case 13:if(!(u>-1)){t.next=19;break}return t.next=16,d({color:void 0,index:u,type:Js.k.favourites,projectNumId:c,userId:h});case 16:f=t.sent,v=f.data,a(v);case 19:case"end":return t.stop()}}),t)})));return function(e,i){return t.apply(this,arguments)}}(),onMoveColors:function(){var t=mo(regeneratorRuntime.mark((function t(e){var i,s,a,d,p,u,g,m,f,v,b,_,w,y,k;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=e.tab,a=e.from,d=e.to,p=e.color,u=e.newIndex,g=e.oldIndex,m=s===Js.l.project?o:r,f=s===Js.l.project?n:l,(v=uo(m[a]))[g]=void 0,(b=uo(m[d]))[u]=void 0,f((po(i={},a,v),po(i,d,b),i)),s!==Js.l.project){t.next=16;break}return t.next=11,Object(ho.e)({projectNumId:c,from:a,to:d,color:p,newIndex:u,oldIndex:g});case 11:_=t.sent,w=_.data,n(w),t.next=21;break;case 16:return t.next=18,Object(ho.d)({userId:h,from:a,to:d,color:p,newIndex:u,oldIndex:g});case 18:y=t.sent,k=y.data,l(k);case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()})))},wo=Zs.extend({name:"text_color_new",component:_o}),yo=i("za5s");function ko(){var t=function(t,e){e||(e=t.slice(0));return Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}(["",";"]);return ko=function(){return t},t}function Co(){return(Co=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(this,arguments)}var xo=Gs.a.createElement("path",{d:"M1 0h14a1 1 0 010 2H1a1 1 0 010-2zm0 4h10a1 1 0 010 2H1a1 1 0 010-2zm0 4h14a1 1 0 010 2H1a1 1 0 010-2z",fill:"currentColor",fillRule:"evenodd"}),So=Object(Qs.d)((function(t){return Gs.a.createElement("svg",Co({width:16,height:10},t),xo)}))(ko(),yo.color);function Po(){var t=function(t,e){e||(e=t.slice(0));return Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}(["",";"]);return Po=function(){return t},t}function $o(){return($o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(this,arguments)}var Oo=Gs.a.createElement("g",{fill:"currentColor",fillRule:"evenodd"},Gs.a.createElement("rect",{width:16,height:2,rx:1}),Gs.a.createElement("rect",{x:2,y:4,width:12,height:2,rx:1}),Gs.a.createElement("rect",{y:8,width:16,height:2,rx:1})),To=Object(Qs.d)((function(t){return Gs.a.createElement("svg",$o({width:16,height:10},t),Oo)}))(Po(),yo.color);function Mo(){var t=function(t,e){e||(e=t.slice(0));return Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}(["",";"]);return Mo=function(){return t},t}function jo(){return(jo=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(this,arguments)}var Io=Gs.a.createElement("g",{fill:"currentColor",fillRule:"evenodd"},Gs.a.createElement("rect",{width:16,height:2,rx:1}),Gs.a.createElement("rect",{x:4,y:4,width:12,height:2,rx:1}),Gs.a.createElement("rect",{y:8,width:16,height:2,rx:1})),Eo=Object(Qs.d)((function(t){return Gs.a.createElement("svg",jo({width:16,height:10},t),Io)}))(Mo(),yo.color);function Ao(){var t=function(t,e){e||(e=t.slice(0));return Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}(["",";"]);return Ao=function(){return t},t}function Ro(){return(Ro=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(this,arguments)}var Do=Gs.a.createElement("g",{fill:"currentColor",fillRule:"evenodd"},Gs.a.createElement("rect",{width:16,height:2,rx:1}),Gs.a.createElement("rect",{y:4,width:16,height:2,rx:1}),Gs.a.createElement("rect",{y:8,width:16,height:2,rx:1})),zo=Object(Qs.d)((function(t){return Gs.a.createElement("svg",Ro({width:16,height:10},t),Do)}))(Ao(),yo.color);function Lo(){var t=function(t,e){e||(e=t.slice(0));return Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}(["",";"]);return Lo=function(){return t},t}function Bo(){return(Bo=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(this,arguments)}var Fo=Gs.a.createElement("g",{transform:"translate(-.5)",fill:"currentColor",fillRule:"evenodd"},Gs.a.createElement("path",{d:"M4.714 13.5L1.27 9.117A1 1 0 012.057 7.5h6.886a1 1 0 01.786 1.618l-3.443 4.381a1 1 0 01-1.572 0z"}),Gs.a.createElement("rect",{x:4.5,width:2,height:9,rx:1})),Ho=Object(Qs.d)((function(t){return Gs.a.createElement("svg",Bo({width:10,height:14},t),Fo)}))(Lo(),yo.color);function No(){var t=function(t,e){e||(e=t.slice(0));return Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}(["",";"]);return No=function(){return t},t}function Vo(){return(Vo=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(this,arguments)}var Uo,Wo=Gs.a.createElement("g",{transform:"matrix(1 0 0 -1 -.5 14)",fill:"currentColor",fillRule:"evenodd"},Gs.a.createElement("path",{d:"M4.714 13.5L1.27 9.117A1 1 0 012.057 7.5h6.886a1 1 0 01.786 1.618l-3.443 4.381a1 1 0 01-1.572 0z"}),Gs.a.createElement("rect",{x:4.5,width:2,height:9,rx:1})),Go=Object(Qs.d)((function(t){return Gs.a.createElement("svg",Vo({width:10,height:14},t),Wo)}))(No(),yo.color),qo=i("IrH7");function Xo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var i=[],s=!0,o=!1,n=void 0;try{for(var a,r=t[Symbol.iterator]();!(s=(a=r.next()).done)&&(i.push(a.value),!e||i.length!==e);s=!0);}catch(t){o=!0,n=t}finally{try{s||null==r.return||r.return()}finally{if(o)throw n}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Ko(){return(Ko=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(this,arguments)}function Yo(t,e){if(null==t)return{};var i,s,o=function(t,e){if(null==t)return{};var i,s,o={},n=Object.keys(t);for(s=0;s<n.length;s++)i=n[s],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(s=0;s<n.length;s++)i=n[s],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}!function(t){t.top="top",t.left="left",t.center="center",t.right="right",t.justify="justify",t.bottom="bottom"}(Uo||(Uo={}));var Zo=function(t){var e=t.icon,i=t.isHovered,s=t.isActive,o=Yo(t,["icon","isHovered","isActive"]),n=e===Uo.top?Ho:e===Uo.bottom?Go:e===Uo.left?So:e===Uo.center?To:e===Uo.right?Eo:zo;return Gs.a.createElement(Js.a,Ko({as:"button",border:"none",bg:"transparent",cursor:"pointer"},o),Gs.a.createElement(n,{color:i||s?"blue":"darkGray"}))},Jo=function(){var t=Object(Ws.useContext)(Ks.BackboneContext),e=t.model,i=t.modelSet,s=Object(Ws.useContext)(Ys).model,o=Xo(Object(Ws.useState)(null),2),n=o[0],a=o[1],r=Xo(Object(ao.useTextWidgetStore)(e._id)(),2),l=r[0],c=r[1],h=Object(ro.b)(l),d=e.verticalAlign;return Gs.a.createElement(Gs.a.Fragment,null,Gs.a.createElement(io,{onClick:function(t){t.preventDefault(),s.disabled||s.select()}},Gs.a.createElement(Js.n,{color:"white"},Gs.a.createElement(So,null))),Gs.a.createElement(no,{p:"12px 9px",width:168},Gs.a.createElement(Js.e,{alignItems:"center",justifyContent:"center",mb:18},Gs.a.createElement(Zo,{icon:Uo.top,isHovered:n===Uo.top,isActive:!d||d===ao.TextVerticalAlign.top,onMouseEnter:function(){return a(Uo.top)},onMouseLeave:function(){return a(null)},onClick:function(){i({verticalAlign:ao.TextVerticalAlign.top})}})),Gs.a.createElement(Js.e,{alignItems:"center",justifyContent:"space-between",mb:18},Gs.a.createElement(Zo,{icon:Uo.left,isHovered:n===Uo.left,isActive:h===qo.a.AlignLeft||!h,onMouseEnter:function(){return a(Uo.left)},onMouseLeave:function(){return a(null)},onClick:function(){var t=Object(ro.e)(l,qo.a.AlignLeft);c(t)}}),Gs.a.createElement(Zo,{icon:Uo.center,isHovered:n===Uo.center,isActive:h===qo.a.AlignCenter,onMouseEnter:function(){return a(Uo.center)},onMouseLeave:function(){return a(null)},onClick:function(){var t=Object(ro.e)(l,qo.a.AlignCenter);c(t)}}),Gs.a.createElement(Zo,{icon:Uo.right,isHovered:n===Uo.right,isActive:h===qo.a.AlignRight,onMouseEnter:function(){return a(Uo.right)},onMouseLeave:function(){return a(null)},onClick:function(){var t=Object(ro.e)(l,qo.a.AlignRight);c(t)}}),Gs.a.createElement(Zo,{icon:Uo.justify,isHovered:n===Uo.justify,isActive:h===qo.a.AlignJustify,onMouseEnter:function(){return a(Uo.justify)},onMouseLeave:function(){return a(null)},onClick:function(){var t=Object(ro.e)(l,qo.a.AlignJustify);c(t)}})),Gs.a.createElement(Js.e,{alignItems:"center",justifyContent:"center"},Gs.a.createElement(Zo,{icon:Uo.bottom,isHovered:n===Uo.bottom,isActive:d===ao.TextVerticalAlign.bottom,onMouseEnter:function(){return a(Uo.bottom)},onMouseLeave:function(){return a(null)},onClick:function(){i({verticalAlign:ao.TextVerticalAlign.bottom})}}))))},Qo=Zs.extend({name:"text_align_new",component:Jo}),tn=e.default={common_layer:g,common_align:v,common_animation:Object(u.a)("constructor.multipleAnimations")?N:I,common_pack:G,common_unpack:K,common_rotation:we,common_position:Se,text_styles:Me,text_typography:Ee,text_bius:De,text_align:Be,text_autosize:Ne,anchor_picker:We,text_link:Xe,text_color:Ze,text_columns:ti,text_edit:si,picture_crop:ri,picture_fwpos:di,picture_link:pi,picture_1x1:mi,picture_color:bi,picture_settings:_i,slideshow_manager:ki,shape_color:Si,shape_settings:Pi,shape_1x1:Ti,shape_icon:Ii,gmaps_edit:Ri,gmaps_settings:Di,common_lock:Bi,button_edit:Ni,button_settings:Vi,button_icon:qi,hotspot_add:Zi,hotspot_pin_settings:es,hotspot_tip_settings:os,form_content:ms,form_endpoints:_s,form_styles:ks,video_settings:Cs,audio_settings:xs,twitter_settings:Ss,facebook_settings:Ps,iframe_edit:$s,cart_connections:Os,cart_settings:Ts,cart_add_product_widget:As,product_selector:Rs,add_to_cart_settings:Ds,slideshow_settings:zs,slideshow_transitions:Ls,picture_preview:Ns,picture_alt:Vs,rmheader_settings:Us,text_color_new:wo,text_align_new:Qo}},hdsW:function(t,e,i){"use strict";var s=i("xi34"),o=i("q1z7"),n=i.n(o),a=i("rFsW"),r=i("8rcs"),l=i("OTSC"),c=i("gobI"),h=i("csmR"),d=i.n(h),p=i("QNiq"),u=i("Vxjr"),g=n.a.View.extend({initialize:function(t,e,i){a.a.bindAll(this),this.params=t,this.$container=e,this.readyCallback=i||function(){},!Object(a.a)(["standard","visual"]).contains(t.current_type)&&!Modernizr.opera||Modernizr.msie?this.player=new f(t,e,i,this):this.player=new m(t,e,i,this),this.render()},render:function(){this.player&&this.player.render()},show:function(){this.player&&this.player.show()},play:function(){this.player&&this.player.play()},pause:function(){this.player&&this.player.pause()},applyPlayerStyle:function(t){this.player&&this.player.applyPlayerStyle&&this.player.applyPlayerStyle(t)},destroy:function(){this.player&&(this.player.isDestroyed=!0,this.player&&this.player.destroy(),this.player=null)}}),m=n.a.View.extend({initialize:function(t,e,i,s){a.a.bindAll(this),this.inner_template=d.a["template-common-audio-player-standard"],this.parent=s,this.params=t,this.$container=e,this.readyCallback=i||function(){}},render:function(){var t=[];t.push("auto_play=false"),t.push("buying="+this.params.socials),t.push("liking="+this.params.socials),t.push("download="+this.params.socials),t.push("sharing="+this.params.socials),t.push("show_artwork="+this.params.artwork),t.push("show_comments="+this.params.comments),t.push("show_playcount="+this.params.playcount),t.push("color="+this.params.color),t.push("auto_advance=true"),t.push("show_user=true"),"visual"==this.params.current_type&&t.push("visual=true"),this.params.parsed_url=this.params.parsed_url.replace(/^http:/,"https:");var e=this.params.parsed_url+"&"+t.join("&");this.setElement(Object(s.a)(this.inner_template({src:e}))),this.$container.append(this.$el),this.player=r.a.Widget(this.$el[0]),this.player.bind("ready",a.a.bind((function(){setTimeout(a.a.bind((function(){this.readyCallback(this.parent)}),this),500)}),this)),setTimeout(a.a.bind((function(){this.readyCallback(this.parent)}),this),2e3)},show:function(){this.$el&&this.$el.css("opacity",1)},play:function(){this.player&&this.player.play()},pause:function(){this.player&&this.player.pause()},destroy:function(){this.player.unbind("ready"),this.$el&&this.$el.remove(),this.player=null}}),f=n.a.View.extend({apiKey:l.a.SOUNDCLOUD_API,defaultCover:Object(u.b)("./common/audio-player/cover.png"),initialize:function(t,e,i,s){a.a.bindAll(this),this.inner_template=d.a["template-common-audio-player-minimal"],this.parent=s,this.params=t,this.$container=e,this.readyCallback=i||function(){},this.isHTHML5=this.html5AudioAvailable()},render:function(){this.setElement(Object(s.a)(this.inner_template({src:this.params.url}))),this.$container.append(this.$el),this.applyPlayerStyle(this.params),this.isHTHML5?this.audioEngine=new v(this.$container,this):this.audioEngine=new b(this.$container,this),this.loadTracksData([{url:this.params.url}])},applyPlayerStyle:function(t){this.$el&&(this.$el.toggleClass("no-artwork",!t.artwork),this.$el.toggleClass("no-info",!t.info),this.$el.toggleClass("no-transitions",c.a.isOn()),this.$(".sc-info").css("color",t.artwork?"#fff":"#"+t.color),this.$(".sc-left").css("color","#"+t.color),this.$(".sc-button svg path").css("fill","#"+t.color))},tracksIsLoaded:function(t){if(this.tracks=null,this.audioEngine){var e=t.playerObj.tracks;if(!e.length)return this.$el.remove(),this.ready=!0,void this.readyCallback(this.parent);this.tracks=e,this.currentTrackNum=0,this.$el.removeClass("loading"),this.audioEngine.on("scPlayer:onAudioReady",this.onAudioReady).on("scPlayer:onMediaPlay",this.onMediaPlay).on("scPlayer:onMediaPause",this.onMediaPause).on("scPlayer:onMediaEnd",this.onMediaEnd).on("scPlayer:onMediaBuffering",this.onMediaBuffering),this.$elements={},this.$elements.scrubber=this.$(".sc-scrubber"),this.$elements.play_button=Object(s.a)(this.$(".sc-button")),this.$elements.play_wrapper=this.$(".sc-button-wrapper"),this.$elements.buffer=this.$(".sc-buffer"),this.$elements.played=this.$(".sc-played"),this.$elements.time=this.$(".sc-left");var i=this.updateTrackInfo(this.currentTrackNum);if(this.$elements.play_button.on("click",this.onPlayClick),p.a.isDesktop&&(this.$elements.scrubber.on("mousemove",this.onScrubberMouseMove),this.$elements.scrubber.on("click",this.onScrubberClick)),this.$(".sc-artwork-list").on("click",this.onPlayClick),p.a.isDesktop&&this.$elements.play_button.RMDrag({move:this.moveHandleDrag,end:this.endHandleDrag,silent:!1,preventDefault:!0}),RM.screenshot)var o=Object(s.a)("<img/>").load(a.a.bind((function(){setTimeout(a.a.bind((function(){this.ready=!0,!this.isDestroyed&&this.readyCallback(this.parent),o.remove()}),this),100)}),this)).attr("src",i);else this.ready=!0,this.readyCallback(this.parent)}},moveHandleDrag:function(t){this.playing&&this.pause(),this.isDragging=!0,this.$el.addClass("dragging"),this.scrub(t.pageX)},endHandleDrag:function(t){t.moved&&this.play(),this.$el.removeClass("dragging"),setTimeout(a.a.bind((function(){this.isDragging=!1}),this),0)},onScrubberMouseMove:function(t){var e=Object(s.a)(t.currentTarget),i=e.find(".sc-hover-indicator"),o=c.a.getNormalizedBox(e.get(0)),n=t.pageX-o.left;i.css("left",n/c.a.getRatio()+"px")},onScrubberClick:function(t){return this.playing||this.play(),this.scrub(t.pageX),!1},onPlayClick:function(t){if(!this.isDragging)return this.playing?this.pause():this.play(),t.stopPropagation(),!1},onAudioReady:function(){this.audioEngine&&this.audioEngine.play(),this.audioEngine&&this.audioEngine.setVolume(100)},onMediaPlay:function(){this.$el.addClass("playing"),this.playing=!0,clearInterval(this.positionPoll),this.positionPoll=setInterval(this.updatePlayState,500)},onMediaPause:function(){this.$el.removeClass("playing"),this.playing=!1,clearInterval(this.positionPoll),this.positionPoll=null},onMediaEnd:function(){this.$elements.played.css("width","0%"),this.$elements.play_button.css("left","0%"),this.$el.removeClass("playing"),this.playing=!1,this.audioEngine&&this.audioEngine.stop();var t=(this.currentTrackNum+1)%this.tracks.length;this.play(t),0==t&&(this.pause(),this.updateTrackInfo(0))},onMediaBuffering:function(t){this.$elements.buffer.css("width",t+"%")},play:function(t){if(this.tracks&&(null==t&&(t=this.currentTrackNum),this.audioEngine&&(!this.playing||t!=this.currentTrackNum))){var e=this.tracks[t];this.$el.addClass("playing"),this.playing=!0,t==this.currentTrackNum&&this.audioEngine.firstLoad?this.audioEngine&&this.audioEngine.play():(this.updateTrackInfo(t),this.currentTrackNum=t,this.audioEngine&&this.audioEngine.load(e,this.apiKey))}},pause:function(){this.audioEngine&&this.playing&&(this.$el.removeClass("playing"),this.playing=!1,this.audioEngine&&this.audioEngine.pause())},scrub:function(t){if(this.audioEngine){var e=c.a.getNormalizedBox(this.$elements.play_wrapper.get(0)),i=c.a.getNormalizedBox(this.$elements.play_button.get(0)),s=(t-e.left-i.width/2)/e.width;s=Math.min(Math.max(Math.min(s,.999),0),this.$elements.buffer.width()/this.$elements.scrubber.width()),this.$elements.play_button.css("left",Math.floor(this.$elements.play_wrapper.width()*s)+"px"),this.audioEngine&&this.audioEngine.seek(s)}},updatePlayState:function(){if(this.audioEngine){var t=this.audioEngine.getDuration(),e=this.audioEngine.getPosition(),i=e/t;this.$elements.played.css("width",100*i+"%"),this.$elements.play_button.css("left",Math.floor(this.$elements.play_wrapper.width()*i)+"px"),t&&this.$elements.time.html(this.timecode(t-e))}},updateTrackInfo:function(t){if(this.tracks){var e,i=this.tracks[t];this.$(".sc-info h3").html('<a target="_blank" href="'+i.permalink_url+'">'+i.title+"</a>"),this.$(".sc-info h4").html('by <a target="_blank" href="'+i.user.permalink_url+'">'+i.user.username+"</a>"),e=i.artwork_url?i.artwork_url.replace("-large","-t300x300"):i.user&&i.user.avatar_url?i.user.avatar_url.replace("-large","-t300x300"):this.defaultCover,this.$(".sc-artwork-list .sc-loaded-artwork").css("background-image",'url("'+e+'")'),this.$elements.time.html(this.timecode(i.duration));var s=(t+1)%this.tracks.length,o=(t-1+this.tracks.length)%this.tracks.length,n=this.tracks[s],a=this.tracks[o];return!n.preload&&n.artwork_url&&(n.preload=new Image,n.preload.src=n.artwork_url.replace("-large","-t300x300")),!a.preload&&a.artwork_url&&(a.preload=new Image,a.preload.src=a.artwork_url.replace("-large","-t300x300")),e}},loadTracksData:function(t){var e=0,i={tracks:[]},o=this;!function n(a){if(!o.isDestroyed){var r=o.scApiUrl(a.url);fetch(r).then((function(t){return t.json()})).then((function(l){o.isDestroyed||(e+=1,l.tracks?i.tracks=i.tracks.concat(l.tracks):l.duration?(l.permalink_url=a.url,i.tracks.push(l)):l.creator?t.push({url:l.uri+"/tracks"}):l.username?/favorites/.test(a.url)?t.push({url:l.uri+"/favorites"}):t.push({url:l.uri+"/tracks"}):s.a.isArray(l)&&(i.tracks=i.tracks.concat(l)),t[e]?n(t[e]):o.tracksIsLoaded({playerObj:i,url:r}))})).catch((function(){!o.isDestroyed&&o.readyCallback(o.parent)}))}}(t[e])},scApiUrl:function(t){var e="https:"===document.location.protocol,i=(e||/^https/i.test(t)?"https":"http")+"://api.soundcloud.com/resolve?url=",s="format=json&client_id="+this.apiKey;return e&&(t=t.replace(/^http:/,"https:")),/api\./.test(t)?t+"?"+s:i+t+"&"+s},html5AudioAvailable:function(){var t=!1;try{var e=new Audio;t=e.canPlayType&&/maybe|probably/.test(e.canPlayType("audio/mpeg"))}catch(t){}return t},timecode:function(t){var e={h:Math.floor(t/36e5),m:Math.floor(t/6e4%60),s:Math.floor(t/1e3%60)},i=[];return e.h>0&&i.push(e.h),i.push(e.m<10&&e.h>0?"0"+e.m:e.m),i.push(e.s<10?"0"+e.s:e.s),i.join(":")},show:function(){this.$el&&this.$el.css("opacity",1)},destroy:function(){this.pause(),this.audioEngine&&this.audioEngine.off(),this.audioEngine&&this.audioEngine.destroy(),this.audioEngine=null,this.$el&&this.$el.remove()}}),v=n.a.View.extend({initialize:function(t,e){a.a.bindAll(this),this.inner_template=d.a["template-common-audio-player-engine-html5"],this.parent=e,this.$container=t,this.firstLoad=!1;var i=this;this.callbacks={onReady:function(){i.player&&i.trigger("scPlayer:onAudioReady")},onPlay:function(){i.player&&i.trigger("scPlayer:onMediaPlay")},onPause:function(){i.player&&i.trigger("scPlayer:onMediaPause")},onEnd:function(){i.player&&i.trigger("scPlayer:onMediaEnd")},onBuffer:function(t){i.player&&i.trigger("scPlayer:onMediaBuffering",t)}},this.render()},render:function(){this.setElement(Object(s.a)(this.inner_template({}))),this.$container.append(this.$el),this.player=this.$el.find("audio")[0],this.player.addEventListener("play",this.callbacks.onPlay,!1),this.player.addEventListener("pause",this.callbacks.onPause,!1),this.player.addEventListener("timeupdate",this.onTimeUpdate,!1),this.player.addEventListener("progress",this.onProgress,!1)},onTimeUpdate:function(t){if(this.player){var e=(this.player.buffered.length&&this.player.buffered.end(0))/this.player.duration*100;this.callbacks.onBuffer(e),this.player.currentTime===this.player.duration&&this.callbacks.onEnd()}},onProgress:function(t){if(this.player){var e=(this.player.buffered.length&&this.player.buffered.end(0))/this.player.duration*100;this.callbacks.onBuffer(e)}},load:function(t,e){this.player&&(this.firstLoad=!0,this.player.pause(),this.player.src=t.stream_url+(/\?/.test(t.stream_url)?"&":"?")+"client_id="+e,this.player.load(),this.player.play())},play:function(){this.player&&this.player.play()},pause:function(){this.player&&this.player.pause()},stop:function(){this.player&&this.player.currentTime&&(this.player.currentTime=0,this.player.pause())},seek:function(t){if(this.player&&this.player.src)try{this.player.currentTime=this.player.duration*t}catch(t){}},getDuration:function(){return this.player?1e3*this.player.duration:0},getPosition:function(){return this.player?1e3*this.player.currentTime:0},setVolume:function(t){this.player&&(this.player.volume=t/100)},destroy:function(){this.$el.remove(),this.player=null}}),b=n.a.View.extend({initialize:function(t,e){a.a.bindAll(this),this.inner_template_flash=d.a["template-common-audio-player-engine-flash"],this.inner_template_flash_ie=d.a["template-common-audio-player-engine-flash-ie"],this.parent=e,this.$container=t,this.firstLoad=!1;var i=this;this.callbacks={onReady:function(){i.player&&i.trigger("scPlayer:onAudioReady")},onPlay:function(){i.player&&i.trigger("scPlayer:onMediaPlay")},onPause:function(){i.player&&i.trigger("scPlayer:onMediaPause")},onEnd:function(){i.player&&i.trigger("scPlayer:onMediaEnd")},onBuffer:function(t){i.player&&i.trigger("scPlayer:onMediaBuffering",t)}}},render:function(t){var e="soundcloud_"+this.parent.parent.params._id,i=("https:"===document.location.protocol?"https":"http")+"://player.soundcloud.com/player.swf?url="+t+"&amp;enable_api=true&amp;player_type=engine&amp;object_id="+e;Modernizr.msie?this.setElement(Object(s.a)(this.inner_template_flash_ie({id:e,swf:i}))):this.setElement(Object(s.a)(this.inner_template_flash({id:e,swf:i}))),this.$container.append(this.$el),this.$el.find("object").on("soundcloud:onPlayerReady",a.a.bind((function(t,i){this.player=r.b.getPlayer(e),this.callbacks.onReady()}),this)).on("soundcloud:onMediaBuffering",a.a.bind((function(t,e){this.callbacks.onBuffer(e.percent)}),this)).on("soundcloud:onMediaEnd",this.callbacks.onEnd).on("soundcloud:onMediaPlay",this.callbacks.onPlay).on("soundcloud:onMediaPause",this.callbacks.onPause)},load:function(t){this.firstLoad?this.player&&this.player.api_load(t.uri):(this.firstLoad=!0,this.render(t.uri))},play:function(){this.player&&this.firstLoad&&this.player.api_play()},pause:function(){this.player&&this.firstLoad&&this.player.api_pause()},stop:function(){this.player&&this.firstLoad&&this.player.api_stop()},seek:function(t){this.player&&this.firstLoad&&this.player.api_seekTo(this.player.api_getTrackDuration()*t)},getDuration:function(){return this.player&&this.firstLoad&&this.player.api_getTrackDuration&&1e3*this.player.api_getTrackDuration()},getPosition:function(){return this.player&&this.firstLoad&&this.player.api_getTrackPosition&&1e3*this.player.api_getTrackPosition()},setVolume:function(t){this.player&&this.player.api_setVolume&&this.player.api_setVolume(t)},destroy:function(){this.player=null,this.$el&&this.$el.remove()}});e.a=g},i7aS:function(t,e,i){"use strict";var s=i("Kf/z"),o=i("OTSC");function n(t,e){if(null==t)return{};var i,s,o=function(t,e){if(null==t)return{};var i,s,o={},n=Object.keys(t);for(s=0;s<n.length;s++)i=n[s],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(s=0;s<n.length;s++)i=n[s],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}function a(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function r(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?a(i,!0).forEach((function(e){l(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):a(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function l(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var c=function(){return Object(s.a)("constructor.imageLambda")},h=function(){return Object(s.a)("constructor.imageLambdaOldProjects")},d=function(t){return o.a.allowedLambdaExt.includes(t)},p=function(t){return Boolean(c()&&t&&t.originalLambdaUrl&&d(t.type))},u=function(t){return Boolean(h()&&t&&t.unscaledUrl&&d(t.type))},g=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.width,i=t.height,s=t.cropX,o=t.cropY,n=t.cropW,a=t.cropH,r=t.originalW,l=t.originalH,c=t.quality,h=t.ext,d=t.scale,p=t.animationScale,u=t.dpr,g=void 0===u?window.devicePixelRatio||1:u,m=t.fit,f=void 0!==m&&m,v=[],b=d||1,_=p||1;if(e){var w=Math.min(Math.round(e*g*b*_),r);w<r&&v.push("w=".concat(w))}if(c&&v.push("q=".concat(c)),h&&v.push("e=".concat(h)),f&&i){var y=Math.min(Math.round(i*g),l);y<l&&v.push("h=".concat(y))}return void 0!==s&&void 0!==o&&n&&a&&(n!==r||a!==l)&&(v.push("cX=".concat(s)),v.push("cY=".concat(o)),v.push("cW=".concat(n)),v.push("cH=".concat(a))),v.length?"?".concat(v.join("&")):""},m=function(t){return t?"".concat(t.originalLambdaUrl||function(t){if(!t||!t.unscaledUrl)return"";var e=new URL(t.unscaledUrl);return"".concat(o.a.readymag_lambda_host).concat(e.pathname)}(t)):""},f=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return"";var i=r({},e);return u(t)&&!p(t)&&(i.cropX=void 0,i.cropY=void 0,i.cropW=e.originalW,i.cropH=e.originalH),"".concat(m(t)).concat(g(i))};e.a={flagLambda:c,flagLQIP:function(){return c()&&Object(s.a)("constructor.imageLqip")},flagLambdaOldProjects:h,allowedLambdaExt:d,useLambdaUrl:p,useLambdaUrlOldProjects:u,getLambdaUrl:f,getOriginalLambdaUrl:m,getLambdaParams:g,getSrcset:function(t,e){var i=e.dprSet,s=void 0===i?[1,2,3]:i,o=n(e,["dprSet"]),a=[];return(s||[]).forEach((function(e){o.dpr=e,a.push("".concat(f(t,o)).concat(e>1?" ".concat(e,"x"):""))})),a.length?a.join(", "):""},getLqipUrl:function(t,e){return t?(e.dpr=1,e.width=o.a.lqipWidth,e.quality=o.a.lqipQuality,f(t,e)):""},getThumbnailUrl:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return"";var i=r({width:o.a.THUMB_SIZE,height:o.a.THUMB_SIZE,quality:o.a.THUMB_QUALITY,fit:"auto"},e);return f(t,i)}}},ibKe:function(module,exports){module.exports={"template-constructor-control-button_edit":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="icon noarrow" data-alt="Edit Text" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel"></div>\n\n';return __p}}},"j/3K":function(t,e,i){},j0jp:function(module,exports){module.exports={"template-constructor-control-common_animation":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Animation" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t\t<div class="panel-caption">Animation</div>\n\n\t\t<div class="mixed-types">\n\t\t\t<div class="message-text">Nope, you cant mix fixed, full width, full height, sticky and normal widgets at a time.</div>\n\t\t</div>\n\n\t\t<div class="multiple-fixeds">\n\t\t\t<div class="message-text">Nope, you cant animate multiple fixed widgets at a time.</div>\n\t\t</div>\n\n\t\t<div class="multiple-stickeds">\n\t\t\t<div class="message-text">Nope, you cant animate multiple sticky widgets at a time.</div>\n\t\t</div>\n\n\t\t<div class="multiple-fullwidths">\n\t\t\t<div class="message-text">Nope, you cant animate multiple full width widgets at a time.</div>\n\t\t</div>\n\n\t\t<div class="multiple-fullheights">\n\t\t\t<div class="message-text">Nope, you cant animate multiple full height widgets at a time.</div>\n\t\t</div>\n\n\t\t<div class="non-animatable">\n\t\t\t<div class="message-text">Nope, you cant animate Facebook or Twitter widgets.</div>\n\t\t</div>\n\n\t\t<div class="multiple-animations">\n\t\t\t<div class="message-text">Therere different animations in this selection. Merge them?</div>\n\t\t\t<div class="unite-button">Yes</div>\n\t\t</div>\n\n\t\t<div class="top-block js-top-block"></div>\n\n\t\t<div class="step-selector js-step-selector">\n\t\t\t<div class="prev-step js-prev-step"></div>\n\t\t\t<div class="step-caption js-step-caption"></div>\n\t\t\t<div class="next-step js-next-step"></div>\n\n\t\t\t<div class="step-popup js-step-popup">\n\t\t\t\t<div class="step-popup-content js-step-popup-content"></div>\n\t\t\t\t<div class="corner-wrapper">\n\t\t\t\t\t<div class="corner"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="requires-trigger">\n\t\t\t<div class="message-text">A video widget can be&nbsp;animated on&nbsp;click only with&nbsp;another widget as&nbsp;a&nbsp;trigger.</div>\n\t\t</div>\n\n\t\t<div class="cannot-use-with-picture-preview">\n\t\t\t<div class="message-text">Oops, you cant currently add this animation since Lightbox is enabled</div>\n\t\t</div>\n\n\t\t<div class="resizable-scroll-wrapper">\n\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t<div class="resizable-content">\n\n\t\t\t\t\t<div class="effects-presets-wrapper">\n\t\t\t\t\t\t<div class="effects-caption">Choose Effect</div>\n\t\t\t\t\t\t<div class="effects-item" data-value="use_move">Move</div>\n\t\t\t\t\t\t<div class="effects-item" data-value="use_opacity">Opacity</div>\n\t\t\t\t\t\t<div class="effects-item" data-value="use_rotate">Rotate</div>\n\t\t\t\t\t\t<div class="effects-item" data-value="use_scale">Scale</div>\n\n\t\t\t\t\t\t<div class="presets-caption">Presets</div>\n\t\t\t\t\t\t<div class="presets-item" data-value="fade-and-scale">Fade&Scale<div class="preview"></div></div>\n\t\t\t\t\t\t<div class="presets-item" data-value="fade-in">Fade In<div class="preview"></div></div>\n\t\t\t\t\t\t<div class="presets-item" data-value="scale-big">Scale Big<div class="preview"></div></div>\n\t\t\t\t\t\t<div class="presets-item" data-value="move-and-fade">Move&Fade<div class="preview"></div></div>\n\t\t\t\t\t\t<div class="presets-item" data-value="pulse">Pulse<div class="preview"></div></div>\n\t\t\t\t\t\t<div class="presets-item" data-value="rotate">Rotate<div class="preview"></div></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="resizable-scroll"></div>\n\t\t</div>\n\n\n\t\t<div class="resize-handle-top"></div>\n\t\t<div class="resize-handle-bottom"></div>\n\n\n\t\t<div class="bottom-block">\n\t\t\t<div class="add-effect">\n\t\t\t\t<span>Add Effect</span>\n\t\t\t\t<div class="effect-popup">\n\t\t\t\t\t<div class="effect-popup-item" data-value="use_move">Move</div>\n\t\t\t\t\t<div class="effect-popup-item" data-value="use_opacity">Opacity</div>\n\t\t\t\t\t<div class="effect-popup-item" data-value="use_rotate">Rotate</div>\n\t\t\t\t\t<div class="effect-popup-item" data-value="use_scale">Scale</div>\n\t\t\t\t\t<div class="corner-wrapper"><div class="corner"></div></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="loop-types js-loop-types">\n\t\t\t\tLoop\n\t\t\t\t<div class="loop-type loop-type-swing js-loop-swing" data-value="swing" data-alt="Reverse"></div>\n\t\t\t\t<div class="loop-type loop-type-repeat js-loop-repeat" data-value="repeat" data-alt="Cycle"></div>\n\t\t\t</div>\n\n\t\t\t<div class="play-once">\n\t\t\t\t<div class="play-once-title js-play-once">Once per user</div>\n\t\t\t\t<div class="help">\n\t\t\t\t\t<div class="help-popup">\n\t\t\t\t\t\t<div class="help-body-wrapper">\n\t\t\t\t\t\t\t<div class="help-body">\n\t\t\t\t\t\t\t\t<span class="help-text">Plays animation once to&nbsp;each person.<br />Hides animated blocks on&nbsp;consequent refreshes. <br/><a href="http://help.readymag.com/hc/en-us/articles/360021875712-Settings" target="_blank">Learn more</a></span>\n\t\t\t\t\t\t\t\t<div class="help-popup-corner">\n\t\t\t\t\t\t\t\t\t<div class="corner"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="hover-spacer"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="preview">Preview</div>\n\t\t</div>\n\n\t</div>\n';return __p},"template-constructor-control-common_animation-trigger":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="trigger js-trigger-button" data-id="'+(null==(__t=id)?"":__t)+'">\n\t\t',"onOtherPage"===status?__p+='\n\t\t\t<div class="trigger-other-page">\n\t\t\t\t<div class="trigger-name js-trigger-name">\n\t\t\t\t\tTrigger on p. '+(null==(__t=pageNumber)?"":__t)+'\n\t\t\t\t</div>\n\t\t\t\t<svg class="trigger-remove-button js-remove-trigger" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t<path d="M6 4.467l4.15-4.15a1.084 1.084 0 011.533 1.533L7.533 6l4.15 4.15a1.084 1.084 0 11-1.533 1.533L6 7.533l-4.15 4.15A1.084 1.084 0 01.317 10.15L4.467 6 .317 1.85A1.084 1.084 0 111.85.317L6 4.467z" fill-rule="evenodd"/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t':"pending"===status?__p+='\n\t\t\t<div class="trigger-pending">\n\t\t\t\tChoose Trigger\n\t\t\t\t<svg class="trigger-remove-button js-cancel-trigger" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t<path d="M6 4.467l4.15-4.15a1.084 1.084 0 011.533 1.533L7.533 6l4.15 4.15a1.084 1.084 0 11-1.533 1.533L6 7.533l-4.15 4.15A1.084 1.084 0 01.317 10.15L4.467 6 .317 1.85A1.084 1.084 0 111.85.317L6 4.467z" fill-rule="evenodd"/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t':"active"===status?__p+='\n\t\t\t<div class="trigger-active js-trigger-active">\n\t\t\t\t<div class="trigger-name js-trigger-name">\n\t\t\t\t\t'+(null==(__t=isSelf?"Self":triggerBlockName||"Trigger")?"":__t)+'\n\t\t\t\t</div>\n\t\t\t\t<svg class="trigger-remove-button js-remove-trigger" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t<path d="M6 4.467l4.15-4.15a1.084 1.084 0 011.533 1.533L7.533 6l4.15 4.15a1.084 1.084 0 11-1.533 1.533L6 7.533l-4.15 4.15A1.084 1.084 0 01.317 10.15L4.467 6 .317 1.85A1.084 1.084 0 111.85.317L6 4.467z" fill-rule="evenodd"/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t':__p+='\n\t\t\t<div class="trigger-none">\n\t\t\t\t<div class="trigger-none-caption">Add Trigger</div>\n\t\t\t\t<div class="trigger-arrow"></div>\n\t\t\t</div>\n\t\t',__p+="\n\t</div>\n";return __p},"template-constructor-control-common_animation-step":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="step">\n\n\t\t<div class="param-wrapper start-block">\n\t\t\t<div class="caption">Start Point</div>\n\t\t\t<div class="start-value">'+(null==(__t=start_point)?"":__t)+'</div>\n\t\t\t<div class="start-popup">\n\t\t\t\t<div class="start-popup-item" data-value="top">Top<div class="point"></div></div>\n\t\t\t\t<div class="start-popup-item" data-value="center">Center<div class="point"></div></div>\n\t\t\t\t<div class="start-popup-item" data-value="bottom">Bottom<div class="point"></div></div>\n\t\t\t\t<div class="start-popup-caption">Offset</div>\n\n\t\t\t\t<div class="input-wrapper">\n\t\t\t\t\t<input class="numeric-input" spellcheck="false" data-param="start_offset" data-min="-9999" data-max="9999" data-mouseSpeed="1" type="text"/>\n\t\t\t\t\t<div class="units">px</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="start-preview">\n\t\t\t\t\t<div class="start-point"></div>\n\t\t\t\t\t<div class="start-dist"></div>\n\t\t\t\t\t<div class="start-offset"></div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="corner-wrapper"><div class="corner"></div></div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper delay-block">\n\t\t\t<div class="bg"></div>\n\t\t\t<div class="caption">Delay</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<div class="units for-centering">s</div>\n\t\t\t\t<input class="numeric-input" spellcheck="false" data-param="delay" data-min="0" data-max="99" data-useFloat="true" data-shiftStep="1" data-step="0.1" data-mouseSpeed="5" data-labelSelector="<.param-wrapper" type="text"/>\n\t\t\t\t<div class="units">s</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper duration-block">\n\t\t\t<div class="bg"></div>\n\t\t\t<div class="caption">Durat.</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<div class="units for-centering">s</div>\n\t\t\t\t<input class="numeric-input" spellcheck="false" data-param="duration" data-min="0" data-max="99" data-useFloat="true" data-shiftStep="1" data-step="0.1" data-mouseSpeed="5" data-labelSelector="<.param-wrapper" type="text"/>\n\t\t\t\t<div class="units">s</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper delay_px-block">\n\t\t\t<div class="bg"></div>\n\t\t\t<div class="caption">Delay</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<div class="units for-centering">px</div>\n\t\t\t\t<input class="numeric-input" spellcheck="false" data-param="delay_px" data-min="0" data-max="9999" data-mouseSpeed="1" data-labelSelector="<.param-wrapper" type="text"/>\n\t\t\t\t<div class="units">px</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t',0===index&&(__p+='\n\t\t\t<div class="param-wrapper start-condition-block">\n\t\t\t\t<div class="caption">Start when in view</div>\n\t\t\t\t<div class="switcher start-when-in-view-switcher js-start-when-in-view-switcher"></div>\n\t\t\t</div>\n\t\t'),__p+='\n\n\t\t<div class="param-wrapper speed-block">\n\t\t\t<div class="caption">Speed</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<div class="units for-centering">x</div>\n\t\t\t\t<input class="numeric-input" spellcheck="false" data-param="speed"  data-min="0.01" data-floatDigits="2" data-max="999" data-useFloat="true" data-shiftStep="0.1" data-step="0.01" data-mouseSpeed="5" type="text"/>\n\t\t\t\t<div class="units">x</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper move-block">\n\t\t\t<div class="remove-effect" data-value="use_move"></div>\n\t\t\t<div class="caption">Move</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<input class="numeric-input left-align" spellcheck="false" data-param="dx" data-min="-99999" data-max="99999" data-mouseSpeed="5" type="text"/>\n\t\t\t\t<div class="separator move-icon"></div>\n\t\t\t\t<input class="numeric-input right-align" spellcheck="false" data-param="dy" data-min="-99999" data-max="99999" data-mouseSpeed="5" type="text"/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper opacity-block">\n\t\t\t<div class="remove-effect" data-value="use_opacity"></div>\n\t\t\t<div class="caption">Opacity</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<input class="numeric-input left-align" spellcheck="false" data-param="from_opacity" data-min="0" data-max="100"  data-mouseSpeed="5" type="text"/>\n\t\t\t\t<div class="separator from-icon"></div>\n\t\t\t\t<input class="numeric-input right-align" spellcheck="false" data-param="opacity" data-min="0" data-max="100"  data-mouseSpeed="5" type="text"/>\n\t\t\t</div>\n\t\t\t',isSwitcherVisible&&(__p+='\n\t\t\t\t<div class="param-wrapper hide-in-editor-switcher-wrapper">\n\t\t\t\t\t<div class="caption">Hide in Editor</div>\n\t\t\t\t\t<div class="switcher hide-in-editor-switcher js-hide-in-editor-switcher"></div>\n\t\t\t\t</div>\n\t\t\t'),__p+='\n\t\t</div>\n\n\t\t<div class="param-wrapper rotate-block">\n\t\t\t<div class="remove-effect" data-value="use_rotate"></div>\n\t\t\t<div class="caption">Rotate</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<input class="numeric-input left-align" spellcheck="false" data-param="from_rotate" data-min="-9999" data-max="9999"  data-mouseSpeed="5" type="text"/>\n\t\t\t\t<div class="separator from-icon"></div>\n\t\t\t\t<input class="numeric-input right-align" spellcheck="false" data-param="rotate" data-min="-9999" data-max="9999"  data-mouseSpeed="5" type="text"/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper scale-block">\n\t\t\t<div class="remove-effect" data-value="use_scale"></div>\n\t\t\t<div class="caption">Scale</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<input class="numeric-input left-align" spellcheck="false" data-param="from_scale" data-min="0" data-max="9999" data-mouseSpeed="5" type="text"/>\n\t\t\t\t<div class="separator from-icon"></div>\n\t\t\t\t<input class="numeric-input right-align" spellcheck="false" data-param="scale" data-min="0" data-max="9999" data-mouseSpeed="5" type="text"/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper acceleration-block">\n\t\t\t<div class="caption">Acceleration</div>\n\t\t\t<div class="acceleration-value">'+(null==(__t=acceleration)?"":__t)+'</div>\n\t\t\t<div class="acceleration-popup">\n\t\t\t\t<div class="acceleration-popup-preview"><div class="ball"></div></div>\n\t\t\t\t<div class="acceleration-popup-item" data-value="none">None<div class="point"></div></div>\n\t\t\t\t<div class="acceleration-popup-item" data-value="ease-in">Ease In<div class="point"></div></div>\n\t\t\t\t<div class="acceleration-popup-item" data-value="ease-out">Ease Out<div class="point"></div></div>\n\t\t\t\t<div class="acceleration-popup-item" data-value="ease-both">Ease Both<div class="point"></div></div>\n\t\t\t\t<div class="corner-wrapper"><div class="corner"></div></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n';return __p},"template-constructor-control-common_animation-step-popup-item":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="step-popup-item js-step-popup-item '+(null==(__t=isSelected?"selected":"")?"":__t)+'" data-ind="'+(null==(__t=index)?"":__t)+'">'+(null==(__t=text)?"":__t)+"</div>\n";return __p},"template-constructor-control-common_animation-type-popup":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="type-popup '+(null==(__t=isInitial?"initial":"")?"":__t)+" "+(null==(__t=uuid?"":"new")?"":__t)+" "+(null==(__t=cssClass)?"":__t)+'">\n\t\t',isInitial&&(__p+='\n\t\t\t<div class="type-popup-header">Animate</div>\n\t\t'),__p+='\n\t\t<div class="type-popup-content">\n\t\t\t',uuid&&(__p+='\n\t\t\t\t<div class="type-popup-item none" data-value="none" data-uuid="'+(null==(__t=uuid)?"":__t)+'">\n\t\t\t\t\t<div class="type-popup-text">none</div>\n\t\t\t\t</div>\n\t\t\t'),__p+="\n\t\t\t",_.each(availableTypes,(function(t){__p+="\n\t\t\t\t",(uuid||t!==currentType)&&(__p+='\n\t\t\t\t\t<div class="type-popup-item '+(null==(__t=t===currentType?"current":"")?"":__t)+'" data-value="'+(null==(__t=t)?"":__t)+'" data-uuid="'+(null==(__t=uuid)?"":__t)+'">\n\t\t\t\t\t\t',!isInitial&&uuid||(__p+='\n\t\t\t\t\t\t\t<div class="type-popup-prefix">'+(null==(__t=isInitial?"on":uuid?"":"Add")?"":__t)+"</div>\n\t\t\t\t\t\t"),__p+='\n\t\t\t\t\t\t<div class="type-popup-text">'+(null==(__t=t)?"":__t)+"</div>\n\t\t\t\t\t</div>\n\t\t\t\t"),__p+="\n\t\t\t"})),__p+="\n\t\t</div>\n\t</div>\n";return __p},"template-constructor-control-common_animation-top-block":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="js-top-block-content top-block-content">\n\t\t',animations.length?(__p+='\n\t\t\t<div class="animation-add js-add-animation">\n\t\t\t\tAdd\n\t\t\t\t'+(null==(__t=renderTypePopup({type:undefined,isInitial:!1,uuid:undefined,cssClass:"js-add-animation-popup"}))?"":__t)+'\n\t\t\t</div>\n\t\t\t<div class="animation-types">\n\t\t\t\t',_.each(animations,(function(t){__p+='\n\t\t\t\t\t<div class="animation-type '+(null==(__t=t.UUID===currentUuid?"current":"")?"":__t)+" "+(null==(__t="none"===t.type?"none":"")?"":__t)+" "+(null==(__t=allowTriggers(t)||"none"===t.type?"has-extra":"")?"":__t)+'">\n\t\t\t\t\t\t<div class="animation-type-header">\n\t\t\t\t\t\t\t<div class="animation-type-caption '+(null==(__t=t.UUID===currentUuid?"js-change-type":"js-change-animation")?"":__t)+'" data-uuid="'+(null==(__t=t.UUID)?"":__t)+'">\n\t\t\t\t\t\t\t\t<div class="animation-type-text">\n\t\t\t\t\t\t\t\t\t'+(null==(__t=t.type)?"":__t)+"\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t",t.UUID===currentUuid&&(__p+='\n\t\t\t\t\t\t\t\t\t<svg class="animation-type-dropdown-arrow" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t\t\t\t\t<path d="M3.206 5.46L.257 1.609A1 1 0 011.051 0H6.95a1 1 0 01.794 1.608L4.794 5.46a1 1 0 01-1.588 0z" fill-rule="evenodd"/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t'),__p+="\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t","none"===t.type&&t.UUID===currentUuid&&(__p+='\n\t\t\t\t\t\t\t\t<div class="animation-remove js-remove-animation" data-uuid="'+(null==(__t=t.UUID)?"":__t)+'">Delete</div>\n\t\t\t\t\t\t\t'),__p+="\n\t\t\t\t\t\t\t",t.UUID===currentUuid&&(__p+="\n\t\t\t\t\t\t\t\t"+(null==(__t=renderTypePopup({type:t.type,isInitial:!1,uuid:t.UUID,cssClass:"js-change-type-popup"}))?"":__t)+"\n\t\t\t\t\t\t\t"),__p+="\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t",t.UUID===currentUuid&&allowTriggers(t)&&(__p+='\n\t\t\t\t\t\t\t<div class="trigger-buttons-container js-trigger-buttons-container"></div>\n\t\t\t\t\t\t'),__p+="\n\t\t\t\t\t</div>\n\t\t\t\t"})),__p+="\n\t\t\t</div>\n\t\t"):__p+="\n\t\t\t"+(null==(__t=renderTypePopup({type:undefined,isInitial:!0,uuid:undefined}))?"":__t)+"\n\t\t",__p+="\n\t</div>\n";return __p}}},"j6/F":function(module,exports){module.exports={"template-constructor-control-common_align":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon" data-alt="Align" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t\t<div class="bottom" title="Align Bottom Edges"></div>\n\t\t<div class="middle" title="Align Vertical Centers"></div>\n\t\t<div class="top" title="Align Top Edges"></div>\n\t\t<div class="left" title="Align Left Edges"></div>\n\t\t<div class="center" title="Align Horizontal Centers"></div>\n\t\t<div class="right" title="Align Right Edges"></div>\n\t</div>\n';return __p}}},jamO:function(t,e,i){"use strict";i.d(e,"a",(function(){return w})),i.d(e,"b",(function(){return y}));var s=i("xi34"),o=i("q1z7"),n=i.n(o),a=i("rFsW"),r=i("jeLO"),l=i("Fi5S"),c=i("mT3t"),h=i("tf3M"),d=i("v92f"),p=i("OTSC"),u=i("DqjY"),g=i("onY4"),m=i("sviH"),f=i("Kf/z");function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var b=r.a.extend({sync:function(){return{error:s.a.noop,success:s.a.noop}},idAttribute:"_id",skipMagChanging:!0,fakeSave:!0,isNew:function(){return!1},getPageId:function(){return this.page.id},parse:function(t){return t.page&&(this.page=t.page,delete t.page),t}}),_=r.a.extend({idAttribute:"_id",urlRoot:"/api/page/",undoKeys:["wids","order"],mergeUndoSteps:!1,name:"Page",initialize:function(t,e){a.a.bindAll(this),e=e||{},this.loaded=!0,this._saveQueue=[],this._saveInProgress=!1,this.trigger("loaded"),this.on("change:wids",this.onChange),this.widgets=this.widgets||new h.WidgetsCollection([],{page:this}),this.widgets.on("change",this.setEdited,this),this.on("change:wids",this.setEdited,this),this.viewportStub=new b({viewport:"default",page:this,_id:this.id+"_viewport"},{parse:!0}),this.viewportStub.on("change:viewport",(function(t,e,i){i&&(i.undo||i.redo)&&(this.get("viewport_"+e)&&this.get("viewport_"+e).enabled||this.save("viewport_"+e,{enabled:!0},{patch:!0}),this.workspace.setViewport(e,i))}),this),this.on("change:viewport",(function(t,e,i){i&&(i.undo||i.redo)||this.viewportStub.save({viewport:this.get("viewport")})}),this),l.a.trigger("ready:model",this.viewportStub),l.a.trigger("ready:model",this)},sync:function(t,e,i){var s=(i=i||{}).success;return i.success=function(t){e.previousAttributes();e.changed.wids&&(t.wids=a.a.union(e.get("wids"),t.wids)),s&&s.apply(this,arguments)},c.a.prototype.sync.apply(this,arguments)},save:function(t,e,i){var s,o,n=this;if(!Object(f.a)("constructor.zIndex"))return r.a.prototype.save.apply(this,arguments);if(null==t||"object"===v(t)?(s=t,i=e):(s={})[t]=e,this._saveInProgress){this.set(s,i);var a={attrs:s,options:i,fakeXhr:{abort:function(){var t=n._saveQueue.indexOf(a);-1!==t&&n._saveQueue.splice(t,1)}}};return this._saveQueue.push(a),a.fakeXhr}this._saveInProgress=!0,o=r.a.prototype.save.call(this,s,i);var l=function(){if(n._saveInProgress=!1,n._saveQueue.length){var t=n._saveQueue.shift(),e=n.save(t.attrs,t.options);t.fakeXhr.abort=function(){return e.abort()}}};return o?o.always((function(){l()})):l(),o},parse:function(t,e){e&&(e.undo||e.redo)&&(t.num=this.get("num"));var i=a.a.clone(t),s=i.widgets||i.wids||[];return e=e||{},s=this.sanitizeWidgets(s),a.a.isEmpty(s)||(this.widgets=this.widgets||new h.WidgetsCollection([],{page:this}),this.widgets.reset(s,{page:this,parse:e.parse}),i.wids=a.a.pluck(s,"_id"),this.checkEmpty()),delete i.widgets,r.a.prototype.parse.call(this,i,e)},setEdited:function(t,e){this.isEmptyPage=!1},checkEmpty:function(){return!(this.widgets.length>1)&&(!!this.widgets.length&&("background"==this.widgets.at(0).get("type")&&("ffffff"==this.widgets.at(0).get("color")&&void 0===this.widgets.at(0).get("selectedType")&&(this.isEmptyPage=!0,!0))))},toJSON:function(){var t=r.a.prototype.toJSON.apply(this,arguments);return delete t.viewport,t},addWidget:function(t,e){var i;if(e=e||{},t instanceof h.default)i=t,this.widgets.add(i);else{if(!t||!t.type)return void console.error("Adding widget with no type");if(!m.a[t.type])return void console.error("Adding unknown widget");t.pid=this.id;var s=this.getCurrentViewport();if("default"!=s&&(t.hidden=!0),a.a.each(d.b.viewport_list,(function(e){t[e]&&-1==e.indexOf(s)&&"default"!=s&&(t[e].hidden=!0)})),"gmaps"===t.type){var o=this.workspace&&this.workspace.mag&&this.workspace.mag.get("opts");o&&o.gmaps_key&&(t.api_key=o.gmaps_key)}i=this.widgets.add(t)}if(i.id)e.nosave?this.getAddCallback(e)(i):i.fetch({success:this.getAddCallback(e),error:e.error});else{i.created=!e.copy&&!e.clone;"default"!=this.getCurrentViewport()&&(i.initViewport(e),i["viewport_"+this.getCurrentViewport()].hidden=!1),i.save({},{success:this.getAddCallback(e),error:e.error,clone:e.clone})}},onAdd:function(t,e){if(!t.get("type"))return!1;var i;Object(f.a)("constructor.zIndex")&&RM.constructorRouter.indexController.updateIndex(this,[t],!1);var s,o=this;return(i=a.a.clone(this.get("wids"))).push(t.id),i=Object(a.a)(i).chain().uniq().compact().value(),e&&(e.group||e.nosave)?this.set({wids:i},{copy:e.copy,silent:!!e.silent,isMultiple:e.isMultiple}):s=new Promise((function(t,e){o.save({wids:i},{success:t,error:e})})),!e.silent&&t.is_global&&t.triggerGlobalAppear(),this.sendAnalyticsEvent("Create Widget",{_widget_type:t.get("type"),label:t.get("type")}),s},getAddCallback:function(t){t=t||{};var e=this;return function(i){var s=e.onAdd(i,t);s instanceof Promise?(s.then((function(){if(Object(f.a)("constructor.zIndex"))return RM.constructorRouter.indexController.saveAffectedPages()})),s.finally((function(){t.success&&t.success(i,t)}))):t.success&&t.success(i,t)}},onChange:function(t,e,i){var s=t.changedAttributes().wids,o=t.previous("wids")||[];if(s){var n=a.a.difference(s,o),r=a.a.difference(o,s);a.a.each(n,(function(e){var s=t.widgets.get(e);i.is_new_global=s.isGlobal(),i.isMultiple=n.length>1||i.isMultiple,s&&this.trigger("widget:create",s,i),a.a.defer(function(){s&&s.isGlobal()&&s.get("pid")==this.id&&s.triggerGlobalAppear()}.bind(this))}),this),a.a.each(r,(function(e){var s=t.widgets.get(e);s&&this.trigger("widget:remove",s,i),a.a.defer(function(){s&&s.isGlobal()&&s.get("pid")==this.id&&s.triggerGlobalDisappear()}.bind(this))}),this)}},duplicate:function(t){var e=this,i=[];RM.constructorRouter.mag.globalWidgets.each((function(t){i.push(t.get("_id"))})),s.a.ajax({url:this.urlRoot+"duplicate/",type:"POST",dataType:"json",data:{_id:this.get("_id"),num:parseInt(this.get("num"),10)+1,mid:this.get("mid"),globalWidgets:i},success:function(i){var o=i.page;i.widgets&&a.a.each(i.widgets,(function(t){var e=RM.constructorRouter.mag.globalWidgets.find({_id:t._id});e.set(t),e.save({},{silent:!0,skipHistory:!0})})),s.a.get("/api/pageFullById/"+o._id,function(i){var s=new _(i,{parse:!0});s.set("screenshot",e.get("screenshot")),this.sendAnalyticsEvent("Create Page",{_page_type:"duplicate"}),t&&t(s)}.bind(this)).fail((function(e,i){alert(i.responseText),t(new Error("ould not get page data"))}))},error:function(e){try{var i=JSON.parse(e.responseText);t(new Error("Server error: ".concat(i&&i.err?i.err:"unknown")))}catch(i){t(new Error("Server error: could not parse it")),alert(e.responseText)}},context:this})},sendAnalyticsEvent:function(t,e){var i=RM.constructorRouter||RM.collectorRouter||RM.viewerRouter||RM.homepageRouter;i&&i.analytics&&i.analytics.sendEvent(t,e)},getEffectiveHeight:function(){var t=this.getCurrentViewportSetting("min_height");return Math.round(this.widgets.reduce((function(t,e){return"background"==e.get("type")?t:Math.max((e.get("y")||0)+(e.get("h")||0),t)}),t))},getWidgetsQuantity:function(){return this.get("wids").length},removeWidgets:function(t,e){if(e=e||{},!a.a.isEmpty(t))if("default"==(e.viewport||this.getCurrentViewport())||e.forceRemove){this.trigger("widgets:remove",t,e);var i=a.a.difference(this.get("wids"),t);e.nosave?this.set({wids:i},{silent:!!e.silent}):this.save({wids:i})}else this.trigger("toggleWidgets",{wids:t,hidden:!0})},validate:function(t){if(a.a.isArray(t.tags)&&(t.tags=a.a.uniq(t.tags)),t.uri){if(/(^\-)|(\-$)/.test(t.uri))return{hyphen:!0};if(/^[0-9]+$/.test(t.uri))return{onlyNumbers:!0};if(t.uri.length>128)return{uriLength:!0};var e=this;if(this.collection&&this.collection.any((function(i){if(i!=e)return Object(f.a)("viewer.subpages")?(i.get("uri")||"").toLowerCase()===t.uri.toLowerCase()&&i.get("parentPage")===t.parentPage:(i.get("uri")||"").toLowerCase()==t.uri.toLowerCase()})))return{used:!0}}},groupSaveWids:function(t,e){var i=a.a.pluck(t,"id"),s=a.a.clone(this.get("wids"));e=e||{},this.set("wids",i,{silent:!0}),this.save({wids:s},e)},sanitizeWidgets:function(t){return a.a.filter(t,(function(t){return!!m.a[t.type]}))},getPageId:function(){return this.id},renewScreenshot:function(){return delete this.specialScreenshot,this},getScreenshot:function(t){return this.specialScreenshot?this.specialScreenshot:(t=p.b.screenshotSize(t||256),this.get("screenshot")?p.b.addFilenameComponent(this.get("screenshot"),t):["/api/screenshot/renew",RM.constructorRouter.mag.get("num_id"),this.get("_id"),"?redirect=true&size="+t].join("/"))},requestNewScreenshot:function(t){s.a.get(["/api/screenshot/renew",RM.constructorRouter.mag.get("num_id"),this.get("_id")].join("/"),a.a.bind((function(e){var i=e.screenshot;i&&(this.save("screenshot",i,{patch:!0}),t())}),this))},requestActualScreenshot:function(t){s.a.get(this.urlRoot+this.id+"/screenshot",a.a.bind((function(e){var i=e.screenshot;i&&(this.save("screenshot",i,{patch:!0}),t())}),this))},getCurrentViewportSetting:function(t,e){return e=e||this.getCurrentViewport(),(a.a.findWhere(d.b.viewports,{name:e})||{})[t]},getViewportParam:function(t,e){var i=this.get("viewport_"+t)||{};return void 0!==i[e]?i[e]:this.get(e)},setViewportParam:function(t,e,i,s){var o=a.a.clone(this.get("viewport_"+t)||{}),n={};o[e]=i,"default"===t?n[e]=i:n["viewport_"+t]=o,this.set(n,s||{})},getCurrentViewportParam:function(t){return this.getViewportParam(this.getCurrentViewport(),t)},setCurrentViewportParam:function(t,e,i){this.setViewportParam(this.getCurrentViewport(),t,e,i)},getViewport:function(){return this.getCurrentViewport()},getCurrentViewport:function(){return this.get("viewport")||"default"},getPreviousViewport:function(){return this.previous("viewport")||"default"},getUsedFonts:function(t){t=t||{};var e=[];return a.a.each(this.widgets.models,(function(t){e.push(t)})),u.a.getUsedFontsFromWidgetsModels(a.a.extend(t,{models:e}))},getOwnGlobalWidgets:function(){return this.widgets.filter(function(t){return t.isGlobal()&&t.get("pid")==this.id}.bind(this))},hasChildren:function(){var t=this;return RM.constructorRouter.mag.pages.some((function(e){return e.get("parentPage")===t.attributes._id}))},isChild:function(){return Boolean(this.attributes.parentPage)}},{getViewportSetting:function(t,e){return(a.a.findWhere(d.b.viewports,{name:e})||{})[t]}}),w=n.a.Collection.extend({model:_,comparator:function(t){return t.get("num")},fetchFullPage:function(t,e){e=e||{},this.fetchingPageXHR||(this.fetchingPageXHR=s.a.get("/api/pageFullById/"+t,a.a.bind((function(i){var s=this.get(t);s||(s=new _(i,{parse:!0}),RM.constructorRouter.mag.onAdd(s,e)),delete s.needUpdate,g.a.clearHistory(s.get("_id")),s.widgets.set(i.wids,{parse:!0,resetPage:!0});var o=a.a.pluck(i.wids,"_id");console.log("RESET"),s.set(a.a.extend({},i,{wids:o}),{resetPage:!0}),e.success&&e.success(),delete this.fetchingPageXHR}),this)).fail(a.a.bind((function(){delete this.fetchingPageXHR,alert("failed to load page, please, refresh the page"),e.success&&e.success()}),this)))}}),y=n.a.Collection.extend({model:_,name:"TrashPages",initialize:function(){this.on("remove",(function(){this.triggerSocketUpdate(this,this.pluck("_id"))}),this)},triggerSocketUpdate:c.a.prototype.triggerSocketUpdate});e.c=_},jeLO:function(t,e,i){"use strict";var s=i("q1z7"),o=i.n(s),n=i("rFsW"),a=i("mT3t"),r=i("Fi5S"),l=a.a.prototype,c=a.a.extend({save:function(t,e,i){var s,o=this;if(n.a.isObject(t)||null==t?(s=t,i=e):(s={})[t]=e,i&&i.skipMagChanging&&this.urlRoot&&(i.url=this.url()+(this.url().indexOf("?")>-1?"&":"?")+"skip_changed=true"),!(i=i?n.a.clone(i):{}).skipPersist)var a=l.save.apply(this,arguments);if(a)return a.error((function(t,e){"abort"!=e&&(t.status&&t.status<500||(o.wasNotSaved=!0,RM.constructorRouter.raiseConnectionError()))})),a.success((function(){o.wasNotSaved&&o.trigger("re-saved"),o.wasNotSaved=!1})),this.skipResponse&&(a.skipResponse=!0),r.a.trigger("save:model",{model:this,setAttrs:s,options:i}),!this.skipMagChanging&&!i.skipMagChanging&&RM.constructorRouter.mag&&RM.constructorRouter.mag.set("changed",!0),a},sync:function(t,e,i){if("patch"==t.toLowerCase()&&e.collection&&e.collection.page){var s=e.collection.page.getCurrentViewport();if(!("default"==s||i&&i.forceDefaultViewport||this.isNested)){var o=e.toJSON(),a={};a["viewport_"+s]=n.a.pick(o["viewport_"+s],n.a.keys(i.attrs)),n.a.isEmpty(a["viewport_"+s])&&delete a["viewport_"+s];var r=n.a.difference(n.a.keys(i.attrs),n.a.keys(a["viewport_"+s]));n.a.extend(a,n.a.pick(e.attributes,r)),i.attrs=a}}return l.sync.apply(this,arguments)},parse:function(t,e){return e&&e.xhr&&e.xhr.skipResponse?(l.parse.apply(this,arguments),this.isNew()?t:void 0):l.parse.apply(this,arguments)},set:function(t,e,i){var s,a;if(n.a.isObject(t)||null==t?(s=t,a=e):((s={})[t]=e,a=i),(a=a||{}).viewport&&!a.forceDefaultViewport&&!a.xhr&&this.getViewport&&this.getViewport()!=a.viewport)return this["viewport_"+a.viewport]=n.a.extend(this["viewport_"+a.viewport]||{},s),this;var l=this.cloneJSON(),c=o.a.Model.prototype.set.apply(this,arguments);return r.a.trigger("set:model",{model:this,prevAttrs:l,setAttrs:s,options:a}),c},cloneJSON:function(){var t=this.toJSON();return n.a.each(t,(function(e,i){t[i]=n.a.cloneWithObjects(e)})),t}});e.a=c},kv7G:function(t,e,i){},kwFJ:function(module,exports){module.exports={"template-constructor-control-slideshow_manager":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon preloader noarrow" data-alt="Images" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t\t<div class="resizable-scroll-wrapper">\n\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t<div class="resizable-content">\n\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="resizable-scroll"></div>\n\t\t</div>\n\t\t<div class="resize-handle-top"></div>\n\t\t<div class="resize-handle-bottom"></div>\n\n\t\t<div class="add-block">\n\t\t\t<div class="add" title="Add Images"></div>\n\t\t</div>\n\n\t\t<div class="error-panel">\n\t\t\t<div class="error-panel-text"></div>\n\t\t\t<div class="corner-wrapper"><div class="corner"></div></div>\n\t\t</div>\n\n\t\t<div class="drop-text">Drop here</div>\n\t</div>\n';return __p},"template-constructor-control-slideshow_manager-image":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="slideshow-image-wrapper '+(null==(__t=pic.error?"error":"")?"":__t)+'" data-num="'+(null==(__t=pic.num)?"":__t)+'" ',pic.errorText&&(__p+='data-error="'+(null==(__t=pic.errorText)?"":__t)+'" '),__p+=' >\n\t\t<div class="slideshow-image">\n\t\t\t<div class="num">'+(null==(__t=pic.num)?"":_.escape(__t))+'</div>\n\t\t\t<div class="image"',pic.thumbUrl&&(__p+=" style=\"background-image: url('"+(null==(__t=pic.thumbUrl)?"":__t)+"')\" "),__p+=' data-id="'+(null==(__t=pic.id)?"":_.escape(__t))+'">\n\t\t\t\t<div class="rmpreloader">\n\t\t\t\t\t<div class="shadow"></div>\n\t\t\t\t\t<div class="arc"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="remove" title="Delete"></div>\n\t\t\t<div class="update" title="Replace"></div>\n\t\t</div>\n\t</div>\n';return __p}}},lRGI:function(t,e,i){"use strict";var s=i("xi34"),o=i("q1z7"),n=i.n(o),a=i("rFsW"),r=i("zw1n"),l=i.n(r),c=i("M9xF"),h=i.n(c),d=i("3XvJ"),p=i.n(d),u=i("OTSC"),g={STYLE_PREFIXES:{viewer:[".rmwidget.widget-button .common-button"],viewerCurrentLink:[".maglink.current .widget-button .common-button"],constructor:[".block.button .common-button"]},generateIndividualStyleCSS:function(t){var e=this.STYLE_PREFIXES[t.env],i=t.model,o=i.tp,n=this,r=function(s){s=s||"default";var r={default:"",hover:"hovered",current:"current"},l={default:"",hover:"hover-",current:"current-"},c=a.a.isUndefined(r[s])?r.default:r[s],h=a.a.isUndefined(l[s])?l.default:l[s],d=a.a.map(e,(function(t){return t+'[data-id="'+i._id+'"]'+(c?"."+c:"")})).join(",\n")+" {\n";return d+=n.generateStylesStr({model:i,attrPrefix:h,indentation:!0,lineBreaks:!0,env:t.env,state:s}),d+="}\n\n","viewer"===t.env&&("current"===s&&(d+=n.STYLE_PREFIXES.viewerCurrentLink+'[data-id="'+i._id+'"] {\n',d+=n.generateStylesStr({model:i,attrPrefix:h,indentation:!0,lineBreaks:!0}),d+="}\n\n"),"icon"!==o&&"text_and_icon"!==o||(d+=a.a.map(e,(function(t){return t+'[data-id="'+i._id+'"]'+(c?"."+c:"")+" .icon"})).join(",\n")+" {\n",d+='\t background-image: url("'+(Modernizr.retina?i[h+"icon_raster2xUrl"]:i[h+"icon_rasterUrl"])+'");\n',d+="}\n\n","current"===s&&(d+=n.STYLE_PREFIXES.viewerCurrentLink+'[data-id="'+i._id+'"] .icon {\n',d+='\t background-image: url("'+(Modernizr.retina?i[h+"icon_raster2xUrl"]:i[h+"icon_rasterUrl"])+'");\n',d+="}\n\n"))),d},l=r("default");a.a.find(a.a.keys(i),(function(t){return/^current/.test(t)}))&&(l+=r("current")),l+=r("hover");var c="individual_button_style_"+i._id+"_"+t.env;Object(s.a)("#"+c).remove();var h=document.createElement("style");h.type="text/css",h.id=c,h.className="button_styles",h.appendChild(document.createTextNode(l)),document.getElementsByTagName("head")[0].appendChild(h)},generateStylesStr:function(t){var e="",i=t.model,s=t.indentation?"\t":"",o=";"+(t.lineBreaks?"\n":""),n=t.attrPrefix||"";return e+=s+"background-color: "+u.b.getRGBA(a("background-color"),a("background-color-opacity")/100)+o,e+=s+"border-radius: "+r(a("border-radius"))+o,e+=s+"border-width: "+r(a("border-width"))+o,e+=s+"border-color: "+u.b.getRGBA(a("border-color"),a("border-color-opacity")/100)+o,e+=s+"font-family: "+a("font-family")+o,e+=s+"font-weight: "+a("font-weight")+o,e+=s+"font-style: "+a("font-style")+o,e+=s+"color: "+u.b.getRGBA(a("color"),a("color-opacity")/100)+o,e+=s+"font-size: "+r(a("font-size"))+o,e+=s+"letter-spacing: "+r(a("letter-spacing"))+o,i["hover-tansition-duration"]&&(e+=s+"transition: ".concat(i["hover-tansition-duration"],"s")+o),t.env&&t.state&&"viewer"===t.env&&"hover"===t.state&&i["hover-cursor"]&&(e+=s+"cursor: ".concat(i["hover-cursor"])+o),e;function a(t){var e=i[n+t];return("inherit"===e&&n||void 0===e)&&(e=i[t]),"border-color"===t&&"hover-"===n?0==i["hover-border-width"]&&(e=i["border-color"]):"border-color"===t&&"current-"!==n&&0==i["border-width"]&&(e=i["hover-border-color"]),"border-color-opacity"===t&&"hover-"===n?0==i["hover-border-width"]&&(e=i["border-color-opacity"]):"border-color-opacity"===t&&0==i["border-width"]&&(e=i["hover-border-color-opacity"]),e}function r(t){return t+(/px/i.test(t)?"":"px")}},destroyIndividualStyleCSS:function(t){var e="individual_button_style_"+t.model._id+"_"+t.env;Object(s.a)("#"+e).remove()}};function m(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function f(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var v=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?m(i,!0).forEach((function(e){f(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):m(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},l.a,{},h.a,{},p.a),b=n.a.View.extend({MIN_ICON_MARGIN:8,initialize:function(t){t&&(a.a.bindAll(this),this.block=t.block,this.model=t.block&&t.block.model,this.model=t.model,this.$container=t.$container,this.environment=t.environment,this.mag=t.mag,a.a.extend(this.model,{env:this.environment}),this.generateIndividualStyleCSS({env:this.environment,model:this.model}),this.template=v["template-common-button-widget"],"constructor"===this.environment?this.text_template=v["template-constructor-block-button"]:this.text_template=v["template-viewer-widget-button"],this.render())},render:function(){this.model.tp;var t=g.generateStylesStr({model:this.model});this.setElement(Object(s.a)(this.template({data:this.model}))),Object(s.a)(this.text_template({data:this.model})).appendTo(this.$el),this.$text=this.$(".text"),this.$icon=this.$(".icon"),this.$button=this.$text.closest(".common-button"),this.$button.attr("style",t),this.applyButtonType(this.model.tp),"circle"===this.model.form&&this.applyCircleRadius(this.model.w),this.applyTextContainerSize(this.model),this.applyIconContainerSize(this.model),this.applyIconPosition(this.model),"viewer"===this.environment&&this.$container.css("border-radius",this.$button.css("border-radius")),this.$el.appendTo(this.$container),this.renderFinishTimeout=setTimeout(function(){var t=["background-color","background-color-opacity","border-width","border-color","border-color-opacity","font-family","font-style","font-weight","color","color-opacity","font-size","letter-spacing"];"circle"!==this.model.form&&t.push("border-radius"),t.forEach(function(t){this.$button.css(t,"")}.bind(this)),this.applyTransition()}.bind(this),500)},renderButtonText:function(t){this.$el.find(".text").val(t)},renderButtonTextWithSizes:function(t,e){e&&this.applyTextContainerSize(e),this.$el.find(".text").val(t).css({display:t?"block":"none"})},applyTransition:function(){"viewer"!==this.environment||Modernizr.touch||this.model.transition&&this.$button.addClass("transition")},applyButtonType:function(t){"text"===t?(this.$text.css("display","inline-block"),this.$icon.css("display","none")):"icon"===t?(this.$icon.css("display","inline-block"),this.$text.css("display","none")):"text_and_icon"===t&&this.$icon.add(this.$text).css("display","inline-block")},applyCircleRadius:function(t){this.$button.css("border-radius","100%")},applyTextContainerSize:function(t){var e=t["letter-spacing"],i=0,s=0;e>0?i=e:e<0&&(s=e),this.$text.css({width:t.text_w+"px","padding-left":i+"px","text-indent":s+"px",height:"viewer"===this.environment?"".concat(t.h,"px"):"".concat(t.text_h,"px"),"line-height":"viewer"===this.environment?"".concat(t.h,"px"):"".concat(t.text_h,"px")})},applyIconContainerSize:function(t){t.tp;var e=t.icon_w,i=t.icon_h;t.icon_pos;this.$icon.css({width:e+"px",height:i+"px","margin-right":"0px","margin-left":"0px"})},calcIconMarginFromText:function(t){return Math.ceil(t/4)},calcIconTopBottomMargin:function(t){return Math.ceil(t/3)},calcTextTopBottomMargin:function(t){return Math.ceil(t/6)},applyIconPosition:function(t){var e=t.icon_pos;"left"===e?this.$button.css({"flex-direction":"row","-webkit-flex-direction":"row"}):"right"===e&&this.$button.css({"flex-direction":"row-reverse","-webkit-flex-direction":"row-reverse"})},generateIndividualStyleCSS:function(t){g.generateIndividualStyleCSS({env:t.env,model:t.model})},destroy:function(){clearTimeout(this.renderFinishTimeout),g.destroyIndividualStyleCSS({env:this.environment,model:this.model}),this.$el&&this.$el.remove()}});e.a=b},ln7P:function(t,e,i){"use strict";var s=i("Tiua");i.n(s).a},m41J:function(t,e,i){"use strict";var s=i("rFsW"),o=(i("Kf/z"),i("gobI")),n={sideAngles:{top:0,right:.5*Math.PI,bottom:Math.PI,left:1.5*Math.PI},calcOrientedTriangleSquare:function(t,e,i){return(e.x-t.x)*(i.y-t.y)-(e.y-t.y)*(i.x-t.x)},intersectsOnAxisProjection:function(t,e,i,s){var o;return t>e&&(o=t,t=e,e=o),i>s&&(o=i,i=s,s=o),t<i&&(t=i),e>s&&(e=s),t<=e},isLinesIntersects:function(t,e,i,s){return n.intersectsOnAxisProjection(t.x,e.x,i.x,s.x)&&n.intersectsOnAxisProjection(t.y,e.y,i.y,s.y)&&n.calcOrientedTriangleSquare(t,e,i)*n.calcOrientedTriangleSquare(t,e,s)<=0&&n.calcOrientedTriangleSquare(i,s,t)*n.calcOrientedTriangleSquare(i,s,e)<=0},isConvexPolygonContainsPoint:function(t,e){for(var i=0;i<t.length;i++){var s=(i+1)%t.length;if(n.calcOrientedTriangleSquare(t[i],t[s],e)<0)return!1}return!0},isConvexPolygonsIntersects:function(t,e){var i,s,o,a;for(i=0;i<t.length;i++)if(n.isConvexPolygonContainsPoint(e,t[i]))return!0;for(i=0;i<e.length;i++)if(n.isConvexPolygonContainsPoint(t,e[i]))return!0;for(i=0;i<t.length;i++)for(s=(i+1)%t.length,o=0;o<e.length;o++)if(a=(o+1)%e.length,n.isLinesIntersects(t[i],t[s],e[o],e[a]))return!0;return!1},doBoundingBoxesIntersect:function(t,e){return t&&e&&!(e.left>t.right||e.right<t.left||e.top>t.bottom||e.bottom<t.top)},calcBoundingBox:function(t,e,i){var o=n.calcRotatedBox(t),a=s.a.pluck(o,"x"),r=s.a.pluck(o,"y"),l=Math.min.apply(null,a),c=Math.max.apply(null,a),h=Math.min.apply(null,r),d=l,p=h,u=c-l,g=Math.max.apply(null,r)-h;return e&&(["n","c","s"].indexOf(e)>-1&&(d=t.left),["w","c","e"].indexOf(e)>-1&&(p=t.top)),i?{width:u,height:g,left:d,top:p}:{bb_width:u,bb_height:g,bb_left:d,bb_top:p}},boxToRect:function(t){return{width:t.width,height:t.height,top:t.top,bottom:t.top+t.height,left:t.left,right:t.left+t.width}},getBoundingBoxOfElements:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=t.map((function(t){return t.parentElement?1!==e?o.a.getBox(t,e):t.getBoundingClientRect():{bottom:0,height:0,left:0,right:0,top:0,width:0}}));return n.getBoundingBoxOfBoxes(i)},getBoundingBoxOfBoxes:function(t){var e=[],i=[];s.a.each(t,(function(t){var o=void 0!==t.right?s.a.extend({},t):n.boxToRect(t);e.push(o.left),e.push(o.right),i.push(o.top),i.push(o.bottom)}));var o={top:Math.min.apply(null,i),right:Math.max.apply(null,e),bottom:Math.max.apply(null,i),left:Math.min.apply(null,e)};return o.width=o.right-o.left,o.height=o.bottom-o.top,o},getBoundingBoxOfBlocks:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=t.map((function(t){var e=t.getBoxData({includeBoundingBox:!0,checkFixedPosition:!0});return{width:e.bb_w,height:e.bb_h,top:e.bb_y,left:e.bb_x}}));return n.getBoundingBoxOfBoxes(e)},calcRotatedBox:function(t){var e=[],i=[0,1,1,0],o=[0,0,1,1],n=t.left+t.width/2,a=t.top+t.height/2,r=t.sinAngle,l=t.cosAngle;return s.a.each(i,(function(s,c){var h=t.left+t.width*i[c],d=t.top+t.height*o[c],p=h-n,u=a-d;h=n+l*p+r*u,d=a+r*p-l*u;e.push({x:h,y:d})})),e},getDistance:function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},getBestPoints:function(t,e){for(var i,s,o,a=["right","left","bottom","top"],r={distance:1/0,fromPoint:{},toPoint:{}},l=0;l<a.length;l++)for(var c=0;c<a.length;c++)s=n.getSideCenter(t,a[l]),o=n.getSideCenter(e,a[c]),r=(i=n.getDistance(s,o))<r.distance?{distance:i,fromSide:a[l],fromPoint:s,toSide:a[c],toPoint:o}:r;return r},getSideCenter:function(t,e){var i;switch(e){case"left":i={x:t.left,y:t.top+t.height/2};break;case"top":i={x:t.left+t.width/2,y:t.top};break;case"bottom":i={x:t.left+t.width/2,y:t.top+t.height};break;case"right":default:i={x:t.left+t.width,y:t.top+t.height/2}}return i={x:(i.x-t.centerX)*t.cos-(i.y-t.centerY)*t.sin+t.centerX,y:(i.y-t.centerY)*t.cos+(i.x-t.centerX)*t.sin+t.centerY}},getPerpendicularEnd:function(t,e,i,s){var o=i.angle+n.sideAngles[t];return{x:s*Math.sin(o)+e.x,y:-s*Math.cos(o)+e.y}},getBox:function(t){var e=(t.$el&&t.$el[0]||t.length&&t[0]||t).getBoundingClientRect(),i=t.model?(t.model.attributes.angle||0)*Math.PI/180:0;return e=s.a.extend(e,{angle:i,sin:Math.sin(i),cos:Math.cos(i)}),e=s.a.extend(e,{centerX:e.left+e.width/2,centerY:e.top+e.height/2})},getResizedBoxNested:function(t,e,i,s){var o=i.width/e.width,n=i.height/e.height;return o="height"===s?n:o,n="width"===s?o:n,{left:(t.left-e.left)*o+i.left,top:(t.top-e.top)*n+i.top,width:t.width*o,height:t.height*n}},getResizedBoxByBB:function(t,e,i){var s=i.left+i.width/2,o=i.top+i.height/2,n=i.width/e.width,a=i.height/e.height,r=t.width*n,l=t.height*a;return{left:s-r/2,top:o-l/2,width:r,height:l}},getBoxLimits:function(t,e){var i=t.width/t.height>1,s=i?e.minheight/t.height:e.minwidth/t.width,o=i?e.maxwidth/t.width:e.maxheight/t.height;return{minwidth:e.minwidth?Math.round(t.width*s):1,minheight:e.minheight?Math.round(t.height*s):1,maxwidth:e.maxwidth?Math.round(t.width*o):1/0,maxheight:e.maxheight?Math.round(t.height*o):1/0}}};e.a=n},mT3t:function(t,e,i){"use strict";var s=i("q1z7"),o=i.n(s),n=i("rFsW"),a=o.a.Model.extend({parse:function(t,e){return!e||!e.xhr||this.isNew()||e&&e.noSocketUpdate||(n.a.isEmpty(t)&&(t=this.toJSON(n.a.pick(e,"viewport","fixViewports"))),this.triggerSocketUpdate(t,e)),o.a.Model.prototype.parse.apply(this,arguments)},triggerSocketUpdate:function(t,e){var i=t;if(e&&e.patch&&(i=n.a.extend({},e.attrs,this.pick("_id","pid"))),i=this.getChangedAttributes?this.getChangedAttributes():i,n.a.isEmpty(i)&&(i=this.toJSON()),!i.pid&&this.getPageId&&"Page"==!this.name&&(i.pid=this.getPageId()),this.getViewport&&"default"!=this.getViewport()){var s=i.pid||this.getPageId&&this.getPageId();return this.triggerViewportUpdate(s)}RM.constructorRouter.trigger("update_from_server",this.name,i)},triggerViewportUpdate:function(t){RM.constructorRouter.trigger("update_from_server","Viewport",t)}});e.a=a},"mX/r":function(t,e,i){"use strict";var s=i("E913");i.n(s).a},muOB:function(t,e,i){"use strict";var s=i("IzrY");i.n(s).a},n1zk:function(t,e,i){},nnuN:function(t,e,i){"use strict";i.r(e);var s=i("rFsW"),o=i("DqjY"),n=i("xi34"),a=function(t){this.edit_params=t,this.proxyMethods(["set","get","fetch","on","off","save"]),this.updateTypetodayVariations()};a.prototype={id:"_fonts",MAX_VISIBLE_TYPEKIT_FONTS:5,FVD_NAMES:{n1:"Thin",n2:"ExtraLight",n3:"Light",n4:"Regular",n5:"Medium",n6:"SemiBold",n7:"Bold",n8:"ExtraBold",n9:"Black",i1:"Thin Italic",i2:"ExtraLight Italic",i3:"Light Italic",i4:"Italic",i5:"Medium Italic",i6:"SemiBold Italic",i7:"Bold Italic",i8:"ExtraBold Italic",i9:"Black Italic"},PROVIDERS:{system:{title:"System Fonts",url:""},google:{title:"Google Fonts",url:"http://www.google.com/fonts"},typekit:{title:"Typekit",url:"http://www.typekit.com/"},webtype:{title:"<Webtype>",url:"http://www.webtype.com/"},typetoday:{title:"Type.today",url:"https://type.today/"},custom:{title:"Custom web font",url:""}},proxyMethods:function(t){var e=this,i=this.edit_params;s.a.each(t,(function(t){e[t]=function(){return i[t].apply(i,arguments)}}))},updateTypetodayVariations:function(){var t=!1,e=s.a.map(this.get("fonts"),(function(e){if("typetoday"===e.provider){var i=s.a.find(o.a.fontsShortList.typetoday,{name:e.css_name}),n=Boolean(i&&s.a.difference(i.variations,e.variations).length);return t=t||n,n?s.a.extend({},e,{variations:s.a.union(e.variations,i&&i.variations)}):e}return e}));t&&this.save({fonts:e},{silent:!0})},appendFontsCssToDocument:function(t,e){o.a.appendFontsCssToDocument(s.a.extend({fonts:this.get("fonts")},t),e)},findFontByCSSName:function(t){return s.a.find(this.get("fonts"),(function(e){return e.css_name.toLowerCase()===t.toLowerCase()}))||{css_name:t,name:t}},getProviderData:function(t){var e=this.PROVIDERS[t]||{};return s.a.defaults(e,{title:"",url:""}),e},getStyleName:function(t,e,i){var s,n=("italic"===e.toLowerCase()?"i":"n")+t/100;return i&&(s=o.a.getCustomVariationNameByFVD(i,n)),s||this.FVD_NAMES[n]},getVisualRenderedFontStyles:function(t,e,i){var o={"font-weight":e};o["font-style"]=i;var n=this.findFontByCSSName(t),a=9999;return n&&(o["font-family"]=t,s.a.each(n.variations,(function(t){var i=100*(t.substr(1,1)-0),s=Math.abs(i-e);s<a&&(o["font-weight"]=i,a=s)})),Math.abs(700-e)<a&&(o["font-weight"]=700)),o},findCommonFontsStylesAvailable:function(t){var e=[];return s.a.each(t,s.a.bind((function(t){var i=this.findFontByCSSName(t);if(i){var o=[];s.a.each(i.variations,(function(t){var e=100*(t.substr(1,1)-0),i="n"===t.substr(0,1)?"normal":"italic";o.push(e+"-"+i)})),e.push(o)}}),this)),e.length>0&&(e=s.a.intersection.apply(this,e)),e},typekitFontsCount:function(t){var e=s.a.where(t,{provider:"typekit"}).length,i=s.a.where(t,{provider:"typekit",hidden:!0}).length;return{visible:e-i,hidden:i}},changeFontHidden:function(t,e,i,o){var a=s.a.cloneWithObjects(this.get("fonts")),r=s.a.find(a,(function(e){return e.css_name.toLowerCase()===t.toLowerCase()}))||{};return r.hidden=e,r._id&&r.is_personal&&n.a.ajax({url:"/api/customfonts",method:"PATCH",dataType:"json",contentTypeType:"application/json",data:{_id:r._id,hidden:r.hidden,mag_user:i,mag_num_id:o}}),this.typekitFontsCount(a).visible>this.MAX_VISIBLE_TYPEKIT_FONTS?{error:"typekit-full-house"}:(this.save("fonts",a),{})},getUsedFontsCache:function(){var t={};return s.a.each(this.get("fonts"),(function(e){t[e.css_name]={temporary:e.temporary,hidden:e.hidden}})),t},addFonts:function(t,e){var i,o,n=s.a.cloneWithObjects(this.get("fonts"));return s.a.each(t,s.a.bind((function(o){s.a.contains(["template","paste"],e)&&delete o.used_variations,i=s.a.find(n,(function(t){return t.css_name.toLowerCase()===o.css_name.toLowerCase()})),s.a.contains(["font-explorer","manual"],e)&&(i?i.hidden=!1:n.push(o)),"font-upload"===e&&(i?s.a.extend(i,t[0]):n.push(o)),s.a.contains(["template","paste"],e)&&(i||(o.hidden=!0,n.push(o)))}),this)),"font-explorer"===e&&this.typekitFontsCount(n).visible>this.MAX_VISIBLE_TYPEKIT_FONTS?{error:"typekit-full-house"}:((o=RM.constructorRouter)&&(o=o.workspace)&&(o=o.controls)&&(o=o.findControl("text_typography"))&&o.plusAnimation(),this.save({fonts:n},{silent:s.a.contains(["template","paste","manual"],e)}),this.appendFontsCssToDocument({version:"edit"},(function(){RM.constructorRouter.trigger("font-added")})),{})},removeFonts:function(t){var e=s.a.cloneWithObjects(this.get("fonts"));s.a.each(e,(function(e){s.a.each(t,(function(t){e.css_name.toLowerCase()===t.toLowerCase()&&(e.hidden=!0)}))})),this.save("fonts",e)},clearTempFonts:function(){if(s.a.findWhere(this.get("fonts"),{temporary:!0})){var t=s.a.cloneWithObjects(this.get("fonts"));t=s.a.filter(t,(function(t){var e=!(t.temporary&&t.hidden);return delete t.temporary,e})),this.save("fonts",t)}}},e.default=a},o3C3:function(module,exports){module.exports={"template-constructor-helpers-font-selector":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="rmfontselector">\n\n\t\t<div class="tabs-switcher">\n\t\t\t<div class="caption-system">System</div>\n\t\t\t<div class="caption-custom">Custom</div>\n\t\t</div>\n\n\t\t<div class="categories">\n\n\t\t\t<div class="scroll-wrapper system">\n\t\t\t\t<div class="category-wrapper">\n\t\t\t\t\t<div class="category">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="scroll"></div>\n\t\t\t</div>\n\n\t\t\t<div class="scroll-wrapper custom">\n\t\t\t\t<div class="category-wrapper">\n\t\t\t\t\t<div class="category">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="scroll"></div>\n\t\t\t</div>\n\n\t\t</div>\n\n\n\t\t<div class="add-font">\n\t\t\t<div class="add-font-button" data-type="upload">Upload</div>\n\t\t\t<div class="add-font-button" data-type="library">Library</div>\n\t\t</div>\n\n\t\t<div class="upload-font invisible"></div>\n\t</div>\n\n';return __p},"template-constructor-helpers-font-selector-item":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="category-element icon-'+(null==(__t=font.provider)?"":__t)+" ",font.hidden&&(__p+="hidden"),__p+="  "+(null==(__t=font.is_personal&&!canUploadFonts?"disabled":"")?"":__t)+" "+(null==(__t=font.is_personal?"personal":"")?"":__t)+'" data-css_name="'+(null==(__t=font.css_name)?"":__t)+'" data-provider="'+(null==(__t=font.provider)?"":__t)+'">\n\t\t',"system"==font.provider||"custom"==font.provider&&!font.is_personal||(__p+="\n\n\t\t\x3c!--   /  --\x3e\n\t\t",("custom"!=font.provider||canEditCustomFonts)&&(__p+='\n\t\t<div class="action"></div>\n\t\t'),__p+="\n\n\t\t\t","custom"==font.provider&&font.is_personal&&canEditCustomFonts?__p+='\n\t\t\t\t<div class="edit-custom-font"></div>\n\t\t\t':__p+='\n\t\t\t\t<a class="tp-icon" target="_blank" title="'+(null==(__t=provider_data.title)?"":_.escape(__t))+'" '+(null==(__t=provider_data.url?'href="'+provider_data.url+'"':"")?"":__t)+"></a>\n\t\t\t",__p+="\n\t\t"),__p+='\n\t\t<div style="font-family:'+(null==(__t=font.css_name)?"":__t)+'" class="caption">'+(null==(__t=font.name)?"":__t)+"</div>\n\t</div>\n\n";return __p},"template-constructor-helpers-font-selector-upload":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="uf-section font-name">\n\t\t<input type="text" name="font-name-input" class="font-name-input" placeholder="Enter font name" value="'+(null==(__t=name)?"":_.escape(__t))+'"/>\n\t</div>\n\n\t<div class="uf-section weight-list invisible">\n\t\t<div class="uf-panel weights">\n\t\t\t<div class="scroll-wrapper">\n\t\t\t\t<div class="results-wrapper">\n\t\t\t\t\t<div class="results">\n\t\t\t\t\t\t<div class="list">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="button add-weight">Add weight</div>\n\t\t\t\t\t\t<a class="uf-link add-tracking-code" href="http://help.readymag.com/hc/en-us/articles/360018417451-Text" target="_blank"><span>Add tracking code</span></a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="gutter"></div>\n\t\t\t\t<div class="scroll"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="uf-panel selector invisible">\n\t\t\t<div class="available-list">\n\t\t\t\t<div class="available-weight">\n\t\t\t\t\t<div class="bullet"></div>\n\t\t\t\t\t<div class="weight-item name" data-var="n1">Thin</div>\n\t\t\t\t\t<div class="weight-item italic" data-var="i1">Italic</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="available-weight">\n\t\t\t\t\t<div class="bullet"></div>\n\t\t\t\t\t<div class="weight-item name" data-var="n2">ExtraLight</div>\n\t\t\t\t\t<div class="weight-item italic" data-var="i2">Italic</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="available-weight">\n\t\t\t\t\t<div class="bullet"></div>\n\t\t\t\t\t<div class="weight-item name" data-var="n3">Light</div>\n\t\t\t\t\t<div class="weight-item italic" data-var="i3">Italic</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="available-weight">\n\t\t\t\t\t<div class="bullet"></div>\n\t\t\t\t\t<div class="weight-item name" data-var="n4">Regular</div>\n\t\t\t\t\t<div class="weight-item italic" data-var="i4">Italic</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="available-weight">\n\t\t\t\t\t<div class="bullet"></div>\n\t\t\t\t\t<div class="weight-item name" data-var="n5">Medium</div>\n\t\t\t\t\t<div class="weight-item italic" data-var="i5">Italic</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="available-weight">\n\t\t\t\t\t<div class="bullet"></div>\n\t\t\t\t\t<div class="weight-item name" data-var="n6">SemiBold</div>\n\t\t\t\t\t<div class="weight-item italic" data-var="i6">Italic</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="available-weight">\n\t\t\t\t\t<div class="bullet"></div>\n\t\t\t\t\t<div class="weight-item name" data-var="n7">Bold</div>\n\t\t\t\t\t<div class="weight-item italic" data-var="i7">Italic</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="available-weight">\n\t\t\t\t\t<div class="bullet"></div>\n\t\t\t\t\t<div class="weight-item name" data-var="n8">ExtraBold</div>\n\t\t\t\t\t<div class="weight-item italic" data-var="i8">Italic</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="available-weight">\n\t\t\t\t\t<div class="bullet"></div>\n\t\t\t\t\t<div class="weight-item name" data-var="n9">Black</div>\n\t\t\t\t\t<div class="weight-item italic" data-var="i9">Italic</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="uf-panel uploader invisible">\n\t\t\t<div class="button select">Regular</div>\n\t\t\t<div class="button upload">\n\t\t\t\t<span>Upload .woff</span>\n\t\t\t\t<input class="font-file-upload" id="font-file-upload" type="file" accept=".woff" data-url="/api/upload/font"/>\n\t\t\t</div>\n\t\t\t<div class="disclaimer">By uploading webfonts you<br/>agree that you own or have<br/>the necessary license.</div>\n\t\t</div>\n\t</div>\n\n\t<div class="uf-section actions">\n\t\t<div class="done disabled"><span class="caption">Done</span></div>\n\t</div>\n\t<div class="dragover-overlay"></div>\n';return __p},"template-constructor-helpers-font-selector-upload-weights":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n\t",_.each(weights,(function(t){__p+='\n\t\t<div class="weight" data-type="'+(null==(__t=t.type)?"":__t)+'">\n\t\t\t<div class="name">'+(null==(__t=names[t.type])?"":__t)+'</div>\n\t\t\t<div class="reupload-weight">\n\t\t\t\t<input class="font-file-re-upload" id="font-file-re-upload" type="file" accept=".woff" data-url="/api/upload/font"/>\n\t\t\t</div>\n\t\t\t<div class="delete-weight"></div>\n\t\t</div>\n\t'})),__p+="\n";return __p}}},oR3H:function(t,e,i){"use strict";var s=i("LEh1");i.n(s).a},oRHT:function(module,exports){module.exports={"template-constructor-control-text_edit":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Edit" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t</div>\n';return __p}}},onY4:function(t,e,i){"use strict";var s=i("q1z7"),o=i.n(s),n=i("rFsW"),a=i("OTSC"),r=i("v92f"),l=i("Kf/z"),c=n.a.extend({},o.a.Events,{initialize:function(t){return this.undoStacks={},this.redoStacks={},this.pendingTransactions={},this.syncManager=t,this},add:function(t,e){if(e=e||{},n.a.defaults(e,{redo:!1,undo:!1}),!e.page){var i=n.a.groupBy(t,(function(t){return t.model.getPageId()}));if(n.a.keys(i)>1)return void n.a.each(i,(function(t,i){this.add(t,e)}))}if(!e.replace){var s=e.page||t[0].model.getPageId();if(!s)return console.error("cannot save history without pageId",t);this.redoStacks[s]=this.redoStacks[s]||[],this.undoStacks[s]=this.undoStacks[s]||[];var o={widgetsOrder:RM.constructorRouter.indexController.snapshot(s),actions:t};e.undo?this.redoStacks[s].push(o):(this.undoStacks[s].push(o),e.redo||(this.redoStacks[s]=[])),this.triggerChange(s)}},transactionStart:function(t,e){e=e||{},t=n.a.isArray(t)?t:[t];var i=a.b.generateUUID();return this.pendingTransactions[i]={entry:t&&t.length?this.syncManager.getHistoryDict(this.syncManager.getChangeset(t)):[],options:e},i},addToTransaction:function(t,e){e=n.a.isArray(e)?e:[e];var i=this.pendingTransactions[t]||{};if(e&&e.length){var s=this.syncManager.getHistoryDict(this.syncManager.getChangeset(e));this.pendingTransactions[t].entry=[].concat(i.entry||[],s)}},transactionEnd:function(t){var e=this.pendingTransactions[t];e&&(this.syncManager.addHistoryStep(e.entry,e.options),delete this.pendingTransactions[t])},undo:function(t){if(!t)return console.error("cannot undo without pageId parameter");if(n.a.isEmpty(this.undoStacks[t]))return this.triggerChange(t);var e=this.undoStacks[t].pop(),i=e.actions,s={undo:!0,page:t,applySnapshot:function(){Object(l.a)("constructor.zIndex")&&RM.constructorRouter.indexController.applySnapshot(e.widgetsOrder,t)}};this.fillUndoKeys(i),this.syncManager.saveGroup(n.a.pluck(i,"attrs"),s),this.triggerUndo(t)},redo:function(t){if(!t)return console.error("cannot redo without pageId parameter");if(n.a.isEmpty(this.redoStacks[t]))return this.triggerChange(t);var e=this.redoStacks[t].pop(),i=e.actions,s={redo:!0,page:t,applySnapshot:function(){Object(l.a)("constructor.zIndex")&&RM.constructorRouter.indexController.applySnapshot(e.widgetsOrder,t)}};this.fillUndoKeys(i),this.syncManager.saveGroup(n.a.pluck(i,"attrs"),s),this.triggerRedo(t)},fillUndoKeys:function(t){n.a.each(t,(function(t){var e=t.model.toJSON();if(n.a.each(t.model.nonUndoKeys,(function(i){if(t.attrs[i]=e[i],"Widget"==t.model.name){var s=r.b.widgetViewportFields(t.model.get("type"));n.a.each(r.b.viewport_list,(function(o){e[o]&&-1!=s.indexOf(i)&&(t.attrs[o]=t.attrs[o]||{},t.attrs[o][i]=e[o][i])}))}})),!n.a.isEmpty(t.model.undoKeys)){e=t.model.toJSON();e=n.a.extend(e,t.attrs),t.attrs=e}}))},clearHistory:function(t){this.redoStacks[t]=[],this.undoStacks[t]=[],this.triggerChange(t)},triggerChange:function(t){this.trigger("change",this.getLength(t))},triggerUndo:function(t){this.trigger("undo",t)},triggerRedo:function(t){this.trigger("redo",t)},getLength:function(t){return{undo:(this.undoStacks[t]||[]).length,redo:(this.redoStacks[t]||[]).length,page:t}},setCustomHandlers:function(t){if(!this.saved){var e=RM.constructorRouter.workspace.page.id;return this.saved={undo:this.undo,redo:this.redo,getLength:this.getLength},this.undo=t.undo,this.redo=t.redo,this.getLength=t.getLength,this.triggerChange(e),{triggerChange:n.a.bind(this.triggerChange,this),triggerUndo:n.a.bind(this.triggerUndo,this),triggerRedo:n.a.bind(this.triggerRedo,this)}}},removeCustomHandlers:function(){if(this.saved){n.a.extend(this,this.saved),this.saved=void 0;var t=RM.constructorRouter.workspace.page.id;this.triggerChange(t)}},setEmptyHandlers:function(){this.setCustomHandlers({undo:function(){},redo:function(){},getLength:function(t){return{undo:0,redo:0,page:t}}})}});RM.HistoryModel=c,e.a=c},phNm:function(t,e,i){"use strict";i.d(e,"c",(function(){return f})),i.d(e,"a",(function(){return v}));var s=i("q1z7"),o=i.n(s),n=i("rFsW"),a=i("xi34"),r=i("Fi5S"),l=(i("Kf/z"),i("OTSC"));function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function h(t,e){return!e||"object"!==c(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function d(t){var e="function"==typeof Map?new Map:void 0;return(d=function(t){if(null===t||(i=t,-1===Function.toString.call(i).indexOf("[native code]")))return t;var i;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,s)}function s(){return p(t,arguments,g(this).constructor)}return s.prototype=Object.create(t.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),u(s,t)})(t)}function p(t,e,i){return(p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,i){var s=[null];s.push.apply(s,e);var o=new(Function.bind.apply(t,s));return i&&u(o,i.prototype),o}).apply(null,arguments)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var m=function(){return{skus:{},uniqSkusCount:0,shippableProducts:0,changed:(new Date).toISOString(),order:null}},f={outOfStock:"outOfStock"},v=function(t){function e(t,i){var s;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(s=h(this,g(e).call(this,t))).type=i,s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(e,t),e}(d(Error)),b=function(t,e,i,s){return RM.screenshot&&(this.page=s),this.isMagLoaded=!1,this.haveEcommerceCartWidget=!1,this.isCartSidebarHidden=!0,this.productsLoading=!1,this.productsLoaded=!1,this.productsLoadingError=!1,this.cancelingOrder=!1,this.products=null,this.storageKey="_rmcartdata",this.environment=i,this.mag=e,this.router=t,this.events=n.a.extend({},o.a.Events),this.cartData=m(),this.cartItemsLimit=25,this.isConstructor()?this.mag.has("_id")?this.onMagFullLoaded():r.a.once("mag:loadfull:complete",this.onMagFullLoaded,this):(this.mag.model.has("_id")&&this.onMagFullLoaded(),this.restoreBackupCartData()),this};n.a.extend(b.prototype,{CONNECTION_TIMEOUT:5e3,stripeJsSrc:"https://js.stripe.com/v3/",isConstructor:function(){return this.environment===l.a.environment.constructor},isViewer:function(){return this.environment===l.a.environment.viewer},isPreview:function(){return this.environment===l.a.environment.preview},getStorageKey:function(){return"".concat(this.storageKey,"_").concat(this.mag.num_id)},onMagFullLoaded:function(){this.isMagLoaded||(this.isMagLoaded=!0,this.checkEcommerceCart(),this.isMagConnectedToStripe()&&!this.productsLoading&&(this.addStripeLibrary(),this.getProducts()))},checkEcommerceCart:function(){if(this.isConstructor()&&this.mag.globalWidgets){this.mag.globalWidgets.find((function(t){return t.get("type")===l.a.ecommerceCartBlockName}))&&(this.haveEcommerceCartWidget=!0)}else{if(RM.screenshot)return this.page.widgetsData.find((function(t){return t.type===l.a.ecommerceCartBlockName}))&&(this.haveEcommerceCartWidget=!0),this.haveEcommerceCartWidget;var t=this.mag.staticGlobalWidgetsData.find((function(t){return t.type===l.a.ecommerceCartBlockName}));if(t)return this.haveEcommerceCartWidget=!0,this.haveEcommerceCartWidget;(t=this.mag.aboveGlobalWidgetsData.find((function(t){return t.type===l.a.ecommerceCartBlockName})))&&(this.haveEcommerceCartWidget=!0)}return this.haveEcommerceCartWidget},getEcommerceData:function(){var t=null;return this.isConstructor()?this.mag.has("ecommerce_data")&&(t=this.mag.get("ecommerce_data")):this.mag.model.has("ecommerce_data")&&(t=this.mag.model.get("ecommerce_data")),t},getStripeConnectedUserId:function(){if(!this.isMagLoaded)return null;var t=this.getEcommerceData();return t&&t.stripe&&t.stripe.stripe_data&&t.stripe.stripe_data.stripe_user_id?t.stripe.stripe_data.stripe_user_id:null},getProducts:function(){this.productsLoading=!0;var t=this.isConstructor()?this.mag.get("num_id"):this.mag.model.get("num_id"),e=this.isViewer()?"published_projects":"projects";a.a.ajax({type:"GET",url:"/api/"+e+"/"+t+"/ecommerce/stripe/products/",success:function(t){t&&t.data&&(this.products=t.data),this.productsLoading=!1,this.productsLoaded=!0,this.events.trigger("ecommerce:loadproducts:complete")},error:function(t){t.status,this.productsLoading=!1,this.productsLoadingError=!0,this.events.trigger("ecommerce:loadproducts:complete")},context:this})},addStripeLibrary:function(){if(!(this.isConstructor()||window.Stripe&&window.Stripe.version)){var t=document.createElement("script"),e=document.getElementsByTagName("body")[0];t.setAttribute("async","async"),t.setAttribute("src",this.stripeJsSrc),e.appendChild(t)}},isMagConnectedToStripe:function(){if(!this.isMagLoaded)return!1;var t=this.getEcommerceData();return!!t&&!!(t.stripe&&t.stripe.status&&"connected"===t.stripe.status&&t.stripe.stripe_data&&t.stripe.stripe_data.stripe_user_id)},connectToStripe:function(){return new Promise(function(t,e){window.open("/api/connect/ecommerce/stripe/connect?num_id="+this.mag.get("num_id"),"_blank"),this.initSocket().then(function(e){this.mag.set({ecommerce_data:e},{silent:!0}),t()}.bind(this)).catch((function(t){e(t)}))}.bind(this))},disconnectFromStripe:function(){return new Promise(function(t,e){a.a.ajax({type:"GET",url:"/api/connect/ecommerce/stripe/disconnect?num_id="+this.mag.get("num_id"),success:function(e){e&&e.status&&(this.products=null,this.mag.set({ecommerce_data:{stripe:e}},{silent:!0})),t(e)},error:function(t){e(t)},context:this})}.bind(this))},initSocket:function(){return new Promise(function(t,e){var i=window.location.origin===l.a.readymag_auth_host&&l.a.stripe_live?"sockets.readymag.com/stripe-auth":"/stripe-auth",s=io(i,{timeout:this.CONNECTION_TIMEOUT});s.on("connect",function(){s.emit("wainting for mag stripe auth update",{num_id:this.mag.get("num_id"),user:this.router.me.pick("name","email","_id"),hash:this.mag.get("socket_hash")}),s.on("state-update",(function(i){s.disconnect(),i.error?e(i.error):t(i.ecommerce_data)}))}.bind(this))}.bind(this))},checkCartDisabledControls:function(){if(this.haveEcommerceCartWidget){var t=this.getEcommerceCartBlock(),e=this.getEcommerceData();t&&t.checkDisabledControls(e.stripe&&e.stripe.status&&"connected"===e.stripe.status)}},getEcommerceCartBlock:function(){return this.haveEcommerceCartWidget&&this.isConstructor()?this.router.workspace.findBlockByFunction((function(t){return t.attributes.type===l.a.ecommerceCartBlockName})):null},getCartWidgetData:function(){if(!this.isConstructor()){var t=this.mag.staticGlobalWidgetsData.find((function(t){return t.type===l.a.ecommerceCartBlockName}));return t||this.mag.aboveGlobalWidgetsData.find((function(t){return t.type===l.a.ecommerceCartBlockName}))}return null},getProductsLikeOptionsList:function(t){var e=[];return this.products&&Array.isArray(this.products)&&(e=this.products.filter((function(e){return e.active&&e.articles.length||t&&t===e.id})).map((function(t){return{value:t.id,caption:t.name}}))),e.unshift({value:"default",caption:"None"}),e},isProductActive:function(t){if(!t)return!1;if("default"===t)return!0;var e=this.getProductById(t);return!!e&&(e.active&&this.productHasActiveArticle(e))},productHasActiveArticle:function(t){return t&&t.articles.length},isSkuAvailable:function(t){return!!t.active&&("infinite"===t.inventory.type||("finite"===t.inventory.type&&t.inventory.quantity>0||"bucket"===t.inventory.type&&("in_stock"===t.inventory.value||"limited"===t.inventory.value)))},getProductById:function(t){return this.products&&Array.isArray(this.products)?this.products.find((function(e){return e.id===t})):null},getProductsStatus:function(){return this.productsLoading?"loading":this.productsLoaded?"loaded":"failed"},getSkusByProductId:function(t){var e=this.getProductById(t);return e?e.articles:null},getFirstAvailableSku:function(t){return t?t.find(function(t){return this.isSkuAvailable(t)}.bind(this)):null},getFirstAvailableSkuForProductId:function(t){return this.getFirstAvailableSku(this.getSkusByProductId(t))},changeCartSidebarVisibility:function(){return this.isCartSidebarHidden=!this.isCartSidebarHidden,this.events.trigger("ecommerce:cartsidebar:visibility:changed",this.isCartSidebarHidden),this.isCartSidebarHidden},checkItemQuantity:function(t){if("string"!=typeof t){var e=t;return!!("infinite"===e.inventory.type||"finite"===e.inventory.type&&e.inventory.quantity||"bucket"===e.inventory.type&&"out_of_stock"!==e.inventory.value)}if(this.cartData.skus[t]){var i=this.cartData.skus[t];return"infinite"===i.inventory.type||"finite"===i.inventory.type&&i.cart_count<i.inventory.quantity||"bucket"===i.inventory.type&&"out_of_stock"!==i.inventory.value}return!1},checkItemQuantityOnUpdate:function(t){if(this.cartData.skus[t]){var e=this.cartData.skus[t];return"infinite"===e.inventory.type||"finite"===e.inventory.type&&e.cart_count<=e.inventory.quantity||"bucket"===e.inventory.type&&"out_of_stock"!==e.inventory.value}return!1},getCartData:function(){return this.cartData},markCartChange:function(){this.cartData.changed=(new Date).toISOString()},addToCart:function(t){if(!t||!t.id)return new v("Sku data isn't valid or doesnt have an id");if(this.cartData.skus[t.id]){if(!this.checkItemQuantity(t.id))return new v("You cant add this product with attribute "+t.id+". It's out of stock",f.outOfStock);this.cartData.skus[t.id]=Object.assign({},t,{cart_count:this.cartData.skus[t.id].cart_count+1})}else{if(this.cartData.uniqSkusCount+1>this.cartItemsLimit)return new v("You cant add more than "+this.cartItemsLimit+" items to the cart");if(!this.checkItemQuantity(t))return new v("You cant add this product with attribute "+t.id+". It's out of stock",f.outOfStock);this.cartData.skus[t.id]=Object.assign({},t,{cart_count:1}),this.cartData.uniqSkusCount+=1,t.productObject.shippable&&(this.cartData.shippableProducts+=1)}return this.markCartChange(),this.backupCartData(),this.events.trigger("ecommerce:cartdata:changed",this.cartData),this.cartData},increaseCartItem:function(t){if(this.cartData.skus[t]){if(!this.checkItemQuantity(t))return new v("You cant add more this product with attribute "+t+". It's out of stock",f.outOfStock);this.cartData.skus[t].cart_count+=1,this.markCartChange(),this.backupCartData(),this.events.trigger("ecommerce:cartdata:changed",this.cartData)}},decreaseCartItem:function(t){this.cartData.skus[t]&&this.cartData.skus[t].cart_count>1&&(this.cartData.skus[t].cart_count-=1,this.markCartChange(),this.backupCartData(),this.events.trigger("ecommerce:cartdata:changed",this.cartData))},removeFromCart:function(t){if(this.cartData.skus[t])return this.cartData.skus[t].productObject.shippable&&(this.cartData.shippableProducts-=1),delete this.cartData.skus[t],this.cartData.uniqSkusCount-=1,this.markCartChange(),this.backupCartData(),this.events.trigger("ecommerce:cartdata:changed",this.cartData),this.cartData},clearCart:function(){return this.cartData=m(),this.backupCartData(),this.events.trigger("ecommerce:cartdata:changed",this.cartData),this.cartData},updateCartSkus:function(t){var e=this,i=[];if(t.forEach((function(t){e.cartData.skus[t.id]&&(e.cartData.skus[t.id]=Object.assign({},e.cartData.skus[t.id],t),e.checkItemQuantityOnUpdate(t.id)||i.push(e.cartData.skus[t.id].productObject.name))})),this.backupCartData(),i.length)return i},updateCartData:function(){return new Promise(function(t,e){this.cartData&&this.cartData.skus||e(new v("Empty cart"));var i=[];for(var s in this.cartData.skus)this.cartData.skus.hasOwnProperty(s)&&i.push(s);var o=i.length?n.a.uniq(i).join(","):null;a.a.ajax({type:"GET",url:"/api/projects/"+this.mag.num_id+"/ecommerce/stripe/skus/"+(o?"?skus_ids="+o:""),contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){if(i&&i.data){var s=this.updateCartSkus(i.data);if(s){var o=s.length>1;e(new v("This item".concat(o?"s":""," cannot be used to create an order: ").concat(s.join(", ")," ").concat(o?"are":"is"," out of stock"),f.outOfStock))}t(this.cartData)}}.bind(this),error:function(){e(new v("Error occurred while updating the skus:",i))}})}.bind(this))},hasShippableProducts:function(){return!!this.cartData.shippableProducts},setShippingForm:function(t){this.cartData.shippingForm=n.a.cloneWithObjects(t),this.markCartChange(),this.backupCartData()},getShippingForm:function(){return n.a.cloneWithObjects(this.cartData.shippingForm)},getShippingOptions:function(){return this.cartData.order&&this.cartData.order.shipping_methods?this.cartData.order.shipping_methods.map((function(t){return{id:t.id,label:t.description,amount:t.amount}})):null},setOrder:function(t){this.cartData.order=t,this.backupCartData()},getOrder:function(){return this.cartData.order},deleteOrder:function(){this.cartData.order=null,this.backupCartData()},cancelOrder:function(){return this.changeOrder({status:"canceled"})},changeShippingMethod:function(t){return this.changeOrder({selected_shipping_method:t})},changeOrder:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(e,i){this.cartData.order||i(new v("No order")),this.cancelingOrder&&i(),this.cancelingOrder=!0,a.a.ajax({type:"PATCH",url:"/api/projects/"+this.mag.num_id+"/ecommerce/stripe/orders/"+this.cartData.order.id+"/",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){this.cancelingOrder=!1,e(t)}.bind(this),error:function(t){this.cancelingOrder=!1,i(new v(t.responseText))}})}.bind(this))},validateCartData:function(t){return!(!t||"object"!==c(t)||isNaN(Date.parse(t.changed))||isNaN(Date.parse(t.backuped))||"number"!=typeof t.uniqSkusCount||"object"!==c(t.skus)||"object"!==c(t.order))},restoreBackupCartData:function(){if(Modernizr.localstorage){var t=localStorage.getItem(this.getStorageKey());if(t){var e=JSON.parse(t),i=((Date.now()-Date.parse(e.backuped))/1e3/60/60).toFixed(2);this.validateCartData(e)&&i<=24?this.cartData=e:this.clearBackup()}}},backupCartData:function(){Modernizr.localstorage&&(this.cartData.backuped=(new Date).toISOString(),localStorage.setItem(this.getStorageKey(),JSON.stringify(this.cartData)))},clearBackup:function(){Modernizr.localstorage&&localStorage.removeItem(this.getStorageKey())}}),e.b=b},q5gH:function(t,e,i){"use strict";var s,o=i("xi34"),n=i("q1z7"),a=i.n(n),r=i("rFsW"),l=i("m41J"),c=i("OTSC"),h=i("q7tt"),d=a.a.View.extend({minwidth:15,minheight:15,maxwidth:1/0,maxheight:1/0,FLIP_H:{ne:"nw",n:"n",nw:"ne",w:"e",sw:"se",s:"s",se:"sw",e:"w"},FLIP_V:{sw:"nw",s:"n",se:"ne",e:"e",ne:"se",n:"s",nw:"sw",w:"w"},DOTS:["nw","n","ne","e","se","s","sw","w"],DOTS_POS_X:[0,.5,1,1,1,.5,0,0],DOTS_POS_Y:[0,0,0,.5,1,1,1,.5],FIXED_DOTS:{nw:"se",n:"sw",ne:"sw",e:"nw",se:"nw",s:"nw",sw:"ne",w:"ne"},initialize:function(t){r.a.bindAll(this),s=i("dptL").WidgetPack,this.block=t.block,this.setElement(this.block.$el),this.$dots=this.$(".dot"),this.$triangles=this.$(".triangle"),this.$dots.drag("start",this.onDotDragStart).drag(this.onDotDrag).drag("end",this.onDotDragEnd),this.$triangles.on("mouseenter",this.onTriangleMouseEnter).drag("start",this.onTriangleDragStart).drag(this.onTriangleDrag).on("mouseleave",this.onTriangleMouseLeave).drag("end",this.onTriangleDragEnd),this.recalcDotsSizes({pageX:0,pageY:0}),this.mouseProceeding=!0,this.listenTo(this.block,"textWidgetMouseSelectionStart",this.disableMouseProceeding),this.listenTo(this.block,"textWidgetMouseSelectionEnd",this.enableMouseProceeding),this.listenTo(this.block,"textWidgetMarginDragStart",this.disableMouseProceeding),this.listenTo(this.block,"textWidgetMarginDragEnd",this.enableMouseProceeding),this.onSizeInputChangeStart.__debounced=r.a.debounce(this.onSizeInputChangeStart,200,!0),this.onSizeInputChangeEnd.__debounced=r.a.debounce(this.onSizeInputChangeEnd,200)},disableMouseProceeding:function(){this.$dots.animate({width:0,height:0,margin:0},"fast"),this.mouseProceeding=!1},enableMouseProceeding:function(){this.mouseProceeding=!0},show:function(t){this.$el.addClass("frame"),t&&this.$el.addClass("frameWB"),this.bindMouseMove(),this.mouseProceeding=!0,this.frameVisible=!0,this.recalcPointsDirections(),this.showSizes(),this.isRedBorderNeeded()&&this.checkHeightOfTextWidget()},hide:function(){this.$el.removeClass("frame"),this.$el.removeClass("frameWB"),this.unbindMouseMove(),this.frameVisible=!1,this.hideSizes()},isFrameVisible:function(){return this.frameVisible},bindMouseMove:function(){Object(o.a)(document).on("mousemove",this.recalcDotsSizes)},unbindMouseMove:function(){Object(o.a)(document).off("mousemove",this.recalcDotsSizes)},showSizes:function(){this.areSizesShown||!this.canChangeDimension("width")&&!this.canChangeDimension("height")||this.block.has_parent_block||(this.$el.children(".frameborder").after('<div id="sizes_input">'),this.sizes=new RM.vue.Sizes({el:"#sizes_input",propsData:{block:this.block,frame:this,zoom:RM.constructorRouter.zoom.getZoom()}}),this.sizes.$on("beforeChange",this.onSizeInputChangeStart.__debounced),this.sizes.$on("afterChange",this.onSizeInputChangeEnd.__debounced),this.sizes.$on("change",this.onSizeInputChange),this.areSizesShown=!0)},hideSizes:function(){this.sizes&&this.areSizesShown&&(this.sizes.$destroy(),this.sizes.$el.remove(),this.areSizesShown=!1)},onSizeInputChangeStart:function(){this.onResizeStart.apply(this,arguments)},onSizeInputChangeEnd:function(){this.block.saveBox(),this.onResizeEnd.apply(this,arguments)},onSizeInputChange:function(t,e){this.block.recalcFixedLine(),this.block.recalcStickedLine(),this.doResize(t,!1,e)},setResizeBottomPlus:function(t){this.$el.toggleClass("resize-bottom-plus",t),1!==this.block.model.get("column_count")||this.block.$el.hasClass("text-autosize")||this.checkHeightOfTextWidget()},setEditorState:function(){this.block.workspace.disableDragging=!0,this.$el.addClass("editor-state"),this.resetRotation()},removeEditorState:function(){this.$el.removeClass("editor-state"),this.block.workspace.disableDragging=!1,this.restoreRotation(),this.block.css()},setRotationState:function(){this.rotationState||(this.rotationState=!0,this.$el.addClass("rotation-state"),this.block.workspace.redrawBottomShiftLine({tp:"rotation"}))},removeRotationState:function(){this.rotationState&&(this.rotationState=!1,this.$el.removeClass("rotation-state"),this.block.workspace.redrawBottomShiftLine({tp:"rotation"}))},resetRotation:function(){var t=r.a.pick(this.block.latestPosSizeAngle,"angle","flip_h","flip_v");(t.angle||t.flip_h||t.flip_v)&&(this.block.$el.flashClass("transitions",500),this.block.forbidVisualRotation=!0,this.block.css(),this.recalcPointsDirections())},restoreRotation:function(){this.block.forbidVisualRotation&&(this.block.$el.flashClass("transitions",500),this.block.forbidVisualRotation=!1,this.block.css(),this.recalcPointsDirections())},recalcDotsSizes:function(t){if(this.mouseProceeding){var e=this.block.getBoxData({includeRotationData:!0,checkFixedPosition:!0}),i=t.pageX/RM.constructorRouter.zoom.getZoom(),s=t.pageY/RM.constructorRouter.zoom.getZoom(),o=99999,n=0,a=0,r=0,l=this.$el.parent().offset(),c=e.x+l.left,h=e.y+l.top,d=e.w,p=e.h,u=this.$el.hasClass("editor-state"),g=[-13,0,14,14,14,0,-13,-13],m=[-13,-13,-13,0,14,14,14,0],f=["left","left","right","right","right","left","left","left"],v=["top","top","top","top","bottom","bottom","bottom","top"],b=this.block.latestPosSizeAngle.sinAngle,_=this.block.latestPosSizeAngle.cosAngle,w=this,y={},k=0,C=0,x=0,S=0,P=-1,$=99999999,O=0,T=-1;if(this.block.model.get("fixed_position")){var M=this.$el.offset();c=M.left,h=M.top}if(d<this.block.SUPER_SMALL_TRESHOLD&&p<this.block.SUPER_SMALL_TRESHOLD?(a=13,k=[-1,-1,1,1,1,0,-1,-1][n=this.lastResizePointIndex||4],C=[-1,-1,-1,-1,1,1,1,-1][n]):this.$dots.each((function(){var t=c+d*w.DOTS_POS_X[r]+(u?g[r]:0),a=h+p*w.DOTS_POS_Y[r]+(u?m[r]:0);if((e.angle||e.flip_v||e.flip_h)&&!w.block.forbidVisualRotation){var l=c+d/2,f=h+p/2,v=t-l,y=f-a,k=e.flip_h?-v:v,C=e.flip_v?-y:y;t=l+_*k+b*C,a=f+b*k-_*C}var M=Math.sqrt(Math.pow(t-i,2)+Math.pow(a-s,2))-13;M<o&&(o=M,n=r),(a>S&&Math.abs(a-S)>.5||Math.abs(a-S)<.5&&r%2==1)&&(S=a,P=r,x=t),(a<$&&Math.abs(a-$)>.5||Math.abs(a-$)<.5&&r%2==1)&&($=a,T=r,O=t),r++})),P===n||T===n){$-=20,S+=20;var j=T===n?O:x,I=T===n?$:S,E=Math.sqrt(Math.pow(j-i,2)+Math.pow(I-s,2))-13;E<o&&(o=E)}a=(a=(70-o)/70*12+1)<2?0:a>13?13:2*Math.floor(a/2)+1,this.denyRecalcDotSize||(this.$dots.attr("style",""),this.$triangles.attr("style","")),y.width=a,y.height=a,y["margin-"+f[n]]=-Math.floor(a/2)+k,y["margin-"+v[n]]=-Math.floor(a/2)+C;var A=["left","","right","right","right","","left","left"],R=["top","top","top","","bottom","bottom","bottom",""],D=Math.min(1,Math.max(70-o,0)/70),z=(Math.floor(19*D/2),Math.floor(17*D/2),{transform:"scale("+D+") rotateZ("+-this.block.latestPosSizeAngle.angle+"deg)"});this.block.frameColor&&(y["background-color"]=this.block.frameColor,z["border-top-color"]=this.block.frameColor,z["border-color"]=this.block.frameColor);var L=this.block.latestPosSizeAngle.angle>0?this.block.latestPosSizeAngle.angle:360+this.block.latestPosSizeAngle.angle;L>90&&L<180&&(L=180-L),L>270&&L<360&&(L=360-L);var B=Math.sin(L%180/180*Math.PI),F=Math.cos(L%180/180*Math.PI),H=this.$dots.eq(n),N=P===n?12:8;""===A[n]?z.left="calc(50% - 9px)":z[A[n]]=-9,""===R[n]?z.top="calc(50% - 8px)":z[R[n]]=-8,z["margin-"+f[n]]=-Math.floor((N+a)*B),z["margin-"+v[n]]=-Math.floor((N+a)*F),this.denyRecalcDotSize||(H.css(y),P!==n&&T!==n||this.block.model.get("fixed_position")||!this.block.workspace||"basic"===this.block.workspace.page.get("type")||!(P===n&&this.$el.hasClass("bundle-allow-bottom")||T===n&&this.$el.hasClass("bundle-allow-top"))||this.$triangles.eq(n).css(z).data("bundle-align",P===n?"bottom":"top"))}},recalcPointsDirections:function(){var t=this.block.getBoxData({includeRotationData:!0}),e=this.block.forbidVisualRotation?0:-t.angle,i=Math.floor((e+360+22.5)/45)%8;this.$dots.each(r.a.bind((function(e,s){var n=this.DOTS[e];t.flip_v&&!this.block.forbidVisualRotation&&(n=this.FLIP_V[n]),t.flip_h&&!this.block.forbidVisualRotation&&(n=this.FLIP_H[n]),n=this.DOTS[(r.a.indexOf(this.DOTS,n)-i+8)%8],Object(o.a)(s).attr("data-visual-direction",n)}),this))},onDotDragStart:function(){if(this.rotationState)return this.onRotateStart.apply(this,arguments);this.onResizeStart.apply(this,arguments)},onDotDrag:function(){if(this.rotationState)return this.onRotate.apply(this,arguments);this.onResize.apply(this,arguments)},onDotDragEnd:function(){if(this.rotationState)return this.onRotateEnd.apply(this,arguments);this.block.workspace.checkBundleDragAbility(),this.onResizeEnd.apply(this,arguments)},onTriangleMouseEnter:function(t){var e=Object(o.a)(t.currentTarget);this.block.workspace._inTriangleBundleDrag||this.denyRecalcDotSize||this.block.workspace.checkBundleDragMode(t,e.data("bundle-align"))},onTriangleMouseLeave:function(t){Object(o.a)(t.currentTarget);this.block.workspace._inTriangleBundleDrag||this.denyRecalcDotSize||this.block.workspace.checkBundleDragMode(t,!0)},onTriangleDragStart:function(t){if(this.rotationState)return this.onRotateStart.apply(this,arguments);var e=Object(o.a)(t.currentTarget);this.denyRecalcDotSize=!0,e.addClass("moved"),this.block.workspace._inTriangleBundleDrag=!0,this.block.workspace.checkBundleDragMode(t,e.data("bundle-align")),this.block.workspace.$el.addClass("bundle-drag-cursor"),this.block.onDragStart.apply(this.block,arguments)},onTriangleDrag:function(){if(this.rotationState)return this.onRotate.apply(this,arguments);this.block.onDragMove.apply(this.block,arguments)},onTriangleDragEnd:function(t){if(this.rotationState)return this.onRotateEnd.apply(this,arguments);this.block.workspace._inTriangleBundleDrag=!1;var e=Object(o.a)(t.currentTarget);e.removeClass("moved"),this.denyRecalcDotSize=!1,this.block.workspace.checkBundleDragMode(t,!0),this.block.workspace.$el.removeClass("bundle-drag-cursor"),this.block.onDragEnd.apply(this.block,arguments)},onResizeStart:function(t,e,i){i=i||{},this.block.storeFixedPosition(),Object(o.a)("html").addClass("blocks-is-resizing"),this.denyRecalcDotSize=!0,this.$el.find(".frameborder").css("outline","1px solid transparent"),Object(o.a)("html").removeClass("alt-key-pressed"),this._dragEvent=t,this.block.workspace.on("specialKeydown specialKeyup",this.onSpecialKey),!RM.constructorRouter.gg.snap||this.block.model.get("fixed_position")||i.isGroupResize||RM.constructorRouter.gg.handleMoveStart(this.block instanceof s?this.block.blocks:[this.block]),this.block.onResizeStart&&this.block.onResizeStart(t,e),this.currentResizePoint=["nw","n","ne","e","se","s","sw","w"][Object(o.a)(t.currentTarget).attr("data-ind")],this.block.workspace.widgetResizingOrRotating=!0,this.lastResizePointIndex=Object(o.a)(t.currentTarget).attr("data-ind"),e.scrollTop=this.block.workspace.$container.scrollTop()},customResizeHandler:function(t,e){return t},applyExtraConstraints:function(t,e){var i=this.block.getFullWidthDims(),s=this.block.getFullHeightDims();return this.block.model.get("is_full_width")&&r.a.extend(t,{left:i.x,width:i.w}),this.block.model.get("is_full_height")&&r.a.extend(t,{top:s.y,height:s.h}),t},applyConstraints:function(t,e){return e=r.a.extend({direction:"se",fromCenter:!1,isSidePointProportional:!1,currentResizePoint:this.currentResizePoint,isProportional:this.block.proportional,initialBox:this.block.getModelBox(),constraints:this.constraints,minwidth:this.minwidth,minheight:this.minheight,maxwidth:this.maxwidth,maxheight:this.maxheight,ratio:this.block.ratio,aspect:this.block.model.get("aspect")},e),d.applyConstraintsAbstract.apply(this,[t,e,this.applyExtraConstraints.bind(this)])},onRotateStart:function(t,e){this.block.storeFixedPosition();var i=this.block.getBoxData({includeRotationData:!0}),s=this.$el.parent().offset(),n=RM.constructorRouter.zoom.getZoom();this.rotationData={center:{x:i.x+s.left+i.w/2,y:i.y+s.top+i.h/2},x:t.pageX/n,y:t.pageY/n,initialAngle:i.angle,prevAngle:i.angle},Object(o.a)("body").addClass("grabbing-cursor"),this.block.workspace.widgetResizingOrRotating=!0},onRotate:function(t,e){var i,s,o,n,a,r,l,c=this.rotationData,h=RM.constructorRouter.zoom.getZoom();i={x:t.pageX/h-c.center.x,y:t.pageY/h-c.center.y},s={x:c.x-c.center.x,y:c.y-c.center.y},l=i.x*s.y-i.y*s.x<0?-1:1,o=(o=(i.x*s.x+i.y*s.y)/(Math.sqrt(i.x*i.x+i.y*i.y)*Math.sqrt(s.x*s.x+s.y*s.y)))>1?1:o,n=l*Math.acos(o)/Math.PI*180,a=c.prevAngle-n,r=t.shiftKey?15*Math.floor(a/15)+c.initialAngle%15:a,a=(a=a>=360?a-360:a)<=-360?a+360:a,r=(r=r>=360?r-360:r)<=-360?r+360:r,r=Math.floor(r),this.block.css({angle:r}),this.block.trigger("rotate",{angle:r}),this.block.model.set({angle:r}),c.x=t.pageX/h,c.y=t.pageY/h,c.prevAngle=a},onRotateEnd:function(t,e){Object(o.a)("body").removeClass("grabbing-cursor"),this.block.workspace.widgetResizingOrRotating=!1,this.block.restoreFixedPosition(),this.block.workspace.checkBundleDragAbility()},checkHeightOfTextWidget:function(t){var e=this.block.getAllowableHeight(),i=t?t.height:this.block.getModelBox().height;t&&r.a.contains(["sw","se","s"],this.currentResizePoint)&&this.stickBtmBorderOfText(e,t),this.$el.find(".frameborder").toggleClass("red-border",i<e)},stickBtmBorderOfText:function(t,e){var i,s=d.ceilObject({width:e.width,top:e.top,left:e.left});Math.abs(e.height-t)<8&&(s.height=t,i=this.customResizeHandler(o.a.extend(i,s),this.currentResizePoint),this.block.css(i,this.currentResizePoint))},onResize:function(t,e){e.deltaX=e.deltaX/RM.constructorRouter.zoom.getZoom(),this.block._saveXHR&&(this.block._saveXHR.abort&&this.block._saveXHR.abort(),delete this.block._saveXHR);var i=this.block.workspace,n=this.block instanceof s?this.block.blocks:[this.block];!i||this.block instanceof s||h.a.prototype.collectBottomBloks(i,n,t);var a=this.block.resizeFromCenter||t.altKey,p=t.shiftKey;if(this._dragEvent=t,!Object(o.a)("html").hasClass("blocks-is-moving")){var u=e.startY+e.scrollTop,g=t.pageY+this.block.workspace.$container.scrollTop();e.deltaY=(g-u)/RM.constructorRouter.zoom.getZoom(),c.b.autoWindowScroll(t,this.block.workspace.$container,r.a.bind((function(){this.onResize(t,e)}),this));var m=this.block.getModelBox(),f=r.a.clone(m),v=this.block.latestPosSizeAngle.sinAngle,b=this.block.latestPosSizeAngle.cosAngle,_=this.block.getBoxData({includeRotationData:!0}),w=e.deltaX,y=e.deltaY;if(_.angle&&!this.block.forbidVisualRotation){var k=b*e.deltaX+v*e.deltaY,C=-v*e.deltaX+b*e.deltaY;e.deltaY=C,e.deltaX=k}var x=this.DOTS[Object(o.a)(t.currentTarget).attr("data-ind")];_.flip_v&&!this.block.forbidVisualRotation&&(x=this.FLIP_V[x]),_.flip_h&&!this.block.forbidVisualRotation&&(x=this.FLIP_H[x]);var S=r.a.contains(["w","e","n","s"],x)&&Boolean(p||this.block.proportional);if(x=this.modifyOnShift(t,e,m,{direction:x,isSidePointProportional:S}),a){switch(x){case"nw":case"ne":case"n":m.top+=e.deltaY,m.height-=2*e.deltaY;break;case"sw":case"se":case"s":m.top-=e.deltaY,m.height+=2*e.deltaY}switch(x){case"nw":case"sw":case"w":m.left+=e.deltaX,m.width-=2*e.deltaX;break;case"se":case"ne":case"e":m.left-=e.deltaX,m.width+=2*e.deltaX}}else{switch(x){case"nw":case"ne":case"n":m.top+=e.deltaY,m.height-=e.deltaY;break;case"sw":case"se":case"s":m.height+=e.deltaY}switch(x){case"nw":case"sw":case"w":m.left+=e.deltaX,m.width-=e.deltaX;break;case"se":case"ne":case"e":m.width+=e.deltaX}if(S)switch(x){case"e":m.top-=e.deltaY/2,m.height+=e.deltaY;break;case"w":m.top+=e.deltaY/2,m.height-=e.deltaY;break;case"n":m.left+=e.deltaX/2,m.width-=e.deltaX;break;case"s":m.left-=e.deltaX/2,m.width+=e.deltaX}}RM.constructorRouter.gg.snap&&!t.ctrlKey&&((_.angle||_.flip_v||_.flip_h)&&!this.block.forbidVisualRotation||(m=RM.constructorRouter.gg.handleSnapResize(m,this.block.model,x)));var P=this.FIXED_DOTS[x],$=r.a.indexOf(this.DOTS,P);if(m=this.applyConstraints(m,{boxOrig:f,direction:x,fromCenter:a,isSidePointProportional:S,fixedDot:P,fixedDotInd:$,DOTS_POS_Y:this.DOTS_POS_Y[$],DOTS_POS_X:this.DOTS_POS_X[$],sinAngle:v,cosAngle:b}),_.angle&&!a&&!this.block.forbidVisualRotation){var O=d.getRotatedBoxDelta(f,m,_.angle,x);m.left+=O.left,m.top+=O.top}if(RM.constructorRouter.gg.snap&&!t.ctrlKey&&!e.disableSnap&&(_.angle||_.flip_v||_.flip_h)&&!this.block.forbidVisualRotation){var T=r.a.extend({sinAngle:this.block.latestPosSizeAngle.sinAngle,cosAngle:this.block.latestPosSizeAngle.cosAngle},m),M=l.a.calcBoundingBox(T);M.left=M.bb_left,M.top=M.bb_top,M.width=M.bb_width,M.height=M.bb_height;var j=Object(o.a)(t.currentTarget).attr("data-visual-direction"),I=r.a.indexOf(this.DOTS,j),E=M.left+M.width*this.DOTS_POS_X[I],A=M.top+M.height*this.DOTS_POS_Y[I],R=RM.constructorRouter.gg.handleSnapResize(M,this.block.model,j),D=R.left+R.width*this.DOTS_POS_X[I]-E,z=R.top+R.height*this.DOTS_POS_Y[I]-A;if(D||z)return e.deltaX=w+D,e.deltaY=y+z,e.disableSnap=!0,void this.onResize(t,e)}e.disableSnap=!1,this.block.recalcFixedLine(),this.block.recalcStickedLine();var L=this.doResize(m,!0,x,a);if(i&&!(this.block instanceof s)){var B=i.bottomBlocksToMove,F=l.a.calcBoundingBox(r.a.extend({sinAngle:this.block.latestPosSizeAngle.sinAngle,cosAngle:this.block.latestPosSizeAngle.cosAngle},f)),H=l.a.calcBoundingBox(r.a.extend({sinAngle:this.block.latestPosSizeAngle.sinAngle,cosAngle:this.block.latestPosSizeAngle.cosAngle},m)),N=H.bb_top-F.bb_top;B&&B.vPressed&&(N+=H.bb_height-F.bb_height),h.a.prototype.moveBottomBlocks(i,N,!1,{y:0})}return this.isRedBorderNeeded()&&this.checkHeightOfTextWidget(L),L}},doResize:function(t,e,i,s){var n=d.ceilObject({height:t.height,width:t.width,top:t.top,left:t.left});return t=this.customResizeHandler(o.a.extend(t,n),this.currentResizePoint,e),this.block.css(t,this.currentResizePoint),this.block.trigger("resize",t),t},isRedBorderNeeded:function(){return!(!this.block.$el.hasClass("block-text")||1!==this.block.model.get("column_count")||this.block.$el.hasClass("text-autosize"))},modifyOnShift:function(t,e,i,s){var o=t.shiftKey,n=s.direction;if(o&&!this.block.proportional||s.isSidePointProportional){var a=this.block.model.get("aspect")||i.width/i.height,l=1/a;if(r.a.contains(["w","e"],n))return e.deltaY=e.deltaX*l,n;if(r.a.contains(["n","s"],n))return e.deltaX=e.deltaY*a,n;if(r.a.contains(["nw","se"],n))var c=l;r.a.contains(["sw","ne"],n)&&(c=-l);var h=e.deltaY+e.deltaX/c;return e.deltaX=h/(c+1/c),e.deltaY=e.deltaX*c,n}return n},onResizeEnd:function(t,e,i){if(i=i||{},c.b.autoWindowScrollClear(),this.block.restoreFixedPosition(),this.block.recalcFixedLine(),this.block.recalcStickedLine(),this.block._justResized=!0,this.$el.find(".frameborder").css("outline",""),!this.block.dontSaveOnResize){var n=this.block instanceof s,a=this.block.workspace.bottomBlocksToMove,l=this.block.workspace.spacesController&&this.block.workspace.spacesController.getBlocksToSave()||[],h=r.a.extend({resizePoint:this.currentResizePoint},i),d=n?this.block.blocks:[this.block],p=r.a.map([].concat(d,a&&a.tosave||[],l),(function(t){return r.a.extend({_id:t.id},t.getSaveBoxData(h))}));a&&a.initPageHeight!=this.block.workspace.page.getCurrentViewportParam("height")&&a.tosave&&a.tosave.length&&this.block.workspace.page.save(),n?this.block.saveBox(r.a.extend({resizePoint:this.currentResizePoint},i),p):this.block.workspace.save_group(p),this.block.workspace.clearBottomBlocksToMove()}this.currentResizePoint=void 0,this.denyRecalcDotSize=!1,Object(o.a)("html").removeClass("blocks-is-resizing"),RM.constructorRouter.gg.snap&&RM.constructorRouter.gg.handleMoveEnd(),this.block.onResizeEnd&&this.block.onResizeEnd(t,e,i),this.block.workspace.off("specialKeydown specialKeyup",this.onSpecialKey),this.block.workspace.widgetResizingOrRotating=!1,this.block.workspace.checkBundleDragAbility()},onSpecialKey:function(t){t.keyCode==o.a.keycodes.shift&&this.block.proportional||("keydown"==t.type&&(this._dragEvent.altKey=t.altKey,this._dragEvent.shiftKey=t.shiftKey),"keyup"==t.type&&(t.keyCode==o.a.keycodes.shift&&(this._dragEvent.shiftKey=!1),t.keyCode==o.a.keycodes.alt&&(this._dragEvent.altKey=!1)),this.$dots.trigger(this._dragEvent))},canChangeDimension:function(t){switch(t){case"width":return!this.block.isFullWidth()&&(r.a.isUndefined(this.minwidth)||this.minwidth!==this.maxwidth);case"height":return!this.block.isFullHeight()&&(r.a.isUndefined(this.minheight)||this.minheight!==this.maxheight);default:return!0}},destroy:function(){this.hide(),this.retargetScroll&&this.retargetScroll.restore&&this.retargetScroll.restore(),this.stopListening(this.block,"textWidgetMouseSelectionStart",this.disableMouseProceeding),this.stopListening(this.block,"textWidgetMouseSelectionEnd",this.enableMouseProceeding),this.stopListening(this.block,"textWidgetMarginDragStart",this.disableMouseProceeding),this.stopListening(this.block,"textWidgetMarginDragEnd",this.enableMouseProceeding),this.block.workspace.off(null,null,this)}},{applyConstraintsAbstract:function(t,e,i){var s=(e=e||{}).direction,o=e.fromCenter;e.isProportional&&(e=r.a.extend({},e,l.a.getBoxLimits(e.initialBox,{minwidth:e.minwidth,maxwidth:e.maxwidth,minheight:e.minheight,maxheight:e.maxheight})));var n=e.isSidePointProportional&&("n"===s||"s"===s),a=e.isSidePointProportional&&("e"===s||"w"===s);if(t.width<e.minwidth){if(r.a.contains(["nw","sw","w"],s)||n){var c=t.width-e.minwidth;t.left+=o||n?c/2:c}r.a.contains(["se","ne","e"],s)&&o&&(t.left+=(t.width-e.minwidth)/2),t.width=e.minwidth}if(t.height<e.minheight&&((r.a.contains(["nw","ne","n"],s)||a)&&(c=t.height-e.minheight,t.top+=o||a?c/2:c),r.a.contains(["sw","se","s"],s)&&o&&(t.top+=(t.height-e.minheight)/2),t.height=e.minheight),e.maxwidth&&t.width>e.maxwidth&&((r.a.contains(["nw","sw","w"],s)||n)&&(c=e.maxwidth-t.width,t.left-=o||n?c/2:c),r.a.contains(["ne","se","e"],s)&&o&&(t.left-=(e.maxwidth-t.width)/2),t.width=e.maxwidth),e.maxheight&&t.height>e.maxheight&&((r.a.contains(["nw","ne","n"],s)||a)&&(c=e.maxheight-t.height,t.top-=o||a?c/2:c),r.a.contains(["sw","se","s"],s)&&o&&(t.top-=(e.maxheight-t.height)/2),t.height=e.maxheight),e.isProportional&&(t=d.makeProportional(t,e)),i&&r.a.isFunction(i)&&(t=i(t,e.currentResizePoint)),e.constraints&&(t.left<e.constraints.left&&(t.width+=t.left-e.constraints.left,t.left=e.constraints.left),t.top<e.constraints.top&&(t.height+=t.top-e.constraints.top,t.top=e.constraints.top),t.left+t.width>e.constraints.left+e.constraints.width&&(t.width=e.constraints.left+e.constraints.width-t.left),t.top+t.height>e.constraints.top+e.constraints.height&&(t.height=e.constraints.top+e.constraints.height-t.top)),e.packBox){var h=Math.min(e.packBox.width,t.width),p=Math.min(e.packBox.height,t.height);t={width:h,height:p,top:Math.min(e.packBox.top+e.packBox.height-p,Math.max(t.top,e.packBox.top)),left:Math.min(e.packBox.left+e.packBox.width-h,Math.max(t.left,e.packBox.left))}}return this.block.workspace.spacesController&&!e.isSizes&&(t=this.block.workspace.spacesController.recalcBoxOnResize(t,e,this.block.model)),t},makeProportional:function(t,e){var i,s,o=e.initialBox||{},n=e.direction,a=e.fromCenter;switch(n){case"n":case"s":i="height",s="width";break;case"e":case"w":i="width",s="height";break;default:t.width/o.width>t.height/o.height?(i="width",s="height"):(i="height",s="width")}e.baseDimension&&(i=e.baseDimension,s="width"===e.baseDimension?"height":"width");var l=o[s]/o[i];e.ratio&&(l="width"==s?e.ratio:1/e.ratio),e.aspect&&(l="width"==s?e.aspect:1/e.aspect);var c=Math.round(t[i]*l);if(r.a.contains(["nw","sw","w"],n)&&"width"==s){var h=c-t[s];t.left-=a?h/2:h}return r.a.contains(["ne","se","e"],n)&&"width"==s&&a&&(t.left-=(c-t[s])/2),r.a.contains(["nw","ne","n"],n)&&"height"==s&&(h=c-t[s],t.top-=a?h/2:h),r.a.contains(["sw","se","s"],n)&&"height"==s&&a&&(t.top-=(c-t[s])/2),r.a.contains(["n","s"],n)&&a&&(h=c-t[s],t.left-=h/2),r.a.contains(["w","e"],n)&&a&&(h=c-t[s],t.top-=h/2),t[s]=c,t},getRotatedBoxDelta:function(t,e,i,s){var o=d.prototype.DOTS_POS_X,n=d.prototype.DOTS_POS_Y,a=d.prototype.FIXED_DOTS,l=d.prototype.DOTS,c=Math.sin((i||0)*Math.PI/180),h=Math.cos((i||0)*Math.PI/180),p=r.a.indexOf(l,a[s]),u=t.left+t.width*o[p],g=t.top+t.height*n[p],m=t.left+t.width/2,f=t.top+t.height/2,v=u-m,b=f-g,_=m+h*v+c*b,w=f+c*v-h*b,y=e.left+e.width*o[p],k=e.top+e.height*n[p],C=e.left+e.width/2,x=e.top+e.height/2,S=y-C,P=x-k;return{left:_-(C+h*S+c*P),top:w-(x+c*S-h*P)}},ceilObject:function(t){for(var e in t)t.hasOwnProperty(e)&&(t[e]=Math.ceil(t[e]));return t}});e.a=d},q7tt:function(t,e,i){"use strict";var s=i("xi34"),o=i("Kw5r"),n=i("q1z7"),a=i.n(n),r=i("rFsW"),l=i("v92f"),c=i("UeZx"),h=i.n(c),d=i("MAfP"),p=i.n(d),u=i("q5gH"),g={components:{NumericInput:i("tRog").a},props:{block:Object,frame:Object,zoom:Number},data:function(){return{minwidth:this.frame.minwidth,maxwidth:this.frame.maxwidth,minheight:this.frame.minheight,maxheight:this.frame.maxheight}},computed:{w:function(){return parseInt(this.block.latestPosSizeAngle.width)},h:function(){return parseInt(this.block.latestPosSizeAngle.height)},x:function(){return parseInt(this.block.latestPosSizeAngle.left)},y:function(){return parseInt(this.block.latestPosSizeAngle.top)},angle:function(){return this.block.latestPosSizeAngle.angle},sin:function(){return this.block.latestPosSizeAngle.sinAngle},cos:function(){return this.block.latestPosSizeAngle.cosAngle},fixed_position:function(){return this.block.model.get("fixed_position")},is_visible:function(){return!this.block.forbidVisualRotation&&this.block.workspace.mag.edit_params.get("sizes")},is_width_disabled:function(){return!this.frame.canChangeDimension("width")},is_height_disabled:function(){return!this.frame.canChangeDimension("height")}},watch:{angle:"applyPosition",x:"applyPosition",y:"applyPosition",w:"applyPosition",h:"applyPosition",fixed_position:"applyPosition",is_visible:function(t){t&&r.a.delay(function(){this.$refs.widthInput.updateSize(),this.$refs.heightInput.updateSize()}.bind(this))}},mounted:function(){var t=this,e=function(e){return t.$children.find((function(t){return t.$el.classList.contains(e)}))};this.$w=e("width"),this.$h=e("height"),this.applyPosition()},methods:{resize:function(t,e){var i="width"===t,s=i?e:parseInt(this.$w.$el.value),o=i?parseInt(this.$h.$el.value):e,n=i?"e":"s";this.$emit("beforeChange",{},"se");var a=this.frame.applyConstraints({left:this.angle?this.block.latestPosSizeAngle.left:this.block.model.attributes.x,top:this.angle?this.block.latestPosSizeAngle.top:this.block.model.attributes.y,width:s,height:o},{direction:n,isSidePointProportional:!1,isSizes:!0});if(this.angle){var r=u.a.getRotatedBoxDelta({left:this.block.latestPosSizeAngle.left,top:this.block.latestPosSizeAngle.top,width:this.block.latestPosSizeAngle.width,height:this.block.latestPosSizeAngle.height},a,this.angle,n);a.left+=r.left,a.top+=r.top}a.width=Math.round(a.width),a.height=Math.round(a.height),this.minwidth=i&&s<a.width?a.width:this.frame.minwidth,this.maxwidth=i&&s>a.width?a.width:this.frame.maxwidth,this.minheight=!i&&o<a.height?a.height:this.frame.minheight,this.maxheight=!i&&o>a.height?a.height:this.frame.maxheight,(i&&a.width!==this.w||!i&&a.height!==this.h)&&this.$emit("change",a,"se"),this.$emit("afterChange",a,"se")},applyPosition:function(){var t,e,i=this.h+8,s=this.w+8,o=this.w/2,n=this.h/2;i-=n;var a=(s-=o)*this.cos-i*this.sin,r=s*this.sin+i*this.cos;s=a+o,i=r+n,this.$el.style.left=Math.round(s*this.zoom)+"px",this.$el.style.top=Math.round(i*this.zoom)+"px";var l=this.$el.getBoundingClientRect(),c=this.angle>=0?this.angle:360+this.angle;t=0,e=0,c>0&&c<=90?t=c/90*-l.width:c>90&&c<=180?(t=-l.width,e=(c-90)/90*-l.height):c>180&&c<=270?(t=(270-c)/90*-l.width,e=-l.height):c>270&&c<=360&&(e=(360-c)/90*-l.height),this.$el.style.transform="translateX("+t+"px) translateY("+e+"px)",l=this.$el.getBoundingClientRect();var h=this.block.workspace.$container.width()-this.block.workspace.$container[0].clientWidth,d=window.innerWidth-h,p=window.innerHeight;l.left<8?t=t-l.left+8:l.left+l.width+8>d&&(t+=d-l.left-l.width-8),l.top<8?e=e-l.top+8:l.top+l.height+8>p&&(e+=p-l.top-l.height-8),this.$el.style.transform="translateX("+t+"px) translateY("+e+"px)"}}},m=(i("5EAR"),i("KHd+")),f=Object(m.a)(g,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.is_visible,expression:"is_visible"}],staticClass:"size-tool skip-rotate",on:{click:function(t){return t.stopPropagation()},dblclick:function(t){return t.stopPropagation()}}},[i("numeric-input",{ref:"widthInput",staticClass:"width",attrs:{value:t.w,autosize:!0,disabled:t.is_width_disabled,"mouse-use":!t.is_width_disabled,"debounce-keyboard":500,min:t.minwidth,max:t.maxwidth},on:{change:function(e){return t.resize("width",e)}}}),t._v(" "),i("span",[t._v("")]),t._v(" "),i("numeric-input",{ref:"heightInput",staticClass:"height",attrs:{value:t.h,autosize:!0,disabled:t.is_height_disabled,"mouse-use":!t.is_height_disabled,"debounce-keyboard":500,min:t.minheight,max:t.maxheight},on:{change:function(e){return t.resize("height",e)}}})],1)}),[],!1,null,null,null).exports,v=i("OTSC"),b=i("m41J"),_=i("roQd"),w=i("jamO"),y=i("G3+Z"),k=i("Vxjr"),C=i("Kf/z"),x=i("Fi5S");function S(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function P(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function $(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?P(i,!0).forEach((function(e){O(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):P(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function O(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var T=a.a.View.extend({SUPER_SMALL_TRESHOLD:10,MAX_Z_INDEX:2e3,TOOLTIP_OFFSET:16,outofbox:!1,excludedFromLib:!1,immortal:!1,template:null,events:{},viewport_fields:l.b.viewport_fields_common,controls:["common_animation","common_position","common_layer","common_lock"],settingsOnCreate:!0,initialize:function(t,e){this.initBlock(t,e)},initBlock:function(t,e){r.a.bindAll(this),this.model=t,this.isLoading=!1,this.selected=!1,this.forbidVisualRotation=!1,this.triggerAssets={},t.get("hidden")&&this.triggerReady(),this.workspace=e,this.workspace.on("deselect",this.deselect),this.model.on("change",this.onModelChange),this.model.on("change:pack_id",this.onPackChange),this.model.on("change:is_locked",this.updateLockDragState),this.model.on("change:hidden",this.onBlockVisibilityChange),this.model.on("change:fixed_position",this.onFixPosition),Object(C.a)("constructor.zIndex")&&(x.a.on("index:changed",this.onIndexChange),this.workspace.page.on("change:viewport",this.onIndexChange)),this.listenTo(this.model,"animation:trigger:add",this.onAnimationTriggerAdd),this.listenTo(this.model,"animation:trigger:remove",this.onAnimationTriggerRemove),this.listenTo(this.model,"animation:type:change",this.resetAnimationTriggers),this.latestPosSizeAngle=this.getModelBox();var i=this.getStickedSide();"left"==i||"right"==i?this.latestPosSizeAngle.sticked_margin=this.calcStickedMargin(this.latestPosSizeAngle.left,this.latestPosSizeAngle.width):"top"!=i&&"bottom"!=i||(this.latestPosSizeAngle.sticked_margin=this.calcStickedMargin(this.latestPosSizeAngle.top,this.latestPosSizeAngle.height)),this.$document=Object(s.a)(document),r.a.extend(this.latestPosSizeAngle,b.a.calcBoundingBox(this.latestPosSizeAngle)),this.has_parent_block=!!this.model.get("parent_wid")},render:function(){this.create()},triggerReady:function(){this.model.triggerReady()},init_as_child_block:function(){this.$el.addClass("no-transitions").addClass("has-parent-block"),"picture"===this.model.get("type")&&this.model.on("change:picture",this.workspace.determine_column_widgets_height_fitting)},onModelChange:function(t,e){this.redraw(t,e),this.checkDisabledControls(t)},create:function(){this.setElement(Object(s.a)(this.template({block:this.model.attributes,templates:$({},p.a)}))),this.has_parent_block?this.$el.appendTo(this.workspace.$blocksWrapper):this.isStandalone?this.$el.appendTo(this.$standaloneContainer):this.$el.appendTo(this.workspace.$el.children().first()),this.toggleInPackClass(),this.$content=this.$(".content");var t=this.frameClass||u.a;this.frame=new t({block:this}),this.frameColor&&this.$(".frameborder").css({"border-color":this.frameColor}),this.bindEvents(),this.rendered=!0,this.checkRetargetScroll(),this.workspace.on("workspace-resize",this.onWorkspaceResize),this.model.get("is_full_width")&&this.$el.addClass("full-width"),this.model.get("is_full_height")&&this.$el.addClass("full-height"),this.has_parent_block&&this.init_as_child_block(),this.checkDisabledControls(this.model,!0),Object(C.a)("constructor.zIndex")&&this.onIndexChange(),Object(C.a)("constructor.hidingSwitcher")&&this.model.getAnimations().find((function(t){return t&&t.steps&&t.steps[0]&&t.steps[0].hideInEditor}))&&this.$el.addClass("hidden")},toggleInPackClass:function(t){var e=Boolean(t||this.model.get("pack_id"));this.$el.toggleClass("in-pack",e)},onIndexChange:function(){if("background"!==this.model.get("type")&&this.rendered){var t=RM.constructorRouter.indexController.getZIndex(this.id,this.workspace.page.id,this.workspace.page.getCurrentViewport());if(this.currentZ!==t){this.currentZ=t;var e=this.model.get("fixed_position")?t:"",i=e?"":t,s=e?"fixed":"";this.$el.css({"z-index":e,position:s}),this.$content.css({"z-index":i})}}},css:function(t,e){var i,s=(t=t||{}).clone?this.$cloneEl:this.$el;if(t["z-index"]){var o=this.model.get("fixed_position")?t["z-index"]:"",n=o?"":t["z-index"],a=o?"fixed":"";s.css({"z-index":o,position:a}),this.$content.css({"z-index":n})}var l=r.a.extend(r.a.clone(this.latestPosSizeAngle),t);i=!(l.angle||l.flip_v||l.flip_h)||this.forbidVisualRotation||this.isFullWidth()||this.isFullHeight()?"":(l.angle?" rotateZ("+l.angle+"deg)":"")+(l.flip_v?"scaleY(-1)":"")+(l.flip_h?"scaleX(-1)":""),v.b.applyTransform(s.children("div:not(.skip-rotate)"),i),t.clone||(r.a.extend(this.latestPosSizeAngle,r.a.pick(t,"width","height","left","top","angle","flip_v","flip_h","z-index")),null!=t.angle&&(this.latestPosSizeAngle.sinAngle=Math.sin(t.angle*Math.PI/180),this.latestPosSizeAngle.cosAngle=Math.cos(t.angle*Math.PI/180)),null==t.angle&&null==t.flip_v&&null==t.flip_h||this.frame&&this.frame.recalcPointsDirections(),r.a.extend(this.latestPosSizeAngle,b.a.calcBoundingBox(this.latestPosSizeAngle)));var c={};if(c=this.latestPosSizeAngle.angle&&this.latestPosSizeAngle.angle%90==0&&Math.round(this.latestPosSizeAngle.height)%2!=Math.round(this.latestPosSizeAngle.width)%2?r.a.extend(r.a.pick(t,"width","height","left","top","margin-top","margin-left"),{height:Math.round(this.latestPosSizeAngle.height),width:Math.round(this.latestPosSizeAngle.width)+1}):r.a.pick(t,"width","height","left","top","margin-top","margin-left"),this.model.get("fixed_position")&&!r.a.isEmpty(c)){var h=r.a.pick(this.latestPosSizeAngle,"width","height");r.a.extend(c,h),"default"!=this.model.getViewport()&&(a=this.workspace.position,-1==["n","c","s"].indexOf(this.model.get("fixed_position"))&&(c.left+=a.left),-1==["e","c","w"].indexOf(this.model.get("fixed_position"))&&(c.top+=a.top)),r.a.extend(c,v.b.getFixedPositionCSS(this.model.get("fixed_position"),c,1))}var d=this.getStickedSide();"left"==d||"right"==d?this.latestPosSizeAngle.sticked_margin=this.calcStickedMargin(this.latestPosSizeAngle.left,this.latestPosSizeAngle.width):"top"!=d&&"bottom"!=d||(this.latestPosSizeAngle.sticked_margin=this.calcStickedMargin(this.latestPosSizeAngle.top,this.latestPosSizeAngle.height)),s.css(c),this.has_parent_block||this.isStandalone||(t.doNotRedrawPacksFrames||this.workspace.redrawPacksFrames({tp:"css"}),t.doNotRedrawBottomShiftLine||this.workspace.redrawBottomShiftLine({tp:"css"}));var p=this.latestPosSizeAngle,u=p.width>=0&&p.width<=this.SUPER_SMALL_TRESHOLD&&p.height>=0&&p.height<=this.SUPER_SMALL_TRESHOLD;this.$el.toggleClass("super-small",u)},onWorkspaceResize:function(){if(this.model.get("is_full_width")){var t=this.getFullWidthDims(),e=t.w,i=t.x;this.model.set({w:e/RM.constructorRouter.zoom.getZoom(),x:i})}this.model.get("is_full_height")&&this.model.set(this.getFullHeightDims()),this.model.get("sticked")&&this.setStickedDims(),this.frame.sizes&&(this.frame.sizes.zoom=RM.constructorRouter.zoom.getZoom(),this.frame.sizes.applyPosition())},getCachedSizes:function(){var t=this;return this.cachedSizes||(this.cachedSizes={width:this.workspace.$container.width(),height:this.workspace.$container.height(),clientWidth:this.workspace.$container[0].clientWidth},setTimeout((function(){t.cachedSizes=null}),0)),this.cachedSizes},getFullWidthDims:function(t){var e,i=this.model.get("fixed_position"),s={},o=!1,n=this.getCachedSizes(),a=n.width-n.clientWidth;return null==t&&(t=parseInt(this.model.get("full_width_margin"),10)||0),i?(e=["s","c","n"].indexOf(i)>-1,o=r.a.contains(i,"e")||r.a.contains(i,"w"),s.x=(e?0:t)-Math.ceil((o?0:a)/2)):s.x=-this.workspace.position.left+t,s.w=n.width-2*t-(o?0:a),s},getFullHeightDims:function(t){var e,i=this.model.get("fixed_position"),s={},o=this.getCachedSizes().height,n=this.workspace.page.getCurrentViewportParam("height");return null==t&&(t=parseInt(this.model.get("full_height_margin"),10)||0),i?(e=["w","c","e"].indexOf(i)>-1,s.y=e?0:t,s.h=o-2*t):(s.y=-this.workspace.position.top+t,s.h=(o>=n?o:n)-2*t),s},getStickedDims:function(t,e){var i=t||this.model.get("sticked"),s=null!=e?e:parseInt(this.model.get("sticked_margin"),10)||0,o=this.workspace.$container.width(),n=this.workspace.$container.height(),a=this.workspace.page.getCurrentViewportParam("height"),r=o-this.workspace.$container[0].clientWidth,l="default"!==this.model.getViewport(),c={};return"left"==i?(c.x=-this.workspace.position.left+s,c.y=this.model.get("y")):"right"==i?(c.x=o-r-s-this.model.get("w")-this.workspace.position.left,c.y=this.model.get("y")):"top"==i?(c.x=this.model.get("x"),c.y=s+(a<n?0:-this.workspace.position.top)):"bottom"==i&&(c.x=this.model.get("x"),c.y=(a<n||l?a-this.workspace.position.top:a)-s-this.model.get("h")+this.workspace.position.top),c},setStickedDims:function(){var t=this.model.get("sticked");t&&"bottom"!==t&&"default"!==this.model.getViewport()&&this.model.unset("sticked"),this.model.get("sticked")&&this.model.set(this.getStickedDims())},calcStickedMargin:function(t,e){var i=this.model.get("sticked"),s=this.workspace.$container.width(),o=this.workspace.$container.height(),n=this.workspace.page.getCurrentViewportParam("height"),a=s-this.workspace.$container[0].clientWidth,r="default"!==this.model.getViewport(),l=0;return"left"==i?l=t+this.workspace.position.left:"right"==i?l=s-a-e-t-this.workspace.position.left:"top"==i?l=t+(n<o?0:-this.workspace.position.top):"bottom"==i&&(l=(n<o||r?n-this.workspace.position.top:n)-e-t+this.workspace.position.top),l},getIconStyle:function(t){var e={},i="./constructor/widgetbar/icons/";t&&t.small&&(i+="small/",this.icon_color&&(e["background-color"]=this.icon_color));var s=Object(k.b)(i+this.model.get("type")+".svg");return e["background-image"]="url("+s+")",e},bindEvents:function(){this.$el.on("click",this.onClick),this.$el.on("dblclick",this.onDblClick),this.has_parent_block||(Object(s.a)(this.$el).drag("start",this.onDragStart,{not:".no-drag, :input:not([readonly]), .size-tool"}).drag(this.onDragMove,{delay:100}).drag("end",this.onDragEnd),this.workspace.on("select",this.onWorkspaceBlocksSelect),this.updateLockDragState())},updateControls:function(t){var e,s;if(t=t||{},this.has_parent_block?(e=this.workspace&&this.workspace.page_workspace&&this.workspace.page_workspace.controls,s=this.workspace.page_workspace):(e=this.workspace&&this.workspace.controls,s=this.workspace),e&&e.selectedBlocks&&1==e.selectedBlocks.length&&e.selectedBlocks[0].id==this.id){var o=r.a.pluck(e.controls,"name"),n=i("hQZz").default,a=r.a.filter(this.controls,function(t){return!n[t].prototype.restrictions||!!n[t].prototype.restrictions.call(this,s)}.bind(this));(r.a.difference(a,o).length||r.a.difference(o,a).length)&&e.setControls(this.controls,this,t)}},scrollTo:function(){var t=this.$el.offset().top>document.body.clientHeight;if(this.$el.offset().top<0||t){var e=Object(s.a)("#main");e.stop().animate({scrollTop:e.scrollTop()+this.$el.offset().top-100},"200","swing",function(){r.a.delay(function(){this.frame.sizes&&this.frame.sizes.applyPosition()}.bind(this),400)}.bind(this))}},selectFromWidgetBar:function(t,e){if(t||(t={shiftKey:!1,ctrlKey:!1}),this.workspace.trigger("block:click",this,t),t.shiftKey||t.ctrlKey||t.metaKey||this.workspace.trigger("deselect",this),(t.ctrlKey||t.metaKey)&&this.selected&&!r.a.isEmpty(this.workspace.getSelectedBlocks()))return this.deselect(),void(r.a.isEmpty(this.workspace.getSelectedBlocks())?this.workspace.trigger("deselect",this):this.workspace.trigger("select",this.workspace.getSelectedBlocks(),[this]));if(this.select(!e),!r.a.isEmpty(this.workspace.getSelectedBlocks())){var i={selected:this.workspace.getSelectedBlocks(),deselected:[]};e&&(i=this.workspace.redefineSelectionWithPacks(this.workspace.getSelectedBlocks())),this.workspace.trigger("select",i.selected,i.deselected)}},onDblClick:function(){this.isStandalone||!this.has_parent_block&&this.model.get("pack_id")&&this.selectFromWidgetBar()},onClick:function(t,e){if(this.workspace.trigger("block:click",this,t),!this.isStandalone)if(this.has_parent_block){if(this._justResized)return void(this._justResized=!1);if(window.suppressClick&&window.suppressClick>+new Date)return;if(!e&&this.workspace.page_workspace.controls&&!this.workspace.page_workspace.controls.canControlsBeClosed())return;this.workspace.trigger("deselect",this),this.select(),this.workspace.trigger("select")}else{if(this.outofbox)return;if(window.suppressClick&&window.suppressClick>+new Date)return;if(this.model.get("hidden"))return;if(this._justResized)return void(this._justResized=!1);if(t||(t={shiftKey:!1}),this.frame&&this.frame.rotationState)return;if(this.selected&&!t.shiftKey&&1==this.workspace.getSelectedBlocks().length)return void(this.child_workspace&&(this.child_workspace.trigger("deselect"),this.workspace.controls.onSelect([this])));if(!e&&this.workspace.controls&&!this.workspace.controls.canControlsBeClosed())return;if(t.shiftKey&&this.selected&&!r.a.isEmpty(this.workspace.getSelectedBlocks()))return void this.cutFromSelection();if(t.shiftKey||this.workspace.trigger("deselect",this),this.select(!1,{noFrame:this.workspace.getSelectedBlocks().length>0||this.model.get("pack_id")}),!r.a.isEmpty(this.workspace.getSelectedBlocks())){var i=this.workspace.redefineSelectionWithPacks(this.workspace.getSelectedBlocks());this.workspace.trigger("select",i.selected,i.deselected)}}},cutFromSelection:function(){if(!this.isStandalone&&this.selected&&this.workspace)if(this.deselect(),0==this.workspace.getSelectedBlocks().length)this.workspace.controls.hide(),this.workspace.trigger("deselect");else if(this.workspace.redefineSelectionWithPacks){var t=this.workspace.redefineSelectionWithPacks(this.workspace.getSelectedBlocks(),this);r.a.isEmpty(t.selected)||this.workspace.trigger("select",t.selected,t.deselected),r.a.isEmpty(t.selected)&&this.workspace.trigger("deselect")}},checkNeedChangeVisibility:function(t){var e=this,i=this.getAnimatedBlocks(),s=this.getTriggerBlocks();s.length>0&&(this.checkTriggerBlocks(s,t),r.a.each(s,(function(i){e.checkBothTypesOfBlocks(i,t)}))),i.length>0&&(this.checkAnimatedBlocks(i,t),r.a.each(i,(function(i){e.checkBothTypesOfBlocks(i,t)}))),this.model.getAnimations().find((function(t){return t.steps&&t.steps[0]}))&&this.changeVisibility(this,t)},checkBothTypesOfBlocks:function(t,e){t.getTriggerBlocks().length>0&&this.checkTriggerBlocks(t.getTriggerBlocks(),e),t.getAnimatedBlocks().length>0&&this.checkAnimatedBlocks(t.getAnimatedBlocks(),e)},checkTriggerBlocks:function(t,e){var i=this;r.a.each(t,(function(t){t.model.getAnimations().find((function(t){return t.steps&&t.steps[0]}))&&i.changeVisibility(t,e)}))},checkAnimatedBlocks:function(t,e){var i=this;r.a.each(t,(function(t){i.changeVisibility(t,e)}))},changeVisibility:function(t,e){"select"===e?t.$el.removeClass("hidden"):t.$el.toggleClass("hidden",!!t.model.getAnimations().find((function(t){return t.steps&&t.steps[0]&&t.steps[0].hideInEditor})))},select:function(t,e){e=e||{},this.isSelectable()&&(this.has_parent_block||this.recalcFixedLine(!0),this.setupAnimationTriggers(t),this.listenTo(this.workspace,"paste-animation",this.resetAnimationTriggers),this.selected||(e.noFrame||this.frame&&this.frame.show(t),this.selected=!0,this.workspace.restoreFocusForCopyPaste.__debounced(),this.trigger("select"),this.workspace.checkBundleDragAbility&&this.workspace.checkBundleDragAbility(),Object(C.a)("constructor.hidingSwitcher")&&this.checkNeedChangeVisibility("select")))},addToSelection:function(){this.selected=!0,this.frame&&this.frame.show()},deselect:function(t){t!=this&&this.selected&&(this.frame&&this.frame.hide(),this.hidePanel(),this.frame&&this.frame.removeRotationState(),this.selected=!1,this.toggleInPackClass(!1),this.removeFixedLine(),this.teardownAnimationTriggers(),this.stopListening(this.workspace,"paste-animation",this.resetAnimationTriggers),this.child_workspace&&this.child_workspace.trigger("deselect"),this.trigger("deselect"),Object(C.a)("constructor.hidingSwitcher")&&this.checkNeedChangeVisibility())},isSelectable:function(){return!this.outofbox},isLocked:function(){return!!this.model.get("is_locked")},isFullWidth:function(){return!!this.model.get("is_full_width")},isFullHeight:function(){return!!this.model.get("is_full_height")},onDragStart:function(t,e){if(!this.workspace.disableDragging&&(this.workspace.freezeDeltaX=void 0,e.blocks=this.isStandalone?[this]:this.workspace.getSelectedBlocks(),!r.a.any(e.blocks,(function(t){return t.disableDragging})))){var i=this.model.get("pack_id")?this.workspace.getPackBlocks(this.model.get("pack_id")):[this];if(Object(s.a)("html").addClass("blocks-is-moving"),r.a.isEmpty(e.blocks))e.blocks=i;else if(!this.selected){var o=this.workspace.$container.scrollTop(),n=this.workspace.position;r.a.any(e.blocks,(function(t){return t.contains({x:e.startX-n.left,y:e.startY-n.top+o})}))||(e.blocks=i)}var a=!1;r.a.each(e.blocks,(function(t){t.initialBoxData=t.getBoxData({includeBoundingBox:!0}),t._maxShift=0,a=a||!!t.selected})),a||this.workspace.redrawBottomShiftLine({tp:"move-unselected-start",blocks:e.blocks}),RM.constructorRouter.gg.snap&&RM.constructorRouter.gg.handleMoveStart(e.blocks),e.scrollTop=this.workspace.$container.scrollTop(),this.isDragging=!0,this.workspace.bottomBlocksToMove&&!this.workspace.bottomBlocksToMove.active&&delete this.workspace.bottomBlocksToMove}},onDragMove:function(t,e){var i;if(!r.a.any(e.blocks,(function(t){return t.disableDragging}))&&!this.workspace.disableDragging){e.isClone||this.isStandalone||(e.isClone=t.altKey,e.isClone&&r.a.each(e.blocks,(function(t){t.clone()}))),i=r.a.filter(e.blocks,(function(t){return!t.isLocked()}));var s=e.startY+e.scrollTop,o=t.pageY+this.workspace.$container.scrollTop();e.deltaY=o-s;var n=RM.constructorRouter.zoom.getZoom();e.deltaX=e.deltaX/n,e.deltaY=e.deltaY/n,this.moveBlocks(this.workspace,i,e,t),this.isStandalone||(this.workspace.redrawPacksFrames({tp:"move"}),this.workspace.redrawBottomShiftLine({tp:"move"})),v.b.autoWindowScroll(t,this.workspace.$container,r.a.bind((function(){this.onDragMove(t,e)}),this))}},moveBottomBlocks:function(t,e,i,s){var o=t.bottomBlocksToMove;if(o){var n=e+s.y-(o.deltaYcorrection||0);i&&(n=Math.max(n,0)),o.active&&(r.a.each(o.list,(function(t,e){var i=o.initial[e],s=n+i.y;t.css({doNotRedrawPacksFrames:!0,doNotRedrawBottomShiftLine:!0,left:i.x,top:s}),t.trigger("move",{left:i.x,top:s,width:i.w,height:i.h})})),o.list&&o.list.length&&(t.page.setCurrentViewportParam("type","scroll"),t.page.setCurrentViewportParam("height",Math.ceil(Math.max(o.initPageHeight+n,o.minPageHeight))))),o.prevDeltaY=e}t.checkBundleDragAbility()},"collectBottomBloks":function(t,e,i){var s=t.bottomBlocksToMove;s&&(s.kbActivate&&"keydown"==i.type||"drag"==i.type)&&(s.list||(r.a.extend(s,t.calcBottomBlocksToMove(e,s)),s.tosave=r.a.uniq((s.tosave||[]).concat(s.list)),s.deltaYcorrection=s.prevDeltaY||0))},moveBlocks:function(t,e,i,o){var n=999999,a=999999,l=-999999,c=-999999,h=o&&"keydown"==o.type,d=null,p=r.a.any(e,(function(t){return t.isFullWidth()})),u=r.a.any(e,(function(t){return!!t.constraintHorzMove})),g=r.a.any(e,(function(t){return t.isFullHeight()})),m=r.a.any(e,(function(t){return!!t.constraintVertMove}));t&&T.prototype.collectBottomBloks(t,e,o);var f=t&&t.spacesController&&t.spacesController.checkAllBlocksNear(e),v=!1,b=0,_=t&&t.getViewportPosition();r.a.each(e,(function(s){var r=t&&void 0!==t.freezeDeltaX?t.freezeDeltaX:i.deltaX,w=i.deltaY-(s.resetDelta||0),y=s.initialBoxData||s.getBoxData({includeBoundingBox:!0});t&&t._inTriangleBundleDrag&&(r=0);var k=s.model.get("fixed_position");if(t&&t.spacesController&&!k){var x=t.spacesController.getRestriction(s.model,f?e:[]),S=w+y.bb_y,P=w+y.bb_y+y.bb_h,$=w;S<x.top?(w=Math.floor(x.top-y.bb_y),void 0===t.freezeDeltaX&&f&&t.spacesController.needFreeze(s)&&(t.freezeDeltaX=r)):P>x.bottom?(w=Math.floor(x.bottom-(y.bb_y+y.bb_h)),void 0===t.freezeDeltaX&&f&&t.spacesController.needFreeze(s)&&(t.freezeDeltaX=r)):t.freezeDeltaX=void 0,Math.abs($-w)&&"drag"===o.type&&f&&(v=!0,b=$-w)}k&&(o&&"keydown"!==o.type&&(w=o.pageY-i.startY),k.indexOf("e")>-1&&(r=-r),k.indexOf("s")>-1&&(w=-w)),k={x:r+y.x,y:w+y.y,w:y.w,h:y.h};var O={x:r+y.bb_x,y:w+y.bb_y};if(o&&o.shiftKey){var T=Math.abs(r),M=Math.abs(w);if(s._shiftDirection||h||(T>=4&&(s._shiftDirection="horz"),M>=4&&(s._shiftDirection="vert"),(T>=4||M>=4)&&r/w<2&&r/w>.5&&(s._shiftDirection="diag1"),(T>=4||M>=4)&&r/w>-2&&r/w<-.5&&(s._shiftDirection="diag2"),s._maxShift=Math.max(T,M)),(p||u)&&(s._shiftDirection="vert"),(g||m)&&(s._shiftDirection="horz"),s._shiftDirection&&!h){var j=r;"horz"!=s._shiftDirection&&"vert"!=s._shiftDirection||(Math.abs(r)>s._maxShift&&(s._maxShift=Math.abs(r),s._shiftDirection="horz"),Math.abs(w)>s._maxShift&&(s._maxShift=Math.abs(w),s._shiftDirection="vert")),t.spacesController||("horz"==s._shiftDirection&&(k.y=y.y),"vert"==s._shiftDirection&&(k.x=y.x),"diag1"==s._shiftDirection&&(k.x=y.x+j,k.y=y.y+j),"diag2"==s._shiftDirection&&(k.x=y.x+j,k.y=y.y-j)),d=s._shiftDirection}}var I=s.model.get("fixed_position");if(I&&_&&Object(C.a)("constructor.snapFixed")){var E=O.x,A=O.y;switch(I){case"nw":case"n":case"ne":A+=_.top;break;case"e":case"c":case"w":A+=_.top+_.height/2-y.bb_h/2;break;case"sw":case"s":case"se":A=_.top+_.height-A-y.bb_h}switch(I){case"nw":case"w":case"sw":E-=(_.viewportWidth-_.width)/2;break;case"n":case"c":case"s":E+=_.width/2-y.bb_w/2;break;case"ne":case"e":case"se":E=_.width+(_.viewportWidth-_.width)/2-E-y.bb_w}n=Math.min(n,E),a=Math.min(a,A),l=Math.max(l,E+y.bb_w),c=Math.max(c,A+y.bb_h)}else n=Math.min(n,O.x),a=Math.min(a,O.y),l=Math.max(l,O.x+y.bb_w),c=Math.max(c,O.y+y.bb_h);(p||u)&&(k.x=y.x),(g||m)&&(k.y=y.y),s._position=k})),v&&!o.altKey?t&&t.spacesController.updateGhost(e,b,i.deltaX-t.freezeDeltaX,Object(s.a)("> .workspace",t.$el),o):t&&t.spacesController&&t.spacesController.removeGhost();var w={x:0,y:0};!RM.constructorRouter.gg.snap||r.a.all(e,(function(t){return t.model.get("fixed_position")}))&&!Object(C.a)("constructor.snapFixed")||(w=RM.constructorRouter.gg.handleSnapMove({x:n,y:a},l-n,c-a),"horz"==d&&(w.y=0),"vert"==d&&(w.x=0),(p||u)&&(w.x=0),(g||m)&&(w.y=0));var y={};if(i.isClone&&(y.clone=!0),r.a.each(e,(function(t){var e=t.model.get("fixed_position"),i=e in{ne:1,e:1,se:1}?-w.x:w.x,s=e in{se:1,s:1,sw:1}?-w.y:w.y;t.css(r.a.extend({doNotRedrawPacksFrames:!0,doNotRedrawBottomShiftLine:!0,left:Math.ceil(t._position.x+i),top:Math.ceil(t._position.y+s)},y)),t.recalcFixedLine(),t.recalcStickedLine(),t.trigger("move",{left:Math.ceil(t._position.x+i),top:Math.ceil(t._position.y+s),width:Math.ceil(t._position.w),height:Math.ceil(t._position.h)})})),t){var k=i.isCloneByKeys?i.deltaYOrig:i.deltaY;T.prototype.moveBottomBlocks(t,k,i.isClone,w)}},onDragEnd:function(t,e){if(v.b.autoWindowScrollClear(),!r.a.any(e.blocks,(function(t){return t.disableDragging}))&&!this.workspace.disableDragging){var i=!1;if(r.a.each(e.blocks,(function(t){t.initialBoxData=null,t.resetDelta=null,t._shiftDirection=null,i=i||!!t.selected})),i||this.workspace.redrawBottomShiftLine({tp:"move-unselected-end"}),e.isClone)this.workspace.cloneBlocks(r.a.filter(e.blocks,(function(t){return!t.isLocked()})));else if(this.isStandalone)r.a.first(e.blocks).saveBox();else{this.workspace.spacesController&&this.workspace.spacesController.moveBlocksToHighlighted(e.blocks),this.workspace.spacesController&&this.workspace.spacesController.removeGhost();var o=this.workspace.bottomBlocksToMove,n=this.workspace.spacesController&&this.workspace.spacesController.getBlocksToSave()||[],a=r.a.map([].concat(e.blocks,o&&o.tosave||[],n),function(t){return r.a.extend({_id:t.id},t.getBoxData({includeFreeze:e.deltaX-this.workspace.freezeDeltaX}))}.bind(this));o&&o.initPageHeight!=this.workspace.page.getCurrentViewportParam("height")&&o.tosave&&o.tosave.length&&this.workspace.page.save(),this.workspace.page.getCurrentViewportParam("height")>2e3&&e.deltaY>0&&e.deltaY>Math.abs(e.deltaX)&&(!o||!o.active)&&e.blocks.length>5&&RM.constructorRouter.helpPanel.showTip({name:"bottom-blocks-to-move",showOnce:!0}),this.workspace.save_group(a)}Object(s.a)("html").removeClass("blocks-is-moving"),RM.constructorRouter.gg.snap&&RM.constructorRouter.gg.handleMoveEnd(),e.isClone||this.triggerRedraw(),this.isDragging=!1,"hotspot"===this.model.get("type")&&Object(s.a)(t.target).one("click",(function(t){t.stopImmediatePropagation()})),this.workspace.clearBottomBlocksToMove(),this.workspace.checkBundleDragAbility()}},triggerRedraw:function(){this.isStandalone||this.workspace.trigger("redraw",{is_global:this.model.get("is_global")})},recalcFixedLine:function(t){var e=this.model.get("fixed_position")||this.restoreFixed,i=this.model.get("pack_id"),s=i&&this.workspace.packs&&this.workspace.packs[i],o=this.selected||t;e&&!s&&o?this.updateFixedLine(e):this.removeFixedLine()},updateFixedLine:function(t){this.$fixed_svg||(this.$fixed_svg=Object(s.a)('<svg class="fixed-line"><line /></svg>'),this.workspace.$(".workspace").append(this.$fixed_svg));var e,i,o,n,a,r,l=this.frame.$el.offset(),c=this.getBoxData(),h=this.$fixed_svg.find("line").get(0),d=RM.constructorRouter.zoom.getZoom(),p=this.isFullHeight(),u=this.workspace.$container.width()/d,g=this.workspace.$container.height()/d;a=r=0,"default"!=this.model.getViewport()&&(a=this.workspace.position.left,r=this.workspace.position.top),e=a,o=r,i=l.left,n=l.top,t.indexOf("s")>-1&&(o=g-r,n+=c.h),t.indexOf("e")>-1&&(e=u-a,i+=c.w),["n","c","s"].indexOf(t)>-1&&(e=u/2,i+=c.w/2),["w","c","e"].indexOf(t)>-1&&(o=g/2,n+=c.h/2),p&&(n=o),h.setAttributeNS(null,"x1",e),h.setAttributeNS(null,"x2",i),h.setAttributeNS(null,"y1",o),h.setAttributeNS(null,"y2",n)},removeFixedLine:function(){this.$fixed_svg&&this.$fixed_svg.remove(),delete this.$fixed_svg},recalcStickedLine:function(){var t=this.model.get("sticked"),e={left:"",right:"",top:"",bottom:"",width:"",height:""};if(t){var i="left"==t||"right"==t;this.$stickedLine||(this.$stickedLine=Object(s.a)("<div>").addClass("sticked-line skip-rotate").appendTo(this.$el)),this.$stickedLine.removeClass("line-horizontal line-vertical"),this.$stickedLine.addClass(i?"line-horizontal":"line-vertical"),i?(e.width=this.calcStickedMargin(this.latestPosSizeAngle.left,this.latestPosSizeAngle.width),e[t]=-e.width):(e.height=this.calcStickedMargin(this.latestPosSizeAngle.top,this.latestPosSizeAngle.height),e[t]=-e.height),this.$stickedLine.css(e)}else this.$stickedLine&&(this.$stickedLine.remove(),delete this.$stickedLine)},clone:function(){this.isLocked()||(this.$cloneEl=Object(s.a)(s.a.clone(this.$el.get(0))),this.$cloneEl.data("id",this.$cloneEl.data("id")+"-clone"),this.$cloneEl.insertAfter(this.$el)),this.deselect()},blink:function(){var t=this.$el;t.addClass("frame-blink"),v.b.waitForTransitionEnd(t,2500,"opacity",(function(){t.removeClass("frame-blink")}))},getStandardName:function(){var t=this.model.get("type");if("text"===t)return Object(s.a)(this.model.get("text")).text();if("shape"===t){var e=this.model.get("tp");return v.b.capitalize({ellipse:"oval"}[e]||e)}return t===v.a.ecommerceCartBlockName||t===v.a.addToCartBlockName?this.name:v.b.capitalize(t)},highlight:function(t,e){var i=this.animationMode?(this.workspace.animationSteps.currentStep||this.workspace.animationSteps.initialStep).$el:this.$el;e&&i&&i.toggleClass(e,Boolean(t))},getTriggerBlocks:function(){var t=this;return this.getAllAnimationTriggers().reduce((function(e,i){var s=t.workspace.findBlock(i);return s?[].concat(S(e),[s]):e}),[])},getAnimationTriggers:function(t){var e=this.model.getAnimations().find((function(e){return e.UUID===t}));return _.a.normalizeAnimationTriggers(e&&e.trigger)},getAllAnimationTriggers:function(){return this.model.getAnimations().reduce((function(t,e){return e.trigger?[].concat(S(t),S(_.a.normalizeAnimationTriggers(e&&e.trigger))):t}),[])},setAnimationTriggers:function(t,e){var i=this.model.getAnimations().map((function(i){return i.UUID===t?$({},i,{trigger:e&&!r.a.isArray(e)?[e]:e||[]}):i}));this.model.set("animation",i)},removeAllAnimationTriggers:function(){var t=this;this.model.getAnimations().forEach((function(e){t.getAnimationTriggers(e.UUID).forEach((function(i){return t.removeAnimationTrigger(e.UUID,i)}))}))},removeAnimationTrigger:function(t,e){var i=this.getAnimationTriggers(t);-1!==i.indexOf(e)&&(this.setAnimationTriggers(t,r.a.without(i,e)),this.model.trigger("animation:trigger:remove",e))},isPackAlreadySetUp:function(t){return Boolean(t&&this.workspace.getPackBlocks&&r.a.find(this.workspace.getPackBlocks(t),(function(t){return t.ownTooltip})))},getAnimatedBlocks:function(){var t=r.a.reduce(this.workspace.blocks,function(t,e){if(e.getAllAnimationTriggers().includes(this.id)){var i=this.model.get("pack_id")||e.id;t[i]=t[i]||e}return t}.bind(this),{});return r.a.values(t)},getTooltipTarget:function(t){var e=this.model.get("pack_id"),i=e&&this.workspace.$("#pack_"+e);return this.animationMode?this.workspace.animationSteps.initialStep.$el:i&&i.length&&!t?i.find(".content"):this.$content},getTooltipContainer:function(){return this.workspace.$(".workspace")},setupAnimationTriggers:function(t){var e=this.getAnimatedBlocks(),i=this.getTriggerBlocks();r.a.each(e,this.setupAnimationTrigger.bind(this,!0)),r.a.each(i,this.setupAnimationTrigger.bind(this,!1)),!(e.length&&(e.length>1||e[0].id!==this.id))&&!i.length||this.isPackAlreadySetUp(this.model.get("pack_id"))||this.ownTooltip||(this.ownTooltip=this.getTooltipTarget(t).RMAltText({text:e.length&&i.length?"Animated / Trigger":e.length?"Trigger":"Animated",offset:this.TOOLTIP_OFFSET,manual:!0,cssClass:"animation-trigger-tooltip animation-trigger-own-tooltip",container:this.getTooltipContainer(),keepInBounds:!0}),this.ownTooltip.show(),this.bindAnimationTriggerHandlers())},teardownAnimationTriggers:function(){var t=r.a.keys(this.triggerAssets);r.a.each(t,this.teardownAnimationTrigger.bind(this)),this.ownTooltip&&this.ownTooltip.destroy(),delete this.ownTooltip,this.unbindAnimationTriggerHandlers()},setupAnimationTrigger:function(t,e){if(e){var i=this.model.get("pack_id"),s=e.id,o=e.model.get("pack_id"),n=o&&this.workspace.$("#pack_"+o);this.triggerAssets[s]=this.triggerAssets[s]||{},this.triggerAssets[s].tooltip||s===this.id||i&&o===i||e.ownTooltip||(this.triggerAssets[s].tooltip=(n||e.$content).RMAltText({text:n||t?"Animated":"Trigger",offset:this.TOOLTIP_OFFSET,manual:!0,cssClass:"animation-trigger-tooltip",container:this.getTooltipContainer(),keepInBounds:!0}),this.triggerAssets[s].tooltip.show(),n?n.addClass(_.a.ACTIVE_TRIGGER_CLASS):e.highlight(!0,_.a.ACTIVE_TRIGGER_CLASS),this.triggerAssets[s].updateLinkedTooltipBound=this.updateLinkedTooltip.bind(this,s),this.listenTo(e,"move resize",this.triggerAssets[s].updateLinkedTooltipBound),this.listenTo(e&&e.model,"change:x change:y change:w change:h",this.triggerAssets[s].updateLinkedTooltipBound))}},teardownAnimationTrigger:function(t){var e=this.workspace.findBlock(t);e&&e.highlight(!1,_.a.ACTIVE_TRIGGER_CLASS),this.workspace.$("."+_.a.ACTIVE_TRIGGER_CLASS).removeClass(_.a.ACTIVE_TRIGGER_CLASS),this.triggerAssets[t]&&(this.triggerAssets[t].tooltip&&this.triggerAssets[t].tooltip.destroy(),this.stopListening(e,"move resize",this.triggerAssets[t].updateLinkedTooltipBound),this.stopListening(e&&e.model,"change:x change:y change:w change:h",this.triggerAssets[t].updateLinkedTooltipBound),delete this.triggerAssets[t])},bindAnimationTriggerHandlers:function(){this.animationTriggerHandlersBound||(this.listenTo(this,"move resize",this.updateOwnTooltip),this.listenTo(this,"animationMode",this.resetAnimationTriggers),this.listenTo(this,"animation:stepsPopup:open",this.onStepsPopupOpen),this.listenTo(this,"animation:stepsPopup:closed",this.onStepsPopupClosed),this.listenTo(this.model,"change:angle change:x change:y change:w change:h change:sticked change:fixed_position change:is_full_width change:is_full_height",this.updateOwnTooltip),this.listenTo(this.workspace,"workspace-resize",this.updateTooltips),Object(s.a)("#main").on("scroll",this.updateTooltips),this.animationTriggerHandlersBound=!0)},unbindAnimationTriggerHandlers:function(){this.stopListening(this,"move resize",this.updateOwnTooltip),this.stopListening(this,"animationMode",this.resetAnimationTriggers),this.stopListening(this,"animation:stepsPopup:open",this.onStepsPopupOpen),this.stopListening(this,"animation:stepsPopup:closed",this.onStepsPopupClosed),this.stopListening(this.model,"change:angle change:x change:y change:w change:h change:sticked change:fixed_position change:is_full_width change:is_full_height",this.updateOwnTooltip),this.stopListening(this.workspace,"workspace-resize",this.updateTooltips),Object(s.a)("#main").off("scroll",this.updateTooltips),delete this.animationTriggerHandlersBound},updateTooltips:function(){window.requestAnimationFrame(function(){r.a.each(this.getAllAnimationTriggers(),this.recalcLinkedTooltip),this.recalcOwnTooltip()}.bind(this))},updateLinkedTooltip:function(t){window.requestAnimationFrame(this.recalcLinkedTooltip.bind(this,t))},updateOwnTooltip:function(){window.requestAnimationFrame(this.recalcOwnTooltip.bind(this))},recalcLinkedTooltip:function(t){this.triggerAssets[t]&&this.triggerAssets[t].tooltip&&this.triggerAssets[t].tooltip.update()},recalcOwnTooltip:function(){this.ownTooltip&&this.ownTooltip.update()},onStepsPopupOpen:function(t){var e,i=this.ownTooltip&&this.ownTooltip.getElement(),s=i&&i[0]&&i[0].getBoundingClientRect();if(t){var o=t.find(".js-steps-popup");e=o&&o.length&&o[0].getBoundingClientRect()}s&&e&&b.a.doBoundingBoxesIntersect(s,e)&&this.ownTooltip.hide()},onStepsPopupClosed:function(){this.ownTooltip&&!this.ownTooltip.getElement()&&this.ownTooltip.show()},getSaveBoxData:function(t){var e=this.getBoxData();return this.model.get("is_full_width")&&(e=r.a.omit(e,"x")),this.model.get("is_full_height")&&(e=r.a.omit(e,"y")),e},getSaveBoxOptions:function(t){return t||{}},saveBox:function(t){this._saveXHR&&this._saveXHR.abort(),this._saveXHR=this.model.save(this.getSaveBoxData(t),this.getSaveBoxOptions(t))},getBoxData:function(t){t=t||{};var e=this.latestPosSizeAngle,i=this.model.get("is_full_width"),s=this.model.get("is_full_height"),o={w:e.width,h:e.height,x:e.left,y:e.top};if(t.includeFreeze&&(o.x+=t.includeFreeze),t.includeRotationData&&(o.angle=e.angle,o.flip_v=e.flip_v,o.flip_h=e.flip_h),t.includeBoundingBox&&(o.bb_w=e.bb_width,o.bb_h=e.bb_height,o.bb_x=e.bb_left,o.bb_y=e.bb_top),this.model.get("fixed_position")&&t.checkFixedPosition){var n=r.a.clone(o),a=this.$el.offset(),l=this.workspace.position;o.y=a.top-l.top,o.x=a.left-l.left,t.includeBoundingBox&&(o.bb_x=o.x+(o.bb_x-n.x),o.bb_y=o.y+(o.bb_y-n.y))}if(i){var c=this.getFullWidthDims();o.x=c.x,o.w=c.w}if(s){var h=this.getFullHeightDims();o.y=h.y,o.h=h.h}return this.model.get("sticked")&&(o.sticked_margin=e.sticked_margin),o},getModelBox:function(){var t=this.model.get("angle")||0,e=t?t*Math.PI/180:0;return{left:this.model.get("x"),top:this.model.get("y"),width:this.model.get("w"),height:this.model.get("h"),angle:t,flip_v:!!this.model.get("flip_v"),flip_h:!!this.model.get("flip_h"),sinAngle:Math.sin(-e),cosAngle:Math.cos(-e)}},getPack:function(){var t=this.model.get("pack_id");return t&&this.workspace.packs[t]},onPackChange:function(t,e,i){this.toggleInPackClass(),r.a.isEmpty(this.workspace.getSelectedBlocks())||this.workspace.trigger("select",this.workspace.getSelectedBlocks()),this.workspace.redrawPacksFrames({tp:"pack-change"}),this.isLocked()&&(i.undo||i.redo)&&t.save({is_locked:!1},{patch:!0,skipHistory:!0}),this.recalcFixedLine(),this.selected&&this.resetAnimationTriggers()},checkNeedRedraw:function(t,e){e=e||{};var i=t.changedAttributes();return(!e.pid||!this.workspace||this.workspace.page.id===e.pid)&&(!!this.workspace.rendered&&(1!=r.a.keys(i).length||!i.animation))},redraw:function(t,e){e=e||{},this.checkNeedRedraw(t,e)&&this.redrawPosition(t,r.a.extend(e,{forceRedraw:!1}))},updateLockDragState:function(){this.$el.toggleClass("no-drag",this.isLocked())},redrawPosition:function(t,e){e=e||{},t=t||this.model;var i={},s=e.forceRedraw?{}:this.getBoxData({includeRotationData:!0}),o=this.model.changedAttributes(),n=r.a.has(o,"is_full_width"),a=r.a.has(o,"is_full_height");n&&this.$el.toggleClass("full-width",!!this.model.get("is_full_width")),a&&this.$el.toggleClass("full-height",!!this.model.get("is_full_height"));var l=t.get("fixed_position"),c=!!t.get("is_full_width"),h=!!t.get("is_full_height");if((t.get("x")!=s.x||l)&&(i.left=t.get("x")),c){var d=this.getFullWidthDims();i.left=d.x}if((t.get("y")!=s.y||l)&&(i.top=t.get("y")),h){var p=this.getFullHeightDims();i.top=p.y}if((t.get("w")!=s.w||l||c)&&(i.width=t.get("w")),e.socketUpdate&&c&&(i.width=d.w),e.socketUpdate&&h&&(i.height=p.h),(t.get("h")!=s.h||l||h)&&(i.height=t.get("h")),Object(C.a)("constructor.zIndex")||t.get("z")!=this.$content.css("z-index")&&(i["z-index"]=t.get("z")),(t.get("angle")||0)!=s.angle&&(i.angle=t.get("angle")||0),!!t.get("flip_v")!=s.flip_v&&(i.flip_v=!!t.get("flip_v")),!!t.get("flip_h")!=s.flip_h&&(i.flip_h=!!t.get("flip_h")),r.a.isEmpty(i)||(e.doNotRedrawPacksFrames&&(i.doNotRedrawPacksFrames=!0),e.doNotRedrawBottomShiftLine&&(i.doNotRedrawBottomShiftLine=!0),this.css(i)),(l||e.undo||e.redo)&&this.recalcFixedLine(),(t.get("sticked")||r.a.has(o,"sticked"))&&(this.recalcStickedLine(),(o.x||o.y)&&!r.a.has(o,"sticked")&&this.workspace.page.getPreviousViewport()===this.workspace.page.getCurrentViewport())){var u=this.getBoxData().sticked_margin;u&&!isNaN(u)&&this.model.get("sticked_margin")!=u&&this.model.set({sticked_margin:u},{first:!0})}e.skipTriggerRedraw||e.forceRedraw||this.triggerRedraw()},showPanel:function(){this.workspace.controls.selectFirst()},hidePanel:function(){this.panel&&this.panel.hide()},inArea:function(t){if(!this.model.get("hidden")){var e=this.model.get("fixed_position"),i=this.getBoxData({includeBoundingBox:!0,includeRotationData:!0,checkFixedPosition:!0});e&&(i.bb_y+=this.workspace.$container.scrollTop());var s=Math.max(t.x,i.bb_x)<Math.min(t.x+t.w,i.bb_x+i.bb_w)&&Math.max(t.y,i.bb_y)<Math.min(t.y+t.h,i.bb_y+i.bb_h);if(s&&i.angle){var o;e&&(o={top:i.y+this.workspace.$container.scrollTop(),left:i.x,width:i.w,height:i.h,sinAngle:this.latestPosSizeAngle.sinAngle,cosAngle:this.latestPosSizeAngle.cosAngle});var n=b.a.calcRotatedBox(o||this.latestPosSizeAngle);s=b.a.isConvexPolygonsIntersects(n,[{x:t.x,y:t.y},{x:t.x+t.w,y:t.y},{x:t.x+t.w,y:t.y+t.h},{x:t.x,y:t.y+t.h}])}return s}},contains:function(t){if(!this.model.get("hidden")){var e=this.getBoxData({includeBoundingBox:!0,includeRotationData:!0}),i=e.bb_x<t.x&&e.bb_x+e.bb_w>t.x&&e.bb_y<t.y&&e.bb_y+e.bb_h>t.y;if(i&&e.angle){var s=b.a.calcRotatedBox(this.latestPosSizeAngle);i=b.a.isConvexPolygonContainsPoint(s,t)}return i}},showIconLoader:function(){this.isLoading=!0},hideIconLoader:function(){this.isLoading=!1},onBlockVisibilityChange:function(t){var e=!!t.get("hidden");this.$el.toggleClass("invisible",e),e&&(this.triggerRedraw(),this.cutFromSelection())},storeFixedPosition:function(){if(this.model.get("fixed_position")&&"pack"!==this.model.get("type")){this.restoreFixed=this.model.get("fixed_position");var t=RM.constructorRouter.zoom.getZoom(),e=this.getBoxData({checkFixedPosition:!0});e.y=e.y+this.workspace.$container.scrollTop()/t,e.x=e.x+this.workspace.$container.scrollLeft()/t,this.model.set(r.a.extend(e,{fixed_position:""}),{skipHistory:!0})}},restoreFixedPosition:function(){if(this.restoreFixed){var t=this.getBoxData(),e=this.$el.offset(),i="default"!=this.model.getViewport()?this.workspace.position.left:0,o="default"!=this.model.getViewport()?this.workspace.position.top:0,n=RM.constructorRouter.zoom.getZoom(),a={x:(this.restoreFixed.indexOf("e")>-1?Object(s.a)(window).width()/n-e.left-t.w:e.left)-i,y:(this.restoreFixed.indexOf("s")>-1?Object(s.a)(window).height()/n-e.top-t.h:e.top)-o,w:t.w,h:t.h,fixed_position:this.restoreFixed};["n","c","s"].indexOf(this.restoreFixed)>-1&&(a.x-=Object(s.a)("#main").width()/2/n-t.w/2-i),["e","c","w"].indexOf(this.restoreFixed)>-1&&(a.y-=Object(s.a)("#main").height()/2/n-t.h/2-o),this.model.set(a,{skipHistory:!0}),delete this.restoreFixed}},resetFullWidth:function(){this.model.get("is_full_width")&&this.model.set({is_full_width:!1,x:this.model.get("full_width_initial_x")||this.model.get("x"),w:this.model.get("full_width_initial_w")||this.model.get("w")})},resetFullHeight:function(){this.model.get("is_full_height")&&this.model.set({is_full_height:!1,y:this.model.get("full_height_initial_y")||this.model.get("y"),h:this.model.get("full_height_initial_h")||this.model.get("h")})},onFixPosition:function(t,e,i){Object(C.a)("constructor.zIndex")?this.css({"z-index":RM.constructorRouter.indexController.getZIndex(this.model.id,this.workspace.page.id,this.workspace.page.getCurrentViewport()),width:this.model.get("w"),height:this.model.get("h"),top:this.model.get("y"),left:this.model.get("x"),"margin-left":0,"margin-top":0}):this.css({"z-index":this.model.get("z"),width:this.model.get("w"),height:this.model.get("h"),top:this.model.get("y"),left:this.model.get("x"),"margin-left":0,"margin-top":0}),i&&(i.redo||i.undo)&&!r.a.isEmpty(this.workspace.getSelectedBlocks())&&this.workspace.trigger("select",this.workspace.getSelectedBlocks()),this.checkRetargetScroll(),this.recalcFixedLine()},onAnimationTriggerAdd:function(){this.resetAnimationTriggers()},onAnimationTriggerRemove:function(t){this.resetAnimationTriggers()},resetAnimationTriggers:function(){this.teardownAnimationTriggers(),window.requestAnimationFrame(this.setupAnimationTriggers.bind(this))},checkRetargetScroll:function(){this.retargetScroll&&this.retargetScroll.restore&&this.retargetScroll.restore(),this.model.get("fixed_position")&&(this.retargetScroll=Object(y.a)(this.$el.get(0),this.workspace.$container.get(0)))},onWorkspaceBlocksSelect:function(t){this.isStandalone||(t&&1==t.length&&t[0]==this?(this.frame&&!this.frame.isFrameVisible()&&this.frame.show(),this.toggleInPackClass(!1)):(this.frame&&this.frame.removeRotationState(),this.toggleInPackClass(!0)))},isRealChangeByMe:function(t){return!((t=t||{}).socketUpdate||this.workspace!=RM.constructorRouter.workspace||!RM.constructorRouter.workspace.page||!RM.constructorRouter.isPageLockedByMe(RM.constructorRouter.workspace.page.get("_id")))},toggleAnimationMode:function(t){this.$el.toggleClass("animation-mode",!!t),this.animationMode=!!t,this.model.get("pack_id")&&(this.isPackFrameHidden=t,this.workspace.redrawPacksFrames({tp:"animation-mode"})),this.workspace.redrawBottomShiftLine({tp:"animation-mode"}),this.trigger("animationMode",t)},getStickedSide:function(){var t=this.model.get("sticked");if(t)return"default"!==this.model.getViewport()&&"bottom"!==t&&(this.model.set("sticked",void 0),t=void 0),t},checkDisabledControls:function(t,e){return[]},destroy:function(){this.frame&&this.frame.removeRotationState(),this.frame&&this.frame.destroy(),this.workspace.off("select",this.onWorkspaceBlocksSelect),this.destroyed=!0,this.cutFromSelection(),this.$el.empty().remove(),this.stopListening(this.model,"change"),this.model.isGlobal&&!this.model.isGlobal()&&this.triggerRedraw(),this.rendered=!1,this.workspace.off("deselect",this.deselect),this.model.off("change",this.onModelChange),this.model.off("change:pack_id",this.onPackChange),this.model.off("change:is_locked",this.updateLockDragState),this.model.off("change:fixed_position",this.onFixPosition),this.model.off("change:hidden",this.onBlockVisibilityChange),Object(C.a)("constructor.zIndex")&&(x.a.off("index:changed",this.onIndexChange),this.workspace.page.off("change:viewport",this.onIndexChange)),this.stopListening(this.model,"animation:trigger:add"),this.stopListening(this.model,"animation:trigger:remove"),this.stopListening(this.model,"animation:type:change"),this.workspace.off("workspace-resize",this.onWorkspaceResize),this.$el.off(),this.panel&&(this.panel.destroy(),delete this.panel),this.trigger("destroy")}},{getViewportDefaults:function(t,e,i){i=i||{};var s,o=w.c.getViewportSetting("width","default"),n=w.c.getViewportSetting("width",e),a=Math.round((n-o)/2),r=t.get("is_full_width")&&"default"!==e,l=t.get("is_full_height")&&"default"!==e,c=t.get("fixed_position");return s={x:t.get("x"),y:t.get("y")},(i.clone||i.copy)&&(a=0),t.getAnimations()&&"default"!==e&&!Object(C.a)("constructor.mobileAnimation")&&(s.animation=void 0),c?(s.x=s.x-RM.constructorRouter.workspace.position.left,s.y=s.y-RM.constructorRouter.workspace.position.top,["n","c","s"].indexOf(i.fixed||c)>-1&&delete s.x,["w","c","e"].indexOf(i.fixed||c)>-1&&delete s.y):s.x=s.x+a,r&&(s.is_full_width=!1,s.w=t.get("full_width_initial_w")||t.get("w"),c||(s.x=(t.get("full_width_initial_x")||t.get("x"))+a)),l&&(s.is_full_height=!1,s.h=t.get("full_height_initial_h")||t.get("h"),c||(s.y=t.get("full_height_initial_y")||t.get("y"))),s}});T.prototype.template=h.a["template-constructor-block"],RM.vue=RM.vue||{},RM.vue.Sizes=o.a.extend(f);e.a=T},qOkM:function(module,exports){module.exports={"template-constructor-control-text_styles":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Styles" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\n\t\t<div class="common-wrapper">\n\n\t\t\t<div class="edit-scroll-wrapper">\n\t\t\t\t<div class="edit-content-wrapper">\n\t\t\t\t\t<div class="edit-content">\n\n\t\t\t\t\t\t<div class="edit-item">\n\t\t\t\t\t\t\t<input class="caption" spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item font-family-click-area">\n\t\t\t\t\t\t\t<div class="font-family"></div>\n\t\t\t\t\t\t\t<div class="popup-arrow"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item font-style-click-area">\n\t\t\t\t\t\t\t<div class="font-style"></div>\n\t\t\t\t\t\t\t<div class="popup-arrow"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item color-click-area">\n\t\t\t\t\t\t\t<div class="color-value"></div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item ">\n\t\t\t\t\t\t\t<input class="font-size" data-param="font-size" spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t\t<div class="font-size-icon" title="Font Size"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item">\n\t\t\t\t\t\t\t<input class="line-height" data-param="line-height" spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t\t<div class="line-height-icon" title="Line Height"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item">\n\t\t\t\t\t\t\t<input class="letter-spacing" data-param="letter-spacing" spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t\t<div class="letter-spacing-icon" title="Tracking"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item">\n\t\t\t\t\t\t\t<div class="text-align-left switcher" title="Left Align" data-param="text-align" data-val="left"></div>\n\t\t\t\t\t\t\t<div class="text-align-center switcher" title="Center" data-param="text-align" data-val="center"></div>\n\t\t\t\t\t\t\t<div class="text-align-right switcher" title="Right Align" data-param="text-align" data-val="right"></div>\n\t\t\t\t\t\t\t<div class="text-align-justify switcher" title="Justify" data-param="text-align" data-val="justify"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item">\n\t\t\t\t\t\t\t<div class="text-transform switcher" title="All Caps" data-param="text-transform" data-val="uppercase"></div>\n\t\t\t\t\t\t\t<div class="text-underline switcher" title="Underline" data-param="text-decoration" data-val="underline"></div>\n\t\t\t\t\t\t\t<div class="text-strike switcher" title="Strike" data-param="text-decoration" data-val="line-through"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item paddings">\n\t\t\t\t\t\t\t<div class="padding-icon"></div>\n\t\t\t\t\t\t\t<input class="padding-left" title="Left Margin" data-param="padding-left" spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t\t<input class="padding-right" title="Right Margin" data-param="padding-right" spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t\t<input class="padding-top" title="Top Margin" data-param="padding-top" spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t\t<input class="padding-bottom" title="Bottom Margin" data-param="padding-bottom" spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="tag-changer">\n\t\t\t\t\t\t\t&lt;<span>p</span>&gt; tag\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="edit-scroll"></div>\n\t\t\t</div>\n\n\n\t\t\t<div class="resizable-scroll-wrapper">\n\t\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t\t<div class="resizable-content">\n\t\t\t\t\t\t<div class="paragraph-style" data-id="paragraph-none">\n\t\t\t\t\t\t\t<div class="style-caption paragraph-none">None</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="styles-wrapper"></div>\n\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="resizable-scroll"></div>\n\t\t\t</div>\n\n\t\t</div>\n\n\n\n\t\t<div class="resize-handle-top"></div>\n\t\t<div class="resize-handle-bottom"></div>\n\n\t\t<div class="add-block">\n\t\t\t<div class="add" title="Create Style from Selection"></div>\n\t\t\t<div class="save">Save</div>\n\t\t\t<div class="cancel" title="Cancel Changes"></div>\n\t\t</div>\n\n\n\t\t<div class="colorbox_container"></div>\n\n\t\t<div class="fontselector_container"></div>\n\n\t\t<div class="fontstyle_container">\n\t\t\t<div class="font-style-wrapper">\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="style-menu transition-enable">\n\t\t\t<div class="top-block">\n\t\t\t\t<div class="redefine-button">Redefine Style</div>\n\t\t\t\t<div class="text-block">from selection</div>\n\t\t\t\t<div class="revert-block"><div class="revert-button">Revert</div> to original</div>\n\t\t\t</div>\n\n\t\t\t<div class="separator top-separator"></div>\n\t\t\t<div class="edit-button">Edit Style</div>\n\t\t\t<div class="separator"></div>\n\t\t\t<div class="duplicate-button">Duplicate</div>\n\t\t\t<div class="separator separator-delete"></div>\n\t\t\t<div class="delete-button">Delete</div>\n\n\t        <div class="corner-wrapper">\n\t            <div class="corner"></div>\n\t        </div>\n\t\t</div>\n\t</div>\n';return __p},"template-constructor-control-text_styles-style":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="\n\t";var currentTag="undefined"!=typeof tag?tag:"p";__p+='\n\t<div class="paragraph-style" data-id="'+(null==(__t=_name)?"":_.escape(__t))+'" data-tag="'+(null==(__t=currentTag)?"":_.escape(__t))+'">\n\t\t<div class="style-caption '+(null==(__t=_name)?"":_.escape(__t))+'">'+(null==(__t=_caption)?"":_.escape(__t))+'</div>\n\t\t<div class="tag-changer">'+(null==(__t=currentTag)?"":_.escape(__t))+'</div>\n\t\t<div class="menu-button"></div>\n\t</div>\n'}return __p}}},qfna:function(t,e,i){"use strict";var s=i("2fBX");i.n(s).a},rDYU:function(module,exports){module.exports={"template-constructor-block-slideshow":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<input class="uploadInput" type="file" name="upload" multiple="multiple" data-url="/api/upload/" />\n\t<div class="slideshow-overlay jsSlideshowOverlay"></div>\n\n\t<div class="drop-text"></div>\n\n';return __p}}},rH4x:function(t,e,i){},rVpV:function(t,e,i){"use strict";var s=i("rFsW"),o=i("roQd"),n=i("OTSC"),a=i("v92f"),r={GLOBAL_UNIQUE_KEYS:["hidden","z"],GLOBAL_UNIQUE_KEY_PREFIX:"_",FADE_DURATION:200,getUniqueValue:function(t,e,i){var o=e[this.GLOBAL_UNIQUE_KEY_PREFIX+t]||[],n=s.a.findWhere(o,{pid:i});return void 0===(n=n||s.a.findWhere(o,{pid:"default"})||{}).value?e[t]:n.value},resetGlobalData:function(t,e){var i=this;return s.a.each(a.b.viewport_listall,(function(o){s.a.each(i.GLOBAL_UNIQUE_KEYS,(function(n){o==="viewport_"+e?t.set(i.GLOBAL_UNIQUE_KEY_PREFIX+n,[]):s.a.isEmpty(t[o])||(t[o][i.GLOBAL_UNIQUE_KEY_PREFIX+n]=[])}))})),{}},isGlobalKey:function(t){return-1!==this.GLOBAL_UNIQUE_KEYS.indexOf(t)},getGlobalPrefixedKey:function(t){return this.isGlobalKey(t)?this.GLOBAL_UNIQUE_KEY_PREFIX+t:null},fillUniqueAttributeSets:function(t,e,i){var o={};return e.is_global?(Object(s.a)(this.GLOBAL_UNIQUE_KEYS).each(function(n){if(s.a.has(t,n)&&void 0!==t[n]){var a=e[this.GLOBAL_UNIQUE_KEY_PREFIX+n]||[],r=s.a.findWhere(a,{pid:i}),l=s.a.findWhere(a,{pid:"default"});r?r.value=t[n]:a.push({pid:i,value:t[n]}),l||a.push({pid:"default",value:void 0===e[n]?null:e[n]}),o[this.GLOBAL_UNIQUE_KEY_PREFIX+n]=a}}.bind(this)),o):t},ensurePageDefRecord:function(t){Object(s.a)(this.GLOBAL_UNIQUE_KEYS).each(function(e){var i=t[this.GLOBAL_UNIQUE_KEY_PREFIX+e]||[];s.a.findWhere(i,{pid:"default"})||i.push({pid:"default",value:void 0===t[e]?null:t[e]}),t[this.GLOBAL_UNIQUE_KEY_PREFIX+e]=i}.bind(this))},fillUniqueValues:function(t,e,i){i=i||{},s.a.each(t,(function(o,n){if(s.a.contains(this.GLOBAL_UNIQUE_KEYS,n)&&(!i.props||s.a.contains(i.props,n))){var a=this.getUniqueValue(n,t,e);t[n]=void 0===a?o:a}}),this)},isHidden:function(t,e,i){return this.getUniqueValue("hidden",t,e)||!i&&o.a.hasExpired(t)},show:function(t,e){e=Boolean(e),t.$el.toggleClass("no-transition",e),t.$el.addClass("above-all-fade"),t.$el.hasClass("fade-in")&&!e||(t.cancelHide&&t.cancelHide(),t.show(),s.a.delay((function(){t.$el.addClass("fade-in")}),50))},hide:function(t,e){return e=Boolean(e),t.$el.addClass("above-all-fade"),new window.Promise((function(i){t.$el.hasClass("fade-in")||e?(t.$el.toggleClass("no-transition",e),t.$el.removeClass("fade-in"),e?(t.hide(),i()):t.cancelHide=n.b.waitForTransitionEnd(t.$el,r.FADE_DURATION,"opacity",(function(){t.hide(),i()}))):i()}))}};e.a=r},rgKy:function(module,exports){module.exports={"template-constructor-helpers-upload-input":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<input class="rm-upload-input"\n\t       type="file"\n\t       name="upload"\n\t       data-url="/api/upload/" />\n\n';return __p}}},roQd:function(t,e,i){"use strict";var s=i("xi34"),o=i("q1z7"),n=i.n(o),a=i("rFsW"),r=i("gobI"),l=i("OTSC"),c=i("QNiq"),h=i("Kf/z");function d(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var p={LOOP_TYPES:{swing:"swing",repeat:"repeat"},EVENT_TYPES:["load","scroll","hover","click"],POINTER_EVENTS:["click","hover"],EXTERNAL_TRIGGER_BLOCK_EXCLUDE:["facebook","twitter","form","gmaps","slideshow","audio","video"],ANIMATION_BLOCK_EXCLUDE:["facebook","twitter"],POINTER_EVENTS_BLOCK_EXCLUDE:["form","gmaps","slideshow","audio","video"],DEFAULT_LOOP_TYPE:"swing",ACTIVE_TRIGGER_CLASS:"active-trigger",ACTIVE_TRIGGER_REMOVE_CLASS:"active-trigger-remove",ACTIVE_TRIGGER_HIGHLIGHT_CLASS:"active-trigger-highlight",ANIMATIONS_PLAYED_STORAGE_KEY:"animationsPlayed",DEG_TO_RAD:Math.PI/180,ANIMATION_PROPERTIES:function(){var t=!1,e="animation",i="AnimationIteration",s="AnimationEnd",o="animation-timing-function",n="@keyframes",a="transform",r="transform",l="Webkit Moz O ms Khtml".split(" "),c="webkit moz o MS html".split(" "),h=document.createElement("div");if(null!=h.style.animationName)t=!0,i=i.toLowerCase(),s=s.toLowerCase();else for(var d=0;d<l.length;d++)if(null!=h.style[l[d]+"AnimationName"]){e=l[d]+"Animation",i=c[d]+i,s=c[d]+s,o="-"+l[d].toLowerCase()+"-"+o,n="@-"+l[d].toLowerCase()+"-keyframes",t=!0;break}if(null==h.style.transform)for(d=0;d<l.length;d++)if(null!=h.style[l[d]+"Transform"]){a=l[d]+"Transform",r="-"+l[d].toLowerCase()+"-transform";break}return h=null,{animationSupported:t,animationJS:e,animationIterationJS:i,animationEndJS:s,animationTimingFunctionCSS:o,keyframeCSS:n,transformJS:a,transformCSS:r}}(),createAnimationTimeline:function(t){return new m(t)},getNormalizedAnimation:function(t,e,i,s,o){var n={dx:0,dy:0,from_opacity:100,opacity:100,from_rotate:0,rotate:0,from_scale:100,scale:100},l={use_move:["dx","dy"],use_opacity:["from_opacity","opacity"],use_rotate:["from_rotate","rotate"],use_scale:["from_scale","scale"]},c=a.a.extend({},t);"scroll"==c.type&&(c.loop=!1),c.steps=[];for(var h={dx:0,dy:0},d=0;d<t.steps.length;d++){var p=a.a.extend({},t.steps[d]);a.a.each(l,a.a.bind((function(t,e){p[e]?(n[t[0]]=p[t[0]],n[t[1]]=p[t[1]]):(p[t[0]]=n[t[0]],p[t[1]]=n[t[1]])}),this)),i&&(p.dx=0,p.rotate=0,p.from_rotate=0),s&&(p.dy=0,p.rotate=0,p.from_rotate=0),"scroll"!=c.type||e||0!=d||(p.delay_px=0),1!=o&&e&&(p.dx*=o,p.dy*=o),"scroll"==c.type?(p.calcedDuration=u(p,h),p.calcedDelay=p.delay_px?p.delay_px*r.a.normalize(o):0):(p.calcedDuration=p.duration||.001,p.calcedDelay=p.delay||0),p.acceleration=p.acceleration||"none",c.steps.push(p),h=p}return c.trigger=t.trigger&&!a.a.isArray(t.trigger)?[t.trigger]:a.a.clone(t.trigger)||[],c;function u(t,e){var i,s=t.dx-e.dx,o=t.dy-e.dy;return i=0!=s||0!=o?Math.pow(s*s+o*o,.5)/t.speed:300/t.speed,Math.ceil(i)}},normalizeLoopValue:function(t){return!!t&&(this.LOOP_TYPES[t]||this.DEFAULT_LOOP_TYPE)},isExternalTriggerAllowed:function(t){return this.isPointerEvent(t)},normalizeAnimationTriggers:function(t){return t&&!a.a.isArray(t)?[t]:a.a.clone(t)||[]},normalizeAnimations:function(t){var e=t&&!a.a.isArray(t)?[t]:t||[];return Object(h.a)("constructor.multipleAnimations")?e:e.length?[e[0]]:e},isEmpty:function(t){return!(t&&t.type&&"none"!==t.type&&t.steps&&t.steps.length)},getUuidHash:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.map((function(t){return t.UUID||"none"})).sort().join(",")||"none"},isPointerEvent:function(t){return-1!==this.POINTER_EVENTS.indexOf(t)},canBeExternalTrigger:function(t,e){var i=t.attributes||t.model&&t.model.attributes||{},s=e.attributes||e.model&&e.model.attributes||{},o=i.type&&-1===this.EXTERNAL_TRIGGER_BLOCK_EXCLUDE.indexOf(i.type),n=e&&s.is_above&&i.is_global&&!i.is_above;return o&&!n},canHaveAnimation:function(t){var e=t.attributes||t.model&&t.model.attributes||{};return e.type&&-1===this.ANIMATION_BLOCK_EXCLUDE.indexOf(e.type)},arePointerEventsAllowed:function(t){var e=t.attributes||t.model&&t.model.attributes||{};return e.type&&-1===this.POINTER_EVENTS_BLOCK_EXCLUDE.indexOf(e.type)},getBlocksContainingTriggers:function(t){var e=a.a.map(t,(function(t){return t.id||t._id}));return a.a.reduce(t,function(t,i){var s=this.normalizeAnimations(i.model?i.model.get("animation"):i.animation).reduce((function(t,e){return e.trigger?[].concat(d(t),d(p.normalizeAnimationTriggers(e&&e.trigger))):t}),[]);return s.length&&a.a.intersection(e,s).length&&t.push(i.id?i.id:i._id),t}.bind(this),[])},restoreTriggers:function(t,e,i){var s=[];return a.a.each(t,function(t){var o=this,n=e[t],r=a.a.find(i,{id:n});r&&r.getAllAnimationTriggers().length&&(s.push(r),r.model.getAnimations().forEach((function(t){var i=o.normalizeAnimationTriggers(t&&t.trigger);t.trigger=i.reduce((function(t,i){var s=e[i];return s?[].concat(d(t),[s]):t}),[])})))}.bind(this)),s},isScaleUp:function(t){return Boolean(a.a.find(t&&t.steps,(function(t,e){return t.use_scale&&(0===e&&t.from_scale>100||t.scale>100)})))},maxScaleAnimation:function(t){return t&&t.steps&&t.steps.length?t.steps.reduce((function(t,e){return Math.max(t,e.from_scale||0,e.scale||0)}),0):0},canBeAccelerated:function(t){return!c.a.isDesktop||!this.isScaleUp(t)},getPermanentAnimationId:function(t,e){return t.fixed_position||t.is_full_width||t.is_full_height||t.sticked?t._id:e},getAnimationsPlayed:function(){if(a.a.isUndefined(this._animationsPlayed))try{var t=Modernizr.localstorage?window.localStorage.getItem(this.ANIMATIONS_PLAYED_STORAGE_KEY):l.b.getCookie(this.ANIMATIONS_PLAYED_STORAGE_KEY),e=t&&JSON.parse(t);this._animationsPlayed=a.a.isArray(e)?e:[]}catch(t){this._animationsPlayed=[]}return this._animationsPlayed},persistHasPlayed:function(t){if(!this.hasPlayed(t))try{var e=JSON.stringify([].concat(this.getAnimationsPlayed(),t));Modernizr.localstorage?window.localStorage.setItem(this.ANIMATIONS_PLAYED_STORAGE_KEY,e):l.b.createCookie(this.ANIMATIONS_PLAYED_STORAGE_KEY,e),delete this._animationsPlayed}catch(t){}},hasPlayed:function(t){return t&&-1!==this.getAnimationsPlayed().indexOf(t)},hasExpired:function(t){var e=this,i=this.normalizeAnimations(t.animation);return Boolean(i.length)&&i.every((function(i){var s=e.getPermanentAnimationId(t,i.UUID);return i.playOnce&&e.hasPlayed(s)}))}},u=0,g=p.ANIMATION_PROPERTIES,m=n.a.View.extend({initialize:function(t){if(a.a.bindAll(this),a.a.extend(this,t),g.animationSupported){this.active=!1,this.reversed=!1,this.animationLength=0,this.hasRotation=!1;for(var e=0;e<this.steps.length;e++){var i=this.steps[e];this.animationLength+=i.calcedDelay+i.calcedDuration,i.use_rotate&&(0==e&&0!=i.from_rotate||0!=i.rotate)&&(this.hasRotation=!0)}this.$el.toggleClass("force3d",!!this.force3d),"scroll"!=this.type?this.generateNormalAnimation():this.generateFramesAnimation()}},generateNormalAnimation:function(){for(var t=this,e=0,i=[[0]],s=this,o=this.steps.length,n=0;n<o;n++){var r=this.steps[n].calcedDelay/this.animationLength,l=this.steps[n].calcedDuration/this.animationLength;r>=1e-4?i[i.length-1].push(e+r):r=0,e+=r+l,n==o-1&&(e=1),i.push([e])}u++,this.id=u;var c=g.keyframeCSS+" animation_"+this.id+" {\n",h={none:"linear","ease-in":"ease-in","ease-out":"ease-out","ease-both":"ease-in-out"};c+=d(i[0],{dx:0,dy:0,opacity:this.steps[0].from_opacity,rotate:this.steps[0].from_rotate,scale:this.steps[0].from_scale},h[this.steps[0].acceleration]);for(n=0;n<o;n++)c+=d(i[n+1],this.steps[n],this.steps[n+1]?h[this.steps[n+1].acceleration]:void 0);function d(t,e,i){var o="\t";return o+=a.a.map(t,(function(t){return 100*t+"%"})).join(", ")+" {",o+=g.transformCSS+": "+s.getTransformString(e.dx,e.dy,e.rotate,e.scale/100)+"; ",o+="opacity: "+(0==e.opacity?0:e.opacity/100)+"; ",i&&(o+=g.animationTimingFunctionCSS+": "+i),o+="}\n"}c+="}\n",this.keyframesStyle=document.createElement("style"),this.keyframesStyle.innerHTML=c,this.$el.append(this.keyframesStyle),this.$el.on(g.animationIterationJS,(function(e){e.stopPropagation();var i=t.$el[0].style["".concat(g.animationJS,"Name")].replace("animation_","");parseInt(i,10)===t.id&&t.onAnimationIteration(e)})),this.$el.on(g.animationEndJS,(function(e){e.stopPropagation();var i=t.$el[0].style["".concat(g.animationJS,"Name")].replace("animation_","");parseInt(i,10)===t.id&&t.onAnimationEnd(e)})),this.applyStepState(this.screenshotMode&&"load"==this.type?o-1:"initial")},generateFramesAnimation:function(){var t=0,e={dx:0,dy:0,opacity:this.steps[0].from_opacity,rotate:this.steps[0].from_rotate,scale:this.steps[0].from_scale};this.frames=[],this.frames.push({ind:0,isDelay:!1,params:e});for(var i=0;i<this.steps.length;i++){var s=this.steps[i];s.calcedDelay&&(this.frames.push({ind:t+1,isDelay:!0,params:e}),t+=s.calcedDelay),e={dx:s.dx,dy:s.dy,opacity:s.opacity,rotate:s.rotate,scale:s.scale,acceleration:s.acceleration},this.frames.push({ind:t+1,isDelay:!1,params:e}),t+=s.calcedDuration}this.seek(0)},getTransformString:function(t,e,i,s){var o;if(s<.001&&(s=.001),this.hasRotation&&"scroll"!=this.type)o=this.force3d?"translate3d("+t+"px,"+e+"px,0) rotate("+i+"deg) scale("+s+")":"translate("+t+"px,"+e+"px) rotate("+i+"deg) scale("+s+")";else{var n=s,a=0;i&&(i*=p.DEG_TO_RAD,n=Math.cos(i)*s,a=Math.sin(i)*s),n=Math.abs(n)<1e-6?0:n,a=Math.abs(a)<1e-6?0:a,Modernizr.edge&&(e*=r.a.getMag().getScale(r.a.getMag().viewport));var l=n+","+a,c=-a+","+n,h=t+","+e;o=this.force3d?"matrix3d("+l+",0,0,"+c+",0,0,0,0,1,0,"+h+",0,1)":"matrix("+l+","+c+","+h+")"}return o},applyStepState:function(t){var e;if(this.$el.removeClass("invisible"),"initial"==t)this.$el[0].style[g.transformJS]=this.getTransformString(0,0,this.steps[0].from_rotate,this.steps[0].from_scale/100),e=this.steps[0].from_opacity,this.$el[0].style.opacity=0==e?0:e/100;else{var i=this.steps[t];this.$el[0].style[g.transformJS]=this.getTransformString(i.dx,i.dy,i.rotate,i.scale/100),e=i.opacity,this.$el[0].style.opacity=0==e?0:e/100}var s="hover"===this.type&&this.animationTrigger.length>0&&!this.selfTriggered,o="hover"!==this.type&&("initial"!==t||this.animationTrigger.length>0);0===e&&(s||o)&&this.$el.addClass("invisible")},play:function(){if(!this.screenshotMode&&g.animationSupported){var t=g.animationJS;this.stop(),this.$el.removeClass("invisible"),this.$el.outerHeight(),window.requestAnimationFrame(function(){this.$el[0].style[t+"Name"]="animation_"+this.id,this.$el[0].style[t+"Duration"]=this.animationLength+"s",this.$el[0].style[t+"IterationCount"]=this.loop?"infinite":1,this.$el[0].style[t+"Direction"]=this.loop===p.LOOP_TYPES.repeat?"normal":"alternate",this.$el[0].style[t+"FillMode"]="both",this.$el[0].style[t+"PlayState"]=""}.bind(this)),this.active=!0,this.reversed=!1}},reverse:function(){if(!this.screenshotMode&&g.animationSupported){var t=g.animationJS;this.stop(),this.$el.removeClass("invisible"),this.$el.outerHeight(),this.$el[0].style[t+"Name"]="animation_"+this.id,this.$el[0].style[t+"Duration"]=this.animationLength+"s",this.$el[0].style[t+"IterationCount"]=this.loop?"infinite":1,this.$el[0].style[t+"Direction"]=this.loop===p.LOOP_TYPES.repeat?"reverse":"alternate-reverse",this.$el[0].style[t+"FillMode"]="both",this.$el[0].style[t+"PlayState"]="",this.active=!0,this.reversed=!0}},stop:function(){this.$el.removeClass("invisible"),this.$el[0].style[g.animationJS]="",this.active=!1,this.reversed=!1},onAnimationEnd:function(){this.reversed=!this.reversed,this.active=!1,this.$el[0].style[g.animationJS]="",this.applyStepState(this.reversed?this.steps.length-1:"initial"),this.trigger("full-cycle-end")},onAnimationIteration:function(t){this.loop===p.LOOP_TYPES.swing?Math.round(t.originalEvent.elapsedTime/this.animationLength)%2?this.reversed=!0:(this.reversed=!1,this.trigger("full-cycle-end")):this.trigger("full-cycle-end")},resume:function(){this.screenshotMode||g.animationSupported&&(c.a.isDesktop?this.$el[0].style[g.animationJS+"PlayState"]="running":this.play(),this.active=!0)},pause:function(){g.animationSupported&&(c.a.isDesktop?this.$el[0].style[g.animationJS+"PlayState"]="paused":this.stop(),this.active=!1)},seek:function(t,e,i,s){if(g.animationSupported){t=Math.max(Math.min(t,this.animationLength),0);var o,n,a,r,l=this.frames.length;for(o=0;o<l&&!(this.frames[o].ind>t);o++);o--,this.frames[o].isDelay?n=p(this.frames[o].params,this.frames[o].params,0,1):(a=o?this.frames[o].ind-1:0,r=o==l-1?this.animationLength:this.frames[o+1].ind-1,n=p(this.frames[o?o-1:0].params,this.frames[o].params,t-a,r-a+1));var c=Object(h.a)("viewer.fixOnScrollSpeed1")&&!Modernizr.isdesktop&&s>=1&&void 0!==e&&void 0!==i&&o>0&&1===this.steps[o-1].speed&&this.steps[o-1].use_move&&this.frames[o].params.dy&&!this.frames[o].params.dx&&n.dy<this.frames[o].params.dy,d=c?e-t+n.dy+"px":i+"px";this.$el[0].style.position=c?"fixed":"",this.$el[0].style.top=d,this.$el[0].style[g.transformJS]=this.getTransformString(n.dx,c?0:n.dy,n.rotate,n.scale/100),this.$el[0].style.opacity=0==n.opacity?0:n.opacity/100,this.$el.toggleClass("invisible",0==n.opacity)}function p(t,e,i,s){if(0==i)return t;if(i==s-1)return e;var o=i/(s-1);return{dx:t.dx==e.dx?t.dx:u(t.dx,e.dx,o,e.acceleration),dy:t.dy==e.dy?t.dy:u(t.dy,e.dy,o,e.acceleration),opacity:t.opacity==e.opacity?t.opacity:u(t.opacity,e.opacity,o,e.acceleration),rotate:t.rotate==e.rotate?t.rotate:u(t.rotate,e.rotate,o,e.acceleration),scale:t.scale==e.scale?t.scale:u(t.scale,e.scale,o,e.acceleration)}}function u(t,e,i,s){return t+(e-t)*(s&&"none"!=s?"ease-in"==s?i*i:"ease-out"==s?i*(2-i):i<.5?i*i*2:2*i*(2-i)-1:i)}},destroy:function(){this.$el.off(g.animationIterationJS,this.onAnimationIteration),this.$el.off(g.animationEndJS,this.onAnimationEnd),this.$el[0].style[g.animationJS]="",this.$el[0].style[g.transformJS]="",this.$el[0].style.opacity="",this.$el.removeClass("force3d"),this.keyframesStyle&&Object(s.a)(this.keyframesStyle).remove(),this.reversed=!1,this.active=!1}});e.a=p},rwzP:function(t,e,i){},s0L4:function(module,exports){module.exports={"template-constructor-control-hotspot-tip-settings":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="icon noarrow" data-alt="Tip Settings" data-alt-pos="left" data-alt-offset="9"></div>\n\n\n\t<div class="panel">\n\n\t\t<div class="common-wrapper">\n\n\t\t\t<div class="edit-wrapper default-state">\n\n\t\t\t\t<div class="params-wrapper clearfix">\n\n\t\t\t\t\t<div class="edit-item" data-field="tip_pos">\n\t\t\t\t\t\t<div class="caption">Position</div>\n\t\t\t\t\t\t<div class="positions">\n\t\t\t\t\t\t\t<div class="top position" data-position="top">\n\t\t\t\t\t\t\t\t<div class="fill"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="right position" data-position="right">\n\t\t\t\t\t\t\t\t<div class="fill"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="bottom position" data-position="bottom">\n\t\t\t\t\t\t\t\t<div class="fill"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="left position" data-position="left">\n\t\t\t\t\t\t\t\t<div class="fill"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\n\t\t\t\t\t<div class="edit-item separator color-click-area" data-field="tip_background-color" data-field-dop="tip_background-color-opacity">\n\t\t\t\t\t\t<div class="caption">Color</div>\n\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t</div>\n\n\n\t\t\t\t\t<div class="edit-item separator" data-field="tip_border-radius">\n\t\t\t\t\t\t<div class="caption">Radius</div>\n\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t</div>\n\n\n\t\t\t\t\t<div class="edit-item separator clearfix" data-field="tip_box-shadow">\n\t\t\t\t\t\t<div class="caption">Shadow</div>\n\t\t\t\t\t\t<div class="switcher"></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t</div>\n\n\n\t\t<div class="colorbox_container"></div>\n\n\t</div>\n\n';return __p}}},s1Hx:function(module,exports){module.exports={"template-constructor-control-text_color":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Color" data-alt-pos="left" data-alt-offset="9"><div class="opacity-grid"></div><div class="color-circle"></div></div>\n\n\t<div class="panel">\n\t</div>\n\n';return __p}}},secl:function(module,exports){module.exports={"template-viewer-page":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="page hidden">\n\t\t<div class="page-fixed-bg-container polyfill-sticky"></div>\n\t\t<div class="fixed-position-container-top polyfill-sticky"></div>\n\t\t<div class="fixed-position-container polyfill-sticky"></div>\n\t\t<div class="content-scroll-wrapper '+(null==(__t=isStickyVerticalViewer?"":"has-vertical-scroll")?"":__t)+'">\n\t\t\t<div class="content-bounds">\n\t\t\t\t<div class="page-content-container" tabindex="-1"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n';return __p}}},skB9:function(t,e,i){},sviH:function(t,e,i){"use strict";var s=i("xi34"),o=i("q1z7"),n=i.n(o),a=i("rFsW"),r=i("q7tt"),l=i("q5gH"),c=i("v92f"),h=i("DqjY"),d=i("OTSC"),p=i("onY4"),u=i("D12m"),g=i("5DNN"),m=i.n(g),f=i("7jD/"),v=i.n(f),b=i("RX7I"),_=["The follies of others are obvious, but our own hide from us; we love to parse others missteps but we cover up our own, as the cheat conceals the false die. It is in the nature of men to lay blame: we see others mistakes while our own passions swell, carrying us ever farther from improvement.  Buddhist wisdom","No one can long stand on tiptoe. He who thrusts himself forward is not a source of light. No glory comes to the self-satisfied, no honor to the boastful. The proud will not rise high. In the court of good sense, such people are like table discards, repellent to all. The sensible person does not rely on self.  Lao-Tzu","Simplicity in life, language and habits strengthens a nation, but a life of luxury, fancy language and effeminate habit leads to weakness and death.  John Ruskin","Truth is not a matter of talking but comes only through labor and observation. And when you have one truth in hand, two others, like the first leaves of a dicotyledonous plant, will probably appear.  John Ruskin","All things have a beginning and an end. So it is with mankind: there is a beginning and end to all  human affairs. He who understands what is a beginning and what is an end is closer to the truth.  Confucius","Most people are dismayed if deprived of their pleasures. The right course belongs to him who relishes even the passing away of the reason for his joy and is not bitter.  Pascal","When we are clear about things, we have knowledge; with knowledge, we seek the path of truth; when the search is rewarded, the heart becomes good; with the heart made good, the moral view of things that leads to virtue is attained.  Confucius","Wisdom has three faces: when seen from afar, it is grand and severe; on closer approach, it is tender and welcoming; when we are close enough to hear it, the words of  wisdom are severe and demanding.  Chinese wisdom","The sun constantly floods the world with its light, but its light is not exhausted; so your mind should send its light in all directions and not be exhausted. It should flow everywhere, without diminishment, and when it encounters an obstacle, it should react, not with annoyance or anger but should serenely clarify all that yearns to accept it, without any lessening or weariness, bringing light to all that is turned to it, leaving in shadow only that which turns its face away.  Marcus Aurelius","As torches and fireworks pale to invisibility in the sun, so the mind, even the mind of genius, and beauty pale and are eclipsed by the hearts goodness.  Schopenhauer","Music and sweet treats bring the wanderer to a stop, but wisdom has neither flavor nor smell. When looked for, it is invisible; when listened for, it is inaudible, yet its goodness is inexhaustible. The most powerful thing in the world cannot be seen, heard or touched.  Lao-Tzu","The best ideas are usually those that come without effort, out of the blue. The great intellectual creations come easily. Only a great person can create something great, and such a one works without strain.  John Ruskin","He who talks much rarely puts his words into action. But the wise person fears that his words may not be translated into action. The wise do not utter empty words, lest their actions be inconsistent with their words.  Chinese wisdom","Fear ignorance, but fear false knowledge even more. Turn your eyes from the deceptive world and do not trust your feelings, for they lie; rather look inward to the impersonal, eternal self. Truly, ignorance is like a sealed and airless chamber; in it, the soul sits like a caged bird, neither singing nor spreading its wings. But ignorance is better than any school of thought that is not guided by the wisdom of the soul.  Buddhist wisdom","Some seek their good or happiness in power; others in science, and others in the pleasures of the flesh. But those who come truly close to the good understand that it cannot consist in what can only be mastered by a few. They understand that the true good of humankind is that which can be achieved by all people, without division and without envy; its nature  is such that none can lose it if they do not so choose.  Pascal","The wise person asks only of himself; the unwise man demands everything from others.  Chinese wisdom","To know much and not to put ones self forward as knowing is the height of morality. To know little and put ones self forward as knowledgeable is an illness. Only by understanding the disease can one expunge it.  Lao-Tzu","Speak only of that which is as clear to you as the morning, or be silent.  Talmud","Conquer ferocity with love, evil with good, miserliness with generosity, the liar with truth.  Buddhist wisdom","People seek satisfaction, throwing themselves from one thing to another because they feel the emptiness of their lives but do not yet realize the emptiness of the new delight that attracts them.  Pascal","The skilled warrior does not rage. The skilled fighter is not angry. He who is skilled in the use of people is not provocative. This is the virtue of non-resistance. This is being in agreement with Heaven.  Lao-Tzu","The first and principal characteristic of a good and wise person is his consciousness that he knows very little, that many people know more and he seeks always to learn, to study, and not to teach. Those who wish to teach or direct neither teach nor lead well.  John Ruskin","The virtuous person seeks to follow the direct path to the end. What is to be feared is to go halfway and then to weaken.  Chinese wisdom"],w='<p style="line-height: 22px; padding: 16px 16px; text-align: center; font-family: Georgia; font-size: 16px;" data-size-leading-linked="false" data-size-leading-ratio="1.25"><span></span></p>',y=r.a.extend({name:"Text",thumb:"text",sort_index:1,icon_color:"#FFFFFF",controls:["text_edit","text_autosize","common_animation","common_rotation","common_position","common_layer","common_lock"],edit_controls:["text_styles","text_typography","text_bius","text_align","text_link","text_color","text_columns"],viewport_fields:c.b.viewport_fields.text,text_viewport_attributes:[],validElements:{"#span":["style","id","class","data-id","data-url","data-start","data-end","data-plays"],"#p":["style","class","data-size-leading-linked","data-size-leading-ratio"],br:[],a:["data-pid","data-uuid","style","class","href","target","data-anchor-link-pos"]},params:{multipleName:"multiple values",tabIndent:28,fontSizeLineHeightRatio:1.25,minFontSize:8,maxFontSize:999,minLineHeight:8,maxLineHeight:999,minLetterSpacing:-99,maxLetterSpacing:999},EDITOR_STYLES:'body {width: 100%;height: 100%;overflow: hidden;margin:0;padding:0;-webkit-margin-before: 0em;-webkit-margin-after: 0em;-webkit-margin-start: 0px;-webkit-margin-end: 0px;word-wrap: break-word;white-space: pre-wrap;background: transparent;-webkit-font-smoothing: antialiased;text-rendering: optimizeLegibility !important;-webkit-column-fill: auto !important;-moz-column-fill: auto !important;column-fill: auto !important;-webkit-nbsp-mode: normal}body.v1 {font-family: "Source Sans Pro";font-weight: 400;font-style: normal;font-size: 16px;line-height: 20px;}body.v2 {font-family: "Roboto";font-weight: 400;font-style: normal;font-size: 18px;line-height: 26px;}span.nbsp {position: relative;z-index: -1;}span.nbsp:before {content: "";position: absolute;color: #1cdeb4;font-size: .4em;font-weight: bold;left: 0;top: .7em;}h1, h2 {margin: 0;}p {color: #000000;margin: 0;padding: 0;-webkit-margin-before: 0em;-webkit-margin-after: 0em;-webkit-margin-start: 0px;-webkit-margin-end: 0px;}.margin-st, .margin-ed {margin: 0;padding: 0;-webkit-margin-before: 0em;-webkit-margin-after: 0em;-webkit-margin-start: 0px;-webkit-margin-end: 0px;height: 1px;}.margin-st {margin-bottom: -1px;}.margin-ed {margin-top: -1px;}a {color: inherit;text-decoration: underline;}a * {text-decoration: underline;}a, span {line-height: 1px !important;font-size: inherit !important;}span.soundcite {position: relative;padding: 0 0.2em 0 1.3em;display: inline;line-height: 120% !important;background: rgba(0, 0, 0, 0.1);}span.soundcite:before {content: "";position: absolute;top: 0.21em;left: 0.3em;border-width: 0.4em;border-style : solid;border-right-color: transparent;border-bottom-color: transparent;border-top-color: transparent;border-left-width : 0.6em;}',initialize:function(t,e){this.initBlock(t,e),this.frameClass=$,this.pid=e.page.id,this.page=e.page,this.inner_template=m.a["template-constructor-block-text"],this.setInitialParams(),this.changeStyleParagraph.__debounced=a.a.debounce(this.changeStyleParagraph,40),this.changeClassParagraph.__debounced=a.a.debounce(this.changeClassParagraph,40),this.changeStyleSpan.__debounced=a.a.debounce(this.changeStyleSpan,40),this.changeColumns.__debounced=a.a.debounce(this.changeColumns,40),this.changeLink.__debounced=a.a.debounce(this.changeLink,40),this.onChangeInEditor_throttle500=a.a.throttle(this.onChangeInEditor.bind(this),500),this.onChangeInEditor_throttle1500=a.a.throttle(this.onChangeInEditor.bind(this),1500),this.onChangeInEditor_throttle=function(){this.onChangeInEditor_throttle500(),this.onChangeInEditor_throttle1500()}.bind(this),this.recalcStyleDebounced=a.a.debounce(this.recalcStyle,50),this.model.on("change",this.onModelChange),RM.constructorRouter.on("font-added",this.onFontAdd),!this.model.isNested&&this.page.on("change:viewport",this.onViewportChange),this.has_parent_block&&(this.needSideMarginsSynhronized=!0,this.needClearMarginsOnEnter=!0,this.needPreserveLastPadding=!0,this.needIgnoreSlylesMargins=!0)},onFontAdd:function(){this.isEditorActive()&&h.a.appendFontsCssToIFrame(this.iframe_document)},switchTextToViewport:function(t,e){},switchTextToDefault:function(t){t=t||"";var e=this.model.isNested?"default":this.page.getCurrentViewport();if("default"==e)return t;var i=Object(s.a)("<div>").html(t),o=this.text_viewport_attributes,n=this;i.find("*").each((function(){var t=Object(s.a)(this);a.a.each(o,(function(i){var s=n.getViewportAttributeName(i,e),o=n.getViewportAttributeName(i,"default"),a=t.attr(o),r=t.attr(i);t.removeAttr(i),t.removeAttr(o),a&&t.attr(i,a),t.attr(s,r||"empty")}))}));var r=i.html();return i.empty().remove(),r},generateValidElementsList:function(){var t=a.a.pluck(c.b.viewports,"name"),e=this;return a.a.each(this.validElements,(function(i,s){var o=[];a.a.each(i,(function(i){a.a.indexOf(e.text_viewport_attributes,i)>=0&&Array.prototype.push.apply(o,a.a.map(t,(function(t){return e.getViewportAttributeName(i,t)})))})),Array.prototype.push.apply(i,o)})),a.a.map(this.validElements,(function(t,e){return e+(t.length?"["+t.join("|")+"]":"")})).join(",")},getViewportAttributeName:function(t,e){},setInitialParams:function(){this.editor=null,this.editorState=0,this.isEditMode=!1,this.cur_selection_styles={},this.cur_selection_styles_all=[],this.oldChangeParam={}},validate:function(){var t={};a.a.each(["bg_color","bg_opacity","column_count","column_gap"],a.a.bind((function(e){null==this.model.get(e)&&(t[e]=y.defaults[e])}),this)),a.a.isEmpty(t)||this.model.set(t,{silent:!0})},render:function(){if(!this.rendered){this.create(),this.setInitialParams(),this.validate();var t=a.a.pick(this.model.attributes,["_id","w","h","text"]);t.text=this.switchTextToViewport(t.text,this.page.getCurrentViewport()),this.model.created&&this.has_parent_block&&(t.text='<p style="line-height: 22px; padding: 16px 16px; text-align: center; font-family: Georgia; font-size: 16px;" data-size-leading-linked="false" data-size-leading-ratio="1.25"><span>Text</span></p>',this.model.save({text:t.text},{silent:!0})),this.selectOnEnter=this.model.created,Object(s.a)(this.inner_template(t)).appendTo(this.$content);var e=m.a["template-constructor-block-text-bg"];this.$bg=Object(s.a)(e({})).prependTo(this.$el),this.$bg.css({"z-index":this.model.get("z")}),this.$el.addClass("block-text"),this.$el.toggleClass("text-autosize",!!this.model.get("autosize")),this.$preview=this.$(".text-preview"),this.$preview_mask=this.$(".text-mask"),this.$preview.addClass("v"+(this.model.get("version")||1)),this.model.created&&2==this.model.get("version")&&RM.constructorRouter.fonts.addFonts([{provider:"google",css_name:"Roboto",name:"Roboto",variations:["n1","i1","n3","i3","n4","i4","n5","i5","n7","i7","n9","i9"]}],"manual"),this.applyCssColumnCount(this.$preview,this.model.get("column_count")),this.applyCssColumnGap(this.$preview,this.model.get("column_gap")),this.applyCssBgColor(this.model.get("bg_color"),this.model.get("bg_opacity")),this.model.created&&(this.model.created=!1,this.enterEditMode(),this.frame&&this.frame.show()),this.triggerReady()}},destroy:function(){this.model.off("change",this.onModelChange),this.off("resize",this.onChangeInEditor_throttle),RM.constructorRouter.off("font-added",this.onFontAdd),this.page.off("change:viewport",this.onViewportChange),this.leaveEditMode(!0),this.deleted=!0,r.a.prototype.destroy.apply(this,arguments)},createEditor:function(){var t=this;this.editorState=1,i.e(3).then(i.t.bind(null,"BZWO",7)).then((function(e){e.default.init({mode:"exact",theme:"simple",popup_css:!1,elements:"textarea_"+t.model.id,accessibility_warnings:!1,custom_shortcuts:!1,language_load:!1,doctype:"<!doctype html>",init_instance_callback:t.editorIsReady,verify_css_classes:!1,custom_undo_redo:!1,convert_urls:!1,valid_elements:t.generateValidElementsList(),plugins:"paste",paste_auto_cleanup_on_paste:!0,paste_max_consecutive_linebreaks:99,paste_text_sticky:!0,paste_text_sticky_default:!0,paste_beforegrab:a.a.bind((function(){this.workspaceScrollBeforePaste=Object(s.a)("#main").scrollTop()}),t),paste_postprocess:a.a.bind((function(){Object(s.a)("#main").scrollTop(this.workspaceScrollBeforePaste),this.somethingChangedInEditor("paste")}),t),paste_text_linebreaktype:"custom"})}))},css:function(t){void 0!==(t=t||{})["z-index"]&&this.$bg.css({"z-index":this.model.get("fixed_position")?"":t["z-index"]}),r.a.prototype.css.apply(this,arguments),t=a.a.pick(t,"width","height"),a.a.isEmpty(t)||(this.$editor&&this.$editor.css(t),this.$iframe_body&&this.$iframe_body.css(t),this.somethingChangedInEditor("dimensions"))},doesContentFit:function(){var t=!0;if(this.$iframe_document&&this.$iframe_document){var e=this.$iframe_document.width(),i=this.$iframe_document.height(),s=this.$iframe_body.width(),o=this.$iframe_body.height();e-s==1&&1==this.model.get("column_count")&&e--,t=!(e>s||i>o)}return t},"heckContentFitToBox":function(){if(this.$iframe_document&&this.$iframe_body){var t=this.doesContentFit();this.frame&&this.frame.setResizeBottomPlus(!t),this.has_parent_block&&this.workspace.fit_text_to_content()}},getAllowableHeight:function(){var t=this.isEditMode?this.$iframe_body.find("p"):this.$preview.find("p"),e=t.length,i=0,o=0,n=0;return t.each(a.a.bind((function(t,a){i+=parseInt(Object(s.a)(a).outerHeight(),10),t===e-1&&(o=parseInt(Object(s.a)(a).css("line-height"),10)/2,Object(s.a)(a).find(".link-1").length&&(n=parseInt(Object(s.a)(a).find(".link-1").css("padding-bottom"),10)))}),this)),i+o+n},getContentBoxHeight:function(){var t=0;if(this.isEditMode)for(var e,i=Math.pow(2,16),s=function(t){this.$editor&&this.$editor.css({height:t}),this.$iframe_body&&this.$iframe_body.css({height:t})}.bind(this);t!==i;)s(e=t+Math.floor((i-t)/2)),this.doesContentFit()?i=e:t=e+1;else{var o=this.$preview[0].style.cssText;this.$preview.css({height:"auto","-moz-column-fill":"balance","column-fill":"balance"}),t=this.$preview.height(),this.$preview[0].style.cssText=o}return t},fitContentToBox:function(t){this.model.set({h:this.getAllowableHeight()}),t&&"keydown"===t.type&&RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","fit frame to text"),this.saveBox()},select:function(){r.a.prototype.select.apply(this,arguments),RM.constructorRouter.bindGlobalKeyPress([{key:"x",handler:this.fitContentToBox,optionKeys:Modernizr.mac?["meta","shift"]:["ctrl","shift"]}])},deselect:function(t){r.a.prototype.deselect.apply(this,arguments),RM.constructorRouter.unbindGlobalKeyPress("x",this.fitContentToBox),t!=this&&this.isEditMode&&(this.leaveEditMode(),this.workspace.trigger("redraw"))},onWorkspaceBlocksSelect:function(t){if(r.a.prototype.onWorkspaceBlocksSelect.apply(this,arguments),this.rendered){var e=t&&1==t.length&&t[0]==this;this.isEditMode&&!e&&(this.leaveEditMode(),this.workspace.trigger("redraw"))}},onChangeInEditor:function(){this.model.get("autosize")&&(this.fitContentToBox(),this.trigger("resizeOnFit",this.model))},editorIsReady:function(t){if(t&&!this.deleted){this.editor=t,this.editor.onChange.add(this.onChangeInEditor_throttle),this.editor.onNodeChange.add(this.onChangeInEditor_throttle),this.editor.onKeyPress.add(this.onChangeInEditor_throttle),this.$editor=this.$("textarea").add(this.$("table")).add(this.$("iframe")),this.$iframe_body=this.$("iframe").contents().find("body"),this.iframe_document=this.$("iframe").contents()[0],this.$iframe_document=Object(s.a)(this.iframe_document),this.iframe=this.$("iframe")[0],this.$iframe_body.addClass("v"+(this.model.get("version")||1));var e=this.iframe_document.createElement("style");e.type="text/css",e.appendChild(this.iframe_document.createTextNode(this.EDITOR_STYLES)),this.iframe_document.getElementsByTagName("head")[0].appendChild(e),this.on("changeStyleParagraph",this.onChangeStyleParagraph),this.on("changeClassParagraph",this.onChangeClassParagraph),this.on("changeStyleSpan",this.onChangeStyleSpan),this.on("changeColumns",this.onChangeColumns),this.on("changeLink",this.onChangeLink),this.applyCssColumnCount(this.$iframe_body,this.model.get("column_count")),this.applyCssColumnGap(this.$iframe_body,this.model.get("column_gap")),this.applyCssBgColor(this.model.get("bg_color"),this.model.get("bg_opacity")),this.css({width:this.model.get("w"),height:this.model.get("h")}),this.marginController=new k(this),this.columnsController=new P(this),this.undoController=new S(this),this.$iframe_body.on("mousemove mouseup",a.a.bind((function(t){t.pageX=this.$el.offset().left+t.clientX,t.pageY=this.$el.offset().top+t.clientY,this.disableMouseEventsRedirection||Object(s.a)(document).trigger(t)}),this)),this.$iframe_document.on("paste",a.a.bind((function(){a.a.defer(a.a.bind((function(){var t,e=this.editor.selection,i=e.getBookmark();t=this.$iframe_body[0].innerHTML,this.$iframe_body[0].innerHTML=t,e.moveToBookmark(i)}),this))}),this)),this.$iframe_document.on("mouseup",a.a.bind((function(t){this.mouseSelectionStart&&(this.somethingChangedInEditor("mouseup"),this.trigger("textWidgetMouseSelectionEnd"),this.mouseSelectionStart=!1)}),this)),this.$iframe_document.on("mousedown",a.a.bind((function(t){this.somethingChangedInEditor("mousedown"),this.trigger("textWidgetMouseSelectionStart"),this.mouseSelectionStart=!0}),this)),this.$iframe_document.on("keydown",a.a.bind((function(t){this.somethingChangedInEditor("keydown")}),this)),this.editor.onKeyDown.addToTop(a.a.bind((function(t,e){if(this.isCollapsedBeforeKeyProceed=this.editor&&this.editor.selection&&this.editor.selection.isCollapsed(),13==e.keyCode&&3==e.location&&(e.preventDefault(),e.stopPropagation(),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","quit edit mode"),this.isEditMode&&(this.leaveEditMode(),this.workspace.trigger("redraw"),this.workspace&&this.workspace.controls&&this.workspace.controls.setControls(this.controls,this))),8==e.keyCode){var i=3==(n=v.a.getSelection(this.iframe)).anchorNode.nodeType?n.anchorNode.parentNode:n.anchorNode,o=Object(s.a)(i).closest("span.soundcite");n.isCollapsed&&o.length&&(0==o.text().length||1==o.text().length&&8203==o.text().charCodeAt(0))&&o.remove()}if(this.needPreserveLastPadding&&(delete this.$paragraphsBeforeRemove,(8==e.keyCode||46==e.keyCode||this.editor&&this.editor.selection&&!this.editor.selection.isCollapsed())&&(this.$paragraphsBeforeRemove=this.$iframe_body.find("p"))),13==e.keyCode&&0==e.location){var n;i=3==(n=v.a.getSelection(this.iframe)).anchorNode.nodeType?n.anchorNode.parentNode:n.anchorNode;n.isCollapsed&&Object(s.a)(i).closest("span.soundcite").length&&(e.preventDefault(),e.stopPropagation())}}),this)),this.editor.onKeyDown.add(a.a.bind((function(t,e){if(this.needPreserveLastPadding){var i=a.a.bind((function(){if(this.$paragraphsBeforeRemove&&this.$paragraphsBeforeRemove.length){var t=this.$iframe_body.find("p"),e=this.$paragraphsBeforeRemove.first()[0],i=this.$paragraphsBeforeRemove.last()[0];t.length&&(1!=t.length||t.eq(0).text()||t[0]==e||t[0]==i)||(this.editor.setContent(w),t=this.$iframe_body.find("p"));var s=t.first()[0],o=t.last()[0];o!=i&&(s.style.paddingTop=e.style.paddingTop,s.style.paddingLeft=e.style.paddingLeft,s.style.paddingRight=e.style.paddingRight,o.style.paddingLeft=i.style.paddingLeft,o.style.paddingRight=i.style.paddingRight,o.style.paddingBottom=i.style.paddingBottom,s.setAttribute("data-mce-style",s.getAttribute("style")),o.setAttribute("data-mce-style",o.getAttribute("style")))}}),this);i(),8==e.keyCode||46==e.keyCode||13==e.keyCode||this.isCollapsedBeforeKeyProceed||a.a.defer(i)}if(this.needClearMarginsOnEnter&&13==e.keyCode&&3!==e.location&&!e.shiftKey){var o,n=v.a.getSelection(this.iframe);if(this.isCollapsedBeforeKeyProceed){try{o=n.getRangeAt(0)}catch(t){}if(o){var r=this.getClosestParagraph(o.startContainer);if(r){r.style.paddingTop=0,r.setAttribute("data-mce-style",r.getAttribute("style"));var l=Object(s.a)(r).prev("p");l.length&&(l[0].style.paddingBottom=0,l[0].setAttribute("data-mce-style",l[0].getAttribute("style")))}}}}}),this)),this.editor.dom.bind(this.editor.getBody(),["dragend","dragover","draggesture","dragdrop","drop","drag"],a.a.bind((function(t){return"dragend"==t.type&&this.mouseSelectionStart&&(this.somethingChangedInEditor("mouseup"),this.trigger("textWidgetMouseSelectionEnd"),this.mouseSelectionStart=!1),t.preventDefault(),t.stopPropagation(),!1}),this)),this.$("iframe").bind("mousewheel",this.onMouseWheel),setTimeout(a.a.bind((function(){this.deleted||(this.editorState=2,this.leaveEditorBeforeItIsLoaded||(this.enterEditMode(),this.editor.show()),this.somethingChangedInEditor("editorIsReady"))}),this),100),setTimeout(a.a.bind((function(){this.selectOnEnter&&(this.editor.selection.select(this.editor.getBody(),!0),delete this.selectOnEnter)}),this),200),this.bindShortcuts()}},onResizeStart:function(t,e){this.disableMouseEventsRedirection=!0,this.$preview_mask.addClass("visible-while-resizing")},onResizeEnd:function(t,e){this.disableMouseEventsRedirection=!1,this.$preview_mask.removeClass("visible-while-resizing")},onMouseWheel:function(t,e){var i=-Math.ceil(.5*e);if(i)if(i>0&&i<1&&(i=1),i<0&&i>-1&&(i=-1),this.model.get("column_count")>1){var s=this.$iframe_document.scrollLeft();this.$iframe_document.scrollLeft(i+s),t.preventDefault()}else{var o=this.$iframe_document.scrollTop();this.$iframe_document.scrollTop(i+o),o!=this.$iframe_document.scrollTop()&&t.preventDefault()}},onDblClick:function(){this.selected&&(this.model.get("pack_id")&&1!==this.workspace.getSelectedBlocks().length?r.a.prototype.onDblClick.apply(this,arguments):this.enterEditMode())},getClosestParagraph:function(t){var e;if(!t)return e;for(;;){var i=t.tagName;if("P"==i||"p"==i){e=t;break}if(!(t=t.parentNode)||!t.tagName)break}return e},selectNodesBoundingSelection:function(t,e){var i,s,o,n,a;this.editor.selection.select(t),s=(i=this.editor.selection.getRng(!0)).startContainer,o=i.startOffset,this.editor.selection.select(e),n=(i=this.editor.selection.getRng(!0)).endContainer,a=i.endOffset,(i=this.iframe_document.createRange()).setStart(s,o),i.setEnd(n,a),this.editor.selection.setRng(i)},bindShortcuts:function(){var t=this;function e(){if(t.workspace&&t.workspace.controls){var e=t.workspace.controls.findControl("text_typography");e&&e.onClick.apply(e)}return!1}function i(){if(t.workspace&&t.workspace.controls){var e=t.workspace.controls.findControl("text_link");e&&(e.onClick.apply(e),e.focusInputField.apply(e))}return RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","create a link"),!1}function o(e){var i;return t.cur_selection_styles&&null!=t.cur_selection_styles[e]&&(i=t.cur_selection_styles[e])==t.params.multipleName&&(i=t.cur_selection_styles_all&&t.cur_selection_styles_all.length>0&&null!=t.cur_selection_styles_all[0][e]?t.cur_selection_styles_all[0][e]:void 0),i}function n(){var e=o("font-weight");return e&&t.trigger("changeStyleSpan",{"font-weight":700==e?"400":"700"}),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","make bold"),!1}function a(){var e=o("font-style");return e&&t.trigger("changeStyleSpan",{"font-style":"italic"==e?"normal":"italic"}),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","make italic"),!1}function r(){var e=o("text-decoration");return e&&t.trigger("changeStyleSpan",{"text-decoration":"underline"==e?"none":"underline"}),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","make underlined"),!1}function l(){var e=o("font-size");return e&&(++e>t.params.maxFontSize&&(e=t.params.maxFontSize),t.trigger("changeStyleParagraph",{"font-size":e+"px"})),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","increase font size"),!1}function c(){var e=o("font-size");return e&&(--e<t.params.minFontSize&&(e=t.params.minFontSize),t.trigger("changeStyleParagraph",{"font-size":e+"px"})),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","decrease font size"),!1}function h(){if(t.editor&&t.editor.selection&&t.isEditorActive()){RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","select current paragraph");var e,i=v.a.getSelection(t.iframe);try{e=i.getRangeAt(0)}catch(t){return}var s=t.getClosestParagraph(e.startContainer),o=t.getClosestParagraph(e.endContainer);return t.selectNodesBoundingSelection(s,o),!1}}function p(){return t.trigger("changeStyleParagraph",{"text-align":"left"}),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","align left"),!1}function u(){return t.trigger("changeStyleParagraph",{"text-align":"right"}),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","align right"),!1}function g(){return t.trigger("changeStyleParagraph",{"text-align":"center"}),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","align center"),!1}function m(e){if(t.editor&&t.editor.selection&&t.editor.selection.isCollapsed()){var i=t.editor.selection.getRng(),o=t.editor.selection.getNode(),n=i.startOffset;if(o&&!(n>0)){for(;o&&Object(s.a)(o)[0].tagName&&"p"!=Object(s.a)(o)[0].tagName.toLowerCase();){if(Object(s.a)(o).index()>0)return;o=o.parentNode}if(o&&Object(s.a)(o)[0].tagName&&"p"==Object(s.a)(o)[0].tagName.toLowerCase()){var a=0;if(t.iframe_document.defaultView&&t.iframe_document.defaultView.getComputedStyle){var r=t.iframe_document.defaultView.getComputedStyle(o,null);r&&(a=parseInt(r.getPropertyValue("text-indent"),10)),isNaN(a)&&(a=0)}if(!(e<0&&0==a))return(a+=t.params.tabIndent*e)<0&&(a=0),t.trigger("changeStyleParagraph",{"text-indent":a+"px"}),!1}}}}this.$iframe_body.bind("keydown","tab",(function(){return m(1),!1})).bind("keydown","backspace",(function(t){return m(-1)})).bind("keydown","alt+up",(function(){var e=o("line-height");e&&(--e<t.params.minLineHeight&&(e=t.params.minLineHeight),t.trigger("changeStyleParagraph",{"line-height":e+"px"}));RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","decrease line height");return!1})).bind("keydown","alt+down",(function(){var e=o("line-height");e&&(++e>t.params.maxLineHeight&&(e=t.params.maxLineHeight),t.trigger("changeStyleParagraph",{"line-height":e+"px"}));RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","increase line height");return!1})).bind("keydown","alt+left",(function(){if(!t.editor||!t.editor.selection||t.editor.selection.isCollapsed())return;var e=o("letter-spacing");null!=e&&((e=d.b.decimals(e-.2,2))<t.params.minLetterSpacing&&(e=t.params.minLetterSpacing),t.trigger("changeStyleSpan",{"letter-spacing":e+"px"}));return!1})).bind("keydown","alt+right",(function(){if(!t.editor||!t.editor.selection||t.editor.selection.isCollapsed())return;var e=o("letter-spacing");null!=e&&((e=d.b.decimals(e+.2,2))>t.params.maxLetterSpacing&&(e=t.params.maxLetterSpacing),t.trigger("changeStyleSpan",{"letter-spacing":e+"px"}));return!1})),this.$iframe_body.bind("keydown","alt+ctrl+t",e).bind("keydown","ctrl+shift+x",this.fitContentToBox.bind(this)).bind("keydown","ctrl+k",i).bind("keydown","ctrl+b",n).bind("keydown","ctrl+i",a).bind("keydown","ctrl+u",r).bind("keydown","ctrl+shift+",l).bind("keydown","ctrl+shift+",c).bind("keydown","ctrl+shift+a",h).bind("keydown","ctrl+shift+l",p).bind("keydown","ctrl+shift+r",u).bind("keydown","ctrl+shift+c",g),this.$iframe_body.bind("keydown","alt+meta+t",e).bind("keydown","meta+shift+x",this.fitContentToBox.bind(this)).bind("keydown","meta+k",i).bind("keydown","meta+b",n).bind("keydown","meta+i",a).bind("keydown","meta+u",r).bind("keydown","meta+shift+",l).bind("keydown","meta+shift+",c).bind("keydown","meta+shift+a",h).bind("keydown","meta+shift+l",p).bind("keydown","meta+shift+r",u).bind("keydown","meta+shift+c",g),this.bindSymbolShortcuts()},bindSymbolShortcuts:function(){var t=Modernizr.mac;a.a.each({"&ensp;":"alt+shift+space","&nbsp;":"alt+ctrl+space","&thinsp;":"alt+ctrl+shift+space"},function(e,i){-1!==e.indexOf("ctrl")&&t?this.$iframe_body.bind("keydown",e.replace("ctrl","meta"),this.insertCharacter.bind(this,i)):this.$iframe_body.bind("keydown",e,this.insertCharacter.bind(this,i))}.bind(this))},enterEditMode:function(t){t&&t.shiftKey||1!=this.editorState&&(0!=this.editorState?(this.$editor&&this.$editor.css("display","block"),this.frame&&this.frame.setEditorState(),this.$preview&&this.$preview.css("display","none"),this.$preview_mask&&this.$preview_mask.css("display","none"),this.$iframe_body.css({zoom:RM.constructorRouter.zoom.getZoom()}),this.initiatorControl="user",this.isEditMode=!0,this.marginController&&this.marginController.show(),this.columnsController&&this.columnsController.show(),this.frame.removeRotationState(),this.frame.resetRotation(),this.undoController.historyTriggers=p.a.setCustomHandlers({undo:this.undoController.undo,redo:this.undoController.redo,getLength:this.undoController.getLength}),this.prevModelAttributes=a.a.clone(this.model.attributes),clearInterval(this.intermediateSaveInterval),this.intermediateSaveInterval=setInterval(this.intermediateSave,2e4),RM.constructorRouter.textStyles.generateCSS("paragraph","editor",this.iframe_document),RM.constructorRouter.textStyles.generateCSS("link","editor",this.iframe_document),h.a.appendFontsCssToIFrame(this.iframe_document),setTimeout(a.a.bind((function(){this.isEditorActive()&&(this.editor.focus(),this.editor.setContent(this.switchTextToViewport(this.model.get("text"),this.model.isNested?"default":this.page.getCurrentViewport())),this.somethingChangedInEditor("enterEditMode"))}),this),0),this.workspace&&this.workspace.controls&&this.workspace.controls.setControls(this.edit_controls,this),this.workspace.trigger("w-text-entered-edit-mode")):this.createEditor())},isEditorActive:function(){return!this.deleted&&(!!this.isEditMode&&(!!this.editor&&2==this.editorState))},applyCssColumnCount:function(t,e){var i=1==e?"auto":e;t&&t.css({"-webkit-column-count":i+"","-moz-column-count":i+"","column-count":i+""})},applyCssColumnGap:function(t,e){t&&t.css({"-webkit-column-gap":e,"-moz-column-gap":e,"column-gap":e})},applyCssBgColor:function(t,e){var i="",s=[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)];i=e>.99?"rgb("+s[0]+","+s[1]+","+s[2]+")":"rgba("+s[0]+","+s[1]+","+s[2]+", "+e+")",this.$bg.css("background",i)},leaveEditMode:function(t){0!=this.editorState&&(1!=this.editorState?this.isEditorActive()&&(this.changeSpanToNbsp(),this.workspace.trigger("w-text-before-leave-edit-mode"),this.isEditMode=!1,clearInterval(this.intermediateSaveInterval),d.b.getFocusBack(),this.$editor&&this.$editor.css("display","none"),this.frame&&this.frame.removeEditorState(),this.$preview&&this.$preview.css("display","block"),this.$preview_mask&&this.$preview_mask.css("display","block"),this.marginController&&this.marginController.hide(),this.columnsController&&this.columnsController.hide(),this.frame.restoreRotation(),p.a.removeCustomHandlers(),this.undoController.historyTriggers={},t||this.saveWidgetData(),this.workspace.trigger("w-text-leaved-edit-mode")):this.leaveEditorBeforeItIsLoaded=!0)},getSaveBoxOptions:function(t){return a.a.extend({patch:!0},t)},saveWidgetData:function(){var t=this.switchTextToDefault(this.editor.getContent()),e=Object(s.a)("<div>").html(t);for(e.find("div").remove();;){var i=e.html();if(e.find("span:econtains(), a:econtains()").filter((function(){return""!=Object(s.a)(this).closest("p").text()})).remove(),e.find("span:econtains(''), a:econtains('')").filter((function(){return""!=Object(s.a)(this).closest("p").text()})).remove(),i==e.html())break}!(t=e.html())&&this.has_parent_block&&(t=w),t==this.prevModelAttributes.text&&a.a.isEqual(a.a.omit(this.model.attributes,"text","x","y","w","h","z","angle","flip_h","flip_v"),a.a.omit(this.prevModelAttributes,"text","x","y","w","h","z","angle","flip_h","flip_v"))||this.model.save({text:t}),this.prevModelAttributes=a.a.clone(this.model.attributes),e.empty().remove()},intermediateSave:function(){this.isEditorActive()?this.saveWidgetData():clearTimeout(this.intermediateSaveInterval)},onViewportChange:function(){if(this.rendered){var t=this.switchTextToViewport(this.model.get("text"),this.page.getCurrentViewport());this.setPreviewHtml(t),this.editor&&this.editor.setContent(t)}},onModelChange:function(t){var e;if(r.a.prototype.onModelChange.apply(this,arguments),this.rendered){if(this.validate(),a.a.has(t.changedAttributes(),"text")){var i=this.switchTextToViewport(t.get("text"),this.model.isNested?"default":this.page.getCurrentViewport());this.setPreviewHtml(i),this.isEditorActive()||this.editor&&this.editor.setContent(i)}"autosize"in t.changed&&(e=this.$el.find(".frameborder"),this.$el.toggleClass("text-autosize",!!this.model.get("autosize")),e.hasClass("red-border")&&this.model.get("autosize")&&e.removeClass("red-border"),a.a.defer(function(){this.fitContentToBox(),this.trigger("resizeOnFit",this.model)}.bind(this))),this.applyCssColumnCount(this.$preview,t.get("column_count")),this.applyCssColumnCount(this.$iframe_body,t.get("column_count")),this.applyCssColumnGap(this.$preview,t.get("column_gap")),this.applyCssColumnGap(this.$iframe_body,t.get("column_gap")),this.applyCssBgColor(this.model.get("bg_color"),this.model.get("bg_opacity"))}},setPreviewHtml:function(t){this.$preview&&this.$preview.html(t),this.$preview.find("span.soundcite").each((function(t,e){b.a&&b.a.setElementsColor(e)}))},calcColumnsPositions:function(){var t,e,i,s=this.$el[0].offsetWidth,o=this.$iframe_document.width(),n=this.model.get("column_gap"),a=(s+n)/this.model.get("column_count")-n,r=Math.round((o+n)/(a+n)),l=(o+n)/r-n,c=[],h=0;for(t=0;t<r;t++)e=Math.round(h),i=Math.round(h+l-1),c.push({st:e,ed:i,w:i-e+1}),h+=l+n;return c},sanitizeContent:function(){if("1"!=this.$iframe_body.attr("data-pasting-in-action")){this.$iframe_body.find('span[data-mce-type="bookmark"]').remove();var t=this.editor.selection.getBookmark();this.$iframe_body.find('span[data-mce-type="bookmark"]').removeAttr("data-mce-type").addClass("bookmark");var e=this.editor.getContent();this.editor.setContent(e),this.$iframe_body.find("span.bookmark").attr("data-mce-type","bookmark").removeClass("bookmark").text(""),this.editor.selection.moveToBookmark(t)}},removeRedundandNBSPs:function(){var t,e=this.$iframe_body[0].innerHTML,i=s(e);function s(t){return t=(t=(t=(t=(t=(t=(t=t.replace(/\>&nbsp;\</gim,">{{{NBSP_PLACEHOLDER}}}<")).replace(/([^\>])&nbsp;([^\<])/gim,"$1{{{NBSP_PLACEHOLDER}}}$2")).replace(/([^\>\<$|\s])&nbsp;/gim,"$1{{{NBSP_PLACEHOLDER}}}")).replace(/\<\/p\>/gim,"</p>\n")).replace(/([^\s\>])((?:<[^\>]*?>)*)&nbsp;((?:<[^\>]*?>)*)([^\s\<])/gi,"$1$2 $3$4")).replace(/\{\{\{NBSP_PLACEHOLDER\}\}\}/gim,"&nbsp;")).replace(/\<\/p\>\n+/gim,"</p>")}i!=e&&(t=this.editor.selection.getBookmark(),this.$iframe_body.find('span[data-mce-type="bookmark"]').html(""),i=s(e=this.$iframe_body[0].innerHTML),this.$iframe_body[0].innerHTML=i,this.editor.selection.moveToBookmark(t))},somethingChangedInEditor:function(t,e){if("dimensions"==t||"margins"==t||"enterEditMode"==t)return this.recalcStyle(t,e),void("enterEditMode"==t&&-1!==this.$iframe_body[0].innerHTML.indexOf("&nbsp;")&&this.changeNbspToSpan());"paste"==t&&setTimeout(this.sanitizeContent,0),this.recalcStyleDebounced(t,e)},recalcStyle:function(t,e){if(this.isEditorActive()&&"1"!=this.$iframe_body.attr("data-pasting-in-action")&&(this.$iframe_body.find(":not(p,span,a,br)").length>0&&this.sanitizeContent(),this.heckContentFitToBox(),"dimensions"==t?setTimeout(a.a.bind((function(){this.marginController&&this.marginController.recalc(),this.columnsController&&this.columnsController.recalc()}),this),0):(this.marginController&&this.marginController.recalc(),this.columnsController&&this.columnsController.recalc()),"dimensions"!=t)){this.removeRedundandNBSPs(),"keydown"==t&&this.changeNbspToSpan();var i=this.editor.getContent();if("BODY"==(d=this.editor.selection.getRng(!0)).startContainer.tagName||"BODY"==d.endContainer.tagName)var o=!0;var n=v.a.getSelection(this.iframe);if(o){d=n.getRangeAt(0);var r=this.editor.dom.createRng();r.setStart(d.startContainer,d.startOffset),r.setEnd(d.endContainer,d.endOffset),this.editor.selection.setRng(r)}"undo"!=t&&"redo"!=t&&this.undoController.add(i,"margins"==t?"formatApplied":t,n,e),"user"==this.initiatorControl&&(this.oldChangeParam={});var l=[];if("[object HTMLDocument]"!=(w=3==n.anchorNode.nodeType?n.anchorNode.parentNode:n.anchorNode).toString()){var c,h;if(n.isCollapsed)l.push(w),c=w,h=w;else if(n.rangeCount){var d,p=(d=n.getRangeAt(0)).getNodes([3]);c=d.startContainer,h=d.endContainer;for(var u,g=0;u=p[g];g++)""!=u.nodeValue&&l.push(u.parentNode);l=s.a.unique(l)}c=3==c.nodeType?c.parentNode:c,h=3==h.nodeType?h.parentNode:h;var m,f,b=[];for(g=0;g<l.length;g++)for(var _,w=l[g];"P"!=(_=w.tagName)&&"p"!=_;){if("A"==_||"a"==_){b.push(w),l[g]==c&&(m=w),l[g]==h&&(f=w);break}if(!(w=w.parentNode)||!w.tagName)break}var y=this.workspace&&this.workspace.controls&&this.workspace.controls.findControl("text_color");m&&f&&Object(s.a)(m).attr("data-uuid")==Object(s.a)(f).attr("data-uuid")?y&&y.setDisabled():y&&y.setEnabled(),this.calcSelectionStyle(l,b),this.collapsedSelection=n.isCollapsed,n.isCollapsed&&this.cur_selection_styles&&this.$iframe_body.css("color","#"+this.cur_selection_styles.color)}}},getComputedStyle:function(t,e){var i=[];if(t&&this.iframe_document.defaultView&&this.iframe_document.defaultView.getComputedStyle){var s=this.iframe_document.defaultView.getComputedStyle(t,null);if(!s)return[];a.a.each(e,(function(e){var o=s.getPropertyValue(e).toLowerCase();t.tagName&&"A"==t.tagName&&"text-decoration"==e&&(o="none"),i.push({prop:e,val:o})}))}return i},calcSelectionStyle:function(t,e){if(this.cur_selection_styles_all=[],a.a.each(t,a.a.bind((function(t){var e=this.getComputedStyle(t,["text-align","color","text-transform","vertical-align","font-weight","font-style","text-decoration","letter-spacing","font-family"]),i=this.getClosestParagraph(t);if(i){var s=this.getComputedStyle(i,["font-size","line-height","padding-top","padding-left","padding-right","padding-bottom"]);(e=a.a.union(e,s)).push({prop:"paragraph-class",val:i.className});var o=i.getAttribute("data-size-leading-linked");e.push({prop:"size-leading-linked",val:!o||"true"==o}),e.push({prop:"size-leading-ratio",val:(i.getAttribute("data-size-leading-ratio")||this.params.fontSizeLineHeightRatio)-0})}e.length>0&&(!function(t){a.a.each(t,(function(e){if("font-weight"==e.prop&&("normal"==e.val&&(e.val="400"),"bold"==e.val&&(e.val="700")),"color"==e.prop){var i,s,o=e.val.match(/\s*rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)\s*/);o||(o=e.val.match(/\s*rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d+|\d*\.\d+)\s*\)\s*/)),o&&(n=o[1]-0,a=o[2]-0,r=o[3]-0,l=n.toString(16),c=a.toString(16),h=r.toString(16),i=(1==l.length?"0"+l:l)+(1==c.length?"0"+c:c)+(1==h.length?"0"+h:h),s=Math.round(100*(o[4]||1))),e.val=i,t.push({prop:"opacity",val:s})}var n,a,r,l,c,h;if("font-size"==e.prop&&(e.val=parseInt(e.val,10)),"line-height"==e.prop&&(e.val=parseInt(e.val,10)),"text-align"==e.prop&&"start"!=e.val&&"left"!=e.val&&"right"!=e.val&&"justify"!=e.val&&"center"!=e.val&&(e.val="start"),"text-decoration"==e.prop){var d=e.val.split(" ");e.val=d.length?d[0]:e.val}if("padding-left"!=e.prop&&"padding-right"!=e.prop&&"padding-top"!=e.prop&&"padding-bottom"!=e.prop||(e.val=parseInt(e.val,10)),"letter-spacing"==e.prop&&("normal"==e.val&&(e.val="0"),e.val=parseFloat(e.val)),"font-family"==e.prop){e.val=e.val.replace(/\'|\"/gim,"");var p=RM.constructorRouter.fonts.findFontByCSSName(e.val);p&&p.css_name&&(e.val=p.css_name)}}))}(e),this.cur_selection_styles_all.push(e))}),this)),0!=this.cur_selection_styles_all.length){var i=this.cur_selection_styles;this.cur_selection_styles={};var s=[],o=!0;a.a.each(this.cur_selection_styles_all,a.a.bind((function(t){var e={};a.a.each(t,a.a.bind((function(t){e[t.prop]=t.val,this.cur_selection_styles[t.prop]!=t.val&&(this.cur_selection_styles[t.prop]=this.params.multipleName),o&&(this.cur_selection_styles[t.prop]=t.val)}),this)),s.push(e),o=!1}),this)),this.cur_selection_styles_all=s;for(var n in this.cur_selection_styles)if(this.cur_selection_styles[n]!=i[n]){!1;break}this.cur_selection_styles.link_nodes=e,this.trigger("selection_styles_changed",this.cur_selection_styles),this.trigger("selection_styles_all_changed",this.cur_selection_styles_all),this.initiatorControl="user"}},onChangeStyleParagraph:function(t){this.checkForParamUpdateNeeded(this.changeStyleParagraph,t)},onChangeClassParagraph:function(t){this.checkForParamUpdateNeeded(this.changeClassParagraph,t)},onChangeStyleSpan:function(t){this.checkForParamUpdateNeeded(this.changeStyleSpan,t)},onChangeColumns:function(t){this.checkForParamUpdateNeeded(this.changeColumns,t)},onChangeLink:function(t){this.checkForParamUpdateNeeded(this.changeLink,t)},checkForParamUpdateNeeded:function(t,e){if(!a.a.isEqual(this.oldChangeParam,e)){var i=a.a.keys(this.oldChangeParam),s=a.a.keys(e);0==a.a.difference(i,s).length?t.__debounced(e):t(e)}this.oldChangeParam=e,e&&e.url&&(/^back\sto\stop$/i.test(e.url)||(e.url=encodeURI(e.url))),this.somethingChangedInEditor("formatApplied",e)},changeStyleParagraph:function(t){if(t&&this.isEditorActive()){var e=a.a.pick(t,"size-leading-linked","size-leading-ratio"),i=a.a.omit(t,"size-leading-linked","size-leading-ratio"),s={selector:"p"};a.a.isEmpty(e)||(s.attributes=a.a.object(a.a.map(a.a.keys(e),(function(t){return"data-"+t})),a.a.map(a.a.values(e),(function(t){return t+""})))),!Modernizr.webkit||Modernizr.safari||Modernizr.safari5?i["white-space"]=Object.values(i).indexOf("justify")>-1?"normal":"pre-wrap":i["white-space"]="inherit",a.a.isEmpty(i)||(s.styles=i),this.editor.formatter.register("temp",s),this.editor.formatter.apply("temp")}},changeClassParagraph:function(t){t&&(this.isEditorActive()&&(this.editor.formatter.register("temp",{selector:"p",classes:"temp-class"}),this.editor.formatter.apply("temp"),Object(s.a)(".temp-class",this.iframe_document).each(a.a.bind((function(e,i){var o=Object(s.a)(i);if(this.needIgnoreSlylesMargins){var n,r={};n=i.style.paddingLeft,r.paddingLeft=parseInt(n,10)?n:0,n=i.style.paddingTop,r.paddingTop=parseInt(n,10)?n:0,n=i.style.paddingBottom,r.paddingBottom=parseInt(n,10)?n:0,n=i.style.paddingRight,r.paddingRight=parseInt(n,10)?n:0}t.class&&(i.className=t.class),t.remove&&(i.className="none"),o.removeAttr("style").removeAttr("data-mce-style"),t.override&&o.find("*").removeAttr("style").removeAttr("data-mce-style");for(var l=i.firstChild;l&&(3!=l.nodeType||""==l.nodeValue);l=l.nextSibling);if(!l&&!t.override){var c={};!function t(e,i){if(e.childNodes.length>0)for(var s=0;s<e.childNodes.length;s++)t(e.childNodes[s],i);3==e.nodeType&&""!=e.nodeValue&&i(e)}(i,a.a.bind((function(t){var e=this.getComputedStyle(t.parentNode,["font-weight","font-style","font-family","letter-spacing","color","text-transform","vertical-align","text-decoration"]);a.a.each(e,(function(t,e){c[t.prop]||(c[t.prop]={}),c[t.prop][t.val]=!0}))}),this));var h=[];a.a.each(c,(function(t,e){1==a.a.keys(t).length&&h.push(e)})),o.find("*").each(a.a.bind((function(t,e){if(e.tagName&&"br"!=e.tagName.toLowerCase()){a.a.each(h,(function(t,i){e.style.removeProperty(t)}));var i=s.a.trim(e.style.cssText);i?Object(s.a)(e).attr("data-mce-style",i):Object(s.a)(e).removeAttr("style").removeAttr("data-mce-style")}}),this))}this.needIgnoreSlylesMargins&&(i.style.paddingLeft=r.paddingLeft,i.style.paddingTop=r.paddingTop,i.style.paddingBottom=r.paddingBottom,i.style.paddingRight=r.paddingRight,i.setAttribute("data-mce-style",i.getAttribute("style")))}),this))))},changeStyleSpan:function(t){t&&this.isEditorActive()&&(this.editor.formatter.register("temp",{inline:"span",styles:t}),this.editor.formatter.apply("temp"))},changeColumns:function(t){t&&this.isEditorActive()&&(null!=t.column_count&&(this.model.set({column_count:t.column_count}),this.applyCssColumnCount(this.$iframe_body,t.column_count)),null!=t.column_gap&&(this.model.set({column_gap:t.column_gap}),this.applyCssColumnGap(this.$iframe_body,t.column_gap)),null!=t.bg_color&&null!=t.bg_opacity&&(this.model.set({bg_color:t.bg_color,bg_opacity:t.bg_opacity}),this.applyCssBgColor(t.bg_color,t.bg_opacity)))},changeLink:function(t){if(t&&this.isEditorActive()){var e,i,o=this.cur_selection_styles&&this.cur_selection_styles.link_nodes||[],n=this.collapsedSelection;if("remove"==t.action&&(n&&o.length&&(e=Object(s.a)(o[0]).attr("data-uuid"),i=this.$iframe_body.find("a[data-uuid='"+e+"']"),this.selectNodesBoundingSelection(i[0],i[i.length-1])),this.editor.execCommand("mceInsertLink",!1,"")),"create"==t.action){n&&o.length?(e=Object(s.a)(o[0]).attr("data-uuid"),i=this.$iframe_body.find("a[data-uuid='"+e+"']")):(e=d.b.generateUUID(),this.editor.execCommand("mceInsertLink",!1,"temp-url"),i=this.$iframe_body.find('a[href="temp-url"]'));var r={};t.clickPage&&(r["data-page-uri"]=t.clickPage),i.attr(a.a.extend({href:t.url,"data-mce-href":t.url,"data-uuid":e,"data-pid":RM.constructorRouter.mag.getPageId(t.url)||null,class:t.class,"data-mce-class":t.class,target:t.target,"data-anchor-link-pos":t.anchor_pos||null},r)),i.length>0&&this.selectNodesBoundingSelection(i[0],i[i.length-1])}"change-class"==t.action&&o.length&&Object(s.a)(o).attr({class:t.class,"data-mce-class":t.class}),"change-target"==t.action&&o.length&&Object(s.a)(o).attr({target:t.target})}},changeNbspToSpan:function(){var t,e=this.editor.selection.getBookmark();t=(t=this.$iframe_body[0].innerHTML.replace(/<span class="nbsp">(&nbsp;)?(.*?)<\/span>/g,"$1$2")).replace(/&nbsp;/g,'<span class="nbsp">&nbsp;</span>'),this.$iframe_body[0].innerHTML=t,this.editor.selection.moveToBookmark(e)},changeSpanToNbsp:function(){var t;t=this.$iframe_body[0].innerHTML.replace(/<span class="nbsp">(&nbsp;)?(.*?)<\/span>/g,"$1$2"),this.$iframe_body[0].innerHTML=t},insertCharacter:function(t,e){this.editor.execCommand("mceInsertContent",!1,t),"&nbsp;"===t&&(this.changeNbspToSpan(),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","insert non-breaking space")),e.preventDefault()}},{defaults:{text:function(){return"<p>"+_[Math.floor(Math.random()*_.length)]+"</p>"},column_count:1,column_gap:16,bg_color:"ffffff",bg_opacity:0,version:2}}).extend(u.a.prototype),k=n.a.View.extend({params:{maxTopMargin:999,maxBottomMargin:999,maxLeftMargin:999,maxRightMargin:999,handleThreshold:4,minHandleSize:43},initialize:function(t){a.a.bindAll(this),this.block=t,this.block.$iframe_document.on("scroll",this.onScroll),this.marginBlocks=new C(this,this.block.$(".margins-wrapper-inner")[0]),this.marginHandle=new x(this,this.block.$el[0]),this.onScroll()},onScroll:function(){this.scrollTop=this.block.$iframe_document.scrollTop(),this.scrollLeft=this.block.$iframe_document.scrollLeft(),this.marginBlocks.onScroll(this.scrollTop,this.scrollLeft),this.marginHandle.onScroll(this.scrollTop,this.scrollLeft)},recalc:function(){if(this.block.isEditorActive()){this.dw=this.block.$iframe_document.width(),this.dh=this.block.$iframe_document.height();var t,e=v.a.getSelection(this.block.iframe);try{t=e.getRangeAt(0)}catch(t){return}var i=this.block.getClosestParagraph(t.startContainer),s=this.block.getClosestParagraph(t.endContainer);if(!i&&"BODY"!=t.startContainer.tagName||!s&&"BODY"!=t.endContainer.tagName)return this.marginBlocks.proceed([]),void this.marginHandle.proceed([],[]);if(!i||!s){var o=this.block.$iframe_body.find("p");if(0==o.length)return this.marginBlocks.proceed([]),void this.marginHandle.proceed([],[]);i||(i=o.get(0)),s||(s=o.get(-1))}for(var n=[{paragraph:i}];i&&i!==s;)"P"==(i=i.nextSibling).tagName&&n.push({paragraph:i});if(this.block.model.get("column_count")>1){var r=this.insertDiv("margin-st","before",n[0].paragraph);n[0].st=r;for(var l=0;l<n.length;l++){r=this.insertDiv("margin-ed","after",n[l].paragraph);n[l].ed=r,l+1<n.length&&(n[l+1].st=r)}var c=this.block.calcColumnsPositions()}var h=[],d=[];if(a.a.each(n,a.a.bind((function(t){var e=this.calcParagraphDimensions(t,c);a.a.each(e.marginBlocks,a.a.bind((function(t){h.push(t)}),this)),a.a.each(e.marginHandles,a.a.bind((function(t){d.push(t)}),this))}),this)),this.block.model.get("column_count")>1){var p=n[0].paragraph.parentNode;p.removeChild(n[0].st);for(l=0;l<n.length;l++)p.removeChild(n[l].ed)}this.marginBlocks.proceed(h),this.marginHandle.proceed(d,a.a.pluck(n,"paragraph"))}},insertDiv:function(t,e,i){var s=this.block.iframe_document.createElement("div");return s.className=t,"before"==e?i.parentNode.insertBefore(s,i):i.parentNode.insertBefore(s,i.nextSibling),s},getColumnIndex:function(t,e){for(var i,s=9999,o=0,n=0;n<t.length;n++)(i=Math.abs(e-t[n].st))<s&&(s=i,o=n);return o},calcParagraphDimensions:function(t,e){var i=t.paragraph,s=this.block.iframe_document.defaultView.getComputedStyle(i,null),o=parseInt(s.getPropertyValue("padding-top"),10),n=parseInt(s.getPropertyValue("padding-right"),10),a=parseInt(s.getPropertyValue("padding-bottom"),10),r=parseInt(s.getPropertyValue("padding-left"),10),l=o,c=a;if(1==this.block.model.get("column_count"))var h=i.getBoundingClientRect(),d=(m=h.width,f=h.left+this.scrollLeft),p=(v=h.top+this.scrollTop)+h.height;else{var u=t.st.getBoundingClientRect(),g=t.ed.getBoundingClientRect(),m=u.width,f=(g.width,u.left+this.scrollLeft),v=(d=g.left+this.scrollLeft,u.top+this.scrollTop+("margin-ed"==t.st.className?1:0));p=g.top+this.scrollTop+1}var b=[];if(this.block.model.get("column_count")>1)for(var _=this.getColumnIndex(e,f),w=this.getColumnIndex(e,d),y=_;y<=w;y++){var k,C=e[y];k=_==w?p-v:y==_?this.dh-v:y==w?p:this.dh;var x={x:C.st,w:C.w,y:y==_?v:0,h:k};b.push(x)}else{x={x:f,y:v,w:m,h:p-v};b.push(x)}var S=b.length;for(y=0;y<S;y++){r+n>(M=b[y]).w&&(r>M.w?(r=M.w,n=0):n=M.w-r),M.mr=n,M.ml=r,M.mt=o,M.h<o&&(M.mt=M.h),o=Math.max(o-M.h,0)}for(y=S-1;y>=0;y--){(M=b[y]).mb=a,M.h<a&&(M.mb=M.h),a=Math.max(a-M.h,0)}var P,$=[],O=[],T=!1;for(y=0;y<S;y++){var M,j={ox:(M=b[y]).x,oy:M.y,ow:M.w,oh:M.h,mt:M.mt,mb:M.mb,ml:M.ml,mr:M.mr},I=M.w-M.ml-M.mr,E=M.x+M.ml;0==I?(I=2,E--):1==I&&(I=2),E+I>M.x+M.w&&(E=M.x+M.w-I),E<M.x&&(E=M.x),j.ix=E,j.iy=M.y+M.mt,j.iw=I,j.ih=M.h-M.mt-M.mb,$.push(j),!T&&j.oh-j.mt-j.mb>0&&(P={tp:"top",column:y,p:i,val:l,max:this.params.maxTopMargin,x:j.ix,y:j.iy,size:j.iw},O.push(P),T=!0),y==S-1&&(P={tp:"bottom",column:y,p:i,val:c,max:this.params.maxBottomMargin,x:j.ox,y:j.oy+j.oh-1,size:j.ow},O.push(P)),j.oh-j.mt-j.mb>0&&(P={tp:"left",column:y,p:i,val:M.ml,max:Math.min(j.ow-j.mr,this.params.maxLeftMargin),x:j.ix,y:j.iy,size:j.ih},O.push(P),P={tp:"right",column:y,p:i,val:M.mr,max:Math.min(j.ow-j.ml,this.params.maxRightMargin),x:j.ix+j.iw-1,y:j.iy,size:j.ih},O.push(P))}return{marginBlocks:$,marginHandles:O}},show:function(){this.marginBlocks.show(),this.marginHandle.show(),this.onScroll()},hide:function(){this.marginBlocks.hide(),this.marginHandle.hide()}}),C=n.a.Model.extend({initialize:function(t,e){a.a.bindAll(this),this.controller=t,this.container=e,this.marginBlocks=[]},onScroll:function(t,e){Object(s.a)(this.container).css({top:-t,left:-e})},proceed:function(t){for(var e=this.prevUsedBlocks?this.prevUsedBlocks:this.marginBlocks.length,i=0;i<e;i++)this.clear(this.marginBlocks[i]);for(i=0;i<t.length;i++){var s=t[i];this.marginBlocks[i]||(this.marginBlocks[i]=this.createNewMarginBlock()),this.render(this.marginBlocks[i],s)}this.prevUsedBlocks=t.length},createNewMarginBlock:function(){var t=this,e={};function i(e){var i=document.createElement("div");return i.className=e,t.container.appendChild(i),i}return e.t=i("margin-top-block"),e.b=i("margin-bottom-block"),e.l=i("margin-left-block"),e.r=i("margin-right-block"),e.outer=i("margin-outer-frame"),e.inner=i("margin-inner-frame"),e},render:function(t,e){function i(t,e,i,s,o){var n=t.style;n.left=e+"px",n.top=i+"px",n.width=s<0?0:s+"px",n.height=o<0?0:o+"px",n.display="block"}i(t.outer,e.ox,e.oy,e.ow,e.oh),0==e.mb&&0==e.mt&&0==e.mr&&0==e.ml||i(t.inner,e.ix,e.iy,e.iw,e.ih),0!=e.mt&&i(t.t,e.ox,e.oy,e.ow,e.mt),0!=e.mb&&i(t.b,e.ox,e.oy+e.oh-e.mb,e.ow,e.mb),0!=e.ml&&i(t.l,e.ox,e.oy+e.mt,e.ml,e.oh-e.mt-e.mb),0!=e.mr&&i(t.r,e.ox+e.ow-e.mr,e.oy+e.mt,e.mr,e.oh-e.mt-e.mb)},clear:function(t){t.inner.style.display="none",t.outer.style.display="none",t.t.style.display="none",t.b.style.display="none",t.l.style.display="none",t.r.style.display="none"},show:function(){this.container.parentNode.style.display="block"},hide:function(){this.container.parentNode.style.display="none"}}),x=n.a.View.extend({initialize:function(t,e){a.a.bindAll(this),this.controller=t,this.container=e,this.template=m.a["template-constructor-block-text-margins"],this.setElement(Object(s.a)(this.template({})).appendTo(this.container)),this.initialData=void 0,this.data=void 0,this.mx=0,this.my=0,this.mxOnFocusEnter=0,this.myOnFocusEnter=0,this.scrollLeft=0,this.scrollTop=0,this.marginHandles=[],this.state="idle",this.paragraphs=[],this.mouseProceeding=!0,this.$el.RMDrag({start:this.startHandleDrag,move:this.moveHandleDrag,end:this.endHandleDrag,silent:!0,preventDefault:!0}),this.controller.block.on("textWidgetMouseSelectionStart",this.onMouseSelectionStart),this.controller.block.on("textWidgetMouseSelectionEnd",this.onMouseSelectionEnd),this.$marginInput=this.$el.find(".margin-input"),this.$marginInput.RMNumericInput({needMinMaxCurChanger:!0,min:0,max:999,onChange:this.onInputChange,mouseUse:!1}),this.inputChangeValue=this.$marginInput.data("changeValue"),this.inputChangeMinMax=this.$marginInput.data("changeMinMax"),this.$marginInput.on("focus",this.onInputFocus).on("blur",this.onInputBlur)},onMouseSelectionStart:function(){this.hideHandle(),this.mouseProceeding=!1},onMouseSelectionEnd:function(){this.mouseProceeding=!0,this.onMouseMove()},startHandleDrag:function(t){this.$marginInput.blur(),this.state="dragging",this.oldDelta=0,this.showHandle("show"),this.onMouseMove(),this.controller.block.trigger("textWidgetMarginDragStart")},moveHandleDrag:function(t){if(this.data){var e="top"==this.data.tp||"bottom"==this.data.tp?t.deltaY:t.deltaX,i="right"==this.data.tp?-1:1,s=this.data.val+(e-this.oldDelta)*i;s<0?(this.applyStyle(this.data.tp,0),this.oldDelta=e-s*i):s>this.data.max?(this.applyStyle(this.data.tp,this.data.max),this.oldDelta=e+(this.data.max-s)*i):(this.applyStyle(this.data.tp,s),this.oldDelta=e)}},endHandleDrag:function(t){this.controller.block.trigger("textWidgetMarginDragEnd"),t.moved?(this.hideHandle(),this.state="idle",this.onMouseMove()):(this.mxOnFocusEnter=this.mx,this.myOnFocusEnter=this.my,this.$marginInput.focus(),this.$marginInput.select())},onInputFocus:function(){this.state="focus"},onInputBlur:function(){this.state="idle",this.controller.block.isEditMode&&this.controller.block.editor.focus()},onInputChange:function(t,e){this.data&&this.applyStyle(this.data.tp,e)},applyStyle:function(t,e){for(var i=this.controller.block.needSideMarginsSynhronized,s=!i||"left"!=t&&"right"!=t?this.paragraphs:this.controller.block.$iframe_body.find("p"),o=0;o<s.length;o++){var n=s[o];"top"==t&&(n.style.paddingTop=e+"px"),"bottom"==t&&(n.style.paddingBottom=e+"px"),"left"==t&&(n.style.paddingLeft=e+"px",i&&(n.style.paddingRight=e+"px")),"right"==t&&(n.style.paddingRight=e+"px",i&&(n.style.paddingLeft=e+"px")),n.setAttribute("data-mce-style",n.getAttribute("style"))}var a={};a["padding-"+t]=e+"px",this.controller.block.somethingChangedInEditor("margins",a)},onMouseMove:function(t){if(this.shown&&(t&&(this.mx=t.pageX,this.my=t.pageY),this.mouseProceeding)){if(this.getEditorDimensions(),"idle"==this.state){var e=this.controller.params.handleThreshold;if(this.mx<this.editorLeft-e||this.mx>=this.editorLeft+this.editorWidth+e||this.my<this.editorTop-e||this.my>=this.editorTop+this.editorHeight+e)this.hideHandle();else{for(var i=!1,s=0;s<this.marginHandles.length;s++){var o,n,r=this.marginHandles[s],l=this.editorLeft-this.scrollLeft+r.x,c=this.editorTop-this.scrollTop+r.y;if("top"==r.tp&&(n=e,o=r.size,c-=e-1),"bottom"==r.tp&&(n=e,o=r.size),"left"==r.tp&&(o=e,n=r.size,l-=e-1),"right"==r.tp&&(o=e,n=r.size),!(this.mx<l||this.mx>=l+o||this.my<c||this.my>=c+n)){this.curHoverMarginHandle!=r&&(this.data=a.a.clone(r),this.initialData=a.a.clone(r),this.showHandle("only-line"),this.curHoverMarginHandle=r),i=!0;break}}i||this.hideHandle()}}"dragging"==this.state&&this.updateHandleLabelPos()}},getEditorDimensions:function(){var t=this.controller.block.$el[0].getBoundingClientRect();this.editorWidth=t.width,this.editorHeight=t.height,this.editorLeft=t.left,this.editorTop=t.top},showHandle:function(t){var e=this.data;if(e){var i,s,o=e.x-this.scrollLeft,n=e.y-this.scrollTop;if(e.limited_x=e.x,e.limited_y=e.y,e.limited_size=e.size,"top"==e.tp||"bottom"==e.tp){var a=!1;(n<0||n>=this.editorHeight)&&(a=!0),(o>=this.editorWidth||o+e.size<=0)&&(a=!0),this.$el.toggleClass("out-of-box",a),o<0?(e.limited_x=e.x-o,e.limited_size=e.size+o,o=0):o+e.size>this.editorWidth&&(e.limited_size=this.editorWidth-o)}if("left"==e.tp||"right"==e.tp){a=!1;(o<0||o>=this.editorWidth)&&(a=!0),(n>=this.editorHeight||n+e.size<=0)&&(a=!0),this.$el.toggleClass("out-of-box",a),n<0&&n+e.size>this.editorHeight?(e.limited_y=e.y-n,e.limited_size=this.editorHeight,n=0):n<0?(e.limited_y=e.y-n,e.limited_size=e.size+n,n=0):n+e.size>this.editorHeight&&(e.limited_size=this.editorHeight-n)}var r=this.controller.params.handleThreshold;"top"==e.tp&&(s=r,i=e.limited_size,n-=r-1),"bottom"==e.tp&&(s=r,i=e.limited_size),"left"==e.tp&&(i=r,s=e.limited_size,o-=r-1),"right"==e.tp&&(i=r,s=e.limited_size),this.$el.toggleClass("small",e.limited_size<this.controller.params.minHandleSize),this.$el.css({left:o,top:n,width:i,height:s}),"show"!=t&&"update"!=t||(this.inputChangeValue&&this.inputChangeValue(e.val,!0),this.inputChangeMinMax&&this.inputChangeMinMax(0,e.max)),"show"!=t&&"only-line"!=t||this.$el.removeClass("margin-top").removeClass("margin-bottom").removeClass("margin-left").removeClass("margin-right").addClass("margin-"+e.tp),"show"==t&&this.$el.removeClass("inactive"),"only-line"==t&&this.$el.addClass("only-line")}},hideHandle:function(){this.$el.addClass("inactive"),this.$el.removeClass("only-line"),this.$el.removeClass("out-of-box"),this.data=void 0,this.initialData=void 0,this.state="idle",this.curHoverMarginHandle=void 0,this.mouseProceeding=!0},updateHandleLabelPos:function(t){if(this.data){var e=this.$el.find(".margin-handle-label-wrapper"),i=t?this.mxOnFocusEnter:this.mx,s=t?this.myOnFocusEnter:this.my;if("top"==this.data.tp||"bottom"==this.data.tp){var o=i-(this.editorLeft-this.scrollLeft+this.data.limited_x),n=e.width();o-=Math.round(n/2),o=Math.min(Math.max(o,0),this.data.limited_size-n),e.css({left:o,top:"auto"})}else{var a=s-(this.editorTop-this.scrollTop+this.data.limited_y),r=e.height();a-=Math.round(r/2),a=Math.min(Math.max(a,0),this.data.limited_size-r),e.css({top:a,left:"auto"})}}},proceed:function(t,e){this.marginHandles=t,this.paragraphs=e,this.initialData&&(this.data=this.getClosestDataToInitial(),this.data?(this.getEditorDimensions(),this.showHandle("update"),"focus"==this.state&&this.updateHandleLabelPos(!0)):this.hideHandle()),this.onMouseMove()},getClosestDataToInitial:function(){for(var t=[],e=0;e<this.marginHandles.length;e++){var i=this.marginHandles[e];i.p==this.initialData.p&&i.tp==this.initialData.tp&&t.push(i)}if(t.length){var s=99999,o=-1;for(e=0;e<t.length;e++){var n=Math.abs(t[e].column-this.initialData.column);n<s&&(s=n,o=e)}return a.a.clone(t[o])}},onScroll:function(t,e){this.scrollTop=t,this.scrollLeft=e,this.showHandle("update")},show:function(){this.shown=!0,Object(s.a)(document).on("mousemove",this.onMouseMove),this.onMouseMove(),this.$el.removeClass("hidden")},hide:function(){this.shown=!1,Object(s.a)(document).off("mousemove",this.onMouseMove),this.$el.addClass("hidden"),this.hideHandle()}}),S=n.a.Model.extend({initialize:function(t){a.a.bindAll(this),this.block=t,this.undoIndex=-1,this.undoStack=[],this.add.__debounced=a.a.debounce(this.add,50),this.historyTriggers={},this.block.$iframe_body.bind("keydown","ctrl+z",this.undo).bind("keydown","ctrl+shift+z",this.redo),this.block.$iframe_body.bind("keydown","meta+z",this.undo).bind("keydown","meta+shift+z",this.redo)},add:function(t,e,i,s){if(this.block.isEditorActive()){var o,n=this,r=n.block.page.getCurrentViewport(),l=function(t){return t.split("<").length-1}(t=t||"<p></p>"),c=this.undoStack[this.undoIndex];if(-1==this.undoIndex||c.content!=t||r!=c.viewport){if("enterEditMode"==e&&(this.undoIndex>=0&&c.start&&(this.undoIndex--,this.undoStack.length=this.undoIndex+1,c=this.undoStack[this.undoIndex]),-1!=this.undoIndex&&r==c.viewport||w({mergable:!1,start:!0}),this.historyTriggers&&this.historyTriggers.triggerChange&&this.historyTriggers.triggerChange(this.block.pid)),"paste"==e&&w({mergable:!1}),"formatApplied"==e)if(this.undoIndex>=0&&c.formatParams&&r==c.viewport){var h=a.a.keys(c.formatParams),d=a.a.keys(s);if(0==a.a.difference(h,d).length&&(o=d,0!=a.a.intersection(o,["font-size","line-height","letter-spacing","color","padding-top","padding-bottom","padding-left","padding-right"]).length)){var p=v(),u=c.initialSelection;p.startOffset==u.startOffset&&p.endOffset==u.endOffset&&a.a.isEqual(p.startNodePosition,u.startNodePosition)&&a.a.isEqual(p.endNodePosition,u.endNodePosition)?(c.content=t,c.formatParams=s,c.selection=v(),c.initialSelection=a.a.clone(c.selection),this.undoStack.length=this.undoIndex+1):w({mergable:!1,formatParams:s})}else w({mergable:!1,formatParams:s})}else w({mergable:!1,formatParams:s});if("keydown"==e&&this.undoIndex>=0)if(c.tagsCount!=l)w({mergable:!1});else{var g=_(c.content),m=_(t),f=g.length<=m.length;if(c.mergable)if(Math.abs(g.length-m.length)>2)w({mergable:!0,increasing:f});else if(f!=c.increasing||r!=c.viewport)w({mergable:!0,increasing:f});else{p=v(),u=c.initialSelection;Math.abs(p.startOffset-u.startOffset)>2||!a.a.isEqual(p.startNodePosition,u.startNodePosition)?w({mergable:!0,increasing:f}):(c.content=t,c.selection=v(),c.initialSelection=a.a.clone(c.selection),this.undoStack.length=this.undoIndex+1)}else w({mergable:!0,increasing:f})}}else this.undoIndex>=0&&(c.selection=v())}function v(){var t=i.getRangeAt(0)||{};if(t.startContainer&&"BODY"!=t.startContainer.tagName){var e={};return e.startOffset=t.startOffset,e.endOffset=t.endOffset,t.startContainer==t.endContainer?(e.sameNode=!0,e.startNodePosition=b(t.startContainer),e.endNodePosition=e.startNodePosition):(e.sameNode=!1,e.startNodePosition=b(t.startContainer),e.endNodePosition=b(t.endContainer)),e}}function b(t){for(var e=[];;){if("BODY"==t.tagName)break;if(e.push(i(t)),!(t=t.parentNode)||!t.tagName)break}return e;function i(t){for(var e=0;null!=(t=t.previousSibling);)t.textContent&&++e;return e}}function _(t){return t.replace(/&\S+?;/gim,"$")}function w(e){e=e||{},n.undoIndex++,n.undoStack[n.undoIndex]={content:t,mergable:e.mergable,tagsCount:l,increasing:e.increasing,formatParams:e.formatParams,viewport:r,start:e.start,selection:v()},n.undoStack[n.undoIndex].initialSelection=a.a.clone(n.undoStack[n.undoIndex].selection),n.undoStack.length=n.undoIndex+1,c=n.undoStack[n.undoIndex],n.historyTriggers&&n.historyTriggers.triggerChange&&n.historyTriggers.triggerChange(n.block.pid)}},undo:function(t){if(t&&t.stopPropagation&&(t.stopPropagation(),t.preventDefault()),this.block.isEditorActive()&&this.undoIndex>0){if(this.undoStack[this.undoIndex-1].viewport!=this.block.page.getCurrentViewport())return;this.undoIndex--,this.restoreState(this.undoIndex),this.block.somethingChangedInEditor("undo"),this.historyTriggers.triggerChange&&this.historyTriggers.triggerChange(this.block.pid),this.historyTriggers.triggerUndo&&this.historyTriggers.triggerUndo(this.block.pid)}},redo:function(t){if(t&&t.stopPropagation&&(t.stopPropagation(),t.preventDefault()),this.block.isEditorActive()&&this.undoIndex<this.undoStack.length-1){if(this.undoStack[this.undoIndex+1].viewport!=this.block.page.getCurrentViewport())return;this.undoIndex++,this.restoreState(this.undoIndex),this.block.somethingChangedInEditor("redo"),this.historyTriggers.triggerChange&&this.historyTriggers.triggerChange(this.block.pid),this.historyTriggers.triggerRedo&&this.historyTriggers.triggerRedo(this.block.pid)}},getLength:function(t){for(var e=0,i=this.block.page.getCurrentViewport();this.undoIndex-e>=0&&this.undoStack[this.undoIndex-e].viewport==i;)e++;return{undo:e-1,redo:this.undoStack.length-1-this.undoIndex,page:t}},restoreState:function(t){this.block.editor.setContent(this.undoStack[t].content||"");var e=this.undoStack[t].selection,i=this;if(e){var s,o=a(e.startNodePosition);if(s=e.sameNode?o:a(e.endNodePosition),o&&s)try{var n=this.block.iframe_document.createRange();n.setStart(o,e.startOffset),n.setEnd(s,e.endOffset),this.block.editor.selection.setRng(n)}catch(t){}}function a(t){for(var e=i.block.$iframe_body[0],s=t.length-1;s>=0;s--){if(!(e&&e.childNodes&&e.childNodes.length&&e.childNodes.length>=t[s]+1)){e=void 0;break}e=e.childNodes[t[s]]}return e}}}),P=n.a.View.extend({initialize:function(t){a.a.bindAll(this),this.block=t,this.container=this.block.$(".columns-wrapper-inner")[0],this.columnBlocks=[],this.block.$iframe_document.on("scroll",this.onScroll),this.onScroll()},onScroll:function(){this.scrollTop=this.block.$iframe_document.scrollTop(),this.scrollLeft=this.block.$iframe_document.scrollLeft(),Object(s.a)(this.container).css({top:-this.scrollTop,left:-this.scrollLeft})},recalc:function(){if(this.block.isEditorActive())if(this.block.model.get("column_count")>1){this.block.$(".columns-wrapper").removeClass("single-column");for(var t=this.block.calcColumnsPositions(),e=t.length-1,i=this.prevUsedBlocks?this.prevUsedBlocks:this.columnBlocks.length,s=0;s<i;s++)this.columnBlocks[s].style.display="none";for(s=0;s<e;s++)this.columnBlocks[s]||(this.columnBlocks[s]=this.createNewColumnBlock()),this.render(this.columnBlocks[s],t[s].ed,t[s+1].st-t[s].ed-1);this.prevUsedBlocks=e}else this.block.$(".columns-wrapper").addClass("single-column")},createNewColumnBlock:function(){var t=document.createElement("div");return t.className="gap",this.container.appendChild(t),t},render:function(t,e,i){var s=t.style;s.left=e+"px",s.width=i+"px",s.display="block"},show:function(){this.block.$(".columns-wrapper").removeClass("hidden"),this.onScroll()},hide:function(){this.block.$(".columns-wrapper").addClass("hidden")}}),$=l.a.extend({customResizeHandler:function(t){return this.block.model.get("autosize")&&(this.block.$el.css("width",t.width),t.height=this.block.getContentBoxHeight()),t}}),O=y,T=i("gdoY"),M=i("PhV8"),j=i("Vxjr"),I=r.a.extend({name:"Video",sort_index:4,thumb:"video",icon_color:"#00D73E",MIN_WIDTH:85,MIN_HEIGHT:85,video_controls:["video_settings"],settingsOnCreate:!0,initialize:function(t,e){this.controls=a.a.union(this.video_controls,this.controls),this.initBlock(t,e),void 0===this.model.get("info")&&this.model.set("info",!0,{silent:!0}),t.on("change:video_id",this.draw),this.getEmbed=T.a.video.prototype.getEmbed,this.getCustomVideoPoster=T.a.video.prototype.getCustomVideoPoster,a.a.bindAll(this),this.saveDebounced=a.a.debounce(a.a.bind((function(){this.panel?this.panel.save():t.save()}),this),2e3)},render:function(){this.create(),this.frame.minwidth=this.MIN_WIDTH,this.frame.minheight=this.MIN_HEIGHT,this.$el.addClass("video"),this.draw(),this.triggerReady()},draw:function(){var t=Object(s.a)("<div>").css({width:"100%",height:"100%",position:"absolute"});this.$content.empty().append(t).append(this.getEmbed(a.a.extend(a.a.clone(this.model.attributes),{real:!1}))),this.$iframe=this.$("iframe"),this.$poster=this.$(".poster"),this.$f=null,this.model.get("video_id")&&(this.$el.removeClass("empty"),"Vimeo"===this.model.get("provider_name")&&(this.$f=Object(M.a)(this.$iframe.get(0)),this.$f.addEvent("ready",this.setColor)))},redraw:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.checkNeedRedraw(t,e)&&(r.a.prototype.redraw.apply(this,arguments),(t.hasChanged("info")||t.hasChanged("theme"))&&this.draw(),t.hasChanged("color")&&this.setColor(),(t.hasChanged("custom_thumbnail_url")||t.hasChanged("custom_thumbnail"))&&this.onCustomThumbnailChange(t),this.workspace.trigger("redraw"))},onCustomThumbnailChange:function(t){!0===t.changed.custom_thumbnail&&t.attributes.custom_thumbnail_url||t.changed.custom_thumbnail_url?this.draw():(this.$iframe&&this.$iframe.css("visibility","visible"),this.$poster&&(this.$poster.off(),this.$poster.remove()))},setColor:function(t){this.model.get("provider_name")&&"vimeo"!==this.model.get("provider_name").toLowerCase()||(this.$f||(this.$f=Object(M.a)(this.$iframe.get(0))),this.$f.api("setColor",this.model.get("color")),this.model.hasChanged("color")&&this.saveDebounced())},css:function(t){r.a.prototype.css.apply(this,arguments),t.width&&(this.$iframe&&this.$iframe.attr("width",t.width),this.$poster&&this.$poster.css({width:t.width})),t.height&&(this.$iframe&&this.$iframe.attr("height",t.height),this.$poster&&this.$poster.css({height:t.height}))},getIconStyle:function(t){var e,i,s={},o="./constructor/widgetbar/icons/",n=this.model.get("thumbnail_url");return e=Object(j.b)(o+"video-overlay.svg"),n?(i=Object(j.b)(o+"video-overlay-bg.svg"),s["background-image"]="url("+e+"), url("+i+"), url("+n.replace("-t300x300","-t80x80")+")",s["background-size"]="contain, cover, auto 150%"):(s["background-image"]="url("+e+")",s["background-size"]="contain",s["background-color"]=this.icon_color),t&&t.small||(s["border-radius"]="8px"),s}},{defaults:{thumbnail_url:""}}),E=i("hdsW"),A=i("HlXo"),R=i.n(A),D=r.a.extend({name:"Music",sort_index:5,thumb:"audio",icon_color:"#FF5700",initialize:function(t,e){this.initBlock(t,e),this.inner_template=R.a["template-constructor-block-audio"],this.frameClass=z,this.controls=["audio_settings","common_animation","common_position","common_layer","common_lock"],this.drawDebounced=a.a.debounce(this.draw,500)},render:function(){this.create(),this.applySizeConstraints(),Object(s.a)(this.inner_template(this.model.attributes)).appendTo(this.$content),this.currentPlayer=null,this.lastPlayer=null,this.$el.addClass("audio"),this.draw(),this.$el.addClass("empty"),this.triggerReady()},applySizeConstraints:function(){var t,e,i;"visual"==this.model.get("current_type")&&(t=200,e=200),"standard"==this.model.get("current_type")&&(t=200,e=166,166==this.model.get("embed_height")&&(i=166)),"minimal"==this.model.get("current_type")&&(t=200,e=224,this.model.get("artwork")||(e=83,i=83),this.model.get("artwork")||this.model.get("info")||(e=26,i=26)),this.$el.toggleClass("no-height-resize",e==i),a.a.extend(this.frame,{minwidth:t,maxwidth:void 0,minheight:e,maxheight:i}),this.model.get("w")<this.frame.minwidth&&this.model.set("w",this.frame.minwidth,{silent:!0}),this.model.get("w")>this.frame.maxwidth&&this.model.set("w",this.frame.maxwidth,{silent:!0}),this.model.get("h")<this.frame.minheight&&this.model.set("h",this.frame.minheight,{silent:!0}),this.model.get("h")>this.frame.maxheight&&this.model.set("h",this.frame.maxheight,{silent:!0}),!this.model.get("resized")&&"standard"==this.model.get("current_type")&&this.model.get("embed_height")>166&&this.model.set("h",Math.min(this.model.get("embed_height"),450),{silent:!0}),this.frame.doResize({left:this.model.get("x"),top:this.model.get("y"),width:this.model.get("w"),height:this.model.get("h")})},draw:function(t){this.model.get("parsed_url")?this.lastPlayer=new E.a(a.a.clone(this.model.attributes),this.$content.find(".player-wrapper"),this.playerReady.bind(this)):(this.lastPlayer&&this.lastPlayer.destroy(),this.currentPlayer&&this.lastPlayer!=this.currentPlayer&&this.currentPlayer.destroy(),this.currentPlayer=null,this.lastPlayer=null,this.$el.addClass("empty")),t&&t.triggerRedraw&&this.workspace.trigger("redraw")},getIconStyle:function(t){var e,i,s={},o="./constructor/widgetbar/icons/",n=this.model.get("thumbnail_url");return e=Object(j.b)(o+"audio-overlay.svg"),n?(i=Object(j.b)(o+"audio-overlay-bg.svg"),s["background-image"]="url("+e+"), url("+i+"), url("+n.replace("-t300x300","-t80x80")+")",s["background-size"]="contain, cover, cover"):(s["background-image"]="url("+e+")",s["background-size"]="contain",s["background-color"]=this.icon_color),t&&t.small||(s["border-radius"]="8px"),s},applyMinimalPlayerStyle:function(t){this.currentPlayer&&this.currentPlayer.applyPlayerStyle&&this.currentPlayer.applyPlayerStyle(t),this.workspace.trigger("redraw")},redraw:function(t,e){if(e=e||{},this.checkNeedRedraw(t,e)){r.a.prototype.redraw.apply(this,arguments);var i=this.model.changedAttributes(),s=a.a.isObject(i)&&0==a.a.without(a.a.keys(i),"w","h","x","y","z").length;if(s||this.applySizeConstraints(),a.a.isObject(i))if(null==i.url)if(i.current_type)this.drawDebounced();else{var o=["comments","artwork","socials","playcount","color"],n=["artwork","info","color"];Object(a.a)(["standard","visual"]).contains(this.model.get("current_type"))&&a.a.intersection(a.a.keys(i),o).length&&this.drawDebounced(),"minimal"==this.model.get("current_type")&&a.a.intersection(a.a.keys(i),n).length&&this.applyMinimalPlayerStyle(a.a.clone(this.model.attributes))}else this.draw({triggerRedraw:!0});else this.drawDebounced()}},playerReady:function(t){this.$el.removeClass("empty"),this.lastPlayer==t?(this.currentPlayer&&t!=this.currentPlayer&&this.currentPlayer.destroy(),this.model.get("parsed_url")&&(this.currentPlayer=t,this.currentPlayer.show())):t.destroy()},getBoxData:function(){return a.a.extend(r.a.prototype.getBoxData.apply(this,arguments),{resized:!0})}},{defaults:{current_type:"visual",autoplay:!1,comments:!1,artwork:!0,socials:!0,playcount:!0,info:!0,color:"ff5100",thumbnail_url:"",w:400,x:"center",h:400}}),z=l.a.extend({customResizeHandler:function(t,e,i){if("minimal"==this.block.model.get("current_type")&&this.block.model.get("artwork"))if(e){if("n"!=e&&"s"!=e||(t.width=t.height-24),"w"!=e&&"e"!=e||(t.height=t.width+24),"se"==e&&(t.width>t.height-24?t.height=t.width+24:t.width=t.height-24),"nw"==e||"ne"==e||"sw"==e||"se"==e){var s=t.width+t.left,o=t.height+t.top;t.width>t.height-24?t.height=t.width+24:t.width=t.height-24,"nw"==e&&(t.left=s-t.width,t.top=o-t.height),"ne"==e&&(t.top=o-t.height),"sw"==e&&(t.left=s-t.width)}}else t.height=t.width+24;if(!i){var n=a.a.pick(this.block.model.attributes,"x","y","w","h");n.x==t.left&&n.y==t.top&&n.w==t.width&&n.h==t.height||(this.block._saveXHR&&this.block._saveXHR.abort(),this.block._saveXHR=this.block.model.save({x:t.left,y:t.top,w:t.width,h:t.height}))}return t}}),L=D,B=n.a.View.extend({excludedFromLib:!0,initialize:function(t){this.parent=t.block,this.getEmbed=T.a.video.prototype.getEmbed},render:function(){if(this.setElement(this.parent.$el.find(".video")),this.parent.model.get("video")){var t=a.a.extend({real:!1,id:this.parent.id},this.parent.model.get("video"));this.$el.css({opacity:this.parent.model.get("videoopacity")}),this.$el.find(".container").html(this.getEmbed(t)),this.rendered=!0}},show:function(){this.rendered||this.render(),this.$el.stop().animate({opacity:this.parent.model.get("videoopacity")})},hide:function(){this.$el.stop().animate({opacity:0},{queue:!1})},toggle:function(){this.rendered||this.render(),this.$el.stop().toggleFade()}}),F=i("i7aS"),H=r.a.extend({RESCALE_URL:"/api/imagescale",FINAL_URL:"/api/imagefinal",PREVIEW_URL:"/api/imagepreview",SEARCH_URL:"/api/upload/fromurl",LAMBDA_FROM_URL:"/api/upload/lambda/fromurl",SVG_URL:"/api/imagesvg",flagLambda:function(){return F.a.flagLambda()},allowedLambdaExt:function(){var t=this.model.get("picture");return t?F.a.allowedLambdaExt(t.type):void 0},useLambdaUrl:function(){return F.a.useLambdaUrl(this.model.get("picture"))},getLambdaUrl:function(){return F.a.getLambdaUrl(this.model.get("picture"),{width:this.model.get("w"),height:this.model.get("h"),cropX:this.model.get("cropX"),cropY:this.model.get("cropY"),cropW:this.model.get("cropW"),cropH:this.model.get("cropH"),originalW:this.model.get("originalW"),originalH:this.model.get("originalH")})},getOriginalLambdaUrl:function(){return F.a.getOriginalLambdaUrl(this.model.get("picture"))},getLqipUrl:function(){return F.a.getLqipUrl(this.model.get("picture"),{cropX:this.model.get("cropX"),cropY:this.model.get("cropY"),cropW:this.model.get("cropW"),cropH:this.model.get("cropH"),originalW:this.model.get("originalW"),originalH:this.model.get("originalH")})},getThumbnailUrl:function(){return F.a.getThumbnailUrl(this.model.get("picture"))},removePicture:function(){this.model.unset("picture"),this.model.save({},{silent:!0,toHistory:!0}),this._fromUrlXHR&&this._fromUrlXHR.abort(),this._getFinalRequest&&this._getFinalRequest.abort()},getPictureUrl:function(){var t=this.model.get("picture");return t?this.useLambdaUrl()?this.getLambdaUrl():Modernizr.retina&&t.final2xUrl||t.finalUrl||t.unscaledOptimizedUrl||t.url:""},getVectorUrl:function(){var t=this.model.get("picture");return t?t.editedVectorUrl||t.url:""},getOpacity:function(){var t=this.model.get("opacity");return a.a.isNumber(t)?t:1},getFinalImage:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.useLambdaUrl()){var i=this.model.get("picture"),o=this.model.isNested?"default":e.viewport||this.model.collection.page.getCurrentViewport(),n=this.model.get("w");if(n!==this.model.get("w"))return;this.isFullWidth()&&this.model.set("w",this.getFullWidthDims().w,{silent:!0}),this.isFullHeight()&&this.model.set("h",this.getFullHeightDims().h,{silent:!0}),this.model.save("picture",i,a.a.extend(e||{},{viewport:o})),t&&t(null)}else{var r=this.model.get("picture");if(!r||!r.url)return t&&t(null);var l=this.model.isNested?"default":e.viewport||this.model.collection.page.getCurrentViewport(),c=this.model.get("w");this._getFinalRequest&&this._getFinalRequest.abort(),this.showTempPreloader&&this.showTempPreloader(),this._getFinalRequest=s.a.ajax({type:"POST",data:this.model.attributes,url:this.FINAL_URL,success:function(i){this.hideTempPreloader()&&this.hideTempPreloader(),c===this.model.get("w")&&(this.isFullWidth()&&this.model.set("w",this.getFullWidthDims().w,{silent:!0}),this.isFullHeight()&&this.model.set("h",this.getFullHeightDims().h,{silent:!0}),this.model.save("picture",a.a.extend({},r,i),a.a.extend(e||{},{viewport:l})),t&&t(null,i))},error:function(e){t&&t(e.responseText)},context:this})}},requestFinalImage:function(t,e){s.a.ajax({type:"POST",data:t,url:this.FINAL_URL,success:function(t){e&&e(t)}})},loadPreviewUrl:function(t,e){var i=this.model.get("picture");i&&s.a.ajax({type:"GET",data:{width:t.w,height:t.h,url:i.rasterUrl||i.url,mid:this.workspace.mag.get("num_id")},url:this.PREVIEW_URL,success:a.a.bind((function(t){i.previewUrl=t&&t.previewUrl,this.model.save({picture:i},{silent:!0,toHistory:!0}),e&&e.success(t)}),this)})},loadFromUrl:function(t,e){var i=e||{};return this._fromUrlXHR&&this._fromUrlXHR.abort(),this._fromUrlXHR=s.a.ajax({type:"POST",data:{url:t,id:this.model.id,name:this.name,uploadType:"picture",mid:this.workspace.mag.get("num_id")},url:this.flagLambda()?this.LAMBDA_FROM_URL:this.SEARCH_URL,context:this,success:function(t){this.changePicture(t,i),i.success&&"function"==typeof i.success&&i.success()},error:function(t,e){if(i.error&&"function"==typeof i.error&&i.error(),!e||"abort"!==e)return t&&413===t.status?alert(d.a.MSG_UPLOAD_IMAGE_SIZE_ERROR):void alert("There's something wrong with this picture. Please, try the different one.")}}),this._fromUrlXHR},isVector:function(t,e){var i=this.model.get("picture"),s=t||i&&i.url;return"svg"===(e||i&&i.type)||s&&0===a.a.last(s.split(".")).indexOf("svg")},isAnimated:function(){return this.model.get("picture")&&"gif"===this.model.get("picture").type},loadVector:function(t){if(t=t||{},this.svgAjax&&this.svgAjax.abort(),this.$svg&&this.$svg.remove(),delete this.$svg,delete this.$svgColoredElems,delete this.originalSvg,delete this.originalSize,this.isVector()){var e=this.getVectorUrl();this.svgAjax=s.a.get(e+"?c",a.a.bind((function(i){this.$svg=Object(s.a)(i).find("svg"),this.originalSize={width:this.$svg.attr("width"),height:this.$svg.attr("height")},this.$svg.removeAttr("width").removeAttr("height");var o=Object(s.a)(i).find("svg").get(0).cloneNode(!0),n=new Image;Object(s.a)(n).on("load error",a.a.bind((function(){Object(s.a)(n).appendTo(window.document.body).css({width:"100%",height:"100%"});var t=Object(s.a)(o);t.get(0).setAttribute("viewBox","0 0 "+Object(s.a)(n).width()+" "+Object(s.a)(n).height()),t.appendTo(window.document.body);var e=t.get(0).getBBox();this.$svg.get(0).setAttribute("viewBox",e.x+" "+e.y+" "+e.width+" "+e.height),this.$svg.get(0).setAttribute("preserveAspectRatio","xMidYMid meet"),Object(s.a)(n).remove(),t.remove()}),this)),n.src=this.getVectorUrl(),this.originalSvg=i,this.getVectorUrl()==e&&(t.success&&t.success(this.$svg),this.model.get("picture").editedVectorUrl||this.pickVectorColor(t))}),this)).always(a.a.bind((function(){delete this.svgAjax}),this)).fail(t.error||s.a.noop)}},pickVectorColor:function(t){if(this.$svg){var e=[],i=[],o=[],n=function(t,s){var n=e.indexOf(t);t&&/^#\w+$/.test(t)&&(-1==n?(e.push(t),i.push(1)):i[n]++),o.push(s)},r=Object(s.a)("<div></div>");this.$svg.find("*").each((function(){r.attr("style",Object(s.a)(this).attr("style"));var t=r.css("fill");return t?n(t,Object(s.a)(this)):Object(s.a)(this).attr("fill")?n(Object(s.a)(this).attr("fill"),Object(s.a)(this)):void 0}));var l=i.indexOf(a.a.max(i)),c=e[l];c&&/^#?\w\w\w$/.test(c)&&(c=[c[0],c[1],c[1],c[2],c[2],c[3],c[3]].join("")),c||(c="#ffffff"),c=c&&c.toLowerCase(),this.model.get("pic_color")||(c&&this.model.set({pic_color:c.substr(1),pic_opacity:1},{patch:!0,skipTriggerRedraw:!0}),this.changeControls&&this.changeControls()),c&&(this.$svgColoredElems=o)}},setVectorColor:function(t,e){if(this.$svgColoredElems){var i=Object(s.a)("<div></div>");a.a.each(this.$svgColoredElems,(function(t){i.attr("style",t.attr("style")),i.css({fill:"","fill-opacity":""}),t.get(0).setAttributeNS(null,"style",i.attr("style")),t.get(0).setAttributeNS(null,"fill",""),t.get(0).setAttributeNS(null,"fill-opacity","")})),delete this.$svgColoredElems}this.$svg.get(0).setAttributeNS(null,"fill","#"+t),this.$svg.get(0).setAttributeNS(null,"fill-opacity",e)},saveSvg:function(t){if(this.originalSvg&&this.originalSize){var e=this.originalSvg.importNode(this.$svg[0],!0);return Object(s.a)(e).attr("width",this.originalSize.width).attr("height",this.originalSize.height).css("display",""),s.a.ajax({url:this.SVG_URL,type:"POST",data:{svg:(new XMLSerializer).serializeToString(e),mid:this.workspace.mag.get("num_id")},success:function(e){this.model.get("picture").editedVectorUrl=e&&e.editedVectorUrl,delete this.model.get("picture").finalUrl,delete this.model.get("picture").final2xUrl,t&&t()},context:this})}}}),N=i("0zSa"),V=i("tf3M"),U=i("WoDZ"),W=H.extend({name:"Background",thumb:"bg",outofbox:!0,excludedFromLib:!0,immortal:!0,controls:[],defaultSlideshow:{delay:4,crossfade:.5,pictures:[]},viewport_fields:c.b.viewport_fields.background,initialize:function(t,e){this.initBlock(t,e),void 0===this.model.get("mute")&&this.model.set("mute",!0,{silent:!0}),void 0===this.model.get("loop")&&this.model.set("loop",!0,{silent:!0}),this.createEl(),this.hide(),this.workspace.on("show",this.show),this.workspace.on("hide",this.hide),this.workspace.$el.parent().on("scroll",this.onScroll),this.on("loadimage",this.onLoadImage),this.on("unloadimage",this.onUnloadImage)},createEl:function(){this.setElement(Object(s.a)('<div class="background"><div class="picture smooth3d"></div>       <div class="slideshow-container"></div><div class="slideshow-preload"></div><div class="video">       <div class="overlay"></div>       <div class="container"></div>       </div></div></div>').appendTo(Object(s.a)("#main-background"))),this.$picture=this.$(".picture"),this.$video=this.$(".video"),this.$color=this.$el,this.$slideshow=this.$(".slideshow-container"),this.$slideshowPreload=this.$(".slideshow-preload"),this.video=new B({block:this}),this.slideshowWidget=new N.a({data:this.model.get("slideshow"),container:this.$slideshow,preloadContainer:this.$slideshowPreload})},validate:function(){var t=a.a.difference(c.b.viewport_fields.background,c.b.viewport_fields_common);this.model.fillMissingFieldsFromDefaultViewport(t)},render:function(){this.updateBGColor(),"picture"===this.model.get("selectedType")&&this.loadPic({success:this.showPic}),"video"===this.model.get("selectedType")&&(this.video.render(),this.onResize()),"slideshow"===this.model.get("selectedType")&&this.slideshowWidget.render(!0),this.rendered=!0,this.triggerReady()},updateBGColor:function(){var t=this.model.get("color")||"FFFFFF";this.$color.css({"background-color":"#"+t})},onViewportUpdate:function(t){"default"===t.viewport?(this.$el.removeClass("is-viewport"),this.$picture.css({width:"",height:"",top:"",left:"","margin-left":"","margin-top":""}),this.$slideshow.css({width:"",height:"",top:"",left:"","margin-left":"","margin-top":""})):(this.$el.addClass("is-viewport"),this.$picture.css({width:t.width,height:t.min_height,top:"50%",left:"50%","margin-left":-t.width/2,"margin-top":-t.min_height/2}),this.$slideshow.css({width:t.width,height:t.min_height,top:"50%",left:"50%","margin-left":-t.width/2,"margin-top":-t.min_height/2})),this.lastViewportParams=t},getIconStyle:function(){var t=this.model.get("picture"),e=this.model.get("video"),i=this.model.get("selectedType"),s={background:"#"+this.model.get("color")};if("picture"===i){if(t&&t.thumbUrl)return{"background-image":"url("+t.thumbUrl+")"}}else if("video"===i){if(e&&e.thumbnail_url)return{"background-image":"url("+e.thumbnail_url+")"}}else if("slideshow"===i){var o=this.model.get("slideshow");if(o&&o.pictures&&Array.isArray(o.pictures)&&o.pictures.length)return{"background-image":"url("+a.a.sortBy(o.pictures,"num")[0].thumbUrl+")"}}return s},changePicture:function(t,e){var i=this.workspace.page.getCurrentViewport();e=a.a.defaults(e||{},{save:!0});var s={picture:t.picture};"default"===i&&a.a.each(V.default.viewports,function(t){a.a.isEmpty(this.model[t])||this.model.set({picture:s.picture},{viewport:t.replace(/^viewport_/,""),silent:!0})}.bind(this)),e.save?this.model.save(s,e):this.model.set(s,e)},onResize:function(){if("video"===this.model.get("selectedType")){var t=this.model.get("video"),e=this.$el.find(".container");!a.a.isEmpty(t)&&t.provider_name&&U.a.setVideoPosition({$container:e,$media:e.find("iframe"),provider:t.provider_name,aspect_poster:t.aspect_poster,aspect_real:"vimeo"==t.provider_name.toLowerCase()?t.aspect_real:t.aspect_poster,controls_remove:!0})}},show:function(){var t=this.$el.parent();this.$el.detach().appendTo(t).stop().animate({opacity:1}),this.onResize(),Object(s.a)(window).on("resize",this.onResize)},hide:function(){this.$el.stop().animate({opacity:0}),"slideshow"===this.model.get("selectedType")&&this.slideshowWidget&&this.slideshowWidget.isAnimationRunning&&this.slideshowWidget.stopAnimationLoop(),Object(s.a)(window).off("resize",this.onResize)},saveSlideshowPicture:function(t,e){var i,s,o=this.workspace.page.getCurrentViewport(),n=this.model.get("slideshow"),r=n&&n.pictures&&Array.isArray(n.pictures)&&n.pictures.length,l=Object.assign({},t.picture,t.size),c=1;r?(s=a.a.cloneWithObjects(n),c=this.getMaxNum(n.pictures)+1,i=Object.assign(l,{num:c,uuid:d.b.generateUUID()}),s.pictures.push(i),s.pictures=a.a.sortBy(s.pictures,"num")):(s=a.a.cloneWithObjects(this.defaultSlideshow),i=Object.assign(l,{num:c,uuid:d.b.generateUUID()}),s.pictures=[i]);var h={slideshow:s};"default"==o&&a.a.each(V.default.viewports,function(t){a.a.isEmpty(this.model[t])||this.model.set({slideshow:h.slideshow},{viewport:t.replace(/^viewport_/,""),silent:!0})}.bind(this)),e.save?this.model.save(h,e):this.model.set(h,e),this.addPictureToSlideshow(i)},updateSlideshowPicture:function(t,e){var i=this.model.get("slideshow"),s=i.pictures.findIndex((function(t){return t.uuid===e.id})),o=Object.assign({},i.pictures[s],t.picture,t.size),n=a.a.cloneWithObjects(i);n.pictures[s]=o;var r={slideshow:n};this.model.save(r,e),this.slideshowWidget.updatePicture(o)},selectSlideshowPicture:function(t){this.slideshowWidget.selectSlide(t)},deleteSlideshowPicture:function(t){this.slideshowWidget.removePicture(t)},updateSlideshowPicturePosition:function(t){this.slideshowWidget.updatePicturePosition(t)},getMaxNum:function(t){return a.a.isEmpty(t)?0:a.a.max(a.a.pluck(t,"num"))},addPictureToSlideshow:function(t){this.slideshowWidget.addPicture(t)},updateSideshowDelay:function(t){this.slideshowWidget.setDelay(t)},updateSideshowCrossfade:function(t){this.slideshowWidget.setCrossfade(t)},runSlideshow:function(){this.slideshowWidget&&this.slideshowWidget.runAnimation()},stopSlideshow:function(){this.slideshowWidget&&this.slideshowWidget.stopAnimationLoop()},loadPic:function(t){t=t||{},this.cancelPictureLoading(),t.url||(t.url=this.getPictureUrl()),this.picUrl=t.url;var e=a.a.isFunction(t.success)?t.success:s.a.noop,i=a.a.isFunction(t.error)?t.error:s.a.noop;if(!this.picUrl)return e();var o=this._loadingPic=Object(s.a)("<img>").addClass("preload_image").appendTo("body").attr("src",this.picUrl).on("load",e).on("error",i).on("load",a.a.bind((function(){this.trigger("loadimage","main"),a.a.defer(function(){o==this._loadingPic&&this.cancelPictureLoading(),o=null}.bind(this))}),this)).on("error",a.a.bind((function(){a.a.defer(function(){o==this._loadingPic&&this.cancelPictureLoading(),o=null}.bind(this))}),this))},cancelPictureLoading:function(){this._loadingPic&&this._loadingPic.off("load").off("error").removeAttr("src").remove(),this._loadingPic=void 0},previewPic:function(t,e){if(t&&"svg"==a.a.last(t.split(".")))return e&&e.error&&e.error();e=e||{},this.loadPic({url:t,error:e.error,success:a.a.bind((function(){this.renewPic(),a.a.isFunction(e.success)&&e.success()}),this)})},onLoadImage:function(t){"preview"==t&&(this.previewLoaded=!0),"main"==t&&(this.mainLoaded=!0),this.panel?this.previewLoaded&&this.mainLoaded&&this.trigger("imagesReady"):this.mainLoaded&&this.trigger("imagesReady")},onUnloadImage:function(t){"preview"==t&&(this.previewLoaded=!1),"main"==t&&(this.mainLoaded=!1)},showPic:function(){this.$picture.stop().animate({opacity:this.model.get("opacity")}),this.$picture.css({"background-image":this.picUrl?"url("+this.picUrl+")":""})},redraw:function(t,e){e=e||{},this.checkNeedRedraw(t,e)&&(a.a.isEmpty(t.changed)||(this.validate(),t.hasChanged("color")&&this.updateBGColor(),e.viewportChange&&!e.first&&"slideshow"===t.get("selectedType")&&this.slideshowWidget.rerender(t.get("slideshow")),t.hasChanged("picture")&&this.getPictureUrl()!=this.picUrl&&"picture"==t.get("selectedType")&&(this.getPictureUrl()?(this.trigger("unloadimage","main"),this.on("imagesReady",this.renewPic),this.loadPic()):this.loadPic({success:this.showPic})),t.hasChanged("opacity")&&this.$picture.css("opacity",this.model.get("opacity")),"video"===t.get("selectedType")&&(t.hasChanged("videoopacity")&&this.$video.css("opacity",this.model.get("videoopacity")),t.hasChanged("video")&&this.onResize()),t.hasChanged("selectedType")&&("picture"===this.model.get("selectedType")?this.loadPic({success:a.a.bind((function(){this.video.hide(),this.$slideshow.animate({opacity:0}),this.slideshowWidget.stopAnimationLoop(),this.showPic()}),this)}):"video"===this.model.get("selectedType")&&e.viewportChange&&!e.first?(this.$picture.stop().animate({opacity:0}),this.$slideshow.animate({opacity:0}),this.slideshowWidget.stopAnimationLoop(),this.video.show(),this.onResize()):"slideshow"===this.model.get("selectedType")?(this.$picture.stop().animate({opacity:0}),this.video.hide(),this.$slideshow.animate({opacity:1}),this.slideshowWidget.runAnimation()):(this.video.hide(),this.$picture.stop().animate({opacity:0}),this.slideshowWidget.stopAnimationLoop(),this.$slideshow.animate({opacity:0}),this.model.get("selectedType")||this.model.set("selectedType","color",{first:!0}))),this.workspace.trigger("redraw")))},renewPic:function(){if(this.off("imagesReady",this.renewPic),this.skipRenew)this.skipRenew=!1;else{var t=this.$el;this.createEl(),this.onViewportUpdate(this.lastViewportParams),this.updateBGColor(),this.$el.css({opacity:0}),this.$el.find(".picture").css({"background-image":this.picUrl?'url("'+this.picUrl+'")':"",opacity:this.model.get("opacity")});var e=this.workspace!=RM.constructorRouter.workspace?0:1;this.$el.animate({opacity:e},(function(){t.remove()}))}},removePicture:function(){this.model.set("picture",null),this.model.save({},{silent:!0,toHistory:!0}),this.$picture.stop().css("background-image","")},preload:function(){this.preloaded||(this.preloaded=!0,this.loadPic({success:a.a.bind((function(){"picture"==this.model.get("selectedType")&&a.a.delay(this.showPic,1e3)}),this)}))},onScroll:function(){if(!Modernizr.mac||!Modernizr.webkit)return!0;var t=this.$picture;t.removeClass("smooth3d"),clearTimeout(this._remove3dTimeout),this._remove3dTimeout=setTimeout((function(){t.addClass("smooth3d")}),1e3)}},{getViewportDefaults:function(t,e,i){var s=r.a.getViewportDefaults(t,e,i);return"video"==t.get("selectedType")&&(s=a.a.extend(s,{selectedType:"color"})),s},defaults:{slideshow:null}}),G=i("rgKy"),q=i.n(G),X=i("a/+O"),K=i.n(X),Y=i("TBxE");function Z(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function J(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var Q=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Z(i,!0).forEach((function(e){J(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Z(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},K.a,{},q.a),tt=H.extend({name:"Picture",sort_index:2,thumb:"picture",icon_color:"#00DDB1",proportional:!0,dontSaveOnResize:!0,tempPicture:null,$preloader:null,initial_controls:["picture_settings","picture_fwpos","picture_crop","picture_1x1","common_animation","picture_link","picture_preview","common_rotation","common_position","common_layer","picture_alt","common_lock"],animated_controls:["picture_settings","picture_fwpos","picture_1x1","picture_link","picture_preview","common_animation","common_rotation","common_position","common_layer","picture_alt","common_lock"],vector_controls:["picture_settings","picture_color","picture_link","picture_preview","common_animation","common_rotation","common_position","common_layer","picture_alt","common_lock"],commonControls:["picture_preview"],commonControlsPositions:[4],viewport_fields:c.b.viewport_fields.picture,initialize:function(t,e){this.initBlock(t,e),this._imgsPreload=[],this.frameClass=et,this._css=function(t){return parseInt(this.css(t),10)},this.setControls(),this.picloaded={},this.setScaledImage.__debounced=a.a.debounce(this.setScaledImage,500),this.setFinal.__debounced=a.a.debounce(this.setFinal,1e3),this.model.skipResponse=!0,this.listenTo(e,"workspace-resize",this.onWorkspaceResizePicture)},initVector:function(){this.setControls(),this.updateControls(),this.loadVector({setColor:!0})},updatePicture:function(t){var e=this.isFullWidth()||this.isFullHeight();t=t||{},this.useLambdaUrl()&&(t.load="originalLambdaUrl"),t.load||(t.load="finalUrl"),Modernizr.retina&&"finalUrl"===t.load&&(t.load="final2xUrl"),(e||RM.constructorRouter.zoom.getZoom()>1)&&(t.load="unscaledUrl"),(this.isVector()||this.isAnimated())&&(t.load="editedVectorUrl",this.model.get("picture")[t.load]||(t.load="url")),!this.flagLambda()&&this.model.get("picture")&&this.model.get("picture").originalLambdaUrl&&(t.load="unscaledUrl"),this.cropmode||this.fakingMode||this.fwposmode||this.changeControls();var i=this.model.get("picture")&&this.model.get("picture")[t.load];if(e&&!i&&(i=this.model.get("picture")&&this.model.get("picture").url),!i&&!this.model.get("picture"))return this.$picture&&this.$picture.remove(),this.$el.addClass("empty"),void this.has_parent_block;if(this.flagLambda()||i||(i=this.model.get("picture").url,t.renewRatio=!0),t.renewRatio)a.a.defer(function(){this.fixSize(t)}.bind(this));else{var o=this,n=this.$content;this.$el.removeClass("empty"),t.skipAnimation&&n.children().remove(),this._preload(t.load,(function(e){if((o.isVector||!o.cropmode&&!o.in_constrained_crop_mode||"url"===t.load)&&!o.fakingMode&&(o.flagLambda()||i===(o.model.get("picture")&&o.model.get("picture")[t.load]))){var r=function(){o.$picture=e,t.complete&&t.complete.call(),e.css({opacity:1}),n.children().not(":last").remove(),o.updateSettings()};if(n.children().stop(!1,!0).css({opacity:1}),t.prepare&&t.prepare(e),o.$picture&&!t.skipAnimation&&e.css("opacity",0),o.isVector()){var l=document.importNode(e.get(0),!0),c=Object(s.a)('<div class="svg-scale-wrapper"></div>');c.append(l),n.append(c),o.$svg=Object(s.a)(l),e=o.$svg}else e.appendTo(n);F.a.flagLQIP()&&n.css("border-radius",""),o.updateSettings(e),o.$picture&&!t.skipAnimation?e.animate({opacity:1},200,r):r(),o.hideIconLoader(),t.toggledHidden||o.cropmode||a.a.defer(a.a.bind((function(){RM.constructorRouter.workspace.hideLoader()}),o))}}))}},render:function(){this.create(),this.$el.addClass("picture"),this.proportional=!!this.getPictureUrl(),this.useLambdaUrl()&&F.a.flagLQIP()&&(this.model.get("border_radius")&&this.$content.css("border-radius","".concat(this.model.get("border_radius"),"px")),Object(s.a)("<div/>").addClass("lqip").css({"background-image":"url(".concat(this.getLqipUrl(),")"),opacity:void 0===this.model.get("opacity")?1:this.model.get("opacity")}).appendTo(this.$content));var t=this.model.changed&&!1===this.model.changed.hidden;!this.has_parent_block&&this.updatePicture({isNew:this.model.created,isFirst:!0,toggledHidden:t,renewRatio:!this.model.get("ratio")}),this.preloadHiRes(),this.$el.off("dblclick"),this.$el.on("dblclick",this.onDblClick),this.triggerReady(),t||(this.frame.recalcPointsDirections(),this.updateSettings(),this.has_parent_block&&(this.init_file_uploading(),this.enter_constrained_crop_mode()))},init_file_uploading:function(){var t,e;this.has_parent_block?this.$upload_input=this.workspace.$picture_upload_input:(t=Q["template-constructor-helpers-upload-input"],this.$upload_input=Object(s.a)(t())),e=Q["template-constructor-helpers-upload-button"],this.$upload_button=Object(s.a)(e()),this.uploader=new Y.a(this,{fileInput:this.$upload_input}),this.bindUploader(this.uploader),this.$upload_button.on("click",function(){this.$upload_input.trigger("click","stop")}.bind(this)),this.model.on("change:picture",this.toggle_loaded),this.$upload_input.add(this.$upload_button).appendTo(this.$el)},bindUploader:function(t){t.on("start",this.on_start_upload),t.on("done",this.on_done_upload),t.on("fail",this.on_fail_upload)},on_start_upload:function(t,e){this.showIconLoader(),this.originalLoaded=!1,this.workspace.trigger("loading_original_picture")},on_done_upload:function(t,e){e&&e.result?this.changePicture(e.result,{toHistory:this.model.get("picture")}):console.error("error file upload!")},on_fail_upload:function(){this.hideIconLoader()},toggle_loaded:function(){this.model.get("picture")&&(this.isNew=!1),this.model.get("picture")&&(this.$upload_button.removeClass("uploading"),this.in_constrained_crop_mode=!1,this.enter_constrained_crop_mode())},getIconData:function(){return this.isVector()?this:null},getIconStyle:function(t){var e={},i="./constructor/widgetbar/icons/";t&&t.small&&(e["background-color"]=this.icon_color,i+="small/");var s="";return this.model.get("picture")?(this.isVector()?(e["background-color"]=this.icon_color,s=""):(s=this.useLambdaUrl()?this.getThumbnailUrl():this.model.get("picture").thumbUrl,e["background-size"]="cover"),t&&t.small||(e["border-radius"]="8px")):s=Object(j.b)(i+"picture.svg"),e["background-image"]="url(".concat(s,")"),e},controlsIconClasses:function(){return{"panel-picture-alt":this.model.get("alt")?"highlighted":null}},enterCropMode:function(){if(!this.cropmode&&this.model.get("picture"))if(this.in_constrained_crop_mode){if(!this.originalLoaded)return;this._beforeCropAttrs=a.a.clone(this.model.attributes),this.cropmode=!0,this.disableDragging=!0,this.$el.addClass("crop"),p.a.setEmptyHandlers(),Object(s.a)("#main").css("overflow-y","hidden"),this._modeTransition=!1;var t=this.workspace.get_box_data();this.initialCrop={left:t.left_abs+parseInt(this.$el.css("left"))-Math.round(this.model.get("cropX")*this.model.get("scale")),top:t.top_abs+parseInt(this.$el.css("top"))-Math.round(this.model.get("cropY")*this.model.get("scale"))};var e=a.a.clone(this.$picture);e.css({width:Math.round(this.model.get("originalW")*this.model.get("scale")),height:Math.round(this.model.get("originalH")*this.model.get("scale")),top:-Math.round(this.model.get("cropY")*this.model.get("scale")),left:-Math.round(this.model.get("cropX")*this.model.get("scale"))}),this.frame.constraints={top:this.initialCrop.top,left:this.initialCrop.left,width:Math.round(this.model.get("originalW")*this.model.get("scale")),height:Math.round(this.model.get("originalH")*this.model.get("scale"))},this.showBackPic(e),this.bindPictureDrag(),this.trigger("modechanged transitionmode",this.cropmode,this._modeTransition)}else this.storeFixedPosition(),this._beforeCropAttrs=a.a.clone(this.model.attributes),this._getFinalRequest&&this._getFinalRequest.abort(),this.transitionMode(!0),this.frame.removeRotationState(),this.frame.resetRotation(),this.updatePicture({load:"url",prepare:a.a.bind((function(t){this.initialCrop={top:parseInt(this.$el.css("top"))-Math.round(this.model.get("cropY")*this.model.get("scale")),left:parseInt(this.$el.css("left"))-Math.round(this.model.get("cropX")*this.model.get("scale"))},t.css({width:Math.round(this.model.get("originalW")*this.model.get("scale")),height:Math.round(this.model.get("originalH")*this.model.get("scale")),top:-Math.round(this.model.get("cropY")*this.model.get("scale")),left:-Math.round(this.model.get("cropX")*this.model.get("scale"))}),this.showBackPic(t)}),this),complete:a.a.bind((function(){this.frame.enableMouseProceeding(),this.proportional=!1,this.isLocked()&&this.$el.removeClass("no-drag"),this.bindPictureDrag(),this.frame.setConstraints(this.$backpic),this.originalLoaded=!0,this._modeTransition=!1,this.trigger("modechanged transitionmode",this.cropmode,this._modeTransition)}),this)})},enter_constrained_crop_mode:function(){!this.in_constrained_crop_mode&&this.model.get("picture")&&(this.in_constrained_crop_mode=!0,this.proportional=!1,this.originalLoaded=!1,this.workspace.trigger("loading_original_picture"),this.$upload_button.addClass("uploading"),this.updatePicture({load:"url",skipAnimation:!0,prepare:function(t){var e=this.workspace.get_box_data();this.initialCrop={left:e.left_abs+parseInt(this.$el.css("left"))-Math.round(this.model.get("cropX")*this.model.get("scale")),top:e.top_abs+parseInt(this.$el.css("top"))-Math.round(this.model.get("cropY")*this.model.get("scale"))},t.css({width:Math.round(this.model.get("originalW")*this.model.get("scale")),height:Math.round(this.model.get("originalH")*this.model.get("scale")),top:-Math.round(this.model.get("cropY")*this.model.get("scale")),left:-Math.round(this.model.get("cropX")*this.model.get("scale"))}),this.frame.constraints={top:this.initialCrop.top,left:this.initialCrop.left,width:Math.round(this.model.get("originalW")*this.model.get("scale")),height:Math.round(this.model.get("originalH")*this.model.get("scale"))}}.bind(this),complete:function(){this.originalLoaded=!0,this.workspace.trigger("loading_original_picture"),this.$upload_button.removeClass("uploading")}.bind(this)}))},leaveCropMode:function(t){if(this.cropmode&&this.model.get("picture"))if(this.in_constrained_crop_mode)this.leave_crop_mode_to_constrained_crop_mode(t);else{this.isLocked()&&this.$el.addClass("no-drag"),this.hideBackPic(),this.unbindPictureDrag(),this.disableDragging=!1,this.proportional=!0,this.frame.constraints=null,this.transitionMode(!1),this.frame.restoreRotation();var e=this.$picture.position().top,i=this.$picture.position().left,s=this.$picture.width(),o=this.$picture.height();if(this.$picture.css({width:"100%",height:"100%",left:0,top:0,"background-size":s+"px "+o+"px","background-position":i+"px "+e+"px"}),this.restoreFixedPosition(!0),t)this.onLeavingCropMode();else{var n=this;if(this.ratio=this.model.get("cropW")/this.model.get("cropH"),a.a.isEqual(this._beforeCropAttrs,this.model.attributes))return void this.updatePicture({complete:a.a.bind((function(){this.onLeavingCropMode()}),this)});this.getFinalImage((function(t){n.updatePicture({complete:n.onLeavingCropMode})}))}}},leave_crop_mode_to_constrained_crop_mode:function(t){this.unbindPictureDrag(),this._modeTransition=!1,this.disableDragging=!0,this.cropmode=!1,this.trigger("modechanged transitionmode",this.cropmode,this._modeTransition),p.a.removeCustomHandlers(),Object(s.a)("#main").css("overflow-y","auto"),this.$el.removeClass("crop"),this.hideBackPic(),t||(this.ratio=this.model.get("cropW")/this.model.get("cropH"),this.isAnimated()||this.useLambdaUrl()?this.model.save({},{silent:!0,skipHistory:!0}):this.getFinalImage((function(t){t&&console.log("w-picture getFinalImage error: ",t)}),{silent:!0,skipHistory:!0}))},onLeavingCropMode:function(){this.$picture.css({width:"100%",height:"100%",left:0,top:0}),this._modeTransition=!1,this._waitingForRescale&&(this._waitingForRescale=!1,this.setScaledImage())},onLeavingCropResize:function(t){if(!this.cropmode){var e=t.width/this.model.get("cropW");this.$picture.css({left:-this.model.get("cropX")*e,top:-this.model.get("cropY")*e,width:this.model.get("originalW")*e,height:this.model.get("originalH")*e})}},toggleCropMode:function(){this.isVector()||this.trigger("crop_click")},toggleFWPosMode:function(){this.isVector()||this.trigger("fwpos_click")},onDblClick:function(){var t=this.model.get("is_full_width")||this.model.get("is_full_height");t?this.toggleFWPosMode():this.toggleCropMode(),r.a.prototype.onDblClick.apply(this,arguments)},enterFWPosMode:function(){!this.fwposmode&&this.model.get("picture")&&(this.disableDragging=!0,this.fwposmode=!0,this.$el.addClass("fwpos"),this.$el.on("dragend",this.dragFWPosPictureStop),this.$el.on("dragstart",this.dragFWPosPictureStart),this.$el.on("drag",this.dragFWPosPicture))},leaveFWPosMode:function(){this.fwposmode&&this.model.get("picture")&&(this.disableDragging=!1,this.fwposmode=!1,this.$el.removeClass("fwpos"),this.$el.off("dragend",this.dragFWPosPictureStop),this.$el.off("dragstart",this.dragFWPosPictureStart),this.$el.off("drag",this.dragFWPosPicture))},dragFWPosPictureStart:function(t,e){var i=this.model.get("is_full_height"),s=this.model.get("is_full_width");this.frame.disableMouseProceeding(),this.$el.addClass("grabbing"),s&&(e.prev_offsetY=e.offsetY),i&&(e.prev_offsetX=e.offsetX)},dragFWPosPicture:function(t,e){var i=this.model.get("is_full_height"),s=this.model.get("is_full_width"),o=this.model.get("fwpos"),n=this.model.get("fhpos");s&&void 0===e.prev_offsetY&&this.dragFWPosPictureStart(t,e),i&&void 0===e.prev_offsetX&&this.dragFWPosPictureStart(t,e),s&&(o=null==o?50:o,o-=(e.offsetY-e.prev_offsetY)/5,o=Math.min(Math.max(o,0),100),this.model.set({fwpos:o}),e.prev_offsetY=e.offsetY,e.last_fwpos=o),i&&(n=null==n?50:n,n-=(e.offsetX-e.prev_offsetX)/5,n=Math.min(Math.max(n,0),100),this.model.set({fhpos:n}),e.prev_offsetX=e.offsetX,e.last_fhpos=n)},dragFWPosPictureStop:function(t,e){var i=this.model.get("is_full_height"),s=this.model.get("is_full_width");this.frame.enableMouseProceeding(),s&&null!=e.last_fwpos&&this.model.save({fwpos:e.last_fwpos}),i&&null!=e.last_fhpos&&this.model.save({fhpos:e.last_fhpos}),this.$el.removeClass("grabbing")},transitionMode:function(t){this._modeTransition=!0,this.disableDragging=t,this.cropmode=t,this.trigger("modechanged transitionmode",this.cropmode,this._modeTransition),t?(this._scaledimageXHR&&this._scaledimageXHR.abort(),this.frame.disableMouseProceeding(),this.$el.addClass("crop"),this.model.off("change",this.onModelChange),p.a.setEmptyHandlers(),Object(s.a)("#main").css("overflow-y","hidden")):(this.$el.removeClass("crop"),this.model.on("change",this.onModelChange),p.a.removeCustomHandlers(),Object(s.a)("#main").css("overflow-y","auto"))},onCropResize:function(t){if((this.cropmode||this.in_constrained_crop_mode)&&!this._modeTransition){var e,i=this.initialCrop;if(this.in_constrained_crop_mode){var s=this.workspace.get_box_data();e={left:s.left_abs+t.left-i.left,top:s.top_abs+t.top-i.top}}else e={left:t.left-i.left,top:t.top-i.top};this.$picture.css({left:-e.left,top:-e.top});var o=this.model.get("scale"),n=function(t){return t/o},a=Math.round(n(e.left)),r=Math.round(n(e.top)),l=this.fixCropDimensions(a,Math.round(n(t.width)),this.model.get("originalW")),c=this.fixCropDimensions(r,Math.round(n(t.height)),this.model.get("originalH"));this.model.set({cropX:a,cropY:r,cropW:l,cropH:c,ratio:(t.width/t.height).toFixed(5)})}},showBackPic:function(t){this.hideBackPic(),t=t||this.$picture,this.$backpic=t.clone().css({position:"absolute",opacity:.5,"z-index":(this.$content.css("z-index")||this.model.get("z"))-1}).css(this.initialCrop).addClass("backpic").hide().appendTo(this.$el.closest(".workspace")).fadeIn(200),this.$backpic.on("dblclick",this.toggleCropMode)},hideBackPic:function(){this.$el.closest(".workspace").find(".backpic").animate({opacity:0},200,(function(){Object(s.a)(this).remove()}))},bindPictureDrag:function(){this.$el.add(this.$backpic).on("dragend",this.dragCropPictureStop),this.$el.add(this.$backpic).on("dragstart",this.dragCropPictureStart),this.$el.add(this.$backpic).on("drag",this.dragCropPicture)},unbindPictureDrag:function(){this.$el.add(this.$backpic).off("dragend",this.dragCropPictureStop),this.$el.add(this.$backpic).off("dragstart",this.dragCropPictureStart),this.$el.add(this.$backpic).off("drag",this.dragCropPicture)},dragCropPictureStart:function(t,e){var i=a.a.bind(this._css,this.$el),s=a.a.bind(this._css,this.$backpic);if(e.offset={back:{top:s("top"),left:s("left"),width:s("width"),height:s("height")},el:{top:i("top"),left:i("left"),width:i("width"),height:i("height")}},this.has_parent_block){var o=this.workspace.get_box_data();e.offset.el.top+=o.top_abs,e.offset.el.left+=o.left_abs}this.frame.disableMouseProceeding(),this.$el.add(this.$backpic).addClass("grabbing")},dragCropPicture:function(t,e){e.offset||this.dragCropPictureStart(t,e);var i={top:e.offset.back.top+e.deltaY,left:e.offset.back.left+e.deltaX};i.top>e.offset.el.top&&(i.top=e.offset.el.top),i.left>e.offset.el.left&&(i.left=e.offset.el.left),i.left+e.offset.back.width<e.offset.el.left+e.offset.el.width&&(i.left=e.offset.el.left+e.offset.el.width-e.offset.back.width),i.top+e.offset.back.height<e.offset.el.top+e.offset.el.height&&(i.top=e.offset.el.top+e.offset.el.height-e.offset.back.height),this.$backpic.css({top:i.top,left:i.left}),this.$picture.css({top:i.top-e.offset.el.top,left:i.left-e.offset.el.left})},dragCropPictureStop:function(t,e){this.initialCrop={top:parseInt(this.$backpic.css("top")),left:parseInt(this.$backpic.css("left"))},this.frame.enableMouseProceeding(),this.frame.setConstraints(this.$backpic);var i=a.a.bind(this._css,this.$picture),s=parseFloat(this.model.get("scale"),10),o=Math.round(-i("left")/s),n=Math.round(-i("top")/s),r=this.fixCropDimensions(o,this.model.get("cropW"),this.model.get("originalW")),l=this.fixCropDimensions(n,this.model.get("cropH"),this.model.get("originalH"));this.model.set({cropX:o,cropY:n,cropW:r,cropH:l}),this.$el.add(this.$backpic).removeClass("grabbing")},fixCropDimensions:function(t,e,i){var s=t+e-i;return s>0?e-s:e},setActualScale:function(t){this.storeFixedPosition();var e=(t=t||{}).retina?2:1;this._preload("url",a.a.bind((function(t){var i={picture:this.model.get("picture")},s={x:parseInt(this.$el.css("left"))+this.model.get("w")/2-this.model.get("originalW")/2/e,y:parseInt(this.$el.css("top"))+this.model.get("h")/2-this.model.get("originalH")/2/e,w:this.model.get("originalW")/e,h:this.model.get("originalH")/e},o=0,n=0;i.picture.finalUrl=this.model.get("picture").url,i.picture.final2xUrl=i.picture.finalUrl,i.picture.unscaledUrl=i.picture.finalUrl;var r={};r.w=this.model.get("originalW"),r.h=this.model.get("originalH");var l=this.$picture.parent();this.updateSettings(t),t.css({opacity:0}).appendTo(l).animate({opacity:1},200,a.a.bind((function(){this.$picture=t,l.children().not(":last").remove(),this.updateSettings()}),this)),this.$el.animate({top:s.y,left:s.x,width:s.w,height:s.h},a.a.bind((function(){this.model.set(a.a.extend({cropX:o,cropY:n,cropW:s.w*e,cropH:s.h*e,scale:1/e,ratio:s.w/s.h},s,i)),this.restoreFixedPosition(),this.model.save()}),this))}),this))},rescale:function(t,e){e=e||{};var i=a.a.bind(this._css,this.$el),s=e.smooth?"animate":"css",o=this.model.get("originalW")*t,n=this.model.get("originalH")*t;o<i("width")&&(t=(o=i("width"))/this.model.get("originalW"),n=this.model.get("originalH")*t),n<i("height")&&(t=(n=i("height"))/this.model.get("originalH"),o=this.model.get("originalW")*t);var r,l,c=i("width")/2,h=i("height")/2,d=this.model.get("scale"),p=(this.model.get("cropX")*d+c)*t/d-c,u=(this.model.get("cropY")*d+h)*t/d-h;if(p+2*c>o&&(p=o-2*c),p<0&&(p=0),u+2*h>n&&(u=n-2*h),u<0&&(u=0),this.in_constrained_crop_mode){var g=this.workspace.get_box_data();r=g.left_abs+i("left")-p,l=g.top_abs+i("top")-u}else r=i("left")-p,l=i("top")-u;this.$backpic[s]({left:r,top:l,width:o,height:n}),this.initialCrop={left:r,top:l},this.$picture[s]({left:-p,top:-u,width:o,height:n});var m=Math.round(p/t),f=Math.round(u/t),v=this.fixCropDimensions(m,Math.round(this.model.get("w")/t),this.model.get("originalW")),b=this.fixCropDimensions(f,Math.round(this.model.get("h")/t),this.model.get("originalH"));this.model.set({scale:t,cropX:m,cropY:f,cropW:v,cropH:b},e),this.frame.setConstraints(this.$backpic)},fill:function(){if(this.cropmode&&!this._modeTransition){var t=parseInt(this.$el.css("left")),e=parseInt(this.$el.css("top")),i=parseInt(this.$el.height()),s=parseInt(this.$el.width()),o={},n=null,r={},l=this.model.get("originalW")/this.model.get("originalH");this.model.get("ratio")>l?(n=s/this.model.get("originalW"),o={cropX:0,cropY:Math.round((this.model.get("originalH")-i/n)/2),cropW:this.model.get("originalW"),cropH:Math.round(i/n)},r={width:s,height:Math.round(s/l),top:-Math.round(o.cropY*n),left:0}):(n=i/this.model.get("originalH"),o={cropX:Math.round((this.model.get("originalW")-s/n)/2),cropY:0,cropW:Math.round(s/n),cropH:this.model.get("originalH")},r={width:Math.round(i*l),height:i,top:0,left:-Math.round(o.cropX*n)}),this.model.set(a.a.extend({x:t,y:e,w:s,h:i,scale:n.toFixed(15)},o)),this.redrawPosition(this.model,{forceRedraw:!1}),this.$picture.animate(r),this.$backpic.animate({width:r.width,height:r.height,top:e+r.top,left:t+r.left},a.a.bind((function(){var t=a.a.bind(this._css,this.$backpic);this.initialCrop={top:t("top"),left:t("left")},this.frame.setConstraints(this.$backpic)}),this))}},fit:function(){if(this.cropmode&&!this._modeTransition){var t=parseInt(this.$el.css("left")),e=parseInt(this.$el.css("top")),i=parseInt(this.$el.height()),s=parseInt(this.$el.width()),o={cropX:0,cropY:0,cropW:this.model.get("originalW"),cropH:this.model.get("originalH")},n={left:t,top:e,width:s,height:i},r=null,l={},c=this.model.get("originalW")/this.model.get("originalH");this.model.get("ratio")<c?(r=s/this.model.get("originalW"),l={width:s,height:Math.round(s/c),top:Math.round((i-s/c)/2),left:0},n.top=e+l.top,n.height=l.height):(r=i/this.model.get("originalH"),l={width:Math.round(i*c),height:i,top:0,left:Math.round((s-i*c)/2)},n.left=t+l.left,n.width=l.width),this.$picture.animate(l),this.$backpic.animate({width:l.width,height:l.height,top:e+l.top,left:t+l.left},a.a.bind((function(){var t=a.a.bind(this._css,this.$backpic);this.initialCrop={top:t("top"),left:t("left")},this.$el.css(n),this.$picture.css({top:0,left:0}),this.model.set(a.a.extend({x:n.left,y:n.top,w:n.width,h:n.height,scale:r.toFixed(15),ratio:c},o)),this.frame.setConstraints(this.$backpic)}),this))}},setControls:function(){this.isVector()?this.controls=this.vector_controls:this.isAnimated()?this.controls=this.animated_controls:this.controls=this.initial_controls},changePicWithoutRescale:function(t,e){this.flagLambda()||this.isVector(t.picture.url,t.picture.type)||(t.picture.unscaledUrl=t.picture.coalesceUrl||t.picture.url);var i={picture:t.picture,originalW:t.size.width,originalH:t.size.height};if(this.model.set(i,{silent:!0}),this.trigger("picture_added"),e.first=!0,this.fixSize(e),a.a.each(c.b.viewport_list,(function(t){a.a.isEmpty(this.model.get(t))&&a.a.isEmpty(this.model[t])||this.model.set(i,{viewport:t.split("viewport_")[1],silent:!0})}),this),this.has_parent_block){this.model.save();var s={};s.tip_w=this.workspace.block.model.get("tip_w"),s.tip_h=this.workspace.block.model.get("tip_h"),this.workspace.block.model.save(s,{patch:!0,skipHistory:!0}),this.workspace.blocks.forEach((function(t){t.saveBox({patch:!0,skipHistory:!0})}))}},setTempPicture:function(t){if(t&&t.content){this.tempPicture=t.content,this.proportional=!0;var e={size:{width:t.width,height:t.height},picture:{type:t.ext}};this.changePicture(e),this.showTempPreloader()}},removeTempPicture:function(){this.tempPicture=null,this.$picture&&this.$picture.remove(),this.$content.children().remove(),this.$el.addClass("empty"),this.hideTempPreloader(),this.removePicture(),this.changeControls()},showTempPreloader:function(){this.$preloader||(this.$preloader=Object(s.a)("<div/>",{class:"rmpreloader",html:Object(s.a)("<div/>",{class:"arc"})}),this.$el.addClass("preloader"),this.$preloader.appendTo(this.$el))},hideTempPreloader:function(){this.$preloader&&!this.preloaderTimeout&&(this.$el.removeClass("preloader"),this.$preloader.css("opacity",0),this.preloaderTimeout=setTimeout(function(){this.$preloader.remove(),this.$preloader=null,this.preloaderTimeout=null}.bind(this),200))},changePicture:function(t,e){var i=this.model.attributes,s=this.model.getViewport(),o=this.isFullWidth(),n=this.isFullHeight();if(e=a.a.extend(e||{},{isNew:!0}),t.picture&&!t.picture.originalLambdaUrl&&this.tempPicture)return this.changePicWithoutRescale(t,e),this.updatePicture({load:"tempPicture"});if(t.picture&&t.picture.originalLambdaUrl&&this.changePicWithoutRescale(t,e),!i.picture&&!i.scale||!this.has_parent_block&&"gif"===t.picture.type)return this.changePicWithoutRescale(t,e);var r=this,l=function(e){var i,s,l;return e.ratio=e.ratio||e.w/e.h,o?(i=e.full_width_initial_w,s=e.full_width_initial_w/e.ratio):n?(s=e.full_height_initial_h,i=e.full_height_initial_h*e.ratio):(i=e.w,s=e.h),l={originalW:t.size.width,originalH:t.size.height,w:i,h:s,ratio:e.ratio,x:e.x,y:e.y},t.size.width/t.size.height>parseFloat(e.ratio)?(l.scale=l.h/l.originalH,l.cropY=0,l.cropH=l.originalH,l.cropX=Math.max(0,(l.originalW-l.w/l.scale)/2),l.cropW=l.w/l.scale):t.size.width/t.size.height<parseFloat(e.ratio)?(l.scale=l.w/l.originalW,l.cropX=0,l.cropY=Math.max(0,(l.originalH-l.h/l.scale)/2),l.cropW=l.originalW,l.cropH=l.h/l.scale):(l.scale=l.w/l.originalW,l.cropX=0,l.cropY=0,l.cropW=l.originalW,l.cropH=l.originalH),l.picture=a.a.clone(t.picture),r.isVector(t.picture.url,t.picture.type)||(l.picture.unscaledUrl=t.picture.coalesceUrl||t.picture.url),l},c=l(i);if(this.model.set(c,{silent:!0,toHistory:e.toHistory}),this.isVector(c.picture.url,c.picture.type))return this.model.set({pic_color:"",pic_opacity:1},{silent:!0}),this.fixSize();this.isAnimated()?(this.model.save({},e),this.model.trigger("change:picture")):(e.viewport=s,this.getFinalImage(a.a.bind((function(){this.updatePicture.apply(this,arguments);var t=[],e=!1,i=this.model,o=function(o){(t[o]=!0,a.a.all(t)&&e)&&(i.save({},{skipHistory:!0,first:!0}),this.model.getViewport()!==s&&this.updatePicture())}.bind(this),n=a.a.without(a.a.union(V.default.viewports,["viewport_default"]),"viewport_"+this.model.getViewport());a.a.each(n,(function(e,i){return t[i]=!1})),a.a.each(n,(function(i,s){if(t[s]=!1,a.a.isEmpty(this.model[i]))return o(s);var n=l(a.a.extend({},this.model.attributes,this.model[i]));this.useLambdaUrl()?(this.model.set(n,{viewport:i.split("viewport_")[1],silent:!0}),e=!0,o(s)):this.requestFinalImage(a.a.extend({},this.model.attributes,n),a.a.bind((function(t){a.a.extend(n.picture,t),this.model.set(n,{viewport:i.split("viewport_")[1],silent:!0}),e=!0,o(s)}),this))}),this)}),this),e))},redraw:function(t,e){if(e=e||{},this.checkNeedRedraw(t,e)){this.proportional=!!this.getPictureUrl()||this.tempPicture;var i=t.hasChanged("is_full_width")&&t.get("is_full_width")&&!e.viewportChange,s=t.hasChanged("is_full_width")&&!t.get("is_full_width")&&!e.viewportChange,o=t.hasChanged("is_full_height")&&t.get("is_full_height")&&!e.viewportChange,n=t.hasChanged("is_full_height")&&!t.get("is_full_height")&&!e.viewportChange,r=function(){s&&this.model.set({h:this.model.get("w")/this.model.get("ratio")},{silent:!!i}),n&&this.model.set({w:this.model.get("h")*this.model.get("ratio")},{silent:!!o})}.bind(this);this.isDragging||this.isScaling||(this.redrawPosition(t,a.a.extend(e,{forceRedraw:!1})),(i||s||o||n)&&(r(),this.updatePicture(),this.changeControls()),(s||n)&&this.setScaledImage(null,{skipHistory:!0})),t.hasChanged("picture")?e.undo||e.redo?this.onHistoryPictureChange(t,e):e.viewportChange||e.socketUpdate?this.updatePicture({skipAnimation:!0}):(this.onPictureChange(t,e),this.isVector()&&this.initVector()):this.has_parent_block&&(e.undo||e.redo)&&(this.in_constrained_crop_mode=!1,this.enter_constrained_crop_mode()),this.ratio=t.get("ratio")}},redrawPosition:function(t,e){t=t||this.model,H.prototype.redrawPosition.apply(this,arguments),(t.hasChanged("border_size")||t.hasChanged("border_color")||t.hasChanged("border_radius")||t.hasChanged("border_radius_max")||t.hasChanged("opacity")||t.hasChanged("fwpos")||t.hasChanged("fhpos"))&&this.updateSettings()},setPreviewImage:function(t,e){var i=(e=e||{}).success||s.a.noop,o=e.error||s.a.noop,n=this;if(this.previewUrl=t,this._loadingPic&&this._loadingPic.off("load").off("error").removeAttr("src").remove(),this._loadingPic=void 0,!t)return this.$preview&&this.$preview.detach(),void i();this._loadingPic=Object(s.a)("<img>").addClass("preload_image").appendTo("body").attr("src",t).on("load",(function(){n.previewUrl===t&&(n.$preview||(n.$preview=Object(s.a)("<div>")),n.$preview.css({"background-image":'url("'+t+'")',"background-size":"cover","background-position":"50% 50%"}).appendTo(n.$el.find(".content"))),i(),Object(s.a)(this).remove()})).on("error",(function(){o(),Object(s.a)(this).remove()}))},updateSettings:function(t){if(t=t||this.$picture){var e=this.model,i=e.get("fwpos"),s=e.get("fhpos");i=void 0===i?50:i,s=void 0===s?50:s,this.isVector()?(t.css({"box-shadow":"none","border-radius":"0"}),this.$content.css("opacity",1)):(t.css({"box-shadow":e.get("border_size")>0?"inset 0 0 0 "+e.get("border_size")+"px #"+(e.get("border_color")||"000000"):"none","border-radius":(e.get("border_radius_max")?"9999":e.get("border_radius")||0)+"px","background-position":s+"% "+i+"%","-webkit-mask-image":e.get("border_size")>0?"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAA5JREFUeNpiYGBgAAgwAAAEAAGbA+oJAAAAAElFTkSuQmCC)":""}),this.$content.css("opacity",void 0===e.get("opacity")?1:e.get("opacity")))}},onPictureChange:function(t,e){var i=this.model.previous("picture"),s=this.model.get("picture"),o=e&&e.isNew;(s&&i&&s.url!=i.url||o)&&this.model.set({pic_color:"",pic_opacity:1},{silent:!0})},onHistoryPictureChange:function(t,e){var i={},s=this.model.previous("picture"),o=this.model.get("picture");if(!o)return this.updatePicture();!s&&o&&this.trigger("picture_added"),this._modeTransition&&!this.cropmode&&(i.complete=this.onLeavingCropMode),this.has_parent_block?(this.in_constrained_crop_mode=!1,this.enter_constrained_crop_mode()):this.updatePicture(i)},setFinal:function(){this.fakingMode=!1,this.getFinalImage(this.updatePicture,{silent:!0})},changeControls:function(){this.setControls(),this.updateControls()},preloadHiRes:function(){this.isVector()||this.flagLambda()||(this._preload("unscaledUrl"),this._preload("url"))},_preload:function(t,e){var i=this.model.get("picture");if(i){var o,n=this;return(o=this.useLambdaUrl()?n.cropmode||n.in_constrained_crop_mode||"originalLambdaUrlCropPreload"===t?this.getOriginalLambdaUrl():this.getLambdaUrl():"tempPicture"===t?this.tempPicture:i[t])?this.isVector()?this.loadVector({success:e}):void(this._imgsPreload[t]=Object(s.a)(new Image).attr({src:o}).one("load",(function(){if("tempPicture"!==t&&(n.tempPicture=null,n.hideTempPreloader()),n._imgsPreload[t]=!1,e){var i=Object(s.a)("<div/>").css("background-image","url("+o+")");if(!n.rendered)return;e.apply(n,[i,o])}Object(s.a)(this).remove()}))):e&&e.apply(this)}},onResizeStart:function(t,e){this.cropmode||this.isVector()||(this._scaledimageXHR&&this._scaledimageXHR.abort(),this._modeTransition||(this._getFinalRequest&&this._getFinalRequest.abort(),!this.useLambdaUrl()&&!this.tempPicture&&this.updatePicture({load:"unscaledUrl"})),this.isScaling=!0)},onResizeEnd:function(t,e,i){this.isScaling=!1;var s=a.a.extend({scale:1},this.getBoxData());if(this.model.set(s,i),!this.getPictureUrl()||this.isVector())return this.saveBox();this.cropmode||(this._modeTransition?this._waitingForRescale=!0:this.setScaledImage(null,a.a.omit(i,"skipPersist")))},restoreFixedPosition:function(t){!t&&this.cropmode||H.prototype.restoreFixedPosition.apply(this,arguments)},getBoxData:function(){var t=H.prototype.getBoxData.apply(this,arguments);return this.model.get("cropW")?t.scale=(t.w/this.model.get("cropW")).toFixed(15):void 0!==t.scale&&(t.scale=1..toFixed(15)),t},setScaledImage:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=a.a.clone(this.model.attributes),o=function(t){if("default"!==this.model.getViewport()&&a.a.isEmpty(this.model.viewport_default.picture)){var e=a.a.cloneWithObjects(a.a.extend({},this.model.attributes,{picture:t}));e.hidden=this.model.viewport_default.hidden,this.model.storeViewport("default",e)}}.bind(this);if((this.flagLambda()||this.model.get("picture")&&this.model.get("picture").url)&&(!this.flagLambda()||!this.tempPicture)){if(e.viewport=this.model.getViewport(),this.isVector()||this.isAnimated()||this.useLambdaUrl())return o(i.picture),this.model.save("picture",i.picture,e),this.updatePicture({complete:t});var n=this.model.get("w");this.showTempPreloader(),this._scaledimageXHR=s.a.ajax({type:"POST",data:i,url:this.RESCALE_URL,success:a.a.bind((function(i){if(this.hideTempPreloader(),n==this.model.get("w")){var s=a.a.extend({},this.model.get("picture"),i);s.url&&(o(s),this.model.save("picture",s,e),this.updatePicture({complete:t}))}}),this)})}},fixSize:function(t){if(this.model.get("originalW")){var e=parseInt(this.model.get("originalW"),10),i=parseInt(this.model.get("originalH"),10),s=this.model.get("w"),o=this.model.get("h"),n=s/e,r=o/i,l=s,c=o,h={x:this.model.get("x"),y:this.model.get("y")};this.has_parent_block?c=i*n:this.isVector()&&this.isFullWidth()?l=this.getFullWidthDims().w:this.isVector()&&this.isFullHeight()?c=this.getFullHeightDims().h:Math.abs(1-n)<.05&&Math.abs(1-r)<.05||n>1.05&&r>1.05?(l=e,c=i,h.x+=s/2-e/2,h.y+=o/2-i/2):n>r?(l=e*r,h.x+=s/2-l/2):(c=i*n,h.y+=o/2-c/2),this.flagLambda()&&this.tempPicture&&!this.useLambdaUrl()?this.model.set({w:l,h:c,x:h.x,y:h.y,ratio:e/i,scale:l/e}):this.model.set({w:l,h:c,x:h.x,y:h.y,ratio:e/i,scale:l/e,cropX:0,cropY:0,cropW:e,cropH:i},{first:t&&t.first}),this.setScaledImage(a.a.bind((function(){this.isVector()&&this.fixVectorScale()}),this),t),this.model.created=!1}},fixVectorScale:function(){var t,e=this.$svg.get(0).getBBox(),i=this.getBoxData(),s=e.width/e.height,o=i.w/i.h;Math.abs(s-o)<.05||(t=this.isFullWidth()?{h:i.w/s,originalW:this.model.get("full_width_initial_w"),originalH:this.model.get("full_width_initial_w")/s}:s>1?{h:i.h/s,originalH:i.h/s,ratio:s}:{w:i.w*s,originalW:i.w*s,ratio:s},this.model.save(t,{skipHistory:!0}))},showIconLoader:function(){this.has_parent_block?this.$upload_button.addClass("uploading"):r.a.prototype.showIconLoader.apply(this,arguments),this.showTempPreloader()},hideIconLoader:function(){this.has_parent_block?this.$upload_button.removeClass("uploading"):r.a.prototype.hideIconLoader.apply(this,arguments),this.hideTempPreloader()},deselect:function(){r.a.prototype.deselect.apply(this,arguments),this.leaveCropMode(),this.leaveFWPosMode()},onWorkspaceBlocksSelect:function(t){r.a.prototype.onWorkspaceBlocksSelect.apply(this,arguments);var e=t&&1==t.length&&t[0]==this;e||(this.leaveCropMode(),this.leaveFWPosMode())},onWorkspaceResizePicture:function(){var t=this;RM.constructorRouter.zoom.getZoom()>1&&!this.tempPicture&&!this.originalLoaded&&this.updatePicture({load:"unscaledUrl",complete:function(){return t.originalLoaded=!0}})},isPictureEmpty:function(){return a.a.isEmpty(this.model.get("picture"))},destroy:function(){this.uploader&&this.uploader.destroy(),this.leaveCropMode(),this.leaveFWPosMode(),r.a.prototype.destroy.apply(this,arguments),this.hideIconLoader(),this.model.off("change:picture",this.toggle_loaded),this.$upload_button&&this.$upload_button.off("click"),this.off(),this.$el.off()}}),et=l.a.extend({maxwidth:9999,maxheight:9999,onResize:function(t,e){var i=l.a.prototype.onResize.apply(this,arguments);this.block.cropmode?this.block.onCropResize(i):this.block._modeTransition&&this.block.onLeavingCropResize(i)},setConstraints:function(t){this.constraints={top:parseInt(t.css("top")),left:parseInt(t.css("left")),width:parseInt(t.css("width")),height:parseInt(t.css("height"))}}}),it=tt,st=i("tcpm"),ot=i("rDYU"),nt=i.n(ot);function at(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var rt={rasterize:function(t){var e;if(t&&t.widgets&&t.mid&&t.svg&&t.viewport&&t.size&&t.size.height&&t.size.width){var i,o=document.importNode(t.svg[0],!0),n=(new XMLSerializer).serializeToString(o),r="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(n))),l=(at(e={},t.prefix?t.prefix+"_rasterUrl":"rasterUrl",r),at(e,t.prefix?t.prefix+"_raster2xUrl":"raster2xUrl",r),at(e,t.prefix?t.prefix+"_raster3xUrl":"raster3xUrl",r),e);t.activeArrow?("left_arrow_noun"===t.activeArrow&&t.widgets.forEach((function(t){i=t.get("theme_data"),t.unset("left_arrow_noun",{skipHistory:!0,silent:!0,patch:!0}),t.save({theme_data:a.a.extend(i,{left_icon_noun:a.a.extend(i.left_icon_noun,l)})},{skipHistory:!0,silent:!0,patch:!0})})),"right_arrow_noun"===t.activeArrow&&t.widgets.forEach((function(t){i=t.get("theme_data"),t.unset("right_arrow_noun",{skipHistory:!0,silent:!0,patch:!0}),t.save({theme_data:a.a.extend(i,{right_icon_noun:a.a.extend(i.right_icon_noun,l)})},{skipHistory:!0,silent:!0,patch:!0})}))):t.widgets.forEach((function(t){t.save(l,{skipHistory:!0,silent:!0})}));var c={wids:t.widgets.map((function(t){return t.get("_id")})),svg:n,size:t.size,viewport:t.viewport,mid:t.mid,prefix:t.prefix,arrow:t.activeArrow};return s.a.ajax({url:"/api/images/rasterize",type:"POST",data:c,success:t.onSuccess,error:t.onError})}}},lt=H.extend({name:"Slideshow",sort_index:3,thumb:"slideshow",icon_color:"#00BFDD",initial_controls:["slideshow_settings","slideshow_transitions","slideshow_manager","text_typography","text_bius","text_color","common_animation","common_position","common_layer","common_lock"],viewport_fields:c.b.viewport_fields.slideshow,MIN_IMAGES_WIDTH:100,MIN_IMAGES_HEIGHT:100,MIN_CAPTIONS_HEIGHT:14,ARROW_NOUN_ICON_WIDTH:18,ARROW_NOUN_ICON_HEIGHT:18,DEFAULT_ARROWS_CONTAINER:{LEFT:'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40"><path d="M23.5 11.5 L15.5 19.5 L23.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path></svg>',RIGHT:'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40"><path d="M16.5 11.5 L24.5 19.5 L16.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path></svg>'},MAX_ICON_CACHE_SIZE:30,params:{multipleName:"multiple values",tabIndent:28,fontSizeLineHeightRatio:1.25,minFontSize:8,maxFontSize:999,minLineHeight:10,maxLineHeight:999,minLetterSpacing:-99,maxLetterSpacing:999},initialize:function(t,e){this.initBlock(t,e),this.inner_template=nt.a["template-constructor-block-slideshow"],this.cur_selection_styles={},this.cur_selection_styles_all={},this.queue=[],this.frameClass=ct,this._imgsPreload=[],this.picloaded={},this.model.on("change:theme_data",this.onThemeParamsChange),this.currentIconsData={},this.workspace.on("main-dragover",this.highlightDropZone),this.model.skipResponse=!0,this.fillTextStyles(),this.workspace.on("deselect",this.showOverlay),this.workspace.on("deselect",this.setToDefaultArrows),this.workspace.on("select",this.hideOverlay),this.saveDebounced=a.a.debounce((function(){this.model.save()}),2e3),this.renderCorrectIconsDebounced=a.a.debounce(this.renderCorrectIcons,10)},render:function(){this.create(),Object(s.a)(this.inner_template(this.model.attributes)).appendTo(this.$content),this.$el.addClass("slideshow can-drop"),this.model.get("theme_data")&&(this.setControls(),this.slideshowPlayer=new st.a(a.a.clone(this.model.attributes),this.$content,"constructor",this,this.workspace&&this.workspace.mag),this.onThemeParamsChange(),this.uploader=new Y.a(this,{fileInput:this.$(".uploadInput"),unique:!0}),this.bindUploader(this.uploader),this.on("changeStyleSpan",this.textStyleChanged),this.on("changeStyleParagraph",this.textStyleChanged),"default"!==this.model.get("theme_data").arrows_type&&this.renderCorrectIcons(),this.listenTo(this,"arrow_type_changed",this.renderCorrectIconsDebounced),this.listenTo(this,"captions_changed",this.onCaptionsStatusChange),this.triggerReady())},renderCorrectIcons:function(){var t,e,i=this.model.get("theme_data"),o=i.arrows_type;"default"===o?(t=i.controls_color,e=i.controls_opacity,this.renderIcon({$svg:Object(s.a)(this.DEFAULT_ARROWS_CONTAINER.LEFT),activeArrow:"left_arrow_default"}),this.renderIcon({$svg:Object(s.a)(this.DEFAULT_ARROWS_CONTAINER.RIGHT),activeArrow:"right_arrow_default"}),this.slideshowPlayer.colorArrows(t,e)):"library"!==o&&"noun"!==o||this.getNounArrows()},hideOverlay:function(){this.$(".jsSlideshowOverlay").hide()},showOverlay:function(){this.$(".jsSlideshowOverlay").show()},setToDefaultArrows:function(){var t=this,e=this.model.get("theme_data"),i=e.arrows_type,s=e.left_icon_noun,o=e.right_icon_noun;a.a.defer((function(){"library"!==i&&"noun"!==i||!a.a.isEmpty(s)&&!a.a.isEmpty(o)||t.model.save({theme_data:a.a.extend(t.model.get("theme_data"),{arrows_type:"default"})})}))},bindUploader:function(t){t.on("add",this.onAddUpload),t.on("send",this.onSendUpload),t.on("done",this.onDoneUpload),t.on("fail",this.onFailUpload)},getNounArrows:function(){var t=this.model.get("theme_data").left_icon_noun,e=this.model.get("theme_data").right_icon_noun;a.a.isEmpty(t)&&a.a.isEmpty(e)||(a.a.isEmpty(t)||this.getIconSVG(t.noun_id||t.rm_id,t.noun_url,"left_arrow_noun",function(t,e){!t&&e.$svg}.bind(this)),a.a.isEmpty(e)||this.getIconSVG(e.noun_id||e.rm_id,e.noun_url,"right_arrow_noun",function(t,e){!t&&e.$svg}.bind(this)))},rasterizeIconsBeforeDestroy:function(){a.a.isEmpty(this.currentIconsData.left_arrow_noun)||this.rasterizeIconSVG({$svg:this.getoloredIconSVG("left_arrow_noun"),activeArrow:"left_arrow_noun"}),a.a.isEmpty(this.currentIconsData.right_arrow_noun)||this.rasterizeIconSVG({$svg:this.getoloredIconSVG("right_arrow_noun"),activeArrow:"right_arrow_noun"})},renderIcon:function(t){var e=t.$svg,i=t.activeArrow;["left_arrow_noun","left_arrow_default"].includes(i)&&(this.$el.find(".prev-picture-arrow-bottom").empty().html(e.clone()).toggleClass("noun","left_arrow_noun"===i),this.$el.find(".prev-picture-arrow-middle").empty().html(e.clone()).toggleClass("noun","left_arrow_noun"===i)),["right_arrow_noun","right_arrow_default"].includes(i)&&(this.$el.find(".next-picture-arrow-bottom").empty().html(e.clone()).toggleClass("noun","right_arrow_noun"===i),this.$el.find(".next-picture-arrow-middle").empty().html(e.clone()).toggleClass("noun","right_arrow_noun"===i))},prepareIconSVG:function(t){var e=t.clone().appendTo(Object(s.a)("body")),i=t.clone();e.get(0).setAttributeNS(null,"viewBox","0 0 "+e.width()+" "+e.height());var o=e.get(0).getBBox();return e.remove(),i.data("aspect_ratio",o.width/o.height),i.removeAttr("width"),i.removeAttr("height"),i.get(0).setAttributeNS(null,"viewBox",o.x+" "+o.y+" "+o.width+" "+o.height),i.get(0).setAttributeNS(null,"preserveAspectRatio","xMidYMid meet"),i.css({width:"100%",height:"100%"}),i},cacheSVGData:function(t){window.iconSVGCache.push(t),window.iconSVGCache.length>this.MAX_ICON_CACHE_SIZE&&window.iconSVGCache.shift()},getSVGCacheItem:function(t){return window.iconSVGCache&&a.a.findWhere(window.iconSVGCache,{id:t})},"getoloredIconSVG":function(t){var e,i=this.model.get("theme_data").controls_color,o=this.model.get("theme_data").controls_opacity,n=this.currentIconsData[t].$svg.clone();return e=d.b.getRGBA(i,1),n.find("*:not(.fixed-color)").each((function(){var t=Object(s.a)(this);t.css({fill:"","fill-opacity":""}),t.get(0).removeAttribute("fill"),t.get(0).removeAttribute("fill-opacity")})),n.get(0).setAttribute("fill",e),n.get(0).setAttribute("fill-opacity",o),n},rasterizeIconSVG:function(t){this.rasterizeXhr&&this.rasterizeXhr.abort(),this.rasterizeXhr=rt.rasterize({widgets:[this.model],svg:t.$svg,mid:this.workspace.mag.get("_id"),viewport:this.model.getViewport(),size:{width:this.ARROW_NOUN_ICON_WIDTH,height:this.ARROW_NOUN_ICON_HEIGHT},activeArrow:t.activeArrow})},getIconSVG:function(t,e,i,o){var n,r,l,c=i.includes("left"),h=c?"iconXhrLeft":"iconXhrRight",d=c?"iconLeftRequestInProgress":"iconRightRequestInProgress";if(this[h]&&this[h].abort(),n=this.getSVGCacheItem(t))return l={$svg:n.$svg,noun_url:n.noun_url,aspect_ratio:n.$svg.data("aspect_ratio")},this.currentIconsData[i]=l,this.renderIcon({$svg:this.getoloredIconSVG(i),activeArrow:i}),o(null,l);var p=function(e){var n=Object(s.a)("<div></div>").append(Object(s.a)(e.svg)).find("svg");if(n.length)return n=this.prepareIconSVG(n),l={id:t,$svg:n,noun_url:e.new_url,aspect_ratio:n.data("aspect_ratio")},this.currentIconsData[i]=l,this.cacheSVGData(l),this.renderIcon({$svg:this.getoloredIconSVG(i),activeArrow:i}),o(null,{$svg:n,noun_url:e.new_url})}.bind(this);r={method:"POST",url:"/api/authservice/noun/icon",data:{id:t,url:e},dataType:"json",success:function(t){this[d]=!1,p(t)},error:function(t){return this[d]=!1,o(t)},context:this},/^rm/.test(t)&&a.a.extend(r,{method:"GET",url:e,cache:!1,success:function(t){this[d]=!1,p({svg:Object(s.a)(t).find("svg"),new_url:e})},data:null,dataType:null}),this[d]=!0,this[h]=s.a.ajax(r)},fillTextStyles:function(){var t={"size-leading-linked":!0,"size-leading-ratio":this.params.fontSizeLineHeightRatio};this.cur_selection_styles=a.a.defaults(a.a.clone(this.model.get("text_style")),t),this.cur_selection_styles_all=[a.a.defaults(a.a.clone(this.model.get("text_style")),t)]},onCaptionsStatusChange:function(t){this.setControls(t),this.updateControls()},setControls:function(t){t=void 0===t?this.model.get("theme_data").captions:t,this.controls=t?this.initial_controls:a.a.without(this.initial_controls,"text_typography","text_bius","text_color")},onAddUpload:function(t,e){var i=null;if(this.replacingPic){for(var s in this.queue.indexOf(this.replacingPic)>-1&&this.cancelUpload(this.replacingPic),this.replacingPic)"num"!=s&&"id"!=s&&"text"!=s&&delete this.replacingPic[s];this.replacingPic.name=e.files&&e.files[0]&&e.files[0].name,this.replacingPic.uploadData=e,i=this.replacingPic,this.replacingPic=null,this.trigger("replaceUpload",i)}else{i={num:this.getMaxNum()+1,name:e.files&&e.files[0].name,uploadData:e},this.trigger("addUpload",i)}this.queue.push(i)},onSendUpload:function(t,e){this.trigger("nowUploading",this.queue[0])},onDoneUploadFinish:function(t){var e=this.queue.shift();if(t){var i=a.a.clone(this.model.get("pictures"))||[],s=!i.length,o=a.a.indexOf(i,e),n=a.a.extend({num:e.num},t.picture,t.size);o>-1?i[o]=a.a.extend(n,{id:i[o].id,text:i[o].text}):i.push(a.a.extend(n,{id:d.b.generateUUID(),text:""})),this.tempSave({pictures:i}),this.queue=this.queue||[],this.trigger("doneUpload",n),s&&this.updateControls()}else this.trigger("failUpload",e)},onDoneUpload:function(t,e){var i=this;if(!e.result)return this.onDoneUploadFinish(null);var o=e.result,n=a.a.clone(this.model.attributes);if(!(n&&n._id&&o.picture.type&&["jpg","png"].includes(o.picture.type.toLowerCase())))return this.onDoneUploadFinish(o);this._optimizedImageXHR=s.a.ajax({type:"POST",data:{_id:n._id,picture:o.picture},url:"/api/imageoptimize",success:function(t){o.picture=a.a.extend(o.picture,t),i.onDoneUploadFinish(o)},error:function(){i.onDoneUploadFinish(o)}})},onFailUpload:function(t,e,i){var s=this.queue.shift(),o=a.a.clone(this.model.get("pictures"))||[],n=a.a.indexOf(o,s);s.error=!0,s.errorText=i,n>-1?o[n]=a.a.omit(a.a.extend(s,{id:o[n].id,text:o[n].text}),"uploadData"):o.push(a.a.omit(a.a.extend(s,{id:d.b.generateUUID(),text:""}),"uploadData")),this.model.set("pictures",o),this.queue=this.queue||[],this.updateControls(),this.trigger("failUpload",s,i),this.tempSave({pictures:o})},deletePic:function(t){var e=a.a.findWhere(this.queue,{num:t});e?this.cancelUpload(e):(e=a.a.findWhere(this.model.get("pictures"),{num:t}),this.model.set("pictures",a.a.without(this.model.get("pictures"),e))),a.a.each(this.getAllPics(),(function(t){t.num>e.num&&(t.num-=1)})),this.trigger("reorder"),this.model.save({},{silent:!a.a.isEmpty(this.queue)}),0==(this.model.get("pictures")||[]).length&&this.updateControls()},updatePic:function(t){this.replacingPic=Object(a.a)(this.getAllPics()).findWhere({num:t}),this.uploader.$uploader.trigger("click","stop")},cancelUpload:function(t){0===this.queue.indexOf(t)&&(t.uploadData.abort(),this.queue[1]&&this.trigger("nowUploading",this.queue[1])),this._optimizedImageXHR&&this._optimizedImageXHR.abort(),t.uploadData.files[0].skipped=!0,this.queue=a.a.without(this.queue,t)},removePictures:function(){this.uploader.abort(),this.model.unset("pictures"),this.model.save({},{silent:!0}),this.queue=[],this.trigger("clear")},swapPictures:function(t,e){for(var i=Object(a.a)(this.getAllPics()).sortBy((function(t){return t.num})),s=a.a.findWhere(i,{num:t}),o=t;o!=e+(t<e?1:-1);t<e?o++:o--)o!=t&&(i[o-1].num=t<e?i[o-1].num-1:i[o-1].num+1);s.num=e,this.trigger("reorder"),this.fixPicturesOrder(i),this.saveXHR&&this.saveXHR.abort(),this.saveXHR=this.model.save({},{silent:!a.a.isEmpty(this.queue)}),this.workspace.trigger("redraw"),this.slideshowPlayer.applyPictures(a.a.clone(this.model.attributes))},tempSave:function(t){this.tempSaveXHR&&(this.tempSaveXHR.abort(),delete this.tempSaveXHR),t&&t.pictures&&this.fixPicturesOrder(t.pictures),this.tempSaveXHR=this.model.save(t,{patch:!0,skipHistory:!a.a.isEmpty(this.queue)}).success(a.a.bind((function(){delete this.tempSaveXHR}),this))},fixPicturesOrder:function(t){for(var e=a.a.sortBy(t,"num"),i=0;i<e.length;i++)e[i].num=i+1},getMaxNum:function(){var t=this.getAllPics();return a.a.isEmpty(t)?0:a.a.max(a.a.pluck(t,"num"))},getAllPics:function(){return a.a.union(this.model.get("pictures")||[],this.queue)},updateDropZone:function(){var t=this.$el;this.manager&&(t=t.add(this.manager.$uploadDropZone)),this.settingsPanel&&this.settingsPanel.canUpload()&&(t=t.add(this.settingsPanel.$el)),this.uploader.setOptions({dropZone:t})},getThemeData:function(){var t={theme:this.model.get("current_theme"),thumbnails:this.model.get("theme_data").thumbnails,counters:this.model.get("theme_data").counters,images_h:this.model.get("images_h"),captions_h:this.model.get("captions_h"),left_arrow_noun:this.model.get("left_arrow_noun"),right_arrow_noun:this.model.get("right_arrow_noun"),current_mode:this.model.get("current_mode"),arrows_type:this.model.get("theme_data").arrows_type,captions:this.model.get("theme_data").captions,counters_type:this.model.get("theme_data").counters_type,counters_position:this.model.get("theme_data").counters_position,active_arrows:this.model.get("active_arrows")};return t.showThumbnails=t.thumbnails,t.showCounters=t.counters,t.showCaptions=t.captions||"theme_captions"===t.theme,t.showBottomDots=t.counters&&(("middle"===t.active_arrows||"outside"===t.counters_position)&&"dots"===t.counters_type||"theme_captions"===t.theme),t},getNewBlockHeight:function(){var t=this.getThemeData();return t.images_h+(t.thumbnails?this.slideshowPlayer.THUMBNAILS_HEIGHT:0)+(t.showCaptions?t.captions_h:0)+(t.showBottomDots?this.slideshowPlayer.COUNTERS_HEIGHT:0)},getNewInnerElementsHeight:function(t,e){var i=this.getThemeData(),s=i.images_h,o=i.captions_h;return"s"===e&&i.captions?o=t-i.images_h-(i.showBottomDots?this.slideshowPlayer.COUNTERS_HEIGHT:0):s=t-(i.thumbnails?this.slideshowPlayer.THUMBNAILS_HEIGHT:0)-(i.showCaptions?i.captions_h:0)-(i.showBottomDots?this.slideshowPlayer.COUNTERS_HEIGHT:0),{images_h:s,captions_h:o}},getSaveBoxData:function(t){t=t||{};var e=r.a.prototype.getSaveBoxData.apply(this,arguments),i=this.getNewInnerElementsHeight(e.h,t.resizePoint);return e.images_h=i.images_h,e.captions_h=i.captions_h,e},saveBox:function(t){r.a.prototype.saveBox.apply(this,arguments),this.setSizeConstraints()},textStyleChanged:function(t,e){var i=a.a.clone(this.model.get("text_style")),s=a.a.extend(i,t);e&&(s=a.a.extend(s,e)),this.model.set({text_style:s}),this.saveDebounced()},redraw:function(t,e){if(e=e||{},this.checkNeedRedraw(t,e)){r.a.prototype.redraw.apply(this,arguments);var i=this.model.changedAttributes();if(a.a.isObject(i)){var s=["captions_h","images_h","w","h","theme_data","left_arrow_noun","right_arrow_noun","transition_type","play_method"];a.a.intersection(a.a.keys(i),s).length&&this.slideshowPlayer.applyVisualState(this.model.attributes),this.model.hasChanged("pictures")&&this.slideshowPlayer.applyPictures(this.model.attributes),this.model.hasChanged("text_style")&&(this.slideshowPlayer.applyTextStyles(this.model.attributes),this.fillTextStyles(),this.trigger("selection_styles_changed",this.cur_selection_styles),this.trigger("selection_styles_all_changed",this.cur_selection_styles_all),this.initiatorControl=null);var o=this.getNewBlockHeight();o!==this.model.get("h")&&this.model.set("h",o)}}},css:function(t,e){if(r.a.prototype.css.apply(this,arguments),null!=t.height||null!=t.width){var i=this.getNewInnerElementsHeight(t.height||this.model.get("h"),e);this.slideshowPlayer.applyVisualState(a.a.clone(this.model.attributes),{w:t.width,h:t.height,images_h:i.images_h,captions_h:i.captions_h})}},onThemeParamsChange:function(){var t=this.getThemeData();this.model.set("h",this.getNewBlockHeight()),this.setSizeConstraints(),this.frame&&this.frame.setResizeBottomPlus(t.showBottomDots||t.captions)},setSizeConstraints:function(){var t,e,i=this.getThemeData(),s=(i.showBottomDots?this.slideshowPlayer.COUNTERS_HEIGHT:0)+(i.thumbnails?this.slideshowPlayer.THUMBNAILS_HEIGHT:0)+(i.captions?this.MIN_CAPTIONS_HEIGHT:0);t=i.images_h+s,e=this.MIN_IMAGES_HEIGHT+s,a.a.extend(this.frame,{minwidth:this.MIN_IMAGES_WIDTH,maxwidth:9999,minheight:0,maxheight:9999,minheight_on_south_resize:t,minheight_on_other_resize:e})},highlightDropZone:function(){this.$el.addClass("show-dropzone"),clearTimeout(this.highlightTimeout),this.highlightTimeout=setTimeout(a.a.bind((function(){this.$el.removeClass("show-dropzone")}),this),500)},destroy:function(){this.workspace.off("main-dragover",this.highlightDropZone),this.off("changeStyleSpan",this.textStyleChanged),this.off("changeStyleParagraph",this.textStyleChanged),this.model.off(),this.slideshowPlayer&&this.slideshowPlayer.destroy(),this.slideshowPlayer=null,r.a.prototype.destroy.apply(this,arguments)}},{defaults:{captions_h:76,images_h:360,current_mode:"default",transition_type:"slider",play_method:"click",theme_data:{arrows:!0,arrows_type:"default",arrows_position:"sides",arrows_view_mode:"normal",counters_type:"numbers",counters_position:"inside",slider_transition:.5,crossfade:2,autoplay_delay:4,hover_delay:.8,scroll_delay:1,start_offset:200,hover_frame_rate:.8,captions:!1,fullscreen:!1,show_on_hover:!1,thumbnails:!1,counters:!1,fill:!0,radius:0,controls_color:"ffffff",controls_opacity:1,background_color:"000000",background_opacity:1,left_icon_noun:{},right_icon_noun:{}},text_style:{color:"000000","font-family":"Arial","font-size":8,"font-style":"normal","font-weight":"400","letter-spacing":0,"line-height":10,opacity:100,"text-align":"center","text-decoration":"none","text-transform":"none","vertical-align":"baseline","size-leading-linked":!0,"size-leading-ratio":1.25}}}),ct=l.a.extend({applyExtraConstraints:function(t,e){return this.block.setSizeConstraints(),"s"==e?t.height<this.minheight_on_south_resize&&(t.height=this.minheight_on_south_resize):t.height<this.minheight_on_other_resize&&(t.height=this.minheight_on_other_resize),t},setResizeBottomPlus:function(t){this.$el.toggleClass("resize-bottom-plus-slideshow",t)}}),ht=lt,dt=i("Vc8N"),pt=i.n(dt),ut=i("3eHG"),gt=r.a.extend({name:"Twitter",sort_index:9,thumb:"twitter",icon_color:"#1DA1F2",initialize:function(t,e){var i=this;this.mag=e.mag,this.initBlock(t,e),this.frameClass=mt,this.model.validate=function(t){var e=i.model.get("current_type");t[e].url&&(t[e].url=i.fixUrl(t[e].url)),t.type_hashtag&&t.type_hashtag.hash&&(t.type_hashtag.hash=t.type_hashtag.hash.replace(/\s/g,"")),t.type_follow&&t.type_follow.username&&(t.type_follow.username=t.type_follow.username.replace(/\s/g,""))},this.model.on("change:current_type",this.onParamsChange),this.model.on("change:type_timeline",this.onParamsChange),this.model.on("change:type_embed",this.onParamsChange),this.model.on("change:type_tweet",this.onParamsChange),this.model.on("change:type_follow",this.onParamsChange),this.model.on("change:type_hashtag",this.onParamsChange),this.controls=["twitter_settings","common_position","common_layer","common_lock"]},render:function(){this.create(),this.$el.addClass("twitter"),this.redraw(this.model,{skipHistory:!0,skipTriggerRedraw:!0,doNotRedrawPacksFrames:!0,doNotRedrawBottomShiftLine:!0}),this.onParamsChange(),this.triggerReady()},redraw:function(t,e){if(e=e||{},this.checkNeedRedraw(t,e)){var i=this.model.get("current_type"),s=this.model.changedAttributes(),o=a.a.isObject(s)&&0==a.a.without(a.a.keys(s),"x","y","z","pack_id").length,n=a.a.isObject(s)&&(a.a.has(s,"w")||a.a.has(s,"h"))&&!s.current_type,l=!(o||n&&("type_timeline"===i||"type_embed"===i));r.a.prototype.redraw.apply(this,arguments),"type_embed"===i&&this.adjustTweetHeight({skipHistory:e&&(e.undo||e.redo||e.skipHistory)}),l&&this.redrawTwitter(t.get("w"),t.get("h"),e)}},css:function(t){var e,i,s,o=this.$el.find("iframe");r.a.prototype.css.apply(this,arguments),"type_timeline"===this.model.get("current_type")&&1==o.length&&o.hasClass("twitter-timeline")&&(e=o.contents().find("body .timeline-header").outerHeight(),i=o.contents().find("body .timeline-footer").outerHeight(),s=o.height()-e-i,e&&i&&o.contents().find("body .stream").height(s))},onParamsChange:function(){var t=this.model.get("current_type");a.a.contains(["type_timeline","type_embed"],t)?this.validateCode(t):a.a.contains(["type_tweet","type_follow","type_hashtag"],t),this.$el.removeClass(["type_timeline","type_embed","type_tweet","type_follow","type_hashtag"].join(" ")),this.$el.addClass(t),this.setSizeConstraints()},setSizeConstraints:function(t){var e,i=this.model.get("current_type");a.a.contains(["type_tweet","type_follow","type_hashtag"],i)?(e=this.$el.find("iframe")).length>0?a.a.extend(this.frame,{minwidth:e.width()||120,maxwidth:e.width()||120,minheight:e.height()||20,maxheight:e.height()||20}):a.a.extend(this.frame,{minwidth:120,maxwidth:120,minheight:20,maxheight:20}):"type_timeline"===i?a.a.extend(this.frame,{minwidth:180,maxwidth:520,minheight:200,maxheight:9999}):"type_embed"===i&&(e=this.$el.find("twitterwidget.twitter-tweet"),a.a.extend(this.frame,{minwidth:220,maxwidth:500,minheight:e.length&&e.height()>1?e.height():163,maxheight:e.length&&e.height()>1?e.height():163})),t&&a.a.extend(this.frame,t)},doResize:function(t){t=t||{};var e=this.model.get("current_type");this.model.get("w")<this.frame.minwidth&&this.model.set("w",this.frame.minwidth,{silent:!0}),this.model.get("w")>this.frame.maxwidth&&this.model.set("w",this.frame.maxwidth,{silent:!0}),this.model.get("h")<this.frame.minheight&&this.model.set("h",this.frame.minheight,{silent:!0}),this.model.get("h")>this.frame.maxheight&&this.model.set("h",this.frame.maxheight,{silent:!0}),a.a.contains(["type_tweet","type_follow","type_hashtag"],e)&&(this.model.set("w",this.frame.minwidth,{silent:!0}),this.model.set("h",this.frame.minheight,{silent:!0})),a.a.isEmpty(a.a.pick(this.model.changed,"w","h"))||this.model.save({},{skipHistory:t.skipHistory,noSocketUpdate:t.socketUpdate}),this.frame.doResize({left:this.model.get("x"),top:this.model.get("y"),width:this.model.get("w"),height:this.model.get("h")})},redrawTwitter:function(t,e,i){var o,n,r=this.model.get("current_type"),l=a.a.clone(this.model.get(r)),c=pt.a["template-constructor-block-twitter-"+r];"mag"===l.use_own_url?l.url=this.getMagUrl():"page"!==l.use_own_url&&l.url||(l.url=this.getPageUrl()),o=c(l),this.$content.html(o),this.$overlay=this.$content.find(".overlay"),"type_timeline"===r&&this.$content.find("a").attr({width:this.model.get("w"),height:this.model.get("h")}),n=this.frame.isFrameVisible(),this.frame.hide(),ut.a.initTwitterAPI(function(){var t=function(e){var o=e.target;Object(s.a)(o).closest(".block").attr("data-id")===this.model.get("_id")&&(window.twttr.events.unbind("rendered",t),this.waitForIframe(this.$content,20,100,function(){var t=i&&(i.undo||i.redo);"type_timeline"===r&&this.$content.find("iframe").css({width:"100%",height:"100%","max-width":"100%"}),"type_embed"===r?this.adjustTweetHeight({skipHistory:t}):(this.setSizeConstraints(),this.doResize(a.a.extend({},i,{skipHistory:"type_embed"===r||t}))),n&&this.frame.show()}.bind(this)))}.bind(this);window.twttr.events.bind("rendered",t),window.twttr&&window.twttr.widgets&&a.a.isFunction(window.twttr.widgets.load)&&window.twttr.widgets.load(this.$el[0])}.bind(this))},validateCode:function(t){var e,i;e=this.model.get(t).code.match({type_timeline:/^\<a.*\>.*\<\/a\>/i,type_embed:/^\<blockquote.*\>.*\<\/blockquote\>/i}[t]),(i=a.a.clone(this.model.get(t))).code=e?e[0]:"",this.model.set(t,i)},waitForIframe:function(t,e,i,s){var o;o=setInterval((function(){var e=t.find("iframe, twitterwidget");e.length&&(parseInt(e[0].style.width)>0||parseInt(e[0].style.height))>0&&(clearInterval(o),a.a.delay(function(){s()}.bind(this),100))}),e)},adjustTweetHeight:function(t){var e=this.$content.find("twitterwidget.twitter-tweet, iframe.twitter-tweet"),i=this.model.get("current_type");e.height();"type_embed"===i&&(e.css({margin:0,"max-width":"100%","-webkit-transform":"none",width:"100%"}),e.contents().find("body *").css({"-webkit-transition-duration":"0s","transition-duration":"0s"}),this.setSizeConstraints(),this.doResize(t))},getMagUrl:function(){return this.mag&&d.a.readymag_host+"/"+this.mag.get("num_id")+"/"},getPageUrl:function(){return d.a.readymag_host+"/p"+this.workspace.page.get("num_id")+"/"},fixUrl:function(t){var e=t;return t&&(e=(/^http(s?):\/\//i.test(t)?"":"http://")+t),e}},{defaults:{current_type:"type_timeline",type_timeline:{code:'<a class="twitter-timeline" href="https://twitter.com/readymag" data-widget-id="324216476359852033">Tweets by @readymag</a>',widget_id:""},type_embed:{code:'<blockquote class="twitter-tweet"><p>Here we go: <a href="http://t.co/yY6jqsSg" title="https://readymag.com/">readymag.com</a></p>&mdash; Readymag (@readymag) <a href="https://twitter.com/readymag/status/225550067766005760">July 18, 2012</a></blockquote>'},type_tweet:{url:"",use_own_url:"mag",show_count:!0,large_button:!1},type_follow:{username:"Readymag",show_name:!0,large_button:!1},type_hashtag:{hash:"Readymag",large_button:!1}}}),mt=l.a.extend({customResizeHandler:function(t,e){return this.block.setSizeConstraints(),t}}),ft=gt,vt=i("wxrA"),bt=i.n(vt),_t=r.a.extend({name:"Facebook",sort_index:10,thumb:"facebook",icon_color:"#3C5A99",initialize:function(t,e){var i,s,o=this;this.mag=e.mag,this.initBlock(t,e),"type_like_button"==this.model.get("current_type")&&this.model.get("type_like_button").send_button&&((i=a.a.clone(this.model.get("type_like_button"))).share_button=i.send_button,delete i.send_button,this.model.set("type_like_button",i,{silent:!0})),a.a.isEmpty(this.model.get("type_like_box"))||((s=a.a.clone(this.model.get("type_like_box"))).small_header=!s.show_header,delete s.show_header,this.model.unset("type_like_box",{silent:!0}),this.model.set({type_page:s},{silent:!0}),"type_like_box"==this.model.get("current_type")&&this.model.set({current_type:"type_page"},{silent:!0})),this.frameClass=wt,this.model.validate=function(t){var e=o.model.get("current_type");t[e].url&&(t[e].url=o.fixUrl(t[e].url))},this.controls=["facebook_settings","common_position","common_layer","common_lock"]},render:function(){this.create(),this.$el.addClass("facebook"),this.redraw(this.model,{skipTriggerRedraw:!0,doNotRedrawPacksFrames:!0,doNotRedrawBottomShiftLine:!0}),this.triggerReady()},redraw:function(t,e){if(e=e||{},this.checkNeedRedraw(t,e)){var i=this.model.get("current_type"),s=this.model.get(i),o=this.model.changedAttributes(),n=a.a.isObject(o)&&0==a.a.without(a.a.keys(o),"x","y","z","pack_id").length,l=!n,c=["type_like_button","type_page","type_comments"];r.a.prototype.redraw.apply(this,arguments),this.$el.removeClass(c.join(" ")),this.$el.addClass(i),"type_like_button"===i&&this.$el.removeClass("standard box_count button_count").addClass(s.layout),this.$el.toggleClass("no-v-resize","type_page"===i&&!s.show_stream&&!s.show_faces),Object(a.a)(["type_page","type_comments"]).contains(i)&&(this.setSizeConstraints(),e&&(e.undo||e.redo)||this.doResize()),l&&this.redrawFacebook(t.get("w"),t.get("h"),e)}},setSizeConstraints:function(t){var e,i,s,o,n=this.model.get("current_type"),r=this.model.get(n);if(e=this.$el.find("iframe"),"type_like_button"===n){if(1!==e.length)return;i="button_count"===r.layout||"box_count"===r.layout,a.a.extend(this.frame,{minwidth:i?e.width():285,maxwidth:i?e.width():900,minheight:e.height(),maxheight:e.height()})}else"type_page"===n?(s=63,s+=r.show_faces?122:0,s+=r.show_header&&(r.show_faces||r.show_stream)?30:0,s+=r.show_stream?300:0,o=!r.show_faces&!r.show_stream?63:9999,a.a.extend(this.frame,{minwidth:292,maxwidth:900,minheight:s,maxheight:o})):"type_comments"===n&&a.a.extend(this.frame,{minwidth:400,maxwidth:900,minheight:250,maxheight:9999});t&&a.a.extend(this.frame,t)},doResize:function(t){this.model.get("w")<this.frame.minwidth&&this.model.set("w",this.frame.minwidth,{silent:!0}),this.model.get("w")>this.frame.maxwidth&&this.model.set("w",this.frame.maxwidth,{silent:!0}),this.model.get("h")<this.frame.minheight&&this.model.set("h",this.frame.minheight,{silent:!0}),this.model.get("h")>this.frame.maxheight&&this.model.set("h",this.frame.maxheight,{silent:!0}),a.a.isEmpty(a.a.pick(this.model.changed,"w","h"))||this.model.save({},{skipHistory:!0,noSocketUpdate:t&&t.socketUpdate}),this.frame.doResize({left:this.model.get("x"),top:this.model.get("y"),width:this.model.get("w"),height:this.model.get("h")})},redrawFacebook:function(t,e,i){var o,n,r=this.model.get("current_type"),l=a.a.clone(this.model.get(r)),c=bt.a["template-constructor-block-facebook-"+r];l.w=this.model.get("w"),l.h=this.model.get("h"),"mag"===l.use_own_url?l.url=this.getMagUrl():"page"!==l.use_own_url&&l.url||(l.url=this.getPageUrl()),l.url=this.fixUrl(l.url),o=c({data:l}),this.$content.html(o),this.$overlay=this.$content.find(".overlay"),this.$content.toggleClass("scrollable","type_comments"===r),ut.a.initFacebookAPI(function(){window.FB.XFBML.parse(this.$el.get(0),function(){if("type_comments"===r&&this.$(".fb-comments").append(Object(s.a)('<div class="overlay"></div>')),"type_like_button"===r){n=this.$el.find("iframe");var t=0,e=setInterval(function(){t++,(n.height()>0||t>20)&&(clearInterval(e),this.setSizeConstraints(),this.doResize(i))}.bind(this),100)}}.bind(this))}.bind(this))},getMagUrl:function(){return this.mag&&d.a.readymag_host+"/"+this.mag.get("num_id")+"/"},getPageUrl:function(){return d.a.readymag_host+"/p"+this.workspace.page.get("num_id")+"/"},fixUrl:function(t){var e=t;return t&&(e=(/^http(s?):\/\//i.test(t)?"":"http://")+t),e}},{defaults:{current_type:"type_like_button",x:"center",w:61,h:20,type_like_button:{url:"",use_own_url:"mag",layout:"button_count",share_button:!1,show_faces:!1,theme:"light"},type_page:{url:"https://www.facebook.com/readymag",show_stream:!0,small_header:!1,show_faces:!1,theme:"light"},type_comments:{url:"",use_own_url:"mag",num_posts:5,theme:"light"}}}),wt=l.a.extend({}),yt=_t,kt=i("z79a"),Ct=r.a.extend(kt.a.prototype).extend({name:"Shape",sort_index:6,thumb:"shape",icon_color:"#F2C95C",dontSaveOnResize:!0,viewport_fields:c.b.viewport_fields.shape,LINE_BLOCK_HEIGH:24,initial_controls:["shape_settings","shape_color","shape_1x1","common_animation","picture_link","common_rotation","common_position","common_layer","common_lock"],initialize:function(t,e){this.mag=e.mag,this.initBlock(t,e),this.renderSVGContent.__debounced=a.a.debounce(this.renderSVGContent,0),this.iconData=null},render:function(){this.create(),this.$el.addClass("shape"),this.setControls(),this.$el.on("dblclick",this.onDoubleClick),this.redraw(this.model,{skipTriggerRedraw:!0,doNotRedrawPacksFrames:!0,doNotRedrawBottomShiftLine:!0}),this.model.on("change:tp",this.onTypeChange),this.model.on("change:is_full_width",this.onStrechBlockChange),this.model.on("change:is_full_height",this.onStrechBlockChange),this.onTypeChange(),this.triggerReady()},onDoubleClick:function(t){Object(s.a)(t.target).closest(".content").length&&this.showControl("shape_settings")},onStrechBlockChange:function(){this.setControls(),this.updateControls()},showControl:function(t){var e,i=this.workspace&&this.workspace.controls;i&&(e=i.findControl(t))&&!e.selected&&e.onClick()},setControls:function(){var t=this.model.get("tp");this.controls="line"==t||"icon"==t?a.a.without(this.initial_controls,"shape_1x1"):this.initial_controls},onTypeChange:function(t,e,i){var s=this.model.get("tp"),o=t&&0==a.a.without(a.a.keys(t.changedAttributes()),"tp").length;this.proportional="icon"==s,"icon"==s&&(this.isRealChangeByMe(i)&&a.a.delay(function(){this.showControl("shape_icon")}.bind(this),300),this.resetFullWidth(),this.resetFullHeight()),"line"==s&&o&&this.fixLineHeight(),this.setControls(),this.updateControls(),a.a.extend(this.frame,"icon"===this.model.get("tp")?{maxwidth:9999,maxheight:9999}:{maxwidth:1/0,maxheight:1/0})},redraw:function(t,e){if(e=e||{},this.checkNeedRedraw(t,e)){r.a.prototype.redraw.apply(this,arguments);var i,s,o,n,l=this.model.changedAttributes(),c=!1;if(a.a.isObject(l)&&(c=0==a.a.without(a.a.keys(l),"x","y","z","sticked_margin","sticked").length,n=0==a.a.without(a.a.keys(l),"rasterUrl","raster2xUrl").length,i=!!l.tp,s=!(!l.noun_id&&!l.rm_id)),!n&&(!c||this.model.isGlobal()))if("icon"==t.get("tp")){o=!!a.a.intersection(a.a.keys(l),["w","h","noun_id"]).length;var h={viewport:this.model.getViewport(),skipHistory:e.isGroupResize},d=o&&!(e.undo||e.redo),p=i||s,u=this.redrawIcon.bind(this,t,h,p,d);e.isGroupResize?a.a.delay(u):u()}else this.redrawShape(t.get("w"),t.get("h")),i&&"ellipse"==t.get("tp")&&this.makeSquare()}},redrawIcon:function(t,e,i,s){this.getIconSVG(t.get("noun_id")||t.get("rm_id"),t.get("noun_url"),function(t,e){!t&&e.$svg&&(this.destroyed||(this.updateIconSVGData(e,i),s&&this.rasterizeSVG()))}.bind(this))},getIconStyle:function(t){var e={},i="./constructor/widgetbar/icons/";if(t&&t.small&&(i+="small/",this.icon_color&&(e["background-color"]=this.icon_color)),"icon"==this.model.get("tp"))e["background-color"]=this.icon_color,t&&t.small||(e["border-radius"]="8px");else{var s=Object(j.b)(i+"shape-"+this.model.get("tp")+".svg");e["background-image"]="url("+s+")"}return e},getIconData:function(){return"icon"==this.model.get("tp")?this.iconData:null},updateIconSVGData:function(t,e){this.iconData=t,this.redrawShape(this.model.get("w"),this.model.get("h")),(e=e||"icon"==this.model.get("tp")&&this.model.get("w")!=this.model.get("h"))&&this.fixIconSVGSize()},css:function(t){r.a.prototype.css.apply(this,arguments),null!=t.height&&null!=t.width&&this.redrawShape(t.width,t.height)},redrawShape:function(t,e){var i=this.generateShapeSVG("constructor",this.model,t,e);this.renderSVGContent(i),Modernizr.firefox&&this.renderSVGContent.__debounced(i)},renderSVGContent:function(t){this.$content.html(t)},fixIconSVGSize:function(t){this.model.get("w"),this.model.get("h");var e,i,s,o,n,r,l,c=this.getBoxData(),h=Math.min(c.w,c.h);(e=this.$content.find("svg")).length&&(s=e.get(0).getBBox(),i=Math.round(s.width)/Math.round(s.height),r=c.w,l=c.h,s.width<s.height?(c.w=h,c.h=Math.ceil(c.w/i)):(c.h=h,c.w=Math.ceil(c.h*i)),o=Math.floor((r-c.w)/2),n=Math.floor((l-c.h)/2),c.x=c.x+o,c.y=c.y+n,this.model.set(c,a.a.extend({skipHistory:!0},t)))},rasterizeSVG:function(){var t=this.$content.find("svg");t.length&&(this.rasterizeXhr&&this.rasterizeXhr.abort(),this.rasterizeXhr=rt.rasterize({widgets:[this.model],svg:t,mid:this.workspace.mag.get("_id"),viewport:this.model.getViewport(),size:{width:this.model.get("w"),height:this.model.get("h")}}))},saveNewColor:function(){this.rasterizeSVG()},onResizeStart:function(t,e){this.rasterizeXhr&&this.rasterizeXhr.abort()},onResizeEnd:function(t,e,i){if("icon"!==this.model.get("tp"))return this.saveBox(i);this.fixIconSVGSize(i)},saveBox:function(t){r.a.prototype.saveBox.apply(this,arguments)},getDefaultIconSVG:function(){return this.prepareIconSVG(Object(s.a)('<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="283.5px" height="283.5px" viewBox="0 0 283.5 283.5" enable-background="new 0 0 283.5 283.5" xml:space="preserve"><g><g><path fill-rule="evenodd" clip-rule="evenodd" fill="#231F20" d="M258.3,114.1c-14.1,0-23.1,25-30.1,33.8 c-7,8.8-33.3,2.7-44.1,0.7c-10.7-2.1-38.7-3.9-38.7-3.9s47.4-18,47.4-65c0-47.7-54.9-75.3-73.5-78.1c-17-2.8-23.8,5.6-25.4,7.8 c-1.6,2.2-4.2,4.1-8,5.9c-3.9,1.8-1.5-0.1-15.4,9.8c-13.9,9.8-41.8-4-44.1-4.6c-2.3-0.5-6.8-1.8-8,4.6c-1.5,9.6,6.7,25.4,6.7,25.4 s-2.2,0.2-8,3.3c-5.8,3.1-2.8,7.7-1.3,9.1c1.4,1.4,27.9,16.3,32.1,18.9c10.6,5.3,20.3,31.6-7.3,51.4C-3.1,163,0.4,198.7,0.4,198.7 s-12,85.2,126.9,85.2c139,0,155.6-96.1,155.6-124.2C283,131.5,272.4,114.1,258.3,114.1z M89.5,50.2c-7.1,6.5-15.7,8-19.3,3.5 c-3.6-4.6-0.7-13.5,6.3-20c7.1-6.5,15.7-8,19.3-3.5C99.4,34.7,96.6,43.7,89.5,50.2z M76.1,38.9c-4.7,4.3-6.6,10.3-4.2,13.3 c2.4,3,8.1,2,12.9-2.3c4.7-4.3,6.6-10.3,4.2-13.3C86.6,33.6,80.9,34.6,76.1,38.9z"/></g></g></svg>'))},getIconSVG:function(t,e,i,o){var n,r;if(arguments.length<4&&(o=i,i={}),this.iconXhr&&this.iconXhr.abort(),!t)return o(null,{$svg:this.getDefaultIconSVG(),noun_url:null});if(!i.noCache&&(n=this.getSVGCacheItem(t))){var l=this.processNounIcon(n);return o(null,l)}this.iconRequestInProgress=!0;var c=function(e){e.noCache||this.cacheSVGData({id:t,svg:e.svg,noun_url:e.new_url});var i=this.processNounIcon(e);return o(null,i)}.bind(this);r={method:"POST",url:"/api/authservice/noun/icon",data:{id:t,url:e},dataType:"json",success:function(t){c(t)},error:function(t){return"abort"==!t.statusText&&console.log("icon xhr : ",t),o(t)},complete:function(){},context:this},/^rm/.test(t)&&a.a.extend(r,{method:"GET",url:e,cache:!1,success:function(t){c({svg:Object(s.a)(t).find("svg"),new_url:e,noCache:!0})},data:null,dataType:null}),this.iconXhr=s.a.ajax(r)},processNounIcon:function(t){var e=Object(s.a)("<div></div>").append(Object(s.a)(t.svg)).find("svg");if(e.length)return{$svg:e=this.prepareIconSVG(e),noun_url:t.new_url}},prepareIconSVG:function(t){var e=t.clone().appendTo(Object(s.a)("body")),i=t.clone();e.get(0).setAttributeNS(null,"viewBox","0 0 "+e.width()+" "+e.height());var o=e.get(0).getBBox();return e.remove(),this.currenIconSVGAcpectRatio=o.width/o.height,i.removeAttr("width"),i.removeAttr("height"),i.get(0).setAttributeNS(null,"viewBox",o.x+" "+o.y+" "+o.width+" "+o.height),i.get(0).setAttributeNS(null,"preserveAspectRatio","xMidYMid meet"),i.css({width:"100%",height:"100%"}),i},cacheSVGData:function(t){var e=JSON.parse(window.localStorage.getItem("noun_icons"))||{};e[t.id]=a.a.omit(t,"id");try{window.localStorage.setItem("noun_icons",JSON.stringify(e))}catch(t){window.localStorage.removeItem("noun_icons")}},getSVGCacheItem:function(t){var e=(JSON.parse(window.localStorage.getItem("noun_icons"))||{})[t];if(e)return a.a.extend({id:t},e)},fixLineHeight:function(){var t=this.model.get("h"),e=this.model.get("y"),i=this.model.get("weight"),s=i>this.LINE_BLOCK_HEIGH?i:this.LINE_BLOCK_HEIGH,o=Math.floor((t-s)/2);this.model.set({h:s,y:e+o})},makeSquare:function(){var t=this.model.get("x"),e=this.model.get("w"),i=this.model.get("h"),s=Math.floor((e-i)/2);this.model.set({w:i,x:t+s})},destroy:function(){this.model.off("change:tp",this.onTypeChange),this.model.off("change:is_full_width",this.onStrechBlockChange),this.model.off("change:is_full_height",this.onStrechBlockChange),r.a.prototype.destroy.apply(this,arguments),this.stopListening(this),this.$el.off()}},{defaults:{tp:"rectangle",bg_color:"000000",bg_opacity:1,color:"ffffff",opacity:1,borders:0,radius:0,sides:3,weight:1,stroke:"solid"}}),xt=i("60Nw"),St=r.a.extend({name:"Embed & Code",sort_index:13,thumb:"iframe",icon_color:"black",iframe_controls:["iframe_edit"],initialize:function(t,e){this.mag=e.mag,this.frameClass=Pt,this.controls=a.a.union(this.iframe_controls,this.controls),this.initBlock(t,e)},onCreate:function(){this.showPanel()},configurePlugin:function(t){var e=xt.a.findPlugin(this.model.toJSON());return e?new e({block:this}):null},render:function(){r.a.prototype.render.apply(this,arguments),this.$el.addClass("iframe"),this.$el.on("dblclick",this.onDoubleClick),this.redraw(this.model,{skipTriggerRedraw:!0,doNotRedrawPacksFrames:!0,doNotRedrawBottomShiftLine:!0}),this.triggerReady()},redraw:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.checkNeedRedraw(t,e)){var i,o,n=this.model.changedAttributes(),l=!0,c=!1;if(r.a.prototype.redraw.apply(this,arguments),a.a.isObject(n)&&(l=!(0===a.a.without(a.a.keys(n),"x","y","z","w","h").length),c=a.a.contains(a.a.keys(n),"code")),l){if(this.$content.empty(),this.$container=Object(s.a)('<div class="container"></div>'),this.$content.append(this.$container),this.$content.append(Object(s.a)('<div class="overlay"></div>')),this.$el.removeAttr("data-plugin"),o=t.get("code"),this.plugin=null,o){if(this.plugin=this.configurePlugin(o),!this.plugin)return;this.plugin.parse(o,function(e){(i=this.plugin.sanitize(e))&&i.length&&this.plugin.draw(i,this.$container,function(e,i){this.$el.attr("data-plugin",this.plugin.embed_type),(c||this.plugin.forceFrameSize)&&(e&&!this.isFullWidth()&&t.set("w",e),i&&!this.isFullHeight()&&t.set("h",i)),this.proportional=this.plugin.proportional,this.plugin.resizable&&this.$content.find(this.plugin.containerSelector).css({width:"100%",height:"100%","max-width":"","max-height":""})}.bind(this))}.bind(this))}this.$el.toggleClass("empty",!o)}}},getIconStyle:function(t){var e={},i="./constructor/widgetbar/icons/",s=this.model.get("type"),o=this.plugin&&this.plugin.embed_type,n=s+(o?"-"+o||!1:"")+".svg",a=o?{pinterest:"white",instagram:"white",readymag:"#FF4828",fbvideo:"#3C5A99"}[o]:null;return t&&t.small&&(i+="small/",e["background-color"]=a||this.icon_color),e["background-image"]="url("+Object(j.b)(i+n)+")",e},showPanel:function(){this.openCodeEditor({model:this.model})},hidePanel:function(){this.closeCodeEditor()},openCodeEditor:function(t){RM.constructorRouter.openCodeEditor(t)},closeCodeEditor:function(t){RM.constructorRouter.closeCodeEditor()},onDoubleClick:function(t){RM.constructorRouter.isCodeEditorVisible||this.trigger("editCodeClick")},deselect:function(){RM.constructorRouter.closeCodeEditor(),r.a.prototype.deselect.apply(this,arguments)},destroy:function(){var t=!0;RM.constructorRouter.closeCodeEditor(t),r.a.prototype.destroy.apply(this,arguments)}},{defaults:{use_iframe:!0}}),Pt=l.a.extend({customResizeHandler:function(t){return this.block.plugin&&a.a.isFunction(this.block.plugin.customResizeHandler)?this.block.plugin.customResizeHandler.apply(this,arguments):t}}),$t=St,Ot=i("w4Sg"),Tt=i.n(Ot),Mt=i("Fi5S"),jt=r.a.extend({name:"Google Maps",sort_index:11,thumb:"gmaps",icon_color:"#88693D",initial_controls:["gmaps_settings","gmaps_edit","common_animation","common_position","common_layer","common_lock"],initialize:function(t,e){this.mag=e.mag,this.frameClass=It,this.initBlock(t,e),this.initOpts()},render:function(){r.a.prototype.render.apply(this,arguments),this.triggerReady(),this.$el.addClass("gmaps"),this.$content.html(Tt.a["template-constructor-block-gmaps"]()),this.$search=Object(s.a)(Tt.a["template-constructor-block-gmaps-search-control"]()),this.search=this.$search.get(0),this.$source=this.$search.find(".rm-search.source"),this.$destination=this.$search.find(".rm-search.destination"),this.$apiKeyBlock=this.$content.find(".rm-gmaps-key"),this.$apiKeyInput=this.$apiKeyBlock.find("input"),this.$apiKeyApply=this.$apiKeyBlock.find("button"),a.a.extend(this.frame,{minwidth:240,minheight:210}),this.setControls(),this.generateMap(this.bindLogic)},generateMap:function(t){var e=this.model.get("api_key");this.$apiKeyBlock[e?"addClass":"removeClass"]("hidden"),ut.a.initGMapsAPI(e,function(){var e,i,s,o,n,r,l,c=this.model.get("current_type");a.a.defer(function(){this.map=new google.maps.Map(this.$(".map-container").get(0),{zoom:this.model.get("map_zoom"),center:new google.maps.LatLng(this.model.get("center_lat"),this.model.get("center_lng")),mapTypeId:this.model.get("map_type_id")||google.maps.MapTypeId.ROADMAP,streetViewControl:!1}),this.marker=new google.maps.Marker({map:this.map,draggable:!0}),this.sourceAutocomplete=new google.maps.places.Autocomplete(this.$source.get(0),{}),this.destinationAutocomplete=new google.maps.places.Autocomplete(this.$destination.get(0),{}),this.directionsService=new google.maps.DirectionsService,this.directionsDisplay=new google.maps.DirectionsRenderer,e=this.model.get("marker_lat"),i=this.model.get("marker_lng"),e&&i&&"directions"!=c&&this.dropMarker(new google.maps.LatLng(e,i)),s=this.model.get("direction_start_lat"),o=this.model.get("direction_start_lng"),n=this.model.get("direction_end_lat"),r=this.model.get("direction_end_lng"),l=this.model.get("direction_route_type"),s&&o&&n&&r&&l&&(this.source=new google.maps.LatLng(s,o),this.destination=new google.maps.LatLng(n,r)),this.onMapTypeChange(),this.onShowControlsChange(),this.redraw(this.model,{skipTriggerRedraw:!0,doNotRedrawPacksFrames:!0,doNotRedrawBottomShiftLine:!0}),t&&t()}.bind(this))}.bind(this))},redraw:function(t,e){e=e||{},this.checkNeedRedraw(t,e)&&r.a.prototype.redraw.apply(this,arguments)},onMapTypeChange:function(t){var e=this.model.get("current_type");this.$destination.toggleClass("hidden","directions"!==e),this.marker.setVisible("directions"!==e),"directions"!==e?this.clearRoute():this.drawRoute(!t),"custom"==e&&this.model.get("custom_json")?this.applyCustomStyle():this.clearCustomStyle()},onSourceChage:function(){var t=this.sourceAutocomplete.getPlace();if(t.geometry){if(this.source=t.geometry.location,"directions"==this.model.get("current_type"))return this.drawRoute();this.marker.setVisible(!1),t.geometry.viewport?this.map.fitBounds(t.geometry.viewport):(this.map.setCenter(t.geometry.location),this.map.setZoom(17)),this.model.set("formatted_address",t.formatted_address),this.dropMarker(t.geometry.location)}},onDestinationChange:function(){var t=this.destinationAutocomplete.getPlace();t.geometry&&(this.destination=t.geometry.location,this.drawRoute())},drawRoute:function(t){var e=this.model.get("direction_route_type");this.source&&this.destination&&e&&(this.directionsDisplay.setMap(null),this.directionsService.route({origin:this.source,destination:this.destination,travelMode:google.maps.TravelMode[e.toUpperCase()]},function(e,i){var s;if(i==google.maps.DirectionsStatus.OK)this.directionsDisplay.setDirections(e),this.directionsDisplay.setOptions({preserveViewport:t||!1}),this.directionsDisplay.setMap(this.map),this.model.set({direction_start_lat:this.source.lat(),direction_start_lng:this.source.lng(),direction_end_lat:this.destination.lat(),direction_end_lng:this.destination.lng()}),google.maps.event.trigger(this.map,"resize"),a.a.defer(function(){s=this.map.getCenter(),this.model.set({center_lat:s.lat(),center_lng:s.lng(),map_zoom:this.map.getZoom()})}.bind(this));else{if(!this.model.get("api_key"))return;this.showMessage("Sorry, there's no route for selected directions.")}}.bind(this)))},clearRoute:function(){this.directionsDisplay.setMap(null)},dropMarker:function(t){this.marker.setPosition(t),this.marker.setAnimation(google.maps.Animation.DROP),this.marker.setVisible(!0),this.markerDropped=!0},setControls:function(){this.controls=this.initial_controls},bindLogic:function(){this.listenTo(this.model,"change:current_type",this.onMapTypeChange),this.listenTo(this.model,"change:custom_json",this.applyCustomStyle),this.listenTo(this.model,"change:direction_route_type",this.onRouteTypeChange),this.listenTo(this.model,"change:show_controls",this.onShowControlsChange),this.listenTo(this.model,"change:api_key",this.onApiKeyChange),this.listenTo(this.model,"change",this.hideMessage),google.maps.event.addListener(this.sourceAutocomplete,"place_changed",this.onSourceChage),google.maps.event.addListener(this.destinationAutocomplete,"place_changed",this.onDestinationChange),google.maps.event.addListener(this.marker,"dragend",this.onMarkerDragEnd),google.maps.event.addListener(this.map,"maptypeid_changed",this.onMapTypeIdChange),this.$source.on("click",this.onInputClick),this.$destination.on("click",this.onInputClick),this.$el.on("dblclick",function(){this.inEditState||this.trigger("editMapClick")}.bind(this)),Mt.a.on("gmaps:update_key",this.updateKey),this.$apiKeyInput.on("click",this.onApiKeyInputClick),this.$apiKeyApply.on("click",this.onApiKeyApply)},unbindLogic:function(){this.stopListening(this.model),window.google&&window.google.maps&&(google.maps.event.clearListeners(this.sourceAutocomplete,"place_changed"),google.maps.event.clearListeners(this.destinationAutocomplete,"place_changed"),google.maps.event.clearListeners(this.marker,"dragend")),this.$source.off("click",this.onInputClick),this.$destination.off("click",this.onInputClick),this.$el.off("dblclick"),Mt.a.off("gmaps:update_key",this.updateKey),this.$apiKeyInput.off("click",this.onApiKeyInputClick),this.$apiKeyApply.off("click",this.onApiKeyApply)},enterEditState:function(){this.inEditState=!0,this.disableDragging=!0,this.$(".map-overlay").hide(),this.$el.addClass("edit-map"),this.map.controls[google.maps.ControlPosition.TOP_LEFT].push(this.search),a.a.delay(function(){this.$source.focus()}.bind(this),300),this.onShowControlsChange()},exitEditState:function(){var t,e,i={};this.inEditState&&(this.disableDragging=!1,this.$(".map-overlay").show(),this.$el.removeClass("edit-map"),this.map.controls[google.maps.ControlPosition.TOP_LEFT].pop(),this.inEditState=!1,this.onShowControlsChange(),t=this.map.getCenter(),a.a.extend(i,{center_lat:t.lat(),center_lng:t.lng(),map_zoom:this.map.getZoom()}),this.markerDropped&&(e=this.marker.getPosition(),a.a.extend(i,{marker_lat:e.lat(),marker_lng:e.lng()})),this.model.set(i))},onMarkerDragEnd:function(){var t=this.marker.getPosition();this.model.set({marker_lat:t.lat(),marker_lng:t.lng(),formatted_address:""})},onMapTypeIdChange:function(){var t=this.map.getMapTypeId();this.model.set({map_type_id:t})},onInputClick:function(t){var e=Object(s.a)(t.currentTarget);a.a.defer((function(){e.select()}))},applyCustomStyle:function(){var t=this.model.get("custom_json");t?this.map.setOptions({styles:JSON.parse(t)}):this.map.setOptions({styles:null})},clearCustomStyle:function(){this.map.setOptions({styles:null})},onRouteTypeChange:function(){this.drawRoute()},onShowControlsChange:function(){var t=this.inEditState||this.model.get("show_controls");t!=this.isControlsVisible&&(this.map.setOptions({panControl:t,zoomControl:t,mapTypeControl:t,scaleControl:t}),this.isControlsVisible=t)},onApiKeyChange:function(t,e){this.model.save(),Mt.a.trigger("gmaps:update_key",this.model.get("api_key"),this.model.get("_id")),this.regenerateMap(),this.viewOpts.saveOpts({gmaps_key:e})},updateKey:function(t,e){this.model.get("_id")!==e&&this.model.get("api_key")!==t&&(this.model.set("api_key",t,{silent:!0}),this.model.save(),this.regenerateMap())},regenerateMap:function(){ut.a.destroyGMapsAPI(),a.a.defer(function(){this.generateMap()}.bind(this))},onApiKeyInputClick:function(t){t.stopImmediatePropagation()},onApiKeyApply:function(t){t.stopImmediatePropagation();var e=this.$apiKeyInput.val();e&&39===e.length&&(this.model.set("api_key",e),this.$apiKeyInput.val(""),this.$apiKeyApply.addClass("hidden"))},initOpts:function(){var t=this,e=Backbone.Model.extend({url:"/api/mag/opts/"+this.mag.get("num_id")});this.viewOpts=new e(this.mag.get("opts")||{}),this.viewOpts.saveOpts=function(){this.save.apply(this,arguments),t.mag.set("opts",this.toJSON())}},showMessage:function(t){this.$(".message-overlay").text(t).removeClass("invisible")},hideMessage:function(){this.$(".message-overlay").addClass("invisible")},deselect:function(){r.a.prototype.deselect.apply(this,arguments),this.exitEditState()},destroy:function(){this.unbindLogic(),r.a.prototype.destroy.apply(this,arguments)}},{defaults:{current_type:"standard",center_lat:30,center_lng:-47,map_zoom:2,show_controls:!0,scrollwheel:!0}}),It=l.a.extend({onResize:function(t,e){l.a.prototype.onResize.apply(this,arguments),this.block.map&&window.google&&window.google.maps&&google.maps.event.trigger(this.block.map,"resize")}}),Et=jt,At=i("lRGI"),Rt=i("Fts9"),Dt=r.a.extend({name:"Button",sort_index:7,thumb:"button",icon_color:"#FF5A57",viewport_fields:c.b.viewport_fields.button,initial_controls:["button_settings","button_icon","button_edit","picture_link","common_animation","common_position","common_layer","common_lock"],MIN_FONT_SIZE:8,MAX_FONT_SIZE:999,MIN_LETTER_SPACING:-99,MAX_LETTER_SPACING:999,DEFAULT_BACKGROUND_COLOR:"0078ff",RASTERIZE_MULTIPLIER:2,settingsOnCreate:!1,initialize:function(t,e){this.mag=e.mag,this.initBlock(t,e),this.isEditMode=!1,this.buttonState="default",this._oldAttrs=a.a.clone(this.model.attributes),this.onTextInput.__debounced=a.a.debounce(this.onTextInput,20),this.onIconChange.__debounced=a.a.debounce(this.onIconChange,20),this.onIconColorChange.__debounced=a.a.debounce(this.onIconColorChange,20),this.recalcIconContainerSize.__debounced=a.a.debounce(this.recalcIconContainerSize,20),this.onTextContainerSizeChange.__debounced=a.a.debounce(this.onTextContainerSizeChange,20),this.rasterizeSVG.__debounced_default=a.a.debounce(this.rasterizeSVG,100),this.rasterizeSVG.__debounced_hover=a.a.debounce(this.rasterizeSVG,100),this.rasterizeSVG.__debounced_current=a.a.debounce(this.rasterizeSVG,100),this.rasterizeSVG.__debounced_both=a.a.debounce(this.rasterizeSVG,100)},render:function(){var t,e=a.a.clone(this.model.attributes),i=e.tp;this.create(),this.$el.addClass("button"),t={model:e,$container:this.$content,environment:"constructor",mag:this.mag,block:this},this.buttonWidget=new At.a(t),this.$button=this.$(".common-button"),this.$textInput=this.$button.children(".text"),this.$buttonIcon=this.$button.children(".icon"),"icon"!==i&&"text_and_icon"!==i||this.getIconSVG(this.model.get("icon_noun_id")||this.model.get("icon_rm_id"),this.model.get("icon_noun_url"),function(t,e){!t&&e.$svg&&(this.renderIcon({$svg:this.getoloredIconSVG()}),this.model.get("icon_rasterUrl")||this.rasterizeSVG({default:!0,hover:!0,current:!0}))}.bind(this)),this.recalcButtonSize(),this.disableTextInput(),this.handleSelectionColor(),this.bindDOMEvents(),this.bindModelEvents(),this.controls=this.initial_controls,this.frame.recalcPointsDirections(),this.model.created&&setTimeout(function(){this.enterEditMode({selectText:!0})}.bind(this),500),this.triggerReady()},redraw:function(t,e){return this.proportional&&t.get("w")!=t.get("h")&&this.recalcButtonSize(),r.a.prototype.redraw.apply(this,arguments)},bindDOMEvents:function(){this.$el.on("mousedown",this.onButtonMousedown),this.$button.on("dblclick",this.onButtonDoubleClick),this.$textInput.on("input",this.onTextInput)},unbindDOMEvents:function(){this.$el.off("mousedown",this.onButtonMousedown),this.$button.off("dblclick",this.onButtonDoubleClick),this.$textInput.off("input",this.onTextInput)},bindModelEvents:function(){this.model.on("change:tp",this.onTypeChange,this),this.model.on("change:form",(function(t,e,i){this.onFormChange(t,e,i)}),this),this.model.on("change:icon_enabled",this.determineButtonType,this),this.model.on("change:text",(function(t,e,i){(i.undo||i.redo||i.socketUpdate)&&this.$textInput.val(this.model.get("text"))}),this),this.model.on("change:text_w change:text_h",(function(){this.onTextContainerSizeChange()}),this);var t=this.getIndividualStyles();this.model.on(t,(function(){var t=a.a.clone(this.model.attributes);this.buttonWidget.generateIndividualStyleCSS({env:"constructor",model:t}),this.onTextInput()}),this),this.model.on("change:current-font-family change:current-font-weight change:current-font-style",(function(){this.waitOnExactWebFontLoaded()}),this),this.model.on("change:font-family change:font-weight change:font-style",(function(){this.waitOnExactWebFontLoaded()}),this),this.model.on("change:icon_enabled change:icon_noun_id change:icon_rm_id change:icon_noun_url",(function(t,e,i){this.onIconChange.__debounced(t,e,i)}),this),this.model.on("change:icon_h",(function(t,e,i){this.recalcIconContainerSize(t,e,i)}),this),this.model.on("change:icon_pos",(function(t,e,i){this.onIconPositionChange(),this.recalcButtonSize()}),this),this.model.on("change:icon_color change:icon_color_opacity",(function(t,e,i){this.onIconColorChange(t,e,i)}),this),this.model.on("change:hover-icon_color change:hover-icon_color_opacity",(function(t,e,i){this.onIconColorChange(t,e,i,"hover")}),this),this.model.on("change:current-icon_color change:current-icon_color_opacity",(function(t,e,i){this.onIconColorChange(t,e,i,"current")}),this)},getIndividualStyles:function(){var t=["background-color","background-color-opacity","border-radius","border-width","border-color","border-color-opacity","font-family","font-style","font-weight","color","color-opacity","font-size","letter-spacing","hover-background-color","hover-background-color-opacity","hover-border-width","hover-border-color","hover-border-color-opacity","hover-color","hover-color-opacity","current-background-color","current-background-color-opacity","current-border-radius","current-border-width","current-border-color","current-border-color-opacity","current-color","current-color-opacity","current-font-family","current-font-style","current-font-weight","current-font-size","current-letter-spacing"];return t.forEach((function(t,e,i){i[e]="change:"+t})),t.join(" ")},onFormChange:function(t,e,i){var s=!1;if(!i.undo&&!i.redo){this.model.get("form");s=!0}this.recalcButtonSize({onFormChange:!0,adjust_height_to_content_for_rectangle:s})},onIconPositionChange:function(){this.buttonWidget.applyIconContainerSize(a.a.clone(this.model.attributes)),this.buttonWidget.applyIconPosition(a.a.clone(this.model.attributes))},onTextContainerSizeChange:function(){this.buttonWidget.applyTextContainerSize(a.a.clone(this.model.attributes))},onIconColorChange:function(t,e,i,s){if(s=s||"default","text"!==this.model.get("tp")&&(this.renderIcon({$svg:this.getoloredIconSVG({buttonState:s})}),!(i.onIconChange||i.undo||i.redo))){var o=this.rasterizeSVG["__debounced_"+s];if(a.a.isFunction(o)){var n={};n[s]=!0,o(n)}}},"getoloredIconSVG":function(t){t=t||{};var e,i,o,n,r=a.a.clone(this.model.attributes),l=this.currentIconData.$svg.clone();return"hover"===(e="default"===t.buttonState?"default":"hover"===t.buttonState||"hover"===this.buttonState?"hover":"current"===t.buttonState||"current"===this.buttonState?"current":"default")?(i=r["hover-icon_color"],o=r["hover-icon_color_opacity"]/100):"current"===e?(i=r["current-icon_color"]||r.icon_color,o=(a.a.isUndefined(r["current-icon_color_opacity"])?r.icon_color_opacity:r["current-icon_color_opacity"])/100):(i=r.icon_color,o=r.icon_color_opacity/100),n=d.b.getRGBA(i,1),l.find("*:not(.fixed-color)").each((function(){var t=Object(s.a)(this);t.css({fill:"","fill-opacity":""}),t.get(0).removeAttribute("fill"),t.get(0).removeAttribute("fill-opacity")})),l.get(0).setAttribute("fill",n),l.get(0).setAttribute("fill-opacity",o),l},onWorkspaceBlocksSelect:function(t){if(r.a.prototype.onWorkspaceBlocksSelect.apply(this,arguments),this.rendered){var e=t&&1==t.length&&t[0]==this;this.isEditMode&&!e&&(this.leaveEditMode({deselectControl:!0,saveWidgetData:!0}),this.workspace.trigger("redraw"))}},onButtonMousedown:function(t){this.isEditMode&&!Object(s.a)(t.target).is(".text")&&this.leaveEditMode({deselectControl:!0,saveWidgetData:!0})},onButtonDoubleClick:function(){this.model.get("pack_id")?r.a.prototype.onDblClick.apply(this,arguments):this.selected&&!this.isEditMode&&this.enterEditMode({selectText:!0})},enterEditMode:function(t){t=t||{},this.isEditMode=!0,this.determineButtonType({enter_edit_mode:!0}),this.enableTextInput(),t.selectText?this.$textInput.select():Object(s.a)(this.$textInput).focus().setCursorPos(0);var e,i=this.workspace&&this.workspace.controls;i&&(e=i.findControl("button_edit"))&&e.master.select(e)},leaveEditMode:function(t){if(t=t||{},this.model.set("text",this.$textInput.val()),this.isEditMode=!1,this.$textInput.blur(),this.disableTextInput(),this.determineButtonType(),t.saveWidgetData&&this.saveWidgetData(),t.deselectControl){var e,i=this.workspace&&this.workspace.controls;if(!i)return;if(!(e=i.findControl("button_edit")))return;e.master.deselect()}},disableTextInput:function(){this.$textInput.attr("readonly",!0)},enableTextInput:function(){this.$textInput.removeAttr("readonly")},onTextInput:function(){this.recalcTextInputSize(),this.recalcButtonSize()},recalcTextInputSize:function(){var t,e,i,o,n=this.$button.hasClass("current")?"current-":"",r=a.a.clone(this.model.attributes),l=r["".concat(n,"font-size")],c=r["".concat(n,"letter-spacing")],h=r["".concat(n,"font-family")],d=r["".concat(n,"font-style")],p=r["".concat(n,"font-weight")];this.$textInputSizeAdjuster&&this.$textInputSizeAdjuster.length||(this.$textInputSizeAdjuster=Object(s.a)("<div/>"),this.$textInputSizeAdjuster.css({position:"absolute",left:"-9999px","white-space":"pre",width:"auto"}).appendTo(this.$textInput.parent())),this.$textInputSizeAdjuster[0].className=this.$textInput[0].className,this.$textInputSizeAdjuster.addClass("fake"),this.$textInputSizeAdjuster.text(this.$textInput.val()),this.$textInputSizeAdjuster.css({"font-family":h,"font-style":d,"font-weight":p,"font-size":l+"px","letter-spacing":c+"px"}),t=this.$textInputSizeAdjuster.width(),e=this.$textInputSizeAdjuster.height(),this.$textInputSizeAdjuster.css("letter-spacing",0).text("M"),i=this.$textInputSizeAdjuster.width(),i=2*Math.ceil(i/2),o=this.$textInputSizeAdjuster.height(),0===this.$textInput.val().trim().length&&(t=i,e=o),t=2*Math.ceil(t/2),t+=i,e=2*Math.ceil(e/2),this.model.set({text_w:t,text_h:e,em_w:i})},recalcButtonSize:function(t){t=t||{};var e,i,s,o,n,r=a.a.clone(this.model.attributes),l=r.tp,c=r.form,h=r.w,d=r.h,p=r.x,u=r.y,g=r.text_w,m=r.text_h,f=r.em_w,v=r.icon_w,b=r.icon_h,_=r.icon_pos,w={};"text_and_icon"===l?(i=g+v,i+=2*f,i+=this.buttonWidget.calcIconMarginFromText(v),"left"!==_&&"right"!==_||(b>m?(s=b,s+=2*this.buttonWidget.calcIconTopBottomMargin(b)):(s=m,s+=2*this.buttonWidget.calcTextTopBottomMargin(r["font-size"])))):"text"===l?(i=g,i+=2*f,s=m,s+=this.buttonWidget.calcTextTopBottomMargin(r["font-size"])):"icon"===l&&(i=v+(e=this.buttonWidget.calcIconMarginFromText(v)),s=b+e),i>h&&(o=i),s>d&&(n=s);h=o||h,d=n||d;var y=Math.floor((h-d)/2);"circle"===c||"square"===c?(h>d?a.a.extend(w,{w:h,h:h,y:u-y,x:p-Math.floor((h-this.model.get("w"))/2)}):a.a.extend(w,{w:d,h:d,x:p+y,y:u-(d-this.model.get("h"))/2}),this.proportional=!0):"rectangle"===c&&(o&&a.a.extend(w,{w:o,x:p-Math.floor((o-this.model.get("w"))/2)}),n?a.a.extend(w,{h:n,y:u-(n-this.model.get("h"))/2}):t.adjust_height_to_content_for_rectangle&&a.a.extend(w,{h:s,y:u+Math.floor(((o||h)-s)/2)}),this.proportional=!1),t.onFormChange&&this.$el.addClass("resize-transition"),w.w&&"circle"===c?this.buttonWidget.applyCircleRadius():this.$button.css("border-radius",""),this.model.set(w),setTimeout(function(){window.requestAnimationFrame(function(){this.$el.removeClass("resize-transition")}.bind(this))}.bind(this),450),this.setSizeConstraints(i,s)},setSizeConstraints:function(t,e){a.a.extend(this.frame,{minwidth:t,maxwidth:9999,minheight:e,maxheight:9999})},determineButtonType:function(t){t=t||{};var e,i=this.model.get("icon_enabled"),s=!!t.enter_edit_mode||this.$textInput.val().trim().length;e=i&&s?"text_and_icon":i&&!s?"icon":"text",this.model.set("tp",e)},onTypeChange:function(){this.buttonWidget.applyIconContainerSize(a.a.clone(this.model.attributes)),this.buttonWidget.applyButtonType(this.model.get("tp")),this.recalcButtonSize()},waitOnExactWebFontLoaded:function(){var t=a.a.clone(this.model.attributes);a.a.indexOf(d.a.systemFontsList,t["font-family"].toLowerCase())>-1||h.a.exactWaitForFontLoad(t["font-family"],t["font-weight"],t["font-style"],this.onTextInput)},saveWidgetData:function(){a.a.isEqual(this.model.toJSON(),this._oldAttrs)||(this.saveXHR&&this.saveXHR.abort(),this._oldAttrs=a.a.clone(this.model.toJSON()),this.saveXHR=this.model.save())},deselect:function(t){r.a.prototype.deselect.apply(this,arguments),t!=this&&this.isEditMode&&(this.leaveEditMode({saveWidgetData:!0}),this.workspace.trigger("redraw"))},getSaveBoxOptions:function(t){return a.a.extend({patch:!0},t)},destroy:function(){this.buttonWidget&&this.buttonWidget.destroy(),this.buttonWidget=null,this.unbindDOMEvents(),this.model.off(null,null,this),r.a.prototype.destroy.apply(this,arguments)},MAX_ICON_CACHE_SIZE:30,onIconChange:function(t,e,i){t=a.a.clone(this.model.attributes),this.getIconSVG(t.icon_noun_id||t.icon_rm_id,t.icon_noun_url,function(t,e){!t&&e.$svg&&(i.undo||i.redo||this.recalcIconContainerSize(null,null,{onIconChange:!0}),this.renderIcon({$svg:this.getoloredIconSVG()}),i.undo||i.redo||this.rasterizeSVG({default:!0,hover:!0,current:!0}))}.bind(this))},areValuesLinked:function(t,e,i,s){var o=a.a.clone(this.model.attributes),n="default"===e?"":e+"-";return o[("default"===t?"":t+"-")+i]==o[n+(s||i)]},isTextAndIconColorLinked:function(t,e){return t=t||"default",(e=e||{}).compare_only_color?this.areValuesLinked(t,t,"color","icon_color"):this.areValuesLinked(t,t,"color","icon_color")&&this.areValuesLinked(t,t,"color-opacity","icon_color_opacity")},isTextAndIconSizeLinked:function(t){return t=t||"default",this.areValuesLinked(t,t,"font-size","icon_h")},recalcIconContainerSize:function(t,e,i){if("text"!==this.model.get("tp")){var s,o=this.model.get("icon_h");s=Math.floor(o*this.currentIconData.aspect_ratio),this.model.set({icon_w:s}),this.recalcButtonSize(),this.buttonWidget.applyIconContainerSize(a.a.clone(this.model.attributes)),i.onIconChange||i.undo||i.redo||this.rasterizeSVG.__debounced_both({default:!0,hover:!0,current:!0})}},rasterizeSVG:function(t){if((t=t||{}).default||t.hover||t.current){var e=function(e){e=e||"default";var i=this.getoloredIconSVG({buttonState:e});if(i||i.length){var s={default:"icon",hover:"hover-icon",current:"current-icon"},o=a.a.isUndefined(s[e])?s.default:s[e],n={width:this.model.get("icon_w")*this.RASTERIZE_MULTIPLIER,height:this.model.get("icon_h")*this.RASTERIZE_MULTIPLIER},r=e+"_icon_SVG_rasterize_Xhr";this[r]&&this[r].abort();var l=t[e+"Callback"];this[r]=rt.rasterize({widgets:[this.model],svg:i,mid:this.workspace.mag.get("_id"),viewport:this.model.getViewport(),size:n,prefix:o,onSuccess:function(t){l&&l(null,t)},onError:function(t){l&&l(t)}})}}.bind(this);t.default&&e("default"),t.hover&&e("hover"),t.current&&e("current")}},renderIcon:function(t){var e;e=(t=t||{}).$svg?t.$svg:this.getoloredIconSVG(),this.$buttonIcon.empty().html(e.clone())},getDefaultIconSVG:function(){return this.prepareIconSVG(Object(s.a)('<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="283.5px" height="283.5px" viewBox="0 0 283.5 283.5" enable-background="new 0 0 283.5 283.5" xml:space="preserve"><g><g><path fill-rule="evenodd" clip-rule="evenodd" fill="#231F20" d="M258.3,114.1c-14.1,0-23.1,25-30.1,33.8 c-7,8.8-33.3,2.7-44.1,0.7c-10.7-2.1-38.7-3.9-38.7-3.9s47.4-18,47.4-65c0-47.7-54.9-75.3-73.5-78.1c-17-2.8-23.8,5.6-25.4,7.8 c-1.6,2.2-4.2,4.1-8,5.9c-3.9,1.8-1.5-0.1-15.4,9.8c-13.9,9.8-41.8-4-44.1-4.6c-2.3-0.5-6.8-1.8-8,4.6c-1.5,9.6,6.7,25.4,6.7,25.4 s-2.2,0.2-8,3.3c-5.8,3.1-2.8,7.7-1.3,9.1c1.4,1.4,27.9,16.3,32.1,18.9c10.6,5.3,20.3,31.6-7.3,51.4C-3.1,163,0.4,198.7,0.4,198.7 s-12,85.2,126.9,85.2c139,0,155.6-96.1,155.6-124.2C283,131.5,272.4,114.1,258.3,114.1z M89.5,50.2c-7.1,6.5-15.7,8-19.3,3.5 c-3.6-4.6-0.7-13.5,6.3-20c7.1-6.5,15.7-8,19.3-3.5C99.4,34.7,96.6,43.7,89.5,50.2z M76.1,38.9c-4.7,4.3-6.6,10.3-4.2,13.3 c2.4,3,8.1,2,12.9-2.3c4.7-4.3,6.6-10.3,4.2-13.3C86.6,33.6,80.9,34.6,76.1,38.9z"/></g></g></svg>'))},getIconSVG:function(t,e,i){var o,n,r;if(this.iconXhr&&this.iconXhr.abort(),!t){var l=this.getDefaultIconSVG();return r={$svg:l,noun_url:null,aspect_ratio:l.data("aspect_ratio")},this.currentIconData=r,i(null,r)}if(o=this.getSVGCacheItem(t))return r={$svg:o.$svg,noun_url:o.noun_url,aspect_ratio:o.$svg.data("aspect_ratio")},this.currentIconData=r,i(null,r);var c=function(e){var o=Object(s.a)("<div></div>").append(Object(s.a)(e.svg)).find("svg");if(o.length)return o=this.prepareIconSVG(o),r={id:t,$svg:o,noun_url:e.new_url,aspect_ratio:o.data("aspect_ratio")},this.currentIconData=r,this.cacheSVGData(r),i(null,{$svg:o,noun_url:e.new_url})}.bind(this);n={method:"POST",url:"/api/authservice/noun/icon",data:{id:t,url:e},dataType:"json",success:function(t){this.iconRequestInProgress=!1,c(t)},error:function(t){return this.iconRequestInProgress=!1,i(t)},context:this},/^rm/.test(t)&&a.a.extend(n,{method:"GET",url:e,cache:!1,success:function(t){this.iconRequestInProgress=!1,c({svg:Object(s.a)(t).find("svg"),new_url:e})},data:null,dataType:null}),this.iconRequestInProgress=!0,this.iconXhr=s.a.ajax(n)},prepareIconSVG:function(t){var e=t.clone().appendTo(Object(s.a)("body")),i=t.clone();e.get(0).setAttributeNS(null,"viewBox","0 0 "+e.width()+" "+e.height());var o=e.get(0).getBBox();return e.remove(),i.data("aspect_ratio",o.width/o.height),i.removeAttr("width"),i.removeAttr("height"),i.get(0).setAttributeNS(null,"viewBox",o.x+" "+o.y+" "+o.width+" "+o.height),i.get(0).setAttributeNS(null,"preserveAspectRatio","xMidYMid meet"),i.css({width:"100%",height:"100%"}),i},cacheSVGData:function(t){window.iconSVGCache.push(t),window.iconSVGCache.length>this.MAX_ICON_CACHE_SIZE&&window.iconSVGCache.shift()},getSVGCacheItem:function(t){return window.iconSVGCache&&a.a.findWhere(window.iconSVGCache,{id:t})},handleSelectionColor:function(t){t=t||Rt.a.prototype.hex2rgb(this.model.get("background-color")).concat(1);var e=Rt.a.prototype.hex2rgb(this.DEFAULT_BACKGROUND_COLOR).concat(1);this.$button.toggleClass("is-contrast-selection",Rt.a.prototype.areColorsClose(t,e))}},{defaults:{tp:"text",form:"rectangle",text:"Edit",w:134,h:50,x:"center",transition:!1,text_w:48,text_h:26,em_w:16,"background-color":"0078ff","background-color-opacity":100,"border-radius":5,"border-width":0,"border-color":"000000","border-color-opacity":100,"font-family":"Arial","font-style":"normal","font-weight":400,color:"ffffff","color-opacity":100,"font-size":18,"letter-spacing":0,"hover-background-color":"0078ff","hover-background-color-opacity":80,"hover-border-width":0,"hover-border-color":"000000","hover-border-color-opacity":100,"hover-color":"ffffff","hover-color-opacity":100,"current-background-color":"0078ff","current-background-color-opacity":100,"current-border-radius":5,"current-border-width":0,"current-border-color":"000000","current-border-color-opacity":100,"current-font-family":"Arial","current-font-style":"normal","current-font-weight":400,"current-color":"ffffff","current-color-opacity":100,"current-font-size":18,"current-letter-spacing":0,icon_enabled:!1,icon_h:18,icon_w:18,icon_pos:"left",icon_noun_id:null,icon_rm_id:null,icon_noun_url:null,icon_color:"ffffff",icon_color_opacity:100,"hover-icon_color":"ffffff","hover-icon_color_opacity":100,"current-icon_color":"ffffff","current-icon_color_opacity":100,icon_rasterUrl:null,icon_raster2xUrl:null,"hover-icon_rasterUrl":null,"hover-icon_raster2xUrl":null,"current-icon_rasterUrl":null,"current-icon_raster2xUrl":null}}),zt=i("cBBe"),Lt=i("U72E"),Bt=i.n(Lt),Ft=n.a.View.extend({initialize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.a.bindAll(this),(t.positions||t.positions.length)&&(this.positions=t.positions,this.workspace_inside_block=t.workspace_inside_block,this.render(),this.bind_events())},render:function(){this.resize_handles_fragment=window.document.createDocumentFragment(),this.positions.forEach(a.a.bind((function(t){Object(s.a)("<div/>").addClass("resize-handle").addClass(t).attr("data-pos",t).appendTo(this.resize_handles_fragment)}),this)),this.workspace_inside_block.$el.append(this.resize_handles_fragment),this.$resize_handles=this.workspace_inside_block.$el.children(".resize-handle"),this.apply_resize_handles_visual_state()},apply_resize_handles_visual_state:function(){var t=this.workspace_inside_block.block.model.get("tip_pos"),e=this.workspace_inside_block.get_visible_blocks();if(e.length){var i=a.a.find(e,(function(t){return"picture"===t.model.get("type")}));if(this.$resize_handles.removeClass("hidden"),i&&!1===i.originalLoaded)this.$resize_handles.addClass("hidden");else if(1===e.length){var s=e[0].model.get("type");"text"===s&&(this.$resize_handles.filter('[data-pos="bottom"]').addClass("hidden"),this.$resize_handles.filter('[data-pos="top"]').addClass("hidden"))}"top"===t?this.$resize_handles.filter('[data-pos="bottom"]').addClass("hidden"):"right"===t?this.$resize_handles.filter('[data-pos="left"]').addClass("hidden"):"bottom"===t?this.$resize_handles.filter('[data-pos="top"]').addClass("hidden"):"left"===t&&this.$resize_handles.filter('[data-pos="right"]').addClass("hidden")}else this.$resize_handles.addClass("hidden")},bind_events:function(){Object(s.a)(this.$resize_handles).drag("start",this.on_resize_start).drag(this.on_resize).drag("end",this.on_resize_end),this.listenTo(this.workspace_inside_block.block.model,"change:tip_pos",this.apply_resize_handles_visual_state),this.listenTo(this.workspace_inside_block.block.model,"change:wids",this.apply_resize_handles_visual_state),this.listenTo(this.workspace_inside_block.block.model.widgets_collection,"change:hidden",this.apply_resize_handles_visual_state),this.listenTo(this.workspace_inside_block,"loading_original_picture",this.apply_resize_handles_visual_state)},on_resize_start:function(t,e){var i=Object(s.a)(t.currentTarget),o=i.data("pos"),n=this.workspace_inside_block.get_box_data(),r=this.workspace_inside_block.min_width,l=this.workspace_inside_block.min_height,c=null,h=this.workspace_inside_block.get_visible_blocks();e.scrollTop=this.workspace_inside_block.page_workspace.$container.scrollTop();var d=a.a.find(h,(function(t){return"picture"===t.model.get("type")})),p=a.a.find(h,(function(t){return"text"===t.model.get("type")}));if(!p||!p.isEditMode){if("top"===o||"bottom"===o)if(h.length>1)(p=a.a.find(h,(function(t){return"text"===t.model.get("type")})))&&(l=p.getBoxData().h+this.workspace_inside_block.min_height);if(d){d.model.off("change",d.redraw);var u=n,g=d.model.get("scale"),m={left:u.left_abs+parseInt(d.$el.css("left"))-Math.round(d.model.get("cropX")*g),top:u.top_abs+parseInt(d.$el.css("top"))-Math.round(d.model.get("cropY")*g)};d.initialCrop=m;var f=d.model.get("originalW"),v=d.model.get("originalH");d.frame.constraints={top:m.top,left:m.left,width:Math.round(f*g),height:Math.round(v*g)},c=d.frame.constraints}this.resize_params={$handle:i,handle_pos:o,box_on_drag_start:n,box_position:this.workspace_inside_block.block.model.get("tip_pos"),min_height:l,min_width:r,max_width:9999,max_height:9999,constraints:c,visible_blocks:h,max_block_height:this.workspace_inside_block.block.model.get("tip_h"),picture_block:d,picture_initial_crop_on_drag_start:d&&a.a.clone(d.initialCrop),text_block:p}}},on_resize:function(t,e){var i,o=this.resize_params.handle_pos,n=a.a.clone(this.resize_params.box_on_drag_start),r=e.startY+e.scrollTop,l=t.pageY+this.workspace_inside_block.page_workspace.$container.scrollTop();e.deltaY=l-r,this.resize_params.constraints&&(i=this.resize_params.constraints);var c=this.resize_params.visible_blocks,h=this.resize_params.picture_block,d=this.resize_params.text_block;if(!d||!d.isEditMode){var p=0,u=this.resize_params.box_position;if("top"===o||"bottom"===o?"top"===o?(n.top_abs+=e.deltaY,n.height-="left"===u||"right"===u?2*e.deltaY:e.deltaY):"bottom"===o&&("left"===u||"right"===u?(n.top_abs-=e.deltaY,n.height+=2*e.deltaY):n.height+=e.deltaY):"left"!==o&&"right"!==o||("left"===o?"top"===u||"bottom"===u?(n.left_abs+=e.deltaX,n.width-=2*e.deltaX):(n.left_abs+=e.deltaX,n.width-=e.deltaX):"right"===o&&("top"===u||"bottom"===u?(n.left_abs-=e.deltaX,n.width+=2*e.deltaX):n.width+=e.deltaX)),n.height<this.resize_params.min_height?("left"===u||"right"===u?n.top_abs-=(this.resize_params.min_height-n.height)/2:"top"===u&&(n.top_abs-=this.resize_params.min_height-n.height),n.height=this.resize_params.min_height):n.height>this.resize_params.max_height&&(n.height=this.resize_params.max_height),n.width<this.resize_params.min_width?("top"===u||"bottom"===u?n.left_abs-=(this.resize_params.min_width-n.width)/2:"left"===u&&(n.left_abs-=this.resize_params.min_width-n.width),n.width=this.resize_params.min_width):n.width>this.resize_params.max_width&&(n.width=this.resize_params.max_width),"left"===o||"right"===o){if(c.forEach((function(t){var e=t.getBoxData();t.frame.doResize({left:e.x,top:e.y,width:n.width,height:e.h},!1)})),d){if(h){var g=d.getBoxData();n.height-=g.h,"top"===u?n.top_abs+=g.h:"left"!==u&&"right"!==u||(n.top_abs+=g.h/2)}if(d.$el.find(".text-preview").children().each((function(){p+=Object(s.a)(this).outerHeight()})),g=d.getBoxData(),d.frame.doResize({left:g.x,top:g.y,width:g.w,height:p},!1),h){n.height+=p,"top"===u?n.top_abs-=p:"left"!==u&&"right"!==u||(n.top_abs-=p/2);var m=h.getBoxData(),f=n.top_abs+m.y-Math.round(h.model.get("cropY")*h.model.get("scale"));h.$backpic&&h.$backpic.css("top",f),h.initialCrop.top=f,h.frame.constraints.top=f}else n.height=p;this.resize_params.box_on_drag_start.height=n.height,this.resize_params.box_on_drag_start.top_abs=n.top_abs}}else if(("top"===o||"bottom"===o)&&h){var v=a.a.reject(c,(function(t){return"picture"===t.model.get("type")})),b=n.height;v.forEach((function(t){var e=t.getBoxData();b-=e.h}));var _=h.getBoxData();h.frame.doResize({left:_.x,top:_.y,width:_.w,height:b},!1)}if(this.workspace_inside_block.block.workspace.set_group([{_id:this.workspace_inside_block.block.model.get("_id"),tip_w:n.width,tip_h:n.height}],{viewport:"default",forceDefaultViewport:!0}),i){var w={width:n.width,height:n.height,left_abs:n.left_abs,top_abs:n.top_abs},y=this.resize_params.picture_initial_crop_on_drag_start;if(d&&(g=d.getBoxData(),w.height-=g.h),("left"===o||"right"===o)&&w.width>=i.width){var k=(m=h.getBoxData()).x,C=m.y,x=m.h,S=w.width,P=h.model.get("originalW"),$=h.model.get("originalH"),O=P/$,T={},M=null,j={};h.model.get("ratio")>O?(M=S/P,T={cropX:0,cropY:Math.round(($-x/M)/2),cropW:P,cropH:Math.round(x/M)},j={width:S,height:Math.round(S/O),top:-Math.round(T.cropY*M),left:0}):(M=x/$,T={cropX:0,cropY:0,cropW:Math.round(S/M),cropH:$},j={width:Math.max(Math.round(x*O),w.width),height:x,top:0,left:0}),h.model.set(a.a.extend({scale:M.toFixed(15),ratio:(S/x).toFixed(5)},T),{skipHistory:!0}),h.$picture&&h.$picture.css(j);var I={width:j.width,height:j.height,top:w.top_abs+C+j.top,left:w.left_abs+k+j.left};h.$backpic&&h.$backpic.css(I),h.initialCrop={top:w.top_abs+C+j.top,left:w.left_abs+k+j.left},h.frame.constraints=I}else if(("top"===o||"bottom"===o)&&w.height>=i.height)k=(m=h.getBoxData()).x,C=m.y,x=w.height,S=m.w,O=(P=h.model.get("originalW"))/($=h.model.get("originalH")),T={},M=null,j={},h.model.get("ratio")>O?(M=S/P,T={cropX:0,cropY:0,cropW:P,cropH:Math.round(x/M)},j={width:S,height:Math.max(Math.round(S/O),w.height),top:0,left:0}):(M=x/$,T={cropX:Math.round((P-S/M)/2),cropY:0,cropW:Math.round(S/M),cropH:$},j={width:Math.round(x*O),height:x,top:0,left:-Math.round(T.cropX*M)}),h.model.set(a.a.extend({scale:M.toFixed(15),ratio:(S/x).toFixed(5)},T),{skipHistory:!0}),h.$picture.css(j),I={width:j.width,height:j.height,top:w.top_abs+C+j.top,left:w.left_abs+k+j.left},h.$backpic&&h.$backpic.css(I),h.initialCrop={top:w.top_abs+C+j.top,left:w.left_abs+k+j.left},h.frame.constraints=I;else if(w.left_abs+w.width>i.left+i.width){var E=i.left+i.width-w.left_abs-w.width;h.initialCrop.left=y.left-E,h.$backpic&&h.$backpic.css("left",h.initialCrop.left),m=h.getBoxData(),h.onCropResize({width:m.w,height:m.h,left:m.x,top:m.y})}else w.left_abs<i.left?(E=i.left-w.left_abs,h.initialCrop.left=y.left-E,h.$backpic&&h.$backpic.css("left",h.initialCrop.left),m=h.getBoxData(),h.onCropResize({width:m.w,height:m.h,left:m.x,top:m.y})):w.top_abs<i.top?(E=i.top-n.top_abs,h.initialCrop.top=y.top-E,h.$backpic&&h.$backpic.css("top",h.initialCrop.top),m=h.getBoxData(),h.onCropResize({width:m.w,height:m.h,left:m.x,top:m.y})):w.top_abs+w.height>i.top+i.height?(E=i.top+i.height-(w.top_abs+w.height),h.initialCrop.top=y.top-E,h.$backpic&&h.$backpic.css("top",h.initialCrop.top),m=h.getBoxData(),h.onCropResize({width:m.w,height:m.h,left:m.x,top:m.y})):(m=h.getBoxData(),h.onCropResize({width:m.w,height:m.h,left:m.x,top:m.y}))}}},on_resize_end:function(t){var e,i=[{_id:this.workspace_inside_block.block.model.get("_id"),tip_w:this.workspace_inside_block.block.model.get("tip_w"),tip_h:this.workspace_inside_block.block.model.get("tip_h")}];this.resize_params.visible_blocks.forEach(function(t){t._justResized=!0;var s=a.a.extend({_id:t.model.get("_id")},t.getBoxData());"picture"===t.model.get("type")&&(e=t,a.a.extend(s,{cropX:t.model.get("cropX"),cropY:t.model.get("cropY"),cropW:t.model.get("cropW"),cropH:t.model.get("cropH"),ratio:t.model.get("ratio"),scale:t.model.get("scale")}),!t.isAnimated()&&!t.useLambdaUrl()&&t.getFinalImage((function(t){t&&console.log("w-picture getFinalImage error: ",t)}),{silent:!0,patch:!0})),i.push(s),t.model.set(s,{skipHistory:!0,forceDefaultViewport:!0})}.bind(this)),this.workspace_inside_block.block.workspace.save_group(i,{isHotspot:!0,viewport:"default",forceDefaultViewport:!0}),e&&e.model.on("change",e.redraw)},show:function(){this.workspace_inside_block.$el.addClass("resize-handles-visible")},hide:function(){this.workspace_inside_block.$el.removeClass("resize-handles-visible")},destroy:function(){this.resize_handles_fragment&&Object(s.a)(this.resize_handles_fragment).remove(),this.stopListening()}}),Ht=i("1ljF"),Nt=i.n(Ht),Vt=n.a.View.extend({events:{"click .widget":"on_widget_select"},initialize:function(t){a.a.bindAll(this),this.workspace=t.workspace_inside_block,this.model=this.workspace.block.model,this.$container=t.$container||this.workspace.$el,this.template=Nt.a["template-constructor-workspace-inside-block-widget-selector"],this.render(),this.bind_events()},render:function(){this.setElement(Object(s.a)(this.template())),this.$el.appendTo(this.$container),this.updateSelectorStateAndPos()},bind_events:function(){this.listenTo(this.model,"change:tip_pos",this.updateSelectorStateAndPos),this.listenTo(this.model,"change:wids",(function(){this.$el.data("processing",!1),this.updateSelectorStateAndPos()})),this.listenTo(this.model.widgets_collection,"change:hidden",(function(){this.$el.data("processing",!1),this.updateSelectorStateAndPos()}))},updateSelectorStateAndPos:function(t){var e=this.$(".widget"),i=this.workspace.get_visible_blocks(),s=!a.a.isEmpty(i);e.removeClass("enabled"),a.a.each(i,a.a.bind((function(t){e.filter("[data-block-type="+t.model.get("type")+"]").addClass("enabled")}),this)),this.workspace.$el.toggleClass("no-widgets",!s),this.$el.toggleClass("compact",!!s).toggleClass("right-pos",!(!s||"left"!==this.model.get("tip_pos"))),this.$el.css({left:s?"":this.model.get("tip_w")/2-this.$el.width()/2+"px"})},on_widget_select:function(t){if(this.workspace.trigger("deselect"),this.workspace.page_workspace.controls.hide(),!this.$el.data("processing")){this.$el.data("processing",!0);var e=Object(s.a)(t.currentTarget).data("block-type"),i=a.a.filter(this.workspace.blocks,(function(t){return t.model.get("type")===e}))[0];if(i)if(i.model.get("hidden")){var o=i.frame.doResize({left:i.model.get("x"),top:i.model.get("y"),width:this.workspace.get_box_data().width,height:i.model.get("h")},!1);if("picture"===i.model.get("type")){var n,r=o.width,l=i.getBoxData().h,c={},h={},d=i.model.get("originalW")/i.model.get("originalH");i.model.get("ratio")>d?(n=r/i.model.get("originalW"),c={cropX:0,cropY:Math.round((i.model.get("originalH")-l/n)/2),cropW:i.model.get("originalW"),cropH:Math.round(l/n)},h={width:r,height:Math.round(r/d),top:-Math.round(c.cropY*n),left:0}):(n=l/i.model.get("originalH"),c={cropX:Math.round((i.model.get("originalW")-r/n)/2),cropY:0,cropW:Math.round(r/n),cropH:i.model.get("originalH")},h={width:Math.round(l*d),height:l,top:0,left:-Math.round(c.cropX*n)}),i.model.set(a.a.extend({w:r,h:l,scale:n.toFixed(15),ratio:(r/l).toFixed(5)},c),{silent:!0}),i.$picture&&i.$picture.css(h)}else if("text"===i.model.get("type")){var p=0;i.$el.find(".text-preview").children().each((function(){p+=Object(s.a)(this).outerHeight()}));var u=i.getBoxData();i.frame.doResize({left:u.x,top:u.y,width:u.w,height:p},!1),i.model.set(i.getBoxData(),{silent:!0})}i.model.save({hidden:!1},{toHistory:!0}),"picture"===i.model.get("type")&&(i.in_constrained_crop_mode=!1,i.enter_constrained_crop_mode()),i.select(),this.workspace.trigger("select")}else i.model.save({hidden:!0},{toHistory:!0});else this.workspace.add_widget({type:e,w:this.model.get("tip_w"),h:"picture"===e?180:"text"===e?54:400}),"picture"===e&&this.workspace.$picture_upload_input.trigger("click")}},destroy:function(){this.remove()}});function Ut(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function Wt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var Gt=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ut(i,!0).forEach((function(e){Wt(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ut(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},Bt.a,{},q.a),qt=n.a.View.extend({template:Gt["template-constructor-workspace-inside-block"],initialize:function(t){a.a.bindAll(this),this.block=t.block,this.page_workspace=t.page_workspace,this.controls=this.page_workspace.controls,this.mag=this.page_workspace.mag,this.page=this.page_workspace.page,this.blocks=[],this.$container=t.$container,this.block.child_workspace=this,this.resize_handles_positions=t.resize_handles_positions,this.min_width=t.min_width||100,this.min_height=t.min_height||10,this.block.model.widgets_collection.forEach(function(t){this.block.model.get("wids").indexOf(t.get("_id"))>-1&&this.addBlock(t)}.bind(this)),this.trigger_select_on_selected_block.__debounced=a.a.debounce(this.trigger_select_on_selected_block,0),this.restoreFocusForCopyPaste.__debounced=a.a.debounce(this.restoreFocusForCopyPaste,0),this.saveDebounced=a.a.debounce(this.save,100),this.render(),this.bind_events()},render:function(){this.rendered=!0,this.setElement(Object(s.a)(this.template())),this.$blocksWrapper=this.$el.find(".blocks-wrapper"),this.$el.addClass("tip");var t=Gt["template-constructor-helpers-upload-input"];this.$picture_upload_input=Object(s.a)(t()),this.$picture_upload_input.appendTo(this.$el),this.$el.appendTo(this.$container),this.block.apply_tip_container_size({width:this.block.model.get("tip_w"),height:this.block.model.get("tip_h")}),this.block.apply_tip_position(),this.block.apply_tip_bg_color(),this.block.apply_tip_box_shadow(),this.block.apply_tip_border_radius(),this.blocks.map(this.renderBlock),this.resize_handles_manager=new Ft({workspace_inside_block:this,positions:this.resize_handles_positions}),this.widget_selector=new Vt({workspace_inside_block:this,container:this.$el})},bind_events:function(){this.listenTo(this.block.model,"change:w change:h change:tip_pos",this.block.apply_tip_position),this.listenTo(this.block.model,"change:tip_w change:tip_h",this.on_tip_size_change),this.listenTo(this.block.model,"widget:create",this.createBlock),this.listenTo(this.block.model,"widget:remove",this.removeBlock),this.listenTo(this.block.model,"change:wids",(function(t,e,i){i.socketUpdate||i.resetPage||(this.adjust_height_to_visible_content(),this.adjust_column_widgets_positioning(),this.block.apply_tip_position(),i.undo||i.redo||this.block.model.save({wids:this.block.model.get("wids"),tip_h:this.block.model.get("tip_h")},{patch:!0,forceDefaultViewport:!0}),this.blocks.forEach((function(t){t.saveBox({patch:!0,skipHistory:!0})})))})),this.listenTo(this.block.model.widgets_collection,"change:hidden",(function(t,e,i){this.adjust_height_to_visible_content(),this.adjust_column_widgets_positioning(),this.block.apply_tip_position();var s=[{_id:this.block.model.get("_id"),tip_w:this.block.model.get("tip_w"),tip_h:this.block.model.get("tip_h")}];this.blocks.forEach(function(t){var e=a.a.extend({_id:t.model.get("_id"),hidden:t.model.get("hidden")},t.getBoxData());"picture"===t.model.get("type")&&(a.a.extend(e,{cropX:t.model.get("cropX"),cropY:t.model.get("cropY"),cropW:t.model.get("cropW"),cropH:t.model.get("cropH"),ratio:t.model.get("ratio"),scale:t.model.get("scale")}),!t.isAnimated()&&!t.useLambdaUrl()&&t.getFinalImage((function(t){t&&console.log("w-picture getFinalImage error: ",t)}),{silent:!0,patch:!0})),s.push(e)}.bind(this)),this.block.workspace.save_group(s,{isHotspot:!0,skipHistory:!0,silent:!0,viewport:"default",forceDefaultViewport:!0})})),this.listenTo(this.page,"change:viewport",this.onChangeViewport),this.on("select",this.onSelect),this.on("w-text-entered-edit-mode",this.on_text_entered_edit_mode),this.on("w-text-before-leave-edit-mode",this.on_text_leaved_edit_mode),this.$el.on("click",this.onClick)},restoreFocusForCopyPaste:function(){Object(s.a)(".copyhack").selectText()},adjust_height_to_visible_content:function(t){t=t||{};var e=this.get_visible_blocks(),i=0;e.forEach((function(t){i+=t.getBoxData().h}));var s={_id:this.block.model.get("_id"),tip_h:i};t.save?(this.block.model.set(s,{skipHistory:!0}),this.saveDebounced({},{skipHistory:!0})):this.block.model.set(s,{skipHistory:!0})},adjust_column_widgets_positioning:function(){var t=a.a.sortBy(this.get_visible_blocks(),(function(t){return"picture"===t.model.get("type")?0:1})),e=0;t.forEach((function(t){t.model.set({x:0,y:e},{skipHistory:!0}),e+=t.getBoxData().h}))},on_tip_size_change:function(t,e,i){this.block.apply_tip_container_size({width:t.get("tip_w"),height:t.get("tip_h")}),this.adjust_column_widgets_positioning(),this.block.apply_tip_position()},on_text_entered_edit_mode:function(){this.resize_handles_manager.hide()},on_text_leaved_edit_mode:function(){this.resize_handles_manager.show(),this.fit_text_to_content(!0)},fit_text_to_content:function(t){var e=this.get_visible_blocks(),i=a.a.find(e,(function(t){return"text"===t.model.get("type")}));if(i){var o=i.model.get("h"),n=0;i.$iframe_body.children().each((function(){n+=Object(s.a)(this).outerHeight()})),o!==(n=a.a.max([n,10]))&&(i.model.set("h",n,{skipHistory:!0}),this.adjust_height_to_visible_content({save:!0}))}},createBlock:function(t,e){var i=this.addBlock(t);this.renderBlock(i),e.undo||e.redo||e.group||(i.select(),e.copy||this.trigger_select_on_selected_block.__debounced())},trigger_select_on_selected_block:function(){var t=this.getSelectedBlocks();t&&t.length&&this.trigger("select",t)},addBlock:function(t){var e=t.get("type"),i=new(0,Oe[e])(t,this);return i.immortal=!0,"text"===t.get("type")?(i.controls=[],i.edit_controls=a.a.without(i.edit_controls,"text_columns")):"picture"===t.get("type")&&(i.initial_controls=["picture_crop","picture_link"],i.vector_controls=["picture_color","picture_link"],i.animated_controls=["picture_crop","picture_link"]),this.listenTo(i,"all",this.passChildBlockEvent),this.blocks.push(i),i},passChildBlockEvent:function(t,e){var i=Array.prototype.slice.call(arguments,1);this.trigger("childBlockEvent",t,i)},renderBlock:function(t){t.render(),t.redrawPosition(t.model,{forceRedraw:!0})},add_widget:function(t,e){var i=Oe[(t=t||{}).type.toLowerCase()];a.a.defaults(t,a.a.mapObject(a.a.cloneWithObjects(i.defaults),(function(t,e){return a.a.isFunction(t)?t():t}))),this.block.model.addWidget(t,e)},removeBlock:function(t){var e=this.findBlock(t.get("_id"));this.blocks=a.a.without(this.blocks,e),this.stopListening(e),e.destroy()},onClick:function(t){t.stopPropagation(),!Object(s.a)(t.target).hasClass("workspace-inside-block")&&Object(s.a)(t.target).closest(".workspace-inside-block").length||this.page_workspace.controls&&!this.page_workspace.controls.canControlsBeClosed()||this.trigger("deselect")},onChangeViewport:function(t,e,i){},redrawPacksFrames:a.a.noop,redrawBottomShiftLine:a.a.noop,onSelect:function(){var t=this.getSelectedBlocks(),e=a.a.find(t,(function(t){return"text"===t.model.get("type")}));this.page_workspace.controls.onSelect(t),e&&!e.isEditMode&&e.enterEditMode()},getSelectedBlocks:function(){return a.a.filter(this.blocks,(function(t){return t.selected}))},getSelectableBlocks:function(){return Object(a.a)(this.blocks).filter((function(t){return!t.model.get("hidden")&&!t.outofbox}))},get_visible_blocks:function(){return a.a.filter(this.blocks,(function(t){return!t.model.get("hidden")}))},get_visible_proportional_blocks:function(){return a.a.filter(this.get_visible_blocks(),(function(t){return t.proportional}))},get_visible_nonproportional_blocks:function(){return a.a.filter(this.get_visible_blocks(),(function(t){return!t.proportional}))},getExistingWidgets:function(){return Object(a.a)(this.blocks).chain().pluck("model").value()},findBlock:function(t){return a.a.find(this.blocks,(function(e){return e.model.id===t}))},get_box_data:function(){var t,e=this.block.getBoxData({checkFixedPosition:!0}),i=(t=this.block.hotspotWidget.apply_tip_position(this.block.model.attributes)).left,s=t.top,o=e.x+i,n=e.y+s;return this.block.model.get("fixed_position")&&(n+=this.block.workspace.$container.scrollTop()),{width:this.block.model.get("tip_w"),height:this.block.model.get("tip_h"),left_rel:i,top_rel:s,left_abs:o,top_abs:n}},onDeselect:function(){this.block&&this.block.selected&&this.block.deselect(),this.block&&this.block.isEditMode&&this.block.leaveEditMode()},save:function(t,e){this.block.model.save(t,e)},destroy:function(){this.resize_handles_manager&&this.resize_handles_manager.destroy(),this.widget_selector&&this.widget_selector.destroy(),this.blocks.forEach((function(t){t.destroy()})),delete this.blocks,this.off("select w-text-entered-edit-mode w-text-before-leave-edit-mode"),this.remove()}}),Xt=i("Kf/z"),Kt=r.a.extend(kt.a.prototype).extend({name:"Hotspot",sort_index:8,thumb:"hotspot",icon_color:"#B641EA",dontSaveOnResize:!0,viewport_fields:c.b.viewport_fields.hotspot,initial_controls:["hotspot_add","hotspot_pin_settings","hotspot_tip_settings","common_animation","common_position","common_layer","common_lock"],settingsOnCreate:!1,initialize:function(t,e){this.mag=e.mag,this._id=t.get("_id"),this.hotspots_group_id=t.get("hotspots_group_id"),this.current_icon_data=null,this.initBlock(t,e),this.initHotspotsCollection(),this.child_workspace=null,this.on_icon_change.__debounced=a.a.debounce(this.on_icon_change,20),this.rasterizeOnUndo.__debounced=a.a.debounce(this.rasterizeOnUndo,20)},initHotspotsCollection:function(t){var e;t=t||{},this.hotspots_group_id?e="Hotspots_"+this.hotspots_group_id:(e="Hotspots_"+this._id,this.model.save({hotspots_group_id:this._id},{skipHistory:!0,silent:!0,patch:!0})),RM.collections[e]=RM.collections[e]||new Backbone.Collection,this.hotspots_group_collection=RM.collections[e],this.hotspots_group_collection.add(this.model)},getGroupBlocks:function(){return this.workspace.blocks.filter((function(t){return this.hotspots_group_collection.contains(t.model)}),this)},render:function(){var t=this.model.attributes;this.create(),this.$el.addClass("hotspot"),this.hotspotWidget=new zt.a({model:t,$container:this.$content,environment:"constructor",mag:this.mag,block:this}),this.on_icon_change(),this.tip_workspace=new qt({$container:this.$(".common-hotspot"),block:this,page_workspace:this.workspace,resize_handles_positions:["top","right","left","bottom"],min_width:40,min_height:64}),this.hotspotWidget.apply_tip_position(t),this.bind_model_events(),this.controls=this.initial_controls,this.frame.recalcPointsDirections(),this.listenTo(this.tip_workspace,"childBlockEvent",this.onChildBlockEvent),this.listenTo(this.tip_workspace,"w-text-entered-edit-mode",a.a.bind((function(){this.tip_workspace.$el.addClass("text-edit-mode")}),this)),this.listenTo(this.tip_workspace,"w-text-leaved-edit-mode",a.a.bind((function(){this.tip_workspace.$el.removeClass("text-edit-mode")}),this)),this.triggerReady()},onChildBlockEvent:function(t,e){if("modechanged"==t){var i=e[0];this.disableDragging=i,this.$el.toggleClass("no-resize",i)}},getNestedWidgetsJSON:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.model.widgets_collection&&this.model.widgets_collection.toJSON()||[];return(e=a.a.filter(e,function(t){return this.model.get("wids").indexOf(t._id)>-1}.bind(this))).map((function(e){return a.a.omit(e||{},"id","__v","pid","parent_wid",t?"_id":void 0)}))},getIconStyle:function(){return this.current_icon_data&&this.current_icon_data.$svg?{"background-image":"","background-color":this.icon_color}:r.a.prototype.getIconStyle.apply(this,arguments)},getIconData:function(){if(!this.current_icon_data||!this.current_icon_data.$svg)return null;var t=this.current_icon_data.$svg.clone();return t.attr("fill","#ffffff").attr("fill-opacity","1"),{$svg:t,pinType:this.model.get("pin_type")}},get_icon_SVG:function(t,e,i){if(t){var o,n,r;if(this.icon_XHR&&this.icon_XHR.abort(),o=window.iconSVGCache&&a.a.findWhere(window.iconSVGCache,{id:t}))return r={noun_url:o.noun_url,$svg:o.$svg},this.current_icon_data=r,i(null,r);var l=function(e){var o=Object(s.a)("<div></div>").append(Object(s.a)(e.svg)).find("svg");if(o.length)return o=this.prepareIconSVG(o),r={noun_url:e.new_url,$svg:o},this.current_icon_data=r,window.iconSVGCache.push(a.a.extend(r,{id:t})),window.iconSVGCache.length>this.MAX_ICON_CACHE_SIZE&&window.iconSVGCache.shift(),i(null,{$svg:o,noun_url:e.new_url})}.bind(this);n={method:"POST",url:"/api/authservice/noun/icon",data:{id:t,url:e},dataType:"json",success:function(t){this.icon_svg_request_in_progress=!1,l(t)},error:function(t){return this.icon_svg_request_in_progress=!1,console.log("icon xhr : ",t),i(t)}},/^rm/.test(t)&&a.a.extend(n,{method:"GET",url:e,cache:!1,success:function(t){this.icon_svg_request_in_progress=!1,l({svg:Object(s.a)(t).find("svg"),new_url:e})},data:null,dataType:null}),this.icon_svg_request_in_progress=!0,this.icon_XHR=s.a.ajax(n)}},prepareIconSVG:function(t){var e=t.clone().appendTo(Object(s.a)("body")),i=t.clone();e.get(0).setAttributeNS(null,"viewBox","0 0 "+e.width()+" "+e.height());var o=e.get(0).getBBox();return e.remove(),i.removeAttr("width"),i.removeAttr("height"),i.get(0).setAttributeNS(null,"viewBox",o.x+" "+o.y+" "+o.width+" "+o.height),i.get(0).setAttributeNS(null,"preserveaspect_ratio","xMidYMid meet"),i.css({width:"100%",height:"100%"}),i},render_pin_shape:function(t){t=t||{};var e=this.generateShapeSVG("constructor",this.model,t.w||this.model.get("w"),t.h||this.model.get("h"),t.pin_type);this.$content.find(".pin").html(e)},adjust_box_to_icon:function(){var t,e,i,s,o,n,a,r=this.getBoxData(),l=Math.max(r.w,r.h);if((t=this.$(".pin").find("svg")).length)return e=(i=t.get(0).getBBox()).width/i.height,n=r.w,a=r.h,i.width>i.height?(r.w=l,r.h=Math.floor(r.w/e)):(r.h=l,r.w=Math.floor(r.h*e)),s=Math.floor((n-r.w)/2),o=Math.floor((a-r.h)/2),r.x=r.x+s,r.y=r.y+o,r},rasterize_icon_SVG:function(){var t=this.$(".pin").find("svg");t.length&&(this.rasterizeXhr&&this.rasterizeXhr.abort(),this.rasterizeXhr=rt.rasterize({widgets:this.hotspots_group_collection.models,svg:t,mid:this.workspace.mag.get("_id"),viewport:this.model.getViewport(),size:{width:this.model.get("w"),height:this.model.get("h")}}))},getPeerIds:function(){return a.a.map(this.hotspots_group_collection.models,(function(t){return t.get("_id")}))},onResizeStart:function(t,e){this.rasterizeXhr&&this.rasterizeXhr.abort()},onResizeEnd:function(t,e,i){i=i||{};var s=[];this.hotspots_group_collection.models.forEach(function(t){var e=this.workspace.findBlock(t.get("_id"));e&&s.push(a.a.extend({_id:t.get("_id")},e.adjust_box_to_icon()))}.bind(this)),i.isGroupResize?this.workspace.set_group(s,i):this.workspace.save_group(s,i),"icon"===this.model.get("pin_type")&&this.rasterize_icon_SVG()},onIndexChange:function(){this.selected||r.a.prototype.onIndexChange.apply(this,arguments)},css:function(t,e){t=t||{},this.selected?t["z-index"]=this.MAX_Z_INDEX:Object(Xt.a)("constructor.zIndex")?t["z-index"]=RM.constructorRouter.indexController.getZIndex(this.id,this.workspace.page.id,this.workspace.page.getCurrentViewport()):t["z-index"]=this.model.get("z"),r.a.prototype.css.apply(this,[t,e]),null!=t.height&&null!=t.width&&this.render_pin_shape({w:t.width,h:t.height}),(e||t.isGroupResize)&&this.hotspots_group_collection.models.forEach(function(e){var i=e.get("_id"),s=t.groupedIds&&-1===t.groupedIds.indexOf(i);if(this.model.get("_id")!==i&&(!t.isGroupResize||s)){var o=this.workspace.findBlock(i);o&&o.css({width:t.width,height:t.height,doNotRedrawPacksFrames:t.doNotRedrawPacksFrames})}}.bind(this))},bind_model_events:function(){this.model.on("change:tip_background-color change:tip_background-color-opacity",this.apply_tip_bg_color,this),this.model.on("change:tip_border-radius",this.apply_tip_border_radius,this),this.model.on("change:tip_box-shadow",this.apply_tip_box_shadow,this),this.model.on("change:noun_id change:rm_id change:noun_url change:pin_type change:borders change:color change:opacity change:bg_color change:bg_opacity",this.on_icon_change.__debounced,this),this.model.on("change:noun_id change:rm_id change:noun_url change:pin_type change:bg_color change:bg_opacity change:w change:h",this.rasterizeOnUndo.__debounced,this)},rasterizeOnUndo:function(t,e,i){(i.undo||i.redo)&&"icon"==this.model.get("pin_type")&&this.hotspots_group_collection.at(0)==this.model&&this.rasterize_icon_SVG()},on_icon_change:function(){this.determine_is_block_proportional();var t=this.model.get("pin_type");"ellipse"!==t&&"rectangle"!==t||this.render_pin_shape(),"icon"===t&&this.get_icon_SVG(this.model.get("noun_id")||this.model.get("rm_id"),this.model.get("noun_url"),function(t,e){!t&&e.$svg&&this.render_pin_shape()}.bind(this))},apply_tip_bg_color:function(){this.hotspotWidget.apply_tip_bg_color(this.model.attributes)},apply_tip_border_radius:function(){this.hotspotWidget.apply_tip_border_radius(this.model.attributes)},apply_tip_box_shadow:function(){this.hotspotWidget.apply_tip_box_shadow(this.model.attributes)},determine_is_block_proportional:function(){var t=this.model.get("pin_type");this.proportional="ellipse"===t||"icon"===t},apply_tip_container_size:function(t){this.hotspotWidget.apply_tip_container_size(t)},apply_tip_position:function(){var t=this.model.attributes;this.hotspotWidget?this.hotspotWidget.apply_tip_position(t):console.log(this.model,this,"NO Hotspot widget")},onWorkspaceBlocksSelect:function(t){if(r.a.prototype.onWorkspaceBlocksSelect.apply(this,arguments),this.rendered){var e=t&&1==t.length&&t[0]==this;RM.constructorRouter.isPageLocked(this.model.get("pid"))||this.toggleTip(e)}},deselect:function(){r.a.prototype.deselect.apply(this,arguments),this.toggleTip(!1),this.child_workspace&&this.child_workspace.onDeselect()},toggleTip:function(t){this.$(".tip").css("visibility",t?"inherit":"hidden"),this.css(),this.tip_workspace&&this.tip_workspace.resize_handles_manager&&(t?this.tip_workspace.resize_handles_manager.show():this.tip_workspace.resize_handles_manager.hide())},destroy:function(){this.stopListening(this.tip_workspace),this.tip_workspace&&this.tip_workspace.destroy(),this.hotspotWidget&&this.hotspotWidget.destroy(),this.hotspotWidget=null,this.rasterizeXhr&&this.rasterizeXhr.abort(),this.icon_XHR&&this.icon_XHR.abort(),this.model.off(null,null,this),this.hotspots_group_collection&&this.hotspots_group_collection.remove(this.model),r.a.prototype.destroy.apply(this,arguments)}},{defaults:{pin_type:"ellipse",w:30,h:30,bg_color:"0078FF",bg_opacity:1,borders:0,color:"000000",opacity:1,tip_show_on:"click",x:"center",tip_w:240,tip_h:120,tip_pos:"top","tip_background-color":"ffffff","tip_background-color-opacity":100,"tip_border-radius":8,"tip_box-shadow":!0,wids:[]}}),Yt=i("gm8A"),Zt=[{tp:"name",caption:"Name",optional:!1,sort:0},{tp:"email",caption:"Email",optional:!1,sort:1}],Jt=r.a.extend({name:"Form",sort_index:12,thumb:"form",icon_color:"#FFFFFF",DEFAULT_HORIZONTAL_SIZE:40,DEFAULT_VERTICAL_SIZE:300,MIN_FONT_SIZE:8,MAX_FONT_SIZE:999,MIN_LETTER_SPACING:-99,MAX_LETTER_SPACING:999,form_controls:["form_content","form_styles","form_endpoints"],viewport_fields:c.b.viewport_fields.form,initialize:function(t,e){this.mag=e.mag,this.controls=a.a.union(this.form_controls,this.controls),this.frameClass=Qt,this.initBlock(t,e),this.saveThrottled=a.a.throttle(this.model.save.bind(this.model),700,{leading:!1})},render:function(){this.create(),this.$el.addClass("form"),this.formWidget=new Yt.a({data:this.model.attributes,environment:"constructor",$container:this.$content}),this.formWidget.render(),this.minimalDimensions=this.formWidget.getMinimalDimensions(),this.triggerReady()},onCreate:function(){this.openContentControl()},bindEvents:function(){r.a.prototype.bindEvents.apply(this,arguments),this.$el.on("dblclick",this.onDoubleClick),this.$el.on("click",".js-add-line",this.onAddLineClick),this.$el.on("click",".js-remove-line",this.onRemoveLineClick)},css:function(t,e){r.a.prototype.css.apply(this,arguments),null==t.height&&null==t.width||this.formWidget.recalcStyles({h:t.height,w:t.width})},validate:function(){var t=a.a.difference(c.b.viewport_fields.form,c.b.viewport_fields_common);this.model.fillMissingFieldsFromDefaultViewport(t)},redraw:function(t,e){if(e=e||{},this.checkNeedRedraw(t)){var i=e.undo||e.redo;this.validate();var o,n,l,c,h=this.model.get("layout"),d=this.model.get("style"),p=this.model.get("style-"+d+"-fields").gutter,u=this.model.changedAttributes(),g=this.model.previousAttributes(),m="vertical"==h?"h":"w";i||u.layout&&u.layout!==g.layout?this.formWidget.render({force:!0}):u.fields?(l=u.fields.length-g.fields.length,c=this.formWidget.getRowsCount(u.fields)-this.formWidget.getRowsCount(g.fields),o=Object(s.a)(this.formWidget.$(".input-wrapper").get(0)),n="vertical"==h?o.height():o.width(),a.a.defer(function(){var t=(n+p)*l;!l&&c&&(t=c*this.formWidget.getLineHeight().input),this.model.set(m,this.model.get(m)+t),this.formWidget.render()}.bind(this))):this.formWidget.recalcStyles(),this.minimalDimensions=this.formWidget.getMinimalDimensions(),r.a.prototype.redraw.apply(this,arguments)}},onDoubleClick:function(){this.openContentControl()},onAddLineClick:function(t){this.addOrRemoveLine(t,!0)},onRemoveLineClick:function(t){this.addOrRemoveLine(t,!1)},addOrRemoveLine:function(t,e){var i=Object(s.a)(t.target).closest(".js-input-wrapper").find(".js-input").data("sort"),o=this.model.get("fields"),n=a.a.find(o,{sort:i});if(n){var r=n.rows||1;e?r+=1:r=r>1?r-1:1,this.changeField({sort:i},{rows:r})}this.trigger("resize"),this.saveThrottled()},openContentControl:function(){var t=this.workspace&&this.workspace.controls,e=t&&t.findControl("form_content");e&&e.master.select(e)},setButtonHoverState:function(){this.formWidget.setButtonHoverState()},unsetButtonHoverState:function(){this.formWidget.unsetButtonHoverState()},toggleInputValue:function(t){t?this.formWidget.showInputPlaceholdersAsValues(!0):this.formWidget.render()},getMinimalDimensions:function(){return this.minimalDimensions},getDefaultDimensions:function(){var t=this.getMinimalDimensions(),e=this.model.attributes,i=e["style-"+e.style+"-fields"],s=e["style-"+e.style+"-button-default"],o=this.model.get("fields");return"vertical"==this.model.get("layout")?{width:this.DEFAULT_VERTICAL_SIZE,height:t.height}:{width:200*(o.length+1)+o.length*i.gutter+s.gutter,height:this.DEFAULT_HORIZONTAL_SIZE}},changeField:function(t,e){var i=a.a.clone(this.model.get("fields")),s=a.a.findIndex(i,t),o=i[s],n={};a.a.each(e,(function(t,e){n[e]=a.a.clone(o[e])})),null===(o=a.a.extend(a.a.clone(o),e)).items&&delete o.items,i[s]=o,this.model.set("fields",i),a.a.each(e,function(t,e){this.model.trigger("field:"+e+":change",o,n[e])}.bind(this)),this.model.trigger("field:change",o)}},{defaults:{layout:"vertical",style:"colored","button-caption":"Text",button_caption_after_submit:"",submit_mode:"textAfterSubmit",link_after_submit:null,fields:JSON.parse(JSON.stringify(Zt)),h:48*(Zt.length+1)+20*Zt.length,w:286,x:"center","style-colored-fields":{gutter:20,color:"f7f7f7",opacity:100,"border-radius":0,"border-width":0,"border-color":"000000","border-opacity":100,"font-family":"Roboto","font-style":"normal","font-weight":400,"text-color":"000000","text-opacity":100,"font-size":18,"letter-spacing":0},"style-colored-button-default":{gutter:0,color:"4c4c4c",opacity:100,"border-radius":"inherit","border-width":0,"border-color":"000000","border-opacity":100,"font-family":"inherit","font-style":"inherit","font-weight":"inherit","text-color":"ffffff","text-opacity":100,"font-size":"inherit","letter-spacing":"inherit","text-align":"center"},"style-colored-button-hover":{color:"inherit",opacity:90,"border-width":"inherit","border-color":"inherit","border-opacity":"inherit","text-color":"inherit","text-opacity":"inherit","text-align":"inherit",transition:!1},"style-outlined-fields":{gutter:20,color:"ffffff",opacity:0,"border-radius":0,"border-width":1,"border-color":"e5e5e5","border-opacity":100,"font-family":"Roboto","font-style":"normal","font-weight":400,"text-color":"000000","text-opacity":100,"font-size":18,"letter-spacing":0},"style-outlined-button-default":{gutter:0,color:"e8e8e8",opacity:60,"border-radius":"inherit","border-width":0,"border-color":"000000","border-opacity":100,"font-family":"inherit","font-style":"inherit","font-weight":"inherit","text-color":"000000","text-opacity":60,"font-size":"inherit","letter-spacing":"inherit","text-align":"inherit"},"style-outlined-button-hover":{color:"inherit",opacity:90,"border-width":"inherit","border-color":"inherit","border-opacity":"inherit","text-color":"inherit","text-opacity":80,"text-align":"inherit",transition:!1},"style-underlined-fields":{gutter:20,"underline-width":1,"underline-color":"000000","underline-opacity":100,"font-family":"Roboto","font-style":"normal","font-weight":400,"text-color":"000000","text-opacity":100,"font-size":18,"letter-spacing":0},"style-underlined-button-default":{gutter:0,color:"000000",opacity:100,"border-radius":0,"border-width":0,"border-color":"000000","border-opacity":100,"font-family":"inherit","font-style":"inherit","font-weight":"inherit","text-color":"ffffff","text-opacity":100,"font-size":"inherit","letter-spacing":"inherit","text-align":"inherit"},"style-underlined-button-hover":{color:"inherit",opacity:80,"border-width":"inherit","border-color":"inherit","border-opacity":"inherit","text-color":"inherit","text-opacity":"inherit","text-align":"inherit",transition:!1}}}),Qt=l.a.extend({applyExtraConstraints:function(t,e){var i=this.block.getMinimalDimensions();return t.height<i.height&&(t.height=i.height),t.width<i.width&&(t.width=i.width),t}}),te=Jt,ee=Dt.extend({name:"Cart",title:"E-commerce",blockName:d.a.ecommerceCartBlockName,sort_index:14,thumb:"cart-button",getBlockCreateParams:function(t){return t.eCommerceManager.haveEcommerceCartWidget?{name:"Add to cart",title:"E-commerce",block_name:d.a.addToCartBlockName,thumb:"addtocart-button"}:{name:"Cart",title:"E-commerce",blockName:d.a.ecommerceCartBlockName,thumb:"cart-button"}},restrictions:function(){var t=RM.constructorRouter&&RM.constructorRouter.me&&RM.constructorRouter.me.get("permissions");return t&&t.can_use_e_commerce},icon_color:"#EE8822",viewport_fields:c.b.widgetViewportFields(d.a.ecommerceCartBlockName),frameColor:"#0080FF",settingsOnCreate:!0,onCreate:function(){this.workspace.controls.selectFirst(),this.setWidgetGlobal(),this.workspace.eCommerceManager.haveEcommerceCartWidget=!0},setWidgetGlobal:function(){this.model.set("is_global",!0),this.model.save({},{silent:!0,toHistory:!1,skipHistory:!0}),this.workspace.controls.findControl("common_position").updateModel(a.a.clone(this.model.attributes))},initial_controls:["cart_connections","cart_add_product_widget","cart_settings","button_icon","button_edit","common_animation","common_position","common_layer","common_lock"],DEFAULT_BACKGROUND_COLOR:"f4f4f4",animationTriggerLine:null,getIconStyle:function(){var t={"background-repeat":"no-repeat"};return t["background-image"]="url(".concat(Object(j.b)("./constructor/widgetbar/icons/".concat(this.thumb,".svg")),")"),t["background-color"]=this.icon_color,t},initialize:function(){Dt.prototype.initialize.apply(this,arguments)},render:function(){var t,e=a.a.clone(this.model.attributes),i=e.tp;this.create(),this.$el.addClass("button"),t={model:e,$container:this.$content,environment:"constructor",mag:this.mag,block:this},this.buttonWidget=new At.a(t),this.$button=this.$(".common-button"),this.$textInput=this.$button.children(".text"),this.$buttonIcon=this.$button.children(".icon"),"icon"!==i&&"text_and_icon"!==i||this.getIconSVG(this.model.get("icon_noun_id")||this.model.get("icon_rm_id"),this.model.get("icon_noun_url"),function(t,e){!t&&e.$svg&&(this.renderIcon({$svg:this.getoloredIconSVG()}),this.model.get("icon_rasterUrl")||this.rasterizeSVG({default:!0,hover:!0,current:!0}))}.bind(this)),this.recalcButtonSize(),this.disableTextInput(),this.handleSelectionColor(),this.bindDOMEvents(),this.bindModelEvents(),this.controls=this.initial_controls,this.frame.recalcPointsDirections(),this.triggerReady()},destroy:function(){this.stopListeningForUpdateTrigger(),Dt.prototype.destroy.apply(this,arguments)},getIndividualStyles:function(){var t=["background-color","background-color-opacity","border-radius","border-width","border-color","border-color-opacity","font-family","font-style","font-weight","color","color-opacity","font-size","letter-spacing","hover-background-color","hover-background-color-opacity","hover-border-width","hover-border-radius","hover-border-color","hover-border-color-opacity","hover-color","hover-color-opacity","hover-font-family","hover-font-size","hover-tansition-duration"];return t.forEach((function(t,e,i){i[e]="change:"+t})),t.join(" ")},onDragStart:function(t,e){if(t.altKey||e.isClone)return!1;Dt.prototype.onDragStart.apply(this,arguments)},startListeningForUpdateTrigger:function(t){this.animationTriggerLine=t,this.listenTo(this,"move resize",this.updateAnimationTrigger.bind(this))},stopListeningForUpdateTrigger:function(){this.updateAnimationTrigger&&(this.stopListening(this,"move resize",this.updateAnimationTrigger),this.animationTriggerLine=null)},updateAnimationTrigger:function(){window.requestAnimationFrame(this.recalcAnimationTrigger.bind(this))},recalcAnimationTrigger:function(){this.animationTriggerLine&&this.animationTriggerLine.update()}},{yOffsetOnCreate:-80,defaults:{tp:"text",form:"rectangle",text:"Cart",w:168,h:50,hidden:!1,x:"center",text_w:48,text_h:26,em_w:16,"background-color":"f4f4f4","background-color-opacity":100,"border-radius":4,"border-width":0,"border-color":"000000","border-color-opacity":100,"font-family":"Arial","font-style":"normal","font-weight":400,color:"282828","color-opacity":100,"font-size":18,"letter-spacing":0,"hover-background-color":"f4f4f4","hover-background-color-opacity":80,"hover-border-width":0,"hover-border-color":"000000","hover-border-color-opacity":100,"hover-border-radius":4,"hover-color":"282828","hover-color-opacity":100,"hover-tansition-duration":0,"hover-cursor":"pointer",icon_enabled:!1,icon_h:18,icon_w:18,icon_pos:"left",icon_noun_id:null,icon_rm_id:null,icon_noun_url:null,icon_color:"ffffff",icon_color_opacity:100,"hover-icon_color":"ffffff","hover-icon_color_opacity":100,icon_rasterUrl:null,icon_raster2xUrl:null,"hover-icon_rasterUrl":null,"hover-icon_raster2xUrl":null,"bar-color":"ffffff","bar-color-opacity":100,"bar-background-color":"1a1a1a","bar-background-color-opacity":100,"bar-shadow":!1,"bar-font-family":"Arial","bar-font-style":"normal","bar-font-weight":400,"bar-letter-spacing":"inherit"}}),ie=i("zzMN"),se=i("m41J"),oe=function t(e){this.fromBlock=e.fromBlock,this.toBlock=e.toBlock,this.$el=e.$el,this.root=document.createElementNS(t.svgns,"svg"),this.root.setAttributeNS(null,"class",e.cssClass),this.curve=document.createElementNS(t.svgns,"path"),this.root.appendChild(this.curve),this.arrow=document.createElementNS(t.svgns,"polygon"),this.root.appendChild(this.arrow),this.$el.append(this.root),this.update()};oe.svgns="http://www.w3.org/2000/svg",oe.minHandleLength=65,oe.lineEndOffset=7,oe.prototype.update=function(){var t=se.a.getBox(this.fromBlock),e=se.a.getBox(this.toBlock),i=se.a.getBestPoints(t,e),s=i.fromPoint,o=i.toPoint;o=se.a.getPerpendicularEnd(i.toSide,o,e,oe.lineEndOffset);var n=se.a.getDistance(s,o),a=Math.max(n/2,oe.minHandleLength),r=se.a.getPerpendicularEnd(i.fromSide,s,t,a),l=se.a.getPerpendicularEnd(i.toSide,o,e,a),c="M"+s.x+" "+s.y+" C "+r.x+" "+r.y+", "+l.x+" "+l.y+", "+o.x+" "+o.y;this.curve.setAttributeNS(null,"d",c),this.updateArrow(i.toSide,o,e)},oe.prototype.updateArrow=function(t,e,i){var s=e.x,o=e.y;"left"===t&&(s+=1),"bottom"===t&&(o-=1),"right"===t&&(s-=1),"top"===t&&(o+=1);var n=s+" "+o+" "+(s-5.5)+" "+(o-9)+" "+(s+5.5)+" "+(o-9),a="rotate("+Math.round(180*(i.angle+se.a.sideAngles[t])/Math.PI)+", "+s+", "+o+")";this.arrow.setAttributeNS(null,"points",n),this.arrow.setAttributeNS(null,"transform",a)},oe.prototype.remove=function(){this.root&&this.root.parentNode.removeChild(this.root)};var ne=oe,ae=i("jeLO"),re=l.a.extend({initialize:function(){l.a.prototype.initialize.apply(this,arguments),this.listenTo(this.block,"addToCartChangeSelectionState",this.changeSelectionState),this.$frameBorder=this.$el.children(".frameborder")},destroy:function(){this.stopListening(this.block,"addToCartChangeSelectionState",this.changeSelectionState),l.a.prototype.destroy.apply(this,arguments)},changeSelectionState:function(t){"button"===t?(this.$frameBorder.css({"border-color":d.b.getRGBA(this.block.frameColor.substring(1,7),.5)}),this.block.$buttonWrap.css({"box-shadow":"0px 0px 0px 1px "+this.block.frameColor+" inset"})):"selects"===t?(this.$frameBorder.css({"border-color":d.b.getRGBA(this.block.frameColor.substring(1,7),.5)}),this.block.$attributesBox.css({"box-shadow":"0px 0px 0px 1px "+this.block.frameColor+" inset"})):"both"===t&&(this.$frameBorder.css({"border-color":this.block.frameColor}),this.block.$attributesBox.css({"box-shadow":"none"}),this.block.$buttonWrap.css({"box-shadow":"none"}))}});function le(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function ce(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?le(i,!0).forEach((function(e){he(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):le(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function he(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var de=["product_selector"],pe=["both","button","selects"],ue=r.a.extend({name:"Add to cart",title:"E-commerce",blockName:d.a.addToCartBlockName,sort_index:14,thumb:"addtocart-button",excludedFromLib:!0,restrictions:function(){var t=RM.constructorRouter&&RM.constructorRouter.me&&RM.constructorRouter.me.get("permissions");return t&&t.can_use_e_commerce},icon_color:"#EE8822",viewport_fields:c.b.viewport_fields[d.a.addToCartBlockName],MAX_ICON_CACHE_SIZE:30,RASTERIZE_MULTIPLIER:2,frameColor:"#0080FF",cartBlock:null,defaultProductId:"default",textPaddingSizePercentage:12,initial_controls:["product_selector","add_to_cart_settings","button_icon","button_edit","common_animation","common_position","common_layer","common_lock"],disabledControls:de,getIconStyle:function(){var t={"background-repeat":"no-repeat"};return t["background-image"]="url(".concat(Object(j.b)("./constructor/widgetbar/icons/".concat(this.thumb,".svg")),")"),t["background-color"]=this.icon_color,t},controlsClasses:function(t){return{"panel-product-selector":this.getProductSelectorIconClass()}[t]},getProductSelectorIconClass:function(){return this.model&&"default"!==this.model.get("selected_product_id")?this.workspace.eCommerceManager.isProductActive(this.model.get("selected_product_id"))?"active-product-selected":"inactive-product-selected":"product-not-selected"},checkDisabledControls:function(t,e){e?this.workspace.eCommerceManager&&this.workspace.eCommerceManager.isMagConnectedToStripe()?this.disabledControls=[]:this.disabledControls=de:t instanceof ae.a||(this.disabledControls=t?[]:de,this.trigger("disabledControls:changed",this.blockName))},initialize:function(t,e){this.mag=e.mag,this.frameClass=re,this.isEditMode=!1,this.rendered=!1,this.stylingState="default",this.selectionState="both",this.initBlock(t,e),this._oldAttrs=a.a.clone(this.model.attributes),this.onIconChange.__debounced=a.a.debounce(this.onIconChange,20),this.onTextInput.__debounced=a.a.debounce(this.onTextInput,20),this.rasterizeSVG.__debounced_both=a.a.debounce(this.rasterizeSVG,100),this.rasterizeSVG.__debounced_default=a.a.debounce(this.rasterizeSVG,100),this.rasterizeSVG.__debounced_hover=a.a.debounce(this.rasterizeSVG,100),this.setMinimalDimensions.__debounced=a.a.debounce(this.setMinimalDimensions,100),this.saveWidgetData.__debounced=a.a.debounce(this.saveWidgetData,100)},render:function(){var t=this;this.create(),this.$el.addClass("add-to-cart-block"),this.controls=this.initial_controls,this.addToCartWidget=new ie.a({data:a.a.cloneWithObjects(this.model.attributes),environment:"constructor",$container:this.$content,block:this,eCommerceManager:this.workspace.eCommerceManager}),this.addToCartWidget.on("loaded",(function(){t.initIcon()})),this.addToCartWidget.render(),this.$buttonWrap=this.$content.find(".button-wrap"),this.$button=this.addToCartWidget.$button,this.$buttonText=this.addToCartWidget.$buttonText,this.$buttonIcon=this.addToCartWidget.$buttonIcon,this.$attributesBox=this.addToCartWidget.$attrsContainer,this.$sizesCalculatingBlock=this.$el.find(".sizes-calculating-block"),this.bindLinkingLineEvents(),this.bindDOMEvents(),this.bindModelEvents(),this.rendered=!0,this.triggerReady()},destroy:function(){this.unbindDOMEvents(),this.unbindLinkingLineEvents(),this.model.off(null,null,this),r.a.prototype.destroy.apply(this,arguments)},bindDOMEvents:function(){this.$el.on("mousedown",this.onBlockMousedown),this.$button.on("dblclick",this.onButtonDoubleClick),this.$attributesBox.on("dblclick",this.onAttrsDoubleClick),this.$buttonText.on("input",this.onTextInput)},unbindDOMEvents:function(){this.$el.off("mousedown",this.onBlockMousedown),this.$button.off("dblclick",this.onButtonDoubleClick),this.$attributesBox.off("dblclick",this.onAttrsDoubleClick),this.$buttonText.off("input",this.onTextInput)},bindLinkingLineEvents:function(){this.listenTo(this,"move resize",this.updateAnimationTrigger.bind(this)),this.listenTo(this.model,"change:angle change:sticked change:fixed_position change:is_full_width change:is_full_height",this.updateAnimationTrigger),this.listenTo(this.workspace,"workspace-resize",this.updateAnimationTrigger.bind(this)),Object(s.a)("#main").on("scroll",this.updateAnimationTrigger)},unbindLinkingLineEvents:function(){this.stopListening(this,"move resize",this.updateAnimationTrigger),this.stopListening(this.model,"change:angle change:sticked change:fixed_position change:is_full_width change:is_full_height",this.updateAnimationTrigger),this.stopListening(this.workspace,"workspace-resize",this.updateAnimationTrigger),Object(s.a)("#main").off("scroll",this.updateAnimationTrigger)},bindModelEvents:function(){this.model.on("change:tp",this.onTypeChange,this),this.model.on("change:icon_enabled",this.determineButtonType,this),this.model.on("change:text",(function(t,e,i){(i.undo||i.redo||i.socketUpdate)&&this.$buttonText.val(this.model.get("text"))}),this),this.model.on("change:icon_enabled change:icon_noun_id change:icon_rm_id change:icon_noun_url",(function(t,e,i){this.onIconChange.__debounced(t,e,i)}),this),this.model.on("change:icon_h",(function(t,e,i){this.recalcIconContainerSize(t,e,i)}),this),this.model.on("change:icon_pos",(function(){this.onIconPositionChange()}),this),this.model.on("change:selected_product_id",this.onProductChange,this),this.model.on("change:layout",this.onLayoutChange,this),this.model.on("change:font-size change:font-family change:font-style change:font-weight change:letter-spacing",function(){this.recalcButtonTextSize()}.bind(this),this),this.model.on("change:attrs-font-size change:attrs-font-family change:attrs-font-style change:attrs-font-weight change:attrs-letter-spacing",function(){this.recalcSelectsTextSize()}.bind(this),this),this.model.on("change:text_w change:text_h",(function(){this.onButtonTextSizeChange()}),this),this.model.on("change:attrs-icon-h change:attrs-icon-w",(function(t){this.onAttrsIconSizeChange(t)}),this),this.model.on("change:icon_color change:icon_color_opacity",function(t){var e=t.get("tp");if("icon"===e||"text_and_icon"===e){var i={default:!0};(t.hasChanged("icon_color")&&t.hasChanged("hover-icon_color")||t.hasChanged("icon_color_opacity")&&t.hasChanged("hover-icon_color_opacity"))&&(i.hover=!0),this.rasterizeSVG.__debounced_default(i)}}.bind(this),this),this.model.on("change:hover-icon_color change:hover-icon_color_opacity",function(t){var e=t.get("tp");"icon"!==e&&"text_and_icon"!==e||t.hasChanged("icon_color")||t.hasChanged("icon_color_opacity")||this.rasterizeSVG.__debounced_hover({hover:!0})}.bind(this),this);var t=this.getIndividualStyles();this.model.on(t,function(){var t=a.a.clone(this.model.attributes);this.addToCartWidget.generateIndividualStyleCSS(t,this.stylingState,this.selectionState)}.bind(this),this)},changeStylingState:function(t){this.stylingState=t;var e=a.a.clone(this.model.attributes);this.addToCartWidget.generateIndividualStyleCSS(e,this.stylingState,this.selectionState)},haveProductAttributes:function(){return!!this.addToCartWidget&&this.addToCartWidget.showSkus},setDefaultSelectionState:function(){if("both"!==this.selectionState){this.selectionState="both",this.trigger("addToCartChangeSelectionState",this.selectionState);var t=a.a.clone(this.model.attributes);this.addToCartWidget.generateIndividualStyleCSS(t,this.stylingState,this.selectionState)}},setSelectionState:function(t){if(-1!==pe.indexOf(t)){this.selectionState=t,this.trigger("addToCartChangeSelectionState",this.selectionState);var e=a.a.clone(this.model.attributes);this.addToCartWidget.generateIndividualStyleCSS(e,this.stylingState,this.selectionState)}},select:function(){this.selected||(this.checkDisabledControls(null,!0),this.cartBlock=this.workspace.eCommerceManager.getEcommerceCartBlock(),this.cartBlock&&(this.animationTriggerLine=new ne({$el:this.workspace.$(".workspace"),fromBlock:this,toBlock:this.cartBlock,cssClass:"animation-trigger-line"}),this.cartBlock.startListeningForUpdateTrigger(this.animationTriggerLine)),te.prototype.select.apply(this,arguments))},deselect:function(t){t!==this&&this.selected&&(this.setDefaultSelectionState(),this.deleteAnimationTrigger(),this.isEditMode&&(this.leaveEditMode({saveWidgetData:!0}),this.workspace.trigger("redraw")),te.prototype.deselect.apply(this,arguments))},updateAnimationTrigger:function(){this.selected&&window.requestAnimationFrame(this.recalcAnimationTrigger.bind(this))},recalcAnimationTrigger:function(){this.animationTriggerLine&&this.animationTriggerLine.update()},deleteAnimationTrigger:function(){this.animationTriggerLine&&this.animationTriggerLine.remove(),delete this.animationTriggerLine,this.cartBlock&&(this.cartBlock.stopListeningForUpdateTrigger(),this.cartBlock=null)},onWorkspaceBlocksSelect:function(t){if(r.a.prototype.onWorkspaceBlocksSelect.apply(this,arguments),this.rendered){var e=t&&1===t.length&&t[0]===this;this.isEditMode&&!e&&(this.leaveEditMode({deselectControl:!0,saveWidgetData:!0}),this.workspace.trigger("redraw")),e||this.deleteAnimationTrigger()}},onButtonDoubleClick:function(){this.model.get("pack_id")?r.a.prototype.onDblClick.apply(this,arguments):this.selected&&(this.addToCartWidget.showSkus?"both"===this.selectionState?(this.setSelectionState("button"),this.workspace.controls.findControl("add_to_cart_settings").select()):"selects"===this.selectionState?this.setSelectionState("button"):!this.isEditMode&&this.enterEditMode():!this.isEditMode&&this.enterEditMode())},onAttrsDoubleClick:function(){this.selected&&this.addToCartWidget.showSkus&&("both"===this.selectionState?(this.setSelectionState("selects"),this.workspace.controls.findControl("add_to_cart_settings").select()):"button"===this.selectionState&&this.setSelectionState("both"))},onBlockMousedown:function(t){this.isEditMode&&!Object(s.a)(t.target).is(this.addToCartWidget.$buttonText)&&this.leaveEditMode({deselectControl:!0,saveWidgetData:!0}),this.addToCartWidget.showSkus&&("button"!==this.selectionState||Object(s.a)(t.target).is(this.addToCartWidget.$buttonText)||this.setDefaultSelectionState(),"selects"!==this.selectionState||Object(s.a)(t.target).is(this.$attributesBox)||this.setDefaultSelectionState())},enterEditMode:function(t){this.isEditMode=!0,this.addToCartWidget&&this.addToCartWidget.enterEditMode(t),this.determineButtonType({enter_edit_mode:!0})},leaveEditMode:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.addToCartWidget&&(this.addToCartWidget.leaveEditMode(t),this.model.set("text",this.addToCartWidget.getButtonText())),t.deselectControl&&this.deselectEditControl(),this.isEditMode=!1,this.determineButtonType(),this.recalcButtonTextSize(),t.saveWidgetData&&this.saveWidgetData()},selectEditControl:function(){var t=this.workspace&&this.workspace.controls;if(t){var e=t.findControl("button_edit");e&&e.master.select(e)}},deselectEditControl:function(){var t=this.workspace&&this.workspace.controls;if(t){var e=t.findControl("button_edit");e&&e.master.deselect()}},onTextInput:function(){this.recalcButtonTextSize()},css:function(t){r.a.prototype.css.apply(this,arguments),this.addToCartWidget.recalcDimensions(t)},onResizeEnd:function(){var t=this.getSaveBoxData(),e=this.$button.outerWidth(),i=this.$button.outerHeight();this.model.get("btn_w")===e&&this.model.get("btn_h")===i||(this.model.set({w:t.w,h:t.h,btn_w:e,btn_h:i}),this.addToCartWidget.setData(a.a.clone(this.model.attributes)),this.saveWidgetData())},setSizeConstraints:function(t,e){a.a.extend(this.frame,{minwidth:t,maxwidth:9999,minheight:e,maxheight:9999})},setMinimalDimensions:function(){this.addToCartWidget&&this.addToCartWidget.setMinimalDimensions()},changeSelectedProduct:function(t){this.model.save({selected_product_id:t})},onProductChange:function(t){this.addToCartWidget.onProductChange(a.a.clone(t.attributes)),this.updateAnimationTrigger(),this.addToCartWidget.showSkus?this.recalcSelectsTextSize(!0):(this.model.set({"attrs-text_w":0,"attrs-text_h":0}),this.addToCartWidget.setData(a.a.clone(this.model.attributes)),this.setMinimalDimensions())},onLayoutChange:function(t){this.addToCartWidget.onLayoutChange(a.a.clone(t.attributes)),this.updateAnimationTrigger()},determineButtonType:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=this.model.get("icon_enabled"),s=!!e.enter_edit_mode||this.addToCartWidget.getButtonText().length;t=i&&s?"text_and_icon":i&&!s?"icon":"text",this.model.set("tp",t)},onTypeChange:function(){},getRealTextSize:function(t){var e,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=a.a.clone(this.model.attributes),r=n["".concat(o,"font-size")],l=n["".concat(o,"letter-spacing")],c=n["".concat(o,"font-family")],h=n["".concat(o,"font-style")],d=n["".concat(o,"font-weight")];return this.$textInputSizeAdjuster&&this.$textInputSizeAdjuster.length||(this.$textInputSizeAdjuster=Object(s.a)("<div/>"),this.$textInputSizeAdjuster.css({width:"auto","white-space":"pre"}).appendTo(this.$sizesCalculatingBlock)),this.$textInputSizeAdjuster.text(t),this.$textInputSizeAdjuster.css({"font-family":c,"font-style":h,"font-weight":d,"font-size":r+"px","letter-spacing":l+"px"}),e=this.$textInputSizeAdjuster.width(),i=this.$textInputSizeAdjuster.height(),this.$textInputSizeAdjuster.empty(),{width:e=2*Math.ceil(e/2),height:i=2*Math.ceil(i/2)}},recalcSelectsTextSize:function(t){if("selects"===this.selectionState||t){var e=this.addToCartWidget.getLongestAttribute(),i=2*this.addToCartWidget.getSelectsPadding(),s=this.getRealTextSize(e,"attrs-"),o=this.model.get("btn_w"),n=this.model.get("btn_h"),r=s.width+2*this.addToCartWidget.getHorizontalTextMargin(this.model.get("attrs-font-size")),l=s.height+2*this.addToCartWidget.getVerticalTextMargin(this.model.get("attrs-font-size")),c={"attrs-text_w":r,"attrs-text_h":l};r+i>o&&(c.btn_w=r+i),l>n&&(c.btn_h=l);var h=a.a.clone(this.model.attributes);if(this.addToCartWidget.setData(ce({},h,{},c)),c.btn_w||c.btn_h){var d=this.addToCartWidget.recalcDimensionsOnProductChange();c.w=d.width,c.h=d.height,c.btn_w&&(c.x=h.x-Math.floor((d.width-h.w)/2)),c.btn_h&&(c.y=h.y-Math.floor((d.height-h.h)/2))}this.model.set(c),this.setMinimalDimensions.__debounced(),(c.btn_w||c.btn_h)&&this.updateAnimationTrigger()}},onAttrsIconSizeChange:function(t){var e=a.a.clone(t.attributes);this.addToCartWidget.applySelectsIconSize(e),this.setMinimalDimensions.__debounced();var i=e["attrs-icon-h"]+2*this.addToCartWidget.getVerticalIconMargin(e["attrs-icon-h"]);if(i>e.btn_h){var s={btn_h:i};this.addToCartWidget.setData(ce({},e,{},s));var o=this.addToCartWidget.recalcDimensionsOnProductChange();s.w=o.width,s.h=o.height,s.y=e.y-Math.floor((o.height-e.h)/2),this.model.set(s),this.updateAnimationTrigger()}},recalcButtonTextSize:function(){var t,e=a.a.clone(this.model.attributes),i=this.addToCartWidget.getButtonText(),s=this.getRealTextSize(i),o=this.getRealTextSize("Out of stock"),n=s.width>o.width?s.width:o.width,r=s.height>o.height?s.height:o.height,l=this.addToCartWidget.getHorizontalTextMargin(e["font-size"]),c=n+2*l,h=r+2*this.addToCartWidget.getVerticalTextMargin(e["font-size"]),d=(he(t={},"text_w",c),he(t,"text_h",h),t);if("text"===e.tp||"text_and_icon"===e.tp){var p="text_and_icon"===e.tp&&e.icon_enabled?c+e.icon_w+l:c;if(p>e.btn_w&&(d.btn_w=p),h>e.btn_h&&(d.btn_h=h),this.addToCartWidget.setData(ce({},e,{},d)),d.btn_w||d.btn_h){var u=this.addToCartWidget.recalcDimensionsOnProductChange();d.w=u.width,d.h=u.height,d.btn_w&&(d.x=e.x-Math.floor((u.width-e.w)/2)),d.btn_h&&(d.y=e.y-Math.floor((u.height-e.h)/2))}this.setMinimalDimensions.__debounced()}this.model.set(d),(d.btn_w||d.btn_h)&&this.updateAnimationTrigger()},onButtonTextSizeChange:function(){this.addToCartWidget.applyButtonTextSize(a.a.clone(this.model.attributes))},recalcButtonSizeOnIconChange:function(t){var e,i=2*this.addToCartWidget.getVerticalIconMargin(t.icon_h),s=2*this.addToCartWidget.getHorizontalIconMargin(t.icon_w),o=t.icon_h+i,n={};if("text_and_icon"===t.tp)e=t.text_w+t.icon_w+this.addToCartWidget.getHorizontalTextMargin(t["font-size"]);else{if("icon"!==t.tp)return;e=t.icon_w+s}if(e>t.btn_w&&(n.btn_w=e),o>t.btn_h&&(n.btn_h=o),n.btn_w||n.btn_h){this.addToCartWidget.setData(ce({},t,{},n));var a=this.addToCartWidget.recalcDimensionsOnProductChange();n.w=a.width,n.h=a.height,n.btn_w&&(n.x=t.x-Math.floor((a.width-t.w)/2)),n.btn_h&&(n.y=t.y-Math.floor((a.height-t.h)/2)),this.model.set(n),this.updateAnimationTrigger()}},recalcButtonSize:function(){},initIcon:function(t){this.model.get("icon_enabled")&&this.getIconSVG(this.model.get("icon_noun_id")||this.model.get("icon_rm_id"),this.model.get("icon_noun_url"),function(e,i){!e&&i.$svg&&(this.renderIcon({$svg:this.getoloredIconSVG()}),this.model.get("icon_rasterUrl")||this.rasterizeSVG({default:!0,hover:!0}),t&&"function"==typeof t&&t(null,null,{dontRasterize:!0}))}.bind(this))},renderIcon:function(){Dt.prototype.renderIcon.apply(this,arguments)},recalcIconContainerSize:function(t,e,i){if("text"!==this.model.get("tp"))if(this.currentIconData){var s=this.model.get("icon_h"),o=Math.floor(s*this.currentIconData.aspect_ratio);this.model.set({icon_w:o});var n=a.a.clone(this.model.attributes);this.recalcButtonSizeOnIconChange(n),this.addToCartWidget.renderButtonIcon(n),this.addToCartWidget.setData(n),this.setMinimalDimensions.__debounced(),i&&i.dontRasterize||i&&(i.onIconChange||i.undo||i.redo)||this.rasterizeSVG.__debounced_both({default:!0,hover:!0})}else this.initIcon(this.recalcIconContainerSize.bind(this));else this.addToCartWidget.renderButtonIcon(a.a.clone(this.model.attributes))},rasterizeSVG:function(){Dt.prototype.rasterizeSVG.apply(this,arguments)},onIconChange:function(t,e,i){if("boolean"==typeof e&&!1===e)return this.$buttonIcon.empty(),void this.recalcIconContainerSize(t,e,{onIconChange:!0});this.getIconSVG(t.get("icon_noun_id")||t.get("icon_rm_id"),t.get("icon_noun_url"),function(t,e){!t&&e.$svg&&(i.undo||i.redo||this.recalcIconContainerSize(null,null,{onIconChange:!0}),this.renderIcon({$svg:this.getoloredIconSVG()}),i.undo||i.redo||this.rasterizeSVG({default:!0,hover:!0}))}.bind(this))},onIconPositionChange:function(){this.addToCartWidget.applyButtonIconPosition(a.a.clone(this.model.attributes))},onIconColorChange:function(){Dt.prototype.onIconColorChange.apply(this,arguments)},"getoloredIconSVG":function(){return Dt.prototype.getoloredIconSVG.apply(this,arguments)},getDefaultIconSVG:function(){return Dt.prototype.getDefaultIconSVG.apply(this,arguments)},getIconSVG:function(){return Dt.prototype.getIconSVG.apply(this,arguments)},prepareIconSVG:function(){return Dt.prototype.prepareIconSVG.apply(this,arguments)},cacheSVGData:function(){Dt.prototype.cacheSVGData.apply(this,arguments)},getSVGCacheItem:function(){return Dt.prototype.getSVGCacheItem.apply(this,arguments)},updateBlockSizes:function(t){this.model.set({w:t.width,h:t.height})},saveWidgetData:function(){a.a.isEqual(this.model.toJSON(),this._oldAttrs)||(this.saveXHR&&this.saveXHR.abort(),this._oldAttrs=a.a.clone(this.model.toJSON()),this.saveXHR=this.model.save())},getIndividualStyles:function(){var t=["background-color","background-color-opacity","attrs-background-color","attrs-background-color-opacity","border-radius","attrs-border-radius","border-width","attrs-border-width","border-color","attrs-border-color","border-color-opacity","attrs-border-color-opacity","font-family","attrs-font-family","font-style","attrs-font-style","font-weight","attrs-font-weight","font-size","attrs-font-size","letter-spacing","attrs-letter-spacing","color","attrs-color","color-opacity","attrs-color-opacity","icon_color","icon_color_opacity","text-align","attrs-text-align","attrs-icon-size","hover-background-color","hover-background-color-opacity","attrs-hover-background-color","attrs-hover-background-color-opacity","hover-border-radius","attrs-hover-border-radius","hover-border-width","attrs-hover-border-width","hover-border-color","attrs-hover-border-color","hover-border-color-opacity","attrs-hover-border-color-opacity","hover-color","attrs-hover-color","hover-color-opacity","attrs-hover-color-opacity","hover-icon_color","hover-icon_color_opacity","hover-tansition-duration"];return t.forEach((function(t,e,i){i[e]="change:"+t})),t.join(" ")}},{defaults:{h:ie.a.DEFAULT_ROW_HEIGHT,w:ie.a.DEFAULT_ROW_WIDTH,x:"center",selected_product_id:"default",layout:"vertical",tp:"text",btn_w:168,btn_h:50,text_w:106,text_h:24,hidden:!1,select_btn_margin:10,attributes_margin:10,text:"Add to cart","background-color":"282828","background-color-opacity":100,"border-radius":30,"border-width":0,"border-color":"000000","border-color-opacity":100,"font-family":"Arial","font-style":"normal","font-weight":400,"font-size":18,"letter-spacing":0,"text-align":"center",color:"ffffff","color-opacity":100,"hover-background-color":"282828","hover-background-color-opacity":100,"hover-border-radius":30,"hover-border-width":0,"hover-border-color":"000000","hover-border-color-opacity":100,"hover-color":"ffffff","hover-color-opacity":100,"hover-tansition-duration":0,icon_color:"ffffff",icon_color_opacity:100,icon_enabled:!1,icon_h:18,icon_w:18,icon_rm_id:null,icon_noun_id:null,icon_noun_url:null,icon_pos:"left",icon_raster2xUrl:null,icon_rasterUrl:null,"hover-icon_color":"ffffff","hover-icon_color_opacity":100,"hover-icon_raster2xUrl":null,"hover-icon_rasterUrl":null,"attrs-background-color":"282828","attrs-background-color-opacity":100,"attrs-border-radius":30,"attrs-border-width":0,"attrs-border-color":"000000","attrs-border-color-opacity":100,"attrs-font-family":"Arial","attrs-font-style":"normal","attrs-font-weight":400,"attrs-font-size":18,"attrs-letter-spacing":0,"attrs-color":"ffffff","attrs-color-opacity":100,"attrs-hover-background-color":"282828","attrs-hover-background-color-opacity":100,"attrs-hover-border-radius":30,"attrs-hover-border-width":0,"attrs-hover-border-color":"000000","attrs-hover-border-color-opacity":100,"attrs-hover-color":"ffffff","attrs-hover-color-opacity":100,"attrs-icon-h":16,"attrs-icon-w":10,"attrs-text_w":0,"attrs-text_h":0}}),ge=i("q1tI"),me=i.n(ge),fe=i("i8i4"),ve=i.n(fe),be=i("LazK"),_e=i("8AXF"),we=i("3uGt"),ye=r.a.extend({name:"RM Header",thumb:"rm-header",icon_color:"#282828",initial_controls:["rmheader_settings","common_position","common_lock"],restrictions:function(){var t=window.RM.constructorRouter&&window.RM.constructorRouter.me&&window.RM.constructorRouter.me.get("permissions");return t&&t.can_use_rm_widgets},initialize:function(t,e){this.initBlock(t,e)},render:function(){var t=this;this.create(),this.$el.addClass("rm-header"),this.controls=this.initial_controls,Object(s.a)('<div id="rm-header-mobile-portal">').appendTo("body"),this.propsModel=new n.a.Model({isDesktop:"default"===this.model.getViewport()}),this.$header=this.$content.get(0);Object(_e.renderReact)({component:function(){return me.a.createElement(_e.CreateContextProvider,{context:we.b,model:t.propsModel},me.a.createElement(be.a,null))},domElement:this.$header,model:this.model}),this.bindModelEvents(),this.fixMobileViewport(),this.rendered=!0,this.triggerReady()},redraw:function(){return this.fixMobileViewport(),r.a.prototype.redraw.apply(this,arguments)},bindModelEvents:function(){this.model.on("change:activeLink",this.onActiveLinkChange,this)},unbindModelEvents:function(){this.model.off("change:activeLink",this.onActiveLinkChange,this)},onActiveLinkChange:function(){this.model.save()},destroy:function(){return this.unbindModelEvents(),ve.a.unmountComponentAtNode(this.$header),r.a.prototype.destroy.apply(this,arguments)},fixMobileViewport:function(){var t="default"===this.model.getViewport();this.propsModel.set({isDesktop:t})}},{defaults:{activeLink:"none",full_width_initial_w:480,full_width_initial_x:0,full_width_margin:0,is_full_width:!0,fixed_position:"n",is_above:!0,is_global:!0,h:72,x:0,y:0,w:Object(s.a)(window).width()}}),ke=i("1cLU"),Ce=r.a.extend({name:"RM Footer",thumb:"rm-footer",icon_color:"#282828",initial_controls:["common_position","common_lock"],restrictions:function(){var t=RM.constructorRouter&&RM.constructorRouter.me&&RM.constructorRouter.me.get("permissions");return t&&t.can_use_rm_widgets},initialize:function(t,e){this.initBlock(t,e),this.propsModel=new Backbone.Model({isMobileViewport:!1})},render:function(){this.create(),this.$el.addClass("rm-footer"),this.controls=this.initial_controls,this.$footer=Object(s.a)("<div>").appendTo(this.$content).get(0),Object(_e.renderReact)({component:ke.a,domElement:this.$footer,model:this.propsModel}),this.fixMobileViewport(),this.rendered=!0,this.triggerReady()},redraw:function(){return this.fixMobileViewport(),r.a.prototype.redraw.apply(this,arguments)},fixMobileViewport:function(){var t="default"===this.model.getViewport();this.propsModel.set({isMobileViewport:!t})},destroy:function(){return ve.a.unmountComponentAtNode(this.$footer),r.a.prototype.destroy.apply(this,arguments)}},{defaults:{full_width_initial_w:480,full_width_initial_x:0,full_width_margin:0,is_above:!1,is_full_width:!0,modelType:"widget",sticked:"bottom",sticked_margin:0,h:360,w:Object(s.a)(window).width(),y:656}}),xe=i("Kw5r"),Se=i("4rJ8"),Pe=r.a.extend({name:"RM Cookies",thumb:"rm-cookies",icon_color:"#282828",initial_controls:["common_position","common_lock"],restrictions:function(){var t=RM.constructorRouter&&RM.constructorRouter.me&&RM.constructorRouter.me.get("permissions");return t&&t.can_use_rm_widgets},initialize:function(t,e){this.initBlock(t,e)},render:function(){this.create(),this.$el.addClass("rm-cookies"),this.controls=this.initial_controls;var t=xe.a.extend(Se.a);this.vue=new t({el:this.$content.get(0)}),this.rendered=!0,this.triggerReady()},destroy:function(){return this.vue&&this.vue.$destroy(),r.a.prototype.destroy.apply(this,arguments)}},{defaults:{w:356,h:116}}),$e=i("eS2O"),Oe=e.a={text:O,video:I,audio:L,backgroundVideo:B,background:W,picture:it,slideshow:ht,twitter:ft,facebook:yt,shape:Ct,iframe:$t,gmaps:Et,button:Dt,hotspot:Kt,form:te,ecommercecart:ee,addtocart:ue,rmheader:ye,rmfooter:Ce,rmcookies:Pe,textreact:$e.b}},tRog:function(t,e,i){"use strict";var s=i("xi34"),o=i("rFsW"),n=i("Kw5r"),a=i("OTSC"),r={model:{event:"change"},props:{value:Number,autofocus:{type:Boolean,default:!1},autosize:{type:Boolean,default:!1},wait:{type:Number,default:null},min:{type:Number,default:Number.NEGATIVE_INFINITY},max:{type:Number,default:Number.POSITIVE_INFINITY},dir:{type:String,default:"v"},speed:{type:Number,default:3},step:{type:Number,default:1},labelSelector:{type:String,default:""},shiftStep:{type:Number,default:10},useFloat:{type:Boolean,default:!1},mouseOnly:{type:Boolean,default:!1},mouseUse:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},thousandDelimiter:{type:String,default:""},debounceKeyboard:{type:Number,default:void 0}},computed:{computedValue:{get:function(){var t,e=this;return t=this.$$el?this.$$el.data("formatValue")(this.value):this.value,this.autosize&&n.a.nextTick((function(){a.b.setInputSize(Object(s.a)(e.$el),150)})),t}}},watch:{mouseUse:function(t){var e=this;n.a.nextTick((function(){var t=e.$$el.data("destroy");o.a.isFunction(t)&&t(),Object(s.a)(e.$$el).RMNumericInput({onChange:e.onChange,labelSelector:e.labelSelector,useFloat:e.useFloat})}))},min:function(t){this.$$el.data("changeMinMax")(t)},max:function(t){this.$$el.data("changeMinMax")(void 0,t)}},mounted:function(){this.$$el=Object(s.a)(this.$el);var t=function(){Object(s.a)(this.$$el).RMNumericInput({onChange:this.onChange,labelSelector:this.labelSelector,useFloat:this.useFloat}),this.$$el.data("formatValue")(this.value),this.autosize&&a.b.setInputSize(Object(s.a)(this.$el),150,this.$$el.val())}.bind(this);this.wait?a.b.waitForTransitionEnd(this.$$el,this.wait,"opacity",function(){t()}.bind(this)):t()},methods:{onChange:function(t,e){this.disabled||this.$emit("change",e)},updateSize:function(){a.b.setInputSize(this.$$el,200)}}},l=(i("+Xeu"),i("KHd+")),c=Object(l.a)(r,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("input",{staticClass:"param-input",attrs:{type:"text",spellcheck:"false","data-useFloat":t.useFloat,"data-step":t.step,"data-min":t.min,"data-max":t.max,"data-mouseDir":t.dir,"data-mouseSpeed":t.speed,"data-shiftStep":t.shiftStep,"data-autofocus":t.autofocus,"data-autoSize":t.autosize,wait:t.wait,"data-mouseOnly":t.mouseOnly,readonly:t.readonly||t.mouseOnly,disabled:t.disabled,"data-mouseUse":t.mouseUse+"","data-thousandDelimiter":t.thousandDelimiter,"data-debounceKeyboard":t.debounceKeyboard},domProps:{value:t.computedValue}})}),[],!1,null,null,null);e.a=c.exports},tVJf:function(module,exports){module.exports={"template-constructor-control-form_styles":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="icon noarrow" data-alt="Styles" data-alt-pos="left" data-alt-offset="9"></div>\n\n\n\t<div class="panel">\n\n\t\t<div class="common-wrapper">\n\n\t\t\t<div class="edit-wrapper" data-state="fields" data-button-state="default" data-style="" data-layout="">\n\n\t\t\t\t<div class="control-caption">Layout</div>\n\n\t\t\t\t<div class="layout-wrapper">\n\t\t\t\t\t<div class="layout-switcher layout-vertical"></div>\n\t\t\t\t\t<div class="layout-switcher layout-horizontal"></div>\n\t\t\t\t</div>\n\n\n\t\t\t\t<div class="style-wrapper">\n\t\t\t\t\t<div class="prev-style"></div>\n\t\t\t\t\t<div class="style-caption"></div>\n\t\t\t\t\t<div class="next-style"></div>\n\t\t\t\t</div>\n\n\n\t\t\t\t<div class="type-wrapper">\n\t\t\t\t\t<div class="type-switcher type-fields">Fields</div>\n\t\t\t\t\t<div class="type-switcher type-button">Button</div>\n\t\t\t\t</div>\n\n\n\t\t\t\t<div class="button-switcher-wrapper">\n\t\t\t\t\t<div class="button-switcher button-default">Default</div>\n\t\t\t\t\t<div class="button-switcher button-hover">Hover</div>\n\t\t\t\t</div>\n\n\n\n\t\t\t\t<div class="params-wrapper">\n\n\t\t\t\t\t\x3c!-- Fields --\x3e\n\t\t\t\t\t<div class="params-block params-fields">\n\n\t\t\t\t\t\t<div class="edit-item" data-field="gutter">\n\t\t\t\t\t\t\t<div class="caption">Spacing</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator color-click-area" data-field="color" data-field-dop="opacity">\n\t\t\t\t\t\t\t<div class="caption">Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="border-radius">\n\t\t\t\t\t\t\t<div class="caption">Radius</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item combined separator" data-field="border-width">\n\t\t\t\t\t\t\t<div class="caption">Border</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\n\t\t\t\t\t\t\t<div class="edit-item border-color color-click-area" data-field="border-color" data-field-dop="border-opacity">\n\t\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item combined separator" data-field="underline-width">\n\t\t\t\t\t\t\t<div class="caption">Underline</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\n\t\t\t\t\t\t\t<div class="edit-item underline-color color-click-area" data-field="underline-color" data-field-dop="underline-opacity">\n\t\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t \x3c!-- Font Family --\x3e\n\t\t\t\t\t\t<div class="edit-item separator font-family-click-area" title="Font Family">\n\t\t\t\t\t\t\t<div class="font-family"></div>\n\t\t\t\t\t\t\t<div class="popup-arrow"></div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t\x3c!-- Font Style --\x3e\n\t\t\t\t\t\t<div class="edit-item separator font-style-click-area" title="Font Style">\n\t\t\t\t\t\t\t<div class="font-style"></div>\n\t\t\t\t\t\t\t<div class="popup-arrow"></div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item separator color-click-area" data-field="text-color" data-field-dop="text-opacity">\n\t\t\t\t\t\t\t<div class="caption">Text Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="font-size" title="Font Size">\n\t\t\t\t\t\t\t<div class="font-size-icon"></div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="letter-spacing" title="Tracking">\n\t\t\t\t\t\t\t<div class="letter-spacing-icon"></div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\n\n\n\n\n\n\n\t\t\t\t\t\x3c!-- Button default --\x3e\n\t\t\t\t\t<div class="params-block params-button-default">\n\n\t\t\t\t\t\t<div class="edit-item" data-field="gutter">\n\t\t\t\t\t\t\t<div class="caption"></div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator color-click-area" data-field="color" data-field-dop="opacity">\n\t\t\t\t\t\t\t<div class="caption">Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="border-radius">\n\t\t\t\t\t\t\t<div class="caption">Radius</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item combined separator" data-field="border-width">\n\t\t\t\t\t\t\t<div class="caption">Border</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\n\t\t\t\t\t\t\t<div class="edit-item border-color color-click-area" data-field="border-color" data-field-dop="border-opacity">\n\t\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t \x3c!-- Font Family --\x3e\n\t\t\t\t\t\t<div class="edit-item separator font-family-click-area" title="Font Family">\n\t\t\t\t\t\t\t<div class="font-family"></div>\n\t\t\t\t\t\t\t<div class="popup-arrow"></div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t\x3c!-- Font Style --\x3e\n\t\t\t\t\t\t<div class="edit-item separator font-style-click-area" title="Font Style">\n\t\t\t\t\t\t\t<div class="font-style"></div>\n\t\t\t\t\t\t\t<div class="popup-arrow"></div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item separator color-click-area" data-field="text-color" data-field-dop="text-opacity">\n\t\t\t\t\t\t\t<div class="caption">Text Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="font-size" title="Font Size">\n\t\t\t\t\t\t\t<div class="font-size-icon"></div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="letter-spacing" title="Tracking">\n\t\t\t\t\t\t\t<div class="letter-spacing-icon"></div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator align" data-field="align" title="Align">\n\t\t\t\t\t\t\t<div class="caption"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\n\n\n\n\n\n\t\t\t\t\t\x3c!-- Button hover --\x3e\n\t\t\t\t\t<div class="params-block params-button-hover">\n\n\t\t\t\t\t\t<div class="edit-item color-click-area" data-field="color"  data-field-dop="opacity">\n\t\t\t\t\t\t\t<div class="caption">Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item combined separator" data-field="border-width">\n\t\t\t\t\t\t\t<div class="caption">Border</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\n\t\t\t\t\t\t\t<div class="edit-item border-color color-click-area" data-field="border-color" data-field-dop="border-opacity">\n\t\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator color-click-area" data-field="text-color" data-field-dop="text-opacity">\n\t\t\t\t\t\t\t<div class="caption">Text Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator clearfix" data-field="transition">\n\t\t\t\t\t\t\t<div class="caption" title="For Color, Border Color & Width, Text Color">Transition</div>\n\t\t\t\t\t\t\t<div class="switcher transition-switcher"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t</div>\n\n\n\t\t<div class="colorbox_container"></div>\n\n\t\t<div class="fontselector_container"></div>\n\n\t\t<div class="fontstyle_container">\n\t\t\t<div class="font-style-wrapper"></div>\n\t\t</div>\n\n\t</div>\n\n';return __p}}},tcT1:function(t,e,i){"use strict";var s=i("xi34"),o=i("q1z7"),n=i.n(o),a=i("rFsW"),r=i("hXNS"),l=i("AnuO"),c=i("YqYG"),h=i("BVsp"),d=i("+9Qk"),p=i("avvt"),u=i("5Rpd"),g=i("gFFP"),m=i("KVGF"),f=i.n(m),v=i("OTSC"),b=i("Vxjr"),_=n.a.View.extend({className:"magpassword",events:{"click .access":"onAccessClick","keydown #magpassword-input":"onPasswordKeydown","input #magpassword-input":"onPasswordInput"},initialize:function(t){a.a.bindAll(this),a.a.extend(this,t),this.router=t.router,this.template=f.a["template-viewer-mag-password"]},render:function(t){var e,i=this,o=t.mag.pass_bg;a.a.extend(this,t),e=new g.UserModel(this.mag.user),Object(s.a)(new Image).load((function(){i.$el.html(i.template({user:e,pass_bg:o,Constants:v.a})),i.$parent&&(i.$parent.find(i.className).remove(),i.$parent.append(i.$el)),i.delegateEvents(),a.a.delay((function(){i.$(".back, .center-content").removeClass("invisible"),a.a.delay((function(){i.$(".author, .powered").removeClass("invisible")}),700)}),200)})).prop("src",o||Object(b.b)("./viewer/mag-password/bg.jpg"))},onAccessClick:function(){var t=s.a.trim(Object(s.a)("#magpassword-input").val());t?(this.xhr&&this.xhr.abort(),this.xhr=s.a.ajax({url:"/api/readymag/authorize",method:"POST",data:{pass:t,num_id:this.mag.num_id},success:function(){this.proceed()},error:function(){Object(s.a)("#magpassword-input").focus().select(),this.shake()},context:this})):this.shake()},proceed:function(){Object(s.a)("body").removeClass("black"),this.remove(),this.mag.has_code_injection||this.mag.opts&&this.mag.opts.gtm_id?window.location.reload():n.a.history.loadUrl(n.a.history.fragment)},onPasswordKeydown:function(t){13===t.keyCode&&this.onAccessClick()},onPasswordInput:function(t){this.$(".access").toggleClass("disabled",!this.$(".password-input").val()),this.$(".password-input").toggleClass("active",this.$(".password-input").val().length>0)},shake:function(){var t=this;this.$(".password-wrapper").addClass("shake"),a.a.delay((function(){t.$(".password-wrapper").removeClass("shake")}),500)}}),w=n.a.Router.extend({routes:{":user(/)(:mag)(/)(*pageUri)(/)":"start"},mags:{},initialize:function(){if(Modernizr.addTest("chrome",(function(){return a.a.isObject(window.navigator)&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),RM.common.isDomainViewer&&this.route("(:mag)(/)(*pageUri)(/)","start"),RM.common.isDownloadedSource&&(this.route("(*pageUri)","start"),/msie [6-9]/i.test(navigator.userAgent)&&(location.href="sorry.html")),Object(s.a)("html").toggleClass("viewer-embed-mode",!!RM.common.embedMode),a.a.bindAll(this),this.environment=v.a.environment.viewer,this.started=!1,!RM.common.isDownloadedSource&&RM.data.usersLoader.me&&(this.me=RM.data.usersLoader.me),this.$mags_container=Object(s.a)("#mags"),this.magsData=window.ServerData&&window.ServerData.mags,this.userPermissions=window.ServerData&&window.ServerData.userPermissions,this.internalHistory=[],this.magsData){if(this.cachedMag=this.magsData.mag,!this.cachedMag||!this.cachedMag.user||!this.cachedMag.user._id)return;RM.common.isDownloadedSource||(this.cachedMag.user.isMe=this.me&&this.me.get("_id")==this.cachedMag.user._id),RM.common.isDomainViewer&&(this.magUri=this.cachedMag.uri,this.userUri=this.cachedMag.user&&this.cachedMag.user.uri)}RM.screenshot||(RM.analytics=RM.analytics||new r.a({router:this}),this.analytics=RM.analytics,RM.common.isDomainViewer||v.b.processCustomTrackingEventCookies()),this.isPreview||Modernizr.sessionstorage&&window.sessionStorage.removeItem("constructorViewport")},start:function(t,e,i){if(RM.common.isDomainViewer&&(this.magsData.magNotFound||this.magsData.domainNotFound||this.magsData.magNotPublished||this.magsData.subscriptionExpired))new l.a({type:"domain-error",$container:Object(s.a)("#service-pages"),templateData:{state:this.magsData}}).render();else if(Modernizr.msie||Modernizr.msie11){new c.a({$parent:Object(s.a)("body > .popups"),router:this,opts:{type:"type-browsers-viewer"}}).render()}else{if(RM.common.isDomainViewer&&!RM.common.customDomainProfile)parseInt(t,10)!=t&&t&&/^p\d+\/?$/i.test(t)?(i=null,e=t,t=null):(i=t,t=this.userUri,e=this.magUri);else if(RM.common.isDownloadedSource)i=t,t=null,e=null;else if(parseInt(t,10)==t||/^p\d+\/?$/i.test(t)){var o=e;e=t,i=o,t=null}else if(RM.common.customDomainProfile){o=e;e=t,i=o,t=this.userUri}else if(!e)return this.notFound();this.latestFragment=n.a.history.getFragment(),i=i||1;var r=t+"_"+e;if(this.username=t,this.started!=r||this.loaded==r)if(this.started=r,this.loaded!=this.started){if(this.cachedMag&&!a.a.isEmpty(this.cachedMag))return this.cachedMag instanceof p.a||this.cachedMag.forbidden||this.cachedMag.is_suspended||(this.cachedMag=new p.a(this.cachedMag,this)),this.mag=this.cachedMag,void this.onLoadMag(i);this._loadingMagDataXHR&&this._loadingMagDataXHR.abort(),this._loadingMagDataXHR=this.fetchData(this.username,e,{success:a.a.bind((function(t){this.mag&&this.mag.num_id&&t&&t.num_id!=this.mag.num_id&&window.location.reload(),this.mag=new p.a(t,this),this.cachedMag=this.mag,this.onLoadMag(i)}),this),error:this.notFound})}else this.go(i,{animation:!1})}},onLoadMag:function(t){var e;if(this.loaded=this.started||!0,this.mag.forbidden)return this.requestMagPassword(this.latestFragment,a.a.clone(this.mag)),delete this.cachedMag,delete this.loaded,void delete this.started;this.mag.is_suspended?this.showSuspended():(RM.common.isDownloadedSource||(s.a.post("/api/countview/"+this.mag.num_id),RM.analytics&&(RM.analytics._triggerProjectView=!0)),this.mag._requested_page?(e=this.mag._requested_page,delete this.mag._requested_page):e=t,Modernizr.addTest("screenshot-mode",(function(){return RM.screenshot})),this.mag.render(),this.go(e,{animation:!1}),RM.common.mode="mag")},getAnalyticsDimensions:function(){return{magId:this.mag&&this.mag.model&&this.mag.model.get("num_id")||this.mag&&this.mag.num_id,magCreatorId:this.mag&&this.mag.model&&this.mag.model.user.get("_id")||this.mag&&this.mag.user._id,pageType:"viewer",userId:this.me&&this.me.get("_id")}},fetchData:function(t,e,i){return(i=i||{}).url=t?"/api/readymag/"+t+"/"+e:"/api/readymag/"+e,s.a.ajax(i)},sendReadyEvent:function(t){t=t||{},t=a.a.defaults(t,{page:{}});var e=document.createElement("MyExtensionDataElement");e.setAttribute("width",t.page.width),e.setAttribute("height",t.page.height),e.setAttribute("_id",t.page._id),document.documentElement.appendChild(e);var i=document.createEvent("Events");if(t&&t.error?i.initEvent("MyErrorEvent",!0,!1):i.initEvent("MyExtensionEvent",!0,!1),e.dispatchEvent(i),window.loadNotifier){if(t.error)return window.loadNotifier({error:t.error});window.loadNotifier({width:t.page.width,height:t.page.height})}},setTitle:function(){if(this.mag&&this.mag.currentPage){var t=a.a.extend({},this.mag.model.toJSON());t.user=this.mag.user,document.title=d.a.getFinalSEO(this.mag.currentPage,t,{customDomain:!!RM.common.isDomainViewer}).title}},trackPage:function(){RM.screenshot||a.a.defer(a.a.bind((function(){this.analytics&&this.analytics.trackPage()}),this))},go:function(t,e){t=t||1,this.mag.showPage(t,e)},goBack:function(){var t=this.internalHistory[this.internalHistory.length-2];t&&(t&&this.go(t,{skipInternalHistory:!0}),this.internalHistory.pop())},setUrlString:function(t){if(!this.noUrlRewrite&&(t=t||{},!RM.screenshot)){var e,i=this.mag.currentPage;if(e=RM.common.isDomainViewer&&!RM.common.customDomainProfile||RM.common.isDownloadedSource?"":RM.common.customDomainProfile?this.getMagUri(this.mag):this.username?this.mag.user.uri+"/"+(this.mag.uri||this.mag.num_id)+"/":this.isPreview?this.mag.num_id+"/":this.getMagUri(this.mag),this.isPreview&&(e+="preview/"),i&&"1"!=i.num&&(e+=(i.uri||i.num.toString())+"/"),t.skipInternalHistory?RM.analytics&&RM.analytics.sendEvent("Back Link",e):this.internalHistory.push(i.num.toString()),e!==n.a.history.getFragment()){var s=(parseInt(a.a.last(n.a.history.getFragment(),"/"))||1)==i.num||t.replace;RM.common.isDownloadedSource&&"/"!==a.a.last(e)&&(e+="/"),RM.common.homepageRewrite||this.navigate(e,{replace:s})}}},getPreviousFragment:function(){return this.internalHistory[this.internalHistory.length-2]},getMagUri:function(t){return RM.common.customDomainProfile?(t.uri||t.num_id)+"/":RM.common.isDomainViewer?"":a.a.isEmpty(t.user)?t.num_id+"/":t.user.uri+"/"+(t.uri||t.num_id)+"/"},getUserPermissions:function(){return this.userPermissions||[]},onError:function(){this.mag&&this.go(1,{animation:!1})},createLoginViewForIframe:function(t,e,i){new h.a({useNavigate:!1,$node:Object(s.a)(t),router:this,joinCallback:e,errorMessages:i}).render()},createMagFromTemplate:function(t,e){new u.a({router:this,me:this.me,tp:t,templateID:e})},destroy:function(){this.cachedMag&&this.cachedMag.destroy(),this.magPasswordView&&this.magPasswordView.remove(),this.magSuspendedView&&this.magSuspendedView.remove()},requestMagPassword:function(t,e){this.magPasswordView||(this.magPasswordView=new _({router:this,$parent:Object(s.a)("#mags")})),this.magPasswordView.render({mag:e,mag_url:t})},showSuspended:function(){new l.a({type:"mag-suspended",$container:Object(s.a)("#service-pages")}).render()},notFound:function(){a.a.defer((function(){new l.a({type:"404",$container:Object(s.a)("#service-pages")}).render()}))}});e.a=w},tcpm:function(t,e,i){"use strict";var s=i("xi34"),o=i("q1z7"),n=i.n(o),a=i("rFsW"),r=i("gobI"),l=i("OTSC"),c=i("yWjQ"),h=i.n(c),d=i("QNiq");function p(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function u(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function g(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var m=n.a.View.extend({THUMBNAILS_HEIGHT:72,COUNTERS_HEIGHT:40,COUNTERS_ADDITIONAL_SPACE:30,COUNTER_WIDTH:14,THUMBNAIL_WIDTH:56,THUMBNAIL_PADDING:8,THUMBNAILS_PADDING:16,swipeStartDistance:5,scrollStartDistance:3,swipeDistance:35,IMG_ACCELERATION_DELAY:500,AUTOPLAY_DELAY:4,SLIDER_TRANSITION:.5,events:{"click .images .prev-picture-arrow-middle":"prevImage","click .images .next-picture-arrow-middle":"nextImage","click .images .prev-picture-arrow-bottom":"prevImage","click .images .next-picture-arrow-bottom":"nextImage","click .images .fullscreen":"toggleFullscreen","click .counters-dots .counter":"counterClick","click .thumbnails .thumb":"thumbnailClick","click .images":"onImageClick","blur .captions .caption":"onCaptionBlur","mousemove .images.mouseover":"onMouseMove","mouseover .images.mouseover.viewer":"onMouseMove","mouseout  .images.mouseover.viewer":"onMouseOut","mouseenter  .images.play-on-hover.viewer":"onMouseEnter","mousemove  .images.play-on-hover.viewer":"changeSlideonHover","mouseleave  .images.play-on-hover.viewer":"stopAutoplay"},initialize:function(t,e,i,o,n){a.a.bindAll(this),this.template=h.a["template-common-slideshow-player"],this.block=o,this.model=o&&o.model,this.params=t,this.$container=e,this.environment=i,this.preloadImagesList=[],this.indexArr=[],this.mag=n,"constructor"===this.environment&&this.checkNeedUpdateWidget(),this.params.w=Math.ceil(this.params.w),this.handleCounters="constructor"===i||t.theme_data.counters&&"dots"===t.theme_data.counters_type||"theme_captions"===t.current_theme,this.handleThumbnails="constructor"===i||t.theme_data.thumbnails,this.currentPic={$el:null,num:null},this.initialRender=!0,this.lastClick=0,this.slidesDirection="",this.render(),this.applyVisualState(t),this.applyPictures(t),this.applyTextStyles(t);var r=this.params.pictures||[];if(this.handleCounters&&this.$counters_container.css("width",r.length*this.COUNTER_WIDTH),this.$counters_container.children(":first-child").addClass("active"),this.handleThumbnails&&this.$thumbnails_container.css("width",r.length*(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)-this.THUMBNAIL_PADDING),this.$thumbnails_container.children(":first-child").addClass("active"),this.recalcCounters(t),this.recalcThumbnails(t),this.moveToImage(this.currentImageID,!1,"change-pictures"),"viewer"===this.environment){var l=this.preloadImagesList.length;if(!l)return a.a.defer(a.a.bind((function(){this.trigger("ready")}),this));var c=a.a.bind((function(){--l||this.isDestroyed||(this.loadRemainingImages(),this.trigger("ready"))}),this);a.a.each(this.preloadImagesList,(function(t){this.isDestroyed||(t.preload=new Image,Object(s.a)(t.preload).on("load",c).on("error",c),t.preload.src=t.url)}),this)}this.$container.append(this.$el),this.initialRender=!1,this.handleCounters&&d.a.isDesktop&&(this.counters_scroll=this.$counters_scroll_wrapper.RMScroll({$container:this.$counters.find(".items-wrapper"),$content:this.$counters_container,$handle:this.$counters.find(".scroll"),wheelScrollSpeed:.1,scrollStep:14,tp:"horizontal",needRecalc:!1}).data("scroll")),this.handleThumbnails&&(d.a.isDesktop?this.thumbnails_scroll=this.$thumbnails_scroll_wrapper.RMScroll({$container:this.$thumbnails.find(".items-wrapper"),$content:this.$thumbnails_container,$handle:this.$thumbnails.find(".scroll"),wheelScrollSpeed:.3,onScroll:this.preloadThumbImages,tp:"horizontal",needRecalc:!1}).data("scroll"):this.$thumbnails.find(".items-wrapper").bind("scroll",this.preloadThumbImages)),this.setSwipeAction()},render:function(){this.setElement(Object(s.a)(this.template({tp:this.environment}))),this.$el.attr("data-id",this.params._id),this.$images=this.$(".images"),this.$images_wrapper=this.$images.find(".images-wrapper"),this.$middle_arrows=this.$images.find(".arrow-middle"),this.$bottom_arrows=this.$images.find(".arrow-bottom"),this.$bottom_arrows_container=this.$images.find(".bottom-arrows"),this.$counters=this.$(".counters-dots"),this.$counters_container=this.$counters.find(".items"),this.$counters_scroll_wrapper=this.$counters.find(".scroll-wrapper"),this.$thumbnails=this.$(".thumbnails"),this.$thumbnails_container=this.$thumbnails.find(".items"),this.$thumbnails_scroll_wrapper=this.$thumbnails.find(".scroll-wrapper"),this.$captions=this.$(".captions")},checkNeedUpdateWidget:function(){(a.a.has(this.model.get("theme_data"),"arrows_position")||a.a.has(this.model.attributes,"active_arrows")||"theme_captions"===this.model.get("current_theme"))&&"bottom"!==this.model.get("active_arrows")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{arrows_position:"bottom"})},{silent:!0}),a.a.has(this.model.get("theme_data"),"arrows_position")||(a.a.has(this.model.attributes,"active_arrows")||"theme_captions"!==this.model.get("current_theme"))&&"middle"!==this.model.get("active_arrows")&&a.a.has(this.model.attributes,"active_arrows")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{arrows_position:"sides"})},{silent:!0}),(a.a.has(this.model.get("theme_data"),"counters_position")||a.a.has(this.model.attributes,"active_arrows")||"theme_captions"!==this.model.get("current_theme"))&&"middle"!==this.model.get("active_arrows")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{counters_position:"outside"})},{silent:!0}),(a.a.has(this.model.get("theme_data"),"counters_position")||"bottom"!==this.model.get("active_arrows"))&&a.a.has(this.model.attributes,"active_arrows")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{counters_position:"inside"})},{silent:!0}),a.a.has(this.model.get("theme_data"),"arrows")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{arrows:!0})},{silent:!0}),a.a.has(this.model.get("theme_data"),"arrows_type")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{arrows_type:"default"})},{silent:!0}),"noun"===this.model.get("theme_data").arrows_type&&this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{arrows_type:"library"})},{silent:!0}),this.model.get("theme_data").autoplay&&!a.a.has(this.model.attributes,"play_method")&&this.model.set({play_method:"autoplay"},{silent:!0}),a.a.has(this.model.get("theme_data"),"counters_type")||"theme_captions"===this.model.get("current_theme")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{counters_type:"numbers"})},{silent:!0}),a.a.has(this.model.get("theme_data"),"counters_type")||"theme_captions"!==this.model.get("current_theme")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{counters_type:"dots"})},{silent:!0}),a.a.has(this.model.get("theme_data"),"captions")||"theme_captions"===this.model.get("current_theme")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{captions:!1})},{silent:!0}),a.a.has(this.model.get("theme_data"),"captions")||"theme_captions"!==this.model.get("current_theme")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{captions:!0})},{silent:!0}),a.a.has(this.model.get("theme_data"),"counters")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{counters:!1})},{silent:!0}),a.a.has(this.model.get("theme_data"),"left_icon_noun")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{left_icon_noun:{}})},{silent:!0}),a.a.has(this.model.get("theme_data"),"right_icon_noun")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{right_icon_noun:{}})},{silent:!0}),a.a.has(this.model.attributes,"current_mode")||this.model.set({current_mode:"default"},{silent:!0}),a.a.has(this.model.get("theme_data"),"arrows_view_mode")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{arrows_view_mode:"normal"})},{silent:!0}),a.a.has(this.model.get("theme_data"),"radius")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{radius:0})},{silent:!0}),a.a.has(this.model.attributes,"transition_type")||this.model.set({transition_type:"slider"},{silent:!0}),a.a.has(this.model.attributes,"play_method")&&this.model.get("play_method")||this.model.set({play_method:"click"},{silent:!0}),a.a.has(this.model.get("theme_data"),"crossfade")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{crossfade:2})},{silent:!0}),a.a.has(this.model.get("theme_data"),"scroll_delay")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{scroll_delay:1})},{silent:!0}),a.a.has(this.model.get("theme_data"),"start_offset")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{start_offset:200})},{silent:!0}),a.a.has(this.model.get("theme_data"),"slider_transition")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{slider_transition:.5})},{silent:!0}),a.a.has(this.model.get("theme_data"),"autoplay_delay")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{autoplay_delay:4})},{silent:!0}),a.a.has(this.model.get("theme_data"),"hover_delay")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{hover_delay:.8})},{silent:!0}),a.a.has(this.model.get("theme_data"),"show_on_hover")||this.model.set({theme_data:a.a.extend(this.model.get("theme_data"),{show_on_hover:!1})},{silent:!0}),a.a.has(this.model.attributes,"current_theme")&&this.model.unset("current_theme",{silent:!0}),a.a.has(this.model.attributes,"active_arrows")&&this.model.unset("active_arrows",{silent:!0})},loadRemainingImages:function(t){var e,i;if(e=(t=t||this.$images_wrapper.children().filter((function(){return Object(s.a)(this).attr("data-src")})).toArray()).length<2?t.length:2,t&&t.length)for(i=0;i<=e;i++)this.preloadPictures(t,i,e)},preloadPictures:function(t,e,i){var o=new Image,n=this;Object(s.a)(t[e]).attr("data-src")&&(o.onload=function(){Object(s.a)(t[e]).css({"background-image":'url("'+Object(s.a)(t[e]).attr("data-src")+'")'}).removeAttr("data-src"),n.indexArr.push(e),n.indexArr.length-1===i&&(t.splice(0,i+1),n.indexArr=[],n.loadRemainingImages(t))}),Object(s.a)(t[e]).attr("data-src")&&(o.src=Object(s.a)(t[e]).attr("data-src"))},applyVisualState:function(t,e){if(t.theme_data){var i={w:e?e.w:t.w,h:e?e.h:t.h,images_h:e?e.images_h:t.images_h,captions_h:e?e.captions_h:t.captions_h,thumbnails_h:this.THUMBNAILS_HEIGHT,counters_h:this.COUNTERS_HEIGHT,left_arrow_noun:t.left_arrow_noun,right_arrow_noun:t.right_arrow_noun,theme:t.current_theme,play_method:t.play_method,current_mode:t.current_mode,thumbnails:t.theme_data.thumbnails,arrows_type:t.theme_data.arrows_type,arrows_position:t.theme_data.arrows_position,arrows_view_mode:t.theme_data.arrows_view_mode,active_arrows:t.active_arrows,captions:t.theme_data.captions,counters:t.theme_data.counters,counters_type:t.theme_data.counters_type,counters_position:t.theme_data.counters_position,show_on_hover:t.theme_data.show_on_hover,pictures:t.pictures,radius:t.theme_data.radius,transition_type:t.transition_type};i.showThumbnails=i.thumbnails,i.showCounters=i.counters,i.showCaptions=i.captions,i.showFullscreen=t.theme_data.fullscreen,i.showArrows=t.theme_data.arrows,void 0!==i.showArrows?(i.showBtmArrows=i.showArrows&&(i.arrows_position?"bottom"===i.arrows_position:i.active_arrows?"bottom"===i.active_arrows:"theme_classic"===i.theme)&&"normal"===i.arrows_view_mode,i.showMdlArrows=i.showArrows&&(i.arrows_position?"sides"===i.arrows_position:i.active_arrows?"middle"===i.active_arrows:"theme_captions"===i.theme)&&"normal"===i.arrows_view_mode):(i.showBtmArrows="theme_classic"===i.theme,i.showMdlArrows="theme_captions"===i.theme),this.$images.css("height",i.images_h),this.$thumbnails.css({display:i.showThumbnails?"block":"none",height:i.thumbnails_h}),this.$counters.css({display:i.showCounters&&(i.counters_type?"dots"===i.counters_type:"theme_captions"===i.theme)?"block":"none",height:i.counters_h}),this.$captions.css({display:i.showCaptions||"theme_captions"===i.theme?"block":"none",height:i.captions_h}),this.$images.find(".fullscreen").toggle(i.showFullscreen),!i.theme||"theme_captions"!==i.theme||i.active_arrows||i.counters_type&&"dots"!==i.counters_type||this.setDotsPosition("middle"),void 0!==i.arrows_type&&this.$images.toggleClass("noun",i.showArrows&&("library"===i.arrows_type||"noun"===i.arrows_type)),void 0!==i.arrows_view_mode&&this.$images.toggleClass("mouseover",i.showArrows&&"mouseover"===i.arrows_view_mode),void 0!==i.show_on_hover&&this.$images.toggleClass("show-on-hover",i.showArrows&&i.show_on_hover),void 0!==i.play_method&&this.$images.toggleClass("play-on-hover","hover"===i.play_method),this.$images.toggleClass("viewer","viewer"===this.environment),"mouseover"!==i.arrows_view_mode&&this.$images.css("cursor","default"),this.$bottom_arrows.toggle(i.showBtmArrows),this.$middle_arrows.toggle(i.showMdlArrows),this.$bottom_arrows_container.toggleClass("only-counters","sides"===i.arrows_position||"middle"===i.active_arrows||!1===i.showArrows||"mouseover"===i.arrows_view_mode),this.$images.find(".counters-numbers").toggle(i.showCounters&&(i.counters_type?"numbers"===i.counters_type:"theme_classic"===i.theme)),"dots"===i.counters_type&&this.setDotsPosition(i.counters_position?i.counters_position:i.active_arrows);var o=t.theme_data,n=this.getRGBA(o.controls_color,o.controls_opacity),r=this.getRGBA(o.background_color,o.background_opacity);if(this.colorArrows(o.controls_color,o.controls_opacity),this.$("svg #full-screen").css("fill",n),this.$(".counters-numbers").css("color",n),"dots"===i.counters_type&&"inside"===i.counters_position&&a.a.defer(function(){this.$counters.find(".counter").css({background:n,"border-color":n})}.bind(this)),this.$images.css("background",r),this.$thumbnails.css("background",r),this.setPicsTransitions(),this.setNewPicsWidths(i.w),this.$images_wrapper.toggleClass("crossfade","crossfade"===i.transition_type),this.$images_wrapper.css({"border-radius":i.radius}),this.$images_wrapper.children(".image").each(a.a.bind((function(t,e){var n=Object(s.a)(e);n.css({"background-size":this.setImageSize(o.fill,n.attr("data-width"),n.attr("data-height"),i.w,i.images_h),"border-radius":i.radius})}),this)),!this.initialRender){var l=t.pictures||[];this.handleCounters&&this.$counters_container.css("width",l.length*this.COUNTER_WIDTH),this.handleThumbnails&&this.$thumbnails_container.css("width",l.length*(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)-this.THUMBNAIL_PADDING),this.recalcCounters(t,e),this.recalcThumbnails(t,e),this.moveToImage(this.currentImageID,!1,"change-visual-style")}}},onMouseMove:function(t){var e,i=this.$images,o=r.a.getBox(i.get(0)),n=Object(s.a)(t.currentTarget).offset(),a=this.getIconUrl().leftArrUrl,l=this.getIconUrl().rightArrUrl,c=this.isLeftSideOfWidget(t)?a:l,h=this.$el.find(".cursor");"constructor"===this.environment?Object(s.a)(t.currentTarget).css({cursor:"url('".concat(c,"') 18 18, auto")}):(e=this.isFullscreenMode?1:this.mag.getScale(this.pageViewport),Object(s.a)(t.target).hasClass("image")||Object(s.a)(t.target).hasClass("images-wrapper")||Object(s.a)(t.target).hasClass("bottom-arrows")?(h.show().css({left:t.clientX/e-o.left-h.width()/2,top:(Modernizr.safari?t.pageY/e-n.top:t.clientY/e-o.top)-h.height()/2,cursor:"none","background-image":"url('".concat(c,"')")}),Object(s.a)(t.currentTarget).css({cursor:"none"})):h.css({"background-image":"none"}))},onMouseOut:function(){this.$el.find(".cursor").hide()},getIconUrl:function(){var t,e,i,s=("constructor"===this.environment?this.model.get("theme_data"):this.params.theme_data).arrows_type;return"constructor"===this.environment||"viewer"===this.environment&&"default"===s?(t=this.sanitizeSVG(this.$bottom_arrows.find("svg").first()),e=this.sanitizeSVG(this.$bottom_arrows.find("svg").last())):(t=("bottom"===(i=this.params.theme_data.arrows_position)?this.$el.find(".prev-picture-arrow-bottom img"):this.$el.find(".prev-picture-arrow-middle img")).attr("src"),e=("bottom"===i?this.$el.find(".next-picture-arrow-bottom img"):this.$el.find(".next-picture-arrow-middle img")).attr("src")),{leftArrUrl:t,rightArrUrl:e}},sanitizeSVG:function(t){var e=("constructor"===this.environment?this.model.get("theme_data"):this.params.theme_data).arrows_type,i="data:image/svg+xml;charset=utf-8,";return"library"!==e&&"noun"!==e||t.attr({height:"36",width:"36"}),i+=t[0].outerHTML.replace(/#/g,"%23").replace(/(\r\n|\n|\r)/gm,"")},colorArrows:function(t,e){var i=this.getRGBA(t,e);this.$("svg path").css("stroke",i),this.$("svg").css("fill",i)},setDotsPosition:function(t){var e,i;"middle"!==t&&"outside"!==t||(this.$counters.remove(),this.$thumbnails.after(this.$counters),this.$counters.addClass("down-position"),this.$counters.find(".counter").css("background","#fff")),this.$thumbnails.next(".counters-dots").length&&this.$thumbnails.next(".counters-dots").length>0&&("bottom"===t||"inside"===t)&&(this.$counters.remove(),this.$images.find(".counters-numbers").after(this.$counters),this.$counters.removeClass("down-position"),"constructor"===this.environment&&(e=this.model.get("theme_data"),i=this.getRGBA(e.controls_color,e.controls_opacity),this.$counters.find(".counter").css("background",i)))},getRGBA:function(t,e){var i=[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)];return e>.99?"rgb("+i[0]+","+i[1]+","+i[2]+")":"rgba("+i[0]+","+i[1]+","+i[2]+", "+e+")"},getOriginalUrl:function(t){return t.rasterUrl||t.url},getScaledUrl:function(t){return r.a.isOn()?t.unscaledOptimizedUrl||t.rasterUrl||t.url:Modernizr.retina?t.unscaledOptimizedUrl||t.scaled2xUrl||t.rasterUrl||t.url:t.unscaledOptimizedUrl||t.scaledUrl||t.rasterUrl||t.url},applyPictures:function(t){if(t.theme_data){var e,i,o=t.pictures||[];this.$el.toggleClass("no-images",!o.length),this.$bottom_arrows_container.toggleClass("no-images",o.length<=1),this.$middle_arrows.toggleClass("no-images",o.length<=1),this.$images.find(".bottom-arrows .counters-text-total").text(o.length),this.$images_wrapper.empty(),this.handleCounters&&this.$counters_container.empty(),this.handleThumbnails&&this.$thumbnails_container.empty(),(o=a.a.sortBy(o,"num")).length>1&&o.length<4&&(i=g(o).map((function(t){var e=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?p(i,!0).forEach((function(e){u(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):p(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},t);return e.fakedId=l.b.generateUUID(),e.faked=!0,e})),e=s.a.merge(o,i));for(var n=0;n<(e?e.length:o.length);n++){var r,c=o[n];if(r=Object(s.a)("<div>").addClass("image").attr("data-id",c.fakedId?c.fakedId:c.id).toggleClass("error",!!c.error).css({"background-size":this.setImageSize(t.theme_data.fill,c.width,c.height,t.w,t.images_h)}).appendTo(this.$images_wrapper),c.fakedId&&r.attr("data-original-id",c.id),"constructor"===this.environment&&r.css({"background-image":c.url?'url("'+this.getScaledUrl(c)+'")':"none"}),"viewer"===this.environment&&c.url&&(r.attr("data-src",this.getScaledUrl(c)),c.scaledUrl&&r.data("orig-src",this.getOriginalUrl(c))),c.url&&c.width&&c.height&&r.attr("data-width",c.width).attr("data-height",c.height),this.handleThumbnails&&!c.faked&&(r=Object(s.a)("<div>").addClass("thumb").attr("data-id",c.id).toggleClass("error",!!c.error).css({left:(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)*n-this.THUMBNAIL_PADDING/2}).appendTo(this.$thumbnails_container),"constructor"===this.environment&&r.css({"background-image":c.thumbUrl?'url("'+c.thumbUrl+'")':"none"}),"viewer"===this.environment&&c.thumbUrl&&r.attr("data-src",c.thumbUrl)),this.handleCounters&&!c.faked&&Object(s.a)("<div>").addClass("counter").attr("data-id",c.id).css({left:this.COUNTER_WIDTH*n}).appendTo(this.$counters_container),(this.params.theme_data.captions||"theme_captions"===this.params.current_theme)&&"viewer"===this.environment&&!c.faked){var h=Object(s.a)("<div>").addClass("caption-wrapper").attr("data-id",c.id);Object(s.a)("<div>").addClass("caption").html(l.b.plainTextToHtml(c.text,{detectLinks:!0})).appendTo(h),h.appendTo(this.$captions)}}this.$images_wrapper.children(":first-child").data("first-child",!0),this.$images_wrapper.children(":last-child").data("last-child",!0),this.updateCurrentImageID(t),this.initialRender||(this.handleCounters&&this.$counters_container.css("width",o.length*this.COUNTER_WIDTH),this.handleThumbnails&&this.$thumbnails_container.css("width",o.length*(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)-this.THUMBNAIL_PADDING),this.recalcCounters(t),this.recalcThumbnails(t),this.moveToImage(this.currentImageID,!1,"change-pictures")),o.length||this.$images.find(".bottom-arrows .counters-text .counters-text-current").html(0),this.$images_wrapper.children(".image").each(a.a.bind((function(t,e){var i=Object(s.a)(e),o="viewer"===this.environment?this.params.theme_data.radius:this.model.get("theme_data").radius;i.css({"border-radius":o})}),this))}},applyTextStyles:function(t){var e=a.a.omit(t.text_style,"size-leading-linked","size-leading-ratio");/px/i.test(e["font-size"])||(e["font-size"]+="px"),/px/i.test(e["letter-spacing"])||(e["letter-spacing"]+="px"),/px/i.test(e["line-height"])||(e["line-height"]+="px"),/#/i.test(e.color)||(e.color="#"+e.color),e.opacity/=100,this.$captions.find(".caption").css(e)},setNewPicsWidths:function(t){var e,i=this.$el.find("#slideshow-images-position-style-"+this.params._id),o=d.a.isDesktop?"":"translateZ(0)",n=r.a.isAllowed()?r.a.getRatio():1;e=this.isSlider()?'          .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper {\n            left: 0px;\n            width: '+t+'px;\n          }\n          .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image {\n            left: 0px;\n            width: '+t+'px;\n          }\n          .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image.prev-image {\n            -webkit-transform: translateX('+-t+"px)"+o+";\n            transform: translateX("+-t+"px)"+o+';\n          }\n          .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image.center-image {\n            -webkit-transform: translateX(0) '+o+";\n            transform: translateX(0) "+o+';\n          }\n          .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image.next-image {\n            -webkit-transform: translateX('+t+"px)"+o+";\n            transform: translateX("+t+"px)"+o+';\n          }\n                    .edge .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper {\n            left: 0px;\n            width: '+t+'px;\n          }\n          .edge .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image {\n            left: 0px;\n            width: '+t+'px;\n          }\n          .edge .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image.prev-image {\n            -webkit-transform: translateX('+Math.ceil(-t*n)+"px) "+o+";\n            transform: translateX("+Math.ceil(-t*n)+"px) "+o+';\n          }\n          .edge .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image.center-image {\n            -webkit-transform: translateX(0) '+o+";\n            transform: translateX(0) "+o+';\n          }\n          .edge .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image.next-image {\n            -webkit-transform: translateX('+Math.ceil(t*n)+"px) "+o+";\n            transform: translateX("+Math.ceil(t*n)+"px) "+o+";\n        }\n      ":'      .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper {\n        left: 0px;\n        width: '+t+'px;\n      }\n      .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image {\n        left: 0px;\n        opacity: 0;        width: '+t+'px;\n      }\n      .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image.center-image {\n        opacity: 1;        }\n      .edge .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper {\n        left: 0px;\n        width: '+t+'px;\n      }\n      .edge .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image {\n        left: 0px;\n        width: '+t+"px;\n      }\n      ",i.length||(i=Object(s.a)('<style id="slideshow-images-position-style-'+this.params._id+'" type="text/css">')).appendTo(this.$el),i.text(e)},getPlayMethod:function(){return"viewer"===this.environment?this.params.play_method:this.model.get("play_method")},getCrossfadeTransitionTime:function(){return("viewer"===this.environment?this.params.theme_data:this.model.get("theme_data")).crossfade},isSlider:function(){var t;return t="viewer"===this.environment&&this.params.transition_type?"slider"===this.params.transition_type:"constructor"!==this.environment||!this.model.get("transition_type")||"slider"===this.model.get("transition_type"),t},getTransitionsTime:function(){return this.isSlider()?this.getSliderTransitionTime():this.getCrossfadeTransitionTime()},getTransitionsDelay:function(){var t,e;return"viewer"===this.environment?(t=this.params.play_method,e=this.params.theme_data):(t=this.model.get("play_method"),e=this.model.get("theme_data")),1e3*("hover"===t?e.hover_delay:"autoplay"===t||e.autoplay?e.autoplay_delay:0)||this.AUTOPLAY_DELAY},setPicsTransitions:function(t,e){var i,o=this.$el.find("#slideshow-images-transition-style-"+this.params._id),n="cubic-bezier(0.40, 0.24, 0.40, 1)",a=this.isSlider()||"scroll"!==this.getPlayMethod()?"ease-in-out":"ease-out",r="prev"===e?"next":"prev",l=this.isSlider()&&"scroll"===this.getPlayMethod()?0:this.getTransitionsTime();t=t||l,i=this.isSlider()?'          .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper.enable-transitions .image {\n            -webkit-transition:\ttransform '+t+"s "+n+";            transition: transform "+t+"s "+n+';          }\n          .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper.enable-transitions .image.center-image {\n            -webkit-transition:\ttransform '+(t-.05)+"s "+n+";            transition: transform "+(t-.05)+"s "+n+';        }\n        .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper.enable-transitions .image.'+e+"-image {\n            -webkit-transition:\ttransform 0s "+n+";        transition: transform 0s "+n+';        }\n        .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper.enable-transitions .image.'+r+"-image {\n            -webkit-transition:\ttransform "+t+"s "+n+";        transition: transform "+t+"s "+n+";        }\n        ":'        .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper.enable-transitions .image {\n        -webkit-transition:\topacity '+t+"s "+a+";        transition: opacity "+t+"s "+a+';        }\n        .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper.enable-transitions .image.center-image {\n        -webkit-transition:\topacity '+t+"s "+a+";        transition: opacity "+t+"s "+a+";        }\n        ",o.length||(o=Object(s.a)('<style id="slideshow-images-transition-style-'+this.params._id+'" type="text/css">')).appendTo(this.$el),o.text(i)},getSliderTransitionTime:function(){if(!RM.screenshot)return("viewer"===this.environment?this.params.theme_data.slider_transition:this.model.get("theme_data").slider_transition)||this.SLIDER_TRANSITION},setImageSize:function(t,e,i,s,o){return e&&i?t?(s/o>e/i?(n=s+2,a=Math.round(n*i/e)):(a=o+2,n=Math.round(a*e/i)),n+"px "+a+"px"):e<s&&i<o?e+"px "+i+"px":(s/o>e/i?(a=o+2,n=Math.round(a*e/i)):(n=s+2,a=Math.round(n*i/e)),n+"px "+a+"px"):t?"cover":"contain";var n,a},onCaptionBlur:function(){if("viewer"!==this.environment&&this.model){var t=this.$captions.find(".caption").val(),e=a.a.clone(this.model.get("pictures")),i=a.a.findWhere(e,{id:this.$captions.find(".caption").attr("data-id")});if(i&&i.text!==t){var s=e.indexOf(i);e[s]=a.a.extend({},i,{text:t}),this.model.save({pictures:e},{toHistory:!0}),this.block.workspace.trigger("redraw")}}},recalcCounters:function(t,e){if("dots"===t.theme_data.counters_type||"theme_captions"===t.current_theme){var i=t.pictures||[],s=e?e.w:t.w,o=this.COUNTER_WIDTH*i.length,n=Math.floor(s/this.COUNTER_WIDTH)*this.COUNTER_WIDTH,a=this.$bottom_arrows_container.hasClass("only-counters")&&i.length>2?this.COUNTERS_ADDITIONAL_SPACE:0,r=Math.min(o,n)+a,l=(t.theme_data.counters_position?"outside"===t.theme_data.counters_position:t.active_arrows?"middle"===t.active_arrows:"theme_captions"===t.current_theme)?Math.floor((s-r)/2):0;this.$counters_scroll_wrapper.css({left:l,width:r}),this.$counters_container.css({width:o})}},recalcThumbnails:function(t,e){if(t.theme_data.thumbnails){var i=t.pictures||[],s=e?e.w:t.w,o=i.length*(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)-this.THUMBNAIL_PADDING,n=Math.min(o,s-this.THUMBNAILS_PADDING),a=Math.floor((s-n)/2);this.thumbsWidth=n,this.$thumbnails_scroll_wrapper.css({left:a,width:n}),this.$thumbnails_container.css({width:o})}},onImageClick:function(t){var e;this.isNormalArrowsMode()||(t&&t.stopPropagation(),"hover"===this.getPlayMethod()&&(e="switch-to-image-autoplay"),this.isLeftSideOfWidget(t)?this.prevImage(t,e):this.nextImage(t,e))},isLeftSideOfWidget:function(t){var e=this.$images,i=r.a.getNormalizedBox(e.get(0));return t.pageX<i.left+(this.isFullscreenMode?Object(s.a)(window).width():i.width)/2},isNormalArrowsMode:function(){return"constructor"===this.environment&&this.model.get("theme_data")&&"normal"===this.model.get("theme_data").arrows_view_mode},prevImage:function(t,e){this.imagePrevNext(t,"prev",e||"switch-to-image")},checkNeedUpdateTransition:function(t,e){var i,s=this.getTransitionsTime(),o=this.$images_wrapper.children(":first").css("transition-duration")?parseFloat(this.$images_wrapper.children(":first").css("transition-duration")):s;t&&t.timeStamp?((i=(t.timeStamp-this.lastClick)/1e3)<s?this.setPicsTransitions(i.toFixed(1),e):o<s&&this.setPicsTransitions(s,e),this.lastClick=t.timeStamp):this.setPicsTransitions(s,e),this.slidesDirection!==e&&(this.setPicsTransitions(s,e),this.slidesDirection=e)},nextImage:function(t,e){this.imagePrevNext(t,"next",e||"switch-to-image")},imagePrevNext:function(t,e,i){if(this.currentImageID){var o="next"==e?this.currentPic.$el.next():this.currentPic.$el.prev();o.length||(o=this.$images_wrapper.children(":"+("next"==e?"first":"last"))),this.checkNeedUpdateTransition(t,e),this.$images_wrapper.children(".changed-opacity").each(a.a.bind((function(t,e){var i=Object(s.a)(e);i.css({opacity:""}),i.removeClass("changed-opacity")}),this)),this.moveToImage(o.attr("data-id"),!0,i),t&&t.stopPropagation()}},changeSlideonHover:function(t){var e=this.isLeftSideOfWidget(t)?"prev":"next";this.slidesDirection!==e&&this.stopAutoplay(),this.startAutoplay(e),this.slidesDirection=e},onMouseEnter:function(t){this.onImageClick(t),this.changeSlideonHover(t)},thumbnailClick:function(t){this.moveToImage(Object(s.a)(t.currentTarget).attr("data-id"),!1,"switch-to-image"),t.stopPropagation()},counterClick:function(t){this.moveToImage(Object(s.a)(t.currentTarget).attr("data-id"),!1,"switch-to-image"),t.stopPropagation()},moveToImage:function(t,e,i){var o=this;if(t){var n=this.$images_wrapper.children(".image"),r=n.filter('[data-id="'+t+'"]'),l=r.attr("data-original-id"),c=n.index(r),h=a.a.clone(this.currentPic),d=c,p=this,u="viewer"===this.environment?this.params.pictures.length:this.model.get("pictures").length,g=this.getTransitionsDelay(),m=1e3*this.getTransitionsTime();t=l||t,r.length&&-1!==c&&(this.currentImageID=t,this.currentPic.$el=r,this.currentPic.num=c,"switch-to-image"===i&&"viewer"===this.environment&&(this.params.theme_data.autoplay&&void 0===this.params.play_method||"autoplay"===this.params.play_method||"hover"===this.params.play_method)&&(this.stopAutoplay(),setTimeout((function(){return o.startAutoplay()}),g)),this.$images_wrapper.toggleClass("enable-transitions",e),this.resetWaitForAnimationEnd(),e&&h.$el&&this.waitForAnimationEnd(h.$el,f),this.direction=!h.$el||!h.$el.length||h.num<d?"forward":"backward",r.data("first-child")&&h.$el&&h.$el.length&&h.$el.data("last-child")?this.direction="forward":r.data("last-child")&&h.$el&&h.$el.length&&h.$el.data("first-child")&&(this.direction="backward"),n.each((function(t){var e=Object(s.a)(this),i=n.length-1;1!==n.length?t+1===d||0===d&&t===i?p.setPicPosition(e,"prev",!0):t-1===d||d===i&&0===t?p.setPicPosition(e,"next",!0):t===d?p.setPicPosition(e,"center",t===d):p.setPicPosition(e,"",!1):p.setPicPosition(e,"center",t===d)})),u>1&&u<4&&(c=c>=u?c-u:c),p.$images.find(".counters-text-current").html(c+1),!e&&f())}function f(){if(e||p.initialRender||window.requestAnimationFrame((function(){p.$images_wrapper.addClass("enable-transitions")})),p.trigger("currentImageChanged",t,e,i),p.handleCounters&&!p.initialRender){var s=p.$counters_container.children('[data-id="'+t+'"]');p.$counters_container.children(".active").removeClass("active"),s.addClass("active");var o=s.get(0).offsetLeft,n=p.$counters.find(".items-wrapper").width(),r=void 0;o+2*p.COUNTER_WIDTH-p.$counters.find(".items-wrapper").scrollLeft()>n?r=o+2*p.COUNTER_WIDTH-n:o-p.COUNTER_WIDTH-p.$counters.find(".items-wrapper").scrollLeft()<0&&(r=o-p.COUNTER_WIDTH),null!=r&&(e?p.$counters.find(".items-wrapper").stop().animate({scrollLeft:r},m):p.$counters.find(".items-wrapper").scrollLeft(r))}if(p.handleThumbnails&&!p.initialRender){var l=p.$thumbnails_container.children('[data-id="'+t+'"]');p.$thumbnails_container.children(".active").removeClass("active"),l.addClass("active");o=l.position().left,n=p.$thumbnails.find(".items-wrapper").width(),r=void 0;o+2*(p.THUMBNAIL_WIDTH+p.THUMBNAIL_PADDING)-p.THUMBNAIL_PADDING/2-p.$thumbnails.find(".items-wrapper").scrollLeft()>n?r=o+2*(p.THUMBNAIL_WIDTH+p.THUMBNAIL_PADDING)-p.THUMBNAIL_PADDING/2-n:n>2*(p.THUMBNAIL_WIDTH+p.THUMBNAIL_PADDING)&&o-p.THUMBNAIL_WIDTH-p.THUMBNAIL_PADDING/2-p.$thumbnails.find(".items-wrapper").scrollLeft()<0&&(r=o-p.THUMBNAIL_WIDTH-p.THUMBNAIL_PADDING/2)}if(null!=r&&(e?p.$thumbnails.find(".items-wrapper").stop().animate({scrollLeft:r},m):p.$thumbnails.find(".items-wrapper").scrollLeft(r)),p.model&&"constructor"===p.environment){var c=p.model.get("pictures"),h=a.a.findWhere(c,{id:p.currentImageID});h?p.$captions.find(".caption").val(h.text).attr("data-id",p.currentImageID):p.$captions.find(".caption").val("").attr("data-id","")}else!p.params.theme_data.captions&&"theme_captions"!==p.params.current_theme||"viewer"!==p.environment||(e?p.$captions.find('.caption-wrapper[data-id="'+p.currentImageID+'"]').stop().fadeIn(200).siblings().stop().fadeOut(200):(p.$captions.find(".caption-wrapper").stop().css({display:"none"}),p.$captions.find('.caption-wrapper[data-id="'+p.currentImageID+'"]').stop().css({display:"block"})));p.preloadImages(),p.preloadThumbImages()}},waitForAnimationEnd:function(t,e){this.resetWaitHook=l.b.waitForTransitionEnd(t,this.getTransitionsTime(),"transform",e)},resetWaitForAnimationEnd:function(){this.resetWaitHook&&this.resetWaitHook()},setPicPosition:function(t,e,i){Object(s.a)(t).removeClass("center-image prev-image next-image neighbour hidden").addClass((e?e+"-image ":"hidden")+(i?"neighbour":"")),Object(s.a)(t).data("last-position",e),Object(s.a)(t).data("last-neighbour",i)},preloadImages:function(){if("viewer"==this.environment){var t=this.$images_wrapper.children('[data-id="'+this.currentImageID+'"]');if(t.length){var e=t.prev();e.length||(e=this.$images_wrapper.children(":last"));var i=t.next();i.length||(i=this.$images_wrapper.children(":first"));var s=this;o(t),RM.screenshot||(o(e),o(i))}}function o(t){if(s.isFullscreenMode){if(t.data("orig-src")){var e=new Image;e.onload=function(){t.css({"background-image":'url("'+e.src+'")'}).removeData("orig-src")},e.src=t.data("orig-src")}s.$images_wrapper.find(".image").css("border-radius",0)}t.attr("data-src")&&(s.preloadImagesList.push({url:t.attr("data-src")}),t.css({"background-image":'url("'+t.attr("data-src")+'")'}).removeAttr("data-src"))}},preloadThumbImages:function(){if("viewer"===this.environment&&this.params.theme_data.thumbnails){var t=this.initialRender?this.thumbsWidth:this.$thumbnails_scroll_wrapper.width(),e=this.initialRender?0:this.$thumbnails.find(".items-wrapper").scrollLeft();this.$thumbnails.find(".items-wrapper .thumb").each(a.a.bind((function(i,o){var n=Object(s.a)(o);if(n.attr("data-src")){var a=i*this.THUMBNAIL_WIDTH-this.THUMBNAIL_PADDING/2,r=this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING;a-e>t+r||a+r-e<0-r||(this.preloadImagesList.push({url:n.attr("data-src")}),n.css({"background-image":'url("'+n.attr("data-src")+'")'}).removeAttr("data-src"))}}),this))}},updateCurrentImageID:function(t){if(t.pictures&&t.pictures.length)if(this.currentImageID){var e=a.a.findWhere(t.pictures,{id:this.currentImageID});this.currentImageID=e?e.id:this.getFirstPictureID(t)}else this.currentImageID=this.getFirstPictureID(t);else this.currentImageID=void 0},getFirstPictureID:function(t){return a.a.sortBy(t.pictures,"num")[0].id},toggleFullscreen:function(t){"constructor"!=this.environment&&(this.isFullscreenMode?this.leaveFullscreen():this.enterFullscreen(),t.stopPropagation())},enterFullscreen:function(){"constructor"!=this.environment&&(this.isFullscreenMode||(this.isFullscreenMode=!0,this.$parentBeforeFullscreen=this.$el.parent(),Object(s.a)(".constructor .widgetbar").addClass("hidden"),this.$el.addClass("fullscreen-mode"),this.$el.appendTo("body").css("z-index",999),Object(s.a)(window).on("resize",this.onFullscreenResize),Object(s.a)("body").on("keyup",this.onFullscreenKeyUp),a.a.defer((function(){RM.common.disableShortcuts.slideshow=!0})),this.onFullscreenResize(),l.b.getFocusBack(),this.preloadImages()))},onFullscreenKeyUp:function(t){t.keyCode==s.a.keycodes.left&&this.prevImage(),t.keyCode==s.a.keycodes.right&&this.nextImage(),t.keyCode==s.a.keycodes.esc&&this.leaveFullscreen()},onFullscreenResize:function(){var t=this.$el.width(),e=this.$el.height(),i=this.params.theme_data.counters&&(("middle"===this.params.active_arrows||"outside"===this.params.theme_data.counters_position)&&"dots"===this.params.theme_data.counters_type||"theme_captions"===this.params.current_theme),s=e-(this.params.theme_data.thumbnails?this.THUMBNAILS_HEIGHT:0)-(this.params.theme_data.captions||"theme_captions"===this.params.current_theme?this.params.captions_h:0)-(i?this.COUNTERS_HEIGHT:0);this.applyVisualState(this.params,{w:t,h:e,images_h:s,captions_h:this.params.captions_h})},leaveFullscreen:function(){"constructor"!=this.environment&&this.isFullscreenMode&&(this.isFullscreenMode=!1,this.$el.appendTo(this.$parentBeforeFullscreen).css("z-index","auto"),Object(s.a)(window).off("resize",this.onFullscreenResize),this.$el.removeClass("fullscreen-mode"),Object(s.a)(".constructor .widgetbar").removeClass("hidden"),Object(s.a)("body").off("keyup",this.onFullscreenKeyUp),a.a.defer((function(){delete RM.common.disableShortcuts.slideshow})),this.applyVisualState(this.params),this.setNewPicsWidths(this.params.w))},startAutoplay:function(t){var e;this.autoPlayInterval||(e=1e3*(t?this.params.theme_data.hover_delay:this.params.theme_data.autoplay_delay||this.AUTOPLAY_DELAY),this.autoPlayInterval=setInterval(a.a.bind((function(){this.imagePrevNext(null,t||"next","switch-to-image-autoplay")}),this),e))},stopAutoplay:function(){clearInterval(this.autoPlayInterval),this.autoPlayInterval=null},destroy:function(){this.isDestroyed=!0,this.stopAutoplay(),this.leaveFullscreen(),this.resetWaitForAnimationEnd(),this.$el&&this.$el.remove()},setSwipeAction:function(){d.a.isDesktop||(this.picsSwipe=this.$images_wrapper.RMSwipe({$scrollElements:this.mag.$mag_container,maxTransitionSpeed:1e3*this.getTransitionsTime(),rubberBandForce:1/1.47,getCurrentConstraints:function(t){var e={},i=this.isFullscreenMode?this.$images_wrapper.width():this.params.w;return e.$moveItems=this.currentPic.$el.add(this.currentPic.$el.prev()).add(this.currentPic.$el.next()),e.$referenceItem=e.$moveItems.filter(":not(.center-image)").first(),this.currentPic.$el.is(":last-child")?e.left={max:0,noTrigger:!0}:e.left={max:i},this.currentPic.$el.is(":first-child")?e.right={max:0,noTrigger:!0}:e.right={max:i},e}.bind(this),onSwipeStart:function(){var t,e,i=this,s=this.getTransitionsDelay();"viewer"===this.environment?(t=this.params.play_method,e=this.params.theme_data.autoplay&&void 0===t):(t=this.model.get("play_method"),e=this.model.get("theme_data").autoplay),("autoplay"===t||e)&&(console.log("dsad"),this.stopAutoplay(),setTimeout((function(){return i.startAutoplay()}),s)),this.$images_wrapper.removeClass("enable-transitions")}.bind(this),customMoveCheck:function(t,e){return!(t.hasClass("prev-image")&&e<0)&&!(t.hasClass("next-image")&&e>0)}.bind(this),callback:function(t){var e;"right"===t&&(e=this.currentPic.$el.prev()),"left"===t&&(e=this.currentPic.$el.next()),e.length||(e=this.currentPic.$el),this.moveToImage(e.attr("data-id"),!1,"switch-to-image")}.bind(this)}).data("swipe"))}});e.a=m},tf3M:function(t,e,i){"use strict";i.r(e),i.d(e,"WidgetsCollection",(function(){return g}));var s=i("q1z7"),o=i.n(s),n=i("rFsW"),a=i("v92f"),r=i("rVpV"),l=i("Fi5S"),c=i("jeLO"),h=i("sviH"),d=i("roQd");i("Kf/z");function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var u=c.a.extend({idAttribute:"_id",urlRoot:"/api/widget/",defaults:{x:Math.round(272),y:157,w:480,h:360},name:"Widget",widgets_with_inner_widgets:["hotspot"],nonUndoKeys:["animation"],viewport_required_fields:["x","y","w","h"],onlyRootFields:["_id","modelType"].concat(a.b.viewport_list),initialize:function(t,e){if(e=e||{},this.Block=h.a[t.type],this.Block){this.hasNested=n.a.contains(this.widgets_with_inner_widgets,t.type),this.isNested=!!t.parent_wid;var i=RM.constructorRouter&&!RM.constructorRouter.previewMode;this.hasNested&&i&&this.init_inner_widgets_models(t,e),this.on("change:is_global",this.onGlobalChange)}},init_inner_widgets_models:function(t,e){var i,s;s=(i=n.a.clone(t)).widgets||i.wids||[],s=this.sanitizeWidgets(s),this.widgets_collection=new g(s,{parent_widget:this,parse:e.parse,page:this.collection.page}),i.wids=n.a.pluck(s,"_id"),this.set(i,{silent:!0}),this.on("change:wids",this.onWidsChange)},parse:function(t,e){if(!this.collection||!this.collection.page)return t;this.Block||(this.Block=h.a[t.type]);var i=this.isNested?"default":this.collection.page.getCurrentViewport();return n.a.isEmpty(t)||(n.a.each(a.b.viewport_list,(function(e){this[e]=t[e],"default"!==e&&t[e]&&"button"===t.type&&n.a.each(a.b.viewport_fields[t.type]||a.b.viewport_fields_common,function(i){this[e][i]=n.a.has(t[e],i)?t[e][i]:t[i]}.bind(this)),this[e]=n.a.omit(this[e],this.onlyRootFields),delete t[e],delete this.attributes[e]}),this),this.storeViewport("default",t),n.a.extend(t,n.a.defaults(this["viewport_"+i],this.viewport_fields_defaults))),e&&e.xhr&&(e.xhr.skipResponse=!0),n.a.has(t,"w")&&!n.a.isNumber(t.w)&&(t.w=this.defaults.w),n.a.has(t,"h")&&!n.a.isNumber(t.h)&&(t.h=this.defaults.h),c.a.prototype.parse.apply(this,arguments)},set:function(t,e,i){var s;if("object"===p(t)?(s=t,i=e):(s={})[t]=e,!this.isGlobal()||!this.collection||!this.collection.page||i&&i.noSaveUnique)return c.a.prototype.set.apply(this,arguments);var o=r.a.fillUniqueAttributeSets(s,this.attributes,this.collection.page.id);return n.a.isEmpty(o)||n.a.extend(s,o),c.a.prototype.set.apply(this,[s,i])},get:function(t){var e=c.a.prototype.get.apply(this,arguments);if(!this.attributes.is_global||this.attributes.is_above&&"z"===t||!n.a.contains(r.a.GLOBAL_UNIQUE_KEYS,t)||!this.collection||!this.collection.page)return e;var i=r.a.getUniqueValue(t,this.attributes,this.collection.page.id);return void 0===i?e:i},validate:function(t){if(!t.type)return"missing widget type"},triggerReady:function(){l.a.trigger("ready:model",this)},toJSON:function(t){if(!this.collection||!this.collection.page)return this.attributes;var e=this.collection.page.getCurrentViewport(),i=n.a.clone(this.attributes);return"default"===e||this.isNew()||this.isNested||(i["viewport_"+e]=n.a.pick(i,this.viewport_fields),i["viewport_"+e]=n.a.omit(i["viewport_"+e],this.onlyRootFields),n.a.extend(i,this.viewport_fields_defaults,this.viewport_default)),n.a.each(a.b.viewport_list,(function(t){n.a.isEmpty(this[t])||i[t]||(i[t]=this[t])}),this),i},initViewport:function(t){var e=this.collection.page.getCurrentViewport(),i=this.attributes;this["viewport_"+e]=n.a.extend(n.a.pick(i,this.Block.prototype.viewport_fields),this.Block.getViewportDefaults(this,e,t))},getViewport:function(){return this.isNested?"default":this.collection&&this.collection.page&&this.collection.page.getCurrentViewport()},changeViewport:function(t){t=t||{};var e=this.collection.page.getPreviousViewport();this.storeViewport(e),this.restoreViewport()},storeViewport:function(t,e){t=t||this.collection.page.getCurrentViewport(),e=e||this.attributes,this["viewport_"+t]=n.a.pick(e,this.viewport_fields)},restoreViewport:function(t){if(t=t||this.collection.page.getCurrentViewport(),n.a.isEmpty(this["viewport_"+t]))"default"!==t&&this.restoreViewport("default"),this.storeViewport(t),this.set(this.Block.getViewportDefaults(this,t)),this.save({},{silent:!0,skipHistory:!0});else{var e=n.a.defaults({},this["viewport_"+t],this.viewport_fields_defaults);this.get("is_global")&&(this.get("is_above")&&delete e._z,r.a.fillUniqueValues(e,this.collection.page.id)),this.set(e,{first:!0,viewportChange:!0,noSaveUnique:!0})}"default"!==t&&this.validateViewport(t)},validateViewport:function(t){if(!n.a.all(this.viewport_required_fields,(function(t){var e=this.get(t);return null!=e&&!isNaN(e)&&""!==e}),this)){var e=this.viewport_default;this.set(n.a.pick(e,this.viewport_required_fields)),this.save({},{silent:!0,first:!0})}},fillMissingFieldsFromDefaultViewport:function(t){var e={};n.a.each(t,function(t){var i=this.viewport_default&&this.viewport_default[t];void 0===this.get(t)&&i&&(e[t]=n.a.cloneWithObjects(i))}.bind(this)),n.a.isEmpty(e)||this.set(e,{silent:!0})},splitChangesToViewport:function(t,e){if(!e||"default"===e)return t;var i=this.viewport_fields,s=n.a.pick(t,i);return n.a.each(i,(function(i){t["viewport_"+e]&&t["viewport_"+e][i]&&delete s[i]})),n.a.isEmpty(s)||(t["viewport_"+e]=n.a.extend({},t["viewport_"+e],s),t=n.a.omit(t,i)),t},getPageId:function(){return this.collection&&this.collection.getPageId()},addWidget:function(t,e){if(e=e||{},t&&t.type)if(h.a[t.type]){t.parent_wid=this.get("_id"),t.pid=this.get("pid");var i=this.widgets_collection.add(t,e);i.created=!e.copy&&!e.clone,i.id?i.fetch({success:this.getAddCallback(e),error:e.error}):i.save({},{success:this.getAddCallback(e),error:e.error})}else console.error("Adding unknown widget into another widget.");else console.error("Adding widget with no type into another widget.")},onAddWidget:function(t,e){if(!t.get("type"))return!1;var i;(i=n.a.clone(this.get("wids"))).push(t.id),i=Object(n.a)(i).chain().uniq().compact().value(),this.set({wids:i},e)},getAddCallback:function(t){t=t||{};var e=this;return function(i){e.onAddWidget(i,t),t.success&&t.success(i)}},onWidsChange:function(t,e,i){if((e=this.get("wids"))&&n.a.isObject(e[0])){var s=n.a.clone(e);s=this.sanitizeWidgets(s),this.widgets_collection.set(s,{parent_widget:this,page:this.collection.page}),e=n.a.pluck(e,"_id"),this.set("wids",e,{silent:!0})}var o=this.get("wids"),a=t.previous("wids")||[];if(o){var r=n.a.difference(o,a),l=n.a.difference(a,o);n.a.each(r,function(e){var s=t.widgets_collection.get(e);s&&this.trigger("widget:create",s,i)}.bind(this)),n.a.each(l,function(e){var s=t.widgets_collection.get(e);s&&this.trigger("widget:remove",s,i)}.bind(this))}},sanitizeWidgets:function(t){return n.a.filter(t,(function(t){return!!h.a[t.type]}))},isGlobal:function(){return!!this.get("is_global")},onGlobalChange:function(){this.get("is_global")?(Object(n.a)(a.b.viewport_listall).each(function(t){n.a.isEmpty(this[t])||("viewport_"+this.getViewport()===t&&r.a.ensurePageDefRecord(this.attributes),r.a.ensurePageDefRecord(this[t]))}.bind(this)),this.triggerGlobalAppear()):this.triggerGlobalDisappear()},triggerGlobalAppear:function(){l.a.trigger("global_appear:widget",this)},triggerGlobalDisappear:function(){l.a.trigger("global_disappear:widget",this)},getAnimations:function(){return d.a.normalizeAnimations(this.get("animation"))}},{viewports:a.b.viewport_list});Object.defineProperty(u.prototype,"viewport_fields",{get:function(){return this.Block.prototype.viewport_and_unique_fields||(this.Block.prototype.viewport_and_unique_fields=n.a.union(this.Block.prototype.viewport_fields,r.a.GLOBAL_UNIQUE_KEYS.map((function(t){return r.a.GLOBAL_UNIQUE_KEY_PREFIX+t})))),this.Block.prototype.viewport_and_unique_fields}}),Object.defineProperty(u.prototype,"viewport_fields_defaults",{get:function(){return this.Block.prototype.viewport_fields_defaults||(this.Block.prototype.viewport_fields_defaults={},n.a.each(this.viewport_fields,(function(t){this.Block.prototype.viewport_fields_defaults[t]=void 0}),this)),this.Block.prototype.viewport_fields_defaults}});var g=o.a.Collection.extend({model:u,initialize:function(t,e){e&&e.page&&(this.page=e.page),this.on("remove",(function(t){this.page&&this.page.trigger("widget:remove",t,{})}),this)},getPageId:function(){return this.page.id}});e.default=u},tzyo:function(module,exports){module.exports={"template-constructor-control-form_endpoints":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Send Data" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t\t<div class="panel-caption">\n\t\t\t<span>Send Data</span>\n\t\t\t<div class="inline-help">\n\t\t\t\t<div class="help-body-wrapper">\n\t\t\t\t\t<div class="help-body">\n\t\t\t\t\t\t<span class="help-text">Manage data storage.<br/><a href="http://help.readymag.com/hc/en-us/articles/360020793111-Form" target="_blank">Learn more</a></span>\n\t\t\t\t\t\t<div class="help-popup-corner">\n\t\t\t\t\t\t\t<div class="corner"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="hover-spacer"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="panel-section email collapsed">\n\t\t\t<div class="switcher-wrapper">\n\t\t\t\t<div class="switcher-caption">1st email</div>\n\t\t\t\t<div class="switcher email" data-provider="email"></div>\n\t\t\t</div>\n\n\t\t\t<div class="collapsable">\n\t\t\t\t<div class="current-email overflow-fade">NO-VAL</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="separator email"></div>\n\n\t\t<div class="panel-section second_email collapsed">\n\n\t\t\t<div class="switcher-wrapper">\n\t\t\t\t<div class="switcher-caption">2nd email</div>\n\t\t\t\t<div class="switcher second_email" data-provider="second_email"></div>\n\t\t\t</div>\n\n\t\t\t<div class="collapsable">\n\t\t\t\t<p class="confirmation hidden">\n\t\t\t\t\tCheck<span class="confirmation email-for-confirmation">NO-VAL</span>for confirmation\n\t\t\t\t</p>\n\t\t\t\t<div class="input-wrapper second_email">\n\t\t\t\t\t<input type="email" class="reach-input input-second-email" placeholder="Add email" data-provider="second_email" spellcheck="false">\n\t\t\t\t\t<div class="action-icon hidden"></div>\n\t\t\t\t</div>\n\t\t\t\t<p class="confirmation resend hidden">Resend confirmation</p>\n\t\t\t\t<p class="confirmation cancel hidden">Cancel request</p>\n\t\t\t\t<div class="error-block hidden">\n\t\t\t\t\t<p class="error red">\n\t\t\t\t\t\tEmail address <br/>\n\t\t\t\t\t\t<span class="error email-for-confirmation">NO-VAL</span>seems not active.\n\t\t\t\t\t</p>\n\t\t\t\t\t<p class="error try-another">Try another address</p>\n\t\t\t\t</div>\n\t\t\t\t<p class="new-email hidden overflow-fade">NO-VAL</p>\n\t\t\t\t<div class="choice-email hidden">\n\t\t\t\t\t<label class="custom-select">\n\t\t\t\t\t\t<select class="overflow-fade">\n\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t\t<p class="change-email hidden">Change email</p>\n\t\t\t\t<p class="back hidden">Back</p>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="separator second_email"></div>\n\n\t\t<div class="panel-section google collapsed">\n\t\t\t<div class="switcher-wrapper disconnected">\n\t\t\t\t<div class="switcher-caption">Google</div>\n\t\t\t\t<div class="switcher google" data-provider="google"></div>\n\t\t\t\t<div class="connect-button" data-provider="google"></div>\n\t\t\t</div>\n\n\t\t\t<div class="collapsable">\n\t\t\t\t<div class="input-wrapper sheet-name">\n\t\t\t\t\t<input type="text" class="reach-input input-sheet-name" placeholder="Create Sheet" data-provider="google">\n\t\t\t\t\t<div class="action-icon hidden"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="separator google"></div>\n\n\t\t<div class="panel-section mailchimp collapsed">\n\t\t\t<div class="switcher-wrapper disconnected">\n\t\t\t\t<div class="switcher-caption">MailChimp</div>\n\t\t\t\t<div class="switcher mailchimp" data-provider="mailchimp"></div>\n\t\t\t\t<div class="connect-button" data-provider="mailchimp"></div>\n\t\t\t\t<div class="switcher-overlay">\n\t\t\t\t\t<div class="help-body-wrapper">\n\t\t\t\t\t\t<div class="help-body">\n\t\t\t\t\t\t\t<span class="help-text">You should have an Email field<br>to send data to Mailchimp<br><a href="http://help.readymag.com/hc/en-us/articles/360020793111-Form" target="_blank">Learn more</a></span>\n\t\t\t\t\t\t\t<div class="help-popup-corner">\n\t\t\t\t\t\t\t\t<div class="corner"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="hover-spacer"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="collapsable">\n\t\t\t\t<div class="input-wrapper list-name">\n\t\t\t\t\t<input type="text" class="input-list-name" placeholder="Select List" disabled>\n\t\t\t\t\t<select name="list-select" class="list-select"></select>\n\t\t\t\t\t<div class="list-triangle"></div>\n\t\t\t\t\t<div class="action-icon hidden"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="separator mailchimp"></div>\n\n\t\t<div class="panel-section url collapsed">\n\t\t\t<div class="switcher-wrapper">\n\t\t\t\t<div class="switcher-caption">URL</div>\n\t\t\t\t<div class="switcher url" data-provider="url"></div>\n\t\t\t</div>\n\n\t\t\t<div class="collapsable">\n\t\t\t\t<div class="input-wrapper url">\n\t\t\t\t\t<input type="text" class="reach-input input-custom-url" placeholder="Enter URL" data-provider="url">\n\t\t\t\t\t<div class="action-icon hidden"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n';return __p},"template-constructor-control-form_endpoints-list-selector":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<option value="" disabled selected></option>\n\t',_.each(lists,(function(t){__p+='\n\t\t<option value="'+(null==(__t=t.id)?"":__t)+'" '+(null==(__t=t.id==selected?"selected":"")?"":__t)+">"+(null==(__t=t.name)?"":__t)+"</option>\n\t"})),__p+="\n";return __p}}},"u/SR":function(module,exports){module.exports={"template-constructor-control-shape_color":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Color" data-alt-pos="left" data-alt-offset="9"><div class="opacity-grid"></div><div class="color-circle"></div></div>\n\n\t<div class="panel">\n\t</div>\n\n';return __p}}},u1Rx:function(module,exports){module.exports={"template-constructor-helpers-colorbox":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="rmcolorbox '+(null==(__t=show_opacity?"":"without-opacity")?"":__t)+'" style="width:'+(null==(__t=width)?"":__t)+"px;height:"+(null==(__t=height)?"":__t)+'px;">\n\t\t<div class="rmcolorbox-color">\n\t\t\t<div class="rmcolorbox-map" style="left:'+(null==(__t=hue_width)?"":__t)+"px;width:"+(null==(__t=map_width)?"":__t)+"px;height:"+(null==(__t=map_height)?"":__t)+'px;">\n\t\t\t\t<canvas width="'+(null==(__t=map_width)?"":__t)+'" height="'+(null==(__t=map_height)?"":__t)+'"></canvas>\n\t\t\t\t<div class="rmcolorbox-map-handle"></div>\n\t\t\t</div>\n\t\t\t',"vertical"!=type&&(__p+='\n\t\t\t<div class="rmcolorbox-map-under-arrow" style="width:'+(null==(__t=hue_width)?"":__t)+"px;height:"+(null==(__t=map_height)?"":__t)+'px;">\n\t\t\t\t<canvas width="'+(null==(__t=hue_width)?"":__t)+'" height="'+(null==(__t=map_height)?"":__t)+'"></canvas>\n\t\t\t</div>\n\t\t\t'),__p+="\n\n\t\t\t","vertical"!=type&&(__p+='\n\t\t\t<div class="rmcolorbox-hue" style="height:'+(null==(__t=height)?"":__t)+"px;width:"+(null==(__t=hue_width||width)?"":__t)+'px;">\n\t\t\t\t<canvas class="rmcolorbox-hue-canvas1" width="'+(null==(__t=hue_width_opened-3)?"":__t)+'" height="'+(null==(__t=height)?"":__t)+'" style="height:'+(null==(__t=height)?"":__t)+"px;width:"+(null==(__t=hue_width-3)?"":__t)+'px;"></canvas>\n\t\t\t\t<canvas class="rmcolorbox-hue-canvas2" width="3" height="'+(null==(__t=height)?"":__t)+'"></canvas>\n\t\t\t</div>\n\t\t\t'),__p+='\n\n\t\t\t<div class="rmcolorbox-opacity">\n\t\t\t\t<div class="rmcolorbox-opacity-handle"><div class="rmcolorbox-opacity-val">&nbsp;</div></div>\n\t\t\t</div>\n\t\t</div>\n\n\n\t\t<div class="rmcolorbox-swatches hidden" style="width:'+(null==(__t=width)?"":__t)+"px;height:"+(null==(__t=height)?"":__t)+'px;">\n\t\t\t<div class="rmcolorbox-swatches-placeholdes-wrapper" style="width:'+(null==(__t=width)?"":__t)+"px;height:"+(null==(__t=placeholdes_height)?"":__t)+'px;">\n\t\t\t\t<div class="rmcolorbox-swatches-placeholdes" style="width:'+(null==(__t=width)?"":__t)+'px;"></div>\n\t\t\t\t<div class="rmcolorbox-swatches-colors" style="width:'+(null==(__t=width)?"":__t)+'px;"></div>\n\t\t\t\t<div class="rmcolorbox-swatches-scroll-handle"></div>\n\t\t\t</div>\n\t\t</div>\n\n\n\t\t<div class="rmcolorbox-rgb-block-wrapper">\n\t\t\t<div class="rmcolorbox-rgb-block input-style-1">\n\t\t\t\t',"vertical"!=type&&(__p+=" <span>#</span> "),__p+=' <input class="rmcolorbox-rgb-block-input color-input input-style-1"  spellcheck="false" maxlength="6" type="text"/>\n\t\t\t</div>\n\t\t</div>\n\t\t',"vertical"!=type&&(__p+='\n\t\t<div class="rmcolorbox-r-g-b-block-wrapper">\n\t\t\t<div class="rmcolorbox-r-g-b-block input-style-2">\n\t\t\t\t<span>R</span><input class="rmcolorbox-r-block-input color-input input-style-2"  spellcheck="false" data-param="r" maxlength="3" type="text"/><span>G</span><input class="rmcolorbox-g-block-input color-input input-style-2"  spellcheck="false" data-param="g" maxlength="3" type="text"/><span>B</span><input class="rmcolorbox-b-block-input color-input input-style-2"  spellcheck="false" data-param="b" maxlength="3" type="text"/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t'),__p+="\n\n\t\t","vertical"==type&&(__p+='\n\t\t<div class="rmcolorbox-hue" style="height:'+(null==(__t=hue_height)?"":__t)+'px; width: 100%;">\n\t\t\t<canvas class="rmcolorbox-hue-canvas1" width="'+(null==(__t=width)?"":__t)+'" height="'+(null==(__t=hue_height)?"":__t)+'" style="height:'+(null==(__t=hue_height)?"":__t)+'px;width:100%;"></canvas>\n\t\t\t<img src="https://cdn.readymag.com/6bfa1e36/dist/img/constructor/helpers/colorbox/selector.svg" class="hue-line"/>\n\t\t</div>\n\t\t'),__p+='\n\n\t\t<div class="rmcolorbox-color-input-blocker hidden" style="height:'+(null==(__t=bottom_panel_height)?"":__t)+'px;"></div>\n\t\t<div class="rmcolorbox-swatches-button" title="Swatches"></div>\n\t\t<div class="rmcolorbox-add-to-swatches-button" title="Add Color to Swatches"></div>\n\t\t<div class="rmcolorbox-remove-from-swatches-button hidden" title="Remove from Swatches"></div>\n\t\t<div class="rmcolorbox-animation-box hidden" style="width:'+(null==(__t=width)?"":__t)+"px;height:"+(null==(__t=height)?"":__t)+'px;">\n\t\t\t<canvas width="'+(null==(__t=width)?"":__t)+'" height="'+(null==(__t=height)?"":__t)+'"></canvas>\n\t\t</div>\n\t </div>\n\n';return __p}}},uGDn:function(t,e,i){"use strict";var s=i("xeF9"),o={model:{event:"stateChange"},props:{value:{},isDisabled:{type:Boolean,default:!1},width:{type:Number,default:37},height:{type:Number,default:20},shadow:{default:"none"},colorOn:{default:"#0074FF"},colorOff:{default:"rgba(26, 26, 26, 0.4)"},textOn:{default:""},textOff:{default:""},textSizeOn:{default:12},textSizeOff:{default:12},textColorOn:{default:"#fff"},textColorOff:{default:"#fff"},handleColor:{default:"#fff"},handleShadow:{default:"none"},handleSpace:{default:1},callback:{type:Function,default:function(){}}},data:function(){return{internalState:!1,bodyColorStyle:null,panelPosStyle:null,panelBackOpacity:null}},computed:{handleSize:function(){return this.height-2*this.handleSpace},bodyStyle:function(){return{width:this.width+"px",height:this.height+"px","box-shadow":this.shadow,"border-radius":Math.floor(this.height/2)+"px",opacity:this.isDisabled?.5:1,cursor:this.isDisabled?"default":"pointer"}},fullWidth:function(){return 2*(this.width-this.handleSize-this.handleSpace)+this.handleSize},textWidth:function(){return Math.round(.75*this.width-8-8)},shiftWidth:function(){return this.width-this.fullWidth},panelStyle:function(){return{width:this.fullWidth+"px",height:this.height+"px"}},textStyle:function(){return{width:this.textWidth+"px","line-height":this.height+"px"}},textOffStyle:function(){return{"font-size":this.textSizeOn+"px",color:this.textColorOn}},textOnStyle:function(){return{"font-size":this.textSizeOff+"px",color:this.textColorOff}},handleStyle:function(){return{"margin-left":"-"+Math.floor(this.handleSize/2)+"px",width:this.handleSize+"px",height:this.handleSize+"px","border-radius":Math.floor(this.handleSize/2)+"px","box-shadow":this.handleShadow,background:this.handleColor,top:this.handleSpace+"px"}}},watch:{internalState:function(t){clearInterval(this.timer),this.timer=setInterval(function(){this.oneStepSwitcherPos(t)}.bind(this),20),this.$emit("stateChange",t)},value:function(t){this.internalState=t}},created:function(){this.internalState=this.value},mounted:function(){this.updateSwitcher()},methods:{setSwitcherPos:function(t){this.cur_state=t,this.bodyColorStyle={"background-color":this.colorTransform(this.colorOn,this.colorOff,t)},this.panelPosStyle={left:Math.round(this.shiftWidth*t)+"px"},this.panelBackOpacityStyle={opacity:(1-t).toFixed(2)}},updateSwitcher:function(){this.setSwitcherPos(this.internalState?0:void 0===this.internalState?.5:1)},colorTransform:function(t,e,i){var o=Object(s.parseCSSColor)(t),n=Object(s.parseCSSColor)(e);return"rgba(".concat(Math.max(Math.min(parseInt(i*(n[0]-o[0])+o[0],10),255),0),",").concat(Math.max(Math.min(parseInt(i*(n[1]-o[1])+o[1],10),255),0),",").concat(Math.max(Math.min(parseInt(i*(n[2]-o[2])+o[2],10),255),0),",").concat(Math.max(Math.min(parseFloat(i*(n[3]-o[3])+o[3],10),1),0),")")},oneStepSwitcherPos:function(t){if(void 0===t)return clearInterval(this.timer),this.setSwitcherPos(.5);var e=t?0:1,i=e<this.internalState?-1:1,s=Math.max(Math.min(this.cur_state+.1*i,1),0);(i>0&&s>=e||i<0&&s<=e)&&(s=e,clearInterval(this.timer)),this.setSwitcherPos(s)},clickHanlder:function(){if(this.isDisabled)return!1;this.internalState=!this.internalState,this.callback(this.internalState)},disableFromOutside:function(){this.isDisabled=!0}}},n=(i("LSan"),i("KHd+")),a=Object(n.a)(o,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"rm-switcher",attrs:{"data-state":t.internalState?"on":"off"}},[i("div",{staticClass:"rmswitcher-body",style:[t.bodyStyle,t.bodyColorStyle]},[i("div",{ref:"panelBack",staticClass:"rmswitcher-panel-back"}),t._v(" "),i("div",{staticClass:"rmswitcher-panel",style:[t.panelStyle,t.panelPosStyle],on:{click:t.clickHanlder}},[i("div",{staticClass:"rmswitcher-panel-on",style:[t.textStyle,t.textOnStyle]},[t._v(t._s(t.textOff))]),t._v(" "),i("div",{staticClass:"rmswitcher-panel-off",style:[t.textStyle,t.textOffStyle]},[t._v(t._s(t.textOn))]),t._v(" "),i("div",{staticClass:"rmswitcher-panel-slider",style:t.handleStyle})])])])}),[],!1,null,null,null);e.a=a.exports},udqo:function(t,e,i){"use strict";var s=i("q1z7"),o=i.n(s),n=i("xi34"),a=i("rFsW"),r=i("OTSC"),l=i("gobI"),c=i("LaNJ"),h=i.n(c),d=o.a.View.extend({initialize:function(t){a.a.bindAll(this),a.a.extend(this,t)},render:function(){if(this.picture){this.removing=!1,Object(n.a)("body").addClass("picture-preview-loading"),this.originalRect=this.getRect(this.$el[0]),this.orientation=this.getOrientation(),this.originalStyle=this.getOriginalStyle();var t=h.a["template-picture-preview-box"];return this.$preview=Object(n.a)(t({overlayColor:this.overlayColor,previewSrc:this.getPreviewSrc(),originalStyle:this.originalStyle})),this.$container.append(this.$preview),Object(n.a)(window).on("scroll",this.onScroll),Object(n.a)("body").on("keypress keyup keydown",this.onKeyPress),setTimeout(this.setVisible,100),this.$preview}},imagePreload:function(){var t=this;if(!this.removing&&this.picture){var e=this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl||this.picture.final3xUrl||this.picture.final2xUrl||this.picture.finalUrl;this.getPreviewSrc()!==e?(this.img=new Image,this.img.onload=function(){Object(n.a)("body").removeClass("picture-preview-loading"),t.$preview&&setTimeout((function(){t.removing||t.$preview.find(".picture-preview-box .picture-preview-box-image").attr("src",t.img.src).removeAttr("srcset")}),100)},this.img.src=e):Object(n.a)("body").removeClass("picture-preview-loading")}},remove:function(t){var e=this;if(this.removing=!0,Object(n.a)("body").removeClass("picture-preview-loading"),Object(n.a)("body").off("keypress keyup keydown",this.onKeyPress),Object(n.a)(window).off("scroll",this.onScroll),this.img&&(this.img.src="",delete this.img),this.$preview){var i=this.$preview.find(".picture-preview-box");i.removeClass("visible loaded").removeClass(this.orientation),r.b.waitForTransitionEnd(i.find(".picture-preview-box-overlay"),300,"opacity",(function(){e.$preview&&e.$preview.remove(),delete e.$preview})),t&&t()}},changeColor:function(t){this.$preview&&this.$preview.find(".picture-preview-box-overlay").css("background-color",t)},onScroll:function(){this.remove()},setVisible:function(){var t=this;if(!this.removing){var e=this.$preview.find(".picture-preview-box img")[0],i=function i(){e.removeEventListener("load",i),t.$preview.find(".picture-preview-box").addClass("visible").addClass(t.orientation),r.b.waitForTransitionEnd(t.$preview.find(".picture-preview-box .picture-preview-box-overlay"),300,"opacity",t.imagePreload)};setTimeout((function(){e.complete?i():e.addEventListener("load",i)}),100)}},getPreviewSrc:function(){var t=this.$el.find("img")[0];return t&&(t.currentSrc||t.src)||this.picture&&(this.picture.unscaledOptimizedUrl||this.picture.final3xUrl||this.picture.final2xUrl||this.picture.finalUrl)},getOriginalStyle:function(){if(!this.originalRect)return{};var t=this.getScale(),e={top:Number(this.originalRect.top+.5*this.originalRect.height)*t+"px",left:Number(this.originalRect.left+.5*this.originalRect.width)*t+"px"};return"portrait"===this.orientation?e.height=this.originalRect.height*t+"px":"landscape"===this.orientation&&(e.width=this.originalRect.width*t+"px"),e},getOrientation:function(){var t=this.originalRect.height/this.originalRect.width,e=Object(n.a)(window).width();return Object(n.a)(window).height()/t<e?"portrait":"landscape"},bindClick:function(){var t=this;this.$preview&&this.$preview.on("click",(function(){t.remove()}))},onKeyPress:function(t){27===t.keyCode&&this.remove()},getScale:function(){return l.a.isAllowed()&&l.a.isZoom()&&l.a.isOn()?l.a.getRatio():1},getRect:function(t){var e=a.a.extend({},t.getBoundingClientRect());if(Modernizr.safari){var i=this.getScale();e.top=e.top+(Object(n.a)(window).scrollTop()-Object(n.a)(window).scrollTop()/i)}return e}});e.a=d},v92f:function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var s,o,n=i("rFsW"),a=i("OTSC");function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.Default="default",t.TabletPortrait="tablet_portrait",t.PhonePortrait="phone_portrait"}(o||(o={}));var l=[{name:o.Default,width:1024,min_height:672,max_height:201600,caption:"Laptop & Tablet Landscape",shortcut:"1"},{name:o.TabletPortrait,width:768,min_height:926,max_height:201600,caption:"Tablet Portrait",shortcut:"2",deprecated:!0},{name:o.PhonePortrait,width:320,min_height:568,max_height:201600,caption:"Phone Portrait",shortcut:"3"}],c=["x","y","w","h","z","hidden","angle","flip_h","flip_v","pack_id","fixed_position","is_full_width","is_full_height","sticked","sticked_margin","animation"],h=(r(s={background:n.a.union(["color","opacity","selectedType","picture","slideshow"],c),picture:n.a.union(["picture","cropW","cropH","cropX","cropY","originalW","originalH","ratio","scale","pic_opacity","pic_color","border_size","border_color","border_radius","border_radius_max","opacity","anchor_link_pos","preview_overlay_color"],c),slideshow:n.a.union(["images_h","captions_h","play_method"],c),text:n.a.union(["column_count","column_gap","bg_color","bg_opacity"],c),textReact:n.a.union(["styles"],c),shape:n.a.union(["rasterUrl","raster2xUrl","borders","weight","anchor_link_pos","bg_color"],c),button:n.a.union(["text_w","text_h","em_w","anchor_link_pos","font-size","font-style","font-weight","font-family","color","color-opacity","letter-spacing","hover-color","hover-color-opacity","current-font-size","current-font-style","current-font-weight","current-font-family","current-color","current-color-opacity","current-letter-spacing","background-color","background-color-opacity","hover-background-color","hover-background-color-opacity","current-background-color","current-background-color-opacity","border-radius","border-width","border-color","border-color-opacity","hover-border-width","hover-border-color","hover-border-color-opacity","current-border-radius","current-border-width","current-border-color","current-border-color-opacity"],c),hotspot:n.a.union(["borders","weight","anchor_link_pos"],c),form:n.a.union(["layout","style","style-colored-button-default","style-colored-button-hover","style-colored-fields","style-outlined-button-default","style-outlined-button-hover","style-outlined-fields","style-underlined-button-default","style-underlined-button-hover","style-underlined-fields"],c)},a.a.ecommerceCartBlockName,n.a.union(["text_w","text_h","em_w","background-color","background-color-opacity","border-radius","border-width","border-color","border-color-opacity","font-family","font-style","font-weight","color","color-opacity","font-size","letter-spacing","hover-background-color","hover-background-color-opacity","hover-border-width","hover-border-color","hover-border-color-opacity","hover-color","hover-color-opacity","hover-border-radius","hover-tansition-duration"],c)),r(s,a.a.addToCartBlockName,n.a.union(["layout","btn_w","btn_h","text_w","text_h","select_btn_margin","attributes_margin","background-color","background-color-opacity","border-radius","border-width","border-color","border-color-opacity","font-family","font-style","font-weight","font-size","color","color-opacity","letter-spacing","text-align","hover-tansition-duration","hover-background-color","hover-background-color-opacity","hover-border-radius","hover-border-width","hover-border-color","hover-border-color-opacity","hover-color","hover-color-opacity","attrs-background-color","attrs-background-color-opacity","attrs-border-radius","attrs-border-width","attrs-border-color","attrs-border-color-opacity","attrs-font-family","attrs-font-style","attrs-font-weight","attrs-font-size","attrs-color","attrs-color-opacity","attrs-letter-spacing","attrs-text-align","attrs-hover-background-color","attrs-hover-background-color-opacity","attrs-hover-border-radius","attrs-hover-border-width","attrs-hover-border-color","attrs-hover-border-color-opacity","attrs-hover-color","attrs-hover-color-opacity","attrs-icon-h","attrs-icon-w","attrs-text_w","attrs-text_h"],c)),s),d=n.a.map(l,(function(t){return"viewport_"+t.name})),p=n.a.without(d,"viewport_default");e.b={viewports:l,viewport_fields_common:c,viewport_fields:h,viewport_listall:d,viewport_list:p,widgetViewportFields:function(t){return h[t]||c}}},vIxw:function(t,e,i){"use strict";var s=i("rFsW"),o=i("OTSC"),n=i("WoDZ"),a={model:{event:"change:url",prop:"url"},props:{url:String,highlightOnError:Boolean,showSocial:!0,isVideoProcessed:!1,placeholder:{type:String,default:"Type or paste URL"}},data:function(){return{isError:!1}},computed:{searchUrl:{get:function(){return this.url},set:function(t){this.$emit("change:url",t)}},showIcon:function(){return Boolean(this.url)},isRemove:function(){return this.isVideoProcessed||this.isError},isUpload:function(){return this.isURL(this.url)&&!this.isVideoProcessed},highlightInput:function(){return this.highlightOnError&&this.isError}},methods:{onIconClick:function(t){this.isRemove?(this.$emit("change:url",null),this.$emit("remove")):this.processInputVideo()},onEnter:function(){this.processInputVideo()},processInputVideo:function(){this.url&&(this.isURL(this.url)?this.getVideoFromUrl(this.url):RM.views.searchYouTube&&RM.views.searchYouTube.show(this.url,{choose:this.uploadVideoFromSearch}))},parseStartTime:function(t){var e,i,n=0;return(e=o.b.queryUrlGetParam("t",t))?(i=e.match(/(\d+)(m?)(\d*)(s?)/),s.a.isEmpty(i)||!parseInt(i[1],10)?null:("m"===i[2].toLowerCase()?n+=60*parseInt(i[1],10):n+=parseInt(i[1],10),parseInt(i[3],10)&&(n+=parseInt(i[3],10)),n)):null},getVideoFromUrl:function(t){var e,i,o,a=t;if(i=n.a.isVimeo(a),!(e=n.a.isYoutube(a))&&!i)return this.$emit("wrongUrl"),this.isError=!0,void(this.highlightremovalTimeout=setTimeout(function(){this.isError=!1}.bind(this),200));o=this.parseStartTime(a);var r={url:a=a.replace(/\/?#?$/,""),provider_name:n.a.getVideoProvider(a)};o&&(r.start_time=o),e&&(r.video_id=n.a.getYoutubeIdFromUrl(a)),this.videoEmbedXHR&&this.videoEmbedXHR.abort(),this.videoEmbedXHR=n.a.getEmbedData(a,s.a.bind((function(t){this.url=t.url?t.url:this.url,n.a.getHighResVideoThumbnail({provider:r.provider_name,thumbnail_url:t.thumbnail_url}).then(s.a.bind((function(e){t.thumbnail_url=e,this.$emit("loaded",s.a.extend(t,r))}),this))}),this),s.a.bind((function(t,e,i){this.$emit("error",t,e,i)}),this)),this.$emit("dataObtained",r)},isURL:function(t){return/^http(s?):\/\//i.test(t)},onYoutubeClick:function(){RM.views.searchYouTube&&RM.views.searchYouTube.show("",{choose:this.uploadVideoFromSearch})},onVimeoClick:function(){RM.views.searchVimeo&&RM.views.searchVimeo.show("",{choose:this.uploadVideoFromSearch})},uploadVideoFromSearch:function(t){this.getVideoFromUrl(t)}}},r=(i("oR3H"),i("KHd+")),l=Object(r.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"video-panel-search"},[i("div",{staticClass:"video-panel-input-wrapper"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.searchUrl,expression:"searchUrl"}],class:{"video-panel-input":!0,"has-icon":t.showIcon},attrs:{type:"text",spellcheck:"false",placeholder:t.placeholder},domProps:{value:t.searchUrl},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onEnter(e)},input:function(e){e.target.composing||(t.searchUrl=e.target.value)}}}),t._v(" "),t.showIcon?i("div",{staticClass:"video-panel-icon input-icon",class:{"is-remove":t.isRemove,"is-upload":t.isUpload},on:{click:t.onIconClick}}):t._e(),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.highlightInput?i("div",{staticClass:"video-panel-error"}):t._e()])],1),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.showSocial?i("div",{staticClass:"video-panel-social"},[i("div",{staticClass:"video-panel-social-icon video-panel-social-youtube",attrs:{title:"Youtube"},on:{click:t.onYoutubeClick}}),t._v(" "),i("div",{staticClass:"video-panel-social-icon video-panel-social-vimeo",attrs:{title:"Vimeo"},on:{click:t.onVimeoClick}})]):t._e()])],1)}),[],!1,null,null,null);e.a=l.exports},vetb:function(module,exports){module.exports={"template-constructor-control-anchor_picker":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="anchor-picker-wrapper">\n\t\t<div class="anchor-picker">\n\t\t\t<div class="popup">\n\t\t\t\t<span>Click</span>\n\t\t\t\t<div class="corner-wrapper"><div class="corner"></div></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n';return __p}}},voD7:function(module,exports){module.exports={"template-constructor-control-shape_icon":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Icon" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t\t<div class="search-block">\n\t\t\t<input class="search" type="text" placeholder="Search">\n\t\t\t<div class="loupe">\n\t\t\t\t<div class="rmpreloader hidden"><div class="arc"></div></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="separator"></div>\n\n\t\t<div class="common-wrapper">\n\t\t\t<div class="resizable-scroll-wrapper">\n\t\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t\t<div class="resizable-content">\n\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="resizable-scroll"></div>\n\t\t\t</div>\n\n\t\t</div>\n\n\n\n\t\t<div class="resize-handle-top"></div>\n\t\t<div class="resize-handle-bottom"></div>\n\t</div>\n';return __p},"template-constructor-control-shape_icon-item":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon-item">\n\t\t<div class="noun-icon" style="background-image: url('+(null==(__t=icon.preview_url_42)?"":__t)+');" '+(null==(__t=icon.id?'data-id="'+icon.id+'"':'data-rm_id="'+icon.rm_id+'"')?"":__t)+' data-url="'+(null==(__t=icon.icon_url)?"":__t)+'">\n\t</div>\n';return __p}}},w4Sg:function(module,exports){module.exports={"template-constructor-block-gmaps":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <div class="rm-search-block">\n        <div class="map-container"></div>\n        <div class="map-overlay"></div>\n        <div class="message-overlay invisible"></div>\n    </div>\n    <div class="rm-gmaps-key hidden">\n        <div class="key-wrapper">\n            <div>\n                <div class="key-legend">To use Google Maps widget you need a Google Maps API key. Learn how to get an API key <a href="http://help.readymag.com/hc/en-us/articles/360020526932-Google-Maps" rel="noreferrer noopener" target="_blank">here</a>.</div>\n                <div class="key-input-wrap">\n                    <input type="text" class="key-input" placeholder="Paste Google Maps API Key here" required minlength="39" maxlength="39">\n                    <button>Apply</button>\n                </div>\n            </div>\n        </div>\n    </div>\n';return __p},"template-constructor-block-gmaps-search-control":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <div class="rm-search-block">\n        <input type="text" class="rm-search source">\n        <input type="text" class="rm-search destination">;\n    </div>\n';return __p}}},wAEK:function(module,exports){module.exports={"template-export-pdf-typekit-substitution-news-gothic":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n<style id="export-pdf-typekit-substitution">\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/News Gothic Bold Italic/c6f4e54e-1d69-4559-b813-e2fc4ff29160-3.woff") format("woff"),\n\t\t url("/fonts/webtype/News Gothic Bold Italic/c6f4e54e-1d69-4559-b813-e2fc4ff29160-4.svg#web") format("svg");\n\tfont-style: italic;\n\tfont-weight: 700;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/News Gothic Bold/9aab62b7-bc6f-405a-ad75-227bcf89d9dc-3.woff") format("woff"),\n\t\t url("/fonts/webtype/News Gothic Bold/9aab62b7-bc6f-405a-ad75-227bcf89d9dc-4.svg#web") format("svg");\n\tfont-style: normal;\n\tfont-weight: 700;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/News Gothic Italic/6327ba72-bfd5-4038-9658-e3a4a95a5c98-3.woff") format("woff"),\n\t\t url("/fonts/webtype/News Gothic Italic/6327ba72-bfd5-4038-9658-e3a4a95a5c98-4.svg#web") format("svg");\n\tfont-style: italic;\n\tfont-weight: 400;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/News Gothic/915b0ec4-cd16-40de-883e-1d77c3d07840-3.woff") format("woff"),\n\t\t url("/fonts/webtype/News Gothic/915b0ec4-cd16-40de-883e-1d77c3d07840-4.svg#web") format("svg");\n\tfont-style: normal;\n\tfont-weight: 400;\n}\n</style>\n';return __p},"template-export-pdf-typekit-substitution-georgia-pro":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n<style id="export-pdf-typekit-substitution">\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Georgia Pro Black/4ec59c91-f66b-4751-8456-e114e9e14673-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Georgia Pro Black/4ec59c91-f66b-4751-8456-e114e9e14673-4.svg#web") format("svg");\n\tfont-style: normal;\n\tfont-weight: 900;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Georgia Pro Bold Italic/6f283590-c3c2-416a-95c2-ca67d04aa929-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Georgia Pro Bold Italic/6f283590-c3c2-416a-95c2-ca67d04aa929-4.svg#web") format("svg");\n\tfont-style: italic;\n\tfont-weight: 700;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Georgia Pro Bold/6f633c58-c751-4d08-9cea-2b27f74f37de-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Georgia Pro Bold/6f633c58-c751-4d08-9cea-2b27f74f37de-4.svg#web") format("svg");\n\tfont-style: normal;\n\tfont-weight: 700;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Georgia Pro Italic/e3bc0ad4-bdaa-4467-82a0-d90f697b7266-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Georgia Pro Italic/e3bc0ad4-bdaa-4467-82a0-d90f697b7266-4.svg#web") format("svg");\n\tfont-style: italic;\n\tfont-weight: 400;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Georgia Pro SemiBold Italic/0e025df5-ba54-4bbb-84b4-c5b337a5b55b-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Georgia Pro SemiBold Italic/0e025df5-ba54-4bbb-84b4-c5b337a5b55b-4.svg#web") format("svg");\n\tfont-style: italic;\n\tfont-weight: 600;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Georgia Pro SemiBold/60fe12ce-0223-4a9a-8e5c-b3e7bd381bc4-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Georgia Pro SemiBold/60fe12ce-0223-4a9a-8e5c-b3e7bd381bc4-4.svg#web") format("svg");\n\tfont-style: normal;\n\tfont-weight: 600;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Georgia Pro/b97bef32-c0cb-4ad3-b724-1204d229731c-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Georgia Pro/b97bef32-c0cb-4ad3-b724-1204d229731c-4.svg#web") format("svg");\n\tfont-style: normal;\n\tfont-weight: 400;\n}\n</style>\n';return __p},"template-export-pdf-typekit-substitution-nitti":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n<style id="export-pdf-typekit-substitution">\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Nitti Light Italic/15aba0ec-4ceb-49e2-985c-a95134a60aed-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Nitti Light Italic/15aba0ec-4ceb-49e2-985c-a95134a60aed-4.svg#web") format("svg");\n\tfont-style: italic;\n\tfont-weight: 300;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Nitti Light/6fd7c5e9-3131-4cb6-a99e-da74343b1253-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Nitti Light/6fd7c5e9-3131-4cb6-a99e-da74343b1253-4.svg#web") format("svg");\n\tfont-style: normal;\n\tfont-weight: 300;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Nitti Medium/9054f262-2d2d-480f-9360-4560f110243b-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Nitti Medium/9054f262-2d2d-480f-9360-4560f110243b-4.svg#web") format("svg");\n\tfont-style: normal;\n\tfont-weight: 500;\n}\n</style>\n';return __p}}},wHgl:function(module,exports){module.exports={"template-constructor-helpers-animation_steps_add_button":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="add-button skip-rotate" title="Add Step">\n\t\t<div class="rhomb"></div>\n\n\t\t<div class="effect-popup js-steps-popup">\n\t\t\t<div class="effect-popup-caption">Add Step</div>\n\t\t\t<div class="effect-popup-item" data-value="use_move">Move</div>\n\t\t\t<div class="effect-popup-item" data-value="use_opacity">Opacity</div>\n\t\t\t<div class="effect-popup-item" data-value="use_rotate">Rotate</div>\n\t\t\t<div class="effect-popup-item" data-value="use_scale">Scale</div>\n\t\t\t<div class="corner-wrapper"><div class="corner"></div></div>\n\t\t</div>\n\t</div>\n\n';return __p}}},wrlV:function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"a",(function(){return n}));var s=function(t){if(t){return{"image/jpeg":"jpg","image/png":"png","image/bmp":"bmp","image/gif":"gif","image/svg+xml":"svg"}[t.toLowerCase()]}},o=function(t){return new Promise((function(e,i){var s=new Image;s.onload=function(){s.width&&s.height||i("Unable to get image dimensions");var t={width:s.width,height:s.height};s.remove(),e(t)},s.onerror=function(t){return i(t)},s.src=t}))},n=function(t){return new Promise((function(e,i){(function(t){return t?new Promise((function(e,i){try{var s=new FileReader;s.onloadend=function(){return e(s.result)},s.onerror=function(t){return i(t)},s.readAsDataURL(t)}catch(t){i(t)}})):Promise.reject("No file data")})(t).then((function(n){o(n).then((function(i){var o={width:i.width,height:i.height,type:t.type,size:t.size,ext:s(t.type),content:n};e(o)})).catch((function(t){return i(t)}))}))}))}},wxrA:function(module,exports){module.exports={"template-constructor-block-facebook-type_like_button":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="fb-like fb" data-href="'+(null==(__t=data.url?data.url:"http://readymag.com")?"":_.escape(__t))+'" '+(null==(__t=data.share_button||data.send_button?'data-share="true"':"")?"":__t)+' data-width="'+(null==(__t=data.w)?"":__t)+'" data-show-faces="'+(null==(__t=data.show_faces)?"":__t)+'" data-colorscheme="'+(null==(__t=data.theme)?"":__t)+'" data-layout="'+(null==(__t=data.layout)?"":__t)+'" data-type="data.type_like_button"></div>\n\t<div class="overlay"></div>\n';return __p},"template-constructor-block-facebook-type_page":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="fb-page fb" data-href="'+(null==(__t=data.url?data.url:"https://www.facebook.com/readymag")?"":_.escape(__t))+'" data-width="'+(null==(__t=data.w)?"":__t)+'" data-height="'+(null==(__t=data.h)?"":__t)+'" data-show-facepile="'+(null==(__t=data.show_faces)?"":__t)+'" data-colorscheme="'+(null==(__t=data.theme)?"":__t)+'" data-tabs="'+(null==(__t=data.show_stream?"timeline, events, messages":"")?"":__t)+'" data-show-border="true" data-small-header="'+(null==(__t=data.small_header)?"":__t)+'" data-adapt-container-width="true"></div>\n\t<div class="overlay"></div>\n';return __p},"template-constructor-block-facebook-type_comments":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="fb-comments fb" data-href="'+(null==(__t=data.url?data.url:"http://readymag.com")?"":_.escape(__t))+'" data-width="'+(null==(__t=data.w)?"":__t)+'" data-num-posts="'+(null==(__t=data.num_posts)?"":__t)+'" data-colorscheme="'+(null==(__t=data.theme)?"":__t)+'"></div>\n\t<div class="overlay"></div>\n';return __p}}},xka6:function(module,exports){module.exports={"template-constructor-control-form_content":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Fields" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="form-fields-panel panel js-panel">\n\t\t<div class="form-fields-header">Fields</div>\n\n\t\t<div class="form-fields-wrapper">\n\t\t\t<div class="resizable-scroll-wrapper">\n\t\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t\t<div class="resizable-content js-fields-container"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="resizable-scroll"></div>\n\t\t\t</div>\n\t\t\t<div class="js-settings-popup-container"></div>\n\t\t</div>\n\n\t\t<div class="form-fields-footer js-add-block">\n\t\t\t<div class="js-new-settings-container"></div>\n\t\t\t<div class="form-fields-add js-add" title="Add field"></div>\n\t\t</div>\n\n\t\t<div class="js-dropdown-panel-container"></div>\n\n\t\t<div class="resize-handle-top"></div>\n\t\t<div class="resize-handle-bottom"></div>\n\t</div>\n';return __p},"template-constructor-control-form_content-field":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="form-fields-item js-field form-fields-item-'+(null==(__t=tp)?"":__t)+" "+(null==(__t=isSortable?"js-sortable":"js-not-sortable")?"":__t)+'"\n\t     data-id="'+(null==(__t=id)?"":__t)+'" data-type="'+(null==(__t=tp)?"":__t)+'">\n\t\t',"dropdown"===tp?__p+='\n\t\t\t<div class="form-fields-caption-dropdown-helper">\n\t\t\t\t<div class="form-fields-caption-dropdown-mask js-dropdown-trigger"></div>\n\t\t\t\t<input type="text" name="" value="'+(null==(__t=text)?"":__t)+'" placeholder="'+(null==(__t=placeholder)?"":__t)+'" autocomplete="off" readonly="readonly"\n\t\t\t\t       class="form-fields-caption form-fields-caption-'+(null==(__t=tp)?"":__t)+" js-field-caption js-field-caption-"+(null==(__t=tp)?"":__t)+'"/>\n\t\t\t</div>\n\t\t':__p+='\n\t\t\t<input type="text" name="" value="'+(null==(__t=text)?"":__t)+'" placeholder="'+(null==(__t=placeholder)?"":__t)+'" autocomplete="off"\n\t\t\t\t       class="form-fields-caption form-fields-caption-'+(null==(__t=tp)?"":__t)+" "+(null==(__t=mode)?"":__t)+" js-field-caption js-field-caption-"+(null==(__t=tp)?"":__t)+'"/>\n\t\t',__p+="\n\t\t",showSettings&&(__p+='\n\t\t\t<div class="form-fields-type-token js-settings-trigger">'+(null==(__t=typeLetter)?"":__t)+"</div>\n\t\t"),__p+="\n\t\t",showDelete&&(__p+='\n\t\t\t<div class="form-fields-delete js-delete-field"></div>\n\t\t'),__p+="\n\t\t",showSubmitAfterArrow&&(__p+='\n\t\t\t<div class="form-fields-placeholder-selector '+(null==(__t=showRemoveArrow?"action-icon remove-icon":"js-submit-dropdown-trigger")?"":__t)+'">\n\t\t\t\t<div class="form-fields-placeholder-arrow"></div>\n\t\t\t</div>\n\t\t'),__p+="\n\t</div>\n";return __p},"template-constructor-control-form_content-settings":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="settings-popup transition-enable js-settings-popup '+(null==(__t=edit?"settings-popup-edit js-edit-settings":"settings-popup-add js-add-settings")?"":__t)+'" data-id="'+(null==(__t=id)?"":__t)+'">\n\t\t<div class="settings-popup-types">\n\t\t\t',_.each(types,(function(t,e){__p+='\n\t\t\t\t<div class="settings-popup-type js-field-type '+(null==(__t=e===selectedType?"selected":"")?"":__t)+'" data-value="'+(null==(__t=e)?"":__t)+'" data-action="'+(null==(__t=edit?"edit":"add")?"":__t)+'">\n\t\t\t\t\t'+(null==(__t=t)?"":__t)+"\n\t\t\t\t</div>\n\t\t\t"})),__p+="\n\t\t</div>\n\t\t",showOptionalSwitcher&&(__p+='\n\t\t\t<div class="settings-popup-optional">\n\t\t\t\t<div class="switcher-wrapper settings-popup-optional-switcher">\n\t\t\t\t\t<div class="switcher-caption settings-popup-optional-caption">Optional Field</div>\n\t\t\t\t\t<div class="switcher settings-popup-optional-value" data-type="optional"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'),__p+='\n\t\t<div class="corner-wrapper">\n\t\t\t<div class="corner"></div>\n\t\t</div>\n\t</div>\n';return __p},"template-constructor-control-form_content-after-submit":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="submit-wrapper settings-popup js-settings-popup">\n\t\t<div class="settings-popup-types">\n\t\t\t',_.each(types,(function(t,e){__p+='\n\t\t\t\t<div class="settings-popup-type js-submit-field-type '+(null==(__t=e===selectedType?"selected":"")?"":__t)+'" data-value="'+(null==(__t=e)?"":__t)+'" >\n\t\t\t\t\t'+(null==(__t=t)?"":__t)+"\n\t\t\t\t</div>\n\t\t\t"})),__p+='\n\t\t</div>\n\n\t\t<div class="resizable-scroll-wrapper">\n\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t<div class="resizable-content">\n\t\t\t\t\t<div class="styles-wrapper"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="resizable-scroll"></div>\n\t\t</div>\n\t</div>\n';return __p},"template-constructor-control-form_content-dropdown":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="dropdown-panel js-dropdown-panel">\n\t\t<div class="dropdown-content">\n\t\t\t<div class="dropdown-header form-fields-header js-dropdown-caption-container"></div>\n\n\t\t\t<div class="dropdown-wrapper">\n\t\t\t\t<div class="resizable-scroll-wrapper">\n\t\t\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t\t\t<div class="resizable-content js-dropdown-content">\n\t\t\t\t\t\t\t<div class="dropdown-options js-dropdown-options-container"></div>\n\t\t\t\t\t\t\t<div class="dropdown-add dropdown-option form-fields-item js-add-option">+ Add</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="resizable-scroll"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="dropdown-footer form-fields-footer">\n\t\t\t\t<div class="dropdown-save js-save-dropdown">Save</div>\n\t\t\t\t<div class="dropdown-cancel js-cancel-dropdown"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n';return __p},"template-constructor-control-form_content-dropdown-caption":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<input type="text" name="" value="'+(null==(__t=text)?"":__t)+'" placeholder="'+(null==(__t=placeholder)?"":__t)+'" autocomplete="off"\n\t\t\t\t\t\t       class="dropdown-caption-value form-fields-caption js-dropdown-caption"/>\n';return __p},"template-constructor-control-form_content-dropdown-option":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="form-fields-item dropdown-option js-dropdown-option js-sortable" data-value="'+(null==(__t=text)?"":__t)+'" data-number="'+(null==(__t=number)?"":__t)+'">\n\t\t<input type="text" name="" value="'+(null==(__t=text)?"":__t)+'" placeholder="'+(null==(__t=placeholder)?"":__t)+'" autocomplete="off" data-number="'+(null==(__t=number)?"":__t)+'"\n\t\t       class="dropdown-option-value form-fields-caption js-dropdown-option-value"/>\n\t\t<div class="dropdown-number form-fields-type-token">'+(null==(__t=number)?"":__t)+"</div>\n\t\t",showDelete&&(__p+='\n\t\t\t<div class="dropdown-option-delete form-fields-delete js-delete-option"></div>\n\t\t'),__p+="\n\t</div>\n";return __p}}},yWjQ:function(module,exports){module.exports={"template-common-slideshow-player":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="common-slideshow environment-'+(null==(__t=tp)?"":_.escape(__t))+'">\n\t\t<div class="images no-rmswipe">\n\t\t\t<div class="images-wrapper">\n\t\t\t</div>\n\t\t\t<div class="fullscreen">\n\t\t\t\t<svg class="fullscreen-off" width="17px" height="17px" viewBox="0 0 17 17" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n\t\t\t\t\t<g id="Page-1" stroke="none" stroke-width="0.1" fill="none" fill-rule="evenodd">\n\t\t\t\t\t\t<g id="full-screen" transform="translate(-12.000000, -12.000000)" fill="#F4F4F4" fill-rule="nonzero">\n\t\t\t\t\t\t\t<g id="Arrows" transform="translate(12.000000, 12.000000)">\n\t\t\t\t\t\t\t\t<path d="M12.7571068,4.74264069 L10.2571068,7.24264069 C9.86658249,7.63316498 9.23341751,7.63316498 8.84289322,7.24264069 C8.45236893,6.8521164 8.45236893,6.21895142 8.84289322,5.82842712 L11.3428932,3.32842712 L9.72157288,1.70710678 C9.33104858,1.31658249 9.33104858,0.683417511 9.72157288,0.292893219 C9.90910925,0.10535684 10.1634632,-2.93098879e-14 10.4286797,-2.93098879e-14 L15.0144661,-2.93098879e-14 C15.5667508,-2.93098879e-14 16.0144661,0.44771525 16.0144661,1 L16.0144661,5.58578644 C16.0144661,6.13807119 15.5667508,6.58578644 15.0144661,6.58578644 C14.7492496,6.58578644 14.4948957,6.4804296 14.3073593,6.29289322 L12.7571068,4.74264069 Z" id="Combined-Shape"></path>\n\t\t\t\t\t\t\t\t<path d="M4.20710669,13.2426408 L1.70710669,15.7426408 C1.3165824,16.1331651 0.683417421,16.1331651 0.292893129,15.7426408 C-0.097631163,15.3521165 -0.097631163,14.7189515 0.292893129,14.3284272 L2.79289313,11.8284272 L1.17157279,10.2071069 C0.781048494,9.81658256 0.781048494,9.18341758 1.17157279,8.79289329 C1.35910916,8.60535691 1.61346308,8.50000007 1.87867957,8.50000007 L6.464466,8.50000007 C7.01675075,8.50000007 7.464466,8.94771532 7.464466,9.50000007 L7.464466,14.0857865 C7.464466,14.6380713 7.01675075,15.0857865 6.464466,15.0857865 C6.19924951,15.0857865 5.9448956,14.9804297 5.75735922,14.7928933 L4.20710669,13.2426408 Z" id="Combined-Shape" transform="translate(3.732233, 12.267767) rotate(180.000000) translate(-3.732233, -12.267767) "></path>\n\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t</g>\n\t\t\t\t\t</g>\n\t\t\t\t</svg>\n\t\t\t\t<svg class="fullscreen-on" width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n\t\t\t\t\t<g id="Page-1" stroke="none" stroke-width="0.1" fill="none" fill-rule="evenodd">\n\t\t\t\t\t\t<g id="full-screen" transform="translate(-11.000000, -11.000000)" fill="#F4F4F4" fill-rule="nonzero">\n\t\t\t\t\t\t\t<g id="Arrows" transform="translate(11.000000, 11.000000)">\n\t\t\t\t\t\t\t\t<path d="M14.2071067,5.24264078 L11.7071067,7.74264078 C11.3165824,8.13316507 10.6834174,8.13316507 10.2928931,7.74264078 C9.90236883,7.35211649 9.90236883,6.71895151 10.2928931,6.32842721 L12.7928931,3.82842721 L11.1715728,2.20710687 C10.7810485,1.81658258 10.7810485,1.1834176 11.1715728,0.792893312 C11.3591092,0.605356933 11.6134631,0.500000093 11.8786796,0.500000093 L16.464466,0.500000093 C17.0167507,0.500000093 17.464466,0.947715343 17.464466,1.50000009 L17.464466,6.08578653 C17.464466,6.63807128 17.0167507,7.08578653 16.464466,7.08578653 C16.1992495,7.08578653 15.9448956,6.98042969 15.7573592,6.79289331 L14.2071067,5.24264078 Z" id="Combined-Shape" transform="translate(13.732233, 4.267767) rotate(180.000000) translate(-13.732233, -4.267767) "></path>\n\t\t\t\t\t\t\t\t<path d="M4.70710678,14.7426407 L2.20710678,17.2426407 C1.81658249,17.633165 1.18341751,17.633165 0.792893219,17.2426407 C0.402368927,16.8521164 0.402368927,16.2189514 0.792893219,15.8284271 L3.29289322,13.3284271 L1.67157288,11.7071068 C1.28104858,11.3165825 1.28104858,10.6834175 1.67157288,10.2928932 C1.85910925,10.1053568 2.11346317,10 2.37867966,10 L6.96446609,10 C7.51675084,10 7.96446609,10.4477153 7.96446609,11 L7.96446609,15.5857864 C7.96446609,16.1380712 7.51675084,16.5857864 6.96446609,16.5857864 C6.6992496,16.5857864 6.44489569,16.4804296 6.25735931,16.2928932 L4.70710678,14.7426407 Z" id="Combined-Shape"></path>\n\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t</g>\n\t\t\t\t\t</g>\n\t\t\t\t</svg>\n\t\t\t</div>\n\n\t\t\t<div class="bottom-arrows">\n\t\t\t\t\t<div class="prev-picture-arrow-bottom arrow-bottom">\n\t\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40">\n\t\t\t\t\t\t\t<path d="M23.5 11.5 L15.5 19.5 L23.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="counters-container">\n\t\t\t\t\t\t<div class="counters-numbers">\n\t\t\t\t\t\t\t<span class="counters-text-current">1</span>/<span class="counters-text-total">2</span>\n\t\t\t\t\t\t</div>\n\t\t\n\t\t\t\t\t\t<div class="counters-dots no-rmswipe">\n\t\t\t\t\t\t\t<div class="scroll-wrapper">\n\t\t\t\t\t\t\t\t<div class="items-wrapper has-horizontal-scroll">\n\t\t\t\t\t\t\t\t\t<div class="items">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="scroll"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="next-picture-arrow-bottom arrow-bottom">\n\t\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40">\n\t\t\t\t\t\t\t<path d="M16.5 11.5 L24.5 19.5 L16.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="cursor"></div>\n\n\t\t\t<div class="prev-picture-arrow-middle arrow-middle">\n\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40">\n\t\t\t\t\t<path d="M23.5 11.5 L15.5 19.5 L23.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path>\n\t\t\t\t</svg>\n\t\t\t</div>\n\n\n\t\t\t<div class="next-picture-arrow-middle arrow-middle">\n\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40">\n\t\t\t\t\t<path d="M16.5 11.5 L24.5 19.5 L16.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="thumbnails no-rmswipe">\n\t\t\t<div class="scroll-wrapper">\n\t\t\t\t<div class="items-wrapper has-horizontal-scroll">\n\t\t\t\t\t<div class="items">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="scroll"></div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="captions">\n\t\t\t',"constructor"==tp&&(__p+='\n\t\t\t\t<textarea class="caption" maxlength="9999" placeholder="Type image caption here"></textarea>\n\t\t\t'),__p+="\n\t\t</div>\n\t</div>\n\n";return __p}}},z79a:function(t,e,i){"use strict";var s=i("xi34");window.iconSVGCache=[];var o=function(){};o.prototype={MAX_ICON_CACHE_SIZE:30,generateShapeSVG:function(t,e,i,o,n){var a,r=1e5,l=e.get("bg_color")||e.viewport_default&&e.viewport_default.bg_color,c=this.getRGBA(l||"ffffff",e.get("bg_opacity")),h=this.getRGBA(e.get("color"),e.get("opacity"));if("ellipse"==(n="hotspot"===e.get("type")?n||e.get("pin_type"):n||e.get("tp"))){var d=i/2,p=o/2,u=e.get("borders");a=S("ellipse",{cx:d,cy:p,rx:d,ry:p},c,h,u=Math.min(u,d,p),e.id+"_"+t,e.get("opacity"))}if("rectangle"==n||"polygon"==n){"hotspot"===e.get("type")&&(h=c="rgba(0, 0, 0, 0)");var g="rectangle"==n?4:e.get("sides"),m=(u=e.get("borders"),e.get("radius")||0),f=function(t,e,i,s){for(var o,n,a,l=2*Math.PI/t,c=Math.PI/2-(t%2==1?0:l/2),h=[],d=999999,p=-999999,u=999999,g=-999999,m=0;m<t;m++)o=c+m*l,n=.5+.5*Math.cos(o),a=.5-.5*Math.sin(o),h.push({x:n,y:a}),n<d&&(d=n),n>p&&(p=n),a<u&&(u=a),a>g&&(g=a);for(m=0;m<t;m++)h[m].x=(h[m].x-d)*(e/(p-d)),h[m].y=(h[m].y-u)*(i/(g-u)),h[m].x=Math.round(h[m].x*r)/r,h[m].y=Math.round(h[m].y*r)/r;return h}(g,i,o),v=function(t){if(!t)return 99999;for(var e,i=99999,s=t.length,o=0;o<s;o++){var n=t[o].x-t[(o+1)%s].x,a=t[o].y-t[(o+1)%s].y;(e=Math.sqrt(n*n+a*a))<i&&(i=e),t[o].side=e}return i}(f),b=function(t,e,i,s,o,n){if(!t)return{};if(e<=1e-4)return{};var a=[],l=t.length;e=Math.min(e,i/2);for(var c=0;c<l;c++){var h,d,p,u,g=t[c],m=t[(c+1)%l],f=t[c].side,v=(m.x-g.x)/f,b=(m.y-g.y)/f;h=g.x+v*e,d=g.y+b*e,p=m.x-v*e,u=m.y-b*e,h=Math.round(h*r)/r,d=Math.round(d*r)/r,p=Math.round(p*r)/r,u=Math.round(u*r)/r,a.push({x:h,y:d}),a.push({x:p,y:u})}return{points:a,radius:e}}(f,m,v);a=S("path",{path:_=function(t,e,i){if(!t)return"";for(var s=t.length,o="",n=0;n<s;n++){var a=2*n+1,r=(2*n+2)%(2*s);if(o+=0==n?"M":"L",e){o+=e[a].x+" "+e[a].y+" ";var l=e[a].x-e[r].x,c=e[a].y-e[r].y,h=1/((l*l+c*c)/4)-1/(i*i),d=Math.sqrt(1/h);o+="A"+d+" "+d+" 0 0 0 "+e[r].x+" "+e[r].y+" "}else o+=t[n].x+" "+t[n].y+" "}return o+" Z "}(f,b.points,b.radius)},c,h,u,e.id+"_"+t,e.get("opacity"))}if("line"==n){u=e.get("weight"),p=Math.round(o/2)+(u%2==1?.5:0);var _="",w=[13*u/3,2*u/3].join(" "),y=u>1?[.001,5*u/3].join(" "):[1,2].join(" "),k="dotted"==e.get("stroke")?u/2:0;if(_="M"+k+" "+p+" L"+i+" "+p,"solid"==e.get("stroke")&&(a='<path d="'+_+'" style="fill:none; stroke:'+c+";stroke-width:"+u+'"/>'),"double"==e.get("stroke"))a='<path d="'+("M"+k+" "+(p-u)+" L"+i+" "+(p-u))+'" style="fill:none; stroke:'+c+";stroke-width:"+u+'"/>',a+='<path d="'+("M"+k+" "+(p+u)+" L"+i+" "+(p+u))+'" style="fill:none; stroke:'+c+";stroke-width:"+u+'"/>';"dotted"==e.get("stroke")&&(a='<path d="'+_+'" stroke-linecap="round" stroke-dasharray="'+y+'" style=" fill:none; stroke:'+c+";stroke-width:"+u+'"/>'),"dashed"==e.get("stroke")&&(a='<path d="'+_+'" stroke-dasharray="'+w+'" style=" fill:none; stroke:'+c+";stroke-width:"+u+'"/>')}if("icon"==n){var C=this.iconData||this.current_icon_data;if(!C)return null;var x=C.$svg.clone();return x.css({width:"100%",height:"100%"}),c=this.getRGBA(l,1),x.find("*:not(.fixed-color)").each((function(){var t=Object(s.a)(this);t.css({fill:"","fill-opacity":""}),t.get(0).removeAttribute("fill"),t.get(0).removeAttribute("fill-opacity")})),x.get(0).setAttribute("fill",c),x.get(0).setAttribute("fill-opacity",e.get("bg_opacity")),x}return'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+i+'px" height="'+o+'px">'+a+"</svg>";function S(t,e,i,s,o,n,a){var r="mask_"+n,l="clip_"+n,c="",h=2;return o>0&&a>.99&&(h=1),c="<defs>",o>0&&(c+='<mask id="'+r+'">',"path"==t&&(c+='<path d="'+e.path+'" style="fill:white; stroke:black; stroke-width:'+o*h+'"/>'),"ellipse"==t&&(c+='<ellipse cx="'+e.cx+'" cy="'+e.cy+'" rx="'+e.rx+'" ry="'+e.ry+'" style="fill:white; stroke:black; stroke-width:'+o*h+'"/>'),c+="</mask>"),c+='<clippath id="'+l+'">',"path"==t&&(c+='<path d="'+e.path+'"/>'),"ellipse"==t&&(c+='<ellipse cx="'+e.cx+'" cy="'+e.cy+'" rx="'+e.rx+'" ry="'+e.ry+'"/>'),c+="</clippath>",c+="</defs>","path"==t&&(c+='<path mask="url(#'+r+')" d="'+e.path+'" style="fill:'+i+'; stroke:none; stroke-width:0; pointer-events: visiblePainted;"/>'),"ellipse"==t&&(c+='<ellipse mask="url(#'+r+')" cx="'+e.cx+'" cy="'+e.cy+'" rx="'+e.rx+'" ry="'+e.ry+'" style="fill:'+i+'; stroke:none; stroke-width:0; pointer-events: visiblePainted;"/>'),0==o?c:("path"==t&&(c+='<path clip-path="url(#'+l+')" d="'+e.path+'" style="fill:none; stroke:'+s+"; stroke-width:"+2*o+'; pointer-events: visiblePainted;"/>'),"ellipse"==t&&(c+='<ellipse clip-path="url(#'+l+')" cx="'+e.cx+'" cy="'+e.cy+'" rx="'+e.rx+'" ry="'+e.ry+'" style="fill:none; stroke:'+s+"; stroke-width:"+2*o+'; pointer-events: visiblePainted;"/>'),c)}},getRGBA:function(t,e){if(0==e)return"none";var i=[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)];return e>.99?"rgb("+i[0]+","+i[1]+","+i[2]+")":"rgba("+i[0]+","+i[1]+","+i[2]+", "+e+")"}},e.a=o},zjto:function(t,e,i){"use strict";i.r(e);var s=i("q1tI"),o=i.n(s),n=i("saLn"),a=i("8AXF"),r=i("v83y");function l(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function c(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var h=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?l(i,!0).forEach((function(e){c(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):l(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},i("IrH7").b),d=Object.keys(h).map((function(t){var e=h[t].style;return o.a.createElement(e,{key:t})})),p=i("I39y"),u=["The follies of others are obvious, but our own hide from us; we love to parse others missteps but we cover up our own, as the cheat conceals the false die. It is in the nature of men to lay blame: we see others mistakes while our own passions swell, carrying us ever farther from improvement.  Buddhist wisdom","No one can long stand on tiptoe. He who thrusts himself forward is not a source of light. No glory comes to the self-satisfied, no honor to the boastful. The proud will not rise high. In the court of good sense, such people are like table discards, repellent to all. The sensible person does not rely on self.  Lao-Tzu","Simplicity in life, language and habits strengthens a nation, but a life of luxury, fancy language and effeminate habit leads to weakness and death.  John Ruskin","Truth is not a matter of talking but comes only through labor and observation. And when you have one truth in hand, two others, like the first leaves of a dicotyledonous plant, will probably appear.  John Ruskin","All things have a beginning and an end. So it is with mankind: there is a beginning and end to all  human affairs. He who understands what is a beginning and what is an end is closer to the truth.  Confucius","Most people are dismayed if deprived of their pleasures. The right course belongs to him who relishes even the passing away of the reason for his joy and is not bitter.  Pascal","When we are clear about things, we have knowledge; with knowledge, we seek the path of truth; when the search is rewarded, the heart becomes good; with the heart made good, the moral view of things that leads to virtue is attained.  Confucius","Wisdom has three faces: when seen from afar, it is grand and severe; on closer approach, it is tender and welcoming; when we are close enough to hear it, the words of  wisdom are severe and demanding.  Chinese wisdom","The sun constantly floods the world with its light, but its light is not exhausted; so your mind should send its light in all directions and not be exhausted. It should flow everywhere, without diminishment, and when it encounters an obstacle, it should react, not with annoyance or anger but should serenely clarify all that yearns to accept it, without any lessening or weariness, bringing light to all that is turned to it, leaving in shadow only that which turns its face away.  Marcus Aurelius","As torches and fireworks pale to invisibility in the sun, so the mind, even the mind of genius, and beauty pale and are eclipsed by the hearts goodness.  Schopenhauer","Music and sweet treats bring the wanderer to a stop, but wisdom has neither flavor nor smell. When looked for, it is invisible; when listened for, it is inaudible, yet its goodness is inexhaustible. The most powerful thing in the world cannot be seen, heard or touched.  Lao-Tzu","The best ideas are usually those that come without effort, out of the blue. The great intellectual creations come easily. Only a great person can create something great, and such a one works without strain.  John Ruskin","He who talks much rarely puts his words into action. But the wise person fears that his words may not be translated into action. The wise do not utter empty words, lest their actions be inconsistent with their words.  Chinese wisdom","Fear ignorance, but fear false knowledge even more. Turn your eyes from the deceptive world and do not trust your feelings, for they lie; rather look inward to the impersonal, eternal self. Truly, ignorance is like a sealed and airless chamber; in it, the soul sits like a caged bird, neither singing nor spreading its wings. But ignorance is better than any school of thought that is not guided by the wisdom of the soul.  Buddhist wisdom","Some seek their good or happiness in power; others in science, and others in the pleasures of the flesh. But those who come truly close to the good understand that it cannot consist in what can only be mastered by a few. They understand that the true good of humankind is that which can be achieved by all people, without division and without envy; its nature  is such that none can lose it if they do not so choose.  Pascal","The wise person asks only of himself; the unwise man demands everything from others.  Chinese wisdom","To know much and not to put ones self forward as knowing is the height of morality. To know little and put ones self forward as knowledgeable is an illness. Only by understanding the disease can one expunge it.  Lao-Tzu","Speak only of that which is as clear to you as the morning, or be silent.  Talmud","Conquer ferocity with love, evil with good, miserliness with generosity, the liar with truth.  Buddhist wisdom","People seek satisfaction, throwing themselves from one thing to another because they feel the emptiness of their lives but do not yet realize the emptiness of the new delight that attracts them.  Pascal","The skilled warrior does not rage. The skilled fighter is not angry. He who is skilled in the use of people is not provocative. This is the virtue of non-resistance. This is being in agreement with Heaven.  Lao-Tzu","The first and principal characteristic of a good and wise person is his consciousness that he knows very little, that many people know more and he seeks always to learn, to study, and not to teach. Those who wish to teach or direct neither teach nor lead well.  John Ruskin","The virtuous person seeks to follow the direct path to the end. What is to be feared is to go halfway and then to weaken.  Chinese wisdom"],g=function(){return u[Math.floor(Math.random()*u.length)]};function m(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var i=[],s=!0,o=!1,n=void 0;try{for(var a,r=t[Symbol.iterator]();!(s=(a=r.next()).done)&&(i.push(a.value),!e||i.length!==e);s=!0);}catch(t){o=!0,n=t}finally{try{s||null==r.return||r.return()}finally{if(o)throw n}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var f,v,b={},_=function(t,e){if(b[t])return b[t];var i=e||r.ContentState.createFromText(g()),s=m(Object(p.createStore)(r.EditorState.createWithContent(i)),1)[0];return b[t]=s,b[t]},w=function(t){return b[t]};function y(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.Uppercase="UPPERCASE",t.Lowercase="LOWERCASE",t.Capitalize="CAPITALIZE"}(v||(v={}));var k,C,x=(y(f={},v.Uppercase,{label:"Uppercase",style:{textTransform:"uppercase"}}),y(f,v.Lowercase,{label:"Lowercase",style:{textTransform:"lowercase"}}),y(f,v.Capitalize,{label:"Capitalize",style:{textTransform:"capitalize"}}),f);function S(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.Bold="BOLD",t.Italic="ITALIC",t.Underline="UNDERLINE"}(C||(C={}));var P=(S(k={},C.Bold,{label:"Bold",style:{fontWeight:"bold"}}),S(k,C.Italic,{label:"Italic",style:{fontStyle:"italic"}}),S(k,C.Underline,{label:"Underline",style:{textDecoration:"underline"}}),k);function $(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function O(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var T=function(t){var e={};return Object.keys(t).forEach((function(i){e[i]=t[i].style})),e},M=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?$(i,!0).forEach((function(e){O(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):$(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},T(x),{},T(P)),j=i("UGoK");function I(){return(I=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(this,arguments)}var E,A=function(t){return o.a.createElement(r.Editor,I({blockStyleFn:function(t){var e=t.getType();return h[e]?e:""},customStyleMap:M,customStyleFn:j.c},t))},R=i("bLmx"),D=i("eS2O"),z=i("iC7s");function L(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var i=[],s=!0,o=!1,n=void 0;try{for(var a,r=t[Symbol.iterator]();!(s=(a=r.next()).done)&&(i.push(a.value),!e||i.length!==e);s=!0);}catch(t){o=!0,n=t}finally{try{s||null==r.return||r.return()}finally{if(o)throw n}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}!function(t){t.top="top",t.bottom="bottom"}(E||(E={}));var B=function(){var t=Object(s.useContext)(a.BackboneContext),e=t.model,i=t.modelSet,l=t.modelSave,c=Object(s.useContext)(D.a).model.viewport,h=L(_(e._id,e&&e.blocks&&Object(r.convertFromRaw)(Object(R.d)(e)))(),2),p=h[0],u=h[1],g=function(){l()};Object(s.useEffect)((function(){if(c){var t=Object(r.convertFromRaw)(Object(R.d)(e)),i=r.EditorState.createWithContent(t);u(i)}}),[c]);var m=L(Object(n.a)((function(t){var e=Object(r.convertToRaw)(t.getCurrentContent());i(Object(R.a)(e)),g()}),1e3),1)[0];return o.a.createElement(z.e,{height:"inherit",flexDirection:"column",justifyContent:e.verticalAlign&&e.verticalAlign!==E.top?"flex-end":"flex-start"},d,o.a.createElement(A,{editorState:p,onChange:function(t){u(t),m(t)},onBlur:g}))},F=i("rzNZ"),H=i("fhwx"),N=i.n(H),V=function(){var t,e,i=Object(s.useContext)(a.BackboneContext).model,n=Object(r.convertFromRaw)(i.content),l=(t=M,e={},Object.keys(t).forEach((function(i){e[i]={style:t[i]}})),e),c=Object(F.a)(n,{blockStyleFn:function(t){var e=t.getType();return h[e]?{attributes:{class:e}}:null},inlineStyleFn:function(t){return{style:Object(j.c)(t)}},inlineStyles:l});return o.a.createElement(o.a.Fragment,null,N()(c),d)};i.d(e,"TextEditor",(function(){return B})),i.d(e,"TextViewer",(function(){return V})),i.d(e,"createTextStore",(function(){return _})),i.d(e,"useTextWidgetStore",(function(){return w})),i.d(e,"getRandomText",(function(){return g})),i.d(e,"TextVerticalAlign",(function(){return E}))},zw1n:function(module,exports){module.exports={"template-common-button-widget":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n    <div class="common-button" data-id="'+(null==(__t=data._id)?"":_.escape(__t))+'">\n\n        <div class="icon"></div>\n\n    </div>\n\n';return __p}}},zzMN:function(t,e,i){"use strict";var s=i("xi34"),o=i("q1z7"),n=i.n(o),a=i("rFsW"),r=i("OTSC"),l=i("DiDd"),c=i.n(l),h=i("phNm");function d(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function p(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var u=n.a.View.extend({selectIconRight:18,selectIconTextMargin:2,initialize:function(t){a.a.bindAll(this),this.data=t.data,this.$container=t.$container,this.environment=t.environment,this.block=t.block,this.eCommerceManager=t.eCommerceManager,this.template=c.a["template-common-add-to-cart-wrap"],this.product=null,this.selects=[],this.selectsMap={},this.attributes=[],this.selectsValues={},this.restrictions={},this.constraints={width:0,height:0},this.showSkus=!1,this.longestAttribute="",this.selectPadding=0,this.setData_debounced=a.a.debounce(this.setData,100),this.setModel_debounced=a.a.debounce(this.setModel,200),this.$container.html(this.template),this.setElement(this.$container.find(".add-to-cart-wrap")),this.$button=this.$el.find(".add-to-cart-button"),this.$buttonIcon=this.$button.find(".button-icon"),this.$errorBlock=this.$button.find(".add-to-cart-error-block"),this.$buttonText=this.$button.find(".button-text"),this.$attrsContainer=this.$el.find(".add-to-cart-attributes"),this.$sizesCalculatingBlock=this.$el.find(".sizes-calculating-block")},render:function(){if(!this.rendered)return this.eCommerceManager.isMagConnectedToStripe()&&"default"!==this.data.selected_product_id?void this.getProduct():(this.rendered=!1,this.showSkus=!1,this.renderButton(this.data),this.generateIndividualStyleCSS(this.data),this.rendered=!0,this.recalcDimensions({width:this.data.w,height:this.data.h}),this.trigger("loaded"),void this.setMinimalDimensions())},destroy:function(){this.unbindDOMEvents()},rerender:function(t){t&&(this.data=t),this.rendered=!1,this.render()},getProduct:function(){this.product=this.eCommerceManager.getProductById(this.data.selected_product_id),this.product?(this.showSkus=this.checkSkus(null,this.product),this.renderAttributes(this.data),this.renderButton(this.data),this.renderMargins(),"horizontal"===this.data.layout&&this.setHorizontalLayoutClass(),this.generateIndividualStyleCSS(this.data),this.rendered=!0,this.recalcDimensions({width:this.data.w,height:this.data.h}),this.trigger("loaded"),this.setMinimalDimensions(),this.bindDOMEvents()):this.eCommerceManager.productsLoading?this.eCommerceManager.events.once("ecommerce:loadproducts:complete",this.getProduct.bind(this)):(this.eCommerceManager.productsLoaded||this.eCommerceManager.productsLoadingError)&&(this.showSkus=!1,this.renderButton(this.data),this.generateIndividualStyleCSS(this.data),this.rendered=!0,this.recalcDimensions({width:this.data.w,height:this.data.h}),this.trigger("loaded"),this.setMinimalDimensions())},checkSkus:function(t,e){return!!this.eCommerceManager.isMagConnectedToStripe()&&(e?i=e:t?i=this.eCommerceManager.getProductById(t):this.data.selected_product_id&&"default"!==this.data.selected_product_id&&(i=this.eCommerceManager.getProductById(this.data.selected_product_id)),!!i&&(this.product=i,this.haveProductAnyAttrForRendering(i)));var i},haveProductAnyAttrForRendering:function(t){return!!(t.attributes&&Array.isArray(t.attributes)&&t.attributes.length)&&t.articles.length>1},renderButton:function(t){this.showSkus||(this.$attrsContainer.empty().css({"margin-bottom":0,"margin-right":0}),this.selects=[],this.selectsMap={},this.attributes=[]),this.$buttonText.val(t.text),"constructor"!==this.environment&&this.$button.addClass("viewer-button"),this.renderButtonIcon(t),this.checkOutOfStock()},renderButtonIcon:function(t){if(t.icon_enabled){var e="left"===t.icon_pos?"row":"row-reverse";this.$button.css("flex-direction",e),this.$buttonIcon.css({display:"inline-block",height:t.icon_h,width:t.icon_w})}else this.$buttonIcon.css({display:"none"})},renderAttributes:function(t){if(this.$attrsContainer.empty().css({"margin-bottom":0,"margin-right":0}),this.selects=[],this.selectsMap={},this.attributes=[],this.showSkus){var e=this.product?this.product:this.eCommerceManager.getProductById(t.selected_product_id);e&&(this.product||(this.product=e),(e.active||"constructor"===this.environment)&&("constructor"!==this.environment&&this.calculateSelectRestrictions(),e.attributes.forEach(function(e){e.length>this.longestAttribute.length&&(this.longestAttribute=e);var i=this.renderAttrSelect(e,t,this.$attrsContainer);this.selects.push(i),this.selectsMap[e]=i,this.attributes.push(e)}.bind(this))))}},renderAttrSelect:function(t,e,i){var o;if("constructor"===this.environment){o=Object(s.a)("<select>",{class:"attributes-input",value:t}).attr("name",t);var n=Object(s.a)("<option>").attr("value",t).addClass("attributes-option default-option").text(t);o.append(n)}else o=Object(s.a)("<select>").attr("name",t).addClass("attributes-input"),this.renderSelectOptions(t,o,!0),o.on("change",this.onSelectChange.bind(this));var a=Object(s.a)("<div>",{class:"select-container"});a.append('<div class="add-to-cart-error-block"></div>');var r=Object(s.a)("<input>",{type:"text",class:"fake-select",readonly:!0,tabindex:-1,value:t}),l=Object(s.a)('<svg class="select-dropdown-triangle" width="10px" height="16px" viewBox="0 0 10 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="dev" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="E-comm-W-01.4" transform="translate(-632.000000, -263.000000)" fill="#FFFFFF"><g transform="translate(494.500000, 247.000000)"><g><g transform="translate(136.000000, 15.500000)"><path d="M3.88579937,12.2407434 L8.34920863,8.41496403 C8.76853447,8.05554188 9.39983445,8.10410342 9.7592566,8.52342926 C9.91460784,8.70467237 10,8.93550936 10,9.17422064 L10,16.8257794 C10,17.3780641 9.55228475,17.8257794 9,17.8257794 C8.76128873,17.8257794 8.53045174,17.7403872 8.34920863,17.585036 L3.88579937,13.7592566 C3.46647353,13.3998345 3.41791199,12.7685345 3.77733414,12.3492086 C3.81065883,12.3103298 3.84692056,12.2740681 3.88579937,12.2407434 Z" id="arrow-copy" transform="translate(6.500000, 13.000000) scale(-1, -1) rotate(-270.000000) translate(-6.500000, -13.000000) "></path><path d="M3.88579937,3.2407434 L8.34920863,-0.585035966 C8.76853447,-0.944458116 9.39983445,-0.895896579 9.7592566,-0.476570737 C9.91460784,-0.295327627 10,-0.0644906353 10,0.174220637 L10,7.82577936 C10,8.37806411 9.55228475,8.82577936 9,8.82577936 C8.76128873,8.82577936 8.53045174,8.7403872 8.34920863,8.58503597 L3.88579937,4.7592566 C3.46647353,4.39983445 3.41791199,3.76853447 3.77733414,3.34920863 C3.81065883,3.31032982 3.84692056,3.27406809 3.88579937,3.2407434 Z" id="arrow-copy" transform="translate(6.500000, 4.000000) scale(-1, 1) rotate(-270.000000) translate(-6.500000, -4.000000) "></path></g></g></g></g></g></svg>');return i.append(a),a.append(r,l,o),"constructor"===this.environment&&a.append(Object(s.a)("<div>",{class:"select-overlay"})),o},renderSelectOptions:function(t,e,i){var o=this,n=this.getAllSelectOptions();e.empty();var a=Object(s.a)("<option>").attr("value","default").addClass("attributes-option default-option").text(t);e.append(a),n[t]&&n[t].forEach((function(i){var n=Object(s.a)("<option>").attr("value",i).addClass("attributes-option").text(i);o.restrictions[t]&&!o.restrictions[t].includes(i)&&n.attr("disabled",!0),e.append(n)})),i?this.selectsValues[t]="default":e.val(this.selectsValues[t])},getAllSelectOptions:function(){var t={};return this.product.articles.forEach((function(e){Object.keys(e.attributes).forEach((function(i){t[i]=t[i]||[],t[i].includes(e.attributes[i])||t[i].push(e.attributes[i])}))})),t},calculateSelectRestrictions:function(){this.restrictions={};var t,e={},i=0;for(var s in this.selectsValues)"default"!==this.selectsValues[s]&&(e[s]=this.selectsValues[s],t=s,i+=1);this.product.articles.forEach(function(s){if(a.a.isMatch(s.attributes,e))for(var o in s.attributes)this.restrictions[o]?-1===this.restrictions[o].indexOf(s.attributes[o])&&this.restrictions[o].push(s.attributes[o]):this.restrictions[o]=[s.attributes[o]];1===i&&(this.restrictions[t]?-1===this.restrictions[t].indexOf(s.attributes[t])&&this.restrictions[t].push(s.attributes[t]):this.restrictions[t]=[s.attributes[t]])}.bind(this))},renderMargins:function(t){var e=t||this.data.layout;if(this.$attrsContainer.css({"margin-bottom":0,"margin-right":0}),this.showSkus&&this.selects.length){var i=this.selects.length-1;"horizontal"===e?(this.$attrsContainer.css({"margin-right":this.data.select_btn_margin}),this.selects.forEach(function(t,e){t.parent().css({"margin-bottom":0,"margin-right":e<i?this.data.attributes_margin:0})}.bind(this))):(this.$attrsContainer.css({"margin-bottom":this.data.select_btn_margin}),this.selects.forEach(function(t,e){t.parent().css({"margin-bottom":e<i?this.data.attributes_margin:0,"margin-right":0})}.bind(this)))}},generateIndividualStyleCSS:function(t,e,i){var s=e||"default",o=i||"both";"constructor"===this.environment?this.generateStyleCSS(t,s,o):(this.generateStyleCSS(t,s,o),this.generateHoverStyleCSS(t))},bindDOMEvents:function(){this.eCommerceManager.events.on("ecommerce:cartdata:changed",this.checkOutOfStock),"constructor"!==this.environment&&this.$button.on("click",this.onAddToCartClick)},unbindDOMEvents:function(){"constructor"!==this.environment&&this.$button.off("click",this.onAddToCartClick)},getSimpleMinimalDimensions:function(){return this.showSkus?"vertical"===this.data.layout?{width:50,height:100}:{width:190,height:30}:{width:42,height:16}},getHorizontalTextMargin:function(t){return Math.ceil(t/4)},getVerticalTextMargin:function(t){return Math.ceil(t/6)},getHorizontalIconMargin:function(t){return Math.ceil(t/4)},getVerticalIconMargin:function(t){return Math.ceil(t/6)},getMinimalDimensions:function(){var t=0,e=0,i=this.data.icon_h+2*this.getVerticalIconMargin(this.data.icon_h);if("text"===this.data.tp?(t=this.data.text_w,e=this.data.text_h):"icon"===this.data.tp?(t=this.data.icon_w+2*this.getHorizontalIconMargin(this.data.icon_w),e=i):(t=this.data.text_w+this.data.icon_w+this.getHorizontalTextMargin(this.data["font-size"]),e=this.data.text_h>i?this.data.text_h:i),this.showSkus){var s=this.data["attrs-icon-h"]+2*this.getVerticalIconMargin(this.data["attrs-icon-h"]),o=this.data["attrs-text_w"]+2*this.getSelectsPadding(),n=this.data["attrs-text_h"]>s?this.data["attrs-text_h"]:s,a=t>o?t:o,r=e>n?e:n,l=(this.selects.length-1)*this.data.attributes_margin,c=0,h=0;return"vertical"===this.data.layout?(c=a,h=r*(this.selects.length+1)+l+this.data.select_btn_margin):(c=a*(this.selects.length+1)+l+this.data.select_btn_margin,h=r),{width:c,height:h}}return{width:t,height:e}},setMinimalDimensions:function(t,e){if(!a.a.isUndefined(t)&&!a.a.isUndefined(e))return this.constraints={width:t,height:e},void(this.block&&this.block.setSizeConstraints(t,e));if("constructor"===this.environment){var i=this.getMinimalDimensions();this.constraints=i,this.block.setSizeConstraints(i.width,i.height)}},recalcDimensions:function(t){if(this.rendered){var e=this.showSkus?this.data.select_btn_margin:0,i=this.showSkus?this.selects.length+1:1,s=this.showSkus?(this.selects.length-1)*this.data.attributes_margin:0;if("vertical"===this.data.layout){if(!t.height)return;var o=t.height-e-s,n=Math.round(o/i);this.$button.css({height:n+"px",width:"100%"}),this.showSkus&&this.selects.forEach((function(t){t.parent().css({height:n+"px",width:"100%"})}))}else{if(!t.width)return;var a=t.width-e-s,r=Math.round(a/i);this.$button.css({width:r+"px",height:"100%"}),this.showSkus&&this.selects.forEach((function(t){t.parent().css({width:r+"px",height:"100%"})}))}}},updateRecalcDimensionsOnProductChange:function(){var t=this.recalcDimensionsOnProductChange();this.block.updateBlockSizes(t)},recalcDimensionsOnProductChange:function(){var t,e,i=this.showSkus?this.data.select_btn_margin:0,s=this.showSkus?this.selects.length+1:1,o=this.showSkus?(this.selects.length-1)*this.data.attributes_margin:0,n=this.data.btn_h,a=this.data.btn_w;return"vertical"===this.data.layout?(t=n*s+o+i,e=a):(t=n,e=a*s+o+i),this.$button.css({height:n+"px",width:a+"px"}),this.showSkus&&this.selects.forEach((function(t){t.parent().css({height:n+"px",width:a+"px"})})),{width:e,height:t}},recalcWidgetSizesAfterChangeLayout:function(t){var e=t||this.data.layout,i=this.data.btn_h,s=this.data.btn_w,o=i,n=s;return this.showSkus&&("horizontal"===e?n=s+s*this.selects.length+this.data.select_btn_margin+this.data.attributes_margin*(this.selects.length-1):o=i+i*this.selects.length+this.data.select_btn_margin+this.data.attributes_margin*(this.selects.length-1)),this.block.updateBlockSizes({width:n,height:o}),{width:n,height:o}},isAllSelectsNotDefault:function(){var t=!0;for(var e in this.selectsValues)if("default"===this.selectsValues[e]){t=!1;break}return t},getArticleBySelectsValues:function(){return this.product?1===this.product.articles.length?this.product.articles[0]:this.product.articles.find(function(t){return a.a.isMatch(t.attributes,this.selectsValues)}.bind(this)):null},onSelectChange:function(t){this.hideError();var e=Object(s.a)(t.target),i=e.attr("name");this.selectsValues[i]=e.val(),e.parent().find(".fake-select").attr("value","default"===e.val()?i:e.val()),this.calculateSelectRestrictions(),this.product.attributes.forEach(function(t){this.renderSelectOptions(t,this.selectsMap[t])}.bind(this))},onAddToCartClick:function(){var t=this;if(this.hideError(),this.product||this.showError(),this.isAllSelectsNotDefault()){var e=this.getArticleBySelectsValues();if(e){e.productObject=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?d(i,!0).forEach((function(e){p(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):d(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},this.product,{articles:null});var i=this.eCommerceManager.addToCart(e);i instanceof h.a?i.type===h.c.outOfStock?this.showOutOfStockError():this.showError():(this.environment===r.a.environment.viewer&&RM.analytics&&RM.analytics.sendEvent("Item added to cart",e.id),Object.keys(this.selectsMap).forEach((function(e){var i=t.selectsMap[e];t.selectsValues[e]="default",i.parent().find(".fake-select").attr("value",e),t.calculateSelectRestrictions()})),Object.keys(this.selectsMap).length&&this.product.attributes.forEach((function(e){return t.renderSelectOptions(e,t.selectsMap[e])})))}else this.showError("select")}else this.showError("select")},showError:function(t){"select"!==t?this.$button.addClass("add-to-cart-error"):this.selects.map((function(t){t.parents(".select-container").toggleClass("add-to-cart-error","default"===t.val())}))},showOutOfStockError:function(){this.showError(),this.$buttonText.val("Out of stock")},checkOutOfStock:function(){var t=this.getArticleBySelectsValues();if(t&&!this.eCommerceManager.checkItemQuantity(t))return this.showOutOfStockError();this.$buttonText.val(this.data.text),this.hideError()},hideError:function(){this.$button.removeClass("add-to-cart-error"),this.selects.map((function(t){return t.parents(".select-container").removeClass("add-to-cart-error")})),this.$buttonText.val(this.data.text)},onProductChange:function(t){t&&(this.data=t),this.rendered=!1,this.showSkus=this.checkSkus(this.data.selected_product_id),this.showSkus?this.product&&(this.renderAttributes(this.data),this.renderButton(this.data),this.renderMargins(),this.generateIndividualStyleCSS(this.data),this.rendered=!0,this.updateRecalcDimensionsOnProductChange()):(this.renderButton(this.data),this.generateIndividualStyleCSS(this.data),this.rendered=!0,this.updateRecalcDimensionsOnProductChange())},setHorizontalLayoutClass:function(){this.$el.hasClass("horizontal-layout")||this.$el.addClass("horizontal-layout")},removeHorizontalLayoutClass:function(){this.$el.hasClass("horizontal-layout")&&this.$el.removeClass("horizontal-layout")},onLayoutChange:function(t){if(this.rendered){this.data=t;var e=t.layout,i=this.recalcWidgetSizesAfterChangeLayout(e);this.renderMargins(e),"horizontal"===e?this.setHorizontalLayoutClass():this.removeHorizontalLayoutClass(),this.recalcDimensions(i),this.setMinimalDimensions()}},applyButtonTextSize:function(t){this.data=t,this.$buttonText.css({height:t.text_h+"px",width:t.text_w+"px"})},applyButtonIconSize:function(t){this.data=t,this.$buttonIcon.css({height:t.icon_h+"px",width:t.icon_w+"px"})},applyButtonIconPosition:function(t){this.data=t;var e="left"===t.icon_pos?"row":"row-reverse";this.$button.css("flex-direction",e)},applySelectsIconSize:function(t){var e=this;this.data=t,this.showSkus&&(this.selectPadding=t["attrs-icon-w"]+this.selectIconRight+this.selectIconTextMargin,this.selects.forEach((function(i){var s=i.parent();s.find(".fake-select").css({padding:"0 ".concat(e.selectPadding,"px")}),s.find(".select-dropdown-triangle").css({width:t["attrs-icon-w"]+"px",height:t["attrs-icon-h"]+"px"})})))},getButtonText:function(){return this.$buttonText.val().trim()},enterEditMode:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$buttonText.removeAttr("readonly").addClass("editing"),t.selectText?this.$buttonText.select():this.$buttonText.focus().setCursorPos(0),this.block.selectEditControl()},leaveEditMode:function(){this.$buttonText.blur().attr("readonly",!0).removeClass("editing")},setData:function(t){this.data=t},setModel:function(t,e){this.block.model.set(t),e&&this.block.model.save()},getColorForErrorBorder:function(t){return t.isBorderSet?r.b.getRGBA(t.border,t.borderOpacity/100):r.b.getRGBA(t.bg,t.bgOpacity/100)},getDropdownTriangleSizeFromFontSize:function(t){return{h:16*t/18,w:10*t/18}},getSelectsPadding:function(){return this.selectPadding},getLongestAttribute:function(){return this.longestAttribute},generateStyleCSS:function(t,e,i){function s(t){return(!e||"default"===e||"both"!==i&&"button"!==i?"":"hover-")+t}function o(t){return(!e||"default"===e||"both"!==i&&"selects"!==i?"attrs-":"attrs-hover-")+t}var n=this.getColorForErrorBorder({bg:t[s("background-color")],bgOpacity:t[s("background-color-opacity")],border:t[s("border-color")],borderOpacity:t[s("border-color-opacity")],isBorderSet:!!t[s("border-width")]});if(this.$errorBlock.css({borderColor:n}),this.$button.css({color:r.b.getRGBA(t[s("color")],t[s("color-opacity")]/100),"background-color":r.b.getRGBA(t[s("background-color")],t[s("background-color-opacity")]/100),"border-radius":t[s("border-radius")]+"px","box-shadow":r.b.getRGBA(t[s("border-color")],t[s("border-color-opacity")]/100)+"0px 0px 0px "+t[s("border-width")]+"px inset"}),"constructor"===this.environment)this.$button.find(".button-icon svg path").css({fill:r.b.getRGBA(t[s("icon_color")],t[s("icon_color_opacity")]/100)});else{var a=t[s("icon_raster2xUrl")]?t[s("icon_raster2xUrl")]:t[s("icon_rasterUrl")];a&&this.$buttonIcon.css({"background-image":"url("+a+")"})}this.$buttonText.css({width:t.text_w+"px",height:t.text_h+"px","line-height":t.text_h+"px","font-family":t[s("font-family")],"font-size":t[s("font-size")]+"px","font-weight":t[s("font-weight")],"font-style":t[s("font-style")],"letter-spacing":t[s("letter-spacing")],"text-align":t[s("text-align")]}),this.showSkus&&(this.selectPadding=t["attrs-icon-w"]+this.selectIconRight+this.selectIconTextMargin,this.selects.forEach(function(e){var i=e.parent();i.find(".add-to-cart-error-block").css({borderColor:n}),i.css({"background-color":r.b.getRGBA(t[o("background-color")],t[o("background-color-opacity")]/100),"border-radius":t[o("border-radius")]+"px","box-shadow":r.b.getRGBA(t[o("border-color")],t[o("border-color-opacity")]/100)+"0px 0px 0px "+t[o("border-width")]+"px inset"}),i.find(".fake-select").css({padding:"0 ".concat(this.selectPadding,"px"),"border-radius":t[o("border-radius")]+"px",color:r.b.getRGBA(t[o("color")],t[o("color-opacity")]/100),"font-family":t[o("font-family")],"font-size":t[o("font-size")]+"px","font-weight":t[o("font-weight")],"font-style":t[o("font-style")],"letter-spacing":t[o("letter-spacing")],"text-align":t[o("text-align")],"text-align-last":t[o("text-align")]}),i.find(".select-dropdown-triangle path").css({fill:r.b.getRGBA(t[o("color")],t[o("color-opacity")]/100)}),i.find(".select-dropdown-triangle").css({width:t["attrs-icon-w"],height:t["attrs-icon-h"]})}.bind(this)))},generateHoverStyleCSS:function(t){var e=this.$buttonText,i=this.$buttonIcon;this.$button.hover((function(){if(Object(s.a)(this).css({color:r.b.getRGBA(t["hover-color"],t["hover-color-opacity"]/100),"background-color":r.b.getRGBA(t["hover-background-color"],t["hover-background-color-opacity"]/100),"border-radius":t["hover-border-radius"]+"px","box-shadow":r.b.getRGBA(t["hover-border-color"],t["hover-border-color-opacity"]/100)+"0px 0px 0px "+t["hover-border-width"]+"px inset"}),"constructor"!==this.environment){var o=t["hover-icon_raster2xUrl"]?t["hover-icon_raster2xUrl"]:t["hover-icon_rasterUrl"];o&&i.css({"background-image":"url("+o+")"})}else Object(s.a)(this).find(".button-icon svg path").css({fill:r.b.getRGBA(t["hover-icon_color"],t["hover-icon_color_opacity"]/100)});e.css({"font-family":t["hover-font-family"],"font-size":t["hover-font-size"]+"px","font-weight":t["hover-font-weight"],"font-style":t["hover-font-style"],"letter-spacing":t["hover-letter-spacing"],"text-align":t["hover-text-align"]})}),(function(){if(Object(s.a)(this).css({color:r.b.getRGBA(t.color,t["color-opacity"]/100),"background-color":r.b.getRGBA(t["background-color"],t["background-color-opacity"]/100),"border-radius":t["border-radius"]+"px","box-shadow":r.b.getRGBA(t["border-color"],t["border-color-opacity"]/100)+"0px 0px 0px "+t["border-width"]+"px inset"}),"constructor"!==this.environment){var o=t.icon_raster2xUrl?t.icon_raster2xUrl:t.icon_rasterUrl;o&&i.css({"background-image":"url("+o+")"})}else Object(s.a)(this).find(".button-icon svg path").css({fill:r.b.getRGBA(t.color,t["color-opacity"]/100)});e.css({"font-family":t["font-family"],"font-size":t["font-size"]+"px","font-weight":t["font-weight"],"font-style":t["font-style"],"letter-spacing":t["letter-spacing"],"text-align":t["text-align"]})})),this.showSkus&&this.selects.forEach(function(e){e.hover((function(){Object(s.a)(this).parent().css({"background-color":r.b.getRGBA(t["attrs-hover-background-color"],t["attrs-hover-background-color-opacity"]/100),"border-radius":t["attrs-hover-border-radius"]+"px","box-shadow":r.b.getRGBA(t["attrs-hover-border-color"],t["attrs-hover-border-color-opacity"]/100)+"0px 0px 0px "+t["attrs-hover-border-width"]+"px inset"}),Object(s.a)(this).parent().find(".fake-select").css({"border-radius":t["attrs-hover-border-radius"]+"px",color:r.b.getRGBA(t["attrs-hover-color"],t["attrs-hover-color-opacity"]/100),"font-family":t["attrs-hover-font-family"],"font-size":t["attrs-hover-font-size"]+"px","font-weight":t["attrs-hover-font-weight"],"font-style":t["attrs-hover-font-style"],"letter-spacing":t["attrs-hover-letter-spacing"],"text-align":t["attrs-hover-text-align"],"text-align-last":t["attrs-hover-text-align"]}),Object(s.a)(this).parent().find(".select-dropdown-triangle path").css({fill:r.b.getRGBA(t["attrs-hover-color"],t["attrs-hover-color-opacity"]/100)})}),(function(){Object(s.a)(this).parent().css({"background-color":r.b.getRGBA(t["attrs-background-color"],t["attrs-background-color-opacity"]/100),"border-radius":t["attrs-border-radius"]+"px","box-shadow":r.b.getRGBA(t["attrs-border-color"],t["attrs-border-color-opacity"]/100)+"0px 0px 0px "+t["attrs-border-width"]+"px inset"}),Object(s.a)(this).parent().find(".fake-select").css({"border-radius":t["attrs-border-radius"]+"px",color:r.b.getRGBA(t["attrs-color"],t["attrs-color-opacity"]/100),"font-family":t["attrs-font-family"],"font-size":t["attrs-font-size"]+"px","font-weight":t["attrs-font-weight"],"font-style":t["attrs-font-style"],"letter-spacing":t["attrs-letter-spacing"],"text-align":t["attrs-text-align"],"text-align-last":t["attrs-text-align"]}),Object(s.a)(this).parent().find(".select-dropdown-triangle path").css({fill:r.b.getRGBA(t["attrs-color"],t["attrs-color-opacity"]/100)})})),setTimeout(function(){e.parent().css({transition:"all "+t["hover-tansition-duration"]+"s ease-out"}),e.parent().find(".fake-select").css({transition:"all "+t["hover-tansition-duration"]+"s ease-out"})}.bind(this),100),e.parent().find(".select-dropdown-triangle path").css({transition:"all "+t["hover-tansition-duration"]+"s ease-out"})}.bind(this)),setTimeout(function(){this.$button.css({transition:"all "+t["hover-tansition-duration"]+"s ease-out"}),e.css({transition:"all "+t["hover-tansition-duration"]+"s ease-out"}),i.css({transition:"all "+t["hover-tansition-duration"]+"s ease-out"})}.bind(this),100)}},{DEFAULT_ROW_HEIGHT:50,DEFAULT_ROW_WIDTH:168});e.a=u}}]);